/*! For license information please see main.beb9bba3e3c875f69354.js.LICENSE.txt */
var main;(()=>{var __webpack_modules__={"./node_modules/fairygui-createjs/dist/fairygui.module.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AssetLoader: () => (/* binding */ AssetLoader),\n/* harmony export */   Binder: () => (/* binding */ Binder),\n/* harmony export */   BlendModeMap: () => (/* binding */ BlendModeMap),\n/* harmony export */   Controller: () => (/* binding */ Controller),\n/* harmony export */   DefaultUIStageOptions: () => (/* binding */ DefaultUIStageOptions),\n/* harmony export */   DragIndicator: () => (/* binding */ DragIndicator),\n/* harmony export */   GButton: () => (/* binding */ GButton),\n/* harmony export */   GComboBox: () => (/* binding */ GComboBox),\n/* harmony export */   GComponent: () => (/* binding */ GComponent),\n/* harmony export */   GGraph: () => (/* binding */ GGraph),\n/* harmony export */   GGroup: () => (/* binding */ GGroup),\n/* harmony export */   GImage: () => (/* binding */ GImage),\n/* harmony export */   GLabel: () => (/* binding */ GLabel),\n/* harmony export */   GList: () => (/* binding */ GList),\n/* harmony export */   GLoader: () => (/* binding */ GLoader),\n/* harmony export */   GMovieClip: () => (/* binding */ GMovieClip),\n/* harmony export */   GObject: () => (/* binding */ GObject),\n/* harmony export */   GProgressBar: () => (/* binding */ GProgressBar),\n/* harmony export */   GRichTextField: () => (/* binding */ GRichTextField),\n/* harmony export */   GRoot: () => (/* binding */ GRoot),\n/* harmony export */   GScrollBar: () => (/* binding */ GScrollBar),\n/* harmony export */   GSlider: () => (/* binding */ GSlider),\n/* harmony export */   GTextField: () => (/* binding */ GTextField),\n/* harmony export */   GTextInput: () => (/* binding */ GTextInput),\n/* harmony export */   GTimer: () => (/* binding */ GTimer),\n/* harmony export */   GearXMLNodeNameMap: () => (/* binding */ GearXMLNodeNameMap),\n/* harmony export */   InteractiveEvents: () => (/* binding */ InteractiveEvents),\n/* harmony export */   PackageItem: () => (/* binding */ PackageItem),\n/* harmony export */   ParseAlignType: () => (/* binding */ ParseAlignType),\n/* harmony export */   ParseAutoSizeType: () => (/* binding */ ParseAutoSizeType),\n/* harmony export */   ParseButtonMode: () => (/* binding */ ParseButtonMode),\n/* harmony export */   ParseEaseType: () => (/* binding */ ParseEaseType),\n/* harmony export */   ParseFlipType: () => (/* binding */ ParseFlipType),\n/* harmony export */   ParseListChildrenRenderOrder: () => (/* binding */ ParseListChildrenRenderOrder),\n/* harmony export */   ParseListLayoutType: () => (/* binding */ ParseListLayoutType),\n/* harmony export */   ParseListSelectionMode: () => (/* binding */ ParseListSelectionMode),\n/* harmony export */   ParseLoaderFillType: () => (/* binding */ ParseLoaderFillType),\n/* harmony export */   ParseOverflowType: () => (/* binding */ ParseOverflowType),\n/* harmony export */   ParsePackageItemType: () => (/* binding */ ParsePackageItemType),\n/* harmony export */   ParseProgressTitleType: () => (/* binding */ ParseProgressTitleType),\n/* harmony export */   ParseScrollBarDisplayType: () => (/* binding */ ParseScrollBarDisplayType),\n/* harmony export */   ParseScrollType: () => (/* binding */ ParseScrollType),\n/* harmony export */   ParseVertAlignType: () => (/* binding */ ParseVertAlignType),\n/* harmony export */   PopupMenu: () => (/* binding */ PopupMenu),\n/* harmony export */   ScrollPane: () => (/* binding */ ScrollPane),\n/* harmony export */   StringUtil: () => (/* binding */ StringUtil),\n/* harmony export */   Transition: () => (/* binding */ Transition),\n/* harmony export */   UIConfig: () => (/* binding */ UIConfig),\n/* harmony export */   UIObjectFactory: () => (/* binding */ UIObjectFactory),\n/* harmony export */   UIPackage: () => (/* binding */ UIPackage),\n/* harmony export */   UIStage: () => (/* binding */ UIStage),\n/* harmony export */   Window: () => (/* binding */ Window)\n/* harmony export */ });\n/* harmony import */ var ismobilejs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ismobilejs */ \"./node_modules/ismobilejs/esm/index.js\");\n\n\nclass UIContainer extends createjs.Container {\n    constructor(owner) {\n        super();\n        this.UIOwner = owner;\n        this.mouseEnabled = true;\n        this.mouseChildren = true;\n    }\n    get scrollRect() {\n        return this.$scrollRect;\n    }\n    set scrollRect(rect) {\n        this.$scrollRect = rect;\n        if (rect != null) {\n            if (!this.$rectMask) {\n                this.$rectMask = new createjs.Graphics();\n                var shape = new createjs.Shape(this.$rectMask);\n                this.mask = shape;\n            }\n            this.$rectMask.clear();\n            if (rect.width > 0 && rect.height > 0) {\n                this.$rectMask.beginFill('#000');\n                this.$rectMask.drawRect(this.$scrollRect.x, this.$scrollRect.y, this.$scrollRect.width, this.$scrollRect.height);\n                this.$rectMask.endFill();\n            }\n        }\n        else\n            this.mask = null;\n    }\n}\n\nclass InteractiveEvents {\n}\nInteractiveEvents.Down = createjs.Touch.isSupported() ? 'mousedown' : 'mousedown';\nInteractiveEvents.Cancel = createjs.Touch.isSupported() ? 'mousecancel' : 'mousecancel';\nInteractiveEvents.Up = createjs.Touch.isSupported() ? 'stagemouseup' : 'stagemouseup';\nInteractiveEvents.Click = createjs.Touch.isSupported() ? 'click' : 'click';\nInteractiveEvents.UpOutside = createjs.Touch.isSupported()\n    ? 'mouseupoutside'\n    : 'mouseupoutside';\nInteractiveEvents.Move = createjs.Touch.isSupported() ? 'stagemousemove' : 'stagemousemove';\nInteractiveEvents.Over = createjs.Touch.isSupported() ? 'mouseover' : 'mouseover';\nInteractiveEvents.Out = createjs.Touch.isSupported() ? 'mouseout' : 'mouseout';\n//mouse only\nInteractiveEvents.RightDown = 'rightdown';\nInteractiveEvents.RightUp = 'rightup';\nInteractiveEvents.RightClick = 'rightclick';\nInteractiveEvents.RightUpOutside = 'rightupoutside';\nlet GearXMLNodeNameMap = {\n    gearDisplay: 0,\n    gearXY: 1,\n    gearSize: 2,\n    gearLook: 3,\n    gearColor: 4,\n    gearAni: 5,\n    gearText: 6,\n    gearIcon: 7\n};\nlet BlendModeMap = [\n    'Normal',\n    'Add',\n    'Multiply',\n    'Screen',\n    'Overlay',\n    'Darken',\n    'Lighten',\n    'ColorDodge',\n    'ColorBurn',\n    'HardLight',\n    'SoftLight',\n    'Difference',\n    'Exclusion',\n    'Hue',\n    'Saturation',\n    'Color',\n    'Luminosity',\n    'NormalNPM',\n    'AddNPM',\n    'ScreenNPM' //  SCREEN_NPM\n];\nfunction ParseOverflowType(value) {\n    switch (value) {\n        case 'visible':\n            return 0 /* Visible */;\n        case 'hidden':\n            return 1 /* Hidden */;\n        case 'scroll':\n            return 2 /* Scroll */;\n        case 'scale':\n            return 3 /* Scale */;\n        case 'scaleFree':\n            return 4 /* ScaleFree */;\n        default:\n            return 0 /* Visible */;\n    }\n}\nfunction ParseScrollType(value) {\n    switch (value) {\n        case 'horizontal':\n            return 0 /* Horizontal */;\n        case 'vertical':\n            return 1 /* Vertical */;\n        case 'both':\n            return 2 /* Both */;\n        default:\n            return 1 /* Vertical */;\n    }\n}\nfunction ParseLoaderFillType(value) {\n    switch (value) {\n        case 'none':\n            return 0 /* None */;\n        case 'scale':\n            return 1 /* Scale */;\n        case 'scaleMatchHeight':\n            return 2 /* ScaleMatchHeight */;\n        case 'scaleMatchWidth':\n            return 3 /* ScaleMatchWidth */;\n        case 'scaleFree':\n            return 4 /* ScaleFree */;\n        case 'scaleNoBorder':\n            return 5 /* ScaleNoBorder */;\n        default:\n            return 0 /* None */;\n    }\n}\nfunction ParseListLayoutType(value) {\n    switch (value) {\n        case 'column':\n            return 0 /* SingleColumn */;\n        case 'row':\n            return 1 /* SingleRow */;\n        case 'flow_hz':\n            return 2 /* FlowHorizontal */;\n        case 'flow_vt':\n            return 3 /* FlowVertical */;\n        case 'pagination':\n            return 4 /* Pagination */;\n        default:\n            return 0 /* SingleColumn */;\n    }\n}\nfunction ParseListSelectionMode(value) {\n    switch (value) {\n        case 'single':\n            return 0 /* Single */;\n        case 'multiple':\n            return 1 /* Multiple */;\n        case 'multipleSingleClick':\n            return 2 /* Multiple_SingleClick */;\n        case 'none':\n            return 3 /* None */;\n        default:\n            return 0 /* Single */;\n    }\n}\nfunction ParsePackageItemType(value) {\n    switch (value) {\n        case 'image':\n            return 0 /* Image */;\n        case 'movieclip':\n            return 2 /* MovieClip */;\n        case 'sound':\n            return 3 /* Sound */;\n        case 'component':\n            return 4 /* Component */;\n        case 'swf':\n            return 1 /* Swf */;\n        case 'font':\n            return 6 /* Font */;\n        case 'atlas':\n            return 7 /* Atlas */;\n        default:\n            return 5 /* Misc */;\n    }\n}\nfunction ParseProgressTitleType(value) {\n    switch (value) {\n        case 'percent':\n            return 0 /* Percent */;\n        case 'valueAndmax':\n            return 1 /* ValueAndMax */;\n        case 'value':\n            return 2 /* Value */;\n        case 'max':\n            return 3 /* Max */;\n        default:\n            return 0 /* Percent */;\n    }\n}\nfunction ParseScrollBarDisplayType(value) {\n    switch (value) {\n        case 'default':\n            return 0 /* Default */;\n        case 'visible':\n            return 1 /* Visible */;\n        case 'auto':\n            return 2 /* Auto */;\n        case 'hidden':\n            return 3 /* Hidden */;\n        default:\n            return 0 /* Default */;\n    }\n}\nfunction ParseFlipType(value) {\n    switch (value) {\n        case 'hz':\n            return 1 /* Horizontal */;\n        case 'vt':\n            return 2 /* Vertical */;\n        case 'both':\n            return 3 /* Both */;\n        default:\n            return 0 /* None */;\n    }\n}\nfunction ParseButtonMode(value) {\n    switch (value) {\n        case 'Common':\n            return 0 /* Common */;\n        case 'Check':\n            return 1 /* Check */;\n        case 'Radio':\n            return 2 /* Radio */;\n        default:\n            return 0 /* Common */;\n    }\n}\nfunction ParseAutoSizeType(value) {\n    switch (value) {\n        case 'none':\n            return 0 /* None */;\n        case 'both':\n            return 1 /* Both */;\n        case 'height':\n            return 2 /* Height */;\n        case 'shrink':\n            return 3 /* Shrink */;\n        default:\n            return 0 /* None */;\n    }\n}\nfunction ParseAlignType(value) {\n    switch (value) {\n        case 'left':\n            return \"left\" /* Left */;\n        case 'center':\n            return \"center\" /* Center */;\n        case 'right':\n            return \"right\" /* Right */;\n        default:\n            return \"left\" /* Left */;\n    }\n}\nfunction ParseVertAlignType(value) {\n    switch (value) {\n        case 'top':\n            return 0 /* Top */;\n        case 'middle':\n            return 1 /* Middle */;\n        case 'bottom':\n            return 2 /* Bottom */;\n        default:\n            return 0 /* Top */;\n    }\n}\nfunction ParseListChildrenRenderOrder(value) {\n    switch (value) {\n        case 'ascent':\n            return 0 /* Ascent */;\n        case 'descent':\n            return 1 /* Descent */;\n        case 'arch':\n            return 2 /* Arch */;\n        default:\n            return 0 /* Ascent */;\n    }\n}\nlet easeMap = {\n    Linear: createjs.Ease.linear,\n    'Elastic.In': createjs.Ease.elasticIn,\n    'Elastic.Out': createjs.Ease.elasticOut,\n    'Elastic.InOut': createjs.Ease.elasticInOut,\n    'Quad.In': createjs.Ease.quadIn,\n    'Quad.Out': createjs.Ease.quadOut,\n    'Quad.InOut': createjs.Ease.quadInOut,\n    'Cube.In': createjs.Ease.cubicIn,\n    'Cube.Out': createjs.Ease.cubicOut,\n    'Cube.InOut': createjs.Ease.cubicInOut,\n    'Quart.In': createjs.Ease.quartIn,\n    'Quart.Out': createjs.Ease.quartOut,\n    'Quart.InOut': createjs.Ease.quartInOut,\n    'Quint.In': createjs.Ease.quintIn,\n    'Quint.Out': createjs.Ease.quintOut,\n    'Quint.InOut': createjs.Ease.quintInOut,\n    'Sine.In': createjs.Ease.sineIn,\n    'Sine.Out': createjs.Ease.sineOut,\n    'Sine.InOut': createjs.Ease.sineInOut,\n    'Bounce.In': createjs.Ease.bounceIn,\n    'Bounce.Out': createjs.Ease.bounceOut,\n    'Bounce.InOut': createjs.Ease.bounceInOut,\n    'Circ.In': createjs.Ease.circIn,\n    'Circ.Out': createjs.Ease.circOut,\n    'Circ.InOut': createjs.Ease.circInOut,\n    'Expo.In': createjs.Ease.quartIn,\n    'Expo.Out': createjs.Ease.quartOut,\n    'Expo.InOut': createjs.Ease.quartInOut,\n    'Back.In': createjs.Ease.backIn,\n    'Back.Out': createjs.Ease.backOut,\n    'Back.InOut': createjs.Ease.backInOut\n};\nfunction ParseEaseType(name) {\n    return easeMap[name] || easeMap['Linear'];\n}\n\n/**global ui configuration */\nclass UIConfig {\n}\n/**default font name of your project. */\nUIConfig.defaultFont = \"Arial\";\n/** modal layer background configuration. */\nUIConfig.modalLayerColor = \"#333333\";\nUIConfig.modalLayerAlpha = 0.2;\nUIConfig.buttonSoundVolumeScale = 1;\n/** scrolling distance per action in pixel*/\nUIConfig.defaultScrollSpeed = 25;\n/** default scrollbar display mode. It's recommended to set ScrollBarDisplayType.Visible for Desktop environment and ScrollBarDisplayType.Auto for mobile environment.*/\nUIConfig.defaultScrollBarDisplay = 1 /* Visible */;\n/** allow user to drag the content of a container. Set to true for mobile is recommended.*/\nUIConfig.defaultScrollTouchEffect = true;\n/** enable bounce effect when the scrolling reaches to the edge of a container. Set to true for mobile is recommended.*/\nUIConfig.defaultScrollBounceEffect = true;\n/** Deceleration ratio of scrollpane when its in touch dragging.*/\nUIConfig.defaultScrollDecelerationRate = .967;\n/** maximum count of items to be displayed in the visible viewport of the GCombobox.*/\nUIConfig.defaultComboBoxVisibleItemCount = 10;\n/** the finger moving threshold in pixel to trigger the scrolling action.*/\nUIConfig.touchScrollSensitivity = 20;\n/** the finger moving threshold in pixel to trigger the dragging event.*/\nUIConfig.touchDragSensitivity = 10;\n/** auto bring the window you clicked to the topmost level of the GRoot children list.*/\nUIConfig.bringWindowToFrontOnClick = true;\n\nclass GearBase {\n    constructor(owner) {\n        this.$lockToken = 0;\n        this.$owner = owner;\n        this.$easeType = ParseEaseType('Quad.Out');\n        this.$tweenTime = 0.3;\n        this.$tweenDelay = 0;\n    }\n    get controller() {\n        return this.$controller;\n    }\n    set controller(val) {\n        if (val != this.$controller) {\n            this.$controller = val;\n            if (this.$controller)\n                this.init();\n        }\n    }\n    get tween() {\n        return this.$tween;\n    }\n    set tween(val) {\n        this.$tween = val;\n    }\n    get tweenDelay() {\n        return this.$tweenDelay;\n    }\n    set tweenDelay(val) {\n        this.$tweenDelay = val;\n    }\n    get tweenTime() {\n        return this.$tweenTime;\n    }\n    set tweenTime(value) {\n        this.$tweenTime = value;\n    }\n    get easeType() {\n        return this.$easeType;\n    }\n    set easeType(value) {\n        this.$easeType = value;\n    }\n    setup(xml) {\n        this.$controller = this.$owner.parent.getController(xml.attributes.controller);\n        if (this.$controller == null)\n            return;\n        this.init();\n        let str;\n        str = xml.attributes.tween;\n        if (str)\n            this.$tween = true;\n        str = xml.attributes.ease;\n        if (str)\n            this.$easeType = ParseEaseType(str);\n        str = xml.attributes.duration;\n        if (str)\n            this.$tweenTime = parseFloat(str);\n        str = xml.attributes.delay;\n        if (str)\n            this.$tweenDelay = parseFloat(str);\n        if (this['$vid'] != null) {\n            str = xml.attributes.pages;\n            if (str)\n                this['pages'] = str.split(',');\n        }\n        else {\n            let pages;\n            let values;\n            str = xml.attributes.pages;\n            if (str)\n                pages = str.split(',');\n            str = xml.attributes.values;\n            if (str)\n                values = str.split('|');\n            if (pages && values) {\n                values.forEach((s, i) => {\n                    this.addStatus(pages[i], s);\n                });\n            }\n            str = xml.attributes.default;\n            if (str)\n                this.addStatus(null, str);\n        }\n    }\n    updateFromRelations(dx, dy) { }\n    addStatus(pageId, value) { }\n    init() { }\n    apply() { }\n    updateState() { }\n}\nGearBase.disableAllTweenEffect = false;\n\nclass GearDisplay extends GearBase {\n    constructor(owner) {\n        super(owner);\n        this.$vid = 0;\n        this.$lockToken = 1;\n    }\n    init() {\n        this.pages = null;\n    }\n    lock() {\n        this.$vid++;\n        return this.$lockToken;\n    }\n    release(token) {\n        if (token == this.$lockToken)\n            this.$vid--;\n    }\n    get connected() {\n        return this.controller == null || this.$vid > 0;\n    }\n    apply() {\n        this.$lockToken++;\n        if (this.$lockToken <= 0)\n            this.$lockToken = 1;\n        if (this.pages == null ||\n            this.pages.length == 0 ||\n            this.pages.indexOf(this.$controller.selectedPageId) != -1)\n            this.$vid = 1;\n        else\n            this.$vid = 0;\n    }\n}\n\nclass BMGlyph {\n    constructor() {\n        this.x = 0;\n        this.y = 0;\n        this.offsetX = 0;\n        this.offsetY = 0;\n        this.width = 0;\n        this.height = 0;\n        this.advance = 0;\n        this.lineHeight = 0;\n        this.channel = 0;\n    }\n}\nclass BitmapFont {\n    constructor() {\n        this.size = 0;\n        this.glyphs = {};\n    }\n}\n\nclass Frame {\n    constructor() {\n        this.addDelay = 0;\n    }\n}\n\nclass AssetLoader extends createjs.LoadQueue {\n    constructor(preferXHR, basePath, crossOrigin) {\n        super(preferXHR, basePath);\n        this.on('complete', this._onComplete, this);\n    }\n    _onComplete(event) {\n        var loader = event.target;\n        var result = loader[\"_loadedResults\"];\n        AssetLoader.addResources(result);\n    }\n    ;\n    static get resourcesPool() {\n        return AssetLoader.$resources;\n    }\n    static destroyResource(key) {\n        let res = AssetLoader.$resources[key];\n        if (res) {\n            delete AssetLoader.$resources[key];\n        }\n    }\n    static addResources(res) {\n        if (!res)\n            return;\n        for (let key in res) //override the item which has same key name\n            AssetLoader.$resources[key] = res[key];\n    }\n}\nAssetLoader.$resources = {};\n\nclass Endian {\n}\nEndian.LITTLE_ENDIAN = \"littleEndian\";\nEndian.BIG_ENDIAN = \"bigEndian\";\nclass ByteArray {\n    constructor(buffer, bufferExtSize = 0) {\n        this.bufferExtSize = 0; //Buffer expansion size\n        this.EOF_byte = -1;\n        this.EOF_code_point = -1;\n        if (bufferExtSize < 0) {\n            bufferExtSize = 0;\n        }\n        this.bufferExtSize = bufferExtSize;\n        let bytes, wpos = 0;\n        if (buffer) { //有数据，则可写字节数从字节尾开始\n            let uint8;\n            if (buffer instanceof Uint8Array) {\n                uint8 = buffer;\n                wpos = buffer.length;\n            }\n            else {\n                wpos = buffer.byteLength;\n                uint8 = new Uint8Array(buffer);\n            }\n            if (bufferExtSize == 0) {\n                bytes = new Uint8Array(wpos);\n            }\n            else {\n                let multi = (wpos / bufferExtSize | 0) + 1;\n                bytes = new Uint8Array(multi * bufferExtSize);\n            }\n            bytes.set(uint8);\n        }\n        else {\n            bytes = new Uint8Array(bufferExtSize);\n        }\n        this.write_position = wpos;\n        this._position = 0;\n        this._bytes = bytes;\n        this.data = new DataView(bytes.buffer);\n        this.endian = Endian.BIG_ENDIAN;\n    }\n    get endian() {\n        return this.$endian == 0 /* LITTLE_ENDIAN */ ? Endian.LITTLE_ENDIAN : Endian.BIG_ENDIAN;\n    }\n    set endian(value) {\n        this.$endian = value == Endian.LITTLE_ENDIAN ? 0 /* LITTLE_ENDIAN */ : 1 /* BIG_ENDIAN */;\n    }\n    get readAvailable() {\n        return this.write_position - this._position;\n    }\n    get buffer() {\n        return this.data.buffer.slice(0, this.write_position);\n    }\n    get rawBuffer() {\n        return this.data.buffer;\n    }\n    set buffer(value) {\n        let wpos = value.byteLength;\n        let uint8 = new Uint8Array(value);\n        let bufferExtSize = this.bufferExtSize;\n        let bytes;\n        if (bufferExtSize == 0) {\n            bytes = new Uint8Array(wpos);\n        }\n        else {\n            let multi = (wpos / bufferExtSize | 0) + 1;\n            bytes = new Uint8Array(multi * bufferExtSize);\n        }\n        bytes.set(uint8);\n        this.write_position = wpos;\n        this._bytes = bytes;\n        this.data = new DataView(bytes.buffer);\n    }\n    get bytes() {\n        return this._bytes;\n    }\n    get dataView() {\n        return this.data;\n    }\n    set dataView(value) {\n        this.buffer = value.buffer;\n    }\n    get bufferOffset() {\n        return this.data.byteOffset;\n    }\n    get position() {\n        return this._position;\n    }\n    set position(value) {\n        this._position = value;\n        if (value > this.write_position) {\n            this.write_position = value;\n        }\n    }\n    get length() {\n        return this.write_position;\n    }\n    set length(value) {\n        this.write_position = value;\n        if (this.data.byteLength > value) {\n            this._position = value;\n        }\n        this._validateBuffer(value);\n    }\n    _validateBuffer(value) {\n        if (this.data.byteLength < value) {\n            let be = this.bufferExtSize;\n            let tmp;\n            if (be == 0) {\n                tmp = new Uint8Array(value);\n            }\n            else {\n                let nLen = ((value / be >> 0) + 1) * be;\n                tmp = new Uint8Array(nLen);\n            }\n            tmp.set(this._bytes);\n            this._bytes = tmp;\n            this.data = new DataView(tmp.buffer);\n        }\n    }\n    get bytesAvailable() {\n        return this.data.byteLength - this._position;\n    }\n    clear() {\n        let buffer = new ArrayBuffer(this.bufferExtSize);\n        this.data = new DataView(buffer);\n        this._bytes = new Uint8Array(buffer);\n        this._position = 0;\n        this.write_position = 0;\n    }\n    readBoolean() {\n        if (this.validate(1 /* SIZE_OF_BOOLEAN */))\n            return !!this._bytes[this.position++];\n    }\n    readByte() {\n        if (this.validate(1 /* SIZE_OF_INT8 */))\n            return this.data.getInt8(this.position++);\n    }\n    readBytes(bytes, offset = 0, length = 0) {\n        if (!bytes) { //由于bytes不返回，所以new新的无意义\n            return;\n        }\n        let pos = this._position;\n        let available = this.write_position - pos;\n        if (available < 0) {\n            // egret.$error(1025);\n            return;\n        }\n        if (length == 0) {\n            length = available;\n        }\n        else if (length > available) {\n            // egret.$error(1025);\n            return;\n        }\n        const position = bytes._position;\n        bytes._position = 0;\n        bytes.validateBuffer(offset + length);\n        bytes._position = position;\n        bytes._bytes.set(this._bytes.subarray(pos, pos + length), offset);\n        this.position += length;\n    }\n    readDouble() {\n        if (this.validate(8 /* SIZE_OF_FLOAT64 */)) {\n            let value = this.data.getFloat64(this._position, this.$endian == 0 /* LITTLE_ENDIAN */);\n            this.position += 8 /* SIZE_OF_FLOAT64 */;\n            return value;\n        }\n    }\n    readFloat() {\n        if (this.validate(4 /* SIZE_OF_FLOAT32 */)) {\n            let value = this.data.getFloat32(this._position, this.$endian == 0 /* LITTLE_ENDIAN */);\n            this.position += 4 /* SIZE_OF_FLOAT32 */;\n            return value;\n        }\n    }\n    readInt() {\n        if (this.validate(4 /* SIZE_OF_INT32 */)) {\n            let value = this.data.getInt32(this._position, this.$endian == 0 /* LITTLE_ENDIAN */);\n            this.position += 4 /* SIZE_OF_INT32 */;\n            return value;\n        }\n    }\n    readShort() {\n        if (this.validate(2 /* SIZE_OF_INT16 */)) {\n            let value = this.data.getInt16(this._position, this.$endian == 0 /* LITTLE_ENDIAN */);\n            this.position += 2 /* SIZE_OF_INT16 */;\n            return value;\n        }\n    }\n    readUnsignedByte() {\n        if (this.validate(1 /* SIZE_OF_UINT8 */))\n            return this._bytes[this.position++];\n    }\n    readUnsignedInt() {\n        if (this.validate(4 /* SIZE_OF_UINT32 */)) {\n            let value = this.data.getUint32(this._position, this.$endian == 0 /* LITTLE_ENDIAN */);\n            this.position += 4 /* SIZE_OF_UINT32 */;\n            return value;\n        }\n    }\n    readUnsignedShort() {\n        if (this.validate(2 /* SIZE_OF_UINT16 */)) {\n            let value = this.data.getUint16(this._position, this.$endian == 0 /* LITTLE_ENDIAN */);\n            this.position += 2 /* SIZE_OF_UINT16 */;\n            return value;\n        }\n    }\n    readUTF() {\n        let length = this.readUnsignedShort();\n        if (length > 0) {\n            return this.readUTFBytes(length);\n        }\n        else {\n            return \"\";\n        }\n    }\n    readUTFBytes(length) {\n        if (!this.validate(length)) {\n            return;\n        }\n        let data = this.data;\n        let bytes = new Uint8Array(data.buffer, data.byteOffset + this._position, length);\n        this.position += length;\n        return this.decodeUTF8(bytes);\n    }\n    writeBoolean(value) {\n        this.validateBuffer(1 /* SIZE_OF_BOOLEAN */);\n        this._bytes[this.position++] = +value;\n    }\n    writeByte(value) {\n        this.validateBuffer(1 /* SIZE_OF_INT8 */);\n        this._bytes[this.position++] = value & 0xff;\n    }\n    writeBytes(bytes, offset = 0, length = 0) {\n        let writeLength;\n        if (offset < 0) {\n            return;\n        }\n        if (length < 0) {\n            return;\n        }\n        else if (length == 0) {\n            writeLength = bytes.length - offset;\n        }\n        else {\n            writeLength = Math.min(bytes.length - offset, length);\n        }\n        if (writeLength > 0) {\n            this.validateBuffer(writeLength);\n            this._bytes.set(bytes._bytes.subarray(offset, offset + writeLength), this._position);\n            this.position = this._position + writeLength;\n        }\n    }\n    writeDouble(value) {\n        this.validateBuffer(8 /* SIZE_OF_FLOAT64 */);\n        this.data.setFloat64(this._position, value, this.$endian == 0 /* LITTLE_ENDIAN */);\n        this.position += 8 /* SIZE_OF_FLOAT64 */;\n    }\n    writeFloat(value) {\n        this.validateBuffer(4 /* SIZE_OF_FLOAT32 */);\n        this.data.setFloat32(this._position, value, this.$endian == 0 /* LITTLE_ENDIAN */);\n        this.position += 4 /* SIZE_OF_FLOAT32 */;\n    }\n    writeInt(value) {\n        this.validateBuffer(4 /* SIZE_OF_INT32 */);\n        this.data.setInt32(this._position, value, this.$endian == 0 /* LITTLE_ENDIAN */);\n        this.position += 4 /* SIZE_OF_INT32 */;\n    }\n    writeShort(value) {\n        this.validateBuffer(2 /* SIZE_OF_INT16 */);\n        this.data.setInt16(this._position, value, this.$endian == 0 /* LITTLE_ENDIAN */);\n        this.position += 2 /* SIZE_OF_INT16 */;\n    }\n    writeUnsignedInt(value) {\n        this.validateBuffer(4 /* SIZE_OF_UINT32 */);\n        this.data.setUint32(this._position, value, this.$endian == 0 /* LITTLE_ENDIAN */);\n        this.position += 4 /* SIZE_OF_UINT32 */;\n    }\n    writeUnsignedShort(value) {\n        this.validateBuffer(2 /* SIZE_OF_UINT16 */);\n        this.data.setUint16(this._position, value, this.$endian == 0 /* LITTLE_ENDIAN */);\n        this.position += 2 /* SIZE_OF_UINT16 */;\n    }\n    writeUTF(value) {\n        let utf8bytes = this.encodeUTF8(value);\n        let length = utf8bytes.length;\n        this.validateBuffer(2 /* SIZE_OF_UINT16 */ + length);\n        this.data.setUint16(this._position, length, this.$endian == 0 /* LITTLE_ENDIAN */);\n        this.position += 2 /* SIZE_OF_UINT16 */;\n        this._writeUint8Array(utf8bytes, false);\n    }\n    writeUTFBytes(value) {\n        this._writeUint8Array(this.encodeUTF8(value));\n    }\n    toString() {\n        return \"[ByteArray] length:\" + this.length + \", bytesAvailable:\" + this.bytesAvailable;\n    }\n    _writeUint8Array(bytes, validateBuffer = true) {\n        let pos = this._position;\n        let npos = pos + bytes.length;\n        if (validateBuffer) {\n            this.validateBuffer(npos);\n        }\n        this.bytes.set(bytes, pos);\n        this.position = npos;\n    }\n    validate(len) {\n        let bl = this._bytes.length;\n        if (bl > 0 && this._position + len <= bl) {\n            return true;\n        }\n    }\n    /*  PRIVATE METHODS   */\n    validateBuffer(len) {\n        this.write_position = len > this.write_position ? len : this.write_position;\n        len += this._position;\n        this._validateBuffer(len);\n    }\n    encodeUTF8(str) {\n        let pos = 0;\n        let codePoints = this.stringToCodePoints(str);\n        let outputBytes = [];\n        while (codePoints.length > pos) {\n            let code_point = codePoints[pos++];\n            if (this.inRange(code_point, 0xD800, 0xDFFF)) {\n                this.encoderError(code_point);\n            }\n            else if (this.inRange(code_point, 0x0000, 0x007f)) {\n                outputBytes.push(code_point);\n            }\n            else {\n                let count, offset;\n                if (this.inRange(code_point, 0x0080, 0x07FF)) {\n                    count = 1;\n                    offset = 0xC0;\n                }\n                else if (this.inRange(code_point, 0x0800, 0xFFFF)) {\n                    count = 2;\n                    offset = 0xE0;\n                }\n                else if (this.inRange(code_point, 0x10000, 0x10FFFF)) {\n                    count = 3;\n                    offset = 0xF0;\n                }\n                outputBytes.push(this.div(code_point, Math.pow(64, count)) + offset);\n                while (count > 0) {\n                    let temp = this.div(code_point, Math.pow(64, count - 1));\n                    outputBytes.push(0x80 + (temp % 64));\n                    count -= 1;\n                }\n            }\n        }\n        return new Uint8Array(outputBytes);\n    }\n    decodeUTF8(data) {\n        let fatal = false;\n        let pos = 0;\n        let result = \"\";\n        let code_point;\n        let utf8_code_point = 0;\n        let utf8_bytes_needed = 0;\n        let utf8_bytes_seen = 0;\n        let utf8_lower_boundary = 0;\n        while (data.length > pos) {\n            let _byte = data[pos++];\n            if (_byte == this.EOF_byte) {\n                if (utf8_bytes_needed != 0) {\n                    code_point = this.decoderError(fatal);\n                }\n                else {\n                    code_point = this.EOF_code_point;\n                }\n            }\n            else {\n                if (utf8_bytes_needed == 0) {\n                    if (this.inRange(_byte, 0x00, 0x7F)) {\n                        code_point = _byte;\n                    }\n                    else {\n                        if (this.inRange(_byte, 0xC2, 0xDF)) {\n                            utf8_bytes_needed = 1;\n                            utf8_lower_boundary = 0x80;\n                            utf8_code_point = _byte - 0xC0;\n                        }\n                        else if (this.inRange(_byte, 0xE0, 0xEF)) {\n                            utf8_bytes_needed = 2;\n                            utf8_lower_boundary = 0x800;\n                            utf8_code_point = _byte - 0xE0;\n                        }\n                        else if (this.inRange(_byte, 0xF0, 0xF4)) {\n                            utf8_bytes_needed = 3;\n                            utf8_lower_boundary = 0x10000;\n                            utf8_code_point = _byte - 0xF0;\n                        }\n                        else {\n                            this.decoderError(fatal);\n                        }\n                        utf8_code_point = utf8_code_point * Math.pow(64, utf8_bytes_needed);\n                        code_point = null;\n                    }\n                }\n                else if (!this.inRange(_byte, 0x80, 0xBF)) {\n                    utf8_code_point = 0;\n                    utf8_bytes_needed = 0;\n                    utf8_bytes_seen = 0;\n                    utf8_lower_boundary = 0;\n                    pos--;\n                    code_point = this.decoderError(fatal, _byte);\n                }\n                else {\n                    utf8_bytes_seen += 1;\n                    utf8_code_point = utf8_code_point + (_byte - 0x80) * Math.pow(64, utf8_bytes_needed - utf8_bytes_seen);\n                    if (utf8_bytes_seen !== utf8_bytes_needed) {\n                        code_point = null;\n                    }\n                    else {\n                        let cp = utf8_code_point;\n                        let lower_boundary = utf8_lower_boundary;\n                        utf8_code_point = 0;\n                        utf8_bytes_needed = 0;\n                        utf8_bytes_seen = 0;\n                        utf8_lower_boundary = 0;\n                        if (this.inRange(cp, lower_boundary, 0x10FFFF) && !this.inRange(cp, 0xD800, 0xDFFF)) {\n                            code_point = cp;\n                        }\n                        else {\n                            code_point = this.decoderError(fatal, _byte);\n                        }\n                    }\n                }\n            }\n            //Decode string\n            if (code_point !== null && code_point !== this.EOF_code_point) {\n                if (code_point <= 0xFFFF) {\n                    if (code_point > 0)\n                        result += String.fromCharCode(code_point);\n                }\n                else {\n                    code_point -= 0x10000;\n                    result += String.fromCharCode(0xD800 + ((code_point >> 10) & 0x3ff));\n                    result += String.fromCharCode(0xDC00 + (code_point & 0x3ff));\n                }\n            }\n        }\n        return result;\n    }\n    encoderError(code_point) {\n        // egret.$error(1026, code_point);\n    }\n    decoderError(fatal, opt_code_point) {\n        return opt_code_point || 0xFFFD;\n    }\n    inRange(a, min, max) {\n        return min <= a && a <= max;\n    }\n    div(n, d) {\n        return Math.floor(n / d);\n    }\n    stringToCodePoints(string) {\n        let cps = [];\n        // Based on http://www.w3.org/TR/WebIDL/#idl-DOMString\n        let i = 0, n = string.length;\n        while (i < string.length) {\n            let c = string.charCodeAt(i);\n            if (!this.inRange(c, 0xD800, 0xDFFF)) {\n                cps.push(c);\n            }\n            else if (this.inRange(c, 0xDC00, 0xDFFF)) {\n                cps.push(0xFFFD);\n            }\n            else { // (inRange(c, 0xD800, 0xDBFF))\n                if (i == n - 1) {\n                    cps.push(0xFFFD);\n                }\n                else {\n                    let d = string.charCodeAt(i + 1);\n                    if (this.inRange(d, 0xDC00, 0xDFFF)) {\n                        let a = c & 0x3FF;\n                        let b = d & 0x3FF;\n                        i += 1;\n                        cps.push(0x10000 + (a << 10) + b);\n                    }\n                    else {\n                        cps.push(0xFFFD);\n                    }\n                }\n            }\n            i += 1;\n        }\n        return cps;\n    }\n}\n\nclass RawByte {\n    static inRange(a, min, max) {\n        return min <= a && a <= max;\n    }\n    static decodeUTF8(data) {\n        let pos = 0;\n        let result = \"\";\n        let code_point;\n        let utf8_code_point = 0;\n        let utf8_bytes_needed = 0;\n        let utf8_bytes_seen = 0;\n        let utf8_lower_boundary = 0;\n        while (data.length > pos) {\n            let _byte = data[pos++];\n            if (_byte == -1 /* EOF_byte */) {\n                if (utf8_bytes_needed != 0) {\n                    code_point = 65533 /* Fatal_code_point */;\n                }\n                else {\n                    code_point = -1 /* EOF_code_point */;\n                }\n            }\n            else {\n                if (utf8_bytes_needed == 0) {\n                    if (RawByte.inRange(_byte, 0x00, 0x7F)) {\n                        code_point = _byte;\n                    }\n                    else {\n                        if (RawByte.inRange(_byte, 0xC2, 0xDF)) {\n                            utf8_bytes_needed = 1;\n                            utf8_lower_boundary = 0x80;\n                            utf8_code_point = _byte - 0xC0;\n                        }\n                        else if (RawByte.inRange(_byte, 0xE0, 0xEF)) {\n                            utf8_bytes_needed = 2;\n                            utf8_lower_boundary = 0x800;\n                            utf8_code_point = _byte - 0xE0;\n                        }\n                        else if (RawByte.inRange(_byte, 0xF0, 0xF4)) {\n                            utf8_bytes_needed = 3;\n                            utf8_lower_boundary = 0x10000;\n                            utf8_code_point = _byte - 0xF0;\n                        }\n                        else {\n                            throw new Error(\"failed to decode the raw binary data\");\n                        }\n                        utf8_code_point = utf8_code_point * Math.pow(64, utf8_bytes_needed);\n                        code_point = null;\n                    }\n                }\n                else if (!RawByte.inRange(_byte, 0x80, 0xBF)) {\n                    utf8_code_point = 0;\n                    utf8_bytes_needed = 0;\n                    utf8_bytes_seen = 0;\n                    utf8_lower_boundary = 0;\n                    pos--;\n                    code_point = 65533 /* Fatal_code_point */;\n                }\n                else {\n                    utf8_bytes_seen += 1;\n                    utf8_code_point = utf8_code_point + (_byte - 0x80) * Math.pow(64, utf8_bytes_needed - utf8_bytes_seen);\n                    if (utf8_bytes_seen !== utf8_bytes_needed) {\n                        code_point = null;\n                    }\n                    else {\n                        let cp = utf8_code_point;\n                        let lower_boundary = utf8_lower_boundary;\n                        utf8_code_point = 0;\n                        utf8_bytes_needed = 0;\n                        utf8_bytes_seen = 0;\n                        utf8_lower_boundary = 0;\n                        if (RawByte.inRange(cp, lower_boundary, 0x10FFFF) && !this.inRange(cp, 0xD800, 0xDFFF)) {\n                            code_point = cp;\n                        }\n                        else {\n                            code_point = _byte;\n                        }\n                    }\n                }\n            }\n            //Decode string\n            if (code_point !== null && code_point !== -1 /* EOF_code_point */) {\n                if (code_point <= 0xFFFF) {\n                    if (code_point > 0)\n                        result += String.fromCharCode(code_point);\n                }\n                else {\n                    code_point -= 0x10000;\n                    result += String.fromCharCode(0xD800 + ((code_point >> 10) & 0x3ff));\n                    result += String.fromCharCode(0xDC00 + (code_point & 0x3ff));\n                }\n            }\n        }\n        return result;\n    }\n}\n\nvar BufferType;\n(function (BufferType) {\n    BufferType[BufferType[\"BLOCK\"] = 0] = \"BLOCK\";\n    BufferType[BufferType[\"ADAPTIVE\"] = 1] = \"ADAPTIVE\";\n})(BufferType || (BufferType = {}));\n/** @define {number} buffer block size. */\nconst ZLIB_RAW_INFLATE_BUFFER_SIZE = 0x8000; // [ 0x8000 >= ZLIB_BUFFER_BLOCK_SIZE ]\nconst MaxBackwardLength = 32768;\nconst MaxCopyLength = 258;\nconst Order = new Uint16Array([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);\nconst LengthCodeTable = new Uint16Array([\n    0x0003, 0x0004, 0x0005, 0x0006, 0x0007, 0x0008, 0x0009, 0x000a, 0x000b,\n    0x000d, 0x000f, 0x0011, 0x0013, 0x0017, 0x001b, 0x001f, 0x0023, 0x002b,\n    0x0033, 0x003b, 0x0043, 0x0053, 0x0063, 0x0073, 0x0083, 0x00a3, 0x00c3,\n    0x00e3, 0x0102, 0x0102, 0x0102\n]);\nconst LengthExtraTable = new Uint8Array([\n    0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5,\n    5, 5, 0, 0, 0\n]);\nconst DistCodeTable = new Uint16Array([\n    0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0007, 0x0009, 0x000d, 0x0011,\n    0x0019, 0x0021, 0x0031, 0x0041, 0x0061, 0x0081, 0x00c1, 0x0101, 0x0181,\n    0x0201, 0x0301, 0x0401, 0x0601, 0x0801, 0x0c01, 0x1001, 0x1801, 0x2001,\n    0x3001, 0x4001, 0x6001\n]);\nconst DistExtraTable = new Uint8Array([\n    0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11,\n    11, 12, 12, 13, 13\n]);\nconst buildHuffmanTable = (lengths) => {\n    /** @type {number} length list size. */\n    var listSize = lengths.length;\n    /** @type {number} max code length for table size. */\n    var maxCodeLength = 0;\n    /** @type {number} min code length for table size. */\n    var minCodeLength = Number.POSITIVE_INFINITY;\n    /** @type {number} table size. */\n    var size;\n    /** @type {!(Array|Uint8Array)} huffman code table. */\n    var table;\n    /** @type {number} bit length. */\n    var bitLength;\n    /** @type {number} huffman code. */\n    var code;\n    /**\n     * サイズが 2^maxlength 個のテーブルを埋めるためのスキップ長.\n     * @type {number} skip length for table filling.\n     */\n    var skip;\n    /** @type {number} reversed code. */\n    var reversed;\n    /** @type {number} reverse temp. */\n    var rtemp;\n    /** @type {number} loop counter. */\n    var i;\n    /** @type {number} loop limit. */\n    var il;\n    /** @type {number} loop counter. */\n    var j;\n    /** @type {number} table value. */\n    var value;\n    // Math.max は遅いので最長の値は for-loop で取得する\n    for (i = 0, il = listSize; i < il; ++i) {\n        if (lengths[i] > maxCodeLength) {\n            maxCodeLength = lengths[i];\n        }\n        if (lengths[i] < minCodeLength) {\n            minCodeLength = lengths[i];\n        }\n    }\n    size = 1 << maxCodeLength;\n    table = new Uint32Array(size);\n    // ビット長の短い順からハフマン符号を割り当てる\n    for (bitLength = 1, code = 0, skip = 2; bitLength <= maxCodeLength;) {\n        for (i = 0; i < listSize; ++i) {\n            if (lengths[i] === bitLength) {\n                // ビットオーダーが逆になるためビット長分並びを反転する\n                for (reversed = 0, rtemp = code, j = 0; j < bitLength; ++j) {\n                    reversed = (reversed << 1) | (rtemp & 1);\n                    rtemp >>= 1;\n                }\n                // 最大ビット長をもとにテーブルを作るため、\n                // 最大ビット長以外では 0 / 1 どちらでも良い箇所ができる\n                // そのどちらでも良い場所は同じ値で埋めることで\n                // 本来のビット長以上のビット数取得しても問題が起こらないようにする\n                value = (bitLength << 16) | i;\n                for (j = reversed; j < size; j += skip) {\n                    table[j] = value;\n                }\n                ++code;\n            }\n        }\n        // 次のビット長へ\n        ++bitLength;\n        code <<= 1;\n        skip <<= 1;\n    }\n    return [table, maxCodeLength, minCodeLength];\n};\nconst FixedLiteralLengthTable = (() => {\n    let lengths = new Uint8Array(288);\n    for (let i = 0, il = lengths.length; i < il; ++i) {\n        lengths[i] =\n            (i <= 143) ? 8 :\n                (i <= 255) ? 9 :\n                    (i <= 279) ? 7 :\n                        8;\n    }\n    return buildHuffmanTable(lengths)[0];\n})();\nconst FixedDistanceTable = (() => {\n    let lengths = new Uint8Array(30);\n    for (let i = 0, il = lengths.length; i < il; ++i) {\n        lengths[i] = 5;\n    }\n    return buildHuffmanTable(lengths);\n})();\nclass RawInflate {\n    constructor(input, opt_params) {\n        this.blocks = [];\n        this.bufferSize = ZLIB_RAW_INFLATE_BUFFER_SIZE;\n        this.totalpos = 0;\n        this.ip = 0;\n        this.bitsbuf = 0;\n        this.bitsbuflen = 0;\n        this.input = new Uint8Array(input);\n        this.bfinal = false;\n        this.bufferType = BufferType.ADAPTIVE;\n        this.resize = false;\n        // option parameters\n        if (opt_params) {\n            if (opt_params['index']) {\n                this.ip = opt_params['index'];\n            }\n            if (opt_params['bufferSize']) {\n                this.bufferSize = opt_params['bufferSize'];\n            }\n            if (opt_params['bufferType']) {\n                this.bufferType = opt_params['bufferType'];\n            }\n            if (opt_params['resize']) {\n                this.resize = opt_params['resize'];\n            }\n        }\n        // initialize\n        switch (this.bufferType) {\n            case BufferType.BLOCK:\n                this.op = MaxBackwardLength;\n                this.output = new Uint8Array(MaxBackwardLength + this.bufferSize + MaxCopyLength);\n                break;\n            case BufferType.ADAPTIVE:\n                this.op = 0;\n                this.output = new Uint8Array(this.bufferSize);\n                break;\n            default:\n                throw new Error('invalid inflate mode');\n        }\n    }\n    decompress() {\n        while (!this.bfinal) {\n            this.parseBlock();\n        }\n        switch (this.bufferType) {\n            case BufferType.BLOCK:\n                return this.concatBufferBlock();\n            case BufferType.ADAPTIVE:\n                return this.concatBufferDynamic();\n            default:\n                throw new Error('invalid inflate mode');\n        }\n    }\n    parseBlock() {\n        let hdr = this.readBits(3);\n        if (hdr & 0x1) {\n            this.bfinal = true;\n        }\n        hdr >>>= 1;\n        switch (hdr) {\n            // uncompressed\n            case 0:\n                this.parseUncompressedBlock();\n                break;\n            // fixed huffman\n            case 1:\n                this.parseFixedHuffmanBlock();\n                break;\n            // dynamic huffman\n            case 2:\n                this.parseDynamicHuffmanBlock();\n                break;\n            // reserved or other\n            default:\n                throw new Error('unknown BTYPE: ' + hdr);\n        }\n    }\n    ;\n    readBits(length) {\n        let bitsbuf = this.bitsbuf;\n        let bitsbuflen = this.bitsbuflen;\n        let input = this.input;\n        let ip = this.ip;\n        let inputLength = input.length;\n        let octet;\n        if (ip + ((length - bitsbuflen + 7) >> 3) >= inputLength) {\n            throw new Error('input buffer is broken');\n        }\n        // not enough buffer\n        while (bitsbuflen < length) {\n            bitsbuf |= input[ip++] << bitsbuflen;\n            bitsbuflen += 8;\n        }\n        // output byte\n        octet = bitsbuf & /* MASK */ ((1 << length) - 1);\n        bitsbuf >>>= length;\n        bitsbuflen -= length;\n        this.bitsbuf = bitsbuf;\n        this.bitsbuflen = bitsbuflen;\n        this.ip = ip;\n        return octet;\n    }\n    ;\n    readCodeByTable(table) {\n        let bitsbuf = this.bitsbuf;\n        let bitsbuflen = this.bitsbuflen;\n        let input = this.input;\n        let ip = this.ip;\n        /** @type {number} */\n        let inputLength = input.length;\n        /** @type {!(Array.<number>|Uint8Array)} huffman code table */\n        let codeTable = table[0];\n        /** @type {number} */\n        let maxCodeLength = table[1];\n        /** @type {number} code length & code (16bit, 16bit) */\n        let codeWithLength;\n        /** @type {number} code bits length */\n        let codeLength;\n        // not enough buffer\n        while (bitsbuflen < maxCodeLength) {\n            if (ip >= inputLength) {\n                break;\n            }\n            bitsbuf |= input[ip++] << bitsbuflen;\n            bitsbuflen += 8;\n        }\n        // read max length\n        codeWithLength = codeTable[bitsbuf & ((1 << maxCodeLength) - 1)];\n        codeLength = codeWithLength >>> 16;\n        if (codeLength > bitsbuflen) {\n            throw new Error('invalid code length: ' + codeLength);\n        }\n        this.bitsbuf = bitsbuf >> codeLength;\n        this.bitsbuflen = bitsbuflen - codeLength;\n        this.ip = ip;\n        return codeWithLength & 0xffff;\n    }\n    ;\n    parseUncompressedBlock() {\n        let input = this.input;\n        let ip = this.ip;\n        let output = this.output;\n        let op = this.op;\n        /** @type {number} */\n        let inputLength = input.length;\n        /** @type {number} block length */\n        let len;\n        /** @type {number} number for check block length */\n        let nlen;\n        /** @type {number} output buffer length */\n        let olength = output.length;\n        /** @type {number} copy counter */\n        let preCopy;\n        // skip buffered header bits\n        this.bitsbuf = 0;\n        this.bitsbuflen = 0;\n        // len\n        if (ip + 1 >= inputLength) {\n            throw new Error('invalid uncompressed block header: LEN');\n        }\n        len = input[ip++] | (input[ip++] << 8);\n        // nlen\n        if (ip + 1 >= inputLength) {\n            throw new Error('invalid uncompressed block header: NLEN');\n        }\n        nlen = input[ip++] | (input[ip++] << 8);\n        // check len & nlen\n        if (len === ~nlen) {\n            throw new Error('invalid uncompressed block header: length verify');\n        }\n        // check size\n        if (ip + len > input.length) {\n            throw new Error('input buffer is broken');\n        }\n        // expand buffer\n        switch (this.bufferType) {\n            case BufferType.BLOCK:\n                // pre copy\n                while (op + len > output.length) {\n                    preCopy = olength - op;\n                    len -= preCopy;\n                    output.set(input.subarray(ip, ip + preCopy), op);\n                    op += preCopy;\n                    ip += preCopy;\n                    this.op = op;\n                    output = this.expandBufferBlock();\n                    op = this.op;\n                }\n                break;\n            case BufferType.ADAPTIVE:\n                while (op + len > output.length) {\n                    output = this.expandBufferAdaptive({ fixRatio: 2 });\n                }\n                break;\n            default:\n                throw new Error('invalid inflate mode');\n        }\n        // copy\n        output.set(input.subarray(ip, ip + len), op);\n        op += len;\n        ip += len;\n        this.ip = ip;\n        this.op = op;\n        this.output = output;\n    }\n    ;\n    parseFixedHuffmanBlock() {\n        switch (this.bufferType) {\n            case BufferType.ADAPTIVE:\n                this.decodeHuffmanAdaptive(FixedLiteralLengthTable, FixedDistanceTable);\n                break;\n            case BufferType.BLOCK:\n                this.decodeHuffmanBlock(FixedLiteralLengthTable, FixedDistanceTable);\n                break;\n            default:\n                throw new Error('invalid inflate mode');\n        }\n    }\n    parseDynamicHuffmanBlock() {\n        /** @type {number} number of literal and length codes. */\n        let hlit = this.readBits(5) + 257;\n        /** @type {number} number of distance codes. */\n        let hdist = this.readBits(5) + 1;\n        /** @type {number} number of code lengths. */\n        let hclen = this.readBits(4) + 4;\n        /** @type {!(Uint8Array|Array.<number>)} code lengths. */\n        let codeLengths = new Uint8Array(Order.length);\n        /** @type {!Array} code lengths table. */\n        let codeLengthsTable;\n        /** @type {!(Uint8Array|Array.<number>)} literal and length code table. */\n        let litlenTable;\n        /** @type {!(Uint8Array|Array.<number>)} distance code table. */\n        let distTable;\n        /** @type {number} */\n        let code;\n        /** @type {number} */\n        let prev;\n        /** @type {number} */\n        let repeat;\n        /** @type {number} loop counter. */\n        let i;\n        /** @type {number} loop limit. */\n        let il;\n        // decode code lengths\n        for (i = 0; i < hclen; ++i) {\n            codeLengths[Order[i]] = this.readBits(3);\n        }\n        // decode length table\n        codeLengthsTable = buildHuffmanTable(codeLengths);\n        let lengthTable = new Uint8Array(hlit + hdist);\n        for (i = 0, il = hlit + hdist; i < il;) {\n            code = this.readCodeByTable(codeLengthsTable);\n            switch (code) {\n                case 16:\n                    repeat = 3 + this.readBits(2);\n                    while (repeat--) {\n                        lengthTable[i++] = prev;\n                    }\n                    break;\n                case 17:\n                    repeat = 3 + this.readBits(3);\n                    while (repeat--) {\n                        lengthTable[i++] = 0;\n                    }\n                    prev = 0;\n                    break;\n                case 18:\n                    repeat = 11 + this.readBits(7);\n                    while (repeat--) {\n                        lengthTable[i++] = 0;\n                    }\n                    prev = 0;\n                    break;\n                default:\n                    lengthTable[i++] = code;\n                    prev = code;\n                    break;\n            }\n        }\n        litlenTable = buildHuffmanTable(lengthTable.subarray(0, hlit));\n        distTable = buildHuffmanTable(lengthTable.subarray(hlit));\n        switch (this.bufferType) {\n            case BufferType.ADAPTIVE:\n                this.decodeHuffmanAdaptive(litlenTable, distTable);\n                break;\n            case BufferType.BLOCK:\n                this.decodeHuffmanBlock(litlenTable, distTable);\n                break;\n            default:\n                throw new Error('invalid inflate mode');\n        }\n    }\n    decodeHuffmanBlock(litlen, dist) {\n        let output = this.output;\n        let op = this.op;\n        this.currentLitlenTable = litlen;\n        /** @type {number} output position limit. */\n        let olength = output.length - MaxCopyLength;\n        /** @type {number} huffman code. */\n        let code;\n        /** @type {number} table index. */\n        let ti;\n        /** @type {number} huffman code distination. */\n        let codeDist;\n        /** @type {number} huffman code length. */\n        let codeLength;\n        let lengthCodeTable = LengthCodeTable;\n        let lengthExtraTable = LengthExtraTable;\n        let distCodeTable = DistCodeTable;\n        let distExtraTable = DistExtraTable;\n        while ((code = this.readCodeByTable(litlen)) !== 256) {\n            // literal\n            if (code < 256) {\n                if (op >= olength) {\n                    this.op = op;\n                    output = this.expandBufferBlock();\n                    op = this.op;\n                }\n                output[op++] = code;\n                continue;\n            }\n            // length code\n            ti = code - 257;\n            codeLength = lengthCodeTable[ti];\n            if (lengthExtraTable[ti] > 0) {\n                codeLength += this.readBits(lengthExtraTable[ti]);\n            }\n            // dist code\n            code = this.readCodeByTable(dist);\n            codeDist = distCodeTable[code];\n            if (distExtraTable[code] > 0) {\n                codeDist += this.readBits(distExtraTable[code]);\n            }\n            // lz77 decode\n            if (op >= olength) {\n                this.op = op;\n                output = this.expandBufferBlock();\n                op = this.op;\n            }\n            while (codeLength--) {\n                output[op] = output[(op++) - codeDist];\n            }\n        }\n        while (this.bitsbuflen >= 8) {\n            this.bitsbuflen -= 8;\n            this.ip--;\n        }\n        this.op = op;\n    }\n    ;\n    decodeHuffmanAdaptive(litlen, dist) {\n        let output = this.output;\n        let op = this.op;\n        this.currentLitlenTable = litlen;\n        /** @type {number} output position limit. */\n        let olength = output.length;\n        /** @type {number} huffman code. */\n        let code;\n        /** @type {number} table index. */\n        let ti;\n        /** @type {number} huffman code distination. */\n        let codeDist;\n        /** @type {number} huffman code length. */\n        let codeLength;\n        let lengthCodeTable = LengthCodeTable;\n        let lengthExtraTable = LengthExtraTable;\n        let distCodeTable = DistCodeTable;\n        let distExtraTable = DistExtraTable;\n        while ((code = this.readCodeByTable(litlen)) !== 256) {\n            // literal\n            if (code < 256) {\n                if (op >= olength) {\n                    output = this.expandBufferAdaptive();\n                    olength = output.length;\n                }\n                output[op++] = code;\n                continue;\n            }\n            // length code\n            ti = code - 257;\n            codeLength = lengthCodeTable[ti];\n            if (lengthExtraTable[ti] > 0) {\n                codeLength += this.readBits(lengthExtraTable[ti]);\n            }\n            // dist code\n            code = this.readCodeByTable(dist);\n            codeDist = distCodeTable[code];\n            if (distExtraTable[code] > 0) {\n                codeDist += this.readBits(distExtraTable[code]);\n            }\n            // lz77 decode\n            if (op + codeLength > olength) {\n                output = this.expandBufferAdaptive();\n                olength = output.length;\n            }\n            while (codeLength--) {\n                output[op] = output[(op++) - codeDist];\n            }\n        }\n        while (this.bitsbuflen >= 8) {\n            this.bitsbuflen -= 8;\n            this.ip--;\n        }\n        this.op = op;\n    }\n    expandBufferBlock() {\n        let buffer = new Uint8Array(this.op - MaxBackwardLength);\n        let backward = this.op - MaxBackwardLength;\n        let output = this.output;\n        // copy to output buffer\n        buffer.set(output.subarray(MaxBackwardLength, buffer.length));\n        this.blocks.push(buffer);\n        this.totalpos += buffer.length;\n        // copy to backward buffer\n        output.set(output.subarray(backward, backward + MaxBackwardLength));\n        this.op = MaxBackwardLength;\n        return output;\n    }\n    expandBufferAdaptive(opt_param) {\n        /** @type {!(Array.<number>|Uint8Array)} store buffer. */\n        let buffer;\n        /** @type {number} expantion ratio. */\n        let ratio = (this.input.length / this.ip + 1) | 0;\n        /** @type {number} maximum number of huffman code. */\n        let maxHuffCode;\n        /** @type {number} new output buffer size. */\n        let newSize;\n        /** @type {number} max inflate size. */\n        let maxInflateSize;\n        let input = this.input;\n        let output = this.output;\n        if (opt_param) {\n            if (typeof opt_param.fixRatio === 'number') {\n                ratio = opt_param.fixRatio;\n            }\n            if (typeof opt_param.addRatio === 'number') {\n                ratio += opt_param.addRatio;\n            }\n        }\n        // calculate new buffer size\n        if (ratio < 2) {\n            maxHuffCode =\n                (input.length - this.ip) / this.currentLitlenTable[2];\n            maxInflateSize = (maxHuffCode / 2 * 258) | 0;\n            newSize = maxInflateSize < output.length ?\n                output.length + maxInflateSize :\n                output.length << 1;\n        }\n        else {\n            newSize = output.length * ratio;\n        }\n        buffer = new Uint8Array(newSize);\n        buffer.set(output);\n        this.output = buffer;\n        return this.output;\n    }\n    ;\n    concatBufferBlock() {\n        /** @type {number} buffer pointer. */\n        let pos = 0;\n        /** @type {number} buffer pointer. */\n        let limit = this.totalpos + (this.op - MaxBackwardLength);\n        /** @type {!(Array.<number>|Uint8Array)} output block array. */\n        let output = this.output;\n        /** @type {!Array} blocks array. */\n        let blocks = this.blocks;\n        /** @type {!(Array.<number>|Uint8Array)} output block array. */\n        let block;\n        /** @type {!(Array.<number>|Uint8Array)} output buffer. */\n        let buffer = new Uint8Array(limit);\n        /** @type {number} loop counter. */\n        let i;\n        /** @type {number} loop limiter. */\n        let il;\n        /** @type {number} loop counter. */\n        let j;\n        /** @type {number} loop limiter. */\n        let jl;\n        // single buffer\n        if (blocks.length === 0) {\n            return this.output.subarray(MaxBackwardLength, this.op);\n        }\n        // copy to buffer\n        for (i = 0, il = blocks.length; i < il; ++i) {\n            block = blocks[i];\n            for (j = 0, jl = block.length; j < jl; ++j) {\n                buffer[pos++] = block[j];\n            }\n        }\n        // current buffer\n        for (i = MaxBackwardLength, il = this.op; i < il; ++i) {\n            buffer[pos++] = output[i];\n        }\n        this.blocks = [];\n        this.buffer = buffer;\n        return this.buffer;\n    }\n    ;\n    concatBufferDynamic() {\n        let buffer;\n        let op = this.op;\n        if (this.resize) {\n            buffer = new Uint8Array(op);\n            buffer.set(this.output.subarray(0, op));\n        }\n        else {\n            buffer = this.output.subarray(0, op);\n        }\n        this.buffer = buffer;\n        return this.buffer;\n    }\n}\n\nclass StringUtil {\n    static encodeHTML(str) {\n        if (!str)\n            return \"\";\n        else\n            return str.replace(\"&\", \"&amp;\").replace(\"<\", \"&lt;\").replace(\">\", \"&gt;\").replace(\"'\", \"&apos;\");\n    }\n    static getFileName(source) {\n        let i = source.lastIndexOf(\"/\");\n        if (i != -1)\n            source = source.substr(i + 1);\n        i = source.lastIndexOf(\"\\\\\");\n        if (i != -1)\n            source = source.substr(i + 1);\n        i = source.lastIndexOf(\".\");\n        if (i != -1)\n            return source.substring(0, i);\n        else\n            return source;\n    }\n    static startsWith(source, str, ignoreCase = false) {\n        if (!source)\n            return false;\n        else if (source.length < str.length)\n            return false;\n        else {\n            source = source.substring(0, str.length);\n            if (!ignoreCase)\n                return source == str;\n            else\n                return source.toLowerCase() == str.toLowerCase();\n        }\n    }\n    static endsWith(source, str, ignoreCase = false) {\n        if (!source)\n            return false;\n        else if (source.length < str.length)\n            return false;\n        else {\n            source = source.substring(source.length - str.length);\n            if (!ignoreCase)\n                return source == str;\n            else\n                return source.toLowerCase() == str.toLowerCase();\n        }\n    }\n    static trim(targetString) {\n        return StringUtil.trimLeft(StringUtil.trimRight(targetString));\n    }\n    static trimLeft(targetString) {\n        let tempChar = \"\";\n        let i;\n        for (i = 0; i < targetString.length; i++) {\n            tempChar = targetString.charAt(i);\n            if (tempChar != \" \" && tempChar != \"\\n\" && tempChar != \"\\r\")\n                break;\n        }\n        return targetString.substr(i);\n    }\n    static trimRight(targetString) {\n        let tempChar = \"\";\n        let i;\n        for (i = targetString.length - 1; i >= 0; i--) {\n            tempChar = targetString.charAt(i);\n            if (tempChar != \" \" && tempChar != \"\\n\" && tempChar != \"\\r\")\n                break;\n        }\n        return targetString.substring(0, i + 1);\n    }\n    static convertToHtmlColor(argb, hasAlpha = false) {\n        let alpha;\n        if (hasAlpha)\n            alpha = (argb >> 24 & 0xFF).toString(16);\n        else\n            alpha = \"\";\n        let red = (argb >> 16 & 0xFF).toString(16);\n        let green = (argb >> 8 & 0xFF).toString(16);\n        let blue = (argb & 0xFF).toString(16);\n        if (alpha.length == 1)\n            alpha = `0${alpha}`;\n        if (red.length == 1)\n            red = `0${red}`;\n        if (green.length == 1)\n            green = `0${green}`;\n        if (blue.length == 1)\n            blue = `0${blue}`;\n        return `#${alpha}${red}${green}${blue}`;\n    }\n    static convertFromHtmlColor(str, hasAlpha = false) {\n        if (str.length < 1)\n            return 0;\n        if (str.charAt(0) == \"#\")\n            str = str.substr(1);\n        if (str.length == 8)\n            return (parseInt(str.substr(0, 2), 16) << 24) + parseInt(str.substr(2), 16);\n        else if (hasAlpha)\n            return 0xFF000000 + parseInt(str, 16);\n        else\n            return parseInt(str, 16);\n    }\n    static convertToRGBA(str) {\n        if (str.charAt(0) == \"#\")\n            str = str.substr(1);\n        let alpha = +(parseInt('0x' + str.slice(0, 2)) / 255).toFixed(2);\n        str = str.substr(2);\n        let r = parseInt(str.substring(0, 2), 16);\n        let g = parseInt(str.substring(2, 4), 16);\n        let b = parseInt(str.substring(4), 16);\n        return createjs.Graphics.getRGB(r, g, b, alpha);\n    }\n    static HEX2RGB(hex) {\n        if (hex.charAt(0) == \"#\")\n            hex = hex.substr(1);\n        if (hex.length === 3) {\n            hex += hex;\n        }\n        return `${this.HEX2DEC(hex.substring(0, 2))},${this.HEX2DEC(hex.substring(2, 4))},${this.HEX2DEC(hex.substring(4))}`;\n    }\n    static HEX2DEC(hex) {\n        return parseInt(hex, 16).toString();\n    }\n}\n\nclass Utils {\n    static deepCopyProperties(target, source, propertyObj) {\n        for (var prop in propertyObj) {\n            if (Array.isArray(source[prop])) {\n                target[prop] = source[prop].slice();\n            }\n            else {\n                target[prop] = source[prop];\n            }\n        }\n    }\n    static fillPath(ctx, points, px, py) {\n        var cnt = points.length;\n        ctx.moveTo(points[0] + px, points[1] + py);\n        for (var i = 2; i < cnt; i += 2) {\n            ctx.lineTo(points[i] + px, points[i + 1] + py);\n        }\n        ctx.lineTo(points[0] + px, points[1] + py);\n    }\n}\nUtils.TextureCache = {};\n\nclass XmlNode {\n    constructor(ele) {\n        this.nodeName = ele.nodeName;\n        this.context = ele;\n        this.type = ele.nodeType;\n        this.text = (this.type == Node.COMMENT_NODE || this.type == Node.TEXT_NODE) ? this.context.textContent : null;\n    }\n    get children() {\n        if (!this.$children)\n            this.$children = XmlParser.getChildNodes(this);\n        return this.$children;\n    }\n    get attributes() {\n        if (!this.$attributes)\n            this.$attributes = XmlParser.getNodeAttributes(this);\n        return this.$attributes;\n    }\n}\nclass XmlParser {\n    static tryParse(xmlstring, mimeType = \"application/xml\") {\n        let doc = XmlParser.$parser.parseFromString(xmlstring, mimeType);\n        if (doc && doc.childNodes && doc.childNodes.length >= 1)\n            return new XmlNode(doc.firstChild);\n        return null;\n    }\n    static getXmlRoot(xml) {\n        if (!xml || !xml.context)\n            throw new Error(\"Invalid xml node\");\n        let p = xml.context;\n        while (p.parentNode != null)\n            p = p.parentNode;\n        return p == xml.context ? xml : new XmlNode(p);\n    }\n    static getChildNodes(xml, matchName = null) {\n        let nodes = xml.context.childNodes;\n        let ret = [];\n        if (!nodes || nodes.length <= 0)\n            return ret;\n        let len = nodes.length;\n        for (let i = 0; i < len; i++) {\n            let n = nodes.item(i);\n            if (n.nodeType == Node.TEXT_NODE)\n                continue;\n            if (!matchName || (matchName && matchName.length > 0 && n.nodeName.toLowerCase() == matchName.toLowerCase()))\n                ret.push(new XmlNode(n));\n        }\n        return ret;\n    }\n    static getNodeAttributes(xml) {\n        let context = xml.context;\n        let asList = context.attributes;\n        let ret = {};\n        if (!asList || asList.length <= 0)\n            return ret;\n        let len = asList.length;\n        for (let i = 0; i < len; i++) {\n            let a = asList.item(i);\n            ret[a.nodeName] = a.nodeValue;\n        }\n        return ret;\n    }\n}\nXmlParser.$parser = new DOMParser();\n\nclass DisplayListItem {\n    constructor(packageItem, type) {\n        this.packageItem = packageItem;\n        this.type = type;\n    }\n}\n\nclass PackageItem {\n    constructor() {\n        this.width = 0;\n        this.height = 0;\n        this.tiledSlices = 0;\n        //movieclip\n        this.interval = 0;\n        this.repeatDelay = 0;\n    }\n    load() {\n        return this.owner.getItemAsset(this);\n    }\n    toString() {\n        return this.name;\n    }\n}\n\nclass AtlasConfig {\n    constructor(atlasName, frame, orig, trim, rotate) {\n        this.atlasName = atlasName;\n        this.frame = frame;\n        this.orig = orig;\n        this.trim = trim;\n        this.rotate = rotate;\n    }\n}\nclass UIPackage {\n    constructor() {\n        this.$items = [];\n        this.$atlasConfigs = {};\n    }\n    static getById(id) {\n        return UIPackage.$packageInstById[id];\n    }\n    static getByName(name) {\n        return UIPackage.$packageInstByName[name];\n    }\n    static addPackage(resKey) {\n        let pkg = new UIPackage();\n        pkg.$resKey = resKey;\n        pkg.create(resKey);\n        UIPackage.$packageInstById[pkg.id] = pkg;\n        UIPackage.$packageInstByName[pkg.name] = pkg;\n        pkg.customId = resKey;\n        return pkg;\n    }\n    static removePackage(packageId) {\n        let pkg = UIPackage.$packageInstById[packageId];\n        pkg.dispose();\n        delete UIPackage.$packageInstById[pkg.id];\n        if (pkg.$customId != null)\n            delete UIPackage.$packageInstById[pkg.$customId];\n        delete UIPackage.$packageInstByName[pkg.name];\n    }\n    static createObject(pkgName, resName, userClass) {\n        let pkg = UIPackage.getByName(pkgName);\n        if (pkg)\n            return pkg.createObject(resName, userClass);\n        else\n            return null;\n    }\n    static createObjectFromURL(url, userClass) {\n        let pi = UIPackage.getItemByURL(url);\n        if (pi)\n            return pi.owner.internalCreateObject(pi, userClass);\n        else\n            return null;\n    }\n    static getItemURL(pkgName, resName) {\n        let pkg = UIPackage.getByName(pkgName);\n        if (!pkg)\n            return null;\n        let pi = pkg.$itemsByName[resName];\n        if (!pi)\n            return null;\n        return `ui://${pkg.id}${pi.id}`;\n    }\n    static getItemByURL(url) {\n        let pos1 = url.indexOf('//');\n        if (pos1 == -1)\n            return null;\n        let pos2 = url.indexOf('/', pos1 + 2);\n        let pkg;\n        if (pos2 == -1) {\n            if (url.length > 13) {\n                let pkgId = url.substr(5, 8);\n                pkg = UIPackage.getById(pkgId);\n                if (pkg != null) {\n                    let srcId = url.substr(13);\n                    return pkg.getItemById(srcId);\n                }\n            }\n        }\n        else {\n            let pkgName = url.substr(pos1 + 2, pos2 - pos1 - 2);\n            pkg = UIPackage.getByName(pkgName);\n            if (pkg != null) {\n                let srcName = url.substr(pos2 + 1);\n                return pkg.getItemByName(srcName);\n            }\n        }\n        return null;\n    }\n    static getBitmapFontByURL(url) {\n        return UIPackage.$bitmapFonts[url];\n    }\n    static setStringsSource(source) {\n        UIPackage.$stringsSource = {};\n        let xmlroot = XmlParser.tryParse(source);\n        xmlroot.children.forEach(cxml => {\n            if (cxml.nodeName == 'string') {\n                let key = cxml.attributes.name;\n                let i = key.indexOf('-');\n                if (i == -1)\n                    return;\n                let text = cxml.children.length > 0 ? cxml.children[0].text : '';\n                let key2 = key.substr(0, i);\n                let key3 = key.substr(i + 1);\n                let col = UIPackage.$stringsSource[key2];\n                if (!col) {\n                    col = {};\n                    UIPackage.$stringsSource[key2] = col;\n                }\n                col[key3] = text;\n            }\n        });\n    }\n    /**\n     * format the URL from old version to new version\n     * @param url url with old version format\n     */\n    static normalizeURL(url) {\n        if (url == null)\n            return null;\n        let pos1 = url.indexOf('//');\n        if (pos1 == -1)\n            return null;\n        let pos2 = url.indexOf('/', pos1 + 2);\n        if (pos2 == -1)\n            return url;\n        let pkgName = url.substr(pos1 + 2, pos2 - pos1 - 2);\n        let srcName = url.substr(pos2 + 1);\n        return UIPackage.getItemURL(pkgName, srcName);\n    }\n    create(resKey) {\n        this.$resKey = resKey;\n        let buf = AssetLoader.resourcesPool[this.$resKey];\n        if (!buf) {\n            buf = AssetLoader.resourcesPool[`${this.$resKey}_fui`];\n        }\n        if (!buf) {\n            throw new Error(`Resource '${this.$resKey}' not found, please make sure that you use \"new fgui.utils.AssetLoader\" to load resources\".`);\n        }\n        if (!buf || !(buf instanceof ArrayBuffer)) {\n            throw new Error(`Resource '${this.$resKey}' is not a proper binary resource, please load it as binary format in manifest file add[{ id, src, type: \"binary\" }]`);\n        }\n        this.loadPackage(buf);\n    }\n    loadPackage(descData) {\n        this.decompressPackage(descData);\n        let str = this.getResDescriptor('sprites.bytes');\n        str &&\n            str.split(UIPackage.sep1).forEach((str, index) => {\n                if (index >= 1 && str && str.length) {\n                    let arr = str.split(UIPackage.sep2);\n                    let texID;\n                    let itemId = arr[0];\n                    let binIndex = parseInt(arr[1]);\n                    if (binIndex >= 0)\n                        texID = `atlas${binIndex}`;\n                    else {\n                        let pos = itemId.indexOf('_');\n                        if (pos == -1)\n                            texID = `atlas_${itemId}`;\n                        else\n                            texID = `atlas_${itemId.substr(0, pos)}`;\n                    }\n                    let cfg = new AtlasConfig(texID);\n                    cfg.frame = new createjs.Rectangle(parseInt(arr[2]), parseInt(arr[3]), parseInt(arr[4]), parseInt(arr[5]));\n                    cfg.rotate = arr[6] == '1' ? 6 : 0;\n                    cfg.orig =\n                        cfg.rotate != 0 ? new createjs.Rectangle(0, 0, cfg.frame.height, cfg.frame.width) : null;\n                    /*\n                          cfg.trim = trimed;  //ignored for now - editor not support\n                          */\n                    this.$atlasConfigs[itemId] = cfg;\n                }\n            });\n        str = this.getResDescriptor('package.xml');\n        let xml = XmlParser.tryParse(str);\n        this.$id = xml.attributes.id;\n        this.$name = xml.attributes.name;\n        let resources = xml.children[0].children;\n        this.$itemsById = {};\n        this.$itemsByName = {};\n        resources.forEach(cxml => {\n            let pi = new PackageItem();\n            pi.type = ParsePackageItemType(cxml.nodeName);\n            pi.id = cxml.attributes.id;\n            pi.name = cxml.attributes.name;\n            pi.file = cxml.attributes.file;\n            str = cxml.attributes.size;\n            if (str) {\n                let arr = str.split(UIPackage.sep0);\n                pi.width = parseInt(arr[0]);\n                pi.height = parseInt(arr[1]);\n            }\n            switch (pi.type) {\n                case 0 /* Image */: {\n                    str = cxml.attributes.scale;\n                    if (str == '9grid') {\n                        str = cxml.attributes.scale9grid;\n                        if (str) {\n                            let arr = str.split(UIPackage.sep0);\n                            let rect = new createjs.Rectangle(parseInt(arr[0]), parseInt(arr[1]), parseInt(arr[2]), parseInt(arr[3]));\n                            pi.scale9Grid = rect;\n                            str = cxml.attributes.gridTile;\n                            if (str)\n                                pi.tiledSlices = parseInt(str);\n                        }\n                    }\n                    else if (str == 'tile')\n                        pi.scaleByTile = true;\n                    break;\n                }\n            }\n            pi.owner = this;\n            this.$items.push(pi);\n            this.$itemsById[pi.id] = pi;\n            if (pi.name != null)\n                this.$itemsByName[pi.name] = pi;\n        }, this);\n        this.$items.forEach(pi => {\n            if (pi.type == 6 /* Font */) {\n                this.loadFont(pi);\n                UIPackage.$bitmapFonts[pi.bitmapFont.id] = pi.bitmapFont;\n            }\n        }, this);\n    }\n    decompressPackage(buf) {\n        this.$resData = {};\n        var mark = new Uint8Array(buf.slice(0, 2));\n        if (mark[0] == 0x50 && mark[1] == 0x4b) {\n            this.decodeUncompressed(buf);\n            return;\n        }\n        let inflater = new RawInflate(buf);\n        let data = inflater.decompress();\n        let source = RawByte.decodeUTF8(data);\n        let curr = 0;\n        let fn;\n        let size;\n        while (true) {\n            let pos = source.indexOf('|', curr);\n            if (pos == -1)\n                break;\n            fn = source.substring(curr, pos);\n            curr = pos + 1;\n            pos = source.indexOf('|', curr);\n            size = parseInt(source.substring(curr, pos));\n            curr = pos + 1;\n            this.$resData[fn] = source.substr(curr, size);\n            curr += size;\n        }\n    }\n    /**\n     * @param buf\n     */\n    decodeUncompressed(buf) {\n        var ba = new ByteArray(buf);\n        ba.endian = Endian.LITTLE_ENDIAN;\n        var pos = ba.length - 22;\n        ba.position = pos + 10;\n        var entryCount = ba.readUnsignedShort();\n        ba.position = pos + 16;\n        pos = ba.readInt();\n        for (var i = 0; i < entryCount; i++) {\n            ba.position = pos + 28;\n            var len = ba.readUnsignedShort();\n            var len2 = ba.readUnsignedShort() + ba.readUnsignedShort();\n            ba.position = pos + 46;\n            var entryName = ba.readUTFBytes(len);\n            if (entryName[entryName.length - 1] != '/' && entryName[entryName.length - 1] != '\\\\') {\n                //not directory\n                ba.position = pos + 20;\n                var size = ba.readInt();\n                ba.position = pos + 42;\n                var offset = ba.readInt() + 30 + len;\n                if (size > 0) {\n                    ba.position = offset;\n                    this.$resData[entryName] = ba.readUTFBytes(size);\n                }\n            }\n            pos += 46 + len + len2;\n        }\n    }\n    dispose() {\n        this.$items.forEach(pi => {\n            let cfg = this.$atlasConfigs[pi.id];\n            if (cfg)\n                AssetLoader.destroyResource(`${this.$resKey}@${cfg.atlasName}`);\n        }, this);\n    }\n    get id() {\n        return this.$id;\n    }\n    get name() {\n        return this.$name;\n    }\n    get customId() {\n        return this.$customId;\n    }\n    set customId(value) {\n        if (this.$customId != null)\n            delete UIPackage.$packageInstById[this.$customId];\n        this.$customId = value;\n        if (this.$customId != null)\n            UIPackage.$packageInstById[this.$customId] = this;\n    }\n    createObject(resName, userClass) {\n        let pi = this.$itemsByName[resName];\n        if (pi)\n            return this.internalCreateObject(pi, userClass);\n        else\n            return null;\n    }\n    internalCreateObject(item, userClass = null) {\n        let g = item.type == 4 /* Component */ && userClass != null\n            ? new userClass()\n            : Decls.UIObjectFactory.newObject(item);\n        if (g == null)\n            return null;\n        UIPackage.$constructingObjects++;\n        g.packageItem = item;\n        g.constructFromResource();\n        UIPackage.$constructingObjects--;\n        return g;\n    }\n    getItemById(itemId) {\n        return this.$itemsById[itemId];\n    }\n    getItemByName(resName) {\n        return this.$itemsByName[resName];\n    }\n    getItemAssetByName(resName) {\n        let pi = this.$itemsByName[resName];\n        if (pi == null)\n            throw new Error(`Resource '${resName}' not found`);\n        return this.getItemAsset(pi);\n    }\n    /**\n     * todo\n     */\n    createSpriteTexture(cfgName, cfg) {\n        let atlasItem = this.$itemsById[cfg.atlasName];\n        if (atlasItem != null) {\n            let atlasTexture = this.getItemAsset(atlasItem);\n            if (!atlasTexture)\n                return null;\n            if (!cfg.texCacheID) {\n                cfg.texCacheID = `${this.$resKey}@${cfg.atlasName}`;\n            }\n            let tex = Utils.TextureCache[cfg.texCacheID];\n            //todo add to cache\n            if (!tex) {\n                tex = {\n                    image: atlasTexture,\n                    rect: cfg.frame\n                };\n            }\n            return tex;\n        }\n        else\n            return null;\n    }\n    getItemAsset(item) {\n        switch (item.type) {\n            case 0 /* Image */:\n                if (!item.decoded) {\n                    item.decoded = true;\n                    let cfg = this.$atlasConfigs[item.id];\n                    if (cfg != null)\n                        item.texture = this.createSpriteTexture(item.id, cfg);\n                }\n                return item.texture;\n            case 7 /* Atlas */:\n                if (!item.decoded) {\n                    item.decoded = true;\n                    let fileName = item.file != null && item.file.length > 0 ? item.file : `${item.id}.png`;\n                    let resName = `${this.$resKey}@${StringUtil.getFileName(fileName)}`;\n                    let texture = AssetLoader.resourcesPool[resName];\n                    if (!texture) {\n                        throw new Error(`${resName} not found in fgui.AssetLoader.resourcesPool, please load assets first!`);\n                    }\n                    item.texture = texture;\n                    if (!item.texture) {\n                        texture = AssetLoader.resourcesPool[`${this.$resKey}@${fileName.replace('.', '_')}`];\n                        item.texture = texture;\n                    }\n                }\n                return item.texture;\n            case 3 /* Sound */:\n                if (!item.decoded) {\n                    item.decoded = true;\n                    this.loadAudio(item);\n                }\n                return item.sound;\n            case 6 /* Font */:\n                if (!item.decoded) {\n                    item.decoded = true;\n                    this.loadFont(item);\n                }\n                return item.bitmapFont;\n            case 2 /* MovieClip */:\n                if (!item.decoded) {\n                    item.decoded = true;\n                    this.loadMovieClip(item);\n                }\n                return item.frames;\n            case 4 /* Component */:\n                if (!item.decoded) {\n                    item.decoded = true;\n                    let str = this.getResDescriptor(`${item.id}.xml`);\n                    let xml = XmlParser.tryParse(str);\n                    item.componentData = xml;\n                    this.loadComponentChildren(item);\n                    this.loadComponentTranslation(item);\n                }\n                return item.componentData;\n            default:\n                return AssetLoader.resourcesPool[`${this.$resKey}@${item.id}`];\n        }\n    }\n    loadComponentChildren(item) {\n        let listNode = XmlParser.getChildNodes(item.componentData, 'displayList');\n        if (listNode != null && listNode.length > 0) {\n            item.displayList = [];\n            listNode[0].children.forEach(cxml => {\n                let tagName = cxml.nodeName;\n                let di;\n                let src = cxml.attributes.src;\n                if (src) {\n                    let pkgId = cxml.attributes.pkg;\n                    let pkg;\n                    if (pkgId && pkgId != item.owner.id)\n                        pkg = UIPackage.getById(pkgId);\n                    else\n                        pkg = item.owner;\n                    let pi = pkg != null ? pkg.getItemById(src) : null;\n                    if (pi != null)\n                        di = new DisplayListItem(pi, null);\n                    else\n                        di = new DisplayListItem(null, tagName);\n                }\n                else {\n                    if (tagName == 'text' && cxml.attributes.input == 'true')\n                        di = new DisplayListItem(null, 'inputtext');\n                    else\n                        di = new DisplayListItem(null, tagName);\n                }\n                di.desc = cxml;\n                item.displayList.push(di);\n            });\n        }\n        else\n            item.displayList = [];\n    }\n    getResDescriptor(fn) {\n        return this.$resData[fn];\n    }\n    loadComponentTranslation(item) {\n        if (UIPackage.$stringsSource == null)\n            return;\n        let strings = UIPackage.$stringsSource[this.id + item.id];\n        if (strings == null)\n            return;\n        let value;\n        let cxml, dxml;\n        let ename;\n        let elementId;\n        let str;\n        item.displayList.forEach(item => {\n            cxml = item.desc;\n            ename = cxml.nodeName;\n            elementId = cxml.attributes.id;\n            str = cxml.attributes.tooltips;\n            if (str) {\n                value = strings[`${elementId}-tips`];\n                if (value != undefined)\n                    cxml.attributes.tooltips = value;\n            }\n            let cs = XmlParser.getChildNodes(cxml, 'gearText');\n            dxml = cs && cs[0];\n            if (dxml) {\n                value = strings[`${elementId}-texts`];\n                if (value != undefined)\n                    dxml.attributes.values = value;\n                value = strings[`${elementId}-texts_def`];\n                if (value != undefined)\n                    dxml.attributes.default = value;\n            }\n            if (ename == 'text' || ename == 'richtext') {\n                value = strings[elementId];\n                if (value != undefined)\n                    cxml.attributes.text = value;\n                value = strings[`${elementId}-prompt`];\n                if (value != undefined)\n                    cxml.attributes.prompt = value;\n            }\n            else if (ename == 'list') {\n                cxml.children.forEach((exml, index) => {\n                    if (exml.nodeName != 'item')\n                        return;\n                    value = strings[`${elementId}-${index}`];\n                    if (value != undefined)\n                        exml.attributes.title = value;\n                });\n            }\n            else if (ename == 'component') {\n                cs = XmlParser.getChildNodes(cxml, 'Button');\n                dxml = cs && cs[0];\n                if (dxml) {\n                    value = strings[elementId];\n                    if (value != undefined)\n                        dxml.attributes.title = value;\n                    value = strings[`${elementId}-0`];\n                    if (value != undefined)\n                        dxml.attributes.selectedTitle = value;\n                    return;\n                }\n                cs = XmlParser.getChildNodes(cxml, 'Label');\n                dxml = cs && cs[0];\n                if (dxml) {\n                    value = strings[elementId];\n                    if (value != undefined)\n                        dxml.attributes.title = value;\n                    return;\n                }\n                cs = XmlParser.getChildNodes(cxml, 'ComboBox');\n                dxml = cs && cs[0];\n                if (dxml) {\n                    value = strings[elementId];\n                    if (value != undefined)\n                        dxml.attributes.title = value;\n                    dxml.children.forEach((exml, index) => {\n                        if (exml.nodeName != 'item')\n                            return;\n                        value = strings[`${elementId}-${index}`];\n                        if (value != undefined)\n                            exml.attributes.title = value;\n                    });\n                    return;\n                }\n            }\n        });\n    }\n    loadMovieClip(item) {\n        let xml = XmlParser.tryParse(this.getResDescriptor(`${item.id}.xml`));\n        let str;\n        str = xml.attributes.interval;\n        if (str != null)\n            item.interval = parseInt(str);\n        str = xml.attributes.swing;\n        if (str != null)\n            item.swing = str == 'true';\n        str = xml.attributes.repeatDelay;\n        if (str != null)\n            item.repeatDelay = parseInt(str);\n        item.frames = [];\n        let frameNodes = xml.children[0].children;\n        frameNodes.forEach((node, index) => {\n            let frame = new Frame();\n            str = node.attributes.rect;\n            let arr = str.split(UIPackage.sep0);\n            let trimRect = new createjs.Rectangle(parseInt(arr[0]), parseInt(arr[1]), parseInt(arr[2]), parseInt(arr[3]));\n            str = node.attributes.addDelay;\n            if (str)\n                frame.addDelay = parseInt(str);\n            item.frames.push(frame);\n            if (trimRect.width <= 0)\n                return;\n            str = node.attributes.sprite;\n            if (str)\n                str = `${item.id}_${str}`;\n            else\n                str = `${item.id}_${index}`;\n            let cfg = this.$atlasConfigs[str];\n            if (cfg != null) {\n                frame.texture = this.createSpriteTexture(str, cfg);\n                frame.texture.trim = trimRect;\n            }\n        });\n    }\n    loadFont(item) {\n        let font = new BitmapFont();\n        font.id = `ui://${this.id}${item.id}`;\n        let str = this.getResDescriptor(`${item.id}.fnt`);\n        let lines = str.split(UIPackage.sep1);\n        let kv = {};\n        let ttf = false;\n        let size = 0;\n        let xadvance = 0;\n        let resizable = false;\n        let colorable = false;\n        let atlasOffsetX = 0, atlasOffsetY = 0;\n        let charImg;\n        let mainTexture;\n        let lineHeight = 0;\n        let maxCharHeight = 0;\n        lines.forEach(line => {\n            if (line && line.length) {\n                str = StringUtil.trim(line);\n                let arr = str.split(UIPackage.sep2);\n                arr.forEach(v => {\n                    let at = v.split(UIPackage.sep3);\n                    kv[at[0]] = at[1];\n                });\n                str = arr[0];\n                if (str == 'char') {\n                    let bg = new BMGlyph();\n                    bg.x = parseInt(kv.x) || 0;\n                    bg.y = parseInt(kv.y) || 0;\n                    bg.offsetX = parseInt(kv.xoffset) || 0;\n                    bg.offsetY = parseInt(kv.yoffset) || 0;\n                    bg.width = parseInt(kv.width) || 0;\n                    bg.height = parseInt(kv.height) || 0;\n                    maxCharHeight = Math.max(bg.height, maxCharHeight);\n                    bg.advance = parseInt(kv.xadvance) || 0;\n                    if (kv.chnl != undefined) {\n                        bg.channel = parseInt(kv.chnl);\n                        if (bg.channel == 15)\n                            bg.channel = 4;\n                        else if (bg.channel == 1)\n                            bg.channel = 3;\n                        else if (bg.channel == 2)\n                            bg.channel = 2;\n                        else\n                            bg.channel = 1;\n                    }\n                    if (!ttf) {\n                        if (kv.img) {\n                            charImg = this.$itemsById[kv.img];\n                            if (charImg != null) {\n                                charImg.load();\n                                bg.width = charImg.width;\n                                bg.height = charImg.height;\n                                bg.texture = charImg.texture;\n                            }\n                        }\n                    }\n                    else if (mainTexture != null) {\n                        if (!bg.texture) {\n                            bg.texture = { image: mainTexture, rect: {} };\n                        }\n                        bg.texture.rect = new createjs.Rectangle(bg.x + atlasOffsetX, bg.y + atlasOffsetY, bg.width, bg.height);\n                    }\n                    if (ttf)\n                        bg.lineHeight = lineHeight;\n                    else {\n                        if (bg.advance == 0) {\n                            if (xadvance == 0)\n                                bg.advance = bg.offsetX + bg.width;\n                            else\n                                bg.advance = xadvance;\n                        }\n                        bg.lineHeight = bg.offsetY < 0 ? bg.height : bg.offsetY + bg.height;\n                        if (size > 0 && bg.lineHeight < size)\n                            bg.lineHeight = size;\n                    }\n                    font.glyphs[String.fromCharCode(+kv.id | 0)] = bg;\n                }\n                else if (str == 'info') {\n                    ttf = kv.face != null;\n                    if (kv.size)\n                        size = parseInt(kv.size);\n                    resizable = kv.resizable == 'true';\n                    colorable = kv.colored == 'true';\n                    if (ttf) {\n                        let cfg = this.$atlasConfigs[item.id];\n                        if (cfg != null) {\n                            atlasOffsetX = cfg.frame.x;\n                            atlasOffsetY = cfg.frame.y;\n                            let atlasItem = this.$itemsById[cfg.atlasName];\n                            if (atlasItem != null)\n                                mainTexture = this.getItemAsset(atlasItem);\n                        }\n                    }\n                }\n                else if (str == 'common') {\n                    if (kv.lineHeight)\n                        lineHeight = parseInt(kv.lineHeight);\n                    if (size == 0)\n                        size = lineHeight;\n                    else if (lineHeight == 0)\n                        lineHeight = size;\n                    if (kv.xadvance)\n                        xadvance = parseInt(kv.xadvance);\n                }\n            }\n        });\n        if (size == 0 && maxCharHeight > 0)\n            size = maxCharHeight;\n        font.ttf = ttf;\n        font.size = size;\n        font.resizable = resizable;\n        font.colorable = colorable;\n        item.bitmapFont = font;\n    }\n    loadAudio(item) {\n        let fileName = item.file != null && item.file.length > 0 ? item.file : `${item.id}.mp3`;\n        let resName = `${this.$resKey}@${StringUtil.getFileName(fileName)}`;\n        let sound = AssetLoader.resourcesPool[resName];\n        if (sound) {\n            item.sound = createjs.Sound.play(resName);\n        }\n        else {\n            console.log(\"Resource '\" + item.file + \"' not found, please loadManifest first!\");\n        }\n    }\n}\n/**@internal */\nUIPackage.$constructingObjects = 0;\nUIPackage.$packageInstById = {};\nUIPackage.$packageInstByName = {};\nUIPackage.$bitmapFonts = {};\nUIPackage.$stringsSource = null;\nUIPackage.sep0 = ',';\nUIPackage.sep1 = '\\n';\nUIPackage.sep2 = ' ';\nUIPackage.sep3 = '=';\nlet Decls = {};\n\nclass GearLook extends GearBase {\n    constructor(owner) {\n        super(owner);\n    }\n    init() {\n        this.$default = new GearLookValue(this.$owner.alpha, this.$owner.rotation, this.$owner.grayed);\n        this.$storage = {};\n    }\n    addStatus(pageId, value) {\n        if (value == '-')\n            return;\n        let arr = value.split(',');\n        let gv;\n        if (pageId == null)\n            gv = this.$default;\n        else {\n            gv = new GearLookValue();\n            this.$storage[pageId] = gv;\n        }\n        gv.alpha = parseFloat(arr[0]);\n        gv.rotation = parseInt(arr[1]);\n        gv.grayed = arr[2] == '1' ? true : false;\n    }\n    apply() {\n        let gv = this.$storage[this.$controller.selectedPageId];\n        if (!gv)\n            gv = this.$default;\n        if (this.$tween && !UIPackage.$constructingObjects && !GearBase.disableAllTweenEffect) {\n            this.$owner.$gearLocked = true;\n            this.$owner.grayed = gv.grayed;\n            this.$owner.$gearLocked = false;\n            if (this.$tweener) {\n                if (this.$tweenTarget.alpha === gv.alpha && this.$tweenTarget.rotation === gv.rotation)\n                    return;\n                this.$tweener.gotoAndStop(this.$tweener.duration); //set to end\n                this.$tweener = null;\n            }\n            let a = gv.alpha != this.$owner.alpha;\n            let b = gv.rotation != this.$owner.rotation;\n            if (a || b) {\n                if (this.$owner.hasGearController(0, this.$controller))\n                    this.$lockToken = this.$owner.lockGearDisplay();\n                this.$tweenTarget = gv;\n                let vars = {\n                    onChange: () => {\n                        this.$owner.$gearLocked = true;\n                        if (a)\n                            this.$owner.alpha = this.$tweenValue.x;\n                        if (b)\n                            this.$owner.rotation = this.$tweenValue.y;\n                        this.$owner.$gearLocked = false;\n                    }\n                };\n                if (this.$tweenValue == null)\n                    this.$tweenValue = new createjs.Point();\n                this.$tweenValue.x = this.$owner.alpha;\n                this.$tweenValue.y = this.$owner.rotation;\n                this.$tweener = createjs.Tween.get(this.$tweenValue, vars)\n                    .wait(this.$tweenDelay * 1000)\n                    .to({ x: gv.alpha, y: gv.rotation }, this.$tweenTime * 1000, this.$easeType)\n                    .call(this.tweenComplete, null, this);\n            }\n        }\n        else {\n            this.$owner.$gearLocked = true;\n            this.$owner.grayed = gv.grayed;\n            this.$owner.alpha = gv.alpha;\n            this.$owner.rotation = gv.rotation;\n            this.$owner.$gearLocked = false;\n        }\n    }\n    tweenComplete() {\n        if (this.$lockToken != 0) {\n            this.$owner.releaseGearDisplay(this.$lockToken);\n            this.$lockToken = 0;\n        }\n        this.$tweener = null;\n        let evt = new createjs.Event(\"__gearStop\" /* GEAR_STOP */, true, false);\n        this.$owner.dispatchEvent(evt, this);\n    }\n    updateState() {\n        if (this.$controller == null || this.$owner.$gearLocked || this.$owner.$inProgressBuilding)\n            return;\n        let gv = this.$storage[this.$controller.selectedPageId];\n        if (!gv) {\n            gv = new GearLookValue();\n            this.$storage[this.$controller.selectedPageId] = gv;\n        }\n        gv.alpha = this.$owner.alpha;\n        gv.rotation = this.$owner.rotation;\n        gv.grayed = this.$owner.grayed;\n    }\n}\nclass GearLookValue {\n    constructor(alpha = 0, rotation = 0, grayed = false) {\n        this.alpha = alpha;\n        this.rotation = rotation;\n        this.grayed = grayed;\n    }\n}\n\nclass GearSize extends GearBase {\n    constructor(owner) {\n        super(owner);\n    }\n    init() {\n        this.$default = new GearSizeValue(this.$owner.width, this.$owner.height, this.$owner.scaleX, this.$owner.scaleY);\n        this.$storage = {};\n    }\n    addStatus(pageId, value) {\n        if (value == '-')\n            return;\n        let arr = value.split(',');\n        let gv;\n        if (pageId == null)\n            gv = this.$default;\n        else {\n            gv = new GearSizeValue();\n            this.$storage[pageId] = gv;\n        }\n        gv.width = parseInt(arr[0]);\n        gv.height = parseInt(arr[1]);\n        if (arr.length > 2) {\n            gv.scaleX = parseFloat(arr[2]);\n            gv.scaleY = parseFloat(arr[3]);\n        }\n    }\n    apply() {\n        let gv = this.$storage[this.$controller.selectedPageId];\n        if (!gv)\n            gv = this.$default;\n        if (this.$tween && !UIPackage.$constructingObjects && !GearBase.disableAllTweenEffect) {\n            if (this.$tweener) {\n                if (this.$tweenTarget.width != gv.width ||\n                    this.$tweenTarget.height != gv.height ||\n                    this.$tweenTarget.scaleX != gv.scaleX ||\n                    this.$tweenTarget.scaleY != gv.scaleY) {\n                    this.$tweener.gotoAndStop(this.$tweener.duration); //set to end\n                    this.$tweener = null;\n                }\n                else\n                    return;\n            }\n            let a = gv.width != this.$owner.width || gv.height != this.$owner.height;\n            let b = gv.scaleX != this.$owner.scaleX || gv.scaleY != this.$owner.scaleY;\n            if (a || b) {\n                if (this.$owner.hasGearController(0, this.$controller))\n                    this.$lockToken = this.$owner.lockGearDisplay();\n                this.$tweenTarget = gv;\n                let vars = {\n                    onChange: () => {\n                        this.$owner.$gearLocked = true;\n                        if (a)\n                            this.$owner.setSize(this.$tweenValue.width, this.$tweenValue.height, this.$owner.gearXY.controller == this.$controller);\n                        if (b)\n                            this.$owner.setScale(this.$tweenValue.scaleX, this.$tweenValue.scaleY);\n                        this.$owner.$gearLocked = false;\n                    }\n                };\n                if (this.$tweenValue == null)\n                    this.$tweenValue = new GearSizeValue();\n                this.$tweenValue.width = this.$owner.width;\n                this.$tweenValue.height = this.$owner.height;\n                this.$tweenValue.scaleX = this.$owner.scaleX;\n                this.$tweenValue.scaleY = this.$owner.scaleY;\n                this.$tweener = createjs.Tween.get(this.$tweenValue, vars)\n                    .wait(this.$tweenDelay * 1000)\n                    .to({ width: gv.width, height: gv.height, scaleX: gv.scaleX, scaleY: gv.scaleY }, this.$tweenTime * 1000, this.$easeType)\n                    .call(this.tweenComplete, null, this);\n            }\n        }\n        else {\n            this.$owner.$gearLocked = true;\n            this.$owner.setSize(gv.width, gv.height, this.$owner.gearXY.controller == this.$controller);\n            this.$owner.setScale(gv.scaleX, gv.scaleY);\n            this.$owner.$gearLocked = false;\n        }\n    }\n    tweenComplete() {\n        if (this.$lockToken != 0) {\n            this.$owner.releaseGearDisplay(this.$lockToken);\n            this.$lockToken = 0;\n        }\n        this.$tweener = null;\n        let evt = new createjs.Event(\"__gearStop\" /* GEAR_STOP */, true, false);\n        this.$owner.dispatchEvent(evt, this);\n    }\n    updateState() {\n        if (this.$controller == null || this.$owner.$gearLocked || this.$owner.$inProgressBuilding)\n            return;\n        let gv = this.$storage[this.$controller.selectedPageId];\n        if (!gv) {\n            gv = new GearSizeValue();\n            this.$storage[this.$controller.selectedPageId] = gv;\n        }\n        gv.width = this.$owner.width;\n        gv.height = this.$owner.height;\n        gv.scaleX = this.$owner.scaleX;\n        gv.scaleY = this.$owner.scaleY;\n    }\n    updateFromRelations(dx, dy) {\n        if (this.$controller == null || this.$storage == null)\n            return;\n        for (let key in this.$storage) {\n            let gv = this.$storage[key];\n            gv.width += dx;\n            gv.height += dy;\n        }\n        this.$default.width += dx;\n        this.$default.height += dy;\n        this.updateState();\n    }\n}\nclass GearSizeValue {\n    constructor(width = 0, height = 0, scaleX = 0, scaleY = 0) {\n        this.width = width;\n        this.height = height;\n        this.scaleX = scaleX;\n        this.scaleY = scaleY;\n    }\n}\n\nclass GearXY extends GearBase {\n    constructor(owner) {\n        super(owner);\n    }\n    init() {\n        this.$default = new createjs.Point(this.$owner.x, this.$owner.y);\n        this.$storage = {};\n    }\n    addStatus(pageId, value) {\n        if (value == '-')\n            return;\n        let arr = value.split(',');\n        let pt;\n        if (pageId == null)\n            pt = this.$default;\n        else {\n            pt = new createjs.Point();\n            this.$storage[pageId] = pt;\n        }\n        pt.x = parseInt(arr[0]);\n        pt.y = parseInt(arr[1]);\n    }\n    apply() {\n        let pt = this.$storage[this.$controller.selectedPageId];\n        if (!pt)\n            pt = this.$default;\n        if (this.$tween && !UIPackage.$constructingObjects && !GearBase.disableAllTweenEffect) {\n            if (this.$tweener) {\n                if (this.$tweenTarget.x === pt.x && this.$tweenTarget.y === pt.y)\n                    return;\n                this.$tweener.gotoAndStop(this.$tweener.duration); //set to end\n                this.$tweener = null;\n            }\n            if (this.$owner.x != pt.x || this.$owner.y != pt.y) {\n                this.$owner.hasGearController(0, this.$controller);\n                this.$lockToken = this.$owner.lockGearDisplay();\n                this.$tweenTarget = pt;\n                let vars = {\n                    onChange: () => {\n                        this.$owner.$gearLocked = true;\n                        this.$owner.setXY(this.$tweenValue.x, this.$tweenValue.y);\n                        this.$owner.$gearLocked = false;\n                    }\n                };\n                if (this.$tweenValue == null)\n                    this.$tweenValue = new createjs.Point();\n                this.$tweenValue.x = this.$owner.x;\n                this.$tweenValue.y = this.$owner.y;\n                this.$tweener = createjs.Tween.get(this.$tweenValue, vars)\n                    .wait(this.$tweenDelay * 1000)\n                    .to({ x: pt.x, y: pt.y }, this.$tweenTime * 1000, this.$easeType)\n                    .call(this.tweenComplete, null, this);\n            }\n        }\n        else {\n            this.$owner.$gearLocked = true;\n            this.$owner.setXY(pt.x, pt.y);\n            this.$owner.$gearLocked = false;\n        }\n    }\n    tweenComplete() {\n        if (this.$lockToken != 0) {\n            this.$owner.releaseGearDisplay(this.$lockToken);\n            this.$lockToken = 0;\n        }\n        this.$tweener = null;\n        let evt = new createjs.Event(\"__gearStop\" /* GEAR_STOP */, true, false);\n        this.$owner.dispatchEvent(evt, this);\n    }\n    updateState() {\n        if (this.$controller == null || this.$owner.$gearLocked || this.$owner.$inProgressBuilding)\n            return;\n        let pt = this.$storage[this.$controller.selectedPageId];\n        if (!pt) {\n            pt = new createjs.Point();\n            this.$storage[this.$controller.selectedPageId] = pt;\n        }\n        pt.x = this.$owner.x;\n        pt.y = this.$owner.y;\n    }\n    updateFromRelations(dx, dy) {\n        if (this.$controller == null || this.$storage == null)\n            return;\n        for (let key in this.$storage) {\n            let pt = this.$storage[key];\n            pt.x += dx;\n            pt.y += dy;\n        }\n        this.$default.x += dx;\n        this.$default.y += dy;\n        this.updateState();\n    }\n}\n\nlet isUIObject = function (obj) {\n    return obj && 'UIOwner' in obj && obj.UIOwner != null;\n};\n\nclass RelationDef {\n    copyFrom(source) {\n        this.percent = source.percent;\n        this.type = source.type;\n    }\n}\nclass RelationItem {\n    constructor(owner) {\n        this.$owner = owner;\n        this.$defs = [];\n    }\n    get owner() {\n        return this.$owner;\n    }\n    set target(value) {\n        if (this.$target != value) {\n            if (this.$target)\n                this.releaseRefTarget(this.$target);\n            this.$target = value;\n            if (this.$target)\n                this.addRefTarget(this.$target);\n        }\n    }\n    get target() {\n        return this.$target;\n    }\n    add(relationType, usePercent) {\n        if (relationType == 24 /* Size */) {\n            this.add(14 /* Width */, usePercent);\n            this.add(15 /* Height */, usePercent);\n            return;\n        }\n        let length = this.$defs.length;\n        for (let i = 0; i < length; i++) {\n            let def = this.$defs[i];\n            if (def.type == relationType)\n                return;\n        }\n        this.internalAdd(relationType, usePercent);\n    }\n    internalAdd(relationType, usePercent) {\n        if (relationType == 24 /* Size */) {\n            this.internalAdd(14 /* Width */, usePercent);\n            this.internalAdd(15 /* Height */, usePercent);\n            return;\n        }\n        let info = new RelationDef();\n        info.percent = usePercent;\n        info.type = relationType;\n        this.$defs.push(info);\n        //CENTER relation will cause float pixel, so enable the auto-pixel-snapping here\n        if (usePercent ||\n            relationType == 1 /* Left_Center */ ||\n            relationType == 3 /* Center_Center */ ||\n            relationType == 5 /* Right_Center */ ||\n            relationType == 8 /* Top_Middle */ ||\n            relationType == 10 /* Middle_Middle */ ||\n            relationType == 12 /* Bottom_Middle */) {\n            this.$owner.pixelSnapping = true;\n        }\n    }\n    remove(relationType = 0) {\n        if (relationType == 24 /* Size */) {\n            this.remove(14 /* Width */);\n            this.remove(15 /* Height */);\n            return;\n        }\n        let dc = this.$defs.length;\n        for (let k = dc - 1; k >= 0; k--) {\n            if (this.$defs[k].type == relationType) {\n                this.$defs.splice(k, 1);\n                break;\n            }\n        }\n    }\n    copyFrom(source) {\n        this.target = source.target;\n        this.$defs.length = 0;\n        source.$defs.forEach(info => {\n            let info2 = new RelationDef();\n            info2.copyFrom(info);\n            this.$defs.push(info2);\n        }, this);\n    }\n    dispose() {\n        if (this.$target != null) {\n            this.releaseRefTarget(this.$target);\n            this.$target = null;\n        }\n    }\n    get isEmpty() {\n        return this.$defs.length == 0;\n    }\n    applyOnSelfResized(dWidth, dHeight) {\n        let ox = this.$owner.x;\n        let oy = this.$owner.y;\n        this.$defs.forEach(info => {\n            switch (info.type) {\n                case 3 /* Center_Center */:\n                case 5 /* Right_Center */:\n                    this.$owner.x -= dWidth / 2;\n                    break;\n                case 4 /* Right_Left */:\n                case 6 /* Right_Right */:\n                    this.$owner.x -= dWidth;\n                    break;\n                case 10 /* Middle_Middle */:\n                case 12 /* Bottom_Middle */:\n                    this.$owner.y -= dHeight / 2;\n                    break;\n                case 11 /* Bottom_Top */:\n                case 13 /* Bottom_Bottom */:\n                    this.$owner.y -= dHeight;\n                    break;\n            }\n        }, this);\n        if (ox != this.$owner.x || oy != this.$owner.y) {\n            ox = this.$owner.x - ox;\n            oy = this.$owner.y - oy;\n            this.$owner.updateGearFromRelations(1 /* XY */, ox, oy);\n            if (this.$owner.parent != null && this.$owner.parent.$transitions.length > 0) {\n                this.$owner.parent.$transitions.forEach(t => {\n                    t.updateFromRelations(this.$owner.id, ox, oy);\n                }, this);\n            }\n        }\n    }\n    applyOnXYChanged(info, dx, dy) {\n        let tmp;\n        switch (info.type) {\n            case 0 /* Left_Left */:\n            case 1 /* Left_Center */:\n            case 2 /* Left_Right */:\n            case 3 /* Center_Center */:\n            case 4 /* Right_Left */:\n            case 5 /* Right_Center */:\n            case 6 /* Right_Right */:\n                this.$owner.x += dx;\n                break;\n            case 7 /* Top_Top */:\n            case 8 /* Top_Middle */:\n            case 9 /* Top_Bottom */:\n            case 10 /* Middle_Middle */:\n            case 11 /* Bottom_Top */:\n            case 12 /* Bottom_Middle */:\n            case 13 /* Bottom_Bottom */:\n                this.$owner.y += dy;\n                break;\n            case 14 /* Width */:\n            case 15 /* Height */:\n                break;\n            case 16 /* LeftExt_Left */:\n            case 17 /* LeftExt_Right */:\n                tmp = this.$owner.x;\n                this.$owner.x += dx;\n                this.$owner.width = this.$owner.$rawWidth - (this.$owner.x - tmp);\n                break;\n            case 18 /* RightExt_Left */:\n            case 19 /* RightExt_Right */:\n                this.$owner.width = this.$owner.$rawWidth + dx;\n                break;\n            case 20 /* TopExt_Top */:\n            case 21 /* TopExt_Bottom */:\n                tmp = this.$owner.y;\n                this.$owner.y += dy;\n                this.$owner.height = this.$owner.$rawHeight - (this.$owner.y - tmp);\n                break;\n            case 22 /* BottomExt_Top */:\n            case 23 /* BottomExt_Bottom */:\n                this.$owner.height = this.$owner.$rawHeight + dy;\n                break;\n        }\n    }\n    applyOnSizeChanged(info) {\n        let targetX, targetY;\n        if (this.$target != this.$owner.parent) {\n            targetX = this.$target.x;\n            targetY = this.$target.y;\n        }\n        else {\n            targetX = 0;\n            targetY = 0;\n        }\n        let v, tmp;\n        switch (info.type) {\n            case 0 /* Left_Left */:\n                break;\n            case 1 /* Left_Center */:\n                v = this.$owner.x - (targetX + this.$targetWidth / 2);\n                if (info.percent)\n                    v = (v / this.$targetWidth) * this.$target.$rawWidth;\n                this.$owner.x = targetX + this.$target.$rawWidth / 2 + v;\n                break;\n            case 2 /* Left_Right */:\n                v = this.$owner.x - (targetX + this.$targetWidth);\n                if (info.percent)\n                    v = (v / this.$targetWidth) * this.$target.$rawWidth;\n                this.$owner.x = targetX + this.$target.$rawWidth + v;\n                break;\n            case 3 /* Center_Center */:\n                v = this.$owner.x + this.$owner.$rawWidth / 2 - (targetX + this.$targetWidth / 2);\n                if (info.percent)\n                    v = (v / this.$targetWidth) * this.$target.$rawWidth;\n                this.$owner.x = targetX + this.$target.$rawWidth / 2 + v - this.$owner.$rawWidth / 2;\n                break;\n            case 4 /* Right_Left */:\n                v = this.$owner.x + this.$owner.$rawWidth - targetX;\n                if (info.percent)\n                    v = (v / this.$targetWidth) * this.$target.$rawWidth;\n                this.$owner.x = targetX + v - this.$owner.$rawWidth;\n                break;\n            case 5 /* Right_Center */:\n                v = this.$owner.x + this.$owner.$rawWidth - (targetX + this.$targetWidth / 2);\n                if (info.percent)\n                    v = (v / this.$targetWidth) * this.$target.$rawWidth;\n                this.$owner.x = targetX + this.$target.$rawWidth / 2 + v - this.$owner.$rawWidth;\n                break;\n            case 6 /* Right_Right */:\n                v = this.$owner.x + this.$owner.$rawWidth - (targetX + this.$targetWidth);\n                if (info.percent)\n                    v = (v / this.$targetWidth) * this.$target.$rawWidth;\n                this.$owner.x = targetX + this.$target.$rawWidth + v - this.$owner.$rawWidth;\n                break;\n            case 7 /* Top_Top */:\n                break;\n            case 8 /* Top_Middle */:\n                v = this.$owner.y - (targetY + this.$targetHeight / 2);\n                if (info.percent)\n                    v = (v / this.$targetHeight) * this.$target.$rawHeight;\n                this.$owner.y = targetY + this.$target.$rawHeight / 2 + v;\n                break;\n            case 9 /* Top_Bottom */:\n                v = this.$owner.y - (targetY + this.$targetHeight);\n                if (info.percent)\n                    v = (v / this.$targetHeight) * this.$target.$rawHeight;\n                this.$owner.y = targetY + this.$target.$rawHeight + v;\n                break;\n            case 10 /* Middle_Middle */:\n                v = this.$owner.y + this.$owner.$rawHeight / 2 - (targetY + this.$targetHeight / 2);\n                if (info.percent)\n                    v = (v / this.$targetHeight) * this.$target.$rawHeight;\n                this.$owner.y = targetY + this.$target.$rawHeight / 2 + v - this.$owner.$rawHeight / 2;\n                break;\n            case 11 /* Bottom_Top */:\n                v = this.$owner.y + this.$owner.$rawHeight - targetY;\n                if (info.percent)\n                    v = (v / this.$targetHeight) * this.$target.$rawHeight;\n                this.$owner.y = targetY + v - this.$owner.$rawHeight;\n                break;\n            case 12 /* Bottom_Middle */:\n                v = this.$owner.y + this.$owner.$rawHeight - (targetY + this.$targetHeight / 2);\n                if (info.percent)\n                    v = (v / this.$targetHeight) * this.$target.$rawHeight;\n                this.$owner.y = targetY + this.$target.$rawHeight / 2 + v - this.$owner.$rawHeight;\n                break;\n            case 13 /* Bottom_Bottom */:\n                v = this.$owner.y + this.$owner.$rawHeight - (targetY + this.$targetHeight);\n                if (info.percent)\n                    v = (v / this.$targetHeight) * this.$target.$rawHeight;\n                this.$owner.y = targetY + this.$target.$rawHeight + v - this.$owner.$rawHeight;\n                break;\n            case 14 /* Width */:\n                if (this.$owner.$inProgressBuilding && this.$owner == this.$target.parent)\n                    v = this.$owner.sourceWidth - this.$target.$initWidth;\n                else\n                    v = this.$owner.$rawWidth - this.$targetWidth;\n                if (info.percent)\n                    v = (v / this.$targetWidth) * this.$target.$rawWidth;\n                if (this.$target == this.$owner.parent)\n                    this.$owner.setSize(this.$target.$rawWidth + v, this.$owner.$rawHeight, true);\n                else\n                    this.$owner.width = this.$target.$rawWidth + v;\n                break;\n            case 15 /* Height */:\n                if (this.$owner.$inProgressBuilding && this.$owner == this.$target.parent)\n                    v = this.$owner.sourceHeight - this.$target.$initHeight;\n                else\n                    v = this.$owner.$rawHeight - this.$targetHeight;\n                if (info.percent)\n                    v = (v / this.$targetHeight) * this.$target.$rawHeight;\n                if (this.$target == this.$owner.parent)\n                    this.$owner.setSize(this.$owner.$rawWidth, this.$target.$rawHeight + v, true);\n                else\n                    this.$owner.height = this.$target.$rawHeight + v;\n                break;\n            case 16 /* LeftExt_Left */:\n                break;\n            case 17 /* LeftExt_Right */:\n                v = this.$owner.x - (targetX + this.$targetWidth);\n                if (info.percent)\n                    v = (v / this.$targetWidth) * this.$target.$rawWidth;\n                tmp = this.$owner.x;\n                this.$owner.x = targetX + this.$target.$rawWidth + v;\n                this.$owner.width = this.$owner.$rawWidth - (this.$owner.x - tmp);\n                break;\n            case 18 /* RightExt_Left */:\n                break;\n            case 19 /* RightExt_Right */:\n                if (this.$owner.$inProgressBuilding && this.$owner == this.$target.parent)\n                    v = this.$owner.sourceWidth - (targetX + this.$target.$initWidth);\n                else\n                    v = this.$owner.width - (targetX + this.$targetWidth);\n                if (this.$owner != this.$target.parent)\n                    v += this.$owner.x;\n                if (info.percent)\n                    v = (v / this.$targetWidth) * this.$target.$rawWidth;\n                if (this.$owner != this.$target.parent)\n                    this.$owner.width = targetX + this.$target.$rawWidth + v - this.$owner.x;\n                else\n                    this.$owner.width = targetX + this.$target.$rawWidth + v;\n                break;\n            case 20 /* TopExt_Top */:\n                break;\n            case 21 /* TopExt_Bottom */:\n                v = this.$owner.y - (targetY + this.$targetHeight);\n                if (info.percent)\n                    v = (v / this.$targetHeight) * this.$target.$rawHeight;\n                tmp = this.$owner.y;\n                this.$owner.y = targetY + this.$target.$rawHeight + v;\n                this.$owner.height = this.$owner.$rawHeight - (this.$owner.y - tmp);\n                break;\n            case 22 /* BottomExt_Top */:\n                break;\n            case 23 /* BottomExt_Bottom */:\n                if (this.$owner.$inProgressBuilding && this.$owner == this.$target.parent)\n                    v = this.$owner.sourceHeight - (targetY + this.$target.$initHeight);\n                else\n                    v = this.$owner.$rawHeight - (targetY + this.$targetHeight);\n                if (this.$owner != this.$target.parent)\n                    v += this.$owner.y;\n                if (info.percent)\n                    v = (v / this.$targetHeight) * this.$target.$rawHeight;\n                if (this.$owner != this.$target.parent)\n                    this.$owner.height = targetY + this.$target.$rawHeight + v - this.$owner.y;\n                else\n                    this.$owner.height = targetY + this.$target.$rawHeight + v;\n                break;\n        }\n    }\n    addRefTarget(target) {\n        if (target != this.$owner.parent)\n            target.on(\"__xyChanged\" /* XY_CHANGED */, this.$targetXYChanged, this);\n        target.on(\"__sizeChanged\" /* SIZE_CHANGED */, this.$targetSizeChanged, this);\n        target.on(\"__sizeDelayChange\" /* SIZE_DELAY_CHANGE */, this.$targetSizeWillChange, this);\n        this.$targetX = this.$target.x;\n        this.$targetY = this.$target.y;\n        this.$targetWidth = this.$target.$rawWidth;\n        this.$targetHeight = this.$target.$rawHeight;\n    }\n    releaseRefTarget(target) {\n        target.off(\"__xyChanged\" /* XY_CHANGED */, this.$targetXYChanged);\n        target.off(\"__sizeChanged\" /* SIZE_CHANGED */, this.$targetSizeChanged);\n        target.off(\"__sizeDelayChange\" /* SIZE_DELAY_CHANGE */, this.$targetSizeWillChange);\n    }\n    $targetXYChanged(evt) {\n        if (this.$owner.relations.$dealing != null ||\n            (this.$owner.group != null && this.$owner.group.$updating)) {\n            this.$targetX = this.$target.x;\n            this.$targetY = this.$target.y;\n            return;\n        }\n        this.$owner.relations.$dealing = this.$target;\n        let ox = this.$owner.x;\n        let oy = this.$owner.y;\n        let dx = this.$target.x - this.$targetX;\n        let dy = this.$target.y - this.$targetY;\n        this.$defs.forEach(info => {\n            this.applyOnXYChanged(info, dx, dy);\n        }, this);\n        this.$targetX = this.$target.x;\n        this.$targetY = this.$target.y;\n        if (ox != this.$owner.x || oy != this.$owner.y) {\n            ox = this.$owner.x - ox;\n            oy = this.$owner.y - oy;\n            this.$owner.updateGearFromRelations(1 /* XY */, ox, oy);\n            if (this.$owner.parent != null && this.$owner.parent.$transitions.length > 0) {\n                this.$owner.parent.$transitions.forEach(t => {\n                    t.updateFromRelations(this.$owner.id, ox, oy);\n                }, this);\n            }\n        }\n        this.$owner.relations.$dealing = null;\n    }\n    $targetSizeChanged(evt) {\n        if (this.$owner.relations.$dealing != null)\n            return;\n        this.$owner.relations.$dealing = this.$target;\n        let ox = this.$owner.x;\n        let oy = this.$owner.y;\n        let ow = this.$owner.$rawWidth;\n        let oh = this.$owner.$rawHeight;\n        this.$defs.forEach(info => {\n            this.applyOnSizeChanged(info);\n        }, this);\n        this.$targetWidth = this.$target.$rawWidth;\n        this.$targetHeight = this.$target.$rawHeight;\n        if (ox != this.$owner.x || oy != this.$owner.y) {\n            ox = this.$owner.x - ox;\n            oy = this.$owner.y - oy;\n            this.$owner.updateGearFromRelations(1 /* XY */, ox, oy);\n            if (this.$owner.parent != null && this.$owner.parent.$transitions.length > 0) {\n                this.$owner.parent.$transitions.forEach(t => {\n                    t.updateFromRelations(this.$owner.id, ox, oy);\n                }, this);\n            }\n        }\n        if (ow != this.$owner.$rawWidth || oh != this.$owner.$rawHeight) {\n            ow = this.$owner.$rawWidth - ow;\n            oh = this.$owner.$rawHeight - oh;\n            this.$owner.updateGearFromRelations(2 /* Size */, ow, oh);\n        }\n        this.$owner.relations.$dealing = null;\n    }\n    $targetSizeWillChange(evt) {\n        this.$owner.relations.sizeDirty = true;\n    }\n}\n\nclass Relations {\n    constructor(owner) {\n        this.sizeDirty = false;\n        this.$owner = owner;\n        this.$items = [];\n    }\n    add(target, relationType, usePercent = false) {\n        let length = this.$items.length;\n        for (let i = 0; i < length; i++) {\n            let item = this.$items[i];\n            if (item.target == target) {\n                item.add(relationType, usePercent);\n                return;\n            }\n        }\n        let newItem = new RelationItem(this.$owner);\n        newItem.target = target;\n        newItem.add(relationType, usePercent);\n        this.$items.push(newItem);\n    }\n    addItems(target, sidePairs) {\n        let arr = sidePairs.split(',');\n        let s;\n        let usePercent;\n        for (let i = 0; i < 2; i++) {\n            s = arr[i];\n            if (!s)\n                continue;\n            if (s.charAt(s.length - 1) == '%') {\n                s = s.substr(0, s.length - 1);\n                usePercent = true;\n            }\n            else\n                usePercent = false;\n            if (s.indexOf('-') == -1)\n                s = `${s}-${s}`;\n            let t = Relations.RELATION_NAMES.indexOf(s);\n            if (t == -1)\n                throw new Error('Invalid relation type');\n            this.add(target, t, usePercent);\n        }\n    }\n    remove(target, relationType = 0) {\n        let cnt = this.$items.length;\n        let i = 0;\n        while (i < cnt) {\n            let item = this.$items[i];\n            if (item.target == target) {\n                item.remove(relationType);\n                if (item.isEmpty) {\n                    item.dispose();\n                    this.$items.splice(i, 1);\n                    cnt--;\n                }\n                else\n                    i++;\n            }\n            else\n                i++;\n        }\n    }\n    contains(target) {\n        let length = this.$items.length;\n        for (let i = 0; i < length; i++) {\n            if (this.$items[i].target == target)\n                return true;\n        }\n        return false;\n    }\n    clearFor(target) {\n        let cnt = this.$items.length;\n        let i = 0;\n        while (i < cnt) {\n            let item = this.$items[i];\n            if (item.target == target) {\n                item.dispose();\n                this.$items.splice(i, 1);\n                cnt--;\n            }\n            else\n                i++;\n        }\n    }\n    clearAll() {\n        this.$items.forEach(item => {\n            item.dispose();\n        }, this);\n        this.$items.length = 0;\n    }\n    copyFrom(source) {\n        this.clearAll();\n        source.$items.forEach(ri => {\n            let item = new RelationItem(this.$owner);\n            item.copyFrom(ri);\n            this.$items.push(item);\n        }, this);\n    }\n    dispose() {\n        this.clearAll();\n    }\n    onOwnerSizeChanged(dWidth, dHeight) {\n        if (this.$items.length <= 0)\n            return;\n        this.$items.forEach(item => {\n            item.applyOnSelfResized(dWidth, dHeight);\n        }, this);\n    }\n    ensureRelationsSizeCorrect() {\n        if (this.$items.length == 0)\n            return;\n        this.sizeDirty = false;\n        this.$items.forEach(item => {\n            item.target.ensureSizeCorrect();\n        }, this);\n    }\n    get empty() {\n        return this.$items.length == 0;\n    }\n    setup(xml) {\n        xml.children.forEach(cxml => {\n            if (cxml.nodeName != 'relation')\n                return;\n            let targetId;\n            let target;\n            targetId = cxml.attributes.target;\n            if (this.$owner.parent) {\n                if (targetId)\n                    target = this.$owner.parent.getChildById(targetId);\n                else\n                    target = this.$owner.parent;\n            }\n            else {\n                //call from the component's constructor\n                target = this.$owner.getChildById(targetId);\n            }\n            if (target)\n                this.addItems(target, cxml.attributes.sidePair);\n        }, this);\n    }\n}\nRelations.RELATION_NAMES = [\n    'left-left',\n    'left-center',\n    'left-right',\n    'center-center',\n    'right-left',\n    'right-center',\n    'right-right',\n    'top-top',\n    'top-middle',\n    'top-bottom',\n    'middle-middle',\n    'bottom-top',\n    'bottom-middle',\n    'bottom-bottom',\n    'width-width',\n    'height-height',\n    'leftext-left',\n    'leftext-right',\n    'rightext-left',\n    'rightext-right',\n    'topext-top',\n    'topext-bottom',\n    'bottomext-top',\n    'bottomext-bottom' //23\n];\n\nlet isColorGear = function (obj) {\n    return obj && \"color\" in obj;\n};\n\nclass GearColor extends GearBase {\n    constructor(owner) {\n        super(owner);\n        this.$default = '#ffffff';\n    }\n    init() {\n        this.$default = this.$owner['color'];\n        this.$storage = {};\n    }\n    addStatus(pageId, value) {\n        if (value == '-')\n            return;\n        let col = value;\n        if (pageId == null)\n            this.$default = col;\n        else\n            this.$storage[pageId] = col;\n    }\n    apply() {\n        this.$owner.$gearLocked = true;\n        let data = this.$storage[this.$controller.selectedPageId];\n        if (data != undefined)\n            this.$owner['color'] = StringUtil.HEX2RGB(data);\n        else\n            this.$owner['color'] = StringUtil.HEX2RGB(this.$default);\n        this.$owner.$gearLocked = false;\n    }\n    updateState() {\n        if (this.$controller == null || this.$owner.$gearLocked || this.$owner.$inProgressBuilding)\n            return;\n        this.$storage[this.$controller.selectedPageId] = this.$owner['color'];\n    }\n}\n\nlet isAnimationGear = function (obj) {\n    return obj && \"playing\" in obj && \"frame\" in obj;\n};\n\nclass GearAnimation extends GearBase {\n    constructor(owner) {\n        super(owner);\n    }\n    init() {\n        this.$default = new GearAnimationValue(this.$owner['playing'], this.$owner['frame']);\n        this.$storage = {};\n    }\n    addStatus(pageId, value) {\n        if (value == '-')\n            return;\n        let gv;\n        if (pageId == null)\n            gv = this.$default;\n        else {\n            gv = new GearAnimationValue();\n            this.$storage[pageId] = gv;\n        }\n        let arr = value.split(',');\n        gv.frame = parseInt(arr[0]);\n        gv.playing = arr[1] == 'p';\n    }\n    apply() {\n        this.$owner.$gearLocked = true;\n        let gv = this.$storage[this.$controller.selectedPageId];\n        if (!gv)\n            gv = this.$default;\n        this.$owner['frame'] = gv.frame;\n        this.$owner['playing'] = gv.playing;\n        this.$owner.$gearLocked = false;\n    }\n    updateState() {\n        if (this.$controller == null || this.$owner.$gearLocked || this.$owner.$inProgressBuilding)\n            return;\n        let gv = this.$storage[this.$controller.selectedPageId];\n        if (!gv) {\n            gv = new GearAnimationValue();\n            this.$storage[this.$controller.selectedPageId] = gv;\n        }\n        gv.frame = this.$owner['frame'];\n        gv.playing = this.$owner['playing'];\n    }\n}\nclass GearAnimationValue {\n    constructor(playing = true, frame = 0) {\n        this.playing = playing;\n        this.frame = frame;\n    }\n}\n\nclass Sprite extends createjs.DisplayObject {\n    constructor() {\n        super();\n        this.$tint = '#fff';\n        this.$isTrim = false;\n    }\n    get tint() {\n        return this.$tint;\n    }\n    set tint(v) {\n        this.$tint = v;\n        let rgb = v.split(',');\n        this.filters = [\n            new createjs.ColorFilter(+rgb[0] / 255, +rgb[1] / 255, +rgb[2] / 255, 1, 0, 0, 0, 1)\n        ];\n    }\n    set sourceRect(rect) {\n        this.$sourceRect = rect;\n    }\n    get sourceRect() {\n        return this.$sourceRect;\n    }\n    set textureRect(rect) {\n        this.$textureRect = rect;\n    }\n    get textureRect() {\n        return this.$textureRect;\n    }\n    isVisible() {\n        var hasContent = this.cacheCanvas ||\n            (this.texture &&\n                (this.texture['naturalWidth'] ||\n                    this.texture['getContext'] ||\n                    this.texture['readyState'] >= 2));\n        return !!(this.visible && this.alpha > 0 && this.scaleX != 0 && this.scaleY != 0 && hasContent);\n    }\n    getBounds() {\n        var rect = super.getBounds();\n        if (rect) {\n            return rect;\n        }\n        var texture = this.texture, o = this.sourceRect || texture;\n        var hasContent = texture && (texture['naturalWidth'] || texture['getContext'] || texture['readyState'] >= 2);\n        return hasContent ? this.sourceRect.setValues(0, 0, o.width, o.height) : null;\n    }\n    destroy() {\n        //todo\n    }\n}\nSprite.$cachedTexturePool = {};\n\nclass GearIcon extends GearBase {\n    constructor(owner) {\n        super(owner);\n    }\n    init() {\n        this.$default = this.$owner.icon;\n        this.$storage = {};\n    }\n    addStatus(pageId, value) {\n        if (pageId == null)\n            this.$default = value;\n        else\n            this.$storage[pageId] = value;\n    }\n    apply() {\n        this.$owner.$gearLocked = true;\n        let data = this.$storage[this.$controller.selectedPageId];\n        if (data != undefined)\n            this.$owner.icon = data;\n        else\n            this.$owner.icon = this.$default;\n        this.$owner.$gearLocked = false;\n    }\n    updateState() {\n        if (this.$controller == null || this.$owner.$gearLocked || this.$owner.$inProgressBuilding)\n            return;\n        this.$storage[this.$controller.selectedPageId] = this.$owner.icon;\n    }\n}\n\nclass GearText extends GearBase {\n    constructor(owner) {\n        super(owner);\n    }\n    init() {\n        this.$default = this.$owner.text;\n        this.$storage = {};\n    }\n    addStatus(pageId, value) {\n        if (pageId == null)\n            this.$default = value;\n        else\n            this.$storage[pageId] = value;\n    }\n    apply() {\n        this.$owner.$gearLocked = true;\n        let data = this.$storage[this.$controller.selectedPageId];\n        if (data != undefined)\n            this.$owner.text = data;\n        else\n            this.$owner.text = this.$default;\n        this.$owner.$gearLocked = false;\n    }\n    updateState() {\n        if (this.$controller == null || this.$owner.$gearLocked || this.$owner.$inProgressBuilding)\n            return;\n        this.$storage[this.$controller.selectedPageId] = this.$owner.text;\n    }\n}\n\nclass GObject extends createjs.EventDispatcher {\n    constructor() {\n        super();\n        this.$x = 0;\n        this.$y = 0;\n        this.$width = 0;\n        this.$height = 0;\n        this.$alpha = 1;\n        this.$rotation = 0;\n        this.$visible = true;\n        this.$touchable = true;\n        this.$grayed = false;\n        this.$draggable = false;\n        this.$scaleX = 1;\n        this.$scaleY = 1;\n        this.$skewX = 0;\n        this.$skewY = 0;\n        this.$pivot = new createjs.Point();\n        this.$pivotAsAnchor = false;\n        this.$pivotOffset = new createjs.Point();\n        this.$sortingOrder = 0;\n        this.$internalVisible = true;\n        this.$focusable = false;\n        this.$pixelSnapping = false;\n        this.$handlingController = false;\n        this.$lastColorComponents = null;\n        this.$displayEventMap = {};\n        /**@internal */\n        this.$rawWidth = 0;\n        /**@internal */\n        this.$rawHeight = 0;\n        /**@internal */\n        this.$initWidth = 0;\n        /**@internal */\n        this.$initHeight = 0;\n        this.$sourceWidth = 0;\n        this.$sourceHeight = 0;\n        this.$id = `${GObject.gInstanceCounter++}`;\n        this.$name = '';\n        this.createDisplayObject();\n        this.$relations = new Relations(this);\n        this.$gears = [];\n        this.$touchable = true;\n    }\n    get id() {\n        return this.$id;\n    }\n    get name() {\n        return this.$name;\n    }\n    set name(value) {\n        this.$name = value;\n    }\n    get x() {\n        return this.$x;\n    }\n    set x(value) {\n        this.setXY(value, this.$y);\n    }\n    get y() {\n        return this.$y;\n    }\n    set y(value) {\n        this.setXY(this.$x, value);\n    }\n    setXY(xv, yv) {\n        if (this.$x != xv || this.$y != yv) {\n            this.$x = xv;\n            this.$y = yv;\n            this.handleXYChanged();\n            this.updateGear(1 /* XY */);\n            if (this.$parent) {\n                this.$parent.setBoundsChangedFlag();\n                let evt = new createjs.Event(\"__xyChanged\" /* XY_CHANGED */, true, false);\n                this.$displayObject.dispatchEvent(evt, this);\n            }\n            if (GObject.draggingObject == this && !GObject.sUpdatingWhileDragging)\n                this.localToGlobalRect(0, 0, this.width, this.height, GObject.sGlobalRect);\n        }\n    }\n    get pixelSnapping() {\n        return this.$pixelSnapping;\n    }\n    set pixelSnapping(value) {\n        if (this.$pixelSnapping != value) {\n            this.$pixelSnapping = value;\n            this.handleXYChanged();\n        }\n    }\n    center(restraint = false) {\n        let r;\n        if (this.$parent != null)\n            r = this.parent;\n        else\n            r = Decls$1.GRoot.inst;\n        this.setXY((r.width - this.width) / 2, (r.height - this.height) / 2);\n        if (restraint) {\n            this.addRelation(r, 3 /* Center_Center */);\n            this.addRelation(r, 10 /* Middle_Middle */);\n        }\n    }\n    get width() {\n        this.ensureSizeCorrect();\n        if (this.$relations.sizeDirty)\n            this.$relations.ensureRelationsSizeCorrect();\n        return this.$width;\n    }\n    set width(value) {\n        this.setSize(value, this.$rawHeight);\n    }\n    get height() {\n        this.ensureSizeCorrect();\n        if (this.$relations.sizeDirty)\n            this.$relations.ensureRelationsSizeCorrect();\n        return this.$height;\n    }\n    set height(value) {\n        this.setSize(this.$rawWidth, value);\n    }\n    setSize(wv, hv, ignorePivot = false) {\n        if (this.$rawWidth != wv || this.$rawHeight != hv) {\n            this.$rawWidth = wv;\n            this.$rawHeight = hv;\n            wv = Math.max(0, wv);\n            hv = Math.max(0, hv);\n            let diffw = wv - this.mapPivotWidth(1);\n            let diffh = hv - this.mapPivotHeight(1);\n            this.$width = wv;\n            this.$height = hv;\n            this.handleSizeChanged();\n            if (this.$pivot.x != 0 || this.$pivot.y != 0) {\n                if (!this.$pivotAsAnchor) {\n                    if (!ignorePivot)\n                        this.setXY(this.x - this.$pivot.x * diffw, this.y - this.$pivot.y * diffh);\n                    this.updatePivotOffset();\n                }\n                else {\n                    this.applyPivot();\n                }\n            }\n            this.updateGear(2 /* Size */);\n            if (this.$parent) {\n                this.$relations.onOwnerSizeChanged(diffw, diffh);\n                this.$parent.setBoundsChangedFlag();\n            }\n            let evt = new createjs.Event(\"__sizeChanged\" /* SIZE_CHANGED */, true, false);\n            this.$displayObject.dispatchEvent(evt, this);\n        }\n    }\n    ensureSizeCorrect() { }\n    get sourceHeight() {\n        return this.$sourceHeight;\n    }\n    get sourceWidth() {\n        return this.$sourceWidth;\n    }\n    get initHeight() {\n        return this.$initHeight;\n    }\n    get initWidth() {\n        return this.$initWidth;\n    }\n    get actualWidth() {\n        return this.width * Math.abs(this.$scaleX);\n    }\n    get actualHeight() {\n        return this.height * Math.abs(this.$scaleY);\n    }\n    get scaleX() {\n        return this.$scaleX;\n    }\n    set scaleX(value) {\n        this.setScale(value, this.$scaleY);\n    }\n    get scaleY() {\n        return this.$scaleY;\n    }\n    set scaleY(value) {\n        this.setScale(this.$scaleX, value);\n    }\n    setScale(sx, sy) {\n        if (this.$scaleX != sx || this.$scaleY != sy) {\n            this.$scaleX = sx;\n            this.$scaleY = sy;\n            this.handleScaleChanged();\n            this.applyPivot();\n            this.updateGear(2 /* Size */);\n        }\n    }\n    get skewX() {\n        return this.$skewX;\n    }\n    set skewX(value) {\n        this.setSkew(value, this.$skewY);\n    }\n    get skewY() {\n        return this.$skewY;\n    }\n    set skewY(value) {\n        this.setSkew(this.$skewX, value);\n    }\n    setSkew(xv, yv) {\n        if (this.$skewX != xv || this.$skewY != yv) {\n            this.$skewX = xv;\n            this.$skewY = yv;\n            this.$displayObject.skewX = xv;\n            this.$displayObject.skewY = yv;\n            this.applyPivot();\n        }\n    }\n    mapPivotWidth(scale) {\n        return scale * this.$width;\n    }\n    mapPivotHeight(scale) {\n        return scale * this.$height;\n    }\n    get pivotX() {\n        return this.$pivot.x;\n    }\n    get pivotY() {\n        return this.$pivot.y;\n    }\n    set pivotX(value) {\n        this.setPivot(value, this.pivotY);\n    }\n    set pivotY(value) {\n        this.setPivot(this.pivotX, value);\n    }\n    setPivot(xv, yv, asAnchor = false) {\n        if (this.$pivot.x != xv || this.$pivot.y != yv || this.$pivotAsAnchor != asAnchor) {\n            this.$pivot.setValues(xv, yv);\n            this.$pivotAsAnchor = asAnchor;\n            this.updatePivotOffset();\n            this.handleXYChanged();\n        }\n    }\n    internalSetPivot(xv, yv, asAnchor) {\n        this.$pivot.setValues(xv, yv);\n        this.$pivotAsAnchor = asAnchor;\n        if (asAnchor)\n            this.handleXYChanged();\n    }\n    updatePivotOffset() {\n        let transform = this.$displayObject.getMatrix();\n        if (this.$pivot.x != 0 || (this.$pivot.y != 0 && transform)) {\n            let vx = this.mapPivotWidth(this.$pivot.x), vy = this.mapPivotHeight(this.$pivot.y);\n            GObject.sHelperPoint.setValues(vx, vy);\n            let p = transform.transformPoint(GObject.sHelperPoint.x, GObject.sHelperPoint.y);\n            (p.x -= transform.tx), (p.y -= transform.ty);\n            let offsetX = this.$pivot.x * this.$width - p.x;\n            let offsetY = this.$pivot.y * this.$height - p.y;\n            this.$pivotOffset.setValues(offsetX, offsetY);\n        }\n        else\n            this.$pivotOffset.setValues(0, 0);\n    }\n    applyPivot() {\n        if (this.$pivot.x != 0 || this.$pivot.y != 0) {\n            this.updatePivotOffset();\n            this.handleXYChanged();\n        }\n    }\n    get touchable() {\n        return this.$touchable;\n    }\n    set touchable(value) {\n        this.$touchable = value;\n        if (this.$touchable) {\n            this.$displayObject.mouseEnabled = true;\n        }\n        else {\n            this.$displayObject.mouseEnabled = false;\n        }\n    }\n    get grayed() {\n        return this.$grayed;\n    }\n    set grayed(value) {\n        if (this.$grayed != value) {\n            this.$grayed = value;\n            this.handleGrayedChanged();\n            this.updateGear(3 /* Look */);\n        }\n    }\n    get enabled() {\n        return !this.$grayed && this.$touchable;\n    }\n    set enabled(value) {\n        this.grayed = !value;\n        this.touchable = value;\n    }\n    get rotation() {\n        return this.$rotation;\n    }\n    set rotation(value) {\n        if (this.$rotation != value) {\n            this.$rotation = value;\n            if (this.$displayObject)\n                this.$displayObject.rotation = value;\n            this.applyPivot();\n            this.updateGear(3 /* Look */);\n        }\n    }\n    get normalizeRotation() {\n        let rot = this.$rotation % 360;\n        if (rot > 180)\n            rot -= 360;\n        else if (rot < -180)\n            rot += 360;\n        return rot;\n    }\n    get alpha() {\n        return this.$alpha;\n    }\n    set alpha(value) {\n        if (this.$alpha != value) {\n            this.$alpha = value;\n            this.updateAlpha();\n        }\n    }\n    updateAlpha() {\n        if (this.$displayObject)\n            this.$displayObject.alpha = this.$alpha;\n        this.updateGear(3 /* Look */);\n    }\n    get visible() {\n        return this.$visible;\n    }\n    set visible(value) {\n        if (this.$visible != value) {\n            this.$visible = value;\n            if (this.$displayObject)\n                this.$displayObject.visible = this.$visible;\n            if (this.$parent) {\n                this.$parent.childStateChanged(this);\n                this.$parent.setBoundsChangedFlag();\n            }\n            let event = new createjs.Event(\"__visibleChanged\" /* VISIBLE_CHANGED */, true, false);\n            event.data = { visible: this.$visible };\n            this.dispatchEvent(event, this);\n        }\n    }\n    /**@internal */\n    set internalVisible(value) {\n        if (value != this.$internalVisible) {\n            this.$internalVisible = value;\n            if (this.$parent)\n                this.$parent.childStateChanged(this);\n        }\n    }\n    /**@internal */\n    get internalVisible() {\n        return this.$internalVisible;\n    }\n    get finalVisible() {\n        return this.$visible && this.$internalVisible && (!this.$group || this.$group.finalVisible);\n    }\n    get sortingOrder() {\n        return this.$sortingOrder;\n    }\n    set sortingOrder(value) {\n        if (value < 0)\n            value = 0;\n        if (this.$sortingOrder != value) {\n            let old = this.$sortingOrder;\n            this.$sortingOrder = value;\n            if (this.$parent != null)\n                this.$parent.childSortingOrderChanged(this, old, this.$sortingOrder);\n        }\n    }\n    get focusable() {\n        return this.$focusable;\n    }\n    set focusable(value) {\n        this.$focusable = value;\n    }\n    get focused() {\n        return Decls$1.GRoot.inst.focus == this;\n    }\n    requestFocus() {\n        let p = this;\n        while (p && !p.$focusable)\n            p = p.parent;\n        if (p != null)\n            Decls$1.GRoot.inst.focus = p;\n    }\n    get tooltips() {\n        return this.$tooltips;\n    }\n    set tooltips(value) {\n        this.$tooltips = value;\n    }\n    get blendMode() {\n        if (this.$displayObject && this.$displayObject instanceof Sprite)\n            return BlendModeMap[this.$displayObject.compositeOperation] || 'None';\n        return BlendModeMap[0]; //Normal\n    }\n    set blendMode(value) {\n        if (!value || !value.length || !this.$displayObject || !(this.$displayObject instanceof Sprite))\n            return;\n        for (let i = 0; i < BlendModeMap.length; i++) {\n            if (BlendModeMap[i].toLowerCase() === value.toLowerCase()) {\n                this.$displayObject.compositeOperation = BlendModeMap[i];\n                return;\n            }\n        }\n    }\n    get filters() {\n        return this.$displayObject.filters;\n    }\n    set filters(value) {\n        this.$displayObject.filters = value;\n    }\n    get inContainer() {\n        return this.$displayObject.parent != null;\n    }\n    static isDisplayObjectOnStage(display) {\n        if (!display || !display.parent)\n            return false;\n        let p = display;\n        while (p != null) {\n            if (p == Decls$1.GRoot.inst.nativeStage)\n                return true;\n            p = p.parent;\n        }\n        return false;\n    }\n    get onStage() {\n        return GObject.isDisplayObjectOnStage(this.$displayObject);\n    }\n    get resourceURL() {\n        if (this.packageItem != null)\n            return `ui://${this.packageItem.owner.id}${this.packageItem.id}`;\n        else\n            return null;\n    }\n    set group(value) {\n        this.$group = value;\n    }\n    get group() {\n        return this.$group;\n    }\n    getGear(index) {\n        let gear = this.$gears[index];\n        if (gear == null) {\n            switch (index) {\n                case 0 /* Display */:\n                    gear = new GearDisplay(this);\n                    break;\n                case 1 /* XY */:\n                    gear = new GearXY(this);\n                    break;\n                case 2 /* Size */:\n                    gear = new GearSize(this);\n                    break;\n                case 3 /* Look */:\n                    gear = new GearLook(this);\n                    break;\n                case 4 /* Color */:\n                    if (isColorGear(this))\n                        gear = new GearColor(this);\n                    else\n                        throw new Error(`Invalid component type to add GearColor feature, please check the component named ${this.$name} in the Editor.`);\n                    break;\n                case 5 /* Animation */:\n                    if (isAnimationGear(this))\n                        gear = new GearAnimation(this);\n                    else\n                        throw new Error(`Invalid component type to add GearAnimation feature, please check the component named ${this.$name} in the Editor.`);\n                    break;\n                case 6 /* Text */:\n                    gear = new GearText(this);\n                    break;\n                case 7 /* Icon */:\n                    gear = new GearIcon(this);\n                    break;\n                default:\n                    throw new Error('FGUI: invalid gear type');\n            }\n            this.$gears[index] = gear;\n        }\n        return gear;\n    }\n    updateGear(index) {\n        if (this.$gears[index] != null)\n            this.$gears[index].updateState();\n    }\n    updateGearFromRelations(index, dx, dy) {\n        if (this.$gears[index] != null)\n            this.$gears[index].updateFromRelations(dx, dy);\n    }\n    hasGearController(index, c) {\n        return this.$gears[index] && this.$gears[index].controller == c;\n    }\n    /**@internal */\n    lockGearDisplay() {\n        let g = this.$gears[0];\n        if (g && g.controller) {\n            let ret = g.lock();\n            this.checkGearVisible();\n            return ret;\n        }\n        else\n            return 0;\n    }\n    /**@internal */\n    releaseGearDisplay(token) {\n        let g = this.$gears[0];\n        if (g && g.controller) {\n            g.release(token);\n            this.checkGearVisible();\n        }\n    }\n    checkGearVisible() {\n        if (this.$handlingController)\n            return;\n        let g = this.$gears[0];\n        let v = !g || g.connected;\n        if (v != this.$internalVisible) {\n            this.$internalVisible = v;\n            if (this.$parent)\n                this.$parent.childStateChanged(this);\n        }\n    }\n    get gearXY() {\n        return this.getGear(1 /* XY */);\n    }\n    get gearSize() {\n        return this.getGear(2 /* Size */);\n    }\n    get gearLook() {\n        return this.getGear(3 /* Look */);\n    }\n    get relations() {\n        return this.$relations;\n    }\n    addRelation(target, relationType, usePercent = false) {\n        this.$relations.add(target, relationType, usePercent);\n    }\n    removeRelation(target, relationType = 0) {\n        this.$relations.remove(target, relationType);\n    }\n    get displayObject() {\n        return this.$displayObject;\n    }\n    createDisplayObject() { }\n    setDisplayObject(value) {\n        this.$displayObject = value;\n    }\n    get parent() {\n        return this.$parent;\n    }\n    set parent(val) {\n        this.$parent = val;\n    }\n    removeFromParent() {\n        if (this.$parent)\n            this.$parent.removeChild(this);\n    }\n    /** @virtual */\n    get text() {\n        return null;\n    }\n    /** @virtual */\n    set text(value) { }\n    /** @virtual */\n    get icon() {\n        return null;\n    }\n    /** @virtual */\n    set icon(value) { }\n    dispose() {\n        this.removeFromParent();\n        this.$relations.dispose();\n        this.removeAllListeners();\n        this.$mouseMoveEvent = Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Move, this.$moving);\n        this.$mouseUpEvent = Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Up, this.$end);\n        this.$mouseMove2Event = Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Move, this.$moving2);\n        this.$mouseUp2Event = Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Up, this.$end2);\n        // this.$displayObject.destroy();  //cjs not the destroy API\n    }\n    click(listener, thisObj) {\n        this.on(InteractiveEvents.Click, listener, thisObj);\n    }\n    removeClick(listener) {\n        this.off(InteractiveEvents.Click, listener);\n    }\n    hasClick(fn) {\n        return this.hasListener(InteractiveEvents.Click);\n    }\n    on(type, listener, thisObject, once = false) {\n        if (type == null)\n            return this;\n        let fn = this.$displayObject.on(type, listener, thisObject, once);\n        this.$displayEventMap[type] = fn;\n        return this;\n    }\n    off(type, listener) {\n        if (this.$displayObject.hasEventListener(type)) {\n            this.$displayObject.off(type, this.$displayEventMap[type]);\n        }\n    }\n    once(type, listener, thisObject) {\n        if (type == null)\n            return this;\n        this.on(type, listener, thisObject, true);\n    }\n    hasListener(event) {\n        //do we need to also check the context?\n        // super.hasEventListener(event)\n        return this.$displayObject.hasEventListener(event);\n    }\n    dispatchEvent(event, ...args) {\n        // super.dispatchEvent(event, args)\n        if (!args || args.length <= 0)\n            args = [event];\n        else\n            args.unshift(event);\n        return this.$displayObject.dispatchEvent(event, this.$displayObject);\n    }\n    removeAllListeners(type) {\n        this.removeAllEventListeners(type);\n    }\n    get draggable() {\n        return this.$draggable;\n    }\n    set draggable(value) {\n        if (this.$draggable != value) {\n            this.$draggable = value;\n            this.initDrag();\n        }\n    }\n    get dragBounds() {\n        return this.$dragBounds;\n    }\n    set dragBounds(value) {\n        this.$dragBounds = value;\n    }\n    startDrag(touchPointID = -1) {\n        if (!this.onStage)\n            return;\n        this.dragBegin();\n    }\n    stopDrag() {\n        this.dragEnd();\n    }\n    get dragging() {\n        return GObject.draggingObject == this;\n    }\n    localToGlobal(ax = 0, ay = 0, resultPoint) {\n        if (this.$pivotAsAnchor) {\n            ax += this.$pivot.x * this.$width;\n            ay += this.$pivot.y * this.$height;\n        }\n        if (!resultPoint)\n            resultPoint = GObject.sHelperPoint;\n        resultPoint.x = ax;\n        resultPoint.y = ay;\n        return this.$displayObject.localToGlobal(resultPoint.x, resultPoint.y);\n    }\n    globalToLocal(ax = 0, ay = 0, resultPoint) {\n        if (!resultPoint)\n            resultPoint = GObject.sHelperPoint;\n        resultPoint.setValues(ax, ay);\n        resultPoint = this.$displayObject.globalToLocal(resultPoint.x, resultPoint.y);\n        if (this.$pivotAsAnchor) {\n            resultPoint.x -= this.$pivot.x * this.$width;\n            resultPoint.y -= this.$pivot.y * this.$height;\n        }\n        return resultPoint;\n    }\n    localToRoot(ax = 0, ay = 0, resultPoint) {\n        let pt = this.localToGlobal(ax, ay, resultPoint);\n        pt.x /= Decls$1.GRoot.inst.contentScaleFactor;\n        pt.y /= Decls$1.GRoot.inst.contentScaleFactor;\n        return pt;\n    }\n    rootToLocal(ax = 0, ay = 0, resultPoint) {\n        ax *= Decls$1.GRoot.inst.contentScaleFactor;\n        ay *= Decls$1.GRoot.inst.contentScaleFactor;\n        return this.globalToLocal(ax, ay, resultPoint);\n    }\n    localToGlobalRect(ax = 0, ay = 0, aWidth = 0, aHeight = 0, resultRect) {\n        if (resultRect == null)\n            resultRect = GObject.sDragHelperRect;\n        let pt = this.localToGlobal(ax, ay);\n        resultRect.x = pt.x;\n        resultRect.y = pt.y;\n        resultRect.width = aWidth;\n        resultRect.height = aHeight;\n        return resultRect;\n    }\n    globalToLocalRect(ax = 0, ay = 0, aWidth = 0, aHeight = 0, resultRect) {\n        if (resultRect == null)\n            resultRect = GObject.sDragHelperRect;\n        let pt = this.globalToLocal(ax, ay);\n        resultRect.x = pt.x;\n        resultRect.y = pt.y;\n        resultRect.width = aWidth;\n        resultRect.height = aHeight;\n        return resultRect;\n    }\n    handleControllerChanged(c) {\n        this.$handlingController = true;\n        for (let i = 0; i < 8 /* Count */; i++) {\n            let gear = this.$gears[i];\n            if (gear != null && gear.controller == c)\n                gear.apply();\n        }\n        this.$handlingController = false;\n        this.checkGearVisible();\n    }\n    switchDisplayObject(newObj) {\n        if (newObj == this.$displayObject)\n            return;\n        let old = this.$displayObject;\n        if (this.inContainer) {\n            let i = this.$displayObject.parent.getChildIndex(this.$displayObject);\n            this.$displayObject.parent.addChildAt(newObj, i);\n            this.$displayObject.parent.removeChild(this.$displayObject);\n        }\n        this.$displayObject = newObj;\n        this.$displayObject.x = old.x;\n        this.$displayObject.y = old.y;\n        this.$displayObject.rotation = old.rotation;\n        this.$displayObject.alpha = old.alpha;\n        this.$displayObject.visible = old.visible;\n        this.$displayObject.scaleX = old.scaleX;\n        this.$displayObject.scaleY = old.scaleY;\n        this.$displayObject.mouseEnabled = old.mouseEnabled;\n    }\n    handleXYChanged() {\n        if (this.$displayObject) {\n            let xv = this.$x;\n            let yv = this.$y;\n            if (this.$pivotAsAnchor) {\n                xv -= this.$pivot.x * this.$width;\n                yv -= this.$pivot.y * this.$height;\n            }\n            if (this.$pixelSnapping) {\n                xv = Math.round(xv);\n                yv = Math.round(yv);\n            }\n            this.$displayObject.x = xv + this.$pivotOffset.x;\n            this.$displayObject.y = yv + this.$pivotOffset.y;\n        }\n    }\n    handleSizeChanged() { }\n    handleScaleChanged() {\n        if (this.$displayObject)\n            this.$displayObject.scaleX = this.$scaleX;\n        this.$displayObject.scaleY = this.$scaleY;\n    }\n    get colorFilter() {\n        if (this.$colorFilter)\n            return this.$colorFilter;\n        /**\n         * todo\n         */\n        var matrix = new createjs.ColorMatrix();\n        this.$colorFilter = new createjs.ColorMatrixFilter(matrix);\n        if (this.$displayObject) {\n            let a = this.$displayObject.filters || [];\n            a.push(this.$colorFilter);\n            this.$displayObject.filters = a;\n        }\n        return this.$colorFilter;\n    }\n    /**\n     * update color appearance\n     * @param brightness value of the brigthness (-1 - 1, where -1 is black)\n     * @param contrast value of the contrast (-1 - 1)\n     * @param saturate The saturation amount (-1 - 1)\n     * @param hue The hue property of the color in degress (-1 - 1, where 1 is 360deg)\n     */\n    updateColorComponents(brightness, contrast, saturate, hue) {\n        var matrix = new createjs.ColorMatrix()\n            .adjustBrightness(brightness)\n            .adjustContrast(contrast * 100)\n            .adjustHue(hue * 180)\n            .adjustSaturation(saturate * 100);\n        this.$displayObject.filters = [new createjs.ColorMatrixFilter(matrix)];\n        this.$displayObject.cache(0, 0, this.$width, this.$height);\n        if (!this.$lastColorComponents)\n            this.$lastColorComponents = [];\n        this.$lastColorComponents.length = 0;\n        this.$lastColorComponents.push(brightness, contrast, saturate, hue);\n    }\n    handleGrayedChanged() {\n        if (this.$displayObject) {\n            if (this.$grayed) {\n                var Grayscale = new createjs.ColorMatrixFilter([\n                    0.3, 0.3, 0.3, 0, 0,\n                    0.3, 0.3, 0.3, 0, 0,\n                    0.3, 0.3, 0.3, 0, 0,\n                    0, 0, 0, 1, 0 // alpha\n                ]);\n                this.$displayObject.filters = [Grayscale];\n                this.$displayObject.cache(0, 0, this.$width, this.$height);\n            }\n            else {\n                if (this.$lastColorComponents && this.$lastColorComponents.length >= 4)\n                    this.updateColorComponents(this.$lastColorComponents[0], this.$lastColorComponents[1], this.$lastColorComponents[2], this.$lastColorComponents[3]);\n                else\n                    this.$displayObject.filters = [];\n            }\n        }\n    }\n    /**@internal */\n    constructFromResource() {\n    }\n    setupBeforeAdd(xml) {\n        let str;\n        let arr;\n        this.$id = xml.attributes.id;\n        this.$name = xml.attributes.name;\n        str = xml.attributes.xy;\n        arr = str.split(',');\n        this.setXY(parseInt(arr[0]), parseInt(arr[1]));\n        str = xml.attributes.size;\n        if (str) {\n            arr = str.split(',');\n            this.$initWidth = parseInt(arr[0]);\n            this.$initHeight = parseInt(arr[1]);\n            this.setSize(this.$initWidth, this.$initHeight, true);\n        }\n        str = xml.attributes.scale;\n        if (str) {\n            arr = str.split(',');\n            this.setScale(parseFloat(arr[0]), parseFloat(arr[1]));\n        }\n        str = xml.attributes.rotation;\n        if (str)\n            this.rotation = parseInt(str);\n        str = xml.attributes.skew;\n        if (str) {\n            arr = str.split(',');\n            this.setSkew(parseFloat(arr[0]), parseFloat(arr[1]));\n        }\n        str = xml.attributes.pivot;\n        if (str) {\n            arr = str.split(',');\n            let n1 = parseFloat(arr[0]), n2 = parseFloat(arr[1]);\n            str = xml.attributes.anchor;\n            this.setPivot(n1, n2, str == 'true');\n        }\n        str = xml.attributes.alpha;\n        if (str)\n            this.alpha = parseFloat(str);\n        if (xml.attributes.touchable == 'false')\n            this.touchable = false;\n        if (xml.attributes.visible == 'false')\n            this.visible = false;\n        if (xml.attributes.grayed == 'true')\n            this.grayed = true;\n        this.tooltips = xml.attributes.tooltips;\n        str = xml.attributes.blend;\n        if (str)\n            this.blendMode = str;\n        str = xml.attributes.filter;\n        if (str) {\n            switch (str) {\n                case 'color':\n                    str = xml.attributes.filterData;\n                    arr = str.split(',');\n                    this.updateColorComponents(parseFloat(arr[0]), parseFloat(arr[1]), parseFloat(arr[2]), parseFloat(arr[3]));\n                    break;\n            }\n        }\n    }\n    setupAfterAdd(xml) {\n        let str = xml.attributes.group;\n        if (str)\n            this.$group = this.$parent.getChildById(str);\n        let col = xml.children;\n        col.forEach(cxml => {\n            let index = GearXMLNodeNameMap[cxml.nodeName];\n            if (index != void 0)\n                this.getGear(index).setup(cxml);\n        }, this);\n    }\n    static castFromNativeObject(disp) {\n        if (isUIObject(disp))\n            return disp.UIOwner;\n        return null;\n    }\n    initDrag() {\n        if (this.$draggable)\n            this.on(InteractiveEvents.Down, this.$touchBegin, this);\n        else\n            this.off(InteractiveEvents.Down, this.$touchBegin);\n    }\n    dragBegin() {\n        if (GObject.draggingObject != null)\n            GObject.draggingObject.stopDrag();\n        GObject.sGlobalDragStart.x = Decls$1.GRoot.globalMouseStatus.mouseX;\n        GObject.sGlobalDragStart.y = Decls$1.GRoot.globalMouseStatus.mouseY;\n        this.localToGlobalRect(0, 0, this.width, this.height, GObject.sGlobalRect);\n        GObject.draggingObject = this;\n        this.$mouseMove2Event = Decls$1.GRoot.inst.nativeStage.on(InteractiveEvents.Move, this.$moving2, this);\n        this.$mouseUp2Event = Decls$1.GRoot.inst.nativeStage.on(InteractiveEvents.Up, this.$end2, this);\n    }\n    dragEnd() {\n        if (GObject.draggingObject == this) {\n            Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Move, this.$mouseMove2Event);\n            Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Up, this.$mouseUp2Event);\n            GObject.draggingObject = null;\n        }\n        GObject.$dragBeginCancelled = true;\n    }\n    reset() {\n        Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Move, this.$mouseMoveEvent);\n        Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Up, this.$mouseUpEvent);\n    }\n    $touchBegin(evt) {\n        if (this.$touchDownPoint == null)\n            this.$touchDownPoint = new createjs.Point();\n        this.$touchDownPoint.x = evt.stageX;\n        this.$touchDownPoint.y = evt.stageY;\n        this.$mouseMoveEvent = Decls$1.GRoot.inst.nativeStage.on(InteractiveEvents.Move, this.$moving, this);\n        this.$mouseUpEvent = Decls$1.GRoot.inst.nativeStage.on(InteractiveEvents.Up, this.$end, this);\n    }\n    $end(evt) {\n        this.reset();\n    }\n    $moving(evt) {\n        // console.log(\"moving\");\n        let sensitivity = UIConfig.touchDragSensitivity;\n        if (this.$touchDownPoint != null &&\n            Math.abs(this.$touchDownPoint.x - evt.stageX) < sensitivity &&\n            Math.abs(this.$touchDownPoint.y - evt.stageY) < sensitivity)\n            return;\n        this.reset();\n        GObject.$dragBeginCancelled = false;\n        let event = new createjs.Event(\"__dragStart\" /* START */, true, false);\n        event.data = { currentTarget: this.$displayObject };\n        this.$displayObject.dispatchEvent(event, this);\n        if (!GObject.$dragBeginCancelled)\n            //user may call obj.stopDrag in the DragStart event handler\n            this.dragBegin();\n    }\n    $moving2(evt) {\n        let xx = evt.stageX - GObject.sGlobalDragStart.x + GObject.sGlobalRect.x;\n        let yy = evt.stageY - GObject.sGlobalDragStart.y + GObject.sGlobalRect.y;\n        if (this.$dragBounds != null) {\n            let rect = Decls$1.GRoot.inst.localToGlobalRect(this.$dragBounds.x, this.$dragBounds.y, this.$dragBounds.width, this.$dragBounds.height, GObject.sDragHelperRect);\n            if (xx < rect.x)\n                xx = rect.x;\n            else if (xx + GObject.sGlobalRect.width > rect.x + rect.width) {\n                xx = rect.x + rect.width - GObject.sGlobalRect.width;\n                if (xx < rect.x)\n                    xx = rect.x;\n            }\n            if (yy < rect.y)\n                yy = rect.y;\n            else if (yy + GObject.sGlobalRect.height > rect.y + rect.height) {\n                yy = rect.y + rect.height - GObject.sGlobalRect.height;\n                if (yy < rect.y)\n                    yy = rect.y;\n            }\n        }\n        GObject.sUpdatingWhileDragging = true;\n        GObject.sHelperPoint.x = xx;\n        GObject.sHelperPoint.y = yy;\n        let pt = this.parent.globalToLocal(xx, yy, GObject.sHelperPoint);\n        this.setXY(Math.round(pt.x), Math.round(pt.y));\n        GObject.sUpdatingWhileDragging = false;\n        let currentTarget = this.$displayObject;\n        let event = new createjs.Event(\"__dragMoving\" /* MOVING */, true, false);\n        event.data = { currentTarget };\n        this.$displayObject.dispatchEvent(event, this);\n    }\n    $end2(evt) {\n        if (GObject.draggingObject == this) {\n            this.stopDrag();\n            let currentTarget = this.$displayObject;\n            let event = new createjs.Event(\"__dragEnd\" /* END */, true, false);\n            event.data = { currentTarget };\n            this.$displayObject.dispatchEvent(event, this);\n        }\n    }\n}\nGObject.gInstanceCounter = 0;\n//dragging\n//-------------------------------------------------------------------\nGObject.sGlobalDragStart = new createjs.Point();\nGObject.sGlobalRect = new createjs.Rectangle();\nGObject.sHelperPoint = new createjs.Point();\nGObject.sDragHelperRect = new createjs.Rectangle();\nlet Decls$1 = {};\n\nclass GGroup extends GObject {\n    createDisplayObject() {\n        let c = new UIContainer(this);\n        /**\n         * todo\n         */\n        // c.interactive = false;\n        c.mouseEnabled = false;\n        this.setDisplayObject(c);\n    }\n    updateBounds() {\n        if (this.$updating || !this.parent)\n            return;\n        let cnt = this.$parent.numChildren;\n        let i = 0;\n        let ax = Number.POSITIVE_INFINITY, ay = Number.POSITIVE_INFINITY;\n        let ar = Number.NEGATIVE_INFINITY, ab = Number.NEGATIVE_INFINITY;\n        this.$empty = true;\n        let child;\n        let tmp = 0;\n        for (i = 0; i < cnt; i++) {\n            child = this.$parent.getChildAt(i);\n            if (child.group == this) {\n                tmp = child.x;\n                if (tmp < ax)\n                    ax = tmp;\n                tmp = child.y;\n                if (tmp < ay)\n                    ay = tmp;\n                tmp = child.x + child.width;\n                if (tmp > ar)\n                    ar = tmp;\n                tmp = child.y + child.height;\n                if (tmp > ab)\n                    ab = tmp;\n                this.$empty = false;\n            }\n        }\n        this.$updating = true;\n        if (!this.$empty) {\n            this.setXY(ax, ay);\n            this.setSize(ar - ax, ab - ay);\n        }\n        else\n            this.setSize(0, 0);\n        this.$updating = false;\n    }\n    setXY(xv, yv) {\n        if (this.$x != xv || this.$y != yv) {\n            let dx = xv - this.$x;\n            let dy = yv - this.$y;\n            super.setXY(xv, yv);\n            this.moveChildren(dx, dy);\n        }\n    }\n    moveChildren(dx, dy) {\n        if (this.$updating || !this.$parent)\n            return;\n        this.$updating = true;\n        let cnt = this.$parent.numChildren;\n        let i = 0;\n        let child;\n        for (i = 0; i < cnt; i++) {\n            child = this.$parent.getChildAt(i);\n            if (child.group == this) {\n                child.setXY(child.x + dx, child.y + dy);\n            }\n        }\n        this.$updating = false;\n    }\n    updateAlpha() {\n        super.updateAlpha();\n        if (this.$inProgressBuilding)\n            return;\n        let cnt = this.$parent.numChildren;\n        let i;\n        let child;\n        for (i = 0; i < cnt; i++) {\n            child = this.$parent.getChildAt(i);\n            if (child.group == this)\n                child.alpha = this.alpha;\n        }\n    }\n}\n\nclass UISprite extends createjs.Shape {\n    constructor(owner) {\n        super();\n        this.UIOwner = owner;\n        this.mouseEnabled = false;\n        // this.interactive = false;\n        // this.interactiveChildren = false;\n    }\n}\n\nclass GGraph extends GObject {\n    constructor() {\n        super();\n        this.$type = 0;\n        this.$lineSize = 1;\n        this.$sides = 0;\n        this.$startAngle = 0;\n        this.$points = [];\n        this.$lineSize = 1;\n        this.$lineColor = '#000000';\n        this.$fillColor = '#FFFFFF';\n    }\n    drawRect(lineSize, lineColor, fillColor) {\n        this.$type = 1;\n        this.$lineSize = lineSize;\n        this.$lineColor = lineColor;\n        this.$fillColor = fillColor;\n        this.drawGraph();\n    }\n    drawEllipse(lineSize, lineColor, fillColor) {\n        this.$type = 2;\n        this.$lineSize = lineSize;\n        this.$lineColor = lineColor;\n        this.$fillColor = fillColor;\n        this.drawGraph();\n    }\n    get color() {\n        return this.$fillColor;\n    }\n    set color(value) {\n        this.$fillColor = value;\n        if (this.$type != 0)\n            this.drawGraph();\n    }\n    drawGraph() {\n        let shape = this.$displayObject;\n        let g = shape.graphics;\n        g.clear();\n        let w = this.width;\n        let h = this.height;\n        if (w == 0 || h == 0)\n            return;\n        g.beginStroke(this.$lineColor);\n        if (this.$lineSize == 0) {\n            g.setStrokeStyle(0.1); // see https://github.com/CreateJS/EaselJS/issues/734\n        }\n        else {\n            g.setStrokeStyle(this.$lineSize);\n            w -= this.$lineSize;\n            h -= this.$lineSize;\n        }\n        g.beginFill(this.$fillColor);\n        if (this.$type == 1) {\n            if (this.$corner && this.$corner.length >= 1) {\n                if (this.$corner.length == 1) {\n                    g.drawRoundRect(this.$lineSize / 2, this.$lineSize / 2, w, h, this.$corner[0]);\n                }\n                else {\n                    g.drawRoundRectComplex(this.$lineSize / 2, this.$lineSize / 2, w, h, this.$corner[0], this.$corner[1], this.$corner[3], this.$corner[2]);\n                }\n            }\n            else {\n                g.drawRect(this.$lineSize / 2, this.$lineSize / 2, w, h);\n            }\n        }\n        else if (this.$type == 2) {\n            let halfW = w * 0.5;\n            if (w == h)\n                g.drawCircle(halfW + this.$lineSize / 2, halfW + this.$lineSize / 2, halfW);\n            else {\n                w = w - this.$lineSize;\n                h = h - this.$lineSize;\n                g.drawEllipse(this.$lineSize / 2, this.$lineSize / 2, w, h);\n            }\n        }\n        else if (this.$type == 3) {\n            let radius = w > h ? w / 2 : h / 2;\n            g.drawPolyStar(0 + radius, 0 + radius, radius, this.$sides, 0, this.$startAngle);\n        }\n        else if (this.$type == 4) {\n            Utils.fillPath(g, this.$points, 0, 0);\n        }\n        g.endFill();\n        shape.cache(0, 0, this.$width, this.$height);\n    }\n    replaceMe(target) {\n        if (!this.$parent)\n            throw new Error('parent not set');\n        target.name = this.name;\n        target.alpha = this.alpha;\n        target.rotation = this.rotation;\n        target.visible = this.visible;\n        target.touchable = this.touchable;\n        target.grayed = this.grayed;\n        target.setXY(this.x, this.y);\n        target.setSize(this.width, this.height);\n        let index = this.$parent.getChildIndex(this);\n        this.$parent.addChildAt(target, index);\n        target.relations.copyFrom(this.relations);\n        this.$parent.removeChild(this, true);\n    }\n    addBeforeMe(target) {\n        if (this.$parent == null)\n            throw new Error('parent not set');\n        let index = this.$parent.getChildIndex(this);\n        this.$parent.addChildAt(target, index);\n    }\n    addAfterMe(target) {\n        if (this.$parent == null)\n            throw new Error('parent not set');\n        let index = this.$parent.getChildIndex(this);\n        index++;\n        this.$parent.addChildAt(target, index);\n    }\n    createDisplayObject() {\n        this.$displayObject = new UISprite(this);\n        this.$displayObject.mouseEnabled = true;\n    }\n    handleSizeChanged() {\n        if (this.$type != 0)\n            this.drawGraph();\n    }\n    setupBeforeAdd(xml) {\n        super.setupBeforeAdd(xml);\n        let type = xml.attributes.type;\n        if (type && type != 'empty') {\n            let str;\n            str = xml.attributes.lineSize;\n            if (str)\n                this.$lineSize = parseInt(str);\n            let c;\n            str = xml.attributes.lineColor;\n            if (str) {\n                c = StringUtil.convertToRGBA(str);\n                this.$lineColor = c;\n            }\n            str = xml.attributes.fillColor;\n            if (str) {\n                c = StringUtil.convertToRGBA(str);\n                this.$fillColor = c;\n            }\n            let arr;\n            str = xml.attributes.corner;\n            if (str) {\n                arr = str.split(',');\n                if (arr.length > 1)\n                    this.$corner = [parseInt(arr[0]), parseInt(arr[1]), parseInt(arr[2]), parseInt(arr[3])];\n                else\n                    this.$corner = [parseInt(arr[0])];\n            }\n            if (type == 'rect') {\n                this.$type = 1;\n            }\n            else if (type == 'eclipse') {\n                this.$type = 2;\n            }\n            else if (type == 'regular_polygon') {\n                this.$type = 3;\n                str = xml.attributes.sides;\n                if (str) {\n                    this.$sides = parseInt(str);\n                }\n                str = xml.attributes.startAngle;\n                if (str) {\n                    this.$startAngle = parseInt(str);\n                }\n            }\n            else if (type == 'polygon') {\n                this.$type = 4;\n                str = xml.attributes.points;\n                if (str) {\n                    arr = str.split(',');\n                    this.$points = arr.map(point => {\n                        return parseInt(point);\n                    });\n                }\n            }\n            this.drawGraph();\n        }\n    }\n}\n\nclass Bitmap extends Sprite {\n    constructor(item) {\n        super();\n        if (item) {\n            let { width, height, texture, id } = item;\n            this.$frameId = id;\n            if (typeof texture == 'string') {\n                this.texture = document.createElement('img');\n                this.texture.src = texture;\n            }\n            else {\n                this.texture = texture.image;\n            }\n            this.sourceRect = new createjs.Rectangle(0, 0, width, height);\n            this.textureRect = texture.rect;\n        }\n    }\n    draw(ctx, ignoreCache) {\n        let flag = super.draw(ctx, ignoreCache);\n        if (flag) {\n            return flag;\n        }\n        if (this.sourceRect && this.textureRect) {\n            let { x, y, width, height } = this.sourceRect;\n            x = this.$isTrim ? x : 0;\n            y = this.$isTrim ? y : 0;\n            ctx.drawImage(this.texture, this.textureRect.x, this.textureRect.y, this.textureRect.width, this.textureRect.height, x, y, width, height); //GObject来控制位置坐标\n        }\n        else {\n            ctx.drawImage(this.texture, 0, 0);\n        }\n        return true;\n    }\n    getBounds() {\n        var rect = super.getBounds();\n        if (rect) {\n            return rect;\n        }\n        var texture = this.texture, o = this.sourceRect || texture;\n        var hasContent = texture && (texture['naturalWidth'] || texture['getContext'] || texture['readyState'] >= 2);\n        return hasContent ? this.sourceRect.setValues(0, 0, o.width, o.height) : null;\n    }\n}\n\nclass ScaleBitmap extends Sprite {\n    constructor(item, scale9Grid) {\n        super();\n        if (item) {\n            let { width, height, texture, id } = item;\n            this.$frameId = id;\n            if (typeof texture == 'string') {\n                this.texture = document.createElement('img');\n                this.texture.src = texture;\n            }\n            else {\n                this.texture = texture.image;\n            }\n            this.sourceRect = new createjs.Rectangle(0, 0, width, height);\n            this.textureRect = texture.rect;\n        }\n        this.scale9Grid = scale9Grid;\n        this.snapToPixel = true;\n    }\n    draw(ctx, ignoreCache) {\n        let flag = super.draw(ctx, ignoreCache);\n        if (flag) {\n            return true;\n        }\n        var centerX = this.scale9Grid.width;\n        var centerY = this.scale9Grid.height;\n        var scaledCenterX;\n        var scaledCenterY;\n        var imageHeight = this.sourceRect.height;\n        var imageWidth = this.sourceRect.width;\n        if (centerX == 0) {\n            //vertical\n            if (centerY == 0) {\n                throw 'One of scale9Grid width or height must be greater than zero.';\n            }\n            var scale3Region2 = this.textureRect.y + this.scale9Grid.y;\n            var scale3Region3 = this.textureRect.y + this.scale9Grid.y + this.scale9Grid.height;\n            var scaledFirstRegion = this.scale9Grid.y;\n            var scaledSecondRegion = this.scale9Grid.height;\n            var scaledThirdRegion = this.textureRect.height - scaledFirstRegion - scaledSecondRegion;\n            scaledCenterY = imageHeight - scaledFirstRegion - scaledThirdRegion;\n            ctx.drawImage(this.texture, this.textureRect.x, this.textureRect.y, this.textureRect.width, scaledFirstRegion, 0, 0, imageWidth, scaledFirstRegion);\n            ctx.drawImage(this.texture, this.textureRect.x, scale3Region2, this.textureRect.width, scaledSecondRegion, 0, scaledFirstRegion, imageWidth, scaledCenterY);\n            ctx.drawImage(this.texture, this.textureRect.x, scale3Region3, this.textureRect.width, scaledThirdRegion, 0, scaledCenterY + scaledFirstRegion, imageWidth, scaledThirdRegion);\n        }\n        else if (centerY == 0) {\n            //horizontal\n            var scale3Region2 = this.textureRect.x + this.scale9Grid.x;\n            var scale3Region3 = this.textureRect.x + this.scale9Grid.x + this.scale9Grid.width;\n            var scaledFirstRegion = this.scale9Grid.x;\n            var scaledSecondRegion = this.scale9Grid.width;\n            var scaledThirdRegion = this.textureRect.width - scaledFirstRegion - scaledSecondRegion;\n            scaledCenterX = imageWidth - scaledFirstRegion - scaledThirdRegion;\n            ctx.drawImage(this.texture, this.textureRect.x, this.textureRect.y, scaledFirstRegion, this.textureRect.height, 0, 0, scaledFirstRegion, imageHeight);\n            ctx.drawImage(this.texture, scale3Region2, this.textureRect.y, scaledSecondRegion, this.textureRect.height, scaledFirstRegion, 0, scaledCenterX, imageHeight);\n            ctx.drawImage(this.texture, scale3Region3, this.textureRect.y, scaledThirdRegion, this.textureRect.height, scaledFirstRegion + scaledCenterX, 0, scaledThirdRegion, imageHeight);\n        }\n        else {\n            var left = this.scale9Grid.x;\n            var top = this.scale9Grid.y;\n            var right = this.textureRect.width - centerX - left;\n            var bottom = this.textureRect.height - centerY - top;\n            scaledCenterX = imageWidth - left - right;\n            scaledCenterY = imageHeight - top - bottom;\n            ctx.drawImage(this.texture, this.textureRect.x, this.textureRect.y, left, top, 0, 0, left, top);\n            ctx.drawImage(this.texture, this.textureRect.x + left, this.textureRect.y, centerX, top, left, 0, scaledCenterX, top);\n            ctx.drawImage(this.texture, this.textureRect.x + left + centerX, this.textureRect.y, right, top, left + scaledCenterX, 0, right, top);\n            ctx.drawImage(this.texture, this.textureRect.x, this.textureRect.y + top, left, centerY, 0, top, left, scaledCenterY);\n            ctx.drawImage(this.texture, this.textureRect.x + left, this.textureRect.y + top, centerX, centerY, left, top, scaledCenterX, scaledCenterY);\n            ctx.drawImage(this.texture, this.textureRect.x + left + centerX, this.textureRect.y + top, right, centerY, left + scaledCenterX, top, right, scaledCenterY);\n            ctx.drawImage(this.texture, this.textureRect.x, this.textureRect.y + top + centerY, left, bottom, 0, top + scaledCenterY, left, bottom);\n            ctx.drawImage(this.texture, this.textureRect.x + left, this.textureRect.y + top + centerY, centerX, bottom, left, top + scaledCenterY, scaledCenterX, bottom);\n            ctx.drawImage(this.texture, this.textureRect.x + left + centerX, this.textureRect.y + top + centerY, right, bottom, left + scaledCenterX, top + scaledCenterY, right, bottom);\n        }\n        return true;\n    }\n}\n\nclass TilingBitmap extends Sprite {\n    constructor(item) {\n        super();\n        if (item) {\n            let { width, height, texture, id } = item;\n            this.$frameId = id;\n            if (typeof texture == 'string') {\n                this.texture = document.createElement('img');\n                this.texture.src = texture;\n            }\n            else {\n                this.texture = texture.image;\n            }\n            this.sourceRect = new createjs.Rectangle(0, 0, width, height);\n            this.textureRect = texture.rect;\n            let offsetCanvas = document.createElement('canvas');\n            let offsetCanvasContext = offsetCanvas.getContext('2d');\n            offsetCanvas.width = this.textureRect.width;\n            offsetCanvas.height = this.textureRect.height;\n            offsetCanvasContext.drawImage(this.texture, this.textureRect.x, this.textureRect.y, this.textureRect.width, this.textureRect.height, 0, 0, this.textureRect.width, this.textureRect.height);\n            this._pattern = offsetCanvasContext.createPattern(offsetCanvas, 'repeat');\n        }\n    }\n    draw(ctx, ignoreCache) {\n        let flag = super.draw(ctx, ignoreCache);\n        if (flag) {\n            return flag;\n        }\n        // ctx.save();\n        let { width, height } = this.sourceRect;\n        ctx.fillStyle = this._pattern;\n        ctx.fillRect(0, 0, width, height);\n        // ctx.restore();\n        return true;\n    }\n}\n\nclass UIImage extends createjs.Container {\n    constructor(owner) {\n        super();\n        this.UIOwner = owner;\n        // this.mouseEnabled = this.mouseChildren = false;\n    }\n    set sourceRect(rect) {\n        this.$disp.sourceRect = rect;\n    }\n    setCache(x, y, width, height) {\n        this.$disp.cache(x, y, width, height);\n    }\n    /**@internal */\n    $initDisp(item) {\n        if (this.$disp)\n            return;\n        if (item) {\n            item.load();\n            if (item.scaleByTile) {\n                this.$disp = new TilingBitmap(item);\n            }\n            else if (item.scale9Grid) {\n                let rect = new createjs.Rectangle(item.scale9Grid.x, item.scale9Grid.y, Math.max(0, item.scale9Grid.width), Math.max(0, item.scale9Grid.height));\n                this.$disp = new ScaleBitmap(item, rect);\n            }\n            else {\n                this.$disp = new Bitmap(item);\n            }\n        }\n        else {\n            this.$disp = new Bitmap();\n        }\n        this.addChild(this.$disp);\n    }\n    get tint() {\n        return this.$disp.tint;\n    }\n    set tint(value) {\n        this.$disp.tint = value;\n    }\n    get height() {\n        return this.$disp.sourceRect.height;\n    }\n    set height(v) {\n        this.$disp.sourceRect.height = v;\n    }\n    get width() {\n        return this.$disp.sourceRect.width;\n    }\n    set width(v) {\n        this.$disp.sourceRect.width = v;\n    }\n    get texture() {\n        return this.$disp.texture;\n    }\n    set texture(v) {\n        this.$disp.texture = v;\n    }\n    /**\n     * rect = x,y,w,h = l,t,r,b\n     */\n    get scale9Grid() {\n        if (this.$disp instanceof ScaleBitmap) {\n            return this.$disp.scale9Grid;\n        }\n        return null;\n    }\n    /**\n     * rect = x,y,w,h = l,t,r,b\n     */\n    set scale9Grid(rect) {\n        if (this.$disp instanceof ScaleBitmap) {\n            this.$disp.scale9Grid = rect;\n        }\n    }\n    /**\n     * todo\n     */\n    destroy() {\n        //     if(this.$disp) {\n        //         this.$disp.destroy(options);\n        //         this.$disp = null;\n        //     }\n        //     super.destroy(options);\n    }\n}\n\nclass GImage extends GObject {\n    constructor() {\n        super();\n    }\n    get touchable() {\n        return false;\n    }\n    set touchable(value) {\n        this.$touchable = false; //GImage has no interaction\n    }\n    get color() {\n        return this.$content.tint;\n    }\n    set color(value) {\n        if (this.color != value) {\n            this.updateGear(4 /* Color */);\n            this.$content.tint = value;\n            this.$content.setCache(0, 0, this.$width, this.$height);\n        }\n    }\n    get flip() {\n        return this.$flip;\n    }\n    set flip(value) {\n        if (this.$flip != value) {\n            this.$flip = value;\n            this.$content.scaleX = this.$content.scaleY = 1;\n            if (this.$flip == 1 /* Horizontal */ || this.$flip == 3 /* Both */) {\n                this.$content.scaleX = -1;\n            }\n            if (this.$flip == 2 /* Vertical */ || this.$flip == 3 /* Both */) {\n                this.$content.scaleY = -1;\n            }\n            this.handleXYChanged();\n        }\n    }\n    get texture() {\n        return this.$content.texture;\n    }\n    set texture(value) {\n        if (value != null) {\n            this.$sourceWidth = value.width;\n            this.$sourceHeight = value.height;\n        }\n        else\n            this.$sourceWidth = this.$sourceHeight = 0;\n        this.$initWidth = this.$sourceWidth;\n        this.$initHeight = this.$sourceHeight;\n        this.$content.texture = value;\n    }\n    createDisplayObject() {\n        this.$content = new UIImage(this);\n        this.setDisplayObject(this.$content);\n    }\n    dispose() {\n        this.$content.destroy();\n        super.dispose();\n    }\n    constructFromResource() {\n        this.$sourceWidth = this.packageItem.width;\n        this.$sourceHeight = this.packageItem.height;\n        this.$initWidth = this.$sourceWidth;\n        this.$initHeight = this.$sourceHeight;\n        this.$content.$initDisp(this.packageItem);\n        this.setSize(this.$sourceWidth, this.$sourceHeight);\n    }\n    handleXYChanged() {\n        super.handleXYChanged();\n        if (this.$flip != 0 /* None */) {\n            if (this.$content.scaleX == -1)\n                this.$content.x += this.width;\n            if (this.$content.scaleY == -1)\n                this.$content.y += this.height;\n        }\n    }\n    handleSizeChanged() {\n        this.$content.width = this.width;\n        this.$content.height = this.height;\n        let rect = new createjs.Rectangle(this.x, this.y, this.width, this.height);\n        this.$content.sourceRect = rect;\n    }\n    setupBeforeAdd(xml) {\n        super.setupBeforeAdd(xml);\n        let str;\n        str = xml.attributes.color;\n        if (str) {\n            this.color = StringUtil.HEX2RGB(str);\n        }\n        str = xml.attributes.flip;\n        if (str)\n            this.flip = ParseFlipType(str);\n    }\n}\n\nclass GTimer {\n    constructor() {\n        this.$enumIdx = 0;\n        this.$enumCount = 0;\n        this.$curTime = Date.now();\n        this.$items = [];\n        this.$itemPool = [];\n        // this.$lastTime = createjs.Ticker.getTime();\n        // GTimer.time = this.$lastTime;\n        createjs.Ticker.on('tick', this.advance, this);\n    }\n    getItem() {\n        if (this.$itemPool.length)\n            return this.$itemPool.pop();\n        else\n            return new TimerItem();\n    }\n    findItem(callback, thisObj) {\n        let len = this.$items.length;\n        for (let i = 0; i < len; i++) {\n            let item = this.$items[i];\n            if (item.callback == callback && item.thisObj == thisObj)\n                return item;\n        }\n        return null;\n    }\n    //repeat <= 0 means loop\n    add(delayInMs, repeat, callback, thisObj, callbackParam) {\n        let item = this.findItem(callback, thisObj);\n        if (!item) {\n            item = this.getItem();\n            item.callback = callback;\n            item.thisObj = thisObj;\n            this.$items.push(item);\n        }\n        item.delay = delayInMs;\n        item.counter = 0;\n        item.repeat = repeat;\n        item.param = callbackParam;\n        item.end = false;\n    }\n    addLoop(delayInMs, callback, thisObj, callbackParam) {\n        this.add(delayInMs, 0, callback, thisObj, callbackParam);\n    }\n    callLater(callback, thisObj, callbackParam) {\n        this.add(1, 1, callback, thisObj, callbackParam);\n    }\n    callDelay(delayInMs, callback, thisObj, callbackParam) {\n        this.add(delayInMs, 1, callback, thisObj, callbackParam);\n    }\n    exists(callback, thisObj) {\n        let item = this.findItem(callback, thisObj);\n        return item != null;\n    }\n    remove(callback, thisObj) {\n        let item = this.findItem(callback, thisObj);\n        if (item) {\n            let i = this.$items.indexOf(item);\n            this.$items.splice(i, 1);\n            if (i < this.$enumIdx)\n                this.$enumIdx--;\n            this.$enumCount--;\n            item.callback = null;\n            item.param = null;\n            this.$itemPool.push(item);\n        }\n    }\n    get ticker() {\n        return this.$ticker;\n    }\n    get curTime() {\n        return this.$curTime;\n    }\n    advance() {\n        this.$enumIdx = 0;\n        this.$enumCount = this.$items.length;\n        while (this.$enumIdx < this.$enumCount) {\n            let item = this.$items[this.$enumIdx];\n            this.$enumIdx++;\n            let ms = createjs.Ticker.interval;\n            this.$curTime += ms;\n            if (item.advance(ms)) {\n                if (item.end) {\n                    this.$enumIdx--;\n                    this.$enumCount--;\n                    this.$items.splice(this.$enumIdx, 1);\n                    this.$itemPool.push(item);\n                }\n                if (item.callback) {\n                    let args = [ms];\n                    if (item.param && item.param instanceof Array)\n                        args = item.param.concat(args);\n                    else if (item.param !== void 0)\n                        args.unshift(item.param);\n                    item.callback.apply(item.thisObj, args);\n                }\n                if (item.end)\n                    item.callback = item.thisObj = item.param = null;\n            }\n        }\n    }\n}\nGTimer.inst = new GTimer();\nclass TimerItem {\n    constructor() {\n        this.delay = 0;\n        this.counter = 0;\n        this.repeat = 0;\n    }\n    advance(delta = 0) {\n        this.counter += delta;\n        if (this.counter >= this.delay) {\n            this.counter -= this.delay;\n            if (this.counter > this.delay)\n                this.counter = this.delay;\n            if (this.repeat > 0) {\n                this.repeat--;\n                if (this.repeat == 0)\n                    this.end = true;\n            }\n            return true;\n        }\n        else\n            return false;\n    }\n}\n\nclass MathUtil {\n    static clamp(value, min, max) {\n        if (value < min)\n            value = min;\n        else if (value > max)\n            value = max;\n        return value;\n    }\n    static clamp01(value) {\n        if (value > 1)\n            value = 1;\n        else if (value < 0)\n            value = 0;\n        return value;\n    }\n    static isNumber(n) {\n        if (typeof (n) != \"number\")\n            return false;\n        if (isNaN(n))\n            return false;\n        return true;\n    }\n    static sign(x) {\n        x = Number(x);\n        if (x === 0 || isNaN(x))\n            return x;\n        return x > 0 ? 1 : -1;\n    }\n    static angleToRadian(n) {\n        return n * MathUtil.RADIAN;\n    }\n    static lerp(s, e, p) {\n        return s + p * (e - s);\n    }\n}\nMathUtil.RADIAN = Math.PI / 180;\n\nclass MovieClipData {\n    constructor() {\n        this.repeatedCount = 0;\n        this.$curFrame = 0;\n        this.$lastTime = 0;\n        this.$curFrameDelay = 0;\n        this.$lastTime = Date.now();\n    }\n    update(mc) {\n        let t = Date.now();\n        let elapsed = t - this.$lastTime;\n        this.$lastTime = t;\n        let cur = this.$curFrame;\n        if (cur >= mc.frameCount)\n            cur = mc.frameCount - 1;\n        this.reachesEnd = false;\n        this.$curFrameDelay += elapsed;\n        let interval = mc.interval + mc.frames[cur].addDelay\n            + ((cur == 0 && this.repeatedCount > 0) ? mc.repeatDelay : 0);\n        if (this.$curFrameDelay < interval)\n            return;\n        this.$curFrameDelay -= interval;\n        if (this.$curFrameDelay > mc.interval)\n            this.$curFrameDelay = mc.interval;\n        if (mc.swing) {\n            if (this.reversed) {\n                this.$curFrame--;\n                if (this.$curFrame < 0) {\n                    this.$curFrame = Math.min(1, mc.frameCount - 1);\n                    this.repeatedCount++;\n                    this.reversed = !this.reversed;\n                }\n            }\n            else {\n                this.$curFrame++;\n                if (this.$curFrame > mc.frameCount - 1) {\n                    this.$curFrame = Math.max(0, mc.frameCount - 2);\n                    this.repeatedCount++;\n                    this.reachesEnd = true;\n                    this.reversed = !this.reversed;\n                }\n            }\n        }\n        else {\n            this.$curFrame++;\n            if (this.$curFrame > mc.frameCount - 1) {\n                this.$curFrame = 0;\n                this.repeatedCount++;\n                this.reachesEnd = true;\n            }\n        }\n    }\n    get currentFrame() {\n        return this.$curFrame;\n    }\n    set currentFrame(value) {\n        this.$curFrame = value;\n        this.$curFrameDelay = 0;\n    }\n    rewind() {\n        this.$curFrame = 0;\n        this.$curFrameDelay = 0;\n        this.reversed = false;\n        this.reachesEnd = false;\n    }\n    reset() {\n        this.$curFrame = 0;\n        this.$curFrameDelay = 0;\n        this.repeatedCount = 0;\n        this.reachesEnd = false;\n        this.reversed = false;\n    }\n    copy(src) {\n        this.$curFrame = src.$curFrame;\n        this.$curFrameDelay = src.$curFrameDelay;\n        this.repeatedCount = src.repeatedCount;\n        this.reachesEnd = src.reachesEnd;\n        this.reversed = src.reversed;\n    }\n}\n\nclass DefaultMovieClipSettings {\n    constructor() {\n        /**the first frame number to start to play */\n        this.startFrame = 0;\n        /**the end frame the playing will end at, -1 means to the tail */\n        this.endFrame = -1;\n        /**play count, 0 means endeless */\n        this.repeatCount = 0;\n        /**once the repeated playing completes, the playing will end at, -1 means to the tail */\n        this.loopEndAt = -1;\n        /**complete callback handler */\n        this.endCallback = null;\n        /**context object for the callback function */\n        this.endCallbackContext = null;\n    }\n    /**modify the current settings without whole parameters provided */\n    mix(other) {\n        let ret = this;\n        for (let key in other) {\n            if (key == \"mix\")\n                continue;\n            ret[key] = other[key];\n        }\n        return this;\n    }\n}\n\nclass MovieClip extends Bitmap {\n    constructor(owner) {\n        super();\n        this.interval = 0;\n        this.repeatDelay = 0;\n        this.$frameCount = 0;\n        this.$currentFrame = 0;\n        this.$status = 0 /* NORMAL */;\n        this.UIOwner = owner;\n        this.data = new MovieClipData();\n        this.$playing = true;\n        this.mouseEnabled = false;\n        this.$settings = new DefaultMovieClipSettings();\n        this.$isTrim = true;\n        this.on('added', this.added, this);\n        this.on('removed', this.removed, this);\n    }\n    // draw(ctx: CanvasRenderingContext2D, ignoreCache: boolean): boolean {\n    //     // let flag = super.draw(ctx, ignoreCache);\n    //     // if (flag) {\n    //     //     return flag;\n    //     // }\n    //     if (this.sourceRect && this.textureRect) {\n    //         let { x, y, width, height } = this.textureRect;\n    //         ctx.drawImage(this.texture, x, y, width, height, this.sourceRect.x, this.sourceRect.y, this.sourceRect.width, this.sourceRect.height);//GObject来控制位置坐标\n    //     } else {\n    //         ctx.drawImage(this.texture, 0, 0);\n    //     }\n    //     return true;\n    // }\n    get frames() {\n        return this.$frames;\n    }\n    set frames(value) {\n        this.$frames = value;\n        if (this.$frames != null)\n            this.$frameCount = this.$frames.length;\n        else\n            this.$frameCount = 0;\n        if (this.$settings.endFrame == -1 || this.$settings.endFrame > this.$frameCount - 1)\n            this.$settings.endFrame = this.$frameCount - 1;\n        if (this.$settings.loopEndAt == -1 || this.$settings.loopEndAt > this.$frameCount - 1)\n            this.$settings.loopEndAt = this.$frameCount - 1;\n        if (this.$currentFrame < 0 || this.$currentFrame > this.$frameCount - 1)\n            this.$currentFrame = this.$frameCount - 1;\n        if (this.$frameCount > 0) {\n            this.setFrame(this.$frames[this.$currentFrame]);\n        }\n        else {\n            this.setFrame(null);\n        }\n        this.data.rewind();\n    }\n    get frameCount() {\n        return this.$frameCount;\n    }\n    // public get boundsRect(): createjs.Rectangle {\n    //     return this.getBounds();\n    //     // return this._boundsRect;\n    // }\n    set boundsRect(value) {\n        // this._boundsRect = value;\n        // this.sourceRect = value;\n    }\n    get currentFrame() {\n        return this.$currentFrame;\n    }\n    set currentFrame(value) {\n        if (this.$currentFrame != value) {\n            this.$currentFrame = value;\n            this.data.currentFrame = value;\n            this.setFrame(this.$currentFrame < this.$frameCount ? this.$frames[this.$currentFrame] : null);\n        }\n    }\n    get playing() {\n        return this.$playing;\n    }\n    set playing(value) {\n        this.$playing = value;\n        if (value && GObject.isDisplayObjectOnStage(this))\n            GTimer.inst.add(0, 0, this.update, this);\n        else\n            GTimer.inst.remove(this.update, this);\n    }\n    /**\n       * Modify the playing settings for the current MovieClip object, there are two ways to call this method:\n       * 1) pass whole parameters:\n              startFrame: number;\n              endFrame: number;\n              repeatCount: number;\n              loopEndAt: number;\n              endCallback: (target?: MovieClip) => void;\n              endCallbackContext: any;\n       * 2) just pass 1 object which implements MovieClipSettings (recommended)\n       */\n    setPlaySettings(...args) {\n        if (args.length == 1 && typeof args[0] == 'object')\n            this.$settings.mix(args[0]);\n        else {\n            let s = args[0], e = args[1], r = args[2], l = args[3], ec = args[4], ecc = args[5];\n            let o = {};\n            if (MathUtil.isNumber(s))\n                o.startFrame = s;\n            if (MathUtil.isNumber(e))\n                o.endFrame = e;\n            if (MathUtil.isNumber(r))\n                o.repeatCount = r;\n            if (MathUtil.isNumber(l))\n                o.loopEndAt = l;\n            if (ec && typeof ec == 'function')\n                o.endCallback = ec;\n            if (ecc)\n                o.endCallbackContext = ecc;\n            this.$settings.mix(o);\n        }\n        if (this.$settings.endFrame == -1 || this.$settings.endFrame > this.$frameCount - 1)\n            this.$settings.endFrame = this.$frameCount - 1;\n        if (this.$settings.loopEndAt == -1)\n            this.$settings.loopEndAt = this.$settings.endFrame;\n        this.$status = 0 /* NORMAL */;\n        this.currentFrame = this.$settings.startFrame;\n    }\n    update() {\n        if (this.UIOwner.$inProgressBuilding)\n            return;\n        if (this.$playing && this.$frameCount != 0 && this.$status != 3 /* ENDED */) {\n            this.data.update(this);\n            if (this.$currentFrame != this.data.currentFrame) {\n                if (this.$status == 1 /* LOOPING */) {\n                    this.$currentFrame = this.$settings.startFrame;\n                    this.data.currentFrame = this.$currentFrame;\n                    this.$status = 0 /* NORMAL */;\n                }\n                else if (this.$status == 2 /* STOPPING */) {\n                    this.$currentFrame = this.$settings.loopEndAt;\n                    this.data.currentFrame = this.$currentFrame;\n                    this.$status = 3 /* ENDED */;\n                    //play end\n                    if (this.$settings.endCallback != null)\n                        GTimer.inst.callLater(this.$playEnd, this);\n                }\n                else {\n                    this.$currentFrame = this.data.currentFrame;\n                    if (this.$currentFrame == this.$settings.endFrame) {\n                        if (this.$settings.repeatCount > 0) {\n                            this.$settings.repeatCount--;\n                            if (this.$settings.repeatCount == 0)\n                                this.$status = 2 /* STOPPING */;\n                            else\n                                this.$status = 1 /* LOOPING */;\n                        }\n                    }\n                }\n                this.setFrame(this.$frames[this.$currentFrame]);\n            }\n        }\n    }\n    $playEnd() {\n        if (this.$settings.endCallback != null) {\n            let f = this.$settings.endCallback;\n            let fObj = this.$settings.endCallbackContext;\n            this.$settings.endCallback = this.$settings.endCallbackContext = null;\n            this.$settings.endCallbackContext = null;\n            if (f)\n                f.call(fObj, this);\n        }\n    }\n    setFrame(frame) {\n        this.texture = frame == null ? null : frame.texture.image;\n        this.textureRect = frame.texture.rect;\n        this.sourceRect = frame.texture.trim;\n        let { x, y, width, height } = this.sourceRect;\n        this.cache(x, y, width, height);\n        // this._textureID = -1;\n    }\n    added(disp) {\n        if (this.$playing)\n            GTimer.inst.add(0, 0, this.update, this);\n    }\n    removed(disp) {\n        if (this.$playing)\n            GTimer.inst.remove(this.update, this);\n    }\n    destroy() {\n        GTimer.inst.remove(this.update, this);\n        this.off('added', this.added);\n        this.off('removed', this.removed);\n        super.destroy();\n    }\n}\n\nclass GMovieClip extends GObject {\n    constructor() {\n        super();\n    }\n    mapPivotWidth(scale) {\n        return scale * this.$sourceWidth;\n    }\n    mapPivotHeight(scale) {\n        return scale * this.$sourceHeight;\n    }\n    handleSizeChanged() {\n        if (this.$displayObject != null && this.$sourceWidth != 0 && this.$sourceHeight != 0)\n            this.$displayObject.set({\n                scaleX: (this.$width / this.$sourceWidth) * this.$scaleX,\n                scaleY: (this.$height / this.$sourceHeight) * this.$scaleY\n            });\n    }\n    handleScaleChanged() {\n        if (this.$displayObject != null) {\n            this.$displayObject.set({\n                scaleX: (this.$width / this.$sourceWidth) * this.$scaleX,\n                scaleY: (this.$height / this.$sourceHeight) * this.$scaleY\n            });\n        }\n    }\n    get touchable() {\n        return false;\n    }\n    set touchable(value) {\n        this.$touchable = false; //GMovieClip has no interaction\n    }\n    get color() {\n        return this.$movieClip.tint;\n    }\n    set color(value) {\n        this.$movieClip.tint = value;\n    }\n    createDisplayObject() {\n        this.$movieClip = new MovieClip(this);\n        this.setDisplayObject(this.$movieClip);\n    }\n    get playing() {\n        return this.$movieClip.playing;\n    }\n    set playing(value) {\n        if (this.$movieClip.playing != value) {\n            this.$movieClip.playing = value;\n            this.updateGear(5 /* Animation */);\n        }\n    }\n    get frame() {\n        return this.$movieClip.currentFrame;\n    }\n    set frame(value) {\n        if (this.$movieClip.currentFrame != value) {\n            this.$movieClip.currentFrame = value;\n            this.updateGear(5 /* Animation */);\n        }\n    }\n    /**\n       * Modify the playing settings for the current MovieClip object, there are two ways to call this method:\n       * 1) pass whole parameters:\n              startFrame: number;\n              endFrame: number;\n              repeatCount: number;\n              loopEndAt: number;\n              endCallback: (target?: MovieClip) => void;\n              endCallbackContext: any;\n       * 2) just pass 1 object which implements MovieClipSettings (recommended)\n       */\n    setPlaySettings(...args) {\n        this.$movieClip.setPlaySettings.apply(this.$movieClip, args);\n    }\n    constructFromResource() {\n        this.$sourceWidth = this.packageItem.width;\n        this.$sourceHeight = this.packageItem.height;\n        this.$initWidth = this.$sourceWidth;\n        this.$initHeight = this.$sourceHeight;\n        this.setSize(this.$sourceWidth, this.$sourceHeight);\n        this.packageItem.load();\n        this.$movieClip.interval = this.packageItem.interval;\n        this.$movieClip.swing = this.packageItem.swing;\n        this.$movieClip.repeatDelay = this.packageItem.repeatDelay;\n        this.$movieClip.frames = this.packageItem.frames;\n        this.$movieClip.boundsRect = new createjs.Rectangle(0, 0, this.$sourceWidth, this.$sourceHeight);\n    }\n    setupBeforeAdd(xml) {\n        super.setupBeforeAdd(xml);\n        let str;\n        str = xml.attributes.frame;\n        if (str)\n            this.$movieClip.currentFrame = parseInt(str);\n        str = xml.attributes.playing;\n        this.$movieClip.playing = str != 'false';\n        str = xml.attributes.color;\n        if (str) {\n            this.color = StringUtil.HEX2RGB(str);\n        }\n    }\n}\n\nclass DOMEventManager extends createjs.EventDispatcher {\n    constructor() {\n        super();\n        this.retEvent = {};\n        this.nullLowestDeltaTimeout = NaN;\n        /*******************keys*******************/\n        this.$pressedKeys = {};\n        this.$releasedKeys = {};\n        this.$downKeys = [];\n        //resize\n        window.addEventListener('resize', e => this.notifyResizeEvents(e), false);\n        //modifer keys\n        window.addEventListener('keydown', e => this.onWindowKeyDown(e), false);\n        window.addEventListener('keyup', e => this.onWindowKeyUp(e), false);\n        //mouse wheel\n        const toBind = 'onwheel' in document || document['documentMode'] >= 9\n            ? ['wheel']\n            : ['mousewheel', 'DomMouseScroll', 'MozMousePixelScroll'];\n        for (let i = toBind.length; i;) {\n            window.addEventListener(toBind[--i], e => this.onMouseWheel(e), false);\n        }\n    }\n    //resize\n    notifyResizeEvents(e) {\n        this.dispatchEvent('resize');\n    }\n    onMouseWheel(event) {\n        let orgEvent = event || window.event, delta = 0, deltaX = 0, deltaY = 0, absDelta = 0;\n        if ('detail' in orgEvent) {\n            deltaY = orgEvent.detail * -1;\n        }\n        if ('wheelDelta' in orgEvent) {\n            deltaY = orgEvent.wheelDelta;\n        }\n        if ('wheelDeltaY' in orgEvent) {\n            deltaY = orgEvent.wheelDeltaY;\n        }\n        if ('wheelDeltaX' in orgEvent) {\n            deltaX = orgEvent.wheelDeltaX * -1;\n        }\n        //FF DOMMouseScroll\n        if ('axis' in orgEvent && orgEvent.axis === orgEvent.HORIZONTAL_AXIS) {\n            deltaX = deltaY * -1;\n            deltaY = 0;\n        }\n        delta = deltaY === 0 ? deltaX : deltaY;\n        if ('deltaY' in orgEvent) {\n            deltaY = orgEvent.deltaY * -1;\n            delta = deltaY;\n        }\n        if ('deltaX' in orgEvent) {\n            deltaX = orgEvent.deltaX;\n            if (deltaY === 0) {\n                delta = deltaX * -1;\n            }\n        }\n        if (deltaY === 0 && deltaX === 0) {\n            return;\n        }\n        // Delta modes:\n        //   * deltaMode 0 is by pixels, nothing to do\n        //   * deltaMode 1 is by lines\n        //   * deltaMode 2 is by pages\n        if (orgEvent.deltaMode === 1) {\n            const lineHeight = 16; //fontSize - line-height;\n            delta *= lineHeight;\n            deltaY *= lineHeight;\n            deltaX *= lineHeight;\n        }\n        else if (orgEvent.deltaMode === 2) {\n            const pageHeight = 16; //dom.clientHeight = page-height\n            delta *= pageHeight;\n            deltaY *= pageHeight;\n            deltaX *= pageHeight;\n        }\n        absDelta = Math.max(Math.abs(deltaY), Math.abs(deltaX));\n        if (!this.lowestDelta || absDelta < this.lowestDelta) {\n            this.lowestDelta = absDelta;\n            if (orgEvent.type === 'mousewheel' && absDelta % 120 === 0)\n                this.lowestDelta /= 40;\n        }\n        if (orgEvent.type === 'mousewheel' && absDelta % 120 === 0) {\n            delta /= 40;\n            deltaX /= 40;\n            deltaY /= 40;\n        }\n        delta = Math[delta >= 1 ? 'floor' : 'ceil'](delta / this.lowestDelta);\n        deltaX = Math[deltaX >= 1 ? 'floor' : 'ceil'](deltaX / this.lowestDelta);\n        deltaY = Math[deltaY >= 1 ? 'floor' : 'ceil'](deltaY / this.lowestDelta);\n        this.retEvent.delta = delta;\n        this.retEvent.deltaX = deltaX;\n        this.retEvent.deltaY = deltaY;\n        this.retEvent.deltaFactor = this.lowestDelta;\n        this.retEvent.deltaMode = 0;\n        if (this.nullLowestDeltaTimeout) {\n            clearTimeout(this.nullLowestDeltaTimeout);\n        }\n        this.nullLowestDeltaTimeout = window.setTimeout(() => this.nullLowestDelta(), 200);\n        let evt = new createjs.Event(\"__mouseWheel\" /* MOUSE_WHEEL */, true, false);\n        evt.data = { event: this.retEvent };\n        this.dispatchEvent(evt, this);\n    }\n    nullLowestDelta() {\n        this.lowestDelta = null;\n    }\n    isKeyDown(key) {\n        return this.$downKeys.indexOf(key) >= 0;\n    }\n    isKeyPressed(key) {\n        return !!this.$pressedKeys[key];\n    }\n    isKeyReleased(key) {\n        return !!this.$releasedKeys[key];\n    }\n    onWindowKeyDown(evt) {\n        let key = evt.which || evt.keyCode;\n        if (!this.isKeyDown(key)) {\n            this.$downKeys.push(key);\n            this.$pressedKeys[key] = true;\n            this.dispatchEvent('keyPressed', key);\n        }\n    }\n    onWindowKeyUp(evt) {\n        let key = evt.which || evt.keyCode;\n        if (this.isKeyDown(key)) {\n            this.$pressedKeys[key] = false;\n            this.$releasedKeys[key] = true;\n            let index = this.$downKeys.indexOf(key);\n            if (index >= 0)\n                this.$downKeys.splice(index, 1);\n            this.dispatchEvent('keyReleased', key);\n        }\n    }\n}\nDOMEventManager.inst = new DOMEventManager();\n\nclass HTMLInput {\n    constructor() {\n        /**@internal */\n        this.$requestToShow = false;\n        /**@internal */\n        this.$scaleX = 1;\n        /**@internal */\n        this.$scaleY = 1;\n    }\n    static get inst() {\n        if (!HTMLInput.$instance)\n            HTMLInput.$instance = new HTMLInput();\n        return HTMLInput.$instance;\n    }\n    initialize(container, view) {\n        this.$canvas = view;\n        let div;\n        if (!this.$delegateDiv) {\n            div = document.createElement('div');\n            this.$delegateDiv = div;\n            div.id = '__delegateDiv';\n            container.appendChild(div);\n            this.initDomPos(div);\n            this.$wrapper = document.createElement('div');\n            this.initDomPos(this.$wrapper);\n            this.$wrapper.style.width = '0px';\n            this.$wrapper.style.height = '0px';\n            this.$wrapper.style.left = '0px';\n            this.$wrapper.style.top = '-100px';\n            this.setTransform(this.$wrapper, '0% 0% 0px');\n            div.appendChild(this.$wrapper);\n            Decls$1.GRoot.inst.on(InteractiveEvents.Click, this.canvasClickHandler, this);\n            this.initInputElement(true); //input\n            this.initInputElement(false); //textarea\n        }\n    }\n    isInputOn() {\n        return this.$input != null;\n    }\n    canvasClickHandler(e) {\n        if (this.$requestToShow) {\n            this.$requestToShow = false;\n            this.$input.onClickHandler(e);\n            this.show();\n        }\n        else {\n            if (this.$curEle) {\n                this.clearInputElement();\n                this.$curEle.blur();\n                this.$curEle = null;\n            }\n        }\n    }\n    isInputShown() {\n        return this.$input != null;\n    }\n    isCurrentInput(input) {\n        return this.$input == input;\n    }\n    initDomPos(dom) {\n        dom.style.position = 'absolute';\n        dom.style.left = '0px';\n        dom.style.top = '0px';\n        dom.style.border = 'none';\n        dom.style.padding = '0';\n    }\n    setTransform(el, origin, transform) {\n        let style = el.style;\n        style.transformOrigin = style.webkitTransformOrigin = style.msTransformOrigin = style.mozTransformOrigin = style.oTransformOrigin = origin;\n        if (transform && transform.length > 0)\n            style.transform = style.webkitTransform = style.msTransform = style.mozTransform = style.oTransform = transform;\n    }\n    /**@internal */\n    updateSize(sx, sy) {\n        if (!this.$canvas)\n            return;\n        this.$scaleX = sx;\n        this.$scaleY = sy;\n        this.$delegateDiv.style.left = this.$canvas.style.left;\n        this.$delegateDiv.style.top = this.$canvas.style.top;\n        let cvsStyle = this.$canvas.style;\n        this.setTransform(this.$delegateDiv, '0% 0% 0px', cvsStyle.transform ||\n            cvsStyle.webkitTransform ||\n            cvsStyle.msTransform ||\n            cvsStyle.mozTransform ||\n            cvsStyle.oTransform);\n    }\n    initInputElement(multiline) {\n        let inputElement;\n        if (multiline) {\n            inputElement = document.createElement('textarea');\n            inputElement.style.resize = 'none';\n            this.$multiLine = inputElement;\n            inputElement.id = 'stageTextAreaEle';\n        }\n        else {\n            inputElement = document.createElement('input');\n            this.$singleLine = inputElement;\n            inputElement.type = 'text';\n            inputElement.id = 'stageInputEle';\n        }\n        this.$wrapper.appendChild(inputElement);\n        inputElement.setAttribute('tabindex', '-1');\n        inputElement.style.width = '1px';\n        inputElement.style.height = '12px';\n        this.initDomPos(inputElement);\n        let style = inputElement.style;\n        style.outline = 'thin';\n        style.background = 'none';\n        style.overflow = 'hidden';\n        style.wordBreak = 'break-all';\n        style.opacity = 0;\n        inputElement.oninput = e => {\n            if (this.$input)\n                this.$input.onInputHandler();\n        };\n    }\n    show() {\n        GTimer.inst.callLater(() => {\n            this.$curEle.style.opacity = '1';\n        }, this);\n    }\n    disconnect(ele) {\n        if (this.$input == null || this.$input == ele) {\n            this.clearInputElement();\n            if (this.$curEle)\n                this.$curEle.blur();\n        }\n    }\n    clearAttributes(obj) {\n        if (this.$curEle) {\n            for (let key in obj) {\n                this.$curEle.removeAttribute(key);\n            }\n        }\n    }\n    clearInputElement() {\n        if (this.$curEle) {\n            this.$curEle.value = '';\n            this.$curEle.onblur = null;\n            let style = this.$curEle.style;\n            style.width = '1px';\n            style.height = '12px';\n            style.left = '0px';\n            style.top = '0px';\n            style.opacity = '0';\n            let el2;\n            if (this.$singleLine == this.$curEle)\n                el2 = this.$multiLine;\n            else\n                el2 = this.$singleLine;\n            el2.style.display = 'block';\n            this.$wrapper.style.left = '0px';\n            this.$wrapper.style.top = '-100px';\n            this.$wrapper.style.height = '0px';\n            this.$wrapper.style.width = '0px';\n        }\n        if (this.$input) {\n            this.$input.onDisconnect();\n            this.$input = null;\n            HTMLInput.isTyping = false;\n        }\n    }\n    requestInput(ele) {\n        this.clearInputElement();\n        this.$input = ele;\n        HTMLInput.isTyping = true;\n        let el2;\n        if (this.$input.textField.multipleLine) {\n            this.$curEle = this.$multiLine;\n            el2 = this.$singleLine;\n        }\n        else {\n            this.$curEle = this.$singleLine;\n            el2 = this.$multiLine;\n        }\n        el2.style.display = 'none';\n        return this.$curEle;\n    }\n}\nHTMLInput.isTyping = false;\n\nclass DefaultUIStageOptions {\n    constructor() {\n        this.scaleMode = \"showAll\" /* SHOW_ALL */;\n        this.orientation = \"auto\" /* AUTO */;\n        this.resolution = 1;\n        this.designWidth = 800;\n        this.designHeight = 600;\n        this.alignV = 4 /* MIDDLE */;\n        this.alignH = 1 /* CENTER */;\n        this.fallbackWidth = 0;\n        this.fallbackHeight = 0;\n    }\n}\nclass DefaultBoudingRectCalculator {\n    getRect(view, fallbackWidth, fallbackHeight) {\n        let p = view.parentElement;\n        if (!p)\n            //this should be impossible situation unless the user forget to append the view into the DOM.\n            throw new Error(\"Your view of PIXI are still in memory but not appended to DOM yet? it's necessary that there is a parent element to wrap your view up.\");\n        let rect = p.getBoundingClientRect();\n        let ret = {\n            x: 0,\n            y: 0,\n            width: 0,\n            height: 0\n        };\n        if (!rect || rect.width <= 0 || rect.height <= 0) {\n            console.warn('It seems that you did not set a explicit size for the parent element of your view, now fall back to window size instead.');\n            ret.width = window.innerWidth;\n            ret.height = window.innerHeight;\n            ret.x = 0;\n            ret.y = 0;\n        }\n        else {\n            ret.x = rect.left;\n            ret.y = rect.top;\n            ret.width = rect.width;\n            ret.height = rect.height;\n        }\n        //consider the worst situation: window does not have size!!\n        if (ret.width <= 0 || ret.height <= 0) {\n            console.warn('fetch container size to initialize PIXI in all ways have failed, now use default size (fallbackWidth / fallbackHeight) specified in the options instead.');\n            ret.width = fallbackWidth;\n            ret.height = fallbackHeight;\n        }\n        return ret;\n    }\n}\nclass UIStage extends createjs.EventDispatcher {\n    constructor(app, stageOptions) {\n        super();\n        this.$width = 0;\n        this.$height = 0;\n        this.$scaleX = 1;\n        this.$scaleY = 1;\n        this.$canvasMatrix = new createjs.Matrix2D();\n        this.offsetX = 0;\n        this.offsetY = 0;\n        this.$sizeCalcer = new DefaultBoudingRectCalculator();\n        UIStageInst.push(this);\n        this.$appContext = app;\n        let opt;\n        if (stageOptions instanceof DefaultUIStageOptions)\n            opt = stageOptions;\n        else {\n            opt = new DefaultUIStageOptions();\n            if (stageOptions != null) {\n                for (let i in stageOptions) {\n                    opt[i] = stageOptions[i];\n                }\n            }\n        }\n        if (!opt.designWidth || !opt.designHeight)\n            throw new Error(\"Invalid designWidth / designHeight in the parameter 'stageOptions'.\");\n        this.$options = opt;\n        this.$appContext.canvas.style.position = 'absolute';\n        let container = this.$appContext.canvas.parentElement;\n        let style = container.style;\n        //if parent is not a DIV box, make one\n        if (container.tagName != 'DIV') {\n            container = document.createElement('DIV');\n            style.position = 'relative';\n            style.left = style.top = '0px';\n            style.width = style.height = '100%'; //and set default full-screen\n            style.overflow = 'hidden';\n            // this.$appContext.view.parentElement.appendChild(container); //todo\n            // container.appendChild(this.$appContext.view); //todo\n        }\n        let containerPosition;\n        if (document.defaultView && document.defaultView.getComputedStyle)\n            containerPosition = document.defaultView.getComputedStyle(container).position;\n        else\n            containerPosition = style.position;\n        if (containerPosition == '' || containerPosition == 'static') {\n            containerPosition = 'relative';\n            container.style.position = containerPosition;\n        }\n        HTMLInput.inst.initialize(container, this.$appContext.canvas);\n        this.updateScreenSize();\n    }\n    get orientation() {\n        return this.$options.orientation;\n    }\n    get stageWidth() {\n        return this.$width;\n    }\n    get stageHeight() {\n        return this.$height;\n    }\n    get applicationContext() {\n        return this.$appContext;\n    }\n    get nativeStage() {\n        return this.$appContext;\n    }\n    get resolution() {\n        return this.$options.resolution;\n    }\n    set resolution(v) {\n        this.$options.resolution = v;\n        this.updateScreenSize();\n    }\n    get scaleX() {\n        return this.$scaleX;\n    }\n    get scaleY() {\n        return this.$scaleY;\n    }\n    get designWidth() {\n        return this.$options.designWidth;\n    }\n    get designHeight() {\n        return this.$options.designHeight;\n    }\n    setDesignSize(width, height) {\n        let option = this.$options;\n        option.designWidth = width;\n        option.designHeight = height;\n        this.updateScreenSize();\n    }\n    calculateStageSize(scaleMode, screenWidth, screenHeight, contentWidth, contentHeight) {\n        let displayWidth = screenWidth;\n        let displayHeight = screenHeight;\n        let stageWidth = contentWidth;\n        let stageHeight = contentHeight;\n        let scaleX = screenWidth / stageWidth || 0;\n        let scaleY = screenHeight / stageHeight || 0;\n        switch (scaleMode) {\n            case \"exactFit\" /* EXACT_FIT */:\n                break;\n            case \"fixedHeight\" /* FIXED_HEIGHT */:\n                stageWidth = Math.round(screenWidth / scaleY);\n                break;\n            case \"fixedWidth\" /* FIXED_WIDTH */:\n                stageHeight = Math.round(screenHeight / scaleX);\n                break;\n            case \"noBorder\" /* NO_BORDER */:\n                if (scaleX > scaleY)\n                    displayHeight = Math.round(stageHeight * scaleX);\n                else\n                    displayWidth = Math.round(stageWidth * scaleY);\n                break;\n            case \"showAll\" /* SHOW_ALL */:\n                if (scaleX > scaleY)\n                    displayWidth = Math.round(stageWidth * scaleY);\n                else\n                    displayHeight = Math.round(stageHeight * scaleX);\n                break;\n            case \"fixedAuto\" /* FIXED_AUTO */:\n                if (displayWidth / displayHeight < stageWidth / stageHeight) {\n                    scaleY = scaleX;\n                    stageHeight = Math.round(screenHeight / scaleX);\n                }\n                else {\n                    scaleX = scaleY;\n                    stageWidth = Math.round(screenWidth / scaleY);\n                }\n                break;\n            default:\n                stageWidth = screenWidth;\n                stageHeight = screenHeight;\n                break;\n        }\n        return {\n            stageWidth: stageWidth,\n            stageHeight: stageHeight,\n            displayWidth: displayWidth,\n            displayHeight: displayHeight\n        };\n    }\n    /**@internal */\n    updateScreenSize() {\n        if (HTMLInput.isTyping)\n            return; //todo\n        let canvas = this.$appContext.canvas;\n        let canvasStyle = canvas.style;\n        // todo\n        let rect = this.$sizeCalcer.getRect(canvas, this.$options.fallbackWidth, this.$options.fallbackHeight);\n        let shouldRotate = false;\n        let orientation = this.$options.orientation;\n        if (orientation != \"auto\" /* AUTO */) {\n            shouldRotate =\n                (orientation != \"portrait\" /* PORTRAIT */ && rect.height > rect.width) ||\n                    (orientation == \"portrait\" /* PORTRAIT */ && rect.width > rect.height);\n        }\n        let screenWidth = shouldRotate ? rect.height : rect.width;\n        let screenHeight = shouldRotate ? rect.width : rect.height;\n        let stageSize = this.calculateStageSize(this.$options.scaleMode, screenWidth, screenHeight, this.$options.designWidth, this.$options.designHeight);\n        let stageWidth = stageSize.stageWidth;\n        let stageHeight = stageSize.stageHeight;\n        let displayWidth = stageSize.displayWidth;\n        let displayHeight = stageSize.displayHeight;\n        if (canvas.width !== stageWidth)\n            canvas.width = stageWidth;\n        if (canvas.height !== stageHeight)\n            canvas.height = stageHeight;\n        canvasStyle.transformOrigin = canvasStyle.webkitTransformOrigin = canvasStyle.msTransformOrigin = canvasStyle.mozTransformOrigin = canvasStyle.oTransformOrigin =\n            '0px 0px 0px';\n        canvasStyle.width = displayWidth + 'px';\n        canvasStyle.height = displayHeight + 'px';\n        let mat = this.$canvasMatrix.identity();\n        let dispWidth = shouldRotate ? displayHeight : displayWidth;\n        let dispHeight = shouldRotate ? displayWidth : displayHeight;\n        let offx, offy;\n        if (this.$options.alignH == 0 /* LEFT */)\n            offx = 0;\n        else if (this.$options.alignH == 2 /* RIGHT */)\n            offx = rect.width - dispWidth;\n        else\n            offx = (rect.width - dispWidth) * 0.5;\n        if (this.$options.alignV == 3 /* TOP */)\n            offy = 0;\n        else if (this.$options.alignV == 5 /* BOTTOM */)\n            offy = rect.height - dispHeight;\n        else\n            offy = (rect.height - dispHeight) * 0.5;\n        if (shouldRotate) {\n            if (this.$options.orientation == \"landscape\" /* LANDSCAPE */) {\n                mat.rotate(Math.PI / 2);\n                mat.translate(screenHeight - offx, offy);\n            }\n            else {\n                mat.rotate(-Math.PI / 2);\n                mat.translate(offx, screenWidth - offy);\n            }\n        }\n        else\n            mat.translate(offx, offy);\n        if (shouldRotate) {\n            mat.tx += this.offsetY;\n            mat.ty += this.offsetX;\n        }\n        else {\n            mat.tx += this.offsetX;\n            mat.ty += this.offsetY;\n        }\n        (mat.a = this.formatData(mat.a)),\n            (mat.d = this.formatData(mat.d)),\n            (mat.tx = this.formatData(mat.tx)),\n            (mat.ty = this.formatData(mat.ty));\n        canvasStyle.transformOrigin = canvasStyle.webkitTransformOrigin = canvasStyle.msTransformOrigin = canvasStyle.mozTransformOrigin = canvasStyle.oTransformOrigin =\n            '0px 0px 0px';\n        canvasStyle.transform = canvasStyle.webkitTransform = canvasStyle.msTransform = canvasStyle.mozTransform = canvasStyle.oTransform = `matrix(${mat.a},${mat.b},${mat.c},${mat.d},${mat.tx},${mat.ty})`;\n        this.$width = stageWidth;\n        this.$height = stageHeight;\n        this.$scaleX = stageWidth / displayWidth;\n        this.$scaleY = stageHeight / displayHeight;\n        this.$appContext.set({ width: stageWidth, height: stageHeight });\n        HTMLInput.inst.updateSize(displayWidth / stageWidth, displayHeight / stageHeight);\n        let evt = new createjs.Event(\"__sizeChanged\" /* SIZE_CHANGED */, true, false);\n        this.dispatchEvent(evt, this);\n    }\n    formatData(value) {\n        if (Math.abs(value) < 0.000001)\n            return 0;\n        if (Math.abs(1 - value) < 0.001)\n            return value > 0 ? 1 : -1;\n        return value;\n    }\n    dispose() {\n        let i = UIStageInst.length;\n        while (i-- >= 0) {\n            if (UIStageInst[i] === this)\n                UIStageInst.splice(i, 1);\n        }\n    }\n}\nlet UIStageInst = [];\nlet resizeCheckTimer = NaN;\nfunction resizeHandler() {\n    UIStageInst.forEach(stage => {\n        stage.updateScreenSize();\n    });\n}\nDOMEventManager.inst.on('resize', function () {\n    clearTimeout(resizeCheckTimer);\n    resizeCheckTimer = window.setTimeout(resizeHandler, 300);\n});\n\nclass Action {\n    execute(controller, prevPage, curPage) {\n        if ((!this.fromPage || this.fromPage.length == 0 || this.fromPage.indexOf(prevPage) != -1)\n            && (!this.toPage || this.toPage.length == 0 || this.toPage.indexOf(curPage) != -1))\n            this.enter(controller);\n        else\n            this.leave(controller);\n    }\n    enter(controller) {\n    }\n    leave(controller) {\n    }\n    setup(xml) {\n        let str;\n        str = xml.attributes.fromPage;\n        if (str)\n            this.fromPage = str.split(\",\");\n        str = xml.attributes.toPage;\n        if (str)\n            this.toPage = str.split(\",\");\n    }\n}\n\nclass ChangePageAction extends Action {\n    enter(controller) {\n        if (!this.controllerName)\n            return;\n        let gcom;\n        if (this.objectId)\n            gcom = controller.parent.getChildById(this.objectId);\n        else\n            gcom = controller.parent;\n        if (gcom) {\n            let cc = gcom.getController(this.controllerName);\n            if (cc && cc != controller && !cc.$updating)\n                cc.selectedPageId = this.targetPage;\n        }\n    }\n    setup(xml) {\n        super.setup(xml);\n        this.objectId = xml.attributes.objectId;\n        this.controllerName = xml.attributes.controller;\n        this.targetPage = xml.attributes.targetPage;\n    }\n}\n\nclass PlayTransitionAction extends Action {\n    constructor() {\n        super(...arguments);\n        this.repeat = 1;\n        this.delay = 0;\n        this.stopOnExit = false;\n    }\n    enter(controller) {\n        let trans = controller.parent.getTransition(this.transitionName);\n        if (trans) {\n            if (this.$currentTransition && this.$currentTransition.playing)\n                trans.changeRepeat(this.repeat);\n            else\n                trans.play({\n                    times: this.repeat,\n                    delay: this.delay\n                });\n            this.$currentTransition = trans;\n        }\n    }\n    leave() {\n        if (this.stopOnExit && this.$currentTransition) {\n            this.$currentTransition.stop();\n            this.$currentTransition = null;\n        }\n    }\n    /**@internal */\n    setup(xml) {\n        super.setup(xml);\n        this.transitionName = xml.attributes.transition;\n        let str;\n        str = xml.attributes.repeat;\n        if (str)\n            this.repeat = parseInt(str);\n        str = xml.attributes.delay;\n        if (str)\n            this.delay = parseFloat(str);\n        this.stopOnExit = xml.attributes.stopOnExit == \"true\";\n    }\n}\n\nclass Controller extends createjs.EventDispatcher {\n    constructor() {\n        super();\n        this.$selectedIndex = 0;\n        this.$previousIndex = 0;\n        this.$pageIds = [];\n        this.$pageNames = [];\n        this.$selectedIndex = -1;\n        this.$previousIndex = -1;\n    }\n    get name() {\n        return this.$name;\n    }\n    set name(value) {\n        this.$name = value;\n    }\n    get parent() {\n        return this.$parent;\n    }\n    get selectedIndex() {\n        return this.$selectedIndex;\n    }\n    set selectedIndex(value) {\n        if (this.$selectedIndex != value) {\n            if (value > this.$pageIds.length - 1)\n                throw new Error(`index out of range: ${value}`);\n            this.$updating = true;\n            this.$previousIndex = this.$selectedIndex;\n            this.$selectedIndex = value;\n            this.$parent.applyController(this);\n            let event = new createjs.Event(\"__stateChanged\" /* CHANGED */, true, false);\n            this.dispatchEvent(event, this);\n            this.$updating = false;\n        }\n    }\n    //same effect as selectedIndex but without event emitted\n    setSelectedIndex(value = 0) {\n        if (this.$selectedIndex != value) {\n            if (value > this.$pageIds.length - 1)\n                throw new Error(`index out of range: ${value}`);\n            this.$updating = true;\n            this.$previousIndex = this.$selectedIndex;\n            this.$selectedIndex = value;\n            this.$parent.applyController(this);\n            this.$updating = false;\n        }\n    }\n    get previsousIndex() {\n        return this.$previousIndex;\n    }\n    get selectedPage() {\n        if (this.$selectedIndex == -1)\n            return null;\n        else\n            return this.$pageNames[this.$selectedIndex];\n    }\n    set selectedPage(val) {\n        this.selectedIndex = Math.max(0, this.$pageNames.indexOf(val));\n    }\n    setSelectedPage(value) {\n        this.setSelectedIndex(Math.max(0, this.$pageNames.indexOf(value)));\n    }\n    get previousPage() {\n        if (this.$previousIndex == -1)\n            return null;\n        else\n            return this.$pageNames[this.$previousIndex];\n    }\n    get pageCount() {\n        return this.$pageIds.length;\n    }\n    getPageName(index = 0) {\n        return this.$pageNames[index];\n    }\n    addPage(name = '') {\n        this.addPageAt(name, this.$pageIds.length);\n    }\n    addPageAt(name, index = 0) {\n        let nid = `${Controller.$nextPageId++}`;\n        if (index == this.$pageIds.length) {\n            this.$pageIds.push(nid);\n            this.$pageNames.push(name);\n        }\n        else {\n            this.$pageIds.splice(index, 0, nid);\n            this.$pageNames.splice(index, 0, name);\n        }\n    }\n    removePage(name) {\n        let i = this.$pageNames.indexOf(name);\n        if (i != -1) {\n            this.$pageIds.splice(i, 1);\n            this.$pageNames.splice(i, 1);\n            if (this.$selectedIndex >= this.$pageIds.length)\n                this.selectedIndex = this.$selectedIndex - 1;\n            else\n                this.$parent.applyController(this);\n        }\n    }\n    removePageAt(index = 0) {\n        this.$pageIds.splice(index, 1);\n        this.$pageNames.splice(index, 1);\n        if (this.$selectedIndex >= this.$pageIds.length)\n            this.selectedIndex = this.$selectedIndex - 1;\n        else\n            this.$parent.applyController(this);\n    }\n    clearPages() {\n        this.$pageIds.length = 0;\n        this.$pageNames.length = 0;\n        if (this.$selectedIndex != -1)\n            this.selectedIndex = -1;\n        else\n            this.$parent.applyController(this);\n    }\n    hasPage(aName) {\n        return this.$pageNames.indexOf(aName) >= 0;\n    }\n    getPageIndexById(aId) {\n        return this.$pageIds.indexOf(aId);\n    }\n    getPageIdByName(aName) {\n        let i = this.$pageNames.indexOf(aName);\n        if (i != -1)\n            return this.$pageIds[i];\n        else\n            return null;\n    }\n    getPageNameById(aId) {\n        let i = this.$pageIds.indexOf(aId);\n        if (i != -1)\n            return this.$pageNames[i];\n        else\n            return null;\n    }\n    getPageId(index = 0) {\n        return this.$pageIds[index];\n    }\n    get selectedPageId() {\n        if (this.$selectedIndex == -1)\n            return null;\n        else\n            return this.$pageIds[this.$selectedIndex];\n    }\n    set selectedPageId(val) {\n        this.selectedIndex = this.$pageIds.indexOf(val);\n    }\n    set oppositePageId(val) {\n        let i = this.$pageIds.indexOf(val);\n        if (i > 0)\n            this.selectedIndex = 0;\n        else if (this.$pageIds.length > 1)\n            this.selectedIndex = 1;\n    }\n    get previousPageId() {\n        if (this.$previousIndex == -1)\n            return null;\n        else\n            return this.$pageIds[this.$previousIndex];\n    }\n    executeActions() {\n        if (this.$actions && this.$actions.length > 0) {\n            this.$actions.forEach(a => {\n                a.execute(this, this.previousPageId, this.selectedPageId);\n            });\n        }\n    }\n    createAction(type) {\n        switch (type) {\n            case 'play_transition':\n                return new PlayTransitionAction();\n            case 'change_page':\n                return new ChangePageAction();\n        }\n        return null;\n    }\n    setup(xml) {\n        this.$name = xml.attributes.name;\n        this.$autoRadioGroupDepth = xml.attributes.autoRadioGroupDepth == 'true';\n        let str = xml.attributes.pages;\n        if (str) {\n            let arr = str.split(',');\n            let cnt = arr.length;\n            for (let i = 0; i < cnt; i += 2) {\n                this.$pageIds.push(arr[i]);\n                this.$pageNames.push(arr[i + 1]);\n            }\n        }\n        let col = xml.children;\n        if (col.length > 0) {\n            this.$actions = this.$actions || [];\n            col.forEach(cxml => {\n                let action = this.createAction(cxml.attributes.type);\n                action.setup(cxml);\n                this.$actions.push(action);\n            });\n        }\n        str = xml.attributes.transitions;\n        if (str) {\n            this.$actions = this.$actions || [];\n            let k, e;\n            str.split(',').forEach(str => {\n                if (str && str.length) {\n                    let pt = new PlayTransitionAction();\n                    k = str.indexOf('=');\n                    pt.transitionName = str.substr(k + 1);\n                    str = str.substring(0, k);\n                    k = str.indexOf('-');\n                    e = parseInt(str.substring(k + 1));\n                    if (e < this.$pageIds.length)\n                        pt.toPage = [this.$pageIds[e]];\n                    str = str.substring(0, k);\n                    if (str != '*') {\n                        e = parseInt(str);\n                        if (e < this.$pageIds.length)\n                            pt.fromPage = [this.$pageIds[e]];\n                    }\n                    pt.stopOnExit = true;\n                    this.$actions.push(pt);\n                }\n            });\n        }\n        if (this.$parent && this.$pageIds.length > 0)\n            this.$selectedIndex = 0;\n        else\n            this.$selectedIndex = -1;\n    }\n}\nController.$nextPageId = 0;\n\nclass NumberUtil {\n    static clamp(value, min, max) {\n        if (value < min)\n            value = min;\n        else if (value > max)\n            value = max;\n        return value;\n    }\n    static clamp01(value) {\n        if (value > 1)\n            value = 1;\n        else if (value < 0)\n            value = 0;\n        return value;\n    }\n    static isNumber(n) {\n        if (typeof n != 'number')\n            return false;\n        if (isNaN(n))\n            return false;\n        return true;\n    }\n    static sign(x) {\n        x = Number(x);\n        if (x === 0 || isNaN(x))\n            return x;\n        return x > 0 ? 1 : -1;\n    }\n    static angleToRadian(n) {\n        return n * NumberUtil.RADIAN;\n    }\n    static lerp(s, e, p) {\n        return s + p * (e - s);\n    }\n}\nNumberUtil.RADIAN = Math.PI / 180;\n\nconst isMobile = (0,ismobilejs__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(window.navigator);\n\nclass ScrollPane extends createjs.EventDispatcher {\n    constructor(owner, scrollType, scrollBarMargin, scrollBarDisplay, flags, vtScrollBarRes, hzScrollBarRes, headerRes, footerRes) {\n        super();\n        this.$isDragging = false;\n        this.$owner = owner;\n        this.$maskContainer = new UIContainer(null);\n        this.$owner.$rootContainer.addChild(this.$maskContainer);\n        this.$container = this.$owner.$container;\n        this.$container.x = 0;\n        this.$container.y = 0;\n        this.$maskContainer.addChild(this.$container);\n        this.$scrollBarMargin = scrollBarMargin;\n        this.$scrollType = scrollType;\n        this.$scrollSpeed = UIConfig.defaultScrollSpeed;\n        this.$mouseWheelSpeed = this.$scrollSpeed * 2;\n        this.$decelerationRate = UIConfig.defaultScrollDecelerationRate;\n        this.$displayOnLeft = (flags & 1 /* DisplayOnLeft */) != 0;\n        this.$snapToItem = (flags & 2 /* SnapToItem */) != 0;\n        this.$displayOnDemand = (flags & 4 /* DisplayOnDemand */) != 0;\n        this.$pageMode = (flags & 8 /* PageMode */) != 0;\n        if (flags & 16 /* TouchEffect */)\n            this.$touchEffect = true;\n        else if (flags & 32 /* DisableTouchEffect */)\n            this.$touchEffect = false;\n        else\n            this.$touchEffect = UIConfig.defaultScrollTouchEffect;\n        if (flags & 64 /* BounceEffect */)\n            this.$bouncebackEffect = true;\n        else if (flags & 128 /* DisableBounceEffect */)\n            this.$bouncebackEffect = false;\n        else\n            this.$bouncebackEffect = UIConfig.defaultScrollBounceEffect;\n        this.$inertiaDisabled = (flags & 256 /* DisableInertia */) != 0;\n        if ((flags & 512 /* DisableScissorRect */) == 0)\n            this.$maskContainer.scrollRect = new createjs.Rectangle();\n        this.$scrollBarVisible = true;\n        this.$mouseWheelEnabled = true;\n        this.$xPos = 0;\n        this.$yPos = 0;\n        this.$aniFlag = 0;\n        this.$footerLockedSize = 0;\n        this.$headerLockedSize = 0;\n        if (scrollBarDisplay == 0 /* Default */)\n            scrollBarDisplay = UIConfig.defaultScrollBarDisplay;\n        this.$viewSize = new createjs.Point();\n        this.$contentSize = new createjs.Point();\n        this.$pageSize = new createjs.Point(1, 1);\n        this.$overlapSize = new createjs.Point();\n        this.$tweening = 0;\n        this.$tweenTime = new createjs.Point();\n        this.$tweenStart = new createjs.Point();\n        this.$tweenDuration = new createjs.Point();\n        this.$tweenChange = new createjs.Point();\n        this.$velocity = new createjs.Point();\n        this.$containerPos = new createjs.Point();\n        this.$beginTouchPos = new createjs.Point();\n        this.$lastTouchPos = new createjs.Point();\n        this.$lastTouchGlobalPos = new createjs.Point();\n        let res;\n        if (scrollBarDisplay != 3 /* Hidden */) {\n            if (this.$scrollType == 2 /* Both */ || this.$scrollType == 1 /* Vertical */) {\n                const res = vtScrollBarRes ? vtScrollBarRes : UIConfig.verticalScrollBar;\n                if (res) {\n                    this.$vtScrollBar = UIPackage.createObjectFromURL(res);\n                    if (!this.$vtScrollBar)\n                        throw new Error(`Cannot create scrollbar from ${res}`);\n                    this.$vtScrollBar.setScrollPane(this, true);\n                    this.$owner.$rootContainer.addChild(this.$vtScrollBar.displayObject);\n                }\n            }\n            if (this.$scrollType == 2 /* Both */ || this.$scrollType == 0 /* Horizontal */) {\n                res = hzScrollBarRes ? hzScrollBarRes : UIConfig.horizontalScrollBar;\n                if (res) {\n                    this.$hzScrollBar = UIPackage.createObjectFromURL(res);\n                    if (!this.$hzScrollBar)\n                        throw new Error(`Cannot create scrollbar from ${res}`);\n                    this.$hzScrollBar.setScrollPane(this, false);\n                    this.$owner.$rootContainer.addChild(this.$hzScrollBar.displayObject);\n                }\n            }\n            this.$scrollBarDisplayAuto = scrollBarDisplay == 2 /* Auto */;\n            if (this.$scrollBarDisplayAuto) {\n                this.$scrollBarVisible = false;\n                if (this.$vtScrollBar)\n                    this.$vtScrollBar.displayObject.visible = false;\n                if (this.$hzScrollBar)\n                    this.$hzScrollBar.displayObject.visible = false;\n            }\n        }\n        else\n            this.$mouseWheelEnabled = false;\n        if (headerRes) {\n            this.$header = UIPackage.createObjectFromURL(headerRes);\n            if (this.$header == null)\n                throw new Error(`Cannot create scrollPane.header from ${res}`);\n        }\n        if (footerRes) {\n            this.$footer = UIPackage.createObjectFromURL(footerRes);\n            if (this.$footer == null)\n                throw new Error(`Cannot create scrollPane.footer from ${res}`);\n        }\n        if (this.$header != null || this.$footer != null)\n            this.$refreshBarAxis =\n                this.$scrollType == 2 /* Both */ || this.$scrollType == 1 /* Vertical */ ? 'y' : 'x';\n        this.setSize(owner.width, owner.height);\n        this.$owner.on(InteractiveEvents.Over, this.$rollOver, this);\n        this.$owner.on(InteractiveEvents.Out, this.$rollOut, this);\n        this.$owner.on(InteractiveEvents.Down, this.$mouseDown, this);\n        this.$owner.on(\"__mouseWheel\" /* MOUSE_WHEEL */, this.$mouseWheel, this);\n    }\n    get owner() {\n        return this.$owner;\n    }\n    dispose() {\n        if (this.$tweening != 0)\n            GTimer.inst.remove(this.tweenUpdate, this);\n        this.$pageController = null;\n        if (this.$hzScrollBar != null)\n            this.$hzScrollBar.dispose();\n        if (this.$vtScrollBar != null)\n            this.$vtScrollBar.dispose();\n        if (this.$header != null)\n            this.$header.dispose();\n        if (this.$footer != null)\n            this.$footer.dispose();\n        Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Move, this.$mouseMoveEvent);\n        Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Up, this.$mouseUpEvent);\n        Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Click, this.$clickEvent);\n        this.$owner.off(InteractiveEvents.Over, this.$rollOver);\n        this.$owner.off(InteractiveEvents.Out, this.$rollOut);\n        this.$owner.off(InteractiveEvents.Down, this.$mouseDown);\n        this.$owner.off(\"__mouseWheel\" /* MOUSE_WHEEL */, this.$mouseWheel);\n    }\n    get horzScrollBar() {\n        return this.$hzScrollBar;\n    }\n    get vertScrollBar() {\n        return this.$vtScrollBar;\n    }\n    get header() {\n        return this.$header;\n    }\n    get footer() {\n        return this.$footer;\n    }\n    get bouncebackEffect() {\n        return this.$bouncebackEffect;\n    }\n    set bouncebackEffect(sc) {\n        this.$bouncebackEffect = sc;\n    }\n    get touchEffect() {\n        return this.$touchEffect;\n    }\n    set touchEffect(sc) {\n        this.$touchEffect = sc;\n    }\n    set scrollSpeed(val) {\n        this.$scrollSpeed = val;\n        if (this.$scrollSpeed == 0)\n            this.$scrollSpeed = UIConfig.defaultScrollSpeed;\n        this.$mouseWheelSpeed = this.$scrollSpeed * 2;\n    }\n    get scrollSpeed() {\n        return this.$scrollSpeed;\n    }\n    get snapToItem() {\n        return this.$snapToItem;\n    }\n    set snapToItem(value) {\n        this.$snapToItem = value;\n    }\n    get mouseWheelEnabled() {\n        return this.$mouseWheelEnabled;\n    }\n    set mouseWheelEnabled(value) {\n        this.$mouseWheelEnabled = value;\n    }\n    get decelerationRate() {\n        return this.$decelerationRate;\n    }\n    set decelerationRate(value) {\n        this.$decelerationRate = value;\n    }\n    get percX() {\n        return this.$overlapSize.x == 0 ? 0 : this.$xPos / this.$overlapSize.x;\n    }\n    set percX(value) {\n        this.setPercX(value, false);\n    }\n    setPercX(value, ani = false) {\n        this.$owner.ensureBoundsCorrect();\n        this.setPosX(this.$overlapSize.x * NumberUtil.clamp01(value), ani);\n    }\n    get percY() {\n        return this.$overlapSize.y == 0 ? 0 : this.$yPos / this.$overlapSize.y;\n    }\n    set percY(value) {\n        this.setPercY(value, false);\n    }\n    setPercY(value, ani = false) {\n        this.$owner.ensureBoundsCorrect();\n        this.setPosY(this.$overlapSize.y * NumberUtil.clamp01(value), ani);\n    }\n    get posX() {\n        return this.$xPos;\n    }\n    set posX(value) {\n        this.setPosX(value, false);\n    }\n    setPosX(value, ani = false) {\n        this.$owner.ensureBoundsCorrect();\n        if (this.$loop == 1)\n            value = this.loopCheckingNewPos(value, 'x');\n        value = NumberUtil.clamp(value, 0, this.$overlapSize.x);\n        if (value != this.$xPos) {\n            this.$xPos = value;\n            this.posChanged(ani);\n        }\n    }\n    get posY() {\n        return this.$yPos;\n    }\n    set posY(value) {\n        this.setPosY(value, false);\n    }\n    setPosY(value, ani = false) {\n        this.$owner.ensureBoundsCorrect();\n        if (this.$loop == 1)\n            value = this.loopCheckingNewPos(value, 'y');\n        value = NumberUtil.clamp(value, 0, this.$overlapSize.y);\n        if (value != this.$yPos) {\n            this.$yPos = value;\n            this.posChanged(ani);\n        }\n    }\n    get contentWidth() {\n        return this.$contentSize.x;\n    }\n    get contentHeight() {\n        return this.$contentSize.y;\n    }\n    get viewWidth() {\n        return this.$viewSize.x;\n    }\n    set viewWidth(value) {\n        value = value + this.$owner.margin.left + this.$owner.margin.right;\n        if (this.$vtScrollBar != null)\n            value += this.$vtScrollBar.width;\n        this.$owner.width = value;\n    }\n    get viewHeight() {\n        return this.$viewSize.y;\n    }\n    set viewHeight(value) {\n        value = value + this.$owner.margin.top + this.$owner.margin.bottom;\n        if (this.$hzScrollBar != null)\n            value += this.$hzScrollBar.height;\n        this.$owner.height = value;\n    }\n    get currentPageX() {\n        if (!this.$pageMode)\n            return 0;\n        var page = Math.floor(this.$xPos / this.$pageSize.x);\n        if (this.$xPos - page * this.$pageSize.x > this.$pageSize.x * 0.5)\n            page++;\n        return page;\n    }\n    set currentPageX(value) {\n        if (this.$pageMode && this.$overlapSize.x > 0)\n            this.setPosX(value * this.$pageSize.x, false);\n    }\n    get currentPageY() {\n        if (!this.$pageMode)\n            return 0;\n        let page = Math.floor(this.$yPos / this.$pageSize.y);\n        if (this.$yPos - page * this.$pageSize.y > this.$pageSize.y * 0.5)\n            page++;\n        return page;\n    }\n    set currentPageY(value) {\n        if (this.$pageMode && this.$overlapSize.y > 0)\n            this.setPosY(value * this.$pageSize.y, false);\n    }\n    get isBottomMost() {\n        return this.$yPos == this.$overlapSize.y || this.$overlapSize.y == 0;\n    }\n    get isRightMost() {\n        return this.$xPos == this.$overlapSize.x || this.$overlapSize.x == 0;\n    }\n    get pageController() {\n        return this.$pageController;\n    }\n    set pageController(value) {\n        this.$pageController = value;\n    }\n    get scrollingPosX() {\n        return NumberUtil.clamp(-this.$container.x, 0, this.$overlapSize.x);\n    }\n    get scrollingPosY() {\n        return NumberUtil.clamp(-this.$container.y, 0, this.$overlapSize.y);\n    }\n    scrollTop(ani = false) {\n        this.setPercY(0, ani);\n    }\n    scrollBottom(ani = false) {\n        this.setPercY(1, ani);\n    }\n    scrollUp(ratio = 1, ani = false) {\n        if (this.$pageMode)\n            this.setPosY(this.$yPos - this.$pageSize.y * ratio, ani);\n        else\n            this.setPosY(this.$yPos - this.$scrollSpeed * ratio, ani);\n    }\n    scrollDown(ratio = 1, ani = false) {\n        if (this.$pageMode)\n            this.setPosY(this.$yPos + this.$pageSize.y * ratio, ani);\n        else\n            this.setPosY(this.$yPos + this.$scrollSpeed * ratio, ani);\n    }\n    scrollLeft(ratio = 1, ani = false) {\n        if (this.$pageMode)\n            this.setPosX(this.$xPos - this.$pageSize.x * ratio, ani);\n        else\n            this.setPosX(this.$xPos - this.$scrollSpeed * ratio, ani);\n    }\n    scrollRight(ratio = 1, ani = false) {\n        if (this.$pageMode)\n            this.setPosX(this.$xPos + this.$pageSize.x * ratio, ani);\n        else\n            this.setPosX(this.$xPos + this.$scrollSpeed * ratio, ani);\n    }\n    scrollToView(target, ani = false, snapToFirst = false) {\n        this.$owner.ensureBoundsCorrect();\n        if (this.$needRefresh)\n            this.refresh();\n        let rect;\n        if (target instanceof GObject) {\n            if (target.parent != this.$owner) {\n                target.parent.localToGlobalRect(target.x, target.y, target.width, target.height, ScrollPane.sHelperRect);\n                rect = this.$owner.globalToLocalRect(ScrollPane.sHelperRect.x, ScrollPane.sHelperRect.y, ScrollPane.sHelperRect.width, ScrollPane.sHelperRect.height, ScrollPane.sHelperRect);\n            }\n            else {\n                rect = ScrollPane.sHelperRect;\n                rect.x = target.x;\n                rect.y = target.y;\n                rect.width = target.width;\n                rect.height = target.height;\n            }\n        }\n        else\n            rect = target;\n        if (this.$overlapSize.y > 0) {\n            const bottom = this.$yPos + this.$viewSize.y;\n            if (snapToFirst || rect.y <= this.$yPos || rect.height >= this.$viewSize.y) {\n                if (this.$pageMode)\n                    this.setPosY(Math.floor(rect.y / this.$pageSize.y) * this.$pageSize.y, ani);\n                else\n                    this.setPosY(rect.y, ani);\n            }\n            else if (rect.y + rect.height > bottom) {\n                if (this.$pageMode)\n                    this.setPosY(Math.floor(rect.y / this.$pageSize.y) * this.$pageSize.y, ani);\n                else if (rect.height <= this.$viewSize.y / 2)\n                    this.setPosY(rect.y + rect.height * 2 - this.$viewSize.y, ani);\n                else\n                    this.setPosY(rect.y + rect.height - this.$viewSize.y, ani);\n            }\n        }\n        if (this.$overlapSize.x > 0) {\n            let right = this.$xPos + this.$viewSize.x;\n            if (snapToFirst || rect.x <= this.$xPos || rect.width >= this.$viewSize.x) {\n                if (this.$pageMode)\n                    this.setPosX(Math.floor(rect.x / this.$pageSize.x) * this.$pageSize.x, ani);\n                else\n                    this.setPosX(rect.x, ani);\n            }\n            else if (rect.x + rect.width > right) {\n                if (this.$pageMode)\n                    this.setPosX(Math.floor(rect.x / this.$pageSize.x) * this.$pageSize.x, ani);\n                else if (rect.width <= this.$viewSize.x / 2)\n                    this.setPosX(rect.x + rect.width * 2 - this.$viewSize.x, ani);\n                else\n                    this.setPosX(rect.x + rect.width - this.$viewSize.x, ani);\n            }\n        }\n        if (!ani && this.$needRefresh)\n            this.refresh();\n    }\n    isChildInView(obj) {\n        if (this.$overlapSize.y > 0) {\n            var dist = obj.y + this.$container.y;\n            if (dist < -obj.height || dist > this.$viewSize.y)\n                return false;\n        }\n        if (this.$overlapSize.x > 0) {\n            dist = obj.x + this.$container.x;\n            if (dist < -obj.width || dist > this.$viewSize.x)\n                return false;\n        }\n        return true;\n    }\n    cancelDragging() {\n        Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Move, this.$mouseMoveEvent);\n        Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Up, this.$mouseUpEvent);\n        Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Click, this.$clickEvent);\n        if (ScrollPane.draggingPane == this)\n            ScrollPane.draggingPane = null;\n        ScrollPane.$gestureFlag = 0;\n        this.$isDragging = false;\n        this.$maskContainer.mouseEnabled = true;\n    }\n    get isDragging() {\n        return this.$isDragging;\n    }\n    lockHeader(size) {\n        if (this.$headerLockedSize == size)\n            return;\n        this.$headerLockedSize = size;\n        if (!this.$refreshEventDispatching &&\n            this.$container[this.$refreshBarAxis] >= 0) {\n            this.$tweenStart.setValues(this.$container.x, this.$container.y);\n            this.$tweenChange.setValues(0, 0);\n            this.$tweenChange[this.$refreshBarAxis] =\n                this.$headerLockedSize - this.$tweenStart[this.$refreshBarAxis];\n            this.$tweenDuration.setValues(ScrollPane.TWEEN_DEFAULT_DURATION, ScrollPane.TWEEN_DEFAULT_DURATION);\n            this.$tweenTime.setValues(0, 0);\n            this.$tweening = 2;\n            GTimer.inst.addLoop(1, this.tweenUpdate, this);\n        }\n    }\n    lockFooter(size) {\n        if (this.$footerLockedSize == size)\n            return;\n        this.$footerLockedSize = size;\n        if (!this.$refreshEventDispatching &&\n            this.$container[this.$refreshBarAxis] <=\n                -this.$overlapSize[this.$refreshBarAxis]) {\n            this.$tweenStart.setValues(this.$container.x, this.$container.y);\n            this.$tweenChange.setValues(0, 0);\n            let max = this.$overlapSize[this.$refreshBarAxis];\n            if (max == 0)\n                max = Math.max(this.$contentSize[this.$refreshBarAxis] +\n                    this.$footerLockedSize -\n                    this.$viewSize[this.$refreshBarAxis], 0);\n            else\n                max += this.$footerLockedSize;\n            this.$tweenChange[this.$refreshBarAxis] =\n                -max - this.$tweenStart[this.$refreshBarAxis];\n            this.$tweenDuration.setValues(ScrollPane.TWEEN_DEFAULT_DURATION, ScrollPane.TWEEN_DEFAULT_DURATION);\n            this.$tweenTime.setValues(0, 0);\n            this.$tweening = 2;\n            GTimer.inst.addLoop(1, this.tweenUpdate, this);\n        }\n    }\n    /**\n     * @internal\n     */\n    onOwnerSizeChanged() {\n        this.setSize(this.$owner.width, this.$owner.height);\n        this.posChanged(false);\n    }\n    /**\n     * @internal\n     */\n    handleControllerChanged(c) {\n        if (this.$pageController == c) {\n            if (this.$scrollType == 0 /* Horizontal */)\n                this.currentPageX = c.selectedIndex;\n            else\n                this.currentPageY = c.selectedIndex;\n        }\n    }\n    updatePageController() {\n        if (this.$pageController != null && !this.$pageController.$updating) {\n            let index;\n            if (this.$scrollType == 0 /* Horizontal */)\n                index = this.currentPageX;\n            else\n                index = this.currentPageY;\n            if (index < this.$pageController.pageCount) {\n                const c = this.$pageController;\n                this.$pageController = null; //prevent from handleControllerChanged calling\n                c.selectedIndex = index;\n                this.$pageController = c;\n            }\n        }\n    }\n    /**\n     * @internal\n     */\n    adjustMaskContainer() {\n        let x, y;\n        if (this.$displayOnLeft && this.$vtScrollBar != null)\n            x = Math.floor(this.$owner.margin.left + this.$vtScrollBar.width);\n        else\n            x = Math.floor(this.$owner.margin.left);\n        y = Math.floor(this.$owner.margin.top);\n        this.$maskContainer.set({ x, y });\n        if (this.$owner.$alignOffset.x != 0 || this.$owner.$alignOffset.y != 0) {\n            if (this.$alignContainer == null) {\n                this.$alignContainer = new createjs.Container();\n                this.$maskContainer.addChild(this.$alignContainer);\n                this.$alignContainer.addChild(this.$container);\n            }\n            this.$alignContainer.set({ x: this.$owner.$alignOffset.x, y: this.$owner.$alignOffset.y });\n        }\n        else if (this.$alignContainer)\n            this.$alignContainer.set({ x: 0, y: 0 });\n    }\n    setSize(width, height) {\n        this.adjustMaskContainer();\n        if (this.$hzScrollBar) {\n            this.$hzScrollBar.y = height - this.$hzScrollBar.height;\n            if (this.$vtScrollBar && !this.$vScrollNone) {\n                this.$hzScrollBar.width =\n                    width - this.$vtScrollBar.width - this.$scrollBarMargin.left - this.$scrollBarMargin.right;\n                if (this.$displayOnLeft)\n                    this.$hzScrollBar.x = this.$scrollBarMargin.left + this.$vtScrollBar.width;\n                else\n                    this.$hzScrollBar.x = this.$scrollBarMargin.left;\n            }\n            else {\n                this.$hzScrollBar.width = width - this.$scrollBarMargin.left - this.$scrollBarMargin.right;\n                this.$hzScrollBar.x = this.$scrollBarMargin.left;\n            }\n        }\n        if (this.$vtScrollBar) {\n            if (!this.$displayOnLeft)\n                this.$vtScrollBar.x = width - this.$vtScrollBar.width;\n            if (this.$hzScrollBar)\n                this.$vtScrollBar.height =\n                    height -\n                        this.$hzScrollBar.height -\n                        this.$scrollBarMargin.top -\n                        this.$scrollBarMargin.bottom;\n            else\n                this.$vtScrollBar.height = height - this.$scrollBarMargin.top - this.$scrollBarMargin.bottom;\n            this.$vtScrollBar.y = this.$scrollBarMargin.top;\n        }\n        this.$viewSize.x = width;\n        this.$viewSize.y = height;\n        if (this.$hzScrollBar && !this.$hScrollNone)\n            this.$viewSize.y -= this.$hzScrollBar.height;\n        if (this.$vtScrollBar && !this.$vScrollNone)\n            this.$viewSize.x -= this.$vtScrollBar.width;\n        this.$viewSize.x -= this.$owner.margin.left + this.$owner.margin.right;\n        this.$viewSize.y -= this.$owner.margin.top + this.$owner.margin.bottom;\n        this.$viewSize.x = Math.max(1, this.$viewSize.x);\n        this.$viewSize.y = Math.max(1, this.$viewSize.y);\n        this.$pageSize.x = this.$viewSize.x;\n        this.$pageSize.y = this.$viewSize.y;\n        this.handleSizeChanged();\n    }\n    setContentSize(w, h) {\n        if (this.$contentSize.x == w && this.$contentSize.y == h)\n            return;\n        this.$contentSize.x = w;\n        this.$contentSize.y = h;\n        this.handleSizeChanged();\n    }\n    /**\n     * @internal\n     */\n    changeContentSizeOnScrolling(deltaWidth, deltaHeight, deltaPosX, deltaPosY) {\n        const isRightmost = this.$xPos == this.$overlapSize.x;\n        const isBottom = this.$yPos == this.$overlapSize.y;\n        this.$contentSize.x += deltaWidth;\n        this.$contentSize.y += deltaHeight;\n        this.handleSizeChanged();\n        if (this.$tweening == 1) {\n            //if the last scroll is CLINGING-SIDE, then just continue to cling\n            if (deltaWidth != 0 && isRightmost && this.$tweenChange.x < 0) {\n                this.$xPos = this.$overlapSize.x;\n                this.$tweenChange.x = -this.$xPos - this.$tweenStart.x;\n            }\n            if (deltaHeight != 0 && isBottom && this.$tweenChange.y < 0) {\n                this.$yPos = this.$overlapSize.y;\n                this.$tweenChange.y = -this.$yPos - this.$tweenStart.y;\n            }\n        }\n        else if (this.$tweening == 2) {\n            //re-pos to ensure the scrolling will go on smooth\n            if (deltaPosX != 0) {\n                this.$container.x -= deltaPosX;\n                this.$tweenStart.x -= deltaPosX;\n                this.$xPos = -this.$container.x;\n            }\n            if (deltaPosY != 0) {\n                this.$container.y -= deltaPosY;\n                this.$tweenStart.y -= deltaPosY;\n                this.$yPos = -this.$container.y;\n            }\n        }\n        else if (this.$isDragging) {\n            if (deltaPosX != 0) {\n                this.$container.x -= deltaPosX;\n                this.$containerPos.x -= deltaPosX;\n                this.$xPos = -this.$container.x;\n            }\n            if (deltaPosY != 0) {\n                this.$container.y -= deltaPosY;\n                this.$containerPos.y -= deltaPosY;\n                this.$yPos = -this.$container.y;\n            }\n        }\n        else {\n            //if the last scroll is CLINGING-SIDE, then just continue to cling\n            if (deltaWidth != 0 && isRightmost) {\n                this.$xPos = this.$overlapSize.x;\n                this.$container.x = -this.$xPos;\n            }\n            if (deltaHeight != 0 && isBottom) {\n                this.$yPos = this.$overlapSize.y;\n                this.$container.y = -this.$yPos;\n            }\n        }\n        if (this.$pageMode)\n            this.updatePageController();\n    }\n    handleSizeChanged(onScrolling = false) {\n        if (this.$displayOnDemand) {\n            if (this.$vtScrollBar) {\n                if (this.$contentSize.y <= this.$viewSize.y) {\n                    if (!this.$vScrollNone) {\n                        this.$vScrollNone = true;\n                        this.$viewSize.x += this.$vtScrollBar.width;\n                    }\n                }\n                else {\n                    if (this.$vScrollNone) {\n                        this.$vScrollNone = false;\n                        this.$viewSize.x -= this.$vtScrollBar.width;\n                    }\n                }\n            }\n            if (this.$hzScrollBar) {\n                if (this.$contentSize.x <= this.$viewSize.x) {\n                    if (!this.$hScrollNone) {\n                        this.$hScrollNone = true;\n                        this.$viewSize.y += this.$hzScrollBar.height;\n                    }\n                }\n                else {\n                    if (this.$hScrollNone) {\n                        this.$hScrollNone = false;\n                        this.$viewSize.y -= this.$hzScrollBar.height;\n                    }\n                }\n            }\n        }\n        if (this.$vtScrollBar) {\n            if (this.$viewSize.y < this.$vtScrollBar.minSize)\n                //use this.$vtScrollBar.displayObject.visible instead of this.$vtScrollBar.visible... ScrollBar actually is not in its owner's display tree, so vtScrollBar.visible will not work\n                this.$vtScrollBar.displayObject.visible = false;\n            else {\n                this.$vtScrollBar.displayObject.visible = this.$scrollBarVisible && !this.$vScrollNone;\n                if (this.$contentSize.y == 0)\n                    this.$vtScrollBar.displayPerc = 0;\n                else\n                    this.$vtScrollBar.displayPerc = Math.min(1, this.$viewSize.y / this.$contentSize.y);\n            }\n        }\n        if (this.$hzScrollBar) {\n            if (this.$viewSize.x < this.$hzScrollBar.minSize)\n                this.$hzScrollBar.displayObject.visible = false;\n            else {\n                this.$hzScrollBar.displayObject.visible = this.$scrollBarVisible && !this.$hScrollNone;\n                if (this.$contentSize.x == 0)\n                    this.$hzScrollBar.displayPerc = 0;\n                else\n                    this.$hzScrollBar.displayPerc = Math.min(1, this.$viewSize.x / this.$contentSize.x);\n            }\n        }\n        const rect = this.$maskContainer.scrollRect;\n        if (rect) {\n            rect.width = this.$viewSize.x;\n            rect.height = this.$viewSize.y;\n            this.$maskContainer.scrollRect = rect;\n        }\n        if (this.$scrollType == 0 /* Horizontal */ || this.$scrollType == 2 /* Both */)\n            this.$overlapSize.x = Math.ceil(Math.max(0, this.$contentSize.x - this.$viewSize.x));\n        else\n            this.$overlapSize.x = 0;\n        if (this.$scrollType == 1 /* Vertical */ || this.$scrollType == 2 /* Both */)\n            this.$overlapSize.y = Math.ceil(Math.max(0, this.$contentSize.y - this.$viewSize.y));\n        else\n            this.$overlapSize.y = 0;\n        //bounds checking\n        this.$xPos = NumberUtil.clamp(this.$xPos, 0, this.$overlapSize.x);\n        this.$yPos = NumberUtil.clamp(this.$yPos, 0, this.$overlapSize.y);\n        if (this.$refreshBarAxis != null) {\n            var max = this.$overlapSize[this.$refreshBarAxis];\n            if (max == 0)\n                max = Math.max(this.$contentSize[this.$refreshBarAxis] +\n                    this.$footerLockedSize -\n                    this.$viewSize[this.$refreshBarAxis], 0);\n            else\n                max += this.$footerLockedSize;\n            if (this.$refreshBarAxis == 'x') {\n                this.$container.set({\n                    x: NumberUtil.clamp(this.$container.x, -max, this.$headerLockedSize),\n                    y: NumberUtil.clamp(this.$container.y, -this.$overlapSize.y, 0)\n                });\n            }\n            else {\n                this.$container.set({\n                    x: NumberUtil.clamp(this.$container.x, -this.$overlapSize.x, 0),\n                    y: NumberUtil.clamp(this.$container.y, -max, this.$headerLockedSize)\n                });\n            }\n            if (this.$header != null) {\n                if (this.$refreshBarAxis == 'x')\n                    this.$header.height = this.$viewSize.y;\n                else\n                    this.$header.width = this.$viewSize.x;\n            }\n            if (this.$footer != null) {\n                if (this.$refreshBarAxis == 'y')\n                    this.$footer.height = this.$viewSize.y;\n                else\n                    this.$footer.width = this.$viewSize.x;\n            }\n        }\n        else {\n            this.$container.set({\n                x: NumberUtil.clamp(this.$container.x, -this.$overlapSize.x, 0),\n                y: NumberUtil.clamp(this.$container.y, -this.$overlapSize.y, 0)\n            });\n        }\n        this.syncScrollBar();\n        this.checkRefreshBar();\n        if (this.$pageMode)\n            this.updatePageController();\n    }\n    posChanged(ani) {\n        if (this.$aniFlag == 0)\n            this.$aniFlag = ani ? 1 : -1;\n        else if (this.$aniFlag == 1 && !ani)\n            this.$aniFlag = -1;\n        this.$needRefresh = true;\n        GTimer.inst.callLater(this.refresh, this);\n    }\n    refresh() {\n        this.$needRefresh = false;\n        GTimer.inst.remove(this.refresh, this);\n        if (this.$pageMode || this.$snapToItem) {\n            ScrollPane.sEndPos.setValues(-this.$xPos, -this.$yPos);\n            this.alignPosition(ScrollPane.sEndPos, false);\n            this.$xPos = -ScrollPane.sEndPos.x;\n            this.$yPos = -ScrollPane.sEndPos.y;\n        }\n        this.refresh2();\n        let evt = new createjs.Event(\"__scroll\" /* SCROLL */, true, false);\n        this.dispatchEvent(evt, this);\n        if (this.$needRefresh) {\n            //developer might modify position in the callback, so here refresh again to avoid flickering\n            this.$needRefresh = false;\n            GTimer.inst.remove(this.refresh, this);\n            this.refresh2();\n        }\n        this.syncScrollBar();\n        this.$aniFlag = 0;\n    }\n    refresh2() {\n        if (this.$aniFlag == 1 && !this.$isDragging) {\n            let posX;\n            let posY;\n            if (this.$overlapSize.x > 0)\n                posX = -Math.floor(this.$xPos);\n            else {\n                if (this.$container.x != 0)\n                    this.$container.x = 0;\n                posX = 0;\n            }\n            if (this.$overlapSize.y > 0)\n                posY = -Math.floor(this.$yPos);\n            else {\n                if (this.$container.y != 0)\n                    this.$container.y = 0;\n                posY = 0;\n            }\n            if (posX != this.$container.x || posY != this.$container.y) {\n                this.$tweening = 1;\n                this.$tweenTime.setValues(0, 0);\n                this.$tweenDuration.setValues(ScrollPane.TWEEN_MANUALLY_SET_DURATION, ScrollPane.TWEEN_MANUALLY_SET_DURATION);\n                this.$tweenStart.setValues(this.$container.x, this.$container.y);\n                this.$tweenChange.setValues(posX - this.$tweenStart.x, posY - this.$tweenStart.y);\n                GTimer.inst.addLoop(1, this.tweenUpdate, this);\n            }\n            else if (this.$tweening != 0)\n                this.killTween();\n        }\n        else {\n            if (this.$tweening != 0)\n                this.killTween();\n            this.$container.set({ x: Math.floor(-this.$xPos), y: Math.floor(-this.$yPos) });\n            this.loopCheckingCurrent();\n        }\n        if (this.$pageMode)\n            this.updatePageController();\n    }\n    syncScrollBar(end = false) {\n        if (this.$vtScrollBar != null) {\n            this.$vtScrollBar.scrollPerc =\n                this.$overlapSize.y == 0\n                    ? 0\n                    : NumberUtil.clamp(-this.$container.y, 0, this.$overlapSize.y) / this.$overlapSize.y;\n            if (this.$scrollBarDisplayAuto)\n                this.showScrollBar(!end);\n        }\n        if (this.$hzScrollBar != null) {\n            this.$hzScrollBar.scrollPerc =\n                this.$overlapSize.x == 0\n                    ? 0\n                    : NumberUtil.clamp(-this.$container.x, 0, this.$overlapSize.x) / this.$overlapSize.x;\n            if (this.$scrollBarDisplayAuto)\n                this.showScrollBar(!end);\n        }\n        if (end)\n            this.$maskContainer.mouseEnabled = true;\n    }\n    $mouseDown(e) {\n        if (!this.$touchEffect)\n            return;\n        if (this.$tweening != 0) {\n            this.killTween();\n            this.$isDragging = true;\n        }\n        else\n            this.$isDragging = false;\n        const globalMouse = isMobile.any\n            ? this.$owner.globalToLocal(e.localX, e.localY)\n            : this.$owner.globalToLocal(Decls$1.GRoot.globalMouseStatus.mouseX, Decls$1.GRoot.globalMouseStatus.mouseY, ScrollPane.sHelperPoint);\n        this.$containerPos.setValues(this.$container.x, this.$container.y);\n        this.$beginTouchPos.copy(globalMouse);\n        this.$lastTouchPos.copy(globalMouse);\n        this.$lastTouchGlobalPos.copy(globalMouse);\n        this.$isHoldAreaDone = false;\n        this.$velocity.setValues(0, 0);\n        this.$velocityScale = 1;\n        this.$lastMoveTime = GTimer.inst.curTime / 1000;\n        this.$mouseMoveEvent = Decls$1.GRoot.inst.nativeStage.on(InteractiveEvents.Move, this.$mouseMove, this);\n        this.$mouseUpEvent = Decls$1.GRoot.inst.nativeStage.on(InteractiveEvents.Up, this.$mouseUp, this);\n        this.$clickEvent = Decls$1.GRoot.inst.nativeStage.on(InteractiveEvents.Click, this.$click, this);\n    }\n    $mouseMove() {\n        if (!this.$touchEffect)\n            return;\n        if ((ScrollPane.draggingPane != null && ScrollPane.draggingPane != this) ||\n            GObject.draggingObject != null)\n            return;\n        let sensitivity = UIConfig.touchScrollSensitivity;\n        const globalMouse = this.$owner.globalToLocal(Decls$1.GRoot.globalMouseStatus.mouseX, Decls$1.GRoot.globalMouseStatus.mouseY, ScrollPane.sHelperPoint);\n        let diff, diff2;\n        let sv, sh;\n        if (this.$scrollType == 1 /* Vertical */) {\n            if (!this.$isHoldAreaDone) {\n                //gesture on vertical dir is being observed\n                ScrollPane.$gestureFlag |= 1;\n                diff = Math.abs(this.$beginTouchPos.y - globalMouse.y);\n                if (diff < sensitivity)\n                    return;\n                if ((ScrollPane.$gestureFlag & 2) != 0) {\n                    diff2 = Math.abs(this.$beginTouchPos.x - globalMouse.x);\n                    if (diff < diff2)\n                        return;\n                }\n            }\n            sv = true;\n        }\n        else if (this.$scrollType == 0 /* Horizontal */) {\n            if (!this.$isHoldAreaDone) {\n                ScrollPane.$gestureFlag |= 2; //gesture on horz dir is being observed\n                diff = Math.abs(this.$beginTouchPos.x - globalMouse.x);\n                if (diff < sensitivity)\n                    return;\n                if ((ScrollPane.$gestureFlag & 1) != 0) {\n                    diff2 = Math.abs(this.$beginTouchPos.y - globalMouse.y);\n                    if (diff < diff2)\n                        return;\n                }\n            }\n            sh = true;\n        }\n        else {\n            ScrollPane.$gestureFlag = 3; //both\n            if (!this.$isHoldAreaDone) {\n                diff = Math.abs(this.$beginTouchPos.y - globalMouse.y);\n                if (diff < sensitivity) {\n                    diff = Math.abs(this.$beginTouchPos.x - globalMouse.x);\n                    if (diff < sensitivity)\n                        return;\n                }\n            }\n            sv = sh = true;\n        }\n        let newPosX = Math.floor(this.$containerPos.x + globalMouse.x - this.$beginTouchPos.x);\n        let newPosY = Math.floor(this.$containerPos.y + globalMouse.y - this.$beginTouchPos.y);\n        if (sv) {\n            if (newPosY > 0) {\n                if (!this.$bouncebackEffect)\n                    this.$container.y = 0;\n                else if (this.$header != null && this.$header.height != 0)\n                    //TODO: height -> maxHeight\n                    this.$container.y = Math.floor(Math.min(newPosY * 0.5, this.$header.height));\n                else\n                    this.$container.y = Math.floor(Math.min(newPosY * 0.5, this.$viewSize.y * ScrollPane.PULL_DIST_RATIO));\n            }\n            else if (newPosY < -this.$overlapSize.y) {\n                if (!this.$bouncebackEffect)\n                    this.$container.y = -this.$overlapSize.y;\n                else if (this.$footer != null && this.$footer.height > 0)\n                    //TODO: height -> maxHeight\n                    this.$container.y = Math.floor(Math.max((newPosY + this.$overlapSize.y) * 0.5, -this.$footer.height) -\n                        this.$overlapSize.y);\n                else\n                    this.$container.y = Math.floor(Math.max((newPosY + this.$overlapSize.y) * 0.5, -this.$viewSize.y * ScrollPane.PULL_DIST_RATIO) - this.$overlapSize.y);\n            }\n            else\n                this.$container.y = newPosY;\n        }\n        if (sh) {\n            if (newPosX > 0) {\n                if (!this.$bouncebackEffect)\n                    this.$container.x = 0;\n                else if (this.$header != null && this.$header.width != 0)\n                    //TODO: width -> maxWidth\n                    this.$container.x = Math.floor(Math.min(newPosX * 0.5, this.$header.width));\n                else\n                    this.$container.x = Math.floor(Math.min(newPosX * 0.5, this.$viewSize.x * ScrollPane.PULL_DIST_RATIO));\n            }\n            else if (newPosX < 0 - this.$overlapSize.x) {\n                if (!this.$bouncebackEffect)\n                    this.$container.x = -this.$overlapSize.x;\n                else if (this.$footer != null && this.$footer.width > 0)\n                    //TODO: width -> maxWidth\n                    this.$container.x = Math.floor(Math.max((newPosX + this.$overlapSize.x) * 0.5, -this.$footer.width) -\n                        this.$overlapSize.x);\n                else\n                    this.$container.x = Math.floor(Math.max((newPosX + this.$overlapSize.x) * 0.5, -this.$viewSize.x * ScrollPane.PULL_DIST_RATIO) - this.$overlapSize.x);\n            }\n            else\n                this.$container.x = newPosX;\n        }\n        //update acceleration\n        const frameRate = createjs.Ticker.framerate;\n        const now = GTimer.inst.curTime / 1000;\n        const deltaTime = Math.max(now - this.$lastMoveTime, 1 / frameRate);\n        let deltaPositionX = globalMouse.x - this.$lastTouchPos.x;\n        let deltaPositionY = globalMouse.y - this.$lastTouchPos.y;\n        if (!sh)\n            deltaPositionX = 0;\n        if (!sv)\n            deltaPositionY = 0;\n        if (deltaTime != 0) {\n            const elapsed = deltaTime * frameRate - 1;\n            if (elapsed > 1) {\n                const factor = Math.pow(0.833, elapsed);\n                this.$velocity.x = this.$velocity.x * factor;\n                this.$velocity.y = this.$velocity.y * factor;\n            }\n            this.$velocity.x = NumberUtil.lerp(this.$velocity.x, (deltaPositionX * 60) / frameRate / deltaTime, deltaTime * 10);\n            this.$velocity.y = NumberUtil.lerp(this.$velocity.y, (deltaPositionY * 60) / frameRate / deltaTime, deltaTime * 10);\n        }\n        //in the inertia scrolling we need the offset value to screen space, so here we need to reocrd the offset ratio\n        const deltaGlobalPositionX = this.$lastTouchGlobalPos.x - globalMouse.x;\n        const deltaGlobalPositionY = this.$lastTouchGlobalPos.y - globalMouse.y;\n        if (deltaPositionX != 0)\n            this.$velocityScale = Math.abs(deltaGlobalPositionX / deltaPositionX);\n        else if (deltaPositionY != 0)\n            this.$velocityScale = Math.abs(deltaGlobalPositionY / deltaPositionY);\n        this.$lastTouchPos.copy(globalMouse);\n        this.$lastTouchGlobalPos.copy(globalMouse);\n        this.$lastMoveTime = now;\n        //update position\n        if (this.$overlapSize.x > 0)\n            this.$xPos = NumberUtil.clamp(-this.$container.x, 0, this.$overlapSize.x);\n        if (this.$overlapSize.y > 0)\n            this.$yPos = NumberUtil.clamp(-this.$container.y, 0, this.$overlapSize.y);\n        if (this.$loop != 0) {\n            newPosX = this.$container.x;\n            newPosY = this.$container.y;\n            if (this.loopCheckingCurrent()) {\n                this.$containerPos.x += this.$container.x - newPosX;\n                this.$containerPos.y += this.$container.y - newPosY;\n            }\n        }\n        ScrollPane.draggingPane = this;\n        this.$isHoldAreaDone = true;\n        this.$isDragging = true;\n        // this.$maskContainer.interactive = false;\n        this.syncScrollBar();\n        this.checkRefreshBar();\n        if (this.$pageMode)\n            this.updatePageController();\n        let evt = new createjs.Event(\"__scroll\" /* SCROLL */, true, false);\n        this.dispatchEvent(evt, this);\n    }\n    $mouseUp() {\n        Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Move, this.$mouseMoveEvent);\n        Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Up, this.$mouseMoveEvent);\n        Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Click, this.$clickEvent);\n        if (ScrollPane.draggingPane == this)\n            ScrollPane.draggingPane = null;\n        ScrollPane.$gestureFlag = 0;\n        if (!this.$isDragging || !this.$touchEffect) {\n            this.$isDragging = false;\n            this.$maskContainer.mouseEnabled = true;\n            return;\n        }\n        this.$isDragging = false;\n        this.$maskContainer.mouseEnabled = true;\n        this.$tweenStart.setValues(this.$container.x, this.$container.y);\n        ScrollPane.sEndPos.setValues(this.$tweenStart.x, this.$tweenStart.y);\n        let flag = false;\n        if (this.$container.x > 0) {\n            ScrollPane.sEndPos.x = 0;\n            flag = true;\n        }\n        else if (this.$container.x < -this.$overlapSize.x) {\n            ScrollPane.sEndPos.x = -this.$overlapSize.x;\n            flag = true;\n        }\n        if (this.$container.y > 0) {\n            ScrollPane.sEndPos.y = 0;\n            flag = true;\n        }\n        else if (this.$container.y < -this.$overlapSize.y) {\n            ScrollPane.sEndPos.y = -this.$overlapSize.y;\n            flag = true;\n        }\n        if (flag) {\n            this.$tweenChange.setValues(ScrollPane.sEndPos.x - this.$tweenStart.x, ScrollPane.sEndPos.y - this.$tweenStart.y);\n            if (this.$tweenChange.x < -UIConfig.touchDragSensitivity ||\n                this.$tweenChange.y < -UIConfig.touchDragSensitivity) {\n                this.$refreshEventDispatching = true;\n                let evt = new createjs.Event(\"__pullDownRelease\" /* PULL_DOWN_RELEASE */, true, false);\n                this.dispatchEvent(evt, this);\n                this.$refreshEventDispatching = false;\n            }\n            else if (this.$tweenChange.x > UIConfig.touchDragSensitivity ||\n                this.$tweenChange.y > UIConfig.touchDragSensitivity) {\n                this.$refreshEventDispatching = true;\n                let evt = new createjs.Event(\"__pullUpRelease\" /* PULL_UP_RELEASE */, true, false);\n                this.dispatchEvent(evt, this);\n                this.$refreshEventDispatching = false;\n            }\n            if (this.$headerLockedSize > 0 &&\n                ScrollPane.sEndPos[this.$refreshBarAxis] == 0) {\n                ScrollPane.sEndPos[this.$refreshBarAxis] = this.$headerLockedSize;\n                this.$tweenChange.x = ScrollPane.sEndPos.x - this.$tweenStart.x;\n                this.$tweenChange.y = ScrollPane.sEndPos.y - this.$tweenStart.y;\n            }\n            else if (this.$footerLockedSize > 0 &&\n                ScrollPane.sEndPos[this.$refreshBarAxis] ==\n                    -this.$overlapSize[this.$refreshBarAxis]) {\n                var max = this.$overlapSize[this.$refreshBarAxis];\n                if (max == 0)\n                    max = Math.max(this.$contentSize[this.$refreshBarAxis] +\n                        this.$footerLockedSize -\n                        this.$viewSize[this.$refreshBarAxis], 0);\n                else\n                    max += this.$footerLockedSize;\n                ScrollPane.sEndPos[this.$refreshBarAxis] = -max;\n                this.$tweenChange.x = ScrollPane.sEndPos.x - this.$tweenStart.x;\n                this.$tweenChange.y = ScrollPane.sEndPos.y - this.$tweenStart.y;\n            }\n            this.$tweenDuration.setValues(ScrollPane.TWEEN_DEFAULT_DURATION, ScrollPane.TWEEN_DEFAULT_DURATION);\n        }\n        else {\n            if (!this.$inertiaDisabled) {\n                const frameRate = createjs.Ticker.framerate;\n                const elapsed = (GTimer.inst.curTime / 1000 - this.$lastMoveTime) * frameRate - 1;\n                if (elapsed > 1) {\n                    const factor = Math.pow(0.833, elapsed);\n                    this.$velocity.x = this.$velocity.x * factor;\n                    this.$velocity.y = this.$velocity.y * factor;\n                }\n                //calc dist & duration by speed\n                this.updateTargetAndDuration(this.$tweenStart, ScrollPane.sEndPos);\n            }\n            else\n                this.$tweenDuration.setValues(ScrollPane.TWEEN_DEFAULT_DURATION, ScrollPane.TWEEN_DEFAULT_DURATION);\n            ScrollPane.sOldChange.setValues(ScrollPane.sEndPos.x - this.$tweenStart.x, ScrollPane.sEndPos.y - this.$tweenStart.y);\n            //adjust\n            this.loopCheckingTarget(ScrollPane.sEndPos);\n            if (this.$pageMode || this.$snapToItem)\n                this.alignPosition(ScrollPane.sEndPos, true);\n            this.$tweenChange.x = ScrollPane.sEndPos.x - this.$tweenStart.x;\n            this.$tweenChange.y = ScrollPane.sEndPos.y - this.$tweenStart.y;\n            if (this.$tweenChange.x == 0 && this.$tweenChange.y == 0) {\n                if (this.$scrollBarDisplayAuto)\n                    this.showScrollBar(false);\n                return;\n            }\n            if (this.$pageMode || this.$snapToItem) {\n                this.fixDuration('x', ScrollPane.sOldChange.x);\n                this.fixDuration('y', ScrollPane.sOldChange.y);\n            }\n        }\n        this.$tweening = 2;\n        this.$tweenTime.setValues(0, 0);\n        GTimer.inst.addLoop(1, this.tweenUpdate, this);\n    }\n    $click() {\n        this.$isDragging = false;\n    }\n    $mouseWheel(evt) {\n        let event = evt.data.event;\n        if (!this.$mouseWheelEnabled)\n            return;\n        const delta = event.delta > 0 ? -1 : event.delta < 0 ? 1 : 0;\n        if (this.$overlapSize.x > 0 && this.$overlapSize.y == 0) {\n            if (this.$pageMode)\n                this.setPosX(this.$xPos + this.$pageSize.x * delta, false);\n            else\n                this.setPosX(this.$xPos + this.$mouseWheelSpeed * delta, false);\n        }\n        else {\n            if (this.$pageMode)\n                this.setPosY(this.$yPos + this.$pageSize.y * delta, false);\n            else\n                this.setPosY(this.$yPos + this.$mouseWheelSpeed * delta, false);\n        }\n    }\n    $rollOver() {\n        this.showScrollBar(true);\n    }\n    $rollOut() {\n        this.showScrollBar(false);\n    }\n    showScrollBar(visible) {\n        if (visible) {\n            GTimer.inst.remove(this.setScrollBarVisible, this);\n            this.setScrollBarVisible(true);\n        }\n        else\n            GTimer.inst.add(500, 1, this.setScrollBarVisible, this, visible);\n    }\n    setScrollBarVisible(visible) {\n        this.$scrollBarVisible = visible && this.$viewSize.x > 0 && this.$viewSize.y > 0;\n        if (this.$vtScrollBar)\n            this.$vtScrollBar.displayObject.visible = this.$scrollBarVisible && !this.$vScrollNone;\n        if (this.$hzScrollBar)\n            this.$hzScrollBar.displayObject.visible = this.$scrollBarVisible && !this.$hScrollNone;\n    }\n    getLoopPartSize(division, axis) {\n        let pad = 0;\n        // if (this.$owner instanceof GList)\n        //     pad = axis == \"x\" ? this.$owner.columnGap : this.$owner.lineGap;\n        return (this.$contentSize[axis] + pad) / division;\n    }\n    loopCheckingCurrent() {\n        let changed = false;\n        if (this.$loop == 1 && this.$overlapSize.x > 0) {\n            if (this.$xPos < 0.001) {\n                this.$xPos += this.getLoopPartSize(2, 'x');\n                changed = true;\n            }\n            else if (this.$xPos >= this.$overlapSize.x) {\n                this.$xPos -= this.getLoopPartSize(2, 'x');\n                changed = true;\n            }\n        }\n        else if (this.$loop == 2 && this.$overlapSize.y > 0) {\n            if (this.$yPos < 0.001) {\n                this.$yPos += this.getLoopPartSize(2, 'y');\n                changed = true;\n            }\n            else if (this.$yPos >= this.$overlapSize.y) {\n                this.$yPos -= this.getLoopPartSize(2, 'y');\n                changed = true;\n            }\n        }\n        if (changed)\n            this.$container.set({ x: Math.floor(-this.$xPos), y: Math.floor(-this.$yPos) });\n        return changed;\n    }\n    loopCheckingTarget(endPos) {\n        if (this.$loop == 1)\n            this.loopCheckingTarget2(endPos, 'x');\n        if (this.$loop == 2)\n            this.loopCheckingTarget2(endPos, 'y');\n    }\n    loopCheckingTarget2(endPos, axis) {\n        let halfSize;\n        let tmp;\n        if (endPos[axis] > 0) {\n            halfSize = this.getLoopPartSize(2, axis);\n            tmp = this.$tweenStart[axis] - halfSize;\n            if (tmp <= 0 && tmp >= -this.$overlapSize[axis]) {\n                endPos[axis] -= halfSize;\n                this.$tweenStart[axis] = tmp;\n            }\n        }\n        else if (endPos[axis] < -this.$overlapSize[axis]) {\n            halfSize = this.getLoopPartSize(2, axis);\n            tmp = this.$tweenStart[axis] + halfSize;\n            if (tmp <= 0 && tmp >= -this.$overlapSize[axis]) {\n                endPos[axis] += halfSize;\n                this.$tweenStart[axis] = tmp;\n            }\n        }\n    }\n    loopCheckingNewPos(value, axis) {\n        if (this.$overlapSize[axis] == 0)\n            return value;\n        let pos = axis == 'x' ? this.$xPos : this.$yPos;\n        let changed = false;\n        let v;\n        if (value < 0.001) {\n            value += this.getLoopPartSize(2, axis);\n            if (value > pos) {\n                v = this.getLoopPartSize(6, axis);\n                v = Math.ceil((value - pos) / v) * v;\n                pos = NumberUtil.clamp(pos + v, 0, this.$overlapSize[axis]);\n                changed = true;\n            }\n        }\n        else if (value >= this.$overlapSize[axis]) {\n            value -= this.getLoopPartSize(2, axis);\n            if (value < pos) {\n                v = this.getLoopPartSize(6, axis);\n                v = Math.ceil((pos - value) / v) * v;\n                pos = NumberUtil.clamp(pos - v, 0, this.$overlapSize[axis]);\n                changed = true;\n            }\n        }\n        if (changed) {\n            if (axis == 'x')\n                this.$container.x = -Math.floor(pos);\n            else\n                this.$container.y = -Math.floor(pos);\n        }\n        return value;\n    }\n    alignPosition(pos, inertialScrolling) {\n        if (this.$pageMode) {\n            pos.x = this.alignByPage(pos.x, 'x', inertialScrolling);\n            pos.y = this.alignByPage(pos.y, 'y', inertialScrolling);\n        }\n        else if (this.$snapToItem) {\n            var pt = this.$owner.getSnappingPosition(-pos.x, -pos.y, ScrollPane.sHelperPoint);\n            if (pos.x < 0 && pos.x > -this.$overlapSize.x)\n                pos.x = -pt.x;\n            if (pos.y < 0 && pos.y > -this.$overlapSize.y)\n                pos.y = -pt.y;\n        }\n    }\n    alignByPage(pos, axis, inertialScrolling) {\n        let page;\n        if (pos > 0)\n            page = 0;\n        else if (pos < -this.$overlapSize[axis])\n            page =\n                Math.ceil(this.$contentSize[axis] / this.$pageSize[axis]) - 1;\n        else {\n            page = Math.floor(-pos / this.$pageSize[axis]);\n            var change = inertialScrolling\n                ? pos - this.$containerPos[axis]\n                : pos - this.$container[axis];\n            var testPageSize = Math.min(this.$pageSize[axis], this.$contentSize[axis] -\n                (page + 1) * this.$pageSize[axis]);\n            var delta = -pos - page * this.$pageSize[axis];\n            //page mode magnetic\n            if (Math.abs(change) > this.$pageSize[axis]) {\n                if (delta > testPageSize * 0.5)\n                    page++;\n            }\n            else {\n                if (delta > testPageSize * (change < 0 ? 0.3 : 0.7))\n                    page++;\n            }\n            //re-calc dist\n            const dst = this.$pageSize[axis];\n            pos = -page * dst;\n            if (pos < -dst)\n                pos = -dst;\n        }\n        if (inertialScrolling) {\n            var oldPos = this.$tweenStart[axis];\n            var oldPage;\n            if (oldPos > 0)\n                oldPage = 0;\n            else if (oldPos < -this.$overlapSize[axis])\n                oldPage =\n                    Math.ceil(this.$contentSize[axis] / this.$pageSize[axis]) - 1;\n            else\n                oldPage = Math.floor(-oldPos / this.$pageSize[axis]);\n            var startPage = Math.floor(-this.$containerPos[axis] / this.$pageSize[axis]);\n            if (Math.abs(page - startPage) > 1 && Math.abs(oldPage - startPage) <= 1) {\n                if (page > startPage)\n                    page = startPage + 1;\n                else\n                    page = startPage - 1;\n                pos = -page * this.$pageSize[axis];\n            }\n        }\n        return pos;\n    }\n    updateTargetAndDuration(orignPos, resultPos) {\n        resultPos.x = this.updateTargetAndDuration2(orignPos.x, 'x');\n        resultPos.y = this.updateTargetAndDuration2(orignPos.y, 'y');\n    }\n    updateTargetAndDuration2(pos, axis) {\n        let v = this.$velocity[axis];\n        var duration = 0;\n        if (pos > 0)\n            pos = 0;\n        else if (pos < -this.$overlapSize[axis])\n            pos = -this.$overlapSize[axis];\n        else {\n            let v2 = Math.abs(v) * this.$velocityScale;\n            if (isMobile.any)\n                v2 *=\n                    Math.max(Decls$1.GRoot.inst.stageWrapper.designWidth, Decls$1.GRoot.inst.stageWrapper.designHeight) / Math.max(Decls$1.GRoot.inst.stageWidth, Decls$1.GRoot.inst.stageHeight);\n            //threshold, if too slow, stop it\n            let ratio = 0;\n            if (this.$pageMode || !isMobile.any) {\n                if (v2 > 500)\n                    ratio = Math.pow((v2 - 500) / 500, 2);\n            }\n            else {\n                if (v2 > 1000)\n                    ratio = Math.pow((v2 - 1000) / 1000, 2);\n            }\n            if (ratio != 0) {\n                if (ratio > 1)\n                    ratio = 1;\n                v2 *= ratio;\n                v *= ratio;\n                this.$velocity[axis] = v;\n                duration = Math.log(60 / v2) / Math.log(this.$decelerationRate) / 60;\n                const change = (v / 60 - 1) / (1 - this.$decelerationRate);\n                //const change: number = Math.floor(v * duration * 0.4);\n                pos += change;\n            }\n        }\n        if (duration < ScrollPane.TWEEN_DEFAULT_DURATION)\n            duration = ScrollPane.TWEEN_DEFAULT_DURATION;\n        this.$tweenDuration[axis] = duration;\n        return pos;\n    }\n    fixDuration(axis, oldChange) {\n        if (this.$tweenChange[axis] == 0 ||\n            Math.abs(this.$tweenChange[axis]) >= Math.abs(oldChange))\n            return;\n        let newDuration = Math.abs(this.$tweenChange[axis] / oldChange) *\n            this.$tweenDuration[axis];\n        if (newDuration < ScrollPane.TWEEN_DEFAULT_DURATION)\n            newDuration = ScrollPane.TWEEN_DEFAULT_DURATION;\n        this.$tweenDuration[axis] = newDuration;\n    }\n    killTween() {\n        //tweening == 1: set to end immediately\n        if (this.$tweening == 1) {\n            this.$container.set({\n                x: this.$tweenStart.x + this.$tweenChange.x,\n                y: this.$tweenStart.y + this.$tweenChange.y\n            });\n            let evt = new createjs.Event(\"__scroll\" /* SCROLL */, true, false);\n            this.dispatchEvent(evt, this);\n        }\n        this.$tweening = 0;\n        GTimer.inst.remove(this.tweenUpdate, this);\n        let evt = new createjs.Event(\"__scrollEnd\" /* SCROLL_END */, true, false);\n        this.dispatchEvent(evt, this);\n    }\n    checkRefreshBar() {\n        if (this.$header == null && this.$footer == null)\n            return;\n        const pos = this.$container[this.$refreshBarAxis];\n        if (this.$header != null) {\n            if (pos > 0) {\n                if (this.$header.displayObject.parent == null)\n                    this.$maskContainer.addChildAt(this.$header.displayObject, 0);\n                const pt = ScrollPane.sHelperPoint;\n                pt.setValues(this.$header.width, this.$header.height);\n                pt[this.$refreshBarAxis] = pos;\n                this.$header.setSize(pt.x, pt.y);\n            }\n            else {\n                if (this.$header.displayObject.parent != null)\n                    this.$maskContainer.removeChild(this.$header.displayObject);\n            }\n        }\n        if (this.$footer != null) {\n            var max = this.$overlapSize[this.$refreshBarAxis];\n            if (pos < -max || (max == 0 && this.$footerLockedSize > 0)) {\n                if (this.$footer.displayObject.parent == null)\n                    this.$maskContainer.addChildAt(this.$footer.displayObject, 0);\n                const pt = ScrollPane.sHelperPoint;\n                pt.setValues(this.$footer.x, this.$footer.y);\n                if (max > 0)\n                    pt[this.$refreshBarAxis] =\n                        pos + this.$contentSize[this.$refreshBarAxis];\n                else\n                    pt[this.$refreshBarAxis] = Math.max(Math.min(pos + this.$viewSize[this.$refreshBarAxis], this.$viewSize[this.$refreshBarAxis] - this.$footerLockedSize), this.$viewSize[this.$refreshBarAxis] -\n                        this.$contentSize[this.$refreshBarAxis]);\n                this.$footer.setXY(pt.x, pt.y);\n                pt.setValues(this.$footer.width, this.$footer.height);\n                if (max > 0)\n                    pt[this.$refreshBarAxis] = -max - pos;\n                else\n                    pt[this.$refreshBarAxis] =\n                        this.$viewSize[this.$refreshBarAxis] -\n                            this.$footer[this.$refreshBarAxis];\n                this.$footer.setSize(pt.x, pt.y);\n            }\n            else {\n                if (this.$footer.displayObject.parent != null)\n                    this.$maskContainer.removeChild(this.$footer.displayObject);\n            }\n        }\n    }\n    tweenUpdate() {\n        var nx = this.runTween('x');\n        var ny = this.runTween('y');\n        this.$container.set({ x: nx, y: ny });\n        if (this.$tweening == 2) {\n            if (this.$overlapSize.x > 0)\n                this.$xPos = NumberUtil.clamp(-nx, 0, this.$overlapSize.x);\n            if (this.$overlapSize.y > 0)\n                this.$yPos = NumberUtil.clamp(-ny, 0, this.$overlapSize.y);\n            if (this.$pageMode)\n                this.updatePageController();\n        }\n        if (this.$tweenChange.x == 0 && this.$tweenChange.y == 0) {\n            this.$tweening = 0;\n            GTimer.inst.remove(this.tweenUpdate, this);\n            this.loopCheckingCurrent();\n            this.syncScrollBar(true);\n            this.checkRefreshBar();\n            let scrollEvent = new createjs.Event(\"__scroll\" /* SCROLL */, true, false);\n            this.dispatchEvent(scrollEvent, this);\n            let scrollEndEvent = new createjs.Event(\"__scrollEnd\" /* SCROLL_END */, true, false);\n            this.dispatchEvent(scrollEndEvent, this);\n        }\n        else {\n            this.syncScrollBar(false);\n            this.checkRefreshBar();\n            let scrollEvent = new createjs.Event(\"__scroll\" /* SCROLL */, true, false);\n            this.dispatchEvent(scrollEvent, this);\n        }\n    }\n    runTween(axis) {\n        const delta = createjs.Ticker.interval;\n        let newValue;\n        if (this.$tweenChange[axis] != 0) {\n            this.$tweenTime[axis] += delta * createjs.Ticker.framerate;\n            if (this.$tweenTime[axis] >= this.$tweenDuration[axis]) {\n                newValue =\n                    this.$tweenStart[axis] + this.$tweenChange[axis];\n                this.$tweenChange[axis] = 0;\n            }\n            else {\n                const ratio = ScrollPane.$easeTypeFunc(this.$tweenTime[axis], this.$tweenDuration[axis]);\n                newValue =\n                    this.$tweenStart[axis] +\n                        Math.floor(this.$tweenChange[axis] * ratio);\n            }\n            var threshold1 = 0;\n            var threshold2 = -this.$overlapSize[axis];\n            if (this.$headerLockedSize > 0 && this.$refreshBarAxis == axis)\n                threshold1 = this.$headerLockedSize;\n            if (this.$footerLockedSize > 0 && this.$refreshBarAxis == axis) {\n                var max = this.$overlapSize[this.$refreshBarAxis];\n                if (max == 0)\n                    max = Math.max(this.$contentSize[this.$refreshBarAxis] +\n                        this.$footerLockedSize -\n                        this.$viewSize[this.$refreshBarAxis], 0);\n                else\n                    max += this.$footerLockedSize;\n                threshold2 = -max;\n            }\n            if (this.$tweening == 2 && this.$bouncebackEffect) {\n                if ((newValue > 20 + threshold1 && this.$tweenChange[axis] > 0) ||\n                    (newValue > threshold1 && this.$tweenChange[axis] == 0)) {\n                    this.$tweenTime[axis] = 0;\n                    this.$tweenDuration[axis] = ScrollPane.TWEEN_DEFAULT_DURATION;\n                    this.$tweenChange[axis] = -newValue + threshold1;\n                    this.$tweenStart[axis] = newValue;\n                }\n                else if ((newValue < threshold2 - 20 && this.$tweenChange[axis] < 0) ||\n                    (newValue < threshold2 && this.$tweenChange[axis] == 0)) {\n                    this.$tweenTime[axis] = 0;\n                    this.$tweenDuration[axis] = ScrollPane.TWEEN_DEFAULT_DURATION;\n                    this.$tweenChange[axis] = threshold2 - newValue;\n                    this.$tweenStart[axis] = newValue;\n                }\n            }\n            else {\n                if (newValue > threshold1) {\n                    newValue = threshold1;\n                    this.$tweenChange[axis] = 0;\n                }\n                else if (newValue < threshold2) {\n                    newValue = threshold2;\n                    this.$tweenChange[axis] = 0;\n                }\n            }\n        }\n        else\n            newValue = this.$container[axis];\n        return newValue;\n    }\n}\nScrollPane.$easeTypeFunc = (t, d) => {\n    return (t = t / d - 1) * t * t + 1;\n}; //cubic out\nScrollPane.$gestureFlag = 0;\nScrollPane.sHelperPoint = new createjs.Point();\nScrollPane.sHelperRect = new createjs.Rectangle();\nScrollPane.sEndPos = new createjs.Point();\nScrollPane.sOldChange = new createjs.Point();\nScrollPane.TWEEN_DEFAULT_DURATION = 0.4;\nScrollPane.TWEEN_MANUALLY_SET_DURATION = 0.5; //tween duration used when call setPos(useAni=true)\nScrollPane.PULL_DIST_RATIO = 0.5; //pulldown / pullup distance ratio of the whole viewport\n\nclass Binder {\n    static create(func, context, ...args) {\n        if (!context)\n            return func;\n        return (function () {\n            let fullargs = arguments.length > 0 ? [].concat(Array.prototype.slice.call(arguments)).concat(args) : [].concat(args);\n            func.apply(context, fullargs);\n        });\n    }\n}\n\nclass Transition {\n    constructor(owner) {\n        this.autoPlayRepeat = 1;\n        this.autoPlayDelay = 0;\n        this.$ownerBaseX = 0;\n        this.$ownerBaseY = 0;\n        this.$totalTimes = 0;\n        this.$startTime = 0;\n        this.$totalTasks = 0;\n        this.$playing = false;\n        this.$options = 0;\n        this.$maxTime = 0;\n        this.$owner = owner;\n        this.$items = [];\n        this.$owner.on(\"__visibleChanged\" /* VISIBLE_CHANGED */, this.$ownerVisibleChanged, this);\n    }\n    // private $ownerVisibleChanged(vis: boolean, owner: GComponent): void {\n    $ownerVisibleChanged(event) {\n        let vis = event.data;\n        if ((this.$options & Transition.OPTION_AUTO_STOP_DISABLED) == 0 && vis === false)\n            this.stop((this.$options & Transition.OPTION_AUTO_STOP_AT_END) != 0 ? true : false, false);\n    }\n    get autoPlay() {\n        return this.$autoPlay;\n    }\n    set autoPlay(value) {\n        if (this.$autoPlay != value) {\n            this.$autoPlay = value;\n            if (this.$autoPlay) {\n                if (this.$owner.onStage)\n                    this.play({\n                        times: this.autoPlayRepeat,\n                        delay: this.autoPlayDelay\n                    });\n            }\n            else {\n                if (!this.$owner.onStage)\n                    this.stop(false, true);\n            }\n        }\n    }\n    changeRepeat(value) {\n        this.$totalTimes = value | 0;\n    }\n    /**\n       * Play transition by specified settings:\n       * 1) pass whole parameters:\n              onComplete?: (...args:any[]) => void,\n              onCompleteObj?: any,\n              onCompleteParam?: any,\n              times: number,\n              delay: number\n       * 2) just pass 1 object which implements TransitionPlaySetting (recommended)\n       */\n    play(...args) {\n        if (args.length && typeof args[0] == 'object') {\n            let obj = args[0];\n            this.$play(obj.onComplete, obj.onCompleteObj, obj.onCompleteParam, obj.times || 1, obj.delay || 0, false);\n        }\n        else\n            this.$play(args[0], args[1], args[2], args[3] || 1, args[4] || 0, false);\n    }\n    /**\n       * Play transition by specified settings:\n       * 1) pass whole parameters:\n              onComplete?: (...args:any[]) => void,\n              onCompleteObj?: any,\n              onCompleteParam?: any,\n              times: number,\n              delay: number\n       * 2) just pass 1 object which implements TransitionPlaySetting (recommended)\n       */\n    playReverse(...args) {\n        if (args.length && typeof args[0] == 'object') {\n            let obj = args[0];\n            this.$play(obj.onComplete, obj.onCompleteObj, obj.onCompleteParam, obj.times || 1, obj.delay || 0, true);\n        }\n        else\n            this.$play(args[0], args[1], args[2], args[3] || 1, args[4] || 0, true);\n    }\n    $play(onComplete, onCompleteObj, onCompleteParam, times, delay, reversed = false) {\n        this.stop();\n        if (times == 0)\n            times = 1;\n        else if (times == -1)\n            times = Number.MAX_VALUE;\n        this.$totalTimes = times;\n        this.$startTime = 0;\n        this.$reversed = reversed;\n        this.internalPlay(delay);\n        this.$playing = this.$totalTasks > 0;\n        if (this.$playing) {\n            this.$onComplete = onComplete;\n            this.$onCompleteParam = onCompleteParam;\n            this.$onCompleteObj = onCompleteObj;\n            if ((this.$options & Transition.OPTION_IGNORE_DISPLAY_CONTROLLER) != 0) {\n                this.$items.forEach(item => {\n                    if (item.target != null && item.target != this.$owner)\n                        item.lockToken = item.target.lockGearDisplay();\n                }, this);\n            }\n        }\n        else if (onComplete != null) {\n            onCompleteParam && onCompleteParam.length\n                ? onComplete.apply(onCompleteObj, onCompleteParam)\n                : onComplete.call(onCompleteObj, onCompleteParam);\n        }\n    }\n    stop(setToComplete = true, processCallback = false) {\n        if (this.$playing) {\n            this.$playing = false;\n            this.$totalTasks = 0;\n            this.$totalTimes = 0;\n            let func = this.$onComplete;\n            let param = this.$onCompleteParam;\n            let thisObj = this.$onCompleteObj;\n            this.$onComplete = null;\n            this.$onCompleteParam = null;\n            this.$onCompleteObj = null;\n            let cnt = this.$items.length;\n            let item;\n            if (this.$reversed) {\n                for (let i = cnt - 1; i >= 0; i--) {\n                    item = this.$items[i];\n                    if (item.target == null)\n                        continue;\n                    this.stopItem(item, setToComplete);\n                }\n            }\n            else {\n                for (let i = 0; i < cnt; i++) {\n                    item = this.$items[i];\n                    if (item.target == null)\n                        continue;\n                    this.stopItem(item, setToComplete);\n                }\n            }\n            if (processCallback && func != null)\n                param && param.length > 0 ? func.apply(thisObj, param) : func.call(thisObj, param);\n        }\n    }\n    stopItem(item, setToComplete) {\n        if (item.lockToken != 0) {\n            item.target.releaseGearDisplay(item.lockToken);\n            item.lockToken = 0;\n        }\n        if (item.type == 12 /* ColorFilter */ && item.filterCreated)\n            item.target.filters = null;\n        if (item.completed)\n            return;\n        this.disposeTween(item);\n        if (item.type == 10 /* Transition */) {\n            let trans = item.target.getTransition(item.value.s);\n            if (trans != null)\n                trans.stop(setToComplete, false);\n        }\n        else if (item.type == 11 /* Shake */) {\n            GTimer.inst.remove(item.$shake, item);\n            item.target.$gearLocked = true;\n            item.target.setXY(item.target.x - item.startValue.f1, item.target.y - item.startValue.f2);\n            item.target.$gearLocked = false;\n        }\n        else {\n            if (setToComplete) {\n                if (item.tween) {\n                    if (!item.yoyo || item.repeat % 2 == 0)\n                        this.applyValue(item, this.$reversed ? item.startValue : item.endValue);\n                    else\n                        this.applyValue(item, this.$reversed ? item.endValue : item.startValue);\n                }\n                else if (item.type != 9 /* Sound */)\n                    this.applyValue(item, item.value);\n            }\n        }\n    }\n    dispose() {\n        GTimer.inst.remove(this.internalPlay, this);\n        this.$owner.off(\"__visibleChanged\" /* VISIBLE_CHANGED */, this.$ownerVisibleChanged);\n        this.$playing = false;\n        this.$items.forEach(item => {\n            if (item.target == null || item.completed)\n                return;\n            this.disposeTween(item);\n            if (item.type == 10 /* Transition */) {\n                let trans = item.target.getTransition(item.value.s);\n                if (trans != null)\n                    trans.dispose();\n            }\n            else if (item.type == 11 /* Shake */)\n                GTimer.inst.remove(item.$shake, item);\n        }, this);\n    }\n    get playing() {\n        return this.$playing;\n    }\n    setValue(label, ...args) {\n        this.$items.forEach(item => {\n            if (item.label == null && item.label2 == null)\n                return;\n            let value;\n            if (item.label == label) {\n                if (item.tween)\n                    value = item.startValue;\n                else\n                    value = item.value;\n            }\n            else if (item.label2 == label)\n                value = item.endValue;\n            else\n                return;\n            switch (item.type) {\n                case 0 /* XY */:\n                case 1 /* Size */:\n                case 3 /* Pivot */:\n                case 2 /* Scale */:\n                case 13 /* Skew */:\n                    value.b1 = true;\n                    value.b2 = true;\n                    value.f1 = parseFloat(args[0]);\n                    value.f2 = parseFloat(args[1]);\n                    break;\n                case 4 /* Alpha */:\n                    value.f1 = parseFloat(args[0]);\n                    break;\n                case 5 /* Rotation */:\n                    value.i = parseInt(args[0]);\n                    break;\n                case 6 /* Color */:\n                    value.c = args[0];\n                    break;\n                case 7 /* Animation */:\n                    value.i = parseInt(args[0]);\n                    if (args.length > 1)\n                        value.b = args[1];\n                    break;\n                case 8 /* Visible */:\n                    value.b = args[0];\n                    break;\n                case 9 /* Sound */:\n                    value.s = args[0];\n                    if (args.length > 1)\n                        value.f1 = parseFloat(args[1]);\n                    break;\n                case 10 /* Transition */:\n                    value.s = args[0];\n                    if (args.length > 1)\n                        value.i = parseInt(args[1]);\n                    break;\n                case 11 /* Shake */:\n                    value.f1 = parseFloat(args[0]);\n                    if (args.length > 1)\n                        value.f2 = parseFloat(args[1]);\n                    break;\n                case 12 /* ColorFilter */:\n                    value.f1 = parseFloat(args[0]);\n                    value.f2 = parseFloat(args[1]);\n                    value.f3 = parseFloat(args[2]);\n                    value.f4 = parseFloat(args[3]);\n                    break;\n            }\n        }, this);\n    }\n    setHook(label, callback, thisObj) {\n        let cnt = this.$items.length;\n        for (let i = 0; i < cnt; i++) {\n            let item = this.$items[i];\n            if (item.label == label) {\n                item.hook = callback;\n                item.hookObj = thisObj;\n                break;\n            }\n            else if (item.label2 == label) {\n                item.hook2 = callback;\n                item.hook2Obj = thisObj;\n                break;\n            }\n        }\n    }\n    clearHooks() {\n        this.$items.forEach(item => {\n            item.hook = null;\n            item.hookObj = null;\n            item.hook2 = null;\n            item.hook2Obj = null;\n        }, this);\n    }\n    setTarget(label, newTarget) {\n        this.$items.forEach(item => {\n            if (item.label == label)\n                item.targetId = newTarget.id;\n        }, this);\n    }\n    setDuration(label, value) {\n        this.$items.forEach(item => {\n            if (item.tween && item.label == label)\n                item.duration = value;\n        }, this);\n    }\n    updateFromRelations(targetId, dx, dy) {\n        this.$items.forEach(item => {\n            if (item.type == 0 /* XY */ && item.targetId == targetId) {\n                if (item.tween) {\n                    item.startValue.f1 += dx;\n                    item.startValue.f2 += dy;\n                    item.endValue.f1 += dx;\n                    item.endValue.f2 += dy;\n                }\n                else {\n                    item.value.f1 += dx;\n                    item.value.f2 += dy;\n                }\n            }\n        }, this);\n    }\n    internalPlay(delay = 0) {\n        this.$ownerBaseX = this.$owner.x;\n        this.$ownerBaseY = this.$owner.y;\n        this.$totalTasks = 0;\n        this.$items.forEach(item => {\n            if (item.targetId)\n                item.target = this.$owner.getChildById(item.targetId);\n            else\n                item.target = this.$owner;\n            if (item.target == null)\n                return;\n            let startTime;\n            this.disposeTween(item);\n            if (item.tween) {\n                if (this.$reversed)\n                    startTime = delay + this.$maxTime - item.time - item.duration;\n                else\n                    startTime = delay + item.time;\n                if (startTime > 0) {\n                    this.$totalTasks++;\n                    item.completed = false;\n                    item.tweener = createjs.Tween.get(item.value)\n                        .wait(startTime * 1000)\n                        .call(this.$delayCall, [item], this);\n                }\n                else\n                    this.startTween(item);\n            }\n            else {\n                if (this.$reversed)\n                    startTime = delay + this.$maxTime - item.time;\n                else\n                    startTime = delay + item.time;\n                if (startTime <= 0)\n                    this.applyValue(item, item.value);\n                else {\n                    this.$totalTasks++;\n                    item.completed = false;\n                    item.tweener = createjs.Tween.get(item.value)\n                        .wait(startTime * 1000)\n                        .call(this.$delayCall2, [item], this);\n                }\n            }\n        }, this);\n    }\n    prepareValue(item, toProps, reversed = false) {\n        let startValue;\n        let endValue;\n        if (reversed) {\n            startValue = item.endValue;\n            endValue = item.startValue;\n        }\n        else {\n            startValue = item.startValue;\n            endValue = item.endValue;\n        }\n        switch (item.type) {\n            case 0 /* XY */:\n            case 1 /* Size */:\n                if (item.type == 0 /* XY */) {\n                    if (item.target == this.$owner) {\n                        if (!startValue.b1)\n                            startValue.f1 = 0;\n                        if (!startValue.b2)\n                            startValue.f2 = 0;\n                    }\n                    else {\n                        if (!startValue.b1)\n                            startValue.f1 = item.target.x;\n                        if (!startValue.b2)\n                            startValue.f2 = item.target.y;\n                    }\n                }\n                else {\n                    if (!startValue.b1)\n                        startValue.f1 = item.target.width;\n                    if (!startValue.b2)\n                        startValue.f2 = item.target.height;\n                }\n                item.value.f1 = startValue.f1;\n                item.value.f2 = startValue.f2;\n                if (!endValue.b1)\n                    endValue.f1 = item.value.f1;\n                if (!endValue.b2)\n                    endValue.f2 = item.value.f2;\n                item.value.b1 = startValue.b1 || endValue.b1;\n                item.value.b2 = startValue.b2 || endValue.b2;\n                toProps.f1 = endValue.f1;\n                toProps.f2 = endValue.f2;\n                break;\n            case 2 /* Scale */:\n            case 13 /* Skew */:\n                item.value.f1 = startValue.f1;\n                item.value.f2 = startValue.f2;\n                toProps.f1 = endValue.f1;\n                toProps.f2 = endValue.f2;\n                break;\n            case 4 /* Alpha */:\n                item.value.f1 = startValue.f1;\n                toProps.f1 = endValue.f1;\n                break;\n            case 5 /* Rotation */:\n                item.value.i = startValue.i;\n                toProps.i = endValue.i;\n                break;\n            case 12 /* ColorFilter */:\n                item.value.f1 = startValue.f1;\n                item.value.f2 = startValue.f2;\n                item.value.f3 = startValue.f3;\n                item.value.f4 = startValue.f4;\n                toProps.f1 = endValue.f1;\n                toProps.f2 = endValue.f2;\n                toProps.f3 = endValue.f3;\n                toProps.f4 = endValue.f4;\n                break;\n        }\n    }\n    startTween(item) {\n        let toProps = new TransitionValue();\n        this.prepareValue(item, toProps, this.$reversed);\n        this.applyValue(item, item.value);\n        let completeHandler;\n        if (item.repeat != 0) {\n            item.tweenTimes = 0;\n            completeHandler = Binder.create(this.$tweenRepeatComplete, this, item);\n        }\n        else\n            completeHandler = Binder.create(this.$tweenComplete, this, item);\n        this.$totalTasks++;\n        item.completed = false;\n        this.prepareValue(item, toProps, this.$reversed);\n        item.tweener = createjs.Tween.get(item.value, {\n            onChange: Binder.create(this.$tweenUpdate, this, item)\n        })\n            .to(toProps, item.duration * 1000, item.easeType)\n            .call(completeHandler);\n        if (item.hook != null)\n            item.hook.call(item.hookObj);\n    }\n    $delayCall(item) {\n        this.disposeTween(item);\n        this.$totalTasks--;\n        this.startTween(item);\n    }\n    $delayCall2(item) {\n        this.disposeTween(item);\n        this.$totalTasks--;\n        item.completed = true;\n        this.applyValue(item, item.value);\n        if (item.hook != null)\n            item.hook.call(item.hookObj);\n        this.checkAllComplete();\n    }\n    $tweenUpdate(event, item) {\n        this.applyValue(item, item.value);\n    }\n    $tweenComplete(event, item) {\n        this.disposeTween(item);\n        this.$totalTasks--;\n        item.completed = true;\n        if (item.hook2 != null)\n            item.hook2.call(item.hook2Obj);\n        this.checkAllComplete();\n    }\n    $tweenRepeatComplete(event, item) {\n        item.tweenTimes++;\n        if (item.repeat == -1 || item.tweenTimes < item.repeat + 1) {\n            let toProps = new TransitionValue();\n            let reversed;\n            if (item.yoyo) {\n                if (this.$reversed)\n                    reversed = item.tweenTimes % 2 == 0;\n                else\n                    reversed = item.tweenTimes % 2 == 1;\n            }\n            else\n                reversed = this.$reversed;\n            this.prepareValue(item, toProps, reversed);\n            this.disposeTween(item);\n            item.tweener = createjs.Tween.get(item.value, {\n                onChange: Binder.create(this.$tweenUpdate, this, item)\n            })\n                .to(toProps, item.duration * 1000, item.easeType)\n                .call(this.$tweenRepeatComplete, [null, item], this);\n        }\n        else\n            this.$tweenComplete(null, item);\n    }\n    disposeTween(item) {\n        if (!item)\n            return;\n        if (item.tweener) {\n            item.tweener.paused = true;\n            item.tweener.removeAllEventListeners();\n            createjs.Tween.removeTweens(item.value);\n            item.tweener = null;\n        }\n    }\n    $playTransComplete(item) {\n        this.disposeTween(item);\n        this.$totalTasks--;\n        item.completed = true;\n        this.checkAllComplete();\n    }\n    checkAllComplete() {\n        if (this.$playing && this.$totalTasks == 0) {\n            if (this.$totalTimes < 0) {\n                //the reason we don't call 'internalPlay' immediately here is because of the onChange handler issue, the handler's been calling all the time even the tween is in waiting/complete status.\n                GTimer.inst.callLater(this.internalPlay, this, 0);\n            }\n            else {\n                this.$totalTimes--;\n                if (this.$totalTimes > 0)\n                    GTimer.inst.callLater(this.internalPlay, this, 0);\n                else {\n                    this.$playing = false;\n                    this.$items.forEach(item => {\n                        if (item.target != null) {\n                            if (item.lockToken != 0) {\n                                item.target.releaseGearDisplay(item.lockToken);\n                                item.lockToken = 0;\n                            }\n                            if (item.filterCreated) {\n                                item.filterCreated = false;\n                                item.target.filters = null;\n                            }\n                            this.disposeTween(item);\n                        }\n                    });\n                    if (this.$onComplete != null) {\n                        let func = this.$onComplete;\n                        let param = this.$onCompleteParam;\n                        let thisObj = this.$onCompleteObj;\n                        this.$onComplete = null;\n                        this.$onCompleteParam = null;\n                        this.$onCompleteObj = null;\n                        param && param.length ? func.apply(thisObj, param) : func.call(thisObj, param);\n                    }\n                }\n            }\n        }\n    }\n    applyValue(item, value) {\n        item.target.$gearLocked = true;\n        switch (item.type) {\n            case 0 /* XY */:\n                if (item.target == this.$owner) {\n                    let f1 = 0, f2 = 0;\n                    if (!value.b1)\n                        f1 = item.target.x;\n                    else\n                        f1 = value.f1 + this.$ownerBaseX;\n                    if (!value.b2)\n                        f2 = item.target.y;\n                    else\n                        f2 = value.f2 + this.$ownerBaseY;\n                    item.target.setXY(f1, f2);\n                }\n                else {\n                    if (!value.b1)\n                        value.f1 = item.target.x;\n                    if (!value.b2)\n                        value.f2 = item.target.y;\n                    item.target.setXY(value.f1, value.f2);\n                }\n                break;\n            case 1 /* Size */:\n                if (!value.b1)\n                    value.f1 = item.target.width;\n                if (!value.b2)\n                    value.f2 = item.target.height;\n                item.target.setSize(value.f1, value.f2);\n                break;\n            case 3 /* Pivot */:\n                item.target.setPivot(value.f1, value.f2);\n                break;\n            case 4 /* Alpha */:\n                item.target.alpha = value.f1;\n                break;\n            case 5 /* Rotation */:\n                item.target.rotation = value.i;\n                break;\n            case 2 /* Scale */:\n                item.target.setScale(value.f1, value.f2);\n                break;\n            case 13 /* Skew */:\n                item.target.setSkew(value.f1, value.f2);\n                break;\n            case 6 /* Color */:\n                if (isColorGear(item.target))\n                    item.target.color = value.c;\n                break;\n            case 7 /* Animation */:\n                if (isAnimationGear(item.target)) {\n                    if (!value.b1)\n                        value.i = item.target.frame;\n                    item.target.frame = value.i;\n                    item.target.playing = value.b;\n                }\n                break;\n            case 8 /* Visible */:\n                item.target.visible = value.b;\n                break;\n            case 10 /* Transition */:\n                let trans = item.target.getTransition(value.s);\n                if (trans != null) {\n                    if (value.i == 0)\n                        trans.stop(false, true);\n                    else if (trans.playing)\n                        trans.$totalTimes = value.i == -1 ? Number.MAX_VALUE : value.i;\n                    else {\n                        item.completed = false;\n                        this.$totalTasks++;\n                        if (this.$reversed)\n                            trans.playReverse(this.$playTransComplete, this, item, item.value.i);\n                        else\n                            trans.play(this.$playTransComplete, this, item, item.value.i);\n                    }\n                }\n                break;\n            case 9 /* Sound */:\n                if (this.$playing && item.time >= this.$startTime) {\n                    if (!value.audioClip) {\n                        var pi = UIPackage.getItemByURL(value.s);\n                        if (pi)\n                            value.audioClip = pi.owner.getItemAsset(pi);\n                    }\n                    if (value.audioClip) {\n                        Decls$1.GRoot.inst.playOneShotSound(value.audioClip, value.f1);\n                    }\n                }\n                break;\n            case 11 /* Shake */:\n                item.startValue.f1 = 0; //offsetX\n                item.startValue.f2 = 0; //offsetY\n                item.startValue.f3 = item.value.f2; //shakePeriod\n                GTimer.inst.add(1, 0, item.$shake, item, [this]);\n                this.$totalTasks++;\n                item.completed = false;\n                break;\n            case 12 /* ColorFilter */:\n                item.target.updateColorComponents(value.f1, value.f2, value.f3, value.f4);\n                break;\n        }\n        item.target.$gearLocked = false;\n    }\n    /**@internal */\n    $shakeItem(item, elapsedMS) {\n        let r = Math.ceil((item.value.f1 * item.startValue.f3) / item.value.f2);\n        let rx = (Math.random() * 2 - 1) * r;\n        let ry = (Math.random() * 2 - 1) * r;\n        rx = rx > 0 ? Math.ceil(rx) : Math.floor(rx);\n        ry = ry > 0 ? Math.ceil(ry) : Math.floor(ry);\n        item.target.$gearLocked = true;\n        item.target.setXY(item.target.x - item.startValue.f1 + rx, item.target.y - item.startValue.f2 + ry);\n        item.target.$gearLocked = false;\n        item.startValue.f1 = rx;\n        item.startValue.f2 = ry;\n        item.startValue.f3 -= elapsedMS / 1000;\n        if (item.startValue.f3 <= 0) {\n            item.target.$gearLocked = true;\n            item.target.setXY(item.target.x - item.startValue.f1, item.target.y - item.startValue.f2);\n            item.target.$gearLocked = false;\n            item.completed = true;\n            this.$totalTasks--;\n            GTimer.inst.remove(item.$shake, item);\n            this.checkAllComplete();\n        }\n    }\n    setup(xml) {\n        this.name = xml.attributes.name;\n        let str = xml.attributes.options;\n        if (str)\n            this.$options = parseInt(str);\n        this.$autoPlay = xml.attributes.autoPlay == 'true';\n        if (this.$autoPlay) {\n            str = xml.attributes.autoPlayRepeat;\n            if (str)\n                this.autoPlayRepeat = parseInt(str);\n            str = xml.attributes.autoPlayDelay;\n            if (str)\n                this.autoPlayDelay = parseFloat(str);\n        }\n        let col = xml.children;\n        col.forEach(cxml => {\n            if (cxml.nodeName != 'item')\n                return;\n            let item = new TransitionItem();\n            this.$items.push(item);\n            item.time = parseInt(cxml.attributes.time) / Transition.FRAME_RATE;\n            item.targetId = cxml.attributes.target;\n            str = cxml.attributes.type;\n            switch (str) {\n                case 'XY':\n                    item.type = 0 /* XY */;\n                    break;\n                case 'Size':\n                    item.type = 1 /* Size */;\n                    break;\n                case 'Scale':\n                    item.type = 2 /* Scale */;\n                    break;\n                case 'Pivot':\n                    item.type = 3 /* Pivot */;\n                    break;\n                case 'Alpha':\n                    item.type = 4 /* Alpha */;\n                    break;\n                case 'Rotation':\n                    item.type = 5 /* Rotation */;\n                    break;\n                case 'Color':\n                    item.type = 6 /* Color */;\n                    break;\n                case 'Animation':\n                    item.type = 7 /* Animation */;\n                    break;\n                case 'Visible':\n                    item.type = 8 /* Visible */;\n                    break;\n                case 'Sound':\n                    item.type = 9 /* Sound */;\n                    break;\n                case 'Transition':\n                    item.type = 10 /* Transition */;\n                    break;\n                case 'Shake':\n                    item.type = 11 /* Shake */;\n                    break;\n                case 'ColorFilter':\n                    item.type = 12 /* ColorFilter */;\n                    break;\n                case 'Skew':\n                    item.type = 13 /* Skew */;\n                    break;\n                default:\n                    item.type = 14 /* Unknown */;\n                    break;\n            }\n            item.tween = cxml.attributes.tween == 'true';\n            item.label = cxml.attributes.label;\n            if (item.tween) {\n                item.duration = parseInt(cxml.attributes.duration) / Transition.FRAME_RATE;\n                if (item.time + item.duration > this.$maxTime)\n                    this.$maxTime = item.time + item.duration;\n                str = cxml.attributes.ease;\n                if (str)\n                    item.easeType = ParseEaseType(str);\n                str = cxml.attributes.repeat;\n                if (str)\n                    item.repeat = parseInt(str);\n                item.yoyo = cxml.attributes.yoyo == 'true';\n                item.label2 = cxml.attributes.label2;\n                let v = cxml.attributes.endValue;\n                if (v) {\n                    this.decodeValue(item.type, cxml.attributes.startValue, item.startValue);\n                    this.decodeValue(item.type, v, item.endValue);\n                }\n                else {\n                    item.tween = false;\n                    this.decodeValue(item.type, cxml.attributes.startValue, item.value);\n                }\n            }\n            else {\n                if (item.time > this.$maxTime)\n                    this.$maxTime = item.time;\n                this.decodeValue(item.type, cxml.attributes.value, item.value);\n            }\n        }, this);\n    }\n    decodeValue(type, str, value) {\n        let arr;\n        switch (type) {\n            case 0 /* XY */:\n            case 1 /* Size */:\n            case 3 /* Pivot */:\n            case 13 /* Skew */:\n                arr = str.split(',');\n                if (arr[0] == '-') {\n                    value.b1 = false;\n                }\n                else {\n                    value.f1 = parseFloat(arr[0]);\n                    value.b1 = true;\n                }\n                if (arr[1] == '-') {\n                    value.b2 = false;\n                }\n                else {\n                    value.f2 = parseFloat(arr[1]);\n                    value.b2 = true;\n                }\n                break;\n            case 4 /* Alpha */:\n                value.f1 = parseFloat(str);\n                break;\n            case 5 /* Rotation */:\n                value.i = parseInt(str);\n                break;\n            case 2 /* Scale */:\n                arr = str.split(',');\n                value.f1 = parseFloat(arr[0]);\n                value.f2 = parseFloat(arr[1]);\n                break;\n            case 6 /* Color */:\n                value.c = StringUtil.HEX2RGB(str);\n                break;\n            case 7 /* Animation */:\n                arr = str.split(',');\n                if (arr[0] == '-') {\n                    value.b1 = false;\n                }\n                else {\n                    value.i = parseInt(arr[0]);\n                    value.b1 = true;\n                }\n                value.b = arr[1] == 'p';\n                break;\n            case 8 /* Visible */:\n                value.b = str == 'true';\n                break;\n            case 9 /* Sound */:\n                arr = str.split(',');\n                value.s = arr[0];\n                if (arr.length > 1) {\n                    let intv = parseInt(arr[1]);\n                    if (intv == 0 || intv == 100)\n                        value.f1 = 1;\n                    else\n                        value.f1 = intv / 100;\n                }\n                else\n                    value.f1 = 1;\n                break;\n            case 10 /* Transition */:\n                arr = str.split(',');\n                value.s = arr[0];\n                if (arr.length > 1)\n                    value.i = parseInt(arr[1]);\n                else\n                    value.i = 1;\n                break;\n            case 11 /* Shake */:\n                arr = str.split(',');\n                value.f1 = parseFloat(arr[0]);\n                value.f2 = parseFloat(arr[1]);\n                break;\n            case 12 /* ColorFilter */:\n                arr = str.split(',');\n                value.f1 = parseFloat(arr[0]);\n                value.f2 = parseFloat(arr[1]);\n                value.f3 = parseFloat(arr[2]);\n                value.f4 = parseFloat(arr[3]);\n                break;\n        }\n    }\n}\nTransition.OPTION_IGNORE_DISPLAY_CONTROLLER = 1;\nTransition.OPTION_AUTO_STOP_DISABLED = 1 >> 1;\nTransition.OPTION_AUTO_STOP_AT_END = 1 >> 2;\nTransition.FRAME_RATE = 24;\nclass TransitionItem {\n    constructor() {\n        this.time = 0;\n        this.type = 0;\n        this.duration = 0;\n        this.repeat = 0;\n        this.yoyo = false;\n        this.tween = false;\n        this.tweenTimes = 0;\n        this.completed = false;\n        this.lockToken = 0;\n        this.easeType = ParseEaseType('Quad.Out');\n        this.value = new TransitionValue();\n        this.startValue = new TransitionValue();\n        this.endValue = new TransitionValue();\n    }\n    /**@internal */\n    $shake(trans, elapsedMS) {\n        trans.$shakeItem(this, elapsedMS);\n    }\n}\nclass TransitionValue {\n    constructor() {\n        this.f1 = 0;\n        this.f2 = 0;\n        this.f3 = 0;\n        this.f4 = 0;\n        this.i = 0;\n        this.b = false;\n        this.b1 = true;\n        this.b2 = true;\n    }\n}\n\nclass Margin {\n    constructor() {\n        this.left = 0;\n        this.right = 0;\n        this.top = 0;\n        this.bottom = 0;\n    }\n    parse(str) {\n        if (!str) {\n            this.left = this.right = this.top = this.bottom = 0;\n            return;\n        }\n        let arr = str.split(\",\");\n        if (arr.length == 1) {\n            let k = parseInt(arr[0]);\n            this.left = this.right = this.top = this.bottom = k;\n        }\n        else {\n            this.top = parseInt(arr[0]);\n            this.bottom = parseInt(arr[1]);\n            this.left = parseInt(arr[2]);\n            this.right = parseInt(arr[3]);\n        }\n    }\n    copy(source) {\n        this.top = source.top;\n        this.bottom = source.bottom;\n        this.left = source.left;\n        this.right = source.right;\n    }\n}\n\nclass GComponent extends GObject {\n    constructor() {\n        super();\n        this.$sortingChildCount = 0;\n        this.$children = [];\n        this.$controllers = [];\n        this.$transitions = [];\n        this.$margin = new Margin();\n        this.$alignOffset = new createjs.Point();\n    }\n    createDisplayObject() {\n        this.$rootContainer = new UIContainer(this);\n        this.setDisplayObject(this.$rootContainer);\n        this.$container = this.$rootContainer;\n    }\n    dispose() {\n        GTimer.inst.remove(this.$validate, this);\n        this.off('added', this.$added);\n        this.off('removed', this.$removed);\n        this.$transitions.forEach((trans) => {\n            trans.dispose();\n        });\n        let numChildren = this.$children.length;\n        for (let i = numChildren - 1; i >= 0; --i) {\n            let obj = this.$children[i];\n            obj.parent = null; //avoid removeFromParent call\n            obj.dispose();\n        }\n        this.$boundsChanged = false;\n        if (this.$scrollPane)\n            this.$scrollPane.dispose();\n        super.dispose();\n    }\n    get displayListContainer() {\n        return this.$container;\n    }\n    addChild(child) {\n        this.addChildAt(child, this.$children.length);\n        return child;\n    }\n    addChildAt(child, index = 0) {\n        if (!child)\n            throw new Error('Invalid child');\n        let numChildren = this.$children.length;\n        if (index >= 0 && index <= numChildren) {\n            if (child.parent == this)\n                this.setChildIndex(child, index);\n            else {\n                child.removeFromParent();\n                child.parent = this;\n                let cnt = this.$children.length;\n                if (child.sortingOrder != 0) {\n                    this.$sortingChildCount++;\n                    index = this.getInsertPosForSortingChild(child);\n                }\n                else if (this.$sortingChildCount > 0) {\n                    if (index > cnt - this.$sortingChildCount)\n                        index = cnt - this.$sortingChildCount;\n                }\n                if (index == cnt)\n                    this.$children.push(child);\n                else\n                    this.$children.splice(index, 0, child);\n                this.childStateChanged(child);\n                this.setBoundsChangedFlag();\n            }\n            return child;\n        }\n        else\n            throw new Error('Invalid child index');\n    }\n    getInsertPosForSortingChild(target) {\n        let cnt = this.$children.length;\n        let i = 0;\n        for (i = 0; i < cnt; i++) {\n            let child = this.$children[i];\n            if (child == target)\n                continue;\n            if (target.sortingOrder < child.sortingOrder)\n                break;\n        }\n        return i;\n    }\n    removeChild(child, dispose = false) {\n        let childIndex = this.$children.indexOf(child);\n        if (childIndex != -1)\n            this.removeChildAt(childIndex, dispose);\n        return child;\n    }\n    removeChildAt(index, dispose = false) {\n        if (index >= 0 && index < this.numChildren) {\n            let child = this.$children[index];\n            child.parent = null;\n            if (child.sortingOrder != 0)\n                this.$sortingChildCount--;\n            this.$children.splice(index, 1);\n            if (child.inContainer)\n                this.$container.removeChild(child.displayObject);\n            if (dispose === true)\n                child.dispose();\n            this.setBoundsChangedFlag();\n            return child;\n        }\n        else\n            throw new Error('Invalid child index');\n    }\n    removeChildren(beginIndex = 0, endIndex = -1, dispose = false) {\n        if (endIndex < 0 || endIndex >= this.numChildren)\n            endIndex = this.numChildren - 1;\n        for (let i = beginIndex; i <= endIndex; ++i)\n            this.removeChildAt(beginIndex, dispose);\n    }\n    getChildAt(index = 0) {\n        if (index >= 0 && index < this.numChildren)\n            return this.$children[index];\n        else\n            throw new Error('Invalid child index');\n    }\n    getChild(name) {\n        let cnt = this.$children.length;\n        for (let i = 0; i < cnt; ++i) {\n            if (this.$children[i].name == name)\n                return this.$children[i];\n        }\n        return null;\n    }\n    getChildInGroup(name, group) {\n        let cnt = this.$children.length;\n        for (let i = 0; i < cnt; ++i) {\n            let child = this.$children[i];\n            if (child.group == group && child.name == name)\n                return child;\n        }\n        return null;\n    }\n    getChildById(id) {\n        let cnt = this.$children.length;\n        for (let i = 0; i < cnt; ++i) {\n            if (this.$children[i].id == id)\n                return this.$children[i];\n        }\n        return null;\n    }\n    getChildIndex(child) {\n        return this.$children.indexOf(child);\n    }\n    setChildIndex(child, index = 0) {\n        let oldIndex = this.$children.indexOf(child);\n        if (oldIndex == -1)\n            throw new Error('no such child found');\n        if (child.sortingOrder != 0)\n            //no effect\n            return;\n        let cnt = this.$children.length;\n        if (this.$sortingChildCount > 0) {\n            if (index > cnt - this.$sortingChildCount - 1)\n                index = cnt - this.$sortingChildCount - 1;\n        }\n        this.$setChildIndex(child, oldIndex, index);\n    }\n    setChildIndexBefore(child, index) {\n        let oldIndex = this.$children.indexOf(child);\n        if (oldIndex == -1)\n            throw new Error('no such child found');\n        if (child.sortingOrder != 0)\n            //no effect\n            return oldIndex;\n        let cnt = this.$children.length;\n        if (this.$sortingChildCount > 0) {\n            if (index > cnt - this.$sortingChildCount - 1)\n                index = cnt - this.$sortingChildCount - 1;\n        }\n        if (oldIndex < index)\n            return this.$setChildIndex(child, oldIndex, index - 1);\n        else\n            return this.$setChildIndex(child, oldIndex, index);\n    }\n    $setChildIndex(child, oldIndex, index = 0) {\n        let cnt = this.$children.length;\n        if (index > cnt)\n            index = cnt;\n        if (oldIndex == index)\n            return oldIndex;\n        this.$children.splice(oldIndex, 1);\n        this.$children.splice(index, 0, child);\n        if (child.inContainer) {\n            let displayIndex = 0;\n            let childCount = this.$container.children.length;\n            for (let i = 0; i < index; i++) {\n                let g = this.$children[i];\n                if (g.inContainer)\n                    displayIndex++;\n            }\n            if (displayIndex == childCount)\n                displayIndex--;\n            this.$container.setChildIndex(child.displayObject, displayIndex);\n            this.setBoundsChangedFlag();\n        }\n        return index;\n    }\n    swapChildren(child1, child2) {\n        let index1 = this.$children.indexOf(child1);\n        let index2 = this.$children.indexOf(child2);\n        if (index1 == -1 || index2 == -1)\n            throw new Error('no such child found');\n        this.swapChildrenAt(index1, index2);\n    }\n    swapChildrenAt(index1, index2 = 0) {\n        let child1 = this.$children[index1];\n        let child2 = this.$children[index2];\n        this.setChildIndex(child1, index2);\n        this.setChildIndex(child2, index1);\n    }\n    get numChildren() {\n        return this.$children.length;\n    }\n    isAncestorOf(child) {\n        if (child == null)\n            return false;\n        let p = child.parent;\n        while (p) {\n            if (p == this)\n                return true;\n            p = p.parent;\n        }\n        return false;\n    }\n    addController(controller) {\n        this.$controllers.push(controller);\n        controller.$parent = this;\n        this.applyController(controller);\n    }\n    getControllerAt(index) {\n        return this.$controllers[index];\n    }\n    getController(name) {\n        let cnt = this.$controllers.length;\n        for (let i = 0; i < cnt; ++i) {\n            let c = this.$controllers[i];\n            if (c.name == name)\n                return c;\n        }\n        return null;\n    }\n    removeController(c) {\n        let index = this.$controllers.indexOf(c);\n        if (index == -1)\n            throw new Error('controller not exists');\n        c.$parent = null;\n        this.$controllers.splice(index, 1);\n        this.$children.forEach(child => {\n            child.handleControllerChanged(c);\n        });\n    }\n    get controllers() {\n        return this.$controllers;\n    }\n    childStateChanged(child) {\n        if (this.$buildingDisplayList)\n            return;\n        if (child instanceof GGroup) {\n            this.$children.forEach(g => {\n                if (g.group == child)\n                    this.childStateChanged(g);\n            }, this);\n            return;\n        }\n        if (!child.displayObject)\n            return;\n        if (child.finalVisible) {\n            if (!child.displayObject.parent) {\n                let index = 0;\n                let len = this.$children.length;\n                for (let i1 = 0; i1 < len; i1++) {\n                    let g = this.$children[i1];\n                    if (g == child)\n                        break;\n                    if (g.displayObject && g.displayObject.parent)\n                        index++;\n                }\n                this.$container.addChildAt(child.displayObject, index);\n            }\n        }\n        else {\n            if (child.displayObject.parent)\n                this.$container.removeChild(child.displayObject);\n        }\n    }\n    applyController(c) {\n        this.$applyingController = c;\n        this.$children.forEach(child => {\n            child.handleControllerChanged(c);\n        });\n        this.$applyingController = null;\n        c.executeActions();\n    }\n    applyAllControllers() {\n        this.$controllers.forEach(c => {\n            this.applyController(c);\n        }, this);\n    }\n    adjustRadioGroupDepth(obj, c) {\n        let myIndex = -1, maxIndex = -1;\n        this.$children.forEach((child, i) => {\n            if (child == obj) {\n                myIndex = i;\n            }\n            else if ((\"relatedController\" in child) && child.relatedController == c) {\n                if (i > maxIndex)\n                    maxIndex = i;\n            }\n        });\n        if (myIndex < maxIndex) {\n            if (this.$applyingController != null)\n                this.$children[maxIndex].handleControllerChanged(this.$applyingController); //TODO: twice\n            this.swapChildrenAt(myIndex, maxIndex);\n        }\n    }\n    getTransitionAt(index) {\n        return this.$transitions[index];\n    }\n    getTransition(transName) {\n        let cnt = this.$transitions.length;\n        for (let i = 0; i < cnt; ++i) {\n            let trans = this.$transitions[i];\n            if (trans.name == transName)\n                return trans;\n        }\n        return null;\n    }\n    isChildInView(child) {\n        if (this.$rootContainer.scrollRect != null) {\n            return (child.x + child.width >= 0 &&\n                child.x <= this.width &&\n                child.y + child.height >= 0 &&\n                child.y <= this.height);\n        }\n        else if (this.$scrollPane != null) {\n            return this.$scrollPane.isChildInView(child);\n        }\n        else\n            return true;\n    }\n    getFirstChildInView() {\n        let cnt = this.$children.length;\n        for (let i = 0; i < cnt; ++i) {\n            let child = this.$children[i];\n            if (this.isChildInView(child))\n                return i;\n        }\n        return -1;\n    }\n    get scrollPane() {\n        return this.$scrollPane;\n    }\n    get opaque() {\n        return this.$opaque;\n    }\n    set opaque(value) {\n        if (this.$opaque != value) {\n            this.$opaque = value;\n            if (this.$opaque) {\n                this.updateOpaque();\n            }\n            else {\n                if (this.$rootContainer.hitArea &&\n                    this.$rootContainer.hitArea instanceof createjs.DisplayObject) {\n                    this.$rootContainer.hitArea = null;\n                }\n            }\n        }\n    }\n    get margin() {\n        return this.$margin;\n    }\n    set margin(value) {\n        this.$margin.copy(value);\n        if (this.$rootContainer.scrollRect != null) {\n            this.$container.x = this.$margin.left + this.$alignOffset.x;\n            this.$container.y = this.$margin.top + this.$alignOffset.y;\n        }\n        this.handleSizeChanged();\n    }\n    get mask() {\n        return this.$rootContainer.mask;\n    }\n    set mask(obj) {\n        if (!obj)\n            return;\n        if (obj instanceof createjs.Shape)\n            this.$rootContainer.mask = obj;\n    }\n    updateOpaque() {\n        // todo\n        // If hitArea set on a Container, children of the Container will not receive mouse events.  \n        // if (!this.$hitArea) {\n        //     this.$hitArea = new createjs.Shape();\n        // }\n        // this.$hitArea.graphics.beginFill('#000').drawRect(0, 0, this.width, this.height); \n        // (<createjs.Shape>this.$rootContainer.hitArea) = this.$hitArea;\n    }\n    updateScrollRect() {\n        let rect = this.$rootContainer.scrollRect;\n        if (rect == null)\n            rect = new createjs.Rectangle();\n        let w = this.width - this.$margin.right;\n        let h = this.height - this.$margin.bottom;\n        rect.x = rect.y = 0;\n        rect.width = w;\n        rect.height = h;\n        this.$rootContainer.scrollRect = rect;\n    }\n    setupScroll(scrollBarMargin, scroll, scrollBarDisplay, flags, vtScrollBarRes, hzScrollBarRes, headerRes, footerRes) {\n        if (this.$rootContainer == this.$container) {\n            this.$container = new createjs.Container();\n            this.$rootContainer.addChild(this.$container);\n        }\n        this.$scrollPane = new ScrollPane(this, scroll, scrollBarMargin, scrollBarDisplay, flags, vtScrollBarRes, hzScrollBarRes, headerRes, footerRes);\n    }\n    setupOverflow(overflow) {\n        if (overflow == 1 /* Hidden */) {\n            if (this.$rootContainer == this.$container) {\n                this.$container = new createjs.Container();\n                this.$rootContainer.addChild(this.$container);\n            }\n            this.updateScrollRect();\n            this.$container.x = this.$margin.left;\n            this.$container.y = this.$margin.top;\n        }\n        else if (this.$margin.left != 0 || this.$margin.top != 0) {\n            if (this.$rootContainer == this.$container) {\n                this.$container = new createjs.Container();\n                this.$rootContainer.addChild(this.$container);\n            }\n            this.$container.x = this.$margin.left;\n            this.$container.y = this.$margin.top;\n        }\n        this.setBoundsChangedFlag();\n    }\n    handleSizeChanged() {\n        if (this.$scrollPane)\n            this.$scrollPane.onOwnerSizeChanged();\n        else if (this.$rootContainer.scrollRect != null)\n            this.updateScrollRect();\n        if (this.$hitArea)\n            this.$hitArea.graphics.drawRect(this.x, this.y, this.width, this.height);\n        if (this.parent && this.parent.$hitArea) {\n            console.log(1);\n            this.parent.$displayObject.hitArea = null;\n        }\n        if (this.$opaque)\n            this.updateOpaque();\n    }\n    handleGrayedChanged() {\n        let c = this.getController('grayed');\n        if (c != null)\n            c.selectedIndex = this.grayed ? 1 : 0;\n        else\n            super.handleGrayedChanged();\n    }\n    setBoundsChangedFlag() {\n        if (!this.$scrollPane && !this.$trackBounds)\n            return;\n        if (!this.$boundsChanged) {\n            this.$boundsChanged = true;\n            GTimer.inst.callLater(this.$validate, this);\n        }\n    }\n    $validate(dt) {\n        if (this.$boundsChanged)\n            this.updateBounds();\n    }\n    ensureBoundsCorrect() {\n        if (this.$boundsChanged)\n            this.updateBounds();\n    }\n    updateBounds() {\n        let ax = 0, ay = 0, aw = 0, ah = 0;\n        let len = this.$children.length;\n        if (len > 0) {\n            (ax = Number.POSITIVE_INFINITY), (ay = Number.POSITIVE_INFINITY);\n            let ar = Number.NEGATIVE_INFINITY, ab = Number.NEGATIVE_INFINITY;\n            let tmp = 0;\n            this.$children.forEach(child => {\n                child.ensureSizeCorrect();\n                tmp = child.x;\n                if (tmp < ax)\n                    ax = tmp;\n                tmp = child.y;\n                if (tmp < ay)\n                    ay = tmp;\n                tmp = child.x + child.actualWidth;\n                if (tmp > ar)\n                    ar = tmp;\n                tmp = child.y + child.actualHeight;\n                if (tmp > ab)\n                    ab = tmp;\n            });\n            aw = ar - ax;\n            ah = ab - ay;\n        }\n        this.setBounds(ax, ay, aw, ah);\n    }\n    setBounds(ax, ay, aw, ah = 0) {\n        this.$boundsChanged = false;\n        if (this.$scrollPane)\n            this.$scrollPane.setContentSize(Math.round(ax + aw), Math.round(ay + ah));\n    }\n    get viewWidth() {\n        if (this.$scrollPane != null)\n            return this.$scrollPane.viewWidth;\n        else\n            return this.width - this.$margin.left - this.$margin.right;\n    }\n    set viewWidth(value) {\n        if (this.$scrollPane != null)\n            this.$scrollPane.viewWidth = value;\n        else\n            this.width = value + this.$margin.left + this.$margin.right;\n    }\n    get viewHeight() {\n        if (this.$scrollPane != null)\n            return this.$scrollPane.viewHeight;\n        else\n            return this.height - this.$margin.top - this.$margin.bottom;\n    }\n    set viewHeight(value) {\n        if (this.$scrollPane != null)\n            this.$scrollPane.viewHeight = value;\n        else\n            this.height = value + this.$margin.top + this.$margin.bottom;\n    }\n    getSnappingPosition(xValue, yValue, resultPoint) {\n        if (!resultPoint)\n            resultPoint = new createjs.Point();\n        let cnt = this.$children.length;\n        if (cnt <= 0) {\n            resultPoint.x = 0;\n            resultPoint.y = 0;\n            return resultPoint;\n        }\n        this.ensureBoundsCorrect();\n        let obj = null;\n        let prev = null;\n        let i = 0;\n        if (yValue != 0) {\n            for (; i < cnt; i++) {\n                obj = this.$children[i];\n                if (yValue < obj.y) {\n                    if (i == 0) {\n                        yValue = 0;\n                        break;\n                    }\n                    else {\n                        prev = this.$children[i - 1];\n                        if (yValue < prev.y + prev.actualHeight / 2)\n                            //top half part\n                            yValue = prev.y;\n                        //bottom half part\n                        else\n                            yValue = obj.y;\n                        break;\n                    }\n                }\n            }\n            if (i == cnt)\n                yValue = obj.y;\n        }\n        if (xValue != 0) {\n            if (i > 0)\n                i--;\n            for (; i < cnt; i++) {\n                obj = this.$children[i];\n                if (xValue < obj.x) {\n                    if (i == 0) {\n                        xValue = 0;\n                        break;\n                    }\n                    else {\n                        prev = this.$children[i - 1];\n                        if (xValue < prev.x + prev.actualWidth / 2)\n                            //top half part\n                            xValue = prev.x;\n                        //bottom half part\n                        else\n                            xValue = obj.x;\n                        break;\n                    }\n                }\n            }\n            if (i == cnt)\n                xValue = obj.x;\n        }\n        resultPoint.x = xValue;\n        resultPoint.y = yValue;\n        return resultPoint;\n    }\n    childSortingOrderChanged(child, oldValue, newValue = 0) {\n        if (newValue == 0) {\n            this.$sortingChildCount--;\n            this.setChildIndex(child, this.$children.length);\n        }\n        else {\n            if (oldValue == 0)\n                this.$sortingChildCount++;\n            let oldIndex = this.$children.indexOf(child);\n            let index = this.getInsertPosForSortingChild(child);\n            if (oldIndex < index)\n                this.$setChildIndex(child, oldIndex, index - 1);\n            else\n                this.$setChildIndex(child, oldIndex, index);\n        }\n    }\n    /**@internal */\n    constructFromResource() {\n        this.constructInternal(null, 0);\n    }\n    constructInternal(objectPool, poolIndex) {\n        let xml = this.packageItem.owner.getItemAsset(this.packageItem);\n        this.$inProgressBuilding = true;\n        let str;\n        let arr;\n        str = xml.attributes.size;\n        arr = str.split(',');\n        this.$sourceWidth = parseInt(arr[0]);\n        this.$sourceHeight = parseInt(arr[1]);\n        this.$initWidth = this.$sourceWidth;\n        this.$initHeight = this.$sourceHeight;\n        this.setSize(this.$sourceWidth, this.$sourceHeight);\n        str = xml.attributes.pivot;\n        if (str) {\n            arr = str.split(',');\n            str = xml.attributes.anchor;\n            this.internalSetPivot(parseFloat(arr[0]), parseFloat(arr[1]), str == 'true');\n        }\n        str = xml.attributes.opaque; // default false\n        this.opaque = str != 'false';\n        let overflow;\n        str = xml.attributes.overflow;\n        if (str)\n            overflow = ParseOverflowType(str);\n        else\n            overflow = 0 /* Visible */;\n        str = xml.attributes.margin;\n        if (str)\n            this.$margin.parse(str);\n        if (overflow == 2 /* Scroll */) {\n            let scroll;\n            str = xml.attributes.scroll;\n            if (str)\n                scroll = ParseScrollType(str);\n            else\n                scroll = 1 /* Vertical */;\n            let scrollBarDisplay;\n            str = xml.attributes.scrollBar;\n            if (str)\n                scrollBarDisplay = ParseScrollBarDisplayType(str);\n            else\n                scrollBarDisplay = 0 /* Default */;\n            let scrollBarFlags;\n            str = xml.attributes.scrollBarFlags;\n            if (str)\n                scrollBarFlags = parseInt(str);\n            else\n                scrollBarFlags = 0;\n            let scrollBarMargin = new Margin();\n            str = xml.attributes.scrollBarMargin;\n            if (str)\n                scrollBarMargin.parse(str);\n            let vtScrollBarRes;\n            let hzScrollBarRes;\n            str = xml.attributes.scrollBarRes;\n            if (str) {\n                arr = str.split(',');\n                vtScrollBarRes = arr[0];\n                hzScrollBarRes = arr[1];\n            }\n            let headerRes, footerRes;\n            str = xml.attributes.ptrRes;\n            if (str) {\n                arr = str.split(',');\n                headerRes = arr[0];\n                footerRes = arr[1];\n            }\n            this.setupScroll(scrollBarMargin, scroll, scrollBarDisplay, scrollBarFlags, vtScrollBarRes, hzScrollBarRes, headerRes, footerRes);\n        }\n        else\n            this.setupOverflow(overflow);\n        this.$buildingDisplayList = true;\n        let col = xml.children;\n        col.forEach(cxml => {\n            if (cxml.nodeName == 'controller') {\n                let c = new Controller();\n                this.$controllers.push(c);\n                c.$parent = this;\n                c.setup(cxml);\n            }\n        });\n        let displayList = this.packageItem.displayList;\n        displayList.forEach((di, i) => {\n            let child;\n            if (objectPool != null)\n                child = objectPool[poolIndex + i];\n            else if (di.packageItem) {\n                child = Decls.UIObjectFactory.newObject(di.packageItem);\n                child.packageItem = di.packageItem;\n                child.constructFromResource();\n            }\n            else\n                child = Decls.UIObjectFactory.newObjectDirectly(di.type);\n            child.$inProgressBuilding = true;\n            child.setupBeforeAdd(di.desc);\n            child.parent = this;\n            this.$children.push(child);\n            if (child instanceof GComponent) {\n                if (child.mask) {\n                    child.mask.set({ x: child.mask.x + child.x, y: child.mask.y + child.y });\n                }\n            }\n        }, this);\n        this.relations.setup(xml);\n        this.$children.forEach((child, i) => {\n            child.relations.setup(displayList[i].desc);\n            child.setupAfterAdd(displayList[i].desc);\n            child.$inProgressBuilding = false;\n        });\n        str = xml.attributes.mask;\n        if (str) {\n            let obj = this.getChildById(str);\n            let maskObj = obj.displayObject;\n            this.removeChild(obj);\n            if (maskObj instanceof createjs.Shape) {\n                this.mask = maskObj;\n            }\n            else if (maskObj['$disp'] instanceof Sprite) ;\n            else\n                throw new Error('only Sprite or Graphics can be applied as mask object');\n        }\n        col.forEach(cxml => {\n            if (cxml.nodeName == 'transition') {\n                let trans = new Transition(this);\n                this.$transitions.push(trans);\n                trans.setup(cxml);\n            }\n        }, this);\n        if (this.$transitions.length > 0) {\n            this.on('added', this.$added, this);\n            this.on('removed', this.$removed, this);\n        }\n        this.applyAllControllers();\n        this.$buildingDisplayList = false;\n        this.$inProgressBuilding = false;\n        this.appendChildrenList();\n        this.setBoundsChangedFlag();\n        this.constructFromXML(xml);\n    }\n    appendChildrenList() {\n        this.$children.forEach(child => {\n            if (child.displayObject != null && child.finalVisible)\n                this.$container.addChild(child.displayObject);\n        }, this);\n    }\n    constructFromXML(xml) { }\n    $added(d) {\n        this.$transitions.forEach(trans => {\n            if (trans.autoPlay)\n                trans.play({ times: trans.autoPlayRepeat, delay: trans.autoPlayDelay });\n        });\n    }\n    $removed(d) {\n        this.$transitions.forEach(trans => {\n            trans.stop(false, false);\n        });\n    }\n}\n\nclass Window extends GComponent {\n    constructor() {\n        super();\n        this.$requestingCmd = 0;\n        this.focusable = true;\n        this.$uiSources = [];\n        this.bringToFrontOnClick = UIConfig.bringWindowToFrontOnClick;\n        this.on('added', this.$onShown, this);\n        this.on('removed', this.$onHidden, this);\n        this.on(InteractiveEvents.Down, this.$mouseDown, this);\n    }\n    addUISource(source) {\n        this.$uiSources.push(source);\n    }\n    set contentPane(val) {\n        if (this.$contentPane != val) {\n            if (this.$contentPane != null)\n                this.removeChild(this.$contentPane);\n            this.$contentPane = val;\n            if (this.$contentPane != null) {\n                this.addChild(this.$contentPane);\n                this.setSize(this.$contentPane.width, this.$contentPane.height);\n                this.$contentPane.addRelation(this, 24 /* Size */);\n                this.$frame = this.$contentPane.getChild('frame');\n                if (this.$frame != null) {\n                    this.closeButton = this.$frame.getChild('closeButton');\n                    this.dragArea = this.$frame.getChild('dragArea');\n                    this.contentArea = this.$frame.getChild('contentArea');\n                }\n            }\n        }\n    }\n    get contentPane() {\n        return this.$contentPane;\n    }\n    get frame() {\n        return this.$frame;\n    }\n    get closeButton() {\n        return this.$closeButton;\n    }\n    set closeButton(value) {\n        if (this.$closeButton != null)\n            this.$closeButton.removeClick(this.closeEventHandler);\n        this.$closeButton = value;\n        if (this.$closeButton != null)\n            this.$closeButton.click(this.closeEventHandler, this);\n    }\n    get dragArea() {\n        return this.$dragArea;\n    }\n    set dragArea(value) {\n        if (this.$dragArea != value) {\n            if (this.$dragArea != null) {\n                this.$dragArea.draggable = false;\n                this.$dragArea.off(\"__dragStart\" /* START */, this.$dragStart);\n            }\n            this.$dragArea = value;\n            if (this.$dragArea != null) {\n                if (this.$dragArea instanceof GGraph)\n                    this.$dragArea.drawRect(0, '#000', '#000');\n                this.$dragArea.draggable = true;\n                this.$dragArea.on(\"__dragStart\" /* START */, this.$dragStart, this);\n            }\n        }\n    }\n    get contentArea() {\n        return this.$contentArea;\n    }\n    set contentArea(value) {\n        this.$contentArea = value;\n    }\n    show() {\n        Decls$1.GRoot.inst.showWindow(this);\n    }\n    showOn(root) {\n        root.showWindow(this);\n    }\n    hide() {\n        if (this.isShowing)\n            this.doHideAnimation();\n    }\n    hideImmediately() {\n        Decls$1.GRoot.inst.hideWindowImmediately(this);\n    }\n    centerOn(r, autoUpdate = false) {\n        this.setXY(Math.round((r.width - this.width) * 0.5), Math.round((r.height - this.height) * 0.5));\n        if (autoUpdate) {\n            this.addRelation(r, 3 /* Center_Center */);\n            this.addRelation(r, 10 /* Middle_Middle */);\n        }\n    }\n    toggleVisible() {\n        if (this.isTop)\n            this.hide();\n        else\n            this.show();\n    }\n    get isShowing() {\n        return this.parent != null;\n    }\n    get isTop() {\n        return this.parent != null && this.parent.getChildIndex(this) == this.parent.numChildren - 1;\n    }\n    get modal() {\n        return this.$modal;\n    }\n    set modal(val) {\n        this.$modal = val;\n    }\n    bringToFront() {\n        Decls$1.GRoot.inst.bringToFront(this);\n    }\n    showModalWait(msg, cmd = 0) {\n        if (cmd != 0)\n            this.$requestingCmd = cmd;\n        if (UIConfig.windowModalWaiting) {\n            if (!this.$modalWaitPane)\n                this.$modalWaitPane = UIPackage.createObjectFromURL(UIConfig.windowModalWaiting);\n            this.layoutModalWaitPane(msg);\n            this.addChild(this.$modalWaitPane);\n        }\n    }\n    layoutModalWaitPane(msg) {\n        if (this.$contentArea != null) {\n            let pt = this.$frame.localToGlobal();\n            pt = this.globalToLocal(pt.x, pt.y, pt);\n            this.$modalWaitPane.setXY(pt.x + this.$contentArea.x, pt.y + this.$contentArea.y);\n            this.$modalWaitPane.setSize(this.$contentArea.width, this.$contentArea.height);\n            if (msg && msg.length)\n                this.$modalWaitPane.text = msg;\n        }\n        else\n            this.$modalWaitPane.setSize(this.width, this.height);\n    }\n    closeModalWait(cmd = 0) {\n        if (cmd != 0) {\n            if (this.$requestingCmd != cmd)\n                return false;\n        }\n        this.$requestingCmd = 0;\n        if (this.$modalWaitPane && this.$modalWaitPane.parent != null)\n            this.removeChild(this.$modalWaitPane);\n        return true;\n    }\n    get modalWaiting() {\n        return this.$modalWaitPane && this.$modalWaitPane.parent != null;\n    }\n    init() {\n        if (this.$inited || this.$loading)\n            return;\n        if (this.$uiSources.length > 0) {\n            this.$loading = false;\n            this.$uiSources.forEach(o => {\n                if (!o.loaded) {\n                    o.load(this.$uiLoadComplete, this);\n                    this.$loading = true;\n                }\n            }, this);\n            if (!this.$loading)\n                this.$init();\n        }\n        else\n            this.$init();\n    }\n    onInit() { }\n    onShown() { }\n    onHide() { }\n    doShowAnimation() {\n        this.onShown();\n    }\n    doHideAnimation() {\n        this.hideImmediately();\n    }\n    $uiLoadComplete() {\n        let cnt = this.$uiSources.length;\n        for (let i = 0; i < cnt; i++) {\n            if (!this.$uiSources[i].loaded)\n                return;\n        }\n        this.$loading = false;\n        this.$init();\n    }\n    $init() {\n        this.$inited = true;\n        this.onInit();\n        if (this.isShowing)\n            this.doShowAnimation();\n    }\n    dispose() {\n        this.off('added', this.$onShown);\n        this.off('removed', this.$onHidden);\n        this.off(InteractiveEvents.Down, this.$mouseDown);\n        if (this.$dragArea)\n            this.$dragArea.off(\"__dragStart\" /* START */, this.$dragStart);\n        if (this.parent != null)\n            this.hideImmediately();\n        if (this.$modalWaitPane)\n            this.$modalWaitPane.dispose();\n        if (this.$contentPane)\n            this.$contentPane.dispose();\n        super.dispose();\n    }\n    closeEventHandler(evt) {\n        this.hide();\n    }\n    $onShown(target) {\n        if (!this.$inited)\n            this.init();\n        else\n            this.doShowAnimation();\n    }\n    $onHidden(target) {\n        this.closeModalWait();\n        this.onHide();\n    }\n    $mouseDown(evt) {\n        if (this.isShowing && this.bringToFrontOnClick)\n            this.bringToFront();\n    }\n    $dragStart(evt) {\n        let currentTarget = evt.data.currentTarget;\n        GObject.castFromNativeObject(currentTarget).stopDrag();\n        this.startDrag(evt.data.pointerID);\n    }\n}\n\nlet _inst;\nclass GRootMouseStatus {\n    constructor() {\n        this.touchDown = false;\n        this.mouseX = 0;\n        this.mouseY = 0;\n    }\n}\nclass GRoot extends GComponent {\n    constructor() {\n        super();\n        this.$volumeScale = 1;\n        if (_inst == null)\n            _inst = this;\n        this.opaque = false;\n        this.$popupStack = [];\n        this.$justClosedPopups = [];\n        this.$uid = GRoot.uniqueID++;\n        DOMEventManager.inst.on(\"__mouseWheel\" /* MOUSE_WHEEL */, this.dispatchMouseWheel, this);\n    }\n    static findFor(obj) {\n        if (obj instanceof GRoot)\n            return obj;\n        if (!obj)\n            return _inst;\n        var p = obj.parent;\n        while (p) {\n            if (p instanceof GRoot)\n                return p;\n            p = p.parent;\n        }\n        return _inst;\n    }\n    /**\n     * the singleton instance of the GRoot object\n     */\n    static get inst() {\n        if (_inst == null)\n            _inst = new GRoot();\n        return _inst;\n    }\n    /**\n     * the current mouse/pointer data\n     */\n    static get globalMouseStatus() {\n        return GRoot.$gmStatus;\n    }\n    /**\n     * the main entry to lauch the UI root, e.g.: GRoot.inst.attachTo(app, options)\n     * @param app your createjs.Stage instance to be used in this GRoot instance\n     * @param stageOptions stage rotation / resize options\n     */\n    attachTo(stage, stageOptions) {\n        createjs.Touch.enable(stage);\n        stage.mouseEnabled = true;\n        stage.mouseChildren = true;\n        stage.enableMouseOver(50);\n        // if (this.$uiStage) {\n        //     this.$uiStage.off(DisplayObjectEvent.SIZE_CHANGED, this.$winResize);\n        //     this.$uiStage.nativeStage.off(InteractiveEvents.Down, this.$stageDown);\n        //     this.$uiStage.nativeStage.off(InteractiveEvents.Up, this.$stageUp);\n        //     this.$uiStage.nativeStage.off(InteractiveEvents.Move, this.$stageMove);\n        //     this.$uiStage.nativeStage.off(this.$displayObject);\n        //     this.$uiStage.dispose();\n        // }\n        this.$uiStage = new UIStage(stage, stageOptions);\n        this.$uiStage.on(\"__sizeChanged\" /* SIZE_CHANGED */, this.$winResize, this);\n        this.$uiStage.nativeStage.on(InteractiveEvents.Down, this.$stageDown, this);\n        this.$uiStage.nativeStage.on(InteractiveEvents.Up, this.$stageUp, this);\n        this.$uiStage.nativeStage.on(InteractiveEvents.Move, this.$stageMove, this);\n        this.$uiStage.nativeStage.on(InteractiveEvents.Click, this.$click, this);\n        this.$uiStage.nativeStage.addChild(this.$displayObject);\n        this.$winResize(this.$uiStage);\n        if (!this.$modalLayer) {\n            this.$modalLayer = new GGraph();\n            this.$modalLayer.setSize(this.width, this.height);\n            this.$modalLayer.drawRect(0, '', UIConfig.modalLayerColor);\n            this.$modalLayer.addRelation(this, 24 /* Size */);\n        }\n    }\n    get uniqueID() {\n        return this.$uid;\n    }\n    get stageWidth() {\n        return this.$uiStage.stageWidth;\n    }\n    get stageHeight() {\n        return this.$uiStage.stageHeight;\n    }\n    get contentScaleFactor() {\n        return this.$uiStage.resolution;\n    }\n    get applicationContext() {\n        return this.$uiStage.applicationContext;\n    }\n    get nativeStage() {\n        return this.$uiStage.nativeStage;\n    }\n    get orientation() {\n        return this.$uiStage.orientation;\n    }\n    get stageWrapper() {\n        return this.$uiStage;\n    }\n    dispatchMouseWheel(evt) {\n        let event = evt.data.event;\n        let childUnderMouse = this.getObjectUnderPoint(GRoot.globalMouseStatus.mouseX, GRoot.globalMouseStatus.mouseY);\n        if (childUnderMouse != null) {\n            //bubble\n            while (childUnderMouse.parent && childUnderMouse.parent != this) {\n                let mouseWheelEvent = new createjs.Event(\"__mouseWheel\" /* MOUSE_WHEEL */, true, false);\n                mouseWheelEvent.data = { event };\n                childUnderMouse.dispatchEvent(mouseWheelEvent);\n                childUnderMouse = childUnderMouse.parent;\n            }\n        }\n    }\n    /**\n     * get the objects which are placed underneath the given stage coordinate\n     * @param globalX the stage X\n     * @param globalY the stage Y\n     */\n    getObjectUnderPoint(globalX, globalY) {\n        GRoot.sHelperPoint.setValues(globalX, globalY);\n        window['test'] = true;\n        let ret = this.$uiStage.applicationContext.getObjectUnderPoint(GRoot.sHelperPoint.x, GRoot.sHelperPoint.y, 0);\n        return GObject.castFromNativeObject(ret);\n    }\n    showWindow(win) {\n        this.addChild(win);\n        win.requestFocus();\n        if (win.x > this.width)\n            win.x = this.width - win.width;\n        else if (win.x + win.width < 0)\n            win.x = 0;\n        if (win.y > this.height)\n            win.y = this.height - win.height;\n        else if (win.y + win.height < 0)\n            win.y = 0;\n        this.adjustModalLayer();\n    }\n    hideWindow(win) {\n        win.hide();\n    }\n    hideWindowImmediately(win) {\n        if (win.parent == this)\n            this.removeChild(win);\n        this.adjustModalLayer();\n    }\n    bringToFront(win) {\n        let i;\n        if (this.$modalLayer.parent != null && !win.modal)\n            i = this.getChildIndex(this.$modalLayer) - 1;\n        else\n            i = this.numChildren - 1;\n        for (; i >= 0; i--) {\n            let g = this.getChildAt(i);\n            if (g == win)\n                return;\n            if (g instanceof Window)\n                break;\n        }\n        if (i >= 0)\n            this.setChildIndex(win, i);\n    }\n    showModalWait(msg = null) {\n        if (UIConfig.globalModalWaiting != null) {\n            if (this.$modalWaitPane == null) {\n                this.$modalWaitPane = UIPackage.createObjectFromURL(UIConfig.globalModalWaiting);\n                this.$modalWaitPane.addRelation(this, 24 /* Size */);\n            }\n            this.$modalWaitPane.setSize(this.width, this.height);\n            this.addChild(this.$modalWaitPane);\n            this.$modalWaitPane.text = msg;\n        }\n    }\n    closeModalWait() {\n        if (this.$modalWaitPane != null && this.$modalWaitPane.parent != null)\n            this.removeChild(this.$modalWaitPane);\n    }\n    closeAllExceptModals() {\n        let arr = this.$children.slice();\n        arr.forEach(g => {\n            if (g instanceof Window && !g.modal)\n                g.hide();\n        }, this);\n    }\n    closeAllWindows() {\n        let arr = this.$children.slice();\n        arr.forEach(g => {\n            if (g instanceof Window)\n                g.hide();\n        }, this);\n    }\n    getTopWindow() {\n        let cnt = this.numChildren;\n        for (let i = cnt - 1; i >= 0; i--) {\n            let g = this.getChildAt(i);\n            if (g instanceof Window) {\n                return g;\n            }\n        }\n        return null;\n    }\n    get hasModalWindow() {\n        return this.$modalLayer.parent != null;\n    }\n    get modalWaiting() {\n        return this.$modalWaitPane && this.$modalWaitPane.inContainer;\n    }\n    showPopup(popup, target = null, dir = 0 /* Auto */) {\n        if (this.$popupStack.length > 0) {\n            let k = this.$popupStack.indexOf(popup);\n            if (k != -1) {\n                for (let i = this.$popupStack.length - 1; i >= k; i--)\n                    this.removeChild(this.$popupStack.pop());\n            }\n        }\n        this.$popupStack.push(popup);\n        this.addChild(popup);\n        this.adjustModalLayer();\n        let pos;\n        let sizeW = 0, sizeH = 0;\n        if (target) {\n            pos = target.localToRoot();\n            sizeW = target.width;\n            sizeH = target.height;\n        }\n        else\n            pos = this.globalToLocal(GRoot.$gmStatus.mouseX, GRoot.$gmStatus.mouseY);\n        let xx, yy;\n        xx = pos.x;\n        if (xx + popup.width > this.width)\n            xx = xx + sizeW - popup.width;\n        yy = pos.y + sizeH;\n        if ((dir == 0 /* Auto */ && yy + popup.height > this.height) ||\n            dir == 2 /* Up */) {\n            yy = pos.y - popup.height - 1;\n            if (yy < 0) {\n                yy = 0;\n                xx += sizeW * 0.5;\n            }\n        }\n        popup.x = xx;\n        popup.y = yy;\n    }\n    togglePopup(popup, target = null, dir) {\n        if (this.$justClosedPopups.indexOf(popup) != -1)\n            return;\n        this.showPopup(popup, target, dir);\n    }\n    hidePopup(popup = null) {\n        let i;\n        if (popup != null) {\n            let k = this.$popupStack.indexOf(popup);\n            if (k != -1) {\n                for (i = this.$popupStack.length - 1; i >= k; i--)\n                    this.closePopup(this.$popupStack.pop());\n            }\n        }\n        else {\n            let cnt = this.$popupStack.length;\n            for (i = cnt - 1; i >= 0; i--)\n                this.closePopup(this.$popupStack[i]);\n            this.$popupStack.length = 0;\n        }\n    }\n    get hasAnyPopup() {\n        return this.$popupStack.length != 0;\n    }\n    closePopup(target) {\n        if (target.parent != null) {\n            if (target instanceof Window)\n                target.hide();\n            else\n                this.removeChild(target);\n        }\n    }\n    showTooltips(msg) {\n        if (this.$defaultTooltipWin == null) {\n            let resourceURL = UIConfig.tooltipsWin;\n            if (!resourceURL) {\n                console.error('UIConfig.tooltipsWin not defined');\n                return;\n            }\n            this.$defaultTooltipWin = UIPackage.createObjectFromURL(resourceURL);\n        }\n        this.$defaultTooltipWin.text = msg;\n        this.showTooltipsWin(this.$defaultTooltipWin);\n    }\n    showTooltipsWin(tooltipWin, position = null) {\n        this.hideTooltips();\n        this.$tooltipWin = tooltipWin;\n        let xx = 0;\n        let yy = 0;\n        if (position == null) {\n            xx = GRoot.$gmStatus.mouseX + 10;\n            yy = GRoot.$gmStatus.mouseY + 20;\n        }\n        else {\n            xx = position.x;\n            yy = position.y;\n        }\n        let pt = this.globalToLocal(xx, yy);\n        xx = pt.x;\n        yy = pt.y;\n        if (xx + this.$tooltipWin.width > this.width) {\n            xx = xx - this.$tooltipWin.width - 1;\n            if (xx < 0)\n                xx = 10;\n        }\n        if (yy + this.$tooltipWin.height > this.height) {\n            yy = yy - this.$tooltipWin.height - 1;\n            if (xx - this.$tooltipWin.width - 1 > 0)\n                xx = xx - this.$tooltipWin.width - 1;\n            if (yy < 0)\n                yy = 10;\n        }\n        this.$tooltipWin.x = xx;\n        this.$tooltipWin.y = yy;\n        this.addChild(this.$tooltipWin);\n    }\n    hideTooltips() {\n        if (this.$tooltipWin != null) {\n            if (this.$tooltipWin.parent)\n                this.removeChild(this.$tooltipWin);\n            this.$tooltipWin = null;\n        }\n    }\n    get focus() {\n        if (this.$focusedObject && !this.$focusedObject.onStage)\n            this.$focusedObject = null;\n        return this.$focusedObject;\n    }\n    set focus(value) {\n        if (value && (!value.focusable || !value.onStage))\n            throw new Error('Invalid target to focus');\n        this.setFocus(value);\n    }\n    setFocus(value) {\n        if (this.$focusedObject != value) {\n            this.$focusedObject = value;\n            let evt = new createjs.Event(\"__focusChanged\" /* CHANGED */, true, false);\n            this.dispatchEvent(evt, this);\n        }\n    }\n    get volumeScale() {\n        return this.$volumeScale;\n    }\n    set volumeScale(value) {\n        this.$volumeScale = value;\n    }\n    playOneShotSound(sound, volumeScale = 1) {\n        var vs = this.$volumeScale * volumeScale;\n        sound.play({ volume: vs });\n    }\n    adjustModalLayer() {\n        let cnt = this.numChildren;\n        if (this.$modalWaitPane != null && this.$modalWaitPane.parent != null)\n            this.setChildIndex(this.$modalWaitPane, cnt - 1);\n        for (let i = cnt - 1; i >= 0; i--) {\n            let g = this.getChildAt(i);\n            if (g instanceof Window && g.modal) {\n                if (this.$modalLayer.parent == null)\n                    this.addChildAt(this.$modalLayer, i);\n                else\n                    this.setChildIndexBefore(this.$modalLayer, i);\n                return;\n            }\n        }\n        if (this.$modalLayer.parent != null)\n            this.removeChild(this.$modalLayer);\n    }\n    $stageDown(evt) {\n        // see Drag & Drop\n        GRoot.$gmStatus.mouseX = evt.stageX;\n        GRoot.$gmStatus.mouseY = evt.stageY;\n        GRoot.$gmStatus.touchDown = true;\n        //check focus\n        let mc = evt.target;\n        while (mc && mc != this.nativeStage) {\n            if (isUIObject(mc)) {\n                let g = mc.UIOwner;\n                if (g.touchable && g.focusable) {\n                    this.setFocus(g);\n                    break;\n                }\n            }\n            mc = mc.parent;\n        }\n        if (this.$tooltipWin != null)\n            this.hideTooltips();\n        this.checkPopups(evt.target);\n    }\n    checkPopups(target) {\n        if (this.$checkingPopups)\n            return;\n        this.$checkingPopups = true;\n        this.$justClosedPopups.length = 0;\n        if (this.$popupStack.length > 0) {\n            let mc = target;\n            while (mc && mc != this.nativeStage) {\n                if (isUIObject(mc)) {\n                    let pindex = this.$popupStack.indexOf(mc.UIOwner);\n                    if (pindex != -1) {\n                        let popup;\n                        for (let i = this.$popupStack.length - 1; i > pindex; i--) {\n                            popup = this.$popupStack.pop();\n                            this.closePopup(popup);\n                            this.$justClosedPopups.push(popup);\n                        }\n                        return;\n                    }\n                }\n                mc = mc.parent;\n            }\n            let cnt = this.$popupStack.length;\n            let popup;\n            for (let i = cnt - 1; i >= 0; i--) {\n                popup = this.$popupStack[i];\n                this.closePopup(popup);\n                this.$justClosedPopups.push(popup);\n            }\n            this.$popupStack.length = 0;\n        }\n    }\n    $stageMove(evt) {\n        GRoot.$gmStatus.mouseX = evt.stageX;\n        GRoot.$gmStatus.mouseY = evt.stageY;\n    }\n    $stageUp(evt) {\n        GRoot.$gmStatus.touchDown = false;\n        this.$checkingPopups = false;\n    }\n    $click(evt) { }\n    $winResize(stage) {\n        this.setSize(stage.stageWidth, stage.stageHeight);\n    }\n}\nGRoot.uniqueID = 0;\nGRoot.$gmStatus = new GRootMouseStatus();\nDecls$1.GRoot = GRoot;\n\nvar TEXT_GRADIENT;\n(function (TEXT_GRADIENT) {\n    TEXT_GRADIENT[TEXT_GRADIENT[\"LINEAR_VERTICAL\"] = 0] = \"LINEAR_VERTICAL\";\n    TEXT_GRADIENT[TEXT_GRADIENT[\"LINEAR_HORIZONTAL\"] = 1] = \"LINEAR_HORIZONTAL\";\n})(TEXT_GRADIENT || (TEXT_GRADIENT = {}));\nconst defaultStyle = {\n    align: 'left',\n    breakWords: false,\n    dropShadow: false,\n    dropShadowAlpha: 1,\n    dropShadowAngle: Math.PI / 6,\n    dropShadowBlur: 0,\n    dropShadowColor: 'black',\n    dropShadowDistance: 5,\n    dropShadowOffsetX: 0,\n    dropShadowOffsetY: 0,\n    fill: 'black',\n    fillGradientType: TEXT_GRADIENT.LINEAR_VERTICAL,\n    fillGradientStops: [],\n    fontFamily: 'Arial',\n    fontSize: 26,\n    fontStyle: 'normal',\n    fontVariant: 'normal',\n    fontWeight: 'normal',\n    letterSpacing: 0,\n    lineHeight: 0,\n    lineJoin: 'miter',\n    miterLimit: 10,\n    padding: 0,\n    stroke: 'black',\n    strokeThickness: 0,\n    textBaseline: 'alphabetic',\n    trim: false,\n    whiteSpace: 'pre',\n    wordWrap: false,\n    wordWrapWidth: 100,\n    leading: 0\n};\nconst genericFontFamilies = ['serif', 'sans-serif', 'monospace', 'cursive', 'fantasy', 'system-ui'];\nclass TextStyle {\n    constructor(style) {\n        this.styleID = 0;\n        this.reset();\n        Utils.deepCopyProperties(this, style, style);\n    }\n    clone() {\n        const clonedProperties = {};\n        Utils.deepCopyProperties(clonedProperties, this, defaultStyle);\n        return new TextStyle(clonedProperties);\n    }\n    /**\n     * Resets all properties to the defaults specified in TextStyle.prototype._default\n     */\n    reset() {\n        Utils.deepCopyProperties(this, defaultStyle, defaultStyle);\n    }\n    /**\n     * Alignment for multiline text ('left', 'center' or 'right'), does not affect single line text\n     *\n     * @member {string}\n     */\n    get align() {\n        return this._align;\n    }\n    set align(align) {\n        if (this._align !== align) {\n            this._align = align;\n            this.styleID++;\n        }\n    }\n    /**\n     * Indicates if lines can be wrapped within words, it needs wordWrap to be set to true\n     *\n     * @member {boolean}\n     */\n    get breakWords() {\n        return this._breakWords;\n    }\n    set breakWords(breakWords) {\n        if (this._breakWords !== breakWords) {\n            this._breakWords = breakWords;\n            this.styleID++;\n        }\n    }\n    /**\n     * Set a drop shadow for the text\n     *\n     * @member {boolean}\n     */\n    get dropShadow() {\n        return this._dropShadow;\n    }\n    set dropShadow(dropShadow) {\n        if (this._dropShadow !== dropShadow) {\n            this._dropShadow = dropShadow;\n            this.styleID++;\n        }\n    }\n    /**\n     * Set alpha for the drop shadow\n     *\n     * @member {number}\n     */\n    get dropShadowAlpha() {\n        return this._dropShadowAlpha;\n    }\n    set dropShadowAlpha(dropShadowAlpha) {\n        if (this._dropShadowAlpha !== dropShadowAlpha) {\n            this._dropShadowAlpha = dropShadowAlpha;\n            this.styleID++;\n        }\n    }\n    /**\n     * Set a angle of the drop shadow\n     *\n     * @member {number}\n     */\n    get dropShadowAngle() {\n        return this._dropShadowAngle;\n    }\n    set dropShadowAngle(dropShadowAngle) {\n        if (this._dropShadowAngle !== dropShadowAngle) {\n            this._dropShadowAngle = dropShadowAngle;\n            this.styleID++;\n        }\n    }\n    /**\n     * Set a shadow blur radius\n     *\n     * @member {number}\n     */\n    get dropShadowBlur() {\n        return this._dropShadowBlur;\n    }\n    set dropShadowBlur(dropShadowBlur) {\n        if (this._dropShadowBlur !== dropShadowBlur) {\n            this._dropShadowBlur = dropShadowBlur;\n            this.styleID++;\n        }\n    }\n    /**\n     * A fill style to be used on the dropshadow e.g 'red', '#00FF00'\n     *\n     * @member {string|number}\n     */\n    get dropShadowColor() {\n        return this._dropShadowColor;\n    }\n    set dropShadowColor(dropShadowColor) {\n        const outputColor = getColor(dropShadowColor);\n        if (this._dropShadowColor !== outputColor) {\n            this._dropShadowColor = outputColor;\n            this.styleID++;\n        }\n    }\n    /**\n     * Set a distance of the drop shadow\n     *\n     * @member {number}\n     */\n    get dropShadowDistance() {\n        return this._dropShadowDistance;\n    }\n    set dropShadowDistance(dropShadowDistance) {\n        if (this._dropShadowDistance !== dropShadowDistance) {\n            this._dropShadowDistance = dropShadowDistance;\n            this.styleID++;\n        }\n    }\n    /**\n     * Set a offsetX of the drop shadow\n     *\n     * @member {number}\n     */\n    get dropShadowOffsetX() {\n        return this._dropShadowOffsetX;\n    }\n    set dropShadowOffsetX(dropShadowOffsetX) {\n        if (this._dropShadowOffsetX !== dropShadowOffsetX) {\n            this._dropShadowOffsetX = dropShadowOffsetX;\n            this.styleID++;\n        }\n    }\n    /**\n     * Set a offsetY of the drop shadow\n     *\n     * @member {number}\n     */\n    get dropShadowOffsetY() {\n        return this._dropShadowOffsetY;\n    }\n    set dropShadowOffsetY(dropShadowOffsetY) {\n        if (this._dropShadowOffsetY !== dropShadowOffsetY) {\n            this._dropShadowOffsetY = dropShadowOffsetY;\n            this.styleID++;\n        }\n    }\n    /**\n     * A canvas fillstyle that will be used on the text e.g 'red', '#00FF00'.\n     * Can be an array to create a gradient eg ['#000000','#FFFFFF']\n     * {@link https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/fillStyle|MDN}\n     *\n     * @member {string|string[]|number|number[]|CanvasGradient|CanvasPattern}\n     */\n    get fill() {\n        return this._fill;\n    }\n    set fill(fill) {\n        const outputColor = getColor(fill);\n        if (this._fill !== outputColor) {\n            this._fill = outputColor;\n            this.styleID++;\n        }\n    }\n    get fillGradientType() {\n        return this._fillGradientType;\n    }\n    set fillGradientType(fillGradientType) {\n        if (this._fillGradientType !== fillGradientType) {\n            this._fillGradientType = fillGradientType;\n            this.styleID++;\n        }\n    }\n    get fillGradientStops() {\n        return this._fillGradientStops;\n    }\n    set fillGradientStops(fillGradientStops) {\n        if (!areArraysEqual(this._fillGradientStops, fillGradientStops)) {\n            this._fillGradientStops = fillGradientStops;\n            this.styleID++;\n        }\n    }\n    get fontFamily() {\n        return this._fontFamily;\n    }\n    set fontFamily(fontFamily) {\n        if (this.fontFamily !== fontFamily) {\n            this._fontFamily = fontFamily;\n            this.styleID++;\n        }\n    }\n    get fontSize() {\n        return this._fontSize;\n    }\n    set fontSize(fontSize) {\n        if (this._fontSize !== fontSize) {\n            this._fontSize = fontSize;\n            this.styleID++;\n        }\n    }\n    get fontStyle() {\n        return this._fontStyle;\n    }\n    set fontStyle(fontStyle) {\n        if (this._fontStyle !== fontStyle) {\n            this._fontStyle = fontStyle;\n            this.styleID++;\n        }\n    }\n    /**\n     * The font variant\n     * ('normal' or 'small-caps')\n     *\n     * @member {string}\n     */\n    get fontVariant() {\n        return this._fontVariant;\n    }\n    set fontVariant(fontVariant) {\n        if (this._fontVariant !== fontVariant) {\n            this._fontVariant = fontVariant;\n            this.styleID++;\n        }\n    }\n    /**\n     * The font weight\n     * ('normal', 'bold', 'bolder', 'lighter' and '100', '200', '300', '400', '500', '600', '700', 800' or '900')\n     *\n     * @member {string}\n     */\n    get fontWeight() {\n        return this._fontWeight;\n    }\n    set fontWeight(fontWeight) {\n        if (this._fontWeight !== fontWeight) {\n            this._fontWeight = fontWeight;\n            this.styleID++;\n        }\n    }\n    /**\n     * The amount of spacing between letters, default is 0\n     *\n     * @member {number}\n     */\n    get letterSpacing() {\n        return this._letterSpacing;\n    }\n    set letterSpacing(letterSpacing) {\n        if (this._letterSpacing !== letterSpacing) {\n            this._letterSpacing = letterSpacing;\n            this.styleID++;\n        }\n    }\n    /**\n     * The line height, a number that represents the vertical space that a letter uses\n     *\n     * @member {number}\n     */\n    get lineHeight() {\n        return this._lineHeight;\n    }\n    set lineHeight(lineHeight) {\n        if (this._lineHeight !== lineHeight) {\n            this._lineHeight = lineHeight;\n            this.styleID++;\n        }\n    }\n    /**\n     * The space between lines\n     *\n     * @member {number}\n     */\n    get leading() {\n        return this._leading;\n    }\n    set leading(leading) {\n        if (this._leading !== leading) {\n            this._leading = leading;\n            this.styleID++;\n        }\n    }\n    /**\n     * The lineJoin property sets the type of corner created, it can resolve spiked text issues.\n     * Default is 'miter' (creates a sharp corner).\n     *\n     * @member {string}\n     */\n    get lineJoin() {\n        return this._lineJoin;\n    }\n    set lineJoin(lineJoin) {\n        if (this._lineJoin !== lineJoin) {\n            this._lineJoin = lineJoin;\n            this.styleID++;\n        }\n    }\n    /**\n     * The miter limit to use when using the 'miter' lineJoin mode\n     * This can reduce or increase the spikiness of rendered text.\n     *\n     * @member {number}\n     */\n    get miterLimit() {\n        return this._miterLimit;\n    }\n    set miterLimit(miterLimit) {\n        if (this._miterLimit !== miterLimit) {\n            this._miterLimit = miterLimit;\n            this.styleID++;\n        }\n    }\n    /**\n     * Occasionally some fonts are cropped. Adding some padding will prevent this from happening\n     * by adding padding to all sides of the text.\n     *\n     * @member {number}\n     */\n    get padding() {\n        return this._padding;\n    }\n    set padding(padding) {\n        if (this._padding !== padding) {\n            this._padding = padding;\n            this.styleID++;\n        }\n    }\n    /**\n     * A canvas fillstyle that will be used on the text stroke\n     * e.g 'blue', '#FCFF00'\n     *\n     * @member {string}\n     */\n    get stroke() {\n        return this._stroke;\n    }\n    set stroke(stroke) {\n        // TODO: Can't have different types for getter and setter. The getter shouldn't have the number type as\n        //       the setter converts to string. See this thread for more details:\n        //       https://github.com/microsoft/TypeScript/issues/2521\n        const outputColor = getColor(stroke);\n        if (this._stroke !== outputColor) {\n            this._stroke = outputColor;\n            this.styleID++;\n        }\n    }\n    /**\n     * A number that represents the thickness of the stroke.\n     * Default is 0 (no stroke)\n     *\n     * @member {number}\n     */\n    get strokeThickness() {\n        return this._strokeThickness;\n    }\n    set strokeThickness(strokeThickness) {\n        if (this._strokeThickness !== strokeThickness) {\n            this._strokeThickness = strokeThickness;\n            this.styleID++;\n        }\n    }\n    /**\n     * The baseline of the text that is rendered.\n     *\n     * @member {string}\n     */\n    get textBaseline() {\n        return this._textBaseline;\n    }\n    set textBaseline(textBaseline) {\n        if (this._textBaseline !== textBaseline) {\n            this._textBaseline = textBaseline;\n            this.styleID++;\n        }\n    }\n    /**\n     * Trim transparent borders\n     *\n     * @member {boolean}\n     */\n    get trim() {\n        return this._trim;\n    }\n    set trim(trim) {\n        if (this._trim !== trim) {\n            this._trim = trim;\n            this.styleID++;\n        }\n    }\n    /**\n     * How newlines and spaces should be handled.\n     * Default is 'pre' (preserve, preserve).\n     *\n     *  value       | New lines     |   Spaces\n     *  ---         | ---           |   ---\n     * 'normal'     | Collapse      |   Collapse\n     * 'pre'        | Preserve      |   Preserve\n     * 'pre-line'   | Preserve      |   Collapse\n     *\n     * @member {string}\n     */\n    get whiteSpace() {\n        return this._whiteSpace;\n    }\n    set whiteSpace(whiteSpace) {\n        if (this._whiteSpace !== whiteSpace) {\n            this._whiteSpace = whiteSpace;\n            this.styleID++;\n        }\n    }\n    /**\n     * Indicates if word wrap should be used\n     *\n     * @member {boolean}\n     */\n    get wordWrap() {\n        return this._wordWrap;\n    }\n    set wordWrap(wordWrap) {\n        if (this._wordWrap !== wordWrap) {\n            this._wordWrap = wordWrap;\n            this.styleID++;\n        }\n    }\n    /**\n     * The width at which text will wrap, it needs wordWrap to be set to true\n     *\n     * @member {number}\n     */\n    get wordWrapWidth() {\n        return this._wordWrapWidth;\n    }\n    set wordWrapWidth(wordWrapWidth) {\n        if (this._wordWrapWidth !== wordWrapWidth) {\n            this._wordWrapWidth = wordWrapWidth;\n            this.styleID++;\n        }\n    }\n    /**\n     * Generates a font style string to use for `TextMetrics.measureFont()`.\n     *\n     * @return {string} Font style string, for passing to `TextMetrics.measureFont()`\n     */\n    toFontString() {\n        // build canvas api font setting from individual components. Convert a numeric this.fontSize to px\n        const fontSizeString = typeof this.fontSize === 'number' ? `${this.fontSize}px` : this.fontSize;\n        // Clean-up fontFamily property by quoting each font name\n        // this will support font names with spaces\n        let fontFamilies = this.fontFamily;\n        if (!Array.isArray(this.fontFamily)) {\n            fontFamilies = this.fontFamily.split(',');\n        }\n        for (let i = fontFamilies.length - 1; i >= 0; i--) {\n            // Trim any extra white-space\n            let fontFamily = fontFamilies[i].trim();\n            // Check if font already contains strings\n            if (!/([\\\"\\'])[^\\'\\\"]+\\1/.test(fontFamily) && genericFontFamilies.indexOf(fontFamily) < 0) {\n                fontFamily = `\"${fontFamily}\"`;\n            }\n            fontFamilies[i] = fontFamily;\n        }\n        return `${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${fontSizeString} ${fontFamilies.join(',')}`;\n    }\n}\nfunction getSingleColor(color) {\n    if (typeof color === 'number') {\n        return StringUtil.convertToHtmlColor(color);\n        // // todo\n        // return color\n    }\n    else if (typeof color === 'string') {\n        if (color.indexOf('0x') === 0) {\n            color = color.replace('0x', '#');\n        }\n    }\n    return color;\n}\nfunction getColor(color) {\n    if (!Array.isArray(color)) {\n        return getSingleColor(color);\n    }\n    else {\n        for (let i = 0; i < color.length; ++i) {\n            color[i] = getSingleColor(color[i]);\n        }\n        return color;\n    }\n}\nfunction areArraysEqual(array1, array2) {\n    if (!Array.isArray(array1) || !Array.isArray(array2)) {\n        return false;\n    }\n    if (array1.length !== array2.length) {\n        return false;\n    }\n    for (let i = 0; i < array1.length; ++i) {\n        if (array1[i] !== array2[i]) {\n            return false;\n        }\n    }\n    return true;\n}\n\nclass UITextField extends createjs.Text {\n    constructor(owner) {\n        super();\n        this.$minHeightID = -1;\n        this.UIOwner = owner;\n        this.style = new TextStyle({});\n        // this.mouseEnabled = false;\n        // this.interactive = this.interactiveChildren = false;\n        // this._texture.noFrame = false;\n        // this._width = this._texture.frame.width;\n        // this._height = this._texture.frame.height;\n        // this.$minHeight = -1;\n        // this._texture.on(\"update\", this.updateFrame, this);\n    }\n    get minHeight() {\n        return this.$minHeight;\n    }\n    applyStyle() {\n        let canvas = Decls$1.GRoot.inst.applicationContext.canvas;\n        this.font = this.style.toFontString();\n        this.color = this.style.fill;\n        let letterSpacing = this.style.letterSpacing;\n        if (letterSpacing) {\n            canvas.style.letterSpacing = `${letterSpacing}px`;\n        }\n        else {\n            canvas.style.letterSpacing = `0px`;\n        }\n        let leading = this.style.leading;\n        if (leading) {\n            this.lineHeight = this.getMeasuredLineHeight() + leading;\n        }\n        else {\n            this.lineHeight = this.getMeasuredLineHeight();\n        }\n        let strokeThickness = this.style.strokeThickness;\n        if (strokeThickness) {\n            if (!this.multiple) {\n                this.multiple = new createjs.Text(this.text, this.font, this.color);\n                this.UIOwner.parent.displayObject.addChild(this.multiple);\n            }\n            this.multiple.outline = strokeThickness;\n            if (this.style.stroke != this.color) {\n                this.multiple.color = this.style.stroke;\n            }\n            this.multiple.lineHeight = this.lineHeight;\n            this.multiple.lineWidth = this.lineWidth;\n        }\n        let shadow = new createjs.Shadow(this.style.dropShadowColor, this.style.dropShadowOffsetX, this.style.dropShadowOffsetY, this.style.dropShadowBlur);\n        this.shadow = shadow;\n        let { x, y, width, height } = this;\n        this.setBounds(x, y, width, height);\n    }\n    /**@internal */\n    $updateMinHeight() {\n        this.$minHeight = this.getMeasuredLineHeight();\n    }\n    // protected updateFrame(): void {\n    //     GTimer.inst.callLater(this.internalUpdateFrame, this);\n    // }\n    // private internalUpdateFrame(): void {\n    // if(this._texture) {\n    //     let frm = this._texture.frame;\n    //     this._height = Math.max(this._height, this.$minHeight);\n    //     let w = frm.x + this._width, h = frm.y + this._height;\n    //     if(w > this._texture.baseTexture.width)\n    //         w = this._texture.baseTexture.width - frm.x;\n    //     if(h > this._texture.baseTexture.height)\n    //         h = this._texture.baseTexture.height - frm.y;\n    //     frm.width = w / this.resolution;\n    //     frm.height = h / this.resolution;\n    //     this._texture.trim.width = frm.width;\n    //     this._texture.trim.height = frm.height;\n    //     let padding = this._style.trim ? 0 : this._style.padding;\n    //     this._texture.trim.x = -padding;\n    //     this._texture.trim.y = -padding;\n    //     this._texture.frame = frm;\n    // }\n    // }\n    //cancel scaling update\n    // protected _onTextureUpdate(): void {\n    // this._textureID = -1;\n    // this._textureTrimmedID = -1;\n    // }\n    get width() {\n        return this.getMetrics()['width'];\n    }\n    set width(v) {\n        this.lineWidth = v;\n        if (this.multiple) {\n            this.multiple.lineWidth = v;\n        }\n    }\n    get height() {\n        return this.lineHeight;\n    }\n    set height(v) {\n        this.lineHeight = v;\n        if (this.multiple) {\n            this.multiple.lineHeight = v;\n        }\n    }\n    get textHeight() {\n        return this.getMeasuredHeight();\n    }\n    set textHeight(v) { }\n    get textWidth() {\n        return this.getMeasuredWidth();\n    }\n    set content(v) {\n        this.text = v;\n        if (this.multiple) {\n            this.multiple.text = v;\n        }\n    }\n    get content() {\n        return this.text;\n    }\n    updateMultiplePosition(x, y) {\n        if (this.multiple) {\n            this.multiple.x = x;\n            this.multiple.y = y;\n        }\n    }\n}\n\nclass TextMetrics {\n    constructor(text, style, width, height, lines, lineWidths, lineHeight, maxLineWidth, fontProperties) {\n        this.text = text;\n        this.style = style;\n        this.width = width;\n        this.height = height;\n        this.lines = lines;\n        this.lineWidths = lineWidths;\n        this.lineHeight = lineHeight;\n        this.maxLineWidth = maxLineWidth;\n        this.fontProperties = fontProperties;\n    }\n    static measureText(text, style, wordWrap, canvas = TextMetrics._canvas) {\n        wordWrap = wordWrap === undefined || wordWrap === null ? style.wordWrap : wordWrap;\n        const font = style.toFontString();\n        const fontProperties = TextMetrics.measureFont(font);\n        // fallback in case UA disallow canvas data extraction\n        // (toDataURI, getImageData functions)\n        if (fontProperties.fontSize === 0) {\n            fontProperties.fontSize = style.fontSize;\n            fontProperties.ascent = style.fontSize;\n        }\n        const context = canvas.getContext('2d');\n        context.font = font;\n        const outputText = wordWrap ? TextMetrics.wordWrap(text, style, canvas) : text;\n        const lines = outputText.split(/(?:\\r\\n|\\r|\\n)/);\n        const lineWidths = new Array(lines.length);\n        let maxLineWidth = 0;\n        for (let i = 0; i < lines.length; i++) {\n            const lineWidth = context.measureText(lines[i]).width + (lines[i].length - 1) * style.letterSpacing;\n            lineWidths[i] = lineWidth;\n            maxLineWidth = Math.max(maxLineWidth, lineWidth);\n        }\n        let width = maxLineWidth + style.strokeThickness;\n        if (style.dropShadow) {\n            width += style.dropShadowDistance;\n        }\n        const lineHeight = style.lineHeight || fontProperties.fontSize + style.strokeThickness;\n        let height = Math.max(lineHeight, fontProperties.fontSize + style.strokeThickness) +\n            (lines.length - 1) * (lineHeight + style.leading);\n        if (style.dropShadow) {\n            height += style.dropShadowDistance;\n        }\n        return new TextMetrics(text, style, width, height, lines, lineWidths, lineHeight + style.leading, maxLineWidth, fontProperties);\n    }\n    static wordWrap(text, style, canvas = TextMetrics._canvas) {\n        const context = canvas.getContext('2d');\n        let width = 0;\n        let line = '';\n        let lines = '';\n        const cache = Object.create(null);\n        const { letterSpacing, whiteSpace } = style;\n        // How to handle whitespaces\n        const collapseSpaces = TextMetrics.collapseSpaces(whiteSpace);\n        const collapseNewlines = TextMetrics.collapseNewlines(whiteSpace);\n        // whether or not spaces may be added to the beginning of lines\n        let canPrependSpaces = !collapseSpaces;\n        const wordWrapWidth = style.wordWrapWidth + letterSpacing;\n        // break text into words, spaces and newline chars\n        const tokens = TextMetrics.tokenize(text);\n        for (let i = 0; i < tokens.length; i++) {\n            // get the word, space or newlineChar\n            let token = tokens[i];\n            // if word is a new line\n            if (TextMetrics.isNewline(token)) {\n                // keep the new line\n                if (!collapseNewlines) {\n                    lines += TextMetrics.addLine(line);\n                    canPrependSpaces = !collapseSpaces;\n                    line = '';\n                    width = 0;\n                    continue;\n                }\n                // if we should collapse new lines\n                // we simply convert it into a space\n                token = ' ';\n            }\n            // if we should collapse repeated whitespaces\n            if (collapseSpaces) {\n                // check both this and the last tokens for spaces\n                const currIsBreakingSpace = TextMetrics.isBreakingSpace(token);\n                const lastIsBreakingSpace = TextMetrics.isBreakingSpace(line[line.length - 1]);\n                if (currIsBreakingSpace && lastIsBreakingSpace) {\n                    continue;\n                }\n            }\n            // get word width from cache if possible\n            const tokenWidth = TextMetrics.getFromCache(token, letterSpacing, cache, context);\n            // word is longer than desired bounds\n            if (tokenWidth > wordWrapWidth) {\n                // if we are not already at the beginning of a line\n                if (line !== '') {\n                    // start newlines for overflow words\n                    lines += TextMetrics.addLine(line);\n                    line = '';\n                    width = 0;\n                }\n                // break large word over multiple lines\n                if (TextMetrics.canBreakWords(token, style.breakWords)) {\n                    // break word into characters\n                    const characters = TextMetrics.wordWrapSplit(token);\n                    // loop the characters\n                    for (let j = 0; j < characters.length; j++) {\n                        let char = characters[j];\n                        let k = 1;\n                        // we are not at the end of the token\n                        while (characters[j + k]) {\n                            const nextChar = characters[j + k];\n                            const lastChar = char[char.length - 1];\n                            // should not split chars\n                            if (!TextMetrics.canBreakChars(lastChar, nextChar, token, j, style.breakWords)) {\n                                // combine chars & move forward one\n                                char += nextChar;\n                            }\n                            else {\n                                break;\n                            }\n                            k++;\n                        }\n                        j += char.length - 1;\n                        const characterWidth = TextMetrics.getFromCache(char, letterSpacing, cache, context);\n                        if (characterWidth + width > wordWrapWidth) {\n                            lines += TextMetrics.addLine(line);\n                            canPrependSpaces = false;\n                            line = '';\n                            width = 0;\n                        }\n                        line += char;\n                        width += characterWidth;\n                    }\n                }\n                // run word out of the bounds\n                else {\n                    // if there are words in this line already\n                    // finish that line and start a new one\n                    if (line.length > 0) {\n                        lines += TextMetrics.addLine(line);\n                        line = '';\n                        width = 0;\n                    }\n                    const isLastToken = i === tokens.length - 1;\n                    // give it its own line if it's not the end\n                    lines += TextMetrics.addLine(token, !isLastToken);\n                    canPrependSpaces = false;\n                    line = '';\n                    width = 0;\n                }\n            }\n            // word could fit\n            else {\n                // word won't fit because of existing words\n                // start a new line\n                if (tokenWidth + width > wordWrapWidth) {\n                    // if its a space we don't want it\n                    canPrependSpaces = false;\n                    // add a new line\n                    lines += TextMetrics.addLine(line);\n                    // start a new line\n                    line = '';\n                    width = 0;\n                }\n                // don't add spaces to the beginning of lines\n                if (line.length > 0 || !TextMetrics.isBreakingSpace(token) || canPrependSpaces) {\n                    // add the word to the current line\n                    line += token;\n                    // update width counter\n                    width += tokenWidth;\n                }\n            }\n        }\n        lines += TextMetrics.addLine(line, false);\n        return lines;\n    }\n    static addLine(line, newLine = true) {\n        line = TextMetrics.trimRight(line);\n        line = newLine ? `${line}\\n` : line;\n        return line;\n    }\n    static getFromCache(key, letterSpacing, cache, context) {\n        let width = cache[key];\n        if (typeof width !== 'number') {\n            const spacing = key.length * letterSpacing;\n            width = context.measureText(key).width + spacing;\n            cache[key] = width;\n        }\n        return width;\n    }\n    static collapseSpaces(whiteSpace) {\n        return whiteSpace === 'normal' || whiteSpace === 'pre-line';\n    }\n    static collapseNewlines(whiteSpace) {\n        return whiteSpace === 'normal';\n    }\n    static trimRight(text) {\n        if (typeof text !== 'string') {\n            return '';\n        }\n        for (let i = text.length - 1; i >= 0; i--) {\n            const char = text[i];\n            if (!TextMetrics.isBreakingSpace(char)) {\n                break;\n            }\n            text = text.slice(0, -1);\n        }\n        return text;\n    }\n    static isNewline(char) {\n        if (typeof char !== 'string') {\n            return false;\n        }\n        return TextMetrics._newlines.indexOf(char.charCodeAt(0)) >= 0;\n    }\n    static isBreakingSpace(char, _nextChar) {\n        if (typeof char !== 'string') {\n            return false;\n        }\n        return TextMetrics._breakingSpaces.indexOf(char.charCodeAt(0)) >= 0;\n    }\n    static tokenize(text) {\n        const tokens = [];\n        let token = '';\n        if (typeof text !== 'string') {\n            return tokens;\n        }\n        for (let i = 0; i < text.length; i++) {\n            const char = text[i];\n            const nextChar = text[i + 1];\n            if (TextMetrics.isBreakingSpace(char, nextChar) || TextMetrics.isNewline(char)) {\n                if (token !== '') {\n                    tokens.push(token);\n                    token = '';\n                }\n                tokens.push(char);\n                continue;\n            }\n            token += char;\n        }\n        if (token !== '') {\n            tokens.push(token);\n        }\n        return tokens;\n    }\n    static canBreakWords(_token, breakWords) {\n        return breakWords;\n    }\n    static canBreakChars(_char, _nextChar, _token, _index, _breakWords) {\n        return true;\n    }\n    static wordWrapSplit(token) {\n        return token.split('');\n    }\n    static measureFont(font) {\n        // as this method is used for preparing assets, don't recalculate things if we don't need to\n        if (TextMetrics._fonts[font]) {\n            return TextMetrics._fonts[font];\n        }\n        const properties = {\n            ascent: 0,\n            descent: 0,\n            fontSize: 0\n        };\n        const canvas = TextMetrics._canvas;\n        const context = TextMetrics._context;\n        context.font = font;\n        const metricsString = TextMetrics.METRICS_STRING + TextMetrics.BASELINE_SYMBOL;\n        const width = Math.ceil(context.measureText(metricsString).width);\n        let baseline = Math.ceil(context.measureText(TextMetrics.BASELINE_SYMBOL).width);\n        const height = 2 * baseline;\n        baseline = (baseline * TextMetrics.BASELINE_MULTIPLIER) | 0;\n        canvas.width = width;\n        canvas.height = height;\n        context.fillStyle = '#f00';\n        context.fillRect(0, 0, width, height);\n        context.font = font;\n        context.textBaseline = 'alphabetic';\n        context.fillStyle = '#000';\n        context.fillText(metricsString, 0, baseline);\n        const imagedata = context.getImageData(0, 0, width, height).data;\n        const pixels = imagedata.length;\n        const line = width * 4;\n        let i = 0;\n        let idx = 0;\n        let stop = false;\n        // ascent. scan from top to bottom until we find a non red pixel\n        for (i = 0; i < baseline; ++i) {\n            for (let j = 0; j < line; j += 4) {\n                if (imagedata[idx + j] !== 255) {\n                    stop = true;\n                    break;\n                }\n            }\n            if (!stop) {\n                idx += line;\n            }\n            else {\n                break;\n            }\n        }\n        properties.ascent = baseline - i;\n        idx = pixels - line;\n        stop = false;\n        // descent. scan from bottom to top until we find a non red pixel\n        for (i = height; i > baseline; --i) {\n            for (let j = 0; j < line; j += 4) {\n                if (imagedata[idx + j] !== 255) {\n                    stop = true;\n                    break;\n                }\n            }\n            if (!stop) {\n                idx -= line;\n            }\n            else {\n                break;\n            }\n        }\n        properties.descent = i - baseline;\n        properties.fontSize = properties.ascent + properties.descent;\n        TextMetrics._fonts[font] = properties;\n        return properties;\n    }\n    /**\n     * Clear font metrics in metrics cache.\n     *\n     * @static\n     * @param {string} [font] - font name. If font name not set then clear cache for all fonts.\n     */\n    static clearMetrics(font = '') {\n        if (font) {\n            delete TextMetrics._fonts[font];\n        }\n        else {\n            TextMetrics._fonts = {};\n        }\n    }\n}\nconst canvas = (() => {\n    try {\n        // OffscreenCanvas2D measureText can be up to 40% faster.\n        const c = new OffscreenCanvas(0, 0);\n        const context = c.getContext('2d');\n        if (context && context.measureText) {\n            return c;\n        }\n        return document.createElement('canvas');\n    }\n    catch (ex) {\n        return document.createElement('canvas');\n    }\n})();\ncanvas.width = canvas.height = 10;\nTextMetrics._canvas = canvas;\nTextMetrics._context = canvas.getContext('2d');\nTextMetrics._fonts = {};\nTextMetrics.METRICS_STRING = '|ÉqÅ';\nTextMetrics.BASELINE_SYMBOL = 'M';\nTextMetrics.BASELINE_MULTIPLIER = 1.4;\nTextMetrics._newlines = [\n    0x000a,\n    0x000d // carriage return\n];\nTextMetrics._breakingSpaces = [\n    0x0009,\n    0x0020,\n    0x2000,\n    0x2001,\n    0x2002,\n    0x2003,\n    0x2004,\n    0x2005,\n    0x2006,\n    0x2008,\n    0x2009,\n    0x200a,\n    0x205f,\n    0x3000 // ideographic space\n];\n\nclass LineInfo {\n    constructor() {\n        this.width = 0;\n        this.height = 0;\n        this.textHeight = 0;\n        this.y = 0;\n    }\n    static get() {\n        if (LineInfo.pool.length) {\n            let ret = LineInfo.pool.pop();\n            ret.width = 0;\n            ret.height = 0;\n            ret.textHeight = 0;\n            ret.text = null;\n            ret.y = 0;\n            return ret;\n        }\n        else\n            return new LineInfo();\n    }\n    static recycle(value) {\n        LineInfo.pool.push(value);\n    }\n    static recycleMany(value) {\n        if (value && value.length) {\n            value.forEach(v => {\n                LineInfo.pool.push(v);\n            }, this);\n        }\n        value.length = 0;\n    }\n}\nLineInfo.pool = [];\nclass GTextField extends GObject {\n    constructor() {\n        super();\n        this.$verticalAlign = 0 /* Top */;\n        this.$offset = new createjs.Point();\n        this.$singleLine = true;\n        this.$text = '';\n        this.$textWidth = 0;\n        this.$textHeight = 0;\n        this.$style = new TextStyle({\n            fontSize: 12,\n            fontFamily: UIConfig.defaultFont,\n            align: \"left\" /* Left */,\n            leading: 3,\n            fill: 0\n        });\n        this.$verticalAlign = 0 /* Top */;\n        this.$text = '';\n        this.$autoSize = 1 /* Both */;\n        this.$widthAutoSize = true;\n        this.$heightAutoSize = true;\n        this.$bitmapPool = [];\n        this.touchable = false; //base GTextField has no interaction\n    }\n    createDisplayObject() {\n        this.$textField = new UITextField(this);\n        this.setDisplayObject(this.$textField);\n    }\n    switchBitmapMode(val) {\n        if (val && this.displayObject == this.$textField) {\n            if (this.$btContainer == null)\n                this.$btContainer = new UIContainer(this);\n            this.switchDisplayObject(this.$btContainer);\n        }\n        else if (!val && this.displayObject == this.$btContainer)\n            this.switchDisplayObject(this.$textField);\n    }\n    dispose() {\n        GTimer.inst.remove(this.$render, this);\n        this.$bitmapFont = null;\n        this.$bitmapPool.length = 0;\n        this.$bitmapPool = null;\n        this.$style = null;\n        super.dispose();\n    }\n    set text(value) {\n        this.setText(value);\n    }\n    setText(value) {\n        if (value == null)\n            value = '';\n        if (this.$text == value)\n            return;\n        this.$text = value;\n        this.updateGear(6 /* Text */);\n        if (this.parent && this.parent.$inProgressBuilding)\n            this.renderNow();\n        else\n            this.render();\n    }\n    get text() {\n        return this.getText();\n    }\n    getText() {\n        return this.$text;\n    }\n    get color() {\n        return this.getColor();\n    }\n    getColor() {\n        return this.$color;\n    }\n    setColor(value) {\n        if (this.$color != value) {\n            this.$color = value;\n            this.updateGear(4 /* Color */);\n            this.$style.fill = this.$color;\n            this.render();\n        }\n    }\n    set color(value) {\n        this.setColor(value);\n    }\n    get titleColor() {\n        return this.color;\n    }\n    set titleColor(value) {\n        this.color = value;\n    }\n    get lineHeight() {\n        if (this.$style.lineHeight > 0)\n            return this.$style.lineHeight;\n        if (!this.$fontProperties)\n            return +this.$style.fontSize + this.$style.strokeThickness; //rough value\n        return this.$fontProperties.fontSize + this.$style.strokeThickness + this.$style.leading;\n    }\n    set lineHeight(lh) {\n        this.$style.lineHeight = lh;\n    }\n    get font() {\n        return this.$font || UIConfig.defaultFont;\n    }\n    set font(value) {\n        if (this.$font != value) {\n            this.$font = value;\n            if (this.$font && StringUtil.startsWith(this.$font, 'ui://'))\n                this.$bitmapFont = UIPackage.getBitmapFontByURL(this.$font);\n            else\n                this.$style.fontFamily = this.$font || UIConfig.defaultFont;\n            this.render();\n        }\n    }\n    get fontSize() {\n        return +this.$style.fontSize;\n    }\n    set fontSize(value) {\n        if (value <= 0)\n            return;\n        if (this.$style.fontSize != value) {\n            this.$style.fontSize = value;\n            this.render();\n        }\n    }\n    get align() {\n        return this.$style.align;\n    }\n    set align(value) {\n        if (this.$style.align != value) {\n            this.$style.align = value;\n            this.render();\n        }\n    }\n    get verticalAlign() {\n        return this.$verticalAlign;\n    }\n    set verticalAlign(value) {\n        if (this.$verticalAlign != value) {\n            this.$verticalAlign = value;\n            if (!this.$inProgressBuilding)\n                this.layoutAlign();\n        }\n    }\n    get leading() {\n        return this.$style.leading;\n    }\n    set leading(value) {\n        if (this.$style.leading != value) {\n            this.$style.leading = value;\n            this.render();\n        }\n    }\n    get letterSpacing() {\n        return this.$style.letterSpacing;\n    }\n    set letterSpacing(value) {\n        if (this.$style.letterSpacing != value) {\n            this.$style.letterSpacing = value;\n            this.render();\n        }\n    }\n    get underline() {\n        return false; //TODO: not supported yet\n    }\n    set underline(value) {\n        //TODO: not supported yet\n    }\n    get bold() {\n        return this.$style.fontWeight == 'bold';\n    }\n    set bold(value) {\n        let v = value === true ? 'bold' : 'normal';\n        if (this.$style.fontWeight != v) {\n            this.$style.fontWeight = v;\n            this.render();\n        }\n    }\n    get weight() {\n        return this.$style.fontWeight;\n    }\n    set weight(v) {\n        if (this.$style.fontWeight != v) {\n            this.$style.fontWeight = v;\n            this.render();\n        }\n    }\n    get variant() {\n        return this.$style.fontVariant;\n    }\n    set variant(v) {\n        if (this.$style.fontVariant != v) {\n            this.$style.fontVariant = v;\n            this.render();\n        }\n    }\n    get italic() {\n        return this.$style.fontStyle == 'italic';\n    }\n    set italic(value) {\n        let v = value === true ? 'italic' : 'normal';\n        if (this.$style.fontStyle != v) {\n            this.$style.fontStyle = v;\n            this.render();\n        }\n    }\n    get multipleLine() {\n        return !this.$singleLine;\n    }\n    set multipleLine(value) {\n        value = !value;\n        if (this.$singleLine != value) {\n            this.$singleLine = value;\n            this.render();\n        }\n    }\n    get stroke() {\n        return +this.$style.strokeThickness;\n    }\n    set stroke(value) {\n        if (this.$style.strokeThickness != value)\n            this.$style.strokeThickness = value;\n    }\n    get strokeColor() {\n        return this.$style.stroke;\n    }\n    set strokeColor(value) {\n        if (this.$style.stroke != value)\n            this.$style.stroke = value;\n    }\n    set autoSize(value) {\n        if (this.$autoSize != value) {\n            this.$autoSize = value;\n            this.$widthAutoSize = value == 1 /* Both */ || value == 3 /* Shrink */;\n            this.$heightAutoSize = value == 1 /* Both */ || value == 2 /* Height */;\n            this.render();\n        }\n    }\n    get autoSize() {\n        return this.$autoSize;\n    }\n    get textWidth() {\n        if (this.$requireRender)\n            this.renderNow();\n        return this.$textWidth;\n    }\n    get textHeight() {\n        if (this.$requireRender)\n            this.renderNow();\n        return this.$textHeight;\n    }\n    ensureSizeCorrect() {\n        if (this.$sizeDirty && this.$requireRender)\n            this.renderNow();\n    }\n    render() {\n        if (!this.$requireRender) {\n            this.$requireRender = true;\n            GTimer.inst.callLater(this.$render, this);\n        }\n        if (!this.$sizeDirty && (this.$widthAutoSize || this.$heightAutoSize)) {\n            this.$sizeDirty = true;\n            let evt = new createjs.Event(\"__sizeDelayChange\" /* SIZE_DELAY_CHANGE */, true, false);\n            this.dispatchEvent(evt, this);\n        }\n    }\n    applyStyle() {\n        this.$textField.style.stroke = this.$style.stroke;\n        this.$textField.style.strokeThickness = this.$style.strokeThickness;\n        this.$textField.style.fontStyle = this.$style.fontStyle;\n        this.$textField.style.fontVariant = this.$style.fontVariant;\n        this.$textField.style.fontWeight = this.$style.fontWeight;\n        this.$textField.style.letterSpacing = this.$style.letterSpacing;\n        this.$textField.style.align = this.$style.align;\n        this.$textField.style.fontSize = this.$style.fontSize;\n        this.$textField.style.fontFamily = this.$style.fontFamily;\n        this.$textField.style.fill = this.$style.fill;\n        this.$textField.style.dropShadowColor = this.$style.dropShadowColor;\n        this.$textField.style.dropShadowOffsetX = this.$style.dropShadowOffsetX;\n        this.$textField.style.dropShadowOffsetY = this.$style.dropShadowOffsetY;\n        this.$textField.style.leading = this.$style.leading;\n        this.$textField.applyStyle();\n    }\n    $render() {\n        if (this.$requireRender)\n            this.renderNow();\n    }\n    renderNow(updateBounds = true) {\n        this.$requireRender = false;\n        this.$sizeDirty = false;\n        if (this.$bitmapFont != null) {\n            this.renderWithBitmapFont(updateBounds);\n            return;\n        }\n        this.switchBitmapMode(false);\n        this.applyStyle();\n        this.$textField.$updateMinHeight();\n        let wordWrap = !this.$widthAutoSize && this.multipleLine;\n        this.$textField.width = this.$textField.style.wordWrapWidth =\n            wordWrap || this.autoSize == 0 /* None */ ? Math.ceil(this.width) : 10000;\n        this.$textField.style.wordWrap = wordWrap;\n        this.$textField.style.breakWords = wordWrap;\n        this.$textField.content = this.$text; //trigger t.dirty = true\n        this.$fontProperties = TextMetrics.measureFont(this.$style.toFontString());\n        this.$textWidth = Math.ceil(this.$textField.textWidth);\n        if (this.$textWidth > 0)\n            this.$textWidth += GTextField.GUTTER_X * 2; //margin gap\n        this.$textHeight = Math.ceil(this.$textField.textHeight);\n        if (this.$textHeight > 0)\n            this.$textHeight += GTextField.GUTTER_Y * 2; //margin gap\n        let w = this.width, h = this.height;\n        if (this.autoSize == 3 /* Shrink */) {\n            this.shrinkTextField();\n        }\n        else {\n            this.$textField.set({ scaleX: 1, scaleY: 1 });\n            if (this.$widthAutoSize) {\n                w = this.$textWidth;\n                this.$textField.width = w;\n            }\n            if (this.$heightAutoSize) {\n                h = this.$textHeight;\n                if (this.$textField.height != this.$textHeight)\n                    this.$textField.height = this.$textHeight;\n            }\n            else {\n                h = this.height;\n                if (this.$textHeight > h)\n                    this.$textHeight = h;\n            }\n        }\n        if (updateBounds) {\n            this.$updatingSize = true;\n            this.setSize(w, h);\n            this.$updatingSize = false;\n        }\n        this.layoutAlign();\n    }\n    renderWithBitmapFont(updateBounds) {\n        this.switchBitmapMode(true);\n        /**\n         * todo\n         */\n        this.$btContainer.children.forEach((c, i) => {\n            this.$bitmapPool.push(this.$btContainer.getChildAt(i));\n        }, this);\n        this.$btContainer.removeAllChildren();\n        if (!this.$lines)\n            this.$lines = [];\n        else\n            LineInfo.recycleMany(this.$lines);\n        let letterSpacing = this.letterSpacing;\n        let lineSpacing = this.leading - 1;\n        let rectWidth = this.width - GTextField.GUTTER_X * 2;\n        let lineWidth = 0, lineHeight = 0, lineTextHeight = 0;\n        let glyphWidth = 0, glyphHeight = 0;\n        let wordChars = 0, wordStart = 0, wordEnd = 0;\n        let lastLineHeight = 0;\n        let lineBuffer = '';\n        let lineY = GTextField.GUTTER_Y;\n        let line;\n        let wordWrap = !this.$widthAutoSize && this.multipleLine;\n        let fontScale = this.$bitmapFont.resizable ? this.fontSize / this.$bitmapFont.size : 1;\n        let glyph;\n        this.$textWidth = 0;\n        this.$textHeight = 0;\n        let textLength = this.text.length;\n        for (let offset = 0; offset < textLength; ++offset) {\n            let ch = this.$text.charAt(offset);\n            let cc = ch.charCodeAt(offset);\n            if (ch == '\\n') {\n                lineBuffer += ch;\n                line = LineInfo.get();\n                line.width = lineWidth;\n                if (lineTextHeight == 0) {\n                    if (lastLineHeight == 0)\n                        lastLineHeight = Math.ceil(this.fontSize * fontScale);\n                    if (lineHeight == 0)\n                        lineHeight = lastLineHeight;\n                    lineTextHeight = lineHeight;\n                }\n                line.height = lineHeight;\n                lastLineHeight = lineHeight;\n                line.textHeight = lineTextHeight;\n                line.text = lineBuffer;\n                line.y = lineY;\n                lineY += line.height + lineSpacing;\n                if (line.width > this.$textWidth)\n                    this.$textWidth = line.width;\n                this.$lines.push(line);\n                lineBuffer = '';\n                lineWidth = 0;\n                lineHeight = 0;\n                lineTextHeight = 0;\n                wordChars = 0;\n                wordStart = 0;\n                wordEnd = 0;\n                continue;\n            }\n            if (cc > 256 || cc <= 32) {\n                if (wordChars > 0)\n                    wordEnd = lineWidth;\n                wordChars = 0;\n            }\n            else {\n                if (wordChars == 0)\n                    wordStart = lineWidth;\n                wordChars++;\n            }\n            if (ch == ' ') {\n                glyphWidth = Math.ceil(this.fontSize / 2);\n                glyphHeight = Math.ceil(this.fontSize);\n            }\n            else {\n                glyph = this.$bitmapFont.glyphs[ch];\n                if (glyph) {\n                    glyphWidth = Math.ceil(glyph.advance * fontScale);\n                    glyphHeight = Math.ceil(glyph.lineHeight * fontScale);\n                }\n                else if (ch == ' ') {\n                    glyphWidth = Math.ceil((this.$bitmapFont.size * fontScale) / 2);\n                    glyphHeight = Math.ceil(this.$bitmapFont.size * fontScale);\n                }\n                else {\n                    glyphWidth = 0;\n                    glyphHeight = 0;\n                }\n            }\n            if (glyphHeight > lineTextHeight)\n                lineTextHeight = glyphHeight;\n            if (glyphHeight > lineHeight)\n                lineHeight = glyphHeight;\n            if (lineWidth != 0)\n                lineWidth += letterSpacing;\n            lineWidth += glyphWidth;\n            if (!wordWrap || lineWidth <= rectWidth) {\n                lineBuffer += ch;\n            }\n            else {\n                line = LineInfo.get();\n                line.height = lineHeight;\n                line.textHeight = lineTextHeight;\n                if (lineBuffer.length == 0) {\n                    //the line cannt fit even a char\n                    line.text = ch;\n                }\n                else if (wordChars > 0 && wordEnd > 0) {\n                    //if word had broken, move it to new line\n                    lineBuffer += ch;\n                    let len = lineBuffer.length - wordChars;\n                    line.text = StringUtil.trimRight(lineBuffer.substr(0, len));\n                    line.width = wordEnd;\n                    lineBuffer = lineBuffer.substr(len + 1);\n                    lineWidth -= wordStart;\n                }\n                else {\n                    line.text = lineBuffer;\n                    line.width = lineWidth - (glyphWidth + letterSpacing);\n                    lineBuffer = ch;\n                    lineWidth = glyphWidth;\n                    lineHeight = glyphHeight;\n                    lineTextHeight = glyphHeight;\n                }\n                line.y = lineY;\n                lineY += line.height + lineSpacing;\n                if (line.width > this.$textWidth)\n                    this.$textWidth = line.width;\n                wordChars = 0;\n                wordStart = 0;\n                wordEnd = 0;\n                this.$lines.push(line);\n            }\n        }\n        if (lineBuffer.length > 0 ||\n            (this.$lines.length > 0 &&\n                StringUtil.endsWith(this.$lines[this.$lines.length - 1].text, '\\n'))) {\n            line = LineInfo.get();\n            line.width = lineWidth;\n            if (lineHeight == 0)\n                lineHeight = lastLineHeight;\n            if (lineTextHeight == 0)\n                lineTextHeight = lineHeight;\n            line.height = lineHeight;\n            line.textHeight = lineTextHeight;\n            line.text = lineBuffer;\n            line.y = lineY;\n            if (line.width > this.$textWidth)\n                this.$textWidth = line.width;\n            this.$lines.push(line);\n        }\n        if (this.$textWidth > 0)\n            this.$textWidth += GTextField.GUTTER_X * 2;\n        let count = this.$lines.length;\n        if (count == 0) {\n            this.$textHeight = 0;\n        }\n        else {\n            line = this.$lines[this.$lines.length - 1];\n            this.$textHeight = line.y + line.height + GTextField.GUTTER_Y;\n        }\n        let w, h = 0;\n        if (this.$widthAutoSize) {\n            if (this.$textWidth == 0)\n                w = 0;\n            else\n                w = this.$textWidth;\n        }\n        else\n            w = this.width;\n        if (this.$heightAutoSize) {\n            if (this.$textHeight == 0)\n                h = 0;\n            else\n                h = this.$textHeight;\n        }\n        else\n            h = this.height;\n        if (updateBounds) {\n            this.$updatingSize = true;\n            this.setSize(w, h);\n            this.$updatingSize = false;\n        }\n        if (w == 0 || h == 0)\n            return;\n        rectWidth = this.width - GTextField.GUTTER_X * 2;\n        this.$lines.forEach(line => {\n            let charX = GTextField.GUTTER_X;\n            let lineIndent = 0;\n            let charIndent = 0;\n            if (this.align == \"center\" /* Center */)\n                lineIndent = (rectWidth - line.width) / 2;\n            else if (this.align == \"right\" /* Right */)\n                lineIndent = rectWidth - line.width;\n            else\n                lineIndent = 0;\n            textLength = line.text.length;\n            for (let j = 0; j < textLength; j++) {\n                let ch = line.text.charAt(j);\n                glyph = this.$bitmapFont.glyphs[ch];\n                if (glyph != null) {\n                    charIndent = (line.height + line.textHeight) / 2 - Math.ceil(glyph.lineHeight * fontScale);\n                    let bm;\n                    if (this.$bitmapPool.length)\n                        bm = this.$bitmapPool.pop();\n                    else\n                        bm = new Bitmap();\n                    bm.x = charX + lineIndent + Math.ceil(glyph.offsetX * fontScale);\n                    bm.y = line.y + charIndent + Math.ceil(glyph.offsetY * fontScale);\n                    bm.texture = glyph.texture.image;\n                    bm.textureRect = glyph.texture.rect;\n                    let { x, y, width, height } = glyph;\n                    bm.sourceRect = new createjs.Rectangle(x, y, width, height);\n                    bm.set({ scaleX: fontScale, scaleY: fontScale });\n                    bm.tint = this.$bitmapFont.colorable === true ? this.$color : '0xFFFFFF';\n                    this.$btContainer.addChild(bm);\n                    charX += letterSpacing + Math.ceil(glyph.advance * fontScale);\n                }\n                else if (ch == ' ') {\n                    charX += letterSpacing + Math.ceil((this.$bitmapFont.size * fontScale) / 2);\n                }\n                else {\n                    charX += letterSpacing;\n                }\n            }\n        });\n    }\n    localToGlobal(ax = 0, ay = 0, resultPoint) {\n        ax -= this.$offset.x;\n        ay -= this.$offset.y;\n        return super.localToGlobal(ax, ay, resultPoint);\n    }\n    globalToLocal(ax = 0, ay = 0, resultPoint) {\n        let r = super.globalToLocal(ax, ay, resultPoint);\n        r.x -= this.$offset.x;\n        r.y -= this.$offset.y;\n        return r;\n    }\n    handleSizeChanged() {\n        if (this.$updatingSize)\n            return;\n        if (this.$bitmapFont != null) {\n            if (!this.$widthAutoSize)\n                this.render();\n        }\n        else {\n            if (this.$inProgressBuilding) {\n                this.$textField.width = this.width;\n                this.$textField.height = this.height;\n            }\n            else {\n                if (this.$autoSize == 3 /* Shrink */)\n                    this.shrinkTextField();\n                else {\n                    if (!this.$widthAutoSize) {\n                        if (!this.$heightAutoSize) {\n                            this.$textField.width = this.width;\n                            this.$textField.height = this.height;\n                        }\n                        else\n                            this.$textField.width = this.width;\n                    }\n                }\n            }\n        }\n        this.layoutAlign();\n    }\n    shrinkTextField() {\n        let fitScale = Math.min(1, this.width / this.$textWidth);\n        this.$textField.set({ scaleX: fitScale, scaleY: fitScale });\n    }\n    layoutAlign() {\n        let tw = this.$textWidth, th = this.$textHeight;\n        if (this.autoSize == 3 /* Shrink */) {\n            tw *= this.displayObject.scaleX;\n            th *= this.displayObject.scaleY;\n        }\n        if (this.$verticalAlign == 0 /* Top */ || th == 0)\n            this.$offset.y = GTextField.GUTTER_Y;\n        else {\n            let dh = Math.max(0, this.height - th);\n            if (this.$verticalAlign == 1 /* Middle */)\n                this.$offset.y = dh * 0.5;\n            else if (this.$verticalAlign == 2 /* Bottom */)\n                this.$offset.y = dh;\n        }\n        let xPos = 0;\n        switch (this.$style.align) {\n            case 'center':\n                xPos = (this.width - tw) * 0.5;\n                break;\n            case 'right':\n                xPos = this.width - tw;\n                break;\n        }\n        this.$offset.x = xPos;\n        this.updatePosition();\n    }\n    updatePosition() {\n        let x = Math.floor(this.x + this.$offset.x);\n        let y = Math.floor(this.y + this.$offset.y);\n        this.displayObject.set({ x, y });\n        this.$textField.updateMultiplePosition(x, y);\n    }\n    handleXYChanged() {\n        super.handleXYChanged();\n        if (this.$displayObject)\n            this.updatePosition();\n    }\n    setupBeforeAdd(xml) {\n        super.setupBeforeAdd(xml);\n        let str = xml.attributes.font;\n        if (str)\n            this.font = str;\n        str = xml.attributes.vAlign;\n        if (str)\n            this.verticalAlign = ParseVertAlignType(str);\n        str = xml.attributes.leading;\n        if (str)\n            this.$style.leading = parseInt(str);\n        str = xml.attributes.letterSpacing;\n        if (str)\n            this.$style.letterSpacing = parseInt(str);\n        str = xml.attributes.fontSize;\n        if (str)\n            this.$style.fontSize = parseInt(str);\n        str = xml.attributes.color;\n        if (str) {\n            this.color = str;\n        }\n        str = xml.attributes.shadowColor;\n        if (str) {\n            this.$style.dropShadowColor = str;\n        }\n        let arr;\n        str = xml.attributes.shadowOffset;\n        if (str) {\n            arr = str.split(',');\n            if (arr.length > 1) {\n                this.$style.dropShadowOffsetX = parseInt(arr[0]);\n                this.$style.dropShadowOffsetY = parseInt(arr[1]);\n            }\n        }\n        str = xml.attributes.align;\n        if (str)\n            this.align = ParseAlignType(str);\n        str = xml.attributes.autoSize;\n        if (str) {\n            this.autoSize = ParseAutoSizeType(str);\n            this.$widthAutoSize =\n                this.$autoSize == 1 /* Both */ || this.$autoSize == 3 /* Shrink */;\n            this.$heightAutoSize =\n                this.$autoSize == 1 /* Both */ || this.$autoSize == 2 /* Height */;\n        }\n        this.underline = xml.attributes.underline == 'true';\n        this.italic = xml.attributes.italic == 'true';\n        this.bold = xml.attributes.bold == 'true';\n        this.multipleLine = xml.attributes.singleLine != 'true';\n        str = xml.attributes.strokeColor;\n        if (str) {\n            this.strokeColor = str;\n            str = xml.attributes.strokeSize;\n            if (str)\n                this.stroke = parseInt(str);\n            else\n                this.stroke = 1;\n        }\n    }\n    setupAfterAdd(xml) {\n        super.setupAfterAdd(xml);\n        let str = xml.attributes.text;\n        if (str != null && str.length > 0)\n            this.text = str;\n        this.$sizeDirty = false;\n    }\n}\nGTextField.GUTTER_X = 2;\nGTextField.GUTTER_Y = 2;\n\n//TOOD: impl\nclass GRichTextField extends GTextField {\n    constructor() {\n        super();\n        // this.$textField.interactive = true;\n        // this.$textField.interactiveChildren = false;\n        this.on(\"__linkClick\" /* LinkClick */, this.$clickLink, this);\n    }\n    set ubbEnabled(value) {\n        if (this.$ubbEnabled != value) {\n            this.$ubbEnabled = value;\n            this.render();\n        }\n    }\n    get ubbEnabled() {\n        return this.$ubbEnabled;\n    }\n    setupBeforeAdd(xml) {\n        super.setupBeforeAdd(xml);\n        this.$ubbEnabled = xml.attributes.ubb == 'true';\n    }\n    set textFlow(flow) {\n        this.$textFlow = flow;\n        this.render();\n    }\n    set text(value) {\n        this.$text = value;\n        if (this.$text == null)\n            this.$text = '';\n        this.$textField.width = this.width;\n        // if(this.$ubbEnabled)\n        // this.textFlow = StringUtil.parseUBB(this.$text);   //TODO: parser impl\n        this.updateGear(6 /* Text */);\n        this.render();\n    }\n    $clickLink(block) {\n        let event = new createjs.Event(\"__linkClick\" /* LinkClick */, true, false);\n        event.data = block.text;\n        this.dispatchEvent(event, this);\n    }\n    dispose() {\n        this.off(\"__linkClick\" /* LinkClick */, this.$clickLink);\n        super.dispose();\n    }\n}\n\nclass InputElement extends createjs.EventDispatcher {\n    constructor(tf) {\n        super();\n        this.$requestToShow = false;\n        //private $requestToHide:boolean = false;\n        this.inputElement = null;\n        this.inputDiv = null;\n        this.$scaleX = 0;\n        this.$scaleY = 0;\n        this.textValue = '';\n        this.colorValue = '0xffffff';\n        this.$attrsCache = {};\n        this.$textfield = tf;\n    }\n    /**@internal */\n    $addToStage() {\n        this.htmlInput = HTMLInput.inst; //take multiple canvas on webpage into account?\n    }\n    initElement() {\n        let point = this.$textfield.localToGlobal(0, 0);\n        let x = point.x;\n        let y = point.y;\n        let scaleX = this.htmlInput.$scaleX;\n        let scaleY = this.htmlInput.$scaleY;\n        if (!this.$textfield.multipleLine)\n            this.inputElement.style.top = -this.$textfield.leading * scaleY + 'px';\n        this.inputDiv.style.top = (y + 1) * scaleY + 'px';\n        this.inputDiv.style.left = x * scaleX + 'px';\n        let node = this.$textfield;\n        let cX = 1;\n        let cY = 1;\n        let rotation = 0;\n        while (node.parent) {\n            cX *= node.scaleX;\n            cY *= node.scaleY;\n            rotation += node.rotation;\n            node = node.parent;\n        }\n        let style = this.inputDiv.style;\n        style.transform = style.webkitTransform = style.msTransform = style.mozTransform = style.oTransform =\n            'rotate(' + rotation + 'deg)';\n        this.$scaleX = scaleX * cX;\n        this.$scaleY = scaleY * cY;\n    }\n    get textField() {\n        return this.$textfield;\n    }\n    /**@internal */\n    $show() {\n        if (!this.htmlInput.isCurrentInput(this)) {\n            this.inputElement = this.htmlInput.requestInput(this);\n            if (!this.$textfield.multipleLine)\n                this.inputElement.type = this.$textfield.type;\n            for (let key in this.$attrsCache)\n                this.inputElement.setAttribute(key, this.$attrsCache[key]);\n            this.inputDiv = this.htmlInput.$wrapper;\n        }\n        else\n            this.inputElement.onblur = null;\n        this.htmlInput.$requestToShow = true;\n        this.$requestToShow = true;\n        this.initElement();\n    }\n    $hide() { }\n    onBlurHandler() {\n        this.htmlInput.clearInputElement();\n        this.htmlInput.clearAttributes(this.$attrsCache);\n        window.scrollTo(0, 0);\n    }\n    get text() {\n        if (!this.textValue)\n            this.textValue = '';\n        return this.textValue;\n    }\n    set text(value) {\n        this.textValue = value;\n        if (this.inputElement)\n            this.inputElement.value = this.textValue;\n    }\n    setColor(value) {\n        this.colorValue = value;\n        if (this.inputElement)\n            this.setElementStyle('color', StringUtil.HEX2RGB(this.colorValue));\n    }\n    /**@internal */\n    $onBlur() {\n        // this.dispatchEvent(\"updateText\");\n    }\n    onInputHandler() {\n        window.setTimeout(() => {\n            if (this.inputElement && this.inputElement.selectionStart == this.inputElement.selectionEnd) {\n                this.textValue = this.inputElement.value;\n                this.dispatchEvent('updateText');\n            }\n        }, 0);\n    }\n    setAreaHeight() {\n        let tf = this.$textfield;\n        if (tf.multipleLine) {\n            let textheight = tf.textHeight;\n            if (tf.height <= tf.fontSize) {\n                this.setElementStyle('height', tf.fontSize * this.$scaleY + 'px');\n                this.setElementStyle('padding', '0px');\n                this.setElementStyle('lineHeight', tf.lineHeight * this.$scaleY + 'px');\n            }\n            else if (tf.height < textheight) {\n                this.setElementStyle('height', tf.height * this.$scaleY + 'px');\n                this.setElementStyle('padding', '0px');\n                this.setElementStyle('lineHeight', tf.lineHeight * this.$scaleY + 'px');\n            }\n            else {\n                this.setElementStyle('height', (textheight + tf.leading) * this.$scaleY + 'px');\n                let rap = (tf.height - textheight) * this.$scaleY;\n                let valign = this.getVAlignFactor(tf);\n                let top = rap * valign;\n                let bottom = rap - top;\n                this.setElementStyle('padding', top + 'px 0px ' + bottom + 'px 0px');\n                this.setElementStyle('lineHeight', tf.lineHeight * this.$scaleY + 'px');\n            }\n        }\n    }\n    getVAlignFactor(textfield) {\n        let vao = 0;\n        switch (textfield.verticalAlign) {\n            case 0 /* Top */:\n                break;\n            case 1 /* Middle */:\n                vao = 0.5;\n                break;\n            case 2 /* Bottom */:\n                vao = 1;\n                break;\n        }\n        return vao;\n    }\n    onClickHandler(e) {\n        if (this.$requestToShow) {\n            //e.stopImmediatePropagation();\n            this.$requestToShow = false;\n            this.inputElement.value = this.text;\n            if (this.inputElement.onblur == null)\n                this.inputElement.onblur = Binder.create(this.onBlurHandler, this);\n            this.resetInput();\n            if (this.$textfield.maxLength > 0)\n                this.inputElement.setAttribute('maxlength', String(this.$textfield.maxLength));\n            else\n                this.inputElement.removeAttribute('maxlength');\n            this.inputElement.selectionStart = this.inputElement.value.length;\n            this.inputElement.selectionEnd = this.inputElement.value.length;\n            this.inputElement.focus();\n            let evt = new createjs.Event(\"__focusChanged\" /* CHANGED */, true, false);\n            evt.data = 'focus';\n            this.dispatchEvent(evt);\n        }\n    }\n    onDisconnect() {\n        this.inputElement = null;\n        let evt = new createjs.Event(\"__focusChanged\" /* CHANGED */, true, false);\n        evt.data = 'blur';\n        this.dispatchEvent(evt);\n    }\n    setElementStyle(style, value) {\n        if (value == null)\n            return;\n        if (this.inputElement) {\n            let ss = this.inputElement.style;\n            ss[style] = value;\n        }\n    }\n    setAttribute(name, value) {\n        if (name == null || value == null)\n            return;\n        this.$attrsCache[name] = value;\n    }\n    getAttribute(name) {\n        return this.$attrsCache[name];\n    }\n    /**@internal */\n    $removeFromStage() {\n        if (this.inputElement)\n            this.htmlInput.disconnect(this);\n    }\n    resetInput() {\n        if (this.inputElement) {\n            let textfield = this.$textfield;\n            this.setElementStyle('fontFamily', textfield.font);\n            this.setElementStyle('fontStyle', textfield.italic ? 'italic' : 'normal');\n            this.setElementStyle('fontWeight', textfield.bold ? 'bold' : 'normal');\n            this.setElementStyle('textAlign', textfield.align);\n            this.setElementStyle('fontSize', textfield.fontSize * this.$scaleY + 'px');\n            this.setElementStyle('color', StringUtil.convertToHtmlColor(+textfield.color));\n            this.setElementStyle('width', textfield.width * this.$scaleX + 'px'); //take 'maxWidth' into account\n            let va = 'middle', vao = 0;\n            switch (textfield.verticalAlign) {\n                case 0 /* Top */:\n                    va = 'top';\n                    break;\n                case 1 /* Middle */:\n                    va = 'middle';\n                    vao = 0.5;\n                    break;\n                case 2 /* Bottom */:\n                    va = 'bottom';\n                    vao = 1;\n                    break;\n            }\n            this.setElementStyle('verticalAlign', va);\n            if (textfield.multipleLine)\n                this.setAreaHeight();\n            else {\n                this.setElementStyle('lineHeight', textfield.lineHeight * this.$scaleY + 'px');\n                if (textfield.height < textfield.fontSize) {\n                    this.setElementStyle('height', textfield.fontSize * this.$scaleY + 'px');\n                    this.setElementStyle('padding', '0px 0px ' + textfield.fontSize * 0.5 * this.$scaleX + 'px 0px');\n                }\n                else {\n                    this.setElementStyle('height', textfield.fontSize * this.$scaleY + 'px');\n                    let rap = (textfield.height - textfield.fontSize) * this.$scaleY;\n                    let top = rap * vao;\n                    let bottom = rap - top, fsy = textfield.fontSize * 0.5 * this.$scaleY;\n                    if (bottom < fsy)\n                        bottom = fsy;\n                    this.setElementStyle('padding', top + 'px 0px ' + bottom + 'px 0px');\n                }\n            }\n            this.inputDiv.style.clip =\n                'rect(0px ' +\n                    textfield.width * this.$scaleX +\n                    'px ' +\n                    textfield.height * this.$scaleY +\n                    'px 0px)';\n            this.inputDiv.style.height = textfield.height * this.$scaleY + 'px';\n            this.inputDiv.style.width = textfield.width * this.$scaleX + 'px'; //take 'maxWidth' into account\n        }\n    }\n}\n\nclass InputDelegate {\n    constructor(tf) {\n        this.$inited = false;\n        this.$restrictString = null;\n        this.$restrictRegex = null;\n        this.$focused = false;\n        this.$textField = tf;\n        this.$input = new InputElement(tf);\n    }\n    initialize() {\n        if (this.$inited)\n            return;\n        this.$input.$addToStage();\n        this.$input.on('updateText', this.updateText, this);\n        this.$input.on(\"__focusChanged\" /* CHANGED */, this.focusHandler, this);\n        this.$textField.on(InteractiveEvents.Down, this.textFieldDownHandler, this);\n        this.$inited = true;\n    }\n    textFieldDownHandler() {\n        this.$onFocus();\n    }\n    destroy() {\n        if (!this.$inited)\n            return;\n        this.$input.$removeFromStage();\n        this.$textField.off(InteractiveEvents.Down, this.textFieldDownHandler);\n        GRoot.inst.off(InteractiveEvents.Down, this.onStageDown);\n        this.$input.off('updateText', this.updateText);\n        this.$input.off(\"__focusChanged\" /* CHANGED */, this.focusHandler);\n        this.$inited = false;\n    }\n    get text() {\n        return this.$input.text;\n    }\n    set text(v) {\n        this.$input.text = v;\n    }\n    setColor(v) {\n        return this.$input.setColor(v);\n    }\n    updateText() {\n        let textValue = this.$input.text;\n        let isChanged = false;\n        if (this.$restrictRegex != null) {\n            let result = textValue.match(this.$restrictRegex);\n            if (result)\n                textValue = result.join('');\n            else\n                textValue = '';\n            isChanged = true;\n        }\n        if (isChanged && this.$input.text != textValue)\n            this.$input.text = textValue;\n        this.$textField.text = this.$input.text;\n        let evt = new createjs.Event(\"__textChange\" /* Change */, true, false);\n        evt.data = { textField: this.$textField };\n        this.$textField.dispatchEvent(evt, this);\n    }\n    onStageDown(e) {\n        let target = GObject.castFromNativeObject(e.currentTarget);\n        if (target != this.$textField)\n            this.$input.$hide();\n    }\n    focusHandler(evt) {\n        let { data } = evt;\n        if (data == 'focus') {\n            if (!this.$focused) {\n                this.$focused = true;\n                this.$textField.$isTyping = true;\n                this.$textField.alpha = 0.01;\n                this.$textField.dispatchEvent(\"__focusChanged\" /* CHANGED */, 'focus');\n                this.$textField.dispatchEvent(\"__textFocusIn\" /* FocusIn */, this.$textField);\n            }\n        }\n        else if (data == 'blur') {\n            if (this.$focused) {\n                this.$focused = false;\n                GRoot.inst.off(InteractiveEvents.Down, this.onStageDown);\n                this.$textField.$isTyping = false;\n                this.$textField.alpha = 1;\n                this.$input.$onBlur();\n                this.$textField.dispatchEvent(\"__focusChanged\" /* CHANGED */, 'blur');\n                this.$textField.dispatchEvent(\"__textFocusOut\" /* FocusOut */, this.$textField);\n            }\n        }\n    }\n    get isFocused() {\n        return this.$focused;\n    }\n    /**@internal */\n    $getProperty(name) {\n        return (this.$inited && this.$input.getAttribute(name)) || null;\n    }\n    /**@internal */\n    $setProperty(name, value) {\n        if (!this.$inited)\n            return;\n        this.$input.setAttribute(name, value);\n    }\n    get $restrict() {\n        return this.$restrictString;\n    }\n    set $restrict(v) {\n        this.$restrictString = v;\n        if (this.$restrictString != null && this.$restrictString.length > 0)\n            this.$restrictRegex = new RegExp(this.$restrictString);\n        else\n            this.$restrictRegex = null;\n    }\n    get type() {\n        return this.$type;\n    }\n    set type(v) {\n        if (v != this.$type)\n            this.$type = v;\n    }\n    tryHideInput() {\n        if (!this.$textField.visible && this.$input)\n            this.$input.$removeFromStage();\n    }\n    /**@internal */\n    $updateProperties() {\n        if (this.isFocused) {\n            this.$input.resetInput();\n            this.tryHideInput();\n            return;\n        }\n        this.$input.text = this.$textField.text;\n        this.$input.resetInput();\n        this.tryHideInput();\n    }\n    /**@internal */\n    $onFocus() {\n        if (!this.$textField.visible || this.$focused)\n            return;\n        GRoot.inst.off(InteractiveEvents.Down, this.onStageDown);\n        GTimer.inst.callLater(() => {\n            GRoot.inst.on(InteractiveEvents.Down, this.onStageDown, this);\n        }, this);\n        this.$input.$show();\n    }\n}\n\nclass GTextInput extends GTextField {\n    constructor() {\n        super();\n        this.$util = null;\n        /**@internal */\n        this.$isTyping = false;\n        this.focusable = true;\n        this.editable = true; //init\n        this.type = \"text\" /* TEXT */;\n        this.on('removed', this.removed, this);\n        this.on('added', this.added, this);\n        this.$util.initialize();\n    }\n    createDisplayObject() {\n        super.createDisplayObject();\n        this.$hitArea = new createjs.Shape();\n        this.$hitArea.graphics.beginFill('#000').drawRect(0, 0, this.$width, this.$height);\n        this.$displayObject.hitArea = this.$hitArea;\n    }\n    handleSizeChanged() {\n        super.handleSizeChanged();\n        this.$hitArea.graphics.drawRect(0, 0, this.$width, this.$height);\n        this.$displayObject.hitArea = this.$hitArea;\n    }\n    removed(disp) {\n        if (this.$util)\n            this.$util.destroy();\n    }\n    added(disp) {\n        if (this.$util)\n            this.$util.initialize();\n    }\n    requestFocus() {\n        //tab or call actively\n        Decls$1.GRoot.inst.focus = this;\n        this.$util.$onFocus();\n    }\n    get editable() {\n        return this.$editable;\n    }\n    set editable(v) {\n        if (v != this.$editable) {\n            this.$editable = v;\n            if (this.$editable) {\n                if (!this.$util)\n                    this.$util = new InputDelegate(this);\n                this.$util.initialize();\n            }\n            else {\n                if (this.$util)\n                    this.$util.destroy();\n            }\n            this.touchable = this.$editable;\n        }\n    }\n    changeToPassText(text) {\n        let passText = '';\n        for (let i = 0, num = text.length; i < num; i++) {\n            switch (text.charAt(i)) {\n                case '\\n':\n                    passText += '\\n';\n                    break;\n                case '\\r':\n                    break;\n                default:\n                    passText += '*';\n            }\n        }\n        return passText;\n    }\n    getText() {\n        return this.$util.text;\n    }\n    setText(value) {\n        if (value == null)\n            value = '';\n        if (this.$text == value)\n            return;\n        this.$util.text = value;\n        super.setText(value);\n    }\n    setColor(value) {\n        super.setColor(value);\n        this.$util.setColor(value);\n    }\n    get promptText() {\n        return this.$util.$getProperty('placeholder');\n    }\n    set promptText(v) {\n        if (v == null)\n            v = '';\n        this.$util.$setProperty('placeholder', v);\n    }\n    get maxLength() {\n        return parseInt(this.$util.$getProperty('maxlength')) || 0;\n    }\n    set maxLength(v) {\n        this.$util.$setProperty('maxlength', String(v));\n    }\n    get restrict() {\n        return this.$util.$restrict;\n    }\n    set restrict(v) {\n        this.$util.$restrict = v;\n    }\n    get password() {\n        return this.type == \"password\" /* PASSWORD */;\n    }\n    set password(v) {\n        this.type = \"password\" /* PASSWORD */;\n    }\n    get type() {\n        return this.$util.type;\n    }\n    set type(t) {\n        this.$util.type = t;\n    }\n    dispose() {\n        super.dispose();\n        this.off('removed', this.removed);\n        this.off('added', this.added);\n        this.$util.destroy();\n        this.$util = null;\n    }\n    renderNow(updateBounds = true) {\n        this.$requireRender = false;\n        this.$sizeDirty = false;\n        this.$util.$updateProperties();\n        if (this.$isTyping)\n            this.decorateInputbox();\n        let origText = this.$text;\n        if (this.type == \"password\" /* PASSWORD */)\n            this.$text = this.changeToPassText(this.$text);\n        super.renderNow(updateBounds);\n        this.$text = origText;\n    }\n    decorateInputbox() {\n        //draw underlines?\n    }\n    setupBeforeAdd(xml) {\n        super.setupBeforeAdd(xml);\n        //this.promptText = xml.attributes.prompt;  //this will be available once UBB has implemented.\n        var str = xml.attributes.maxLength;\n        if (str != null)\n            this.maxLength = parseInt(str);\n        str = xml.attributes.restrict;\n        if (str != null)\n            this.restrict = str;\n        str = xml.attributes.password;\n        if (str == 'true')\n            this.password = true;\n        else {\n            str = xml.attributes.keyboardType;\n            if (str == '4')\n                this.type = \"number\" /* NUMBER */;\n            else if (str == '3')\n                this.type = \"url\" /* URL */;\n            else if (str == '5')\n                this.type = \"tel\" /* TEL */;\n            else if (str == '6')\n                this.type = \"email\" /* EMAIL */;\n        }\n    }\n}\n\nclass Recycler {\n    constructor() {\n        this.$count = 0;\n        this.$pool = {};\n    }\n    get count() {\n        return this.$count;\n    }\n    clear() {\n        for (let key in this.$pool) {\n            let arr = this.$pool[key];\n            if (arr) {\n                arr.length = 0;\n                arr = null;\n            }\n        }\n        this.$pool = {};\n        this.$count = 0;\n    }\n    get(id) {\n        let arr = this.$pool[id];\n        if (arr == null) {\n            arr = [];\n            this.$pool[id] = arr;\n        }\n        if (arr.length) {\n            this.$count--;\n            return arr.shift();\n        }\n        return this.createObject(id);\n    }\n    recycle(id, obj) {\n        if (!id)\n            return;\n        let arr = this.$pool[id];\n        if (arr == null) {\n            arr = [];\n            this.$pool[id] = arr;\n        }\n        this.$count++;\n        arr.push(obj);\n    }\n}\n\nclass GObjectRecycler extends Recycler {\n    constructor() {\n        super();\n    }\n    clear() {\n        for (let key in this.$pool) {\n            let arr = this.$pool[key];\n            if (arr) {\n                arr.forEach((v) => {\n                    v.dispose();\n                });\n            }\n        }\n        super.clear();\n    }\n    createObject(id) {\n        return UIPackage.createObjectFromURL(id); //id = url\n    }\n}\n\nclass GLoader extends GObject {\n    constructor() {\n        super();\n        this.$frame = 0;\n        this.$color = '#fff';\n        this.$contentSourceWidth = 0;\n        this.$contentSourceHeight = 0;\n        this.$contentWidth = 0;\n        this.$contentHeight = 0;\n        this.$loadingTexture = null;\n        this.$playing = true;\n        this.$url = '';\n        this.$fill = 0 /* None */;\n        this.$align = \"left\" /* Left */;\n        this.$verticalAlign = 0 /* Top */;\n        this.$showErrorSign = true;\n        this.$color = '#fff';\n    }\n    createDisplayObject() {\n        this.$container = new UIContainer(this);\n        this.$hitArea = new createjs.Shape();\n        this.$hitArea.graphics.beginFill('#000').drawRect(0, 0, 0, 0);\n        this.$container.hitArea = this.$hitArea;\n        this.setDisplayObject(this.$container);\n        // this.$container.mouseChildren = false\n    }\n    dispose() {\n        this.clearContent();\n        super.dispose();\n    }\n    get url() {\n        return this.$url;\n    }\n    set url(value) {\n        if (this.$url == value)\n            return;\n        this.$url = value;\n        this.loadContent();\n        this.updateGear(7 /* Icon */);\n    }\n    get icon() {\n        return this.$url;\n    }\n    set icon(value) {\n        this.url = value;\n    }\n    get align() {\n        return this.$align;\n    }\n    set align(value) {\n        if (this.$align != value) {\n            this.$align = value;\n            this.updateLayout();\n        }\n    }\n    get verticalAlign() {\n        return this.$verticalAlign;\n    }\n    set verticalAlign(value) {\n        if (this.$verticalAlign != value) {\n            this.$verticalAlign = value;\n            this.updateLayout();\n        }\n    }\n    get fill() {\n        return this.$fill;\n    }\n    set fill(value) {\n        if (this.$fill != value) {\n            this.$fill = value;\n            this.updateLayout();\n        }\n    }\n    get autoSize() {\n        return this.$autoSize;\n    }\n    set autoSize(value) {\n        if (this.$autoSize != value) {\n            this.$autoSize = value;\n            this.updateLayout();\n        }\n    }\n    get playing() {\n        return this.$playing;\n    }\n    set playing(value) {\n        if (this.$playing != value) {\n            this.$playing = value;\n            if (this.$content instanceof MovieClip)\n                this.$content.playing = value;\n            this.updateGear(5 /* Animation */);\n        }\n    }\n    get frame() {\n        return this.$frame;\n    }\n    set frame(value) {\n        if (this.$frame != value) {\n            this.$frame = value;\n            if (this.$content instanceof MovieClip)\n                this.$content.currentFrame = value;\n            this.updateGear(5 /* Animation */);\n        }\n    }\n    get color() {\n        return this.$color;\n    }\n    set color(value) {\n        if (this.$color != value) {\n            this.$color = value;\n            this.updateGear(4 /* Color */);\n            this.applyColor();\n        }\n    }\n    applyColor() {\n        if (this.$content)\n            this.$content.tint = this.$color;\n    }\n    get showErrorSign() {\n        return this.$showErrorSign;\n    }\n    set showErrorSign(value) {\n        this.$showErrorSign = value;\n    }\n    get content() {\n        return this.$content;\n    }\n    get texture() {\n        if (this.$content instanceof UIImage)\n            return this.$content.texture;\n        else\n            return null;\n    }\n    set texture(value) {\n        this.url = null;\n        this.switchToMovieMode(false);\n        if (this.$content instanceof UIImage)\n            this.$content.texture = value;\n        if (value) {\n            this.$contentSourceWidth = value.width;\n            this.$contentSourceHeight = value.height;\n        }\n        else\n            this.$contentSourceWidth = this.$contentHeight = 0;\n        this.updateLayout();\n    }\n    loadContent() {\n        this.clearContent();\n        if (!this.$url)\n            return;\n        if (StringUtil.startsWith(this.$url, 'ui://'))\n            this.loadFromPackage(this.$url);\n        else\n            this.loadExternal();\n    }\n    loadFromPackage(itemURL) {\n        this.$contentItem = UIPackage.getItemByURL(itemURL);\n        if (this.$contentItem) {\n            this.$contentItem.load();\n            if (this.$contentItem.type == 0 /* Image */) {\n                if (this.$contentItem.texture == null) {\n                    this.setErrorState();\n                }\n                else {\n                    this.switchToMovieMode(false);\n                    this.$content.$initDisp(this.$contentItem);\n                    this.$contentSourceWidth = this.$contentItem.width;\n                    this.$contentSourceHeight = this.$contentItem.height;\n                    this.updateLayout();\n                }\n            }\n            else if (this.$contentItem.type == 2 /* MovieClip */) {\n                this.switchToMovieMode(true);\n                this.$contentSourceWidth = this.$contentItem.width;\n                this.$contentSourceHeight = this.$contentItem.height;\n                let mc = this.$content;\n                mc.interval = this.$contentItem.interval;\n                mc.swing = this.$contentItem.swing;\n                mc.repeatDelay = this.$contentItem.repeatDelay;\n                mc.frames = this.$contentItem.frames;\n                mc.boundsRect = new createjs.Rectangle(0, 0, this.$contentSourceWidth, this.$contentSourceHeight);\n                this.updateLayout();\n            }\n            else\n                this.setErrorState();\n        }\n        else\n            this.setErrorState();\n    }\n    switchToMovieMode(value) {\n        this.$container.removeAllChildren();\n        if (value) {\n            if (!(this.$content instanceof MovieClip))\n                this.$content = new MovieClip(this);\n        }\n        else {\n            if (!(this.$content instanceof UIImage))\n                this.$content = new UIImage(null);\n        }\n        this.$container.addChild(this.$content);\n    }\n    /**overwrite this method if you need to load resources by your own way*/\n    loadExternal() {\n        // let texture = Bitmap.fromImage(this.$url, true);\n        let texture = new Bitmap();\n        this.$loadingTexture = texture;\n        //TODO: Texture does not have error event... monitor error event on baseTexture will casue cross-error-event problem.\n        // texture.once(\"update\", () => {\n        //     if (!texture.width || !texture.height)\n        //         this.$loadResCompleted(null);\n        //     else\n        //         this.$loadResCompleted(texture);\n        // });\n    }\n    /**free the resource you loaded */\n    freeExternal(texture) {\n        // Bitmap.removeFromCache(texture);\n        // texture.destroy(texture.baseTexture != null);\n    }\n    $loadResCompleted(res) {\n        if (res)\n            this.onExternalLoadSuccess(res);\n        else {\n            this.onExternalLoadFailed();\n            // this.$loadingTexture.removeAllListeners();\n            this.freeExternal(this.$loadingTexture);\n            this.$loadingTexture = null;\n        }\n        this.$loadingTexture = null;\n    }\n    /**content loaded */\n    onExternalLoadSuccess(texture) {\n        this.$container.removeAllChildren();\n        if (!this.$content || !(this.$content instanceof UIImage)) {\n            this.$content = new UIImage(null);\n            this.$content.$initDisp();\n            this.$container.addChild(this.$content);\n        }\n        else\n            this.$container.addChild(this.$content);\n        //baseTexture loaded, so update frame info  // todo\n        this.$content.texture = texture.texture;\n        this.$contentSourceWidth = texture.sourceRect.width;\n        this.$contentSourceHeight = texture.sourceRect.height;\n        this.updateLayout();\n    }\n    onExternalLoadFailed() {\n        this.setErrorState();\n    }\n    setErrorState() {\n        if (!this.$showErrorSign)\n            return;\n        if (this.$errorSign == null) {\n            if (UIConfig.loaderErrorSign) {\n                this.$errorSign = GLoader.$errorSignPool.get(UIConfig.loaderErrorSign);\n            }\n        }\n        if (this.$errorSign) {\n            this.$errorSign.width = this.width;\n            this.$errorSign.height = this.height;\n            this.$container.addChild(this.$errorSign.displayObject);\n        }\n    }\n    clearErrorState() {\n        if (this.$errorSign) {\n            this.$container.removeChild(this.$errorSign.displayObject);\n            GLoader.$errorSignPool.recycle(this.$errorSign.resourceURL, this.$errorSign);\n            this.$errorSign = null;\n        }\n    }\n    updateLayout() {\n        if (this.$content == null) {\n            if (this.$autoSize) {\n                this.$updatingLayout = true;\n                this.setSize(50, 30);\n                this.$updatingLayout = false;\n            }\n            return;\n        }\n        this.$content.set({ x: 0, y: 0 });\n        this.$content.set({ scaleX: 1, scaleY: 1 });\n        this.$contentWidth = this.$contentSourceWidth;\n        this.$contentHeight = this.$contentSourceHeight;\n        if (this.$autoSize) {\n            this.$updatingLayout = true;\n            if (this.$contentWidth == 0)\n                this.$contentWidth = 50;\n            if (this.$contentHeight == 0)\n                this.$contentHeight = 30;\n            this.setSize(this.$contentWidth, this.$contentHeight);\n            this.$updatingLayout = false;\n        }\n        else {\n            let sx = 1, sy = 1;\n            if (this.$fill != 0 /* None */) {\n                sx = this.width / this.$contentSourceWidth;\n                sy = this.height / this.$contentSourceHeight;\n                if (sx != 1 || sy != 1) {\n                    if (this.$fill == 2 /* ScaleMatchHeight */)\n                        sx = sy;\n                    else if (this.$fill == 3 /* ScaleMatchWidth */)\n                        sy = sx;\n                    else if (this.$fill == 1 /* Scale */) {\n                        if (sx > sy)\n                            sx = sy;\n                        else\n                            sy = sx;\n                    }\n                    else if (this.$fill == 5 /* ScaleNoBorder */) {\n                        if (sx > sy)\n                            sy = sx;\n                        else\n                            sx = sy;\n                    }\n                    this.$contentWidth = this.$contentSourceWidth * sx;\n                    this.$contentHeight = this.$contentSourceHeight * sy;\n                }\n            }\n            if (this.$content instanceof UIImage) {\n                this.$content.width = this.$contentWidth;\n                this.$content.height = this.$contentHeight;\n            }\n            else\n                this.$content.set({ scaleX: sx, scaleY: sy });\n            if (this.$align == \"center\" /* Center */)\n                this.$content.x = Math.floor((this.width - this.$contentWidth) / 2);\n            else if (this.$align == \"right\" /* Right */)\n                this.$content.x = this.width - this.$contentWidth;\n            if (this.$verticalAlign == 1 /* Middle */)\n                this.$content.y = Math.floor((this.height - this.$contentHeight) / 2);\n            else if (this.$verticalAlign == 2 /* Bottom */)\n                this.$content.y = this.height - this.$contentHeight;\n        }\n    }\n    clearContent() {\n        this.clearErrorState();\n        if (this.$content && this.$content.parent)\n            this.$container.removeChild(this.$content);\n        if (this.$loadingTexture) {\n            // this.$loadingTexture.removeAllListeners();// todo\n            this.freeExternal(this.$loadingTexture);\n            this.$loadingTexture = null;\n        }\n        // if (this.$contentItem == null && this.$content instanceof UIImage)\n        //     this.freeExternal(this.$content.texture); // todo\n        this.$content && this.$content.destroy();\n        this.$content = null;\n        this.$contentItem = null;\n    }\n    handleSizeChanged() {\n        if (!this.$updatingLayout)\n            this.updateLayout();\n        this.$hitArea.graphics.drawRect(0, 0, this.width, this.height);\n    }\n    setupBeforeAdd(xml) {\n        super.setupBeforeAdd(xml);\n        let str;\n        str = xml.attributes.url;\n        if (str)\n            this.$url = str;\n        str = xml.attributes.align;\n        if (str)\n            this.$align = ParseAlignType(str);\n        str = xml.attributes.vAlign;\n        if (str)\n            this.$verticalAlign = ParseVertAlignType(str);\n        str = xml.attributes.fill;\n        if (str)\n            this.$fill = ParseLoaderFillType(str);\n        this.$autoSize = xml.attributes.autoSize == 'true';\n        str = xml.attributes.errorSign;\n        if (str)\n            this.$showErrorSign = str == 'true';\n        this.$playing = xml.attributes.playing != 'false';\n        str = xml.attributes.color;\n        if (str)\n            this.color = str;\n        if (this.$url)\n            this.loadContent();\n    }\n}\nGLoader.$errorSignPool = new GObjectRecycler();\n\nlet isColorableTitle = function (obj) {\n    return obj && \"titleColor\" in obj && \"fontSize\" in obj;\n};\n\nclass GLabel extends GComponent {\n    constructor() {\n        super();\n    }\n    get icon() {\n        if (this.$iconObject != null)\n            return this.$iconObject.icon;\n        return null;\n    }\n    set icon(value) {\n        if (this.$iconObject != null)\n            this.$iconObject.icon = value;\n        this.updateGear(7 /* Icon */);\n    }\n    get title() {\n        if (this.$titleObject)\n            return this.$titleObject.text;\n        else\n            return null;\n    }\n    set title(value) {\n        if (this.$titleObject)\n            this.$titleObject.text = value;\n        this.updateGear(6 /* Text */);\n    }\n    get text() {\n        return this.title;\n    }\n    set text(value) {\n        this.title = value;\n    }\n    get titleColor() {\n        if (isColorableTitle(this.$titleObject))\n            return this.$titleObject.titleColor;\n        return '';\n    }\n    set titleColor(value) {\n        if (isColorableTitle(this.$titleObject))\n            this.$titleObject.titleColor = value;\n    }\n    get fontSize() {\n        if (isColorableTitle(this.$titleObject))\n            return this.$titleObject.fontSize;\n        return 0;\n    }\n    set fontSize(value) {\n        if (isColorableTitle(this.$titleObject))\n            this.$titleObject.fontSize = value;\n    }\n    set editable(val) {\n        if (this.$titleObject)\n            this.$titleObject.editable = val;\n    }\n    get editable() {\n        if (this.$titleObject && this.$titleObject instanceof GTextInput)\n            return this.$titleObject.editable;\n        else\n            return false;\n    }\n    constructFromXML(xml) {\n        super.constructFromXML(xml);\n        this.$titleObject = this.getChild('title');\n        this.$iconObject = this.getChild('icon');\n    }\n    setupAfterAdd(xml) {\n        super.setupAfterAdd(xml);\n        let cs = XmlParser.getChildNodes(xml, 'Label');\n        if (cs && cs.length > 0) {\n            xml = cs[0];\n            let str;\n            str = xml.attributes.title;\n            if (str)\n                this.text = str;\n            str = xml.attributes.icon;\n            if (str)\n                this.icon = str;\n            str = xml.attributes.titleColor;\n            if (str)\n                this.titleColor = str;\n            if (this.$titleObject instanceof GTextInput) {\n                str = xml.attributes.prompt;\n                let ti = this.$titleObject;\n                if (str)\n                    ti.promptText = str;\n                str = xml.attributes.maxLength;\n                if (str)\n                    ti.maxLength = parseInt(str);\n                str = xml.attributes.restrict;\n                if (str)\n                    ti.restrict = str;\n                str = xml.attributes.password;\n                if (str)\n                    ti.password = str == 'true';\n            }\n        }\n    }\n}\n\nclass PageOption {\n    set controller(val) {\n        this.$controller = val;\n    }\n    set name(pageName) {\n        this.$id = this.$controller.getPageIdByName(pageName);\n    }\n    get name() {\n        if (this.$id)\n            return this.$controller.getPageNameById(this.$id);\n        else\n            return null;\n    }\n    set index(pageIndex) {\n        this.$id = this.$controller.getPageId(pageIndex);\n    }\n    get index() {\n        if (this.$id)\n            return this.$controller.getPageIndexById(this.$id);\n        else\n            return -1;\n    }\n    clear() {\n        this.$id = null;\n    }\n    set id(id) {\n        this.$id = id;\n    }\n    get id() {\n        return this.$id;\n    }\n}\n\nclass GButton extends GComponent {\n    constructor() {\n        super();\n        this.$mode = 0 /* Common */;\n        this.$title = '';\n        this.$icon = '';\n        this.$sound = UIConfig.buttonSound;\n        this.$soundVolumeScale = UIConfig.buttonSoundVolumeScale;\n        this.$pageOption = new PageOption();\n        this.$changeStateOnClick = true;\n        this.$downEffect = 0;\n        this.$downEffectValue = 0.8;\n        this.$container.cursor = 'pointer';\n    }\n    setDisplayObject(value) {\n        super.setDisplayObject(value);\n        // this.$displayObject.buttonMode = true; //todo\n    }\n    get icon() {\n        return this.$icon;\n    }\n    set icon(value) {\n        this.$icon = value;\n        value = this.$selected && this.$selectedIcon ? this.$selectedIcon : this.$icon;\n        if (this.$iconObject != null)\n            this.$iconObject.icon = value;\n        this.updateGear(7 /* Icon */);\n    }\n    get selectedIcon() {\n        return this.$selectedIcon;\n    }\n    set selectedIcon(value) {\n        this.$selectedIcon = value;\n        value = this.$selected && this.$selectedIcon ? this.$selectedIcon : this.$icon;\n        if (this.$iconObject != null)\n            this.$iconObject.icon = value;\n    }\n    get title() {\n        return this.$title;\n    }\n    set title(value) {\n        this.$title = value;\n        if (this.$titleObject)\n            this.$titleObject.text =\n                this.$selected && this.$selectedTitle ? this.$selectedTitle : this.$title;\n        this.updateGear(6 /* Text */);\n    }\n    get text() {\n        return this.title;\n    }\n    set text(value) {\n        this.title = value;\n    }\n    get selectedTitle() {\n        return this.$selectedTitle;\n    }\n    set selectedTitle(value) {\n        this.$selectedTitle = value;\n        if (this.$titleObject)\n            this.$titleObject.text =\n                this.$selected && this.$selectedTitle ? this.$selectedTitle : this.$title;\n    }\n    get titleColor() {\n        if (isColorableTitle(this.$titleObject))\n            return this.$titleObject.titleColor;\n    }\n    set titleColor(value) {\n        if (isColorableTitle(this.$titleObject))\n            this.$titleObject.titleColor = value;\n    }\n    get fontSize() {\n        if (isColorableTitle(this.$titleObject))\n            return this.$titleObject.fontSize;\n        return 0;\n    }\n    set fontSize(value) {\n        if (isColorableTitle(this.$titleObject))\n            this.$titleObject.fontSize = value;\n    }\n    get sound() {\n        return this.$sound;\n    }\n    set sound(val) {\n        this.$sound = val;\n    }\n    get soundVolumeScale() {\n        return this.$soundVolumeScale;\n    }\n    set soundVolumeScale(value) {\n        this.$soundVolumeScale = value;\n    }\n    set selected(val) {\n        if (this.$mode == 0 /* Common */)\n            return;\n        if (this.$selected != val) {\n            this.$selected = val;\n            if (this.grayed &&\n                this.$buttonController &&\n                this.$buttonController.hasPage(GButton.DISABLED)) {\n                if (this.$selected)\n                    this.setState(GButton.SELECTED_DISABLED);\n                else\n                    this.setState(GButton.DISABLED);\n            }\n            else {\n                if (this.$selected)\n                    this.setState(this.$over ? GButton.SELECTED_OVER : GButton.DOWN);\n                else\n                    this.setState(this.$over ? GButton.OVER : GButton.UP);\n            }\n            if (this.$selectedTitle && this.$titleObject)\n                this.$titleObject.text = this.$selected ? this.$selectedTitle : this.$title;\n            if (this.$selectedIcon) {\n                let str = this.$selected ? this.$selectedIcon : this.$icon;\n                if (this.$iconObject != null)\n                    this.$iconObject.icon = str;\n            }\n            if (this.$relatedController && this.$parent && !this.$parent.$buildingDisplayList) {\n                if (this.$selected) {\n                    this.$relatedController.selectedPageId = this.$pageOption.id;\n                    if (this.$relatedController.$autoRadioGroupDepth)\n                        this.$parent.adjustRadioGroupDepth(this, this.$relatedController);\n                }\n                else if (this.$mode == 1 /* Check */ &&\n                    this.$relatedController.selectedPageId == this.$pageOption.id)\n                    this.$relatedController.oppositePageId = this.$pageOption.id;\n            }\n        }\n    }\n    get selected() {\n        return this.$selected;\n    }\n    get mode() {\n        return this.$mode;\n    }\n    set mode(value) {\n        if (this.$mode != value) {\n            if (value == 0 /* Common */)\n                this.selected = false;\n            this.$mode = value;\n        }\n    }\n    get relatedController() {\n        return this.$relatedController;\n    }\n    set relatedController(val) {\n        if (val != this.$relatedController) {\n            this.$relatedController = val;\n            this.$pageOption.controller = val;\n            this.$pageOption.clear();\n        }\n    }\n    get pageOption() {\n        return this.$pageOption;\n    }\n    get changeStateOnClick() {\n        return this.$changeStateOnClick;\n    }\n    set changeStateOnClick(value) {\n        this.$changeStateOnClick = value;\n    }\n    get linkedPopup() {\n        return this.$linkedPopup;\n    }\n    set linkedPopup(value) {\n        this.$linkedPopup = value;\n    }\n    addStateListener(listener, thisObj) {\n        this.on(\"__stateChanged\" /* CHANGED */, listener, thisObj);\n    }\n    removeStateListener(listener) {\n        this.off(\"__stateChanged\" /* CHANGED */, listener);\n    }\n    fireClick(downEffect = true) {\n        if (downEffect && this.$mode == 0 /* Common */) {\n            this.setState(GButton.OVER);\n            GTimer.inst.add(100, 1, this.setState, this, GButton.DOWN);\n            GTimer.inst.add(200, 1, this.setState, this, GButton.UP);\n        }\n        this.$click(null);\n    }\n    setState(val) {\n        if (this.$buttonController)\n            this.$buttonController.selectedPage = val;\n        if (this.$downEffect == 1) {\n            if (val == GButton.DOWN || val == GButton.SELECTED_OVER || val == GButton.SELECTED_DISABLED) {\n                let r = this.$downEffectValue * 255;\n                let color = (r << 16) + (r << 8) + r;\n                this.$children.forEach(obj => {\n                    if (isColorGear(obj))\n                        obj.color = color;\n                });\n            }\n            else {\n                this.$children.forEach(obj => {\n                    if (isColorGear(obj))\n                        obj.color = 0xffffff;\n                });\n            }\n        }\n        else if (this.$downEffect == 2) {\n            if (val == GButton.DOWN || val == GButton.SELECTED_OVER || val == GButton.SELECTED_DISABLED)\n                this.setScale(this.$downEffectValue, this.$downEffectValue);\n            else\n                this.setScale(1, 1);\n        }\n    }\n    handleControllerChanged(c) {\n        super.handleControllerChanged(c);\n        if (this.$relatedController == c)\n            this.selected = this.$pageOption.id == c.selectedPageId;\n    }\n    handleGrayedChanged() {\n        if (this.$buttonController && this.$buttonController.hasPage(GButton.DISABLED)) {\n            if (this.grayed) {\n                if (this.$selected && this.$buttonController.hasPage(GButton.SELECTED_DISABLED))\n                    this.setState(GButton.SELECTED_DISABLED);\n                else\n                    this.setState(GButton.DISABLED);\n            }\n            else if (this.$selected)\n                this.setState(GButton.DOWN);\n            else\n                this.setState(GButton.UP);\n        }\n        else\n            super.handleGrayedChanged();\n    }\n    constructFromXML(xml) {\n        super.constructFromXML(xml);\n        xml = XmlParser.getChildNodes(xml, 'Button')[0];\n        let str;\n        str = xml.attributes.mode;\n        if (str)\n            this.$mode = ParseButtonMode(str);\n        str = xml.attributes.sound;\n        if (str != null)\n            this.$sound = str;\n        str = xml.attributes.volume;\n        if (str)\n            this.$soundVolumeScale = parseInt(str) / 100;\n        str = xml.attributes.downEffect;\n        if (str) {\n            this.$downEffect = str == 'dark' ? 1 : str == 'scale' ? 2 : 0;\n            str = xml.attributes.downEffectValue;\n            this.$downEffectValue = parseFloat(str);\n            if (this.$downEffect == 2)\n                this.setPivot(0.5, 0.5);\n        }\n        this.$buttonController = this.getController('button');\n        this.$titleObject = this.getChild('title');\n        this.$iconObject = this.getChild('icon');\n        if (this.$titleObject != null)\n            this.$title = this.$titleObject.text;\n        if (this.$iconObject != null)\n            this.$icon = this.$iconObject.icon;\n        if (this.$mode == 0 /* Common */)\n            this.setState(GButton.UP);\n        this.on(InteractiveEvents.Over, this.$rollover, this);\n        this.on(InteractiveEvents.Out, this.$rollout, this);\n        this.on(InteractiveEvents.Down, this.$mousedown, this);\n        this.on(InteractiveEvents.Click, this.$click, this);\n        this.$hitArea = new createjs.Shape();\n        this.$hitArea.graphics.beginFill(\"#fff\").drawRect(0, 0, this.width, this.height);\n        this.$displayObject.hitArea = this.$hitArea;\n    }\n    setupAfterAdd(xml) {\n        super.setupAfterAdd(xml);\n        xml = XmlParser.getChildNodes(xml, 'Button')[0];\n        if (xml) {\n            let str;\n            str = xml.attributes.title;\n            if (str)\n                this.title = str;\n            str = xml.attributes.icon;\n            if (str)\n                this.icon = str;\n            str = xml.attributes.selectedTitle;\n            if (str)\n                this.selectedTitle = str;\n            str = xml.attributes.selectedIcon;\n            if (str)\n                this.selectedIcon = str;\n            str = xml.attributes.titleColor;\n            if (str)\n                this.titleColor = StringUtil.HEX2RGB(str);\n            str = xml.attributes.sound;\n            if (str != null)\n                this.$sound = str;\n            str = xml.attributes.volume;\n            if (str)\n                this.$soundVolumeScale = parseInt(str) / 100;\n            str = xml.attributes.titleFontSize;\n            if (str)\n                this.fontSize = parseInt(str);\n            str = xml.attributes.controller;\n            if (str)\n                this.$relatedController = this.$parent.getController(str);\n            else\n                this.$relatedController = null;\n            this.$pageOption.id = xml.attributes.page;\n            this.selected = xml.attributes.checked == 'true';\n        }\n    }\n    $rollover(evt) {\n        if (!this.$buttonController || !this.$buttonController.hasPage(GButton.OVER))\n            return;\n        this.$over = true;\n        if (this.$down)\n            return;\n        this.setState(this.$selected ? GButton.SELECTED_OVER : GButton.OVER);\n    }\n    $rollout(evt) {\n        if (!this.$buttonController || !this.$buttonController.hasPage(GButton.OVER))\n            return;\n        this.$over = false;\n        if (this.$down)\n            return;\n        this.setState(this.$selected ? GButton.DOWN : GButton.UP);\n    }\n    $mousedown(evt) {\n        this.$down = true;\n        this.$mouseUpEvent = Decls$1.GRoot.inst.nativeStage.on(InteractiveEvents.Up, this.$mouseup, this);\n        if (this.$mode == 0 /* Common */) {\n            if (this.grayed && this.$buttonController && this.$buttonController.hasPage(GButton.DISABLED))\n                this.setState(GButton.SELECTED_DISABLED);\n            else\n                this.setState(GButton.DOWN);\n        }\n        if (this.$linkedPopup != null) {\n            if (this.$linkedPopup instanceof Window)\n                this.$linkedPopup.toggleVisible();\n            else\n                Decls$1.GRoot.inst.togglePopup(this.$linkedPopup, this);\n        }\n    }\n    $mouseup(evt) {\n        if (this.$down) {\n            Decls$1.GRoot.inst.nativeStage.off(InteractiveEvents.Up, this.$mouseUpEvent);\n            this.$down = false;\n            if (this.$mode == 0 /* Common */) {\n                if (this.grayed &&\n                    this.$buttonController &&\n                    this.$buttonController.hasPage(GButton.DISABLED))\n                    this.setState(GButton.DISABLED);\n                else if (this.$over)\n                    this.setState(GButton.OVER);\n                else\n                    this.setState(GButton.UP);\n            }\n        }\n    }\n    $click(evt) {\n        if (this.$sound) {\n            var pi = UIPackage.getItemByURL(this.$sound);\n            if (pi) {\n                var sound = pi.owner.getItemAsset(pi);\n                if (sound)\n                    Decls$1.GRoot.inst.playOneShotSound(sound, this.$soundVolumeScale);\n            }\n        }\n        if (!this.$changeStateOnClick)\n            return;\n        if (this.$mode == 1 /* Check */) {\n            this.selected = !this.$selected;\n            let evt = new createjs.Event(\"__stateChanged\" /* CHANGED */, true, false);\n            evt.data = { selected: this.selected };\n            this.dispatchEvent(evt, this);\n        }\n        else if (this.$mode == 2 /* Radio */) {\n            if (!this.$selected) {\n                this.selected = true;\n                let evt = new createjs.Event(\"__stateChanged\" /* CHANGED */, true, false);\n                evt.data = { selected: this.selected };\n                this.dispatchEvent(evt, this);\n            }\n        }\n    }\n    dispose() {\n        GTimer.inst.remove(this.setState, this);\n        GTimer.inst.remove(this.setState, this);\n        Decls$1.GRoot.inst.off(InteractiveEvents.Up, this.$mouseup);\n        super.dispose();\n    }\n}\nGButton.UP = 'up';\nGButton.DOWN = 'down';\nGButton.OVER = 'over';\nGButton.SELECTED_OVER = 'selectedOver';\nGButton.DISABLED = 'disabled';\nGButton.SELECTED_DISABLED = 'selectedDisabled';\n\nclass GComboBox extends GComponent {\n    constructor() {\n        super();\n        this.$visibleItemCount = 0;\n        this.$selectedIndex = 0;\n        this.$popupDir = 1 /* Down */;\n        this.$visibleItemCount = UIConfig.defaultComboBoxVisibleItemCount;\n        this.$itemsUpdated = true;\n        this.$selectedIndex = -1;\n        this.$items = [];\n        this.$values = [];\n    }\n    get text() {\n        if (this.$titleObject)\n            return this.$titleObject.text;\n        else\n            return null;\n    }\n    set text(value) {\n        if (this.$titleObject)\n            this.$titleObject.text = value;\n        this.updateGear(6 /* Text */);\n    }\n    get icon() {\n        if (this.$iconObject)\n            return this.$iconObject.icon;\n        else\n            return null;\n    }\n    set icon(value) {\n        if (this.$iconObject)\n            this.$iconObject.icon = value;\n        this.updateGear(7 /* Icon */);\n    }\n    get titleColor() {\n        if (isColorableTitle(this.$titleObject))\n            return this.$titleObject.titleColor;\n        // return 0;\n    }\n    set titleColor(value) {\n        if (isColorableTitle(this.$titleObject))\n            this.$titleObject.titleColor = value;\n    }\n    get visibleItemCount() {\n        return this.$visibleItemCount;\n    }\n    set visibleItemCount(value) {\n        this.$visibleItemCount = value;\n    }\n    get popupDirection() {\n        return this.$popupDir;\n    }\n    set popupDirection(value) {\n        this.$popupDir = value;\n    }\n    get items() {\n        return this.$items;\n    }\n    set items(value) {\n        if (!value)\n            this.$items.length = 0;\n        else\n            this.$items = value.concat();\n        if (this.$items.length > 0) {\n            if (this.$selectedIndex >= this.$items.length)\n                this.$selectedIndex = this.$items.length - 1;\n            else if (this.$selectedIndex == -1)\n                this.$selectedIndex = 0;\n            this.text = this.$items[this.$selectedIndex];\n            if (this.$icons != null && this.$selectedIndex < this.$icons.length)\n                this.icon = this.$icons[this.$selectedIndex];\n        }\n        else {\n            this.text = '';\n            if (this.$icons != null)\n                this.icon = null;\n            this.$selectedIndex = -1;\n        }\n        this.$itemsUpdated = true;\n    }\n    get icons() {\n        return this.$icons;\n    }\n    set icons(value) {\n        this.$icons = value;\n        if (this.$icons != null &&\n            this.$selectedIndex != -1 &&\n            this.$selectedIndex < this.$icons.length)\n            this.icon = this.$icons[this.$selectedIndex];\n    }\n    get values() {\n        return this.$values;\n    }\n    set values(value) {\n        if (!value)\n            this.$values.length = 0;\n        else\n            this.$values = value.concat();\n    }\n    get selectedIndex() {\n        return this.$selectedIndex;\n    }\n    set selectedIndex(val) {\n        if (this.$selectedIndex == val)\n            return;\n        this.$selectedIndex = val;\n        if (this.selectedIndex >= 0 && this.selectedIndex < this.$items.length) {\n            this.text = this.$items[this.$selectedIndex];\n            if (this.$icons != null && this.$selectedIndex < this.$icons.length)\n                this.icon = this.$icons[this.$selectedIndex];\n        }\n        else {\n            this.text = '';\n            if (this.$icons != null)\n                this.icon = null;\n        }\n    }\n    get value() {\n        return this.$values[this.$selectedIndex];\n    }\n    set value(val) {\n        this.selectedIndex = this.$values.indexOf(val);\n    }\n    setState(val) {\n        if (this.$buttonController)\n            this.$buttonController.selectedPage = val;\n    }\n    constructFromXML(xml) {\n        super.constructFromXML(xml);\n        xml = XmlParser.getChildNodes(xml, 'ComboBox')[0];\n        let str;\n        this.$buttonController = this.getController('button');\n        this.$titleObject = this.getChild('title');\n        this.$iconObject = this.getChild('icon');\n        str = xml.attributes.dropdown;\n        if (str) {\n            this.$dropdown = UIPackage.createObjectFromURL(str);\n            if (!this.$dropdown)\n                throw new Error(\"the 'dropdown' is not specified, it must be a component definied in the package pool\");\n            this.$dropdown.name = 'this.dropdown';\n            this.$list = this.$dropdown.getChild('list');\n            if (this.$list == null)\n                throw new Error(`${this.resourceURL}: the dropdown component must have a GList child and named 'list'.`);\n            this.$list.on(\"__itemClick\" /* ItemClick */, this.$clickItem, this);\n            this.$list.addRelation(this.$dropdown, 14 /* Width */);\n            this.$list.removeRelation(this.$dropdown, 15 /* Height */);\n            this.$dropdown.addRelation(this.$list, 15 /* Height */);\n            this.$dropdown.removeRelation(this.$list, 14 /* Width */);\n            this.$dropdown.on('removed', this.$popupWinClosed, this);\n        }\n        if (!isMobile.any) {\n            this.on(InteractiveEvents.Over, this.$rollover, this);\n            this.on(InteractiveEvents.Out, this.$rollout, this);\n        }\n        this.on(InteractiveEvents.Down, this.$mousedown, this);\n    }\n    dispose() {\n        GTimer.inst.remove(this.delayedClickItem, this);\n        this.$list.off(\"__itemClick\" /* ItemClick */, this.$clickItem);\n        this.$dropdown.off('removed', this.$popupWinClosed);\n        GRoot.inst.nativeStage.off(InteractiveEvents.Up, this.$mouseUpEvent);\n        this.$popupWinClosed(null);\n        if (this.$dropdown) {\n            this.$dropdown.dispose();\n            this.$dropdown = null;\n        }\n        super.dispose();\n    }\n    setupAfterAdd(xml) {\n        super.setupAfterAdd(xml);\n        xml = XmlParser.getChildNodes(xml, 'ComboBox')[0];\n        if (xml) {\n            let str;\n            str = xml.attributes.titleColor;\n            if (str)\n                this.titleColor = str;\n            str = xml.attributes.visibleItemCount;\n            if (str)\n                this.$visibleItemCount = parseInt(str);\n            let col = xml.children;\n            if (col) {\n                col.forEach((x, i) => {\n                    if (x.nodeName == 'item') {\n                        this.$items.push(x.attributes.title);\n                        this.$values.push(x.attributes.value);\n                        str = x.attributes.icon;\n                        if (str) {\n                            if (!this.$icons)\n                                this.$icons = new Array(length);\n                            this.$icons[i] = str;\n                        }\n                    }\n                });\n            }\n            str = xml.attributes.title;\n            if (str) {\n                this.text = str;\n                this.$selectedIndex = this.$items.indexOf(str);\n            }\n            else if (this.$items.length > 0) {\n                this.$selectedIndex = 0;\n                this.text = this.$items[0];\n            }\n            else\n                this.$selectedIndex = -1;\n            str = xml.attributes.icon;\n            if (str)\n                this.icon = str;\n            str = xml.attributes.direction;\n            if (str) {\n                if (str == 'up')\n                    this.$popupDir = 2 /* Up */;\n                else if (str == 'auto')\n                    this.$popupDir = 0 /* Auto */;\n            }\n        }\n    }\n    showDropdown() {\n        if (this.$itemsUpdated) {\n            this.$itemsUpdated = false;\n            this.$list.removeChildrenToPool();\n            this.$items.forEach((o, i) => {\n                let item = this.$list.addItemFromPool();\n                item.name = i < this.$values.length ? this.$values[i] : '';\n                item.text = this.$items[i];\n                item.icon = this.$icons != null && i < this.$icons.length ? this.$icons[i] : null;\n            }, this);\n            this.$list.resizeToFit(this.$visibleItemCount);\n        }\n        this.$list.selectedIndex = -1;\n        this.$dropdown.width = this.width;\n        GRoot.findFor(this).togglePopup(this.$dropdown, this, this.$popupDir);\n        if (this.$dropdown.parent)\n            this.setState(GButton.DOWN);\n    }\n    $popupWinClosed(evt) {\n        if (this.$over)\n            this.setState(GButton.OVER);\n        else\n            this.setState(GButton.UP);\n    }\n    $clickItem(evt) {\n        let item = evt.data.item;\n        let index = this.$list.getChildIndex(item);\n        GTimer.inst.add(100, 1, this.delayedClickItem, this, index);\n    }\n    delayedClickItem(index) {\n        if (this.$dropdown.parent instanceof GRoot)\n            this.$dropdown.parent.hidePopup();\n        this.$selectedIndex = index;\n        if (this.$selectedIndex >= 0)\n            this.text = this.$items[this.$selectedIndex];\n        else\n            this.text = '';\n        let evt = new createjs.Event(\"__stateChanged\" /* CHANGED */, true, false);\n        evt.data = { selectedIndex: this.$selectedIndex };\n        this.dispatchEvent(evt, this);\n    }\n    $rollover(evt) {\n        this.$over = true;\n        if (this.$down || (this.$dropdown && this.$dropdown.parent))\n            return;\n        this.setState(GButton.OVER);\n    }\n    $rollout(evt) {\n        this.$over = false;\n        if (this.$down || (this.$dropdown && this.$dropdown.parent))\n            return;\n        this.setState(GButton.UP);\n    }\n    $mousedown(evt) {\n        evt.stopPropagation();\n        GRoot.inst.checkPopups(evt.target);\n        this.$down = true;\n        this.$mouseUpEvent = GRoot.inst.nativeStage.on(InteractiveEvents.Up, this.$mouseup, this);\n        if (this.$dropdown)\n            this.showDropdown();\n    }\n    $mouseup(evt) {\n        if (this.$down) {\n            this.$down = false;\n            GRoot.inst.nativeStage.off(InteractiveEvents.Up, this.$mouseUpEvent);\n            if (this.$dropdown && !this.$dropdown.parent) {\n                if (this.$over)\n                    this.setState(GButton.OVER);\n                else\n                    this.setState(GButton.UP);\n            }\n        }\n    }\n}\n\nclass GSlider extends GComponent {\n    constructor() {\n        super();\n        this.$max = 0;\n        this.$value = 0;\n        this.$barMaxWidth = 0;\n        this.$barMaxHeight = 0;\n        this.$barMaxWidthDelta = 0;\n        this.$barMaxHeightDelta = 0;\n        this.$titleType = 0 /* Percent */;\n        this.$value = 50;\n        this.$max = 100;\n        this.$clickPos = new createjs.Point();\n    }\n    get titleType() {\n        return this.$titleType;\n    }\n    set titleType(value) {\n        this.$titleType = value;\n    }\n    get max() {\n        return this.$max;\n    }\n    set max(value) {\n        if (this.$max != value) {\n            this.$max = value;\n            this.update();\n        }\n    }\n    get value() {\n        return this.$value;\n    }\n    set value(value) {\n        if (this.$value != value) {\n            this.$value = value;\n            this.update();\n        }\n    }\n    update() {\n        let percent = Math.min(this.$value / this.$max, 1);\n        this.updateWidthPercent(percent);\n    }\n    updateWidthPercent(percent) {\n        if (this.$titleObject) {\n            switch (this.$titleType) {\n                case 0 /* Percent */:\n                    this.$titleObject.text = `${Math.round(percent * 100)}%`;\n                    break;\n                case 1 /* ValueAndMax */:\n                    this.$titleObject.text = `${this.$value}/${this.$max}`;\n                    break;\n                case 2 /* Value */:\n                    this.$titleObject.text = `${this.$value}`;\n                    break;\n                case 3 /* Max */:\n                    this.$titleObject.text = `${this.$max}`;\n                    break;\n            }\n        }\n        if (this.$barObjectH)\n            this.$barObjectH.width = (this.width - this.$barMaxWidthDelta) * percent;\n        if (this.$barObjectV)\n            this.$barObjectV.height = (this.height - this.$barMaxHeightDelta) * percent;\n        if (this.$aniObject instanceof GMovieClip)\n            this.$aniObject.frame = Math.round(percent * 100);\n    }\n    handleSizeChanged() {\n        super.handleSizeChanged();\n        if (this.$barObjectH)\n            this.$barMaxWidth = this.width - this.$barMaxWidthDelta;\n        if (this.$barObjectV)\n            this.$barMaxHeight = this.height - this.$barMaxHeightDelta;\n        if (!this.$inProgressBuilding)\n            this.update();\n    }\n    setupAfterAdd(xml) {\n        super.setupAfterAdd(xml);\n        xml = XmlParser.getChildNodes(xml, 'Slider')[0];\n        if (xml) {\n            this.$value = parseInt(xml.attributes.value);\n            this.$max = parseInt(xml.attributes.max);\n        }\n        this.update();\n    }\n    constructFromXML(xml) {\n        super.constructFromXML(xml);\n        xml = XmlParser.getChildNodes(xml, 'Slider')[0];\n        let str;\n        if (xml) {\n            str = xml.attributes.titleType;\n            if (str)\n                this.$titleType = ParseProgressTitleType(str);\n        }\n        this.$titleObject = this.getChild('title');\n        this.$barObjectH = this.getChild('bar');\n        this.$barObjectV = this.getChild('bar_v');\n        this.$aniObject = this.getChild('ani');\n        this.$gripObject = this.getChild('grip');\n        if (this.$barObjectH) {\n            this.$barMaxWidth = this.$barObjectH.width;\n            this.$barMaxWidthDelta = this.width - this.$barMaxWidth;\n        }\n        if (this.$barObjectV) {\n            this.$barMaxHeight = this.$barObjectV.height;\n            this.$barMaxHeightDelta = this.height - this.$barMaxHeight;\n        }\n        if (this.$gripObject)\n            this.$gripObject.on(InteractiveEvents.Down, this.$gripMouseDown, this);\n    }\n    $gripMouseDown(evt) {\n        this.$clickPos = this.globalToLocal(evt.stageX, evt.stageY);\n        this.$clickPercent = this.$value / this.$max;\n        this.$mouseMoveEvent = GRoot.inst.nativeStage.on(InteractiveEvents.Move, this.$gripMouseMove, this);\n        this.$mouseUpEvent = GRoot.inst.nativeStage.on(InteractiveEvents.Up, this.$gripMouseUp, this);\n    }\n    $gripMouseMove(evt) {\n        let pt = this.globalToLocal(evt.stageX, evt.stageY, GSlider.sSilderHelperPoint);\n        let deltaX = pt.x - this.$clickPos.x;\n        let deltaY = pt.y - this.$clickPos.y;\n        let percent;\n        if (this.$barObjectH)\n            percent = this.$clickPercent + deltaX / this.$barMaxWidth;\n        else\n            percent = this.$clickPercent + deltaY / this.$barMaxHeight;\n        if (percent > 1)\n            percent = 1;\n        else if (percent < 0)\n            percent = 0;\n        let newValue = Math.round(this.$max * percent);\n        if (newValue != this.$value) {\n            this.$value = newValue;\n            let evt = new createjs.Event(\"__stateChanged\" /* CHANGED */, true, false);\n            this.dispatchEvent(evt, this);\n        }\n        this.updateWidthPercent(percent);\n    }\n    $gripMouseUp(evt) {\n        let percent = this.$value / this.$max;\n        this.updateWidthPercent(percent);\n        GRoot.inst.nativeStage.off(InteractiveEvents.Move, this.$mouseMoveEvent);\n        GRoot.inst.nativeStage.off(InteractiveEvents.Up, this.$mouseUpEvent);\n    }\n    dispose() {\n        if (this.$gripObject)\n            this.$gripObject.off(InteractiveEvents.Down, this.$gripMouseDown);\n        GRoot.inst.nativeStage.off(InteractiveEvents.Move, this.$mouseMoveEvent);\n        GRoot.inst.nativeStage.off(InteractiveEvents.Up, this.$mouseUpEvent);\n        super.dispose();\n    }\n}\nGSlider.sSilderHelperPoint = new createjs.Point();\n\nclass GProgressBar extends GComponent {\n    constructor() {\n        super();\n        this.$max = 0;\n        this.$value = 0;\n        this.$barMaxWidth = 0;\n        this.$barMaxHeight = 0;\n        this.$barMaxWidthDelta = 0;\n        this.$barMaxHeightDelta = 0;\n        this.$barStartX = 0;\n        this.$barStartY = 0;\n        this.$tweenValue = 0;\n        this.$titleType = 0 /* Percent */;\n        this.$value = 50;\n        this.$max = 100;\n    }\n    get titleType() {\n        return this.$titleType;\n    }\n    set titleType(value) {\n        if (this.$titleType != value) {\n            this.$titleType = value;\n            this.update(this.$value);\n        }\n    }\n    get max() {\n        return this.$max;\n    }\n    set max(value) {\n        if (this.$max != value) {\n            this.$max = value;\n            this.update(this.$value);\n        }\n    }\n    get value() {\n        return this.$value;\n    }\n    set value(value) {\n        if (this.$tweener != null) {\n            this.$tweener.paused = true;\n            this.$tweener = null;\n        }\n        if (this.$value != value) {\n            this.$value = value;\n            this.update(this.$value);\n        }\n    }\n    tweenValue(value, duration) {\n        if (this.$value != value) {\n            if (this.$tweener) {\n                this.$tweener.paused = true;\n                this.$tweener.removeAllEventListeners();\n                createjs.Tween.removeTweens(this);\n            }\n            this.$tweenValue = this.$value;\n            this.$value = value;\n            this.$tweener = createjs.Tween.get(this, {\n                onChange: Binder.create(this.onUpdateTween, this)\n            }).to({ $tweenValue: value }, duration * 1000, GProgressBar.easeLinear);\n            return this.$tweener;\n        }\n        else\n            return null;\n    }\n    onUpdateTween() {\n        this.update(this.$tweenValue);\n    }\n    update(val) {\n        let percent = this.$max != 0 ? Math.min(val / this.$max, 1) : 0;\n        if (this.$titleObject) {\n            switch (this.$titleType) {\n                case 0 /* Percent */:\n                    this.$titleObject.text = `${Math.round(percent * 100)}%`;\n                    break;\n                case 1 /* ValueAndMax */:\n                    this.$titleObject.text = `${Math.round(val)}/${Math.round(this.$max)}`;\n                    break;\n                case 2 /* Value */:\n                    this.$titleObject.text = `${Math.round(val)}`;\n                    break;\n                case 3 /* Max */:\n                    this.$titleObject.text = `${Math.round(this.$max)}`;\n                    break;\n            }\n        }\n        let fullWidth = this.width - this.$barMaxWidthDelta;\n        let fullHeight = this.height - this.$barMaxHeightDelta;\n        if (!this.$reverse) {\n            if (this.$barObjectH)\n                this.$barObjectH.width = fullWidth * percent;\n            if (this.$barObjectV)\n                this.$barObjectV.height = fullHeight * percent;\n        }\n        else {\n            if (this.$barObjectH) {\n                this.$barObjectH.width = fullWidth * percent;\n                this.$barObjectH.x = this.$barStartX + (fullWidth - this.$barObjectH.width);\n            }\n            if (this.$barObjectV) {\n                this.$barObjectV.height = fullHeight * percent;\n                this.$barObjectV.y = this.$barStartY + (fullHeight - this.$barObjectV.height);\n            }\n        }\n        if (this.$aniObject instanceof GMovieClip)\n            this.$aniObject.frame = Math.round(percent * 100);\n    }\n    constructFromXML(xml) {\n        super.constructFromXML(xml);\n        xml = XmlParser.getChildNodes(xml, 'ProgressBar')[0];\n        let str;\n        str = xml.attributes.titleType;\n        if (str)\n            this.$titleType = ParseProgressTitleType(str);\n        this.$reverse = xml.attributes.reverse == 'true';\n        this.$titleObject = this.getChild('title');\n        this.$barObjectH = this.getChild('bar');\n        this.$barObjectV = this.getChild('bar_v');\n        this.$aniObject = this.getChild('ani');\n        if (this.$barObjectH) {\n            this.$barMaxWidth = this.$barObjectH.width;\n            this.$barMaxWidthDelta = this.width - this.$barMaxWidth;\n            this.$barStartX = this.$barObjectH.x;\n        }\n        if (this.$barObjectV) {\n            this.$barMaxHeight = this.$barObjectV.height;\n            this.$barMaxHeightDelta = this.height - this.$barMaxHeight;\n            this.$barStartY = this.$barObjectV.y;\n        }\n    }\n    handleSizeChanged() {\n        super.handleSizeChanged();\n        if (this.$barObjectH)\n            this.$barMaxWidth = this.width - this.$barMaxWidthDelta;\n        if (this.$barObjectV)\n            this.$barMaxHeight = this.height - this.$barMaxHeightDelta;\n        if (!this.$inProgressBuilding)\n            this.update(this.$value);\n    }\n    setupAfterAdd(xml) {\n        super.setupAfterAdd(xml);\n        xml = XmlParser.getChildNodes(xml, 'ProgressBar')[0];\n        if (xml) {\n            this.$value = parseInt(xml.attributes.value) || 0;\n            this.$max = parseInt(xml.attributes.max) || 0;\n        }\n        this.update(this.$value);\n    }\n    dispose() {\n        if (this.$tweener) {\n            this.$tweener.paused = true;\n            this.$tweener.removeAllEventListeners();\n        }\n        createjs.Tween.removeTweens(this);\n        this.$tweener = null;\n        super.dispose();\n    }\n}\nGProgressBar.easeLinear = ParseEaseType('linear'); // createjs.Ease.getPowIn(1);\n\nclass GScrollBar extends GComponent {\n    constructor() {\n        super();\n        this.$dragOffset = new createjs.Point();\n        this.$scrollPerc = 0;\n    }\n    setScrollPane(target, vertical) {\n        this.$target = target;\n        this.$vertical = vertical;\n    }\n    set displayPerc(val) {\n        if (this.$vertical) {\n            if (!this.$fixedGripSize)\n                this.$grip.height = val * this.$bar.height;\n            this.$grip.y = this.$bar.y + (this.$bar.height - this.$grip.height) * this.$scrollPerc;\n        }\n        else {\n            if (!this.$fixedGripSize)\n                this.$grip.width = val * this.$bar.width;\n            this.$grip.x = this.$bar.x + (this.$bar.width - this.$grip.width) * this.$scrollPerc;\n        }\n    }\n    get scrollPerc() {\n        return this.$scrollPerc;\n    }\n    set scrollPerc(val) {\n        this.$scrollPerc = val;\n        if (this.$vertical)\n            this.$grip.y = this.$bar.y + (this.$bar.height - this.$grip.height) * this.$scrollPerc;\n        else\n            this.$grip.x = this.$bar.x + (this.$bar.width - this.$grip.width) * this.$scrollPerc;\n    }\n    get minSize() {\n        if (this.$vertical)\n            return ((this.$arrowButton1 != null ? this.$arrowButton1.height : 0) +\n                (this.$arrowButton2 != null ? this.$arrowButton2.height : 0));\n        else\n            return ((this.$arrowButton1 != null ? this.$arrowButton1.width : 0) +\n                (this.$arrowButton2 != null ? this.$arrowButton2.width : 0));\n    }\n    constructFromXML(xml) {\n        super.constructFromXML(xml);\n        xml = XmlParser.getChildNodes(xml, 'ScrollBar')[0];\n        if (xml != null)\n            this.$fixedGripSize = xml.attributes.fixedGripSize == 'true';\n        this.$grip = this.getChild('grip');\n        if (!this.$grip) {\n            console.error(\"please create and define 'grip' in the Editor for the scrollbar\");\n            return;\n        }\n        this.$bar = this.getChild('bar');\n        if (!this.$bar) {\n            console.error(\"please create and define 'bar' in the Editor for the scrollbar\");\n            return;\n        }\n        this.$arrowButton1 = this.getChild('arrow1');\n        this.$arrowButton2 = this.getChild('arrow2');\n        this.$grip.on(InteractiveEvents.Down, this.$gripMouseDown, this);\n        if (this.$arrowButton1)\n            this.$arrowButton1.on(InteractiveEvents.Down, this.$arrowButton1Click, this);\n        if (this.$arrowButton2)\n            this.$arrowButton2.on(InteractiveEvents.Down, this.$arrowButton2Click, this);\n        this.on(InteractiveEvents.Down, this.$barMouseDown, this);\n    }\n    $gripMouseDown(evt) {\n        if (!this.$bar)\n            return;\n        evt.stopPropagation();\n        // this.$dragOffset = evt.data.getLocalPosition(this.displayObject, this.$dragOffset);\n        this.$dragOffset = new createjs.Point(evt.localX, evt.localY);\n        this.$dragOffset.x -= this.$grip.x;\n        this.$dragOffset.y -= this.$grip.y;\n        this.$mouseMoveEvent = GRoot.inst.nativeStage.on(InteractiveEvents.Move, this.$gripDragging, this);\n        this.$mouseUpEvent = GRoot.inst.nativeStage.on(InteractiveEvents.Up, this.$gripDraggingEnd, this);\n    }\n    $gripDragging(evt) {\n        let pt = evt.target.localToLocal(evt.localX, evt.localY, this.$displayObject); // todo\n        if (GScrollBar.sScrollbarHelperPoint.x == 0 && GScrollBar.sScrollbarHelperPoint.y == 0) {\n            GScrollBar.sScrollbarHelperPoint.x = this.$target['$xPos'];\n            GScrollBar.sScrollbarHelperPoint.y = this.$target['$yPos'];\n        }\n        pt.x -= GScrollBar.sScrollbarHelperPoint.x;\n        pt.y -= GScrollBar.sScrollbarHelperPoint.y;\n        if (this.$vertical) {\n            let curY = pt.y - this.$dragOffset.y;\n            this.$target.setPercY((curY - this.$bar.y) / (this.$bar.height - this.$grip.height), false);\n        }\n        else {\n            let curX = pt.x - this.$dragOffset.x;\n            this.$target.setPercX((curX - this.$bar.x) / (this.$bar.width - this.$grip.width), false);\n        }\n    }\n    $gripDraggingEnd(evt) {\n        GScrollBar.sScrollbarHelperPoint = new createjs.Point();\n        GRoot.inst.nativeStage.off(InteractiveEvents.Move, this.$mouseMoveEvent);\n        GRoot.inst.nativeStage.off(InteractiveEvents.Up, this.$mouseUpEvent);\n    }\n    $arrowButton1Click(evt) {\n        evt.stopPropagation();\n        if (this.$vertical)\n            this.$target.scrollUp();\n        else\n            this.$target.scrollLeft();\n    }\n    $arrowButton2Click(evt) {\n        evt.stopPropagation();\n        if (this.$vertical)\n            this.$target.scrollDown();\n        else\n            this.$target.scrollRight();\n    }\n    $barMouseDown(evt) {\n        let pt = new createjs.Point(evt.localX, evt.localY);\n        // let pt: createjs.Point = evt.data.getLocalPosition(this.$grip.displayObject, GScrollBar.sScrollbarHelperPoint);\n        if (this.$vertical) {\n            if (pt.y < 0)\n                this.$target.scrollUp(4);\n            else\n                this.$target.scrollDown(4);\n        }\n        else {\n            if (pt.x < 0)\n                this.$target.scrollLeft(4);\n            else\n                this.$target.scrollRight(4);\n        }\n    }\n    dispose() {\n        this.off(InteractiveEvents.Down, this.$barMouseDown);\n        GScrollBar.sScrollbarHelperPoint = new createjs.Point();\n        if (this.$arrowButton1)\n            this.$arrowButton1.off(InteractiveEvents.Down, this.$arrowButton1Click);\n        if (this.$arrowButton2)\n            this.$arrowButton2.off(InteractiveEvents.Down, this.$arrowButton2Click);\n        this.$grip.off(InteractiveEvents.Down, this.$gripMouseDown);\n        this.$gripDraggingEnd(null);\n        super.dispose();\n    }\n}\nGScrollBar.sScrollbarHelperPoint = new createjs.Point();\n\nclass ItemInfo {\n    constructor() {\n        this.width = 0;\n        this.height = 0;\n        this.updateFlag = 0;\n        this.selected = false;\n    }\n}\nclass GList extends GComponent {\n    constructor() {\n        super();\n        this.$lineCount = 0;\n        this.$columnCount = 0;\n        this.$lineGap = 0;\n        this.$columnGap = 0;\n        this.$lastSelectedIndex = 0;\n        this.$numItems = 0;\n        this.$firstIndex = 0; //top left index\n        this.$curLineItemCount = 0; //item count in one line\n        this.$virtualListChanged = 0 /* None */;\n        //render sorting type\n        this.$apexIndex = 0;\n        this.$childrenRenderOrder = 0 /* Ascent */;\n        this.$itemInfoVer = 0; //is the item used in the current handling or not\n        this.$enterCounter = 0; //because the handleScroll function can be re-entered, so this variable is used to avoid dead-lock\n        this.$trackBounds = true;\n        this.$pool = new GObjectRecycler();\n        this.$layout = 0 /* SingleColumn */;\n        this.$autoResizeItem = true;\n        this.$lastSelectedIndex = -1;\n        this.$selectionMode = 0 /* Single */;\n        this.opaque = true;\n        this.scrollItemToViewOnClick = true;\n        this.$align = \"left\" /* Left */;\n        this.$verticalAlign = 0 /* Top */;\n        this.$container = new createjs.Container();\n        this.$rootContainer.addChild(this.$container);\n        this.$container.cursor = 'pointer';\n    }\n    get childrenRenderOrder() {\n        return this.$childrenRenderOrder;\n    }\n    set childrenRenderOrder(value) {\n        if (this.$childrenRenderOrder != value) {\n            this.$childrenRenderOrder = value;\n            this.appendChildrenList();\n        }\n    }\n    get apexIndex() {\n        return this.$apexIndex;\n    }\n    set apexIndex(value) {\n        if (this.$apexIndex != value) {\n            this.$apexIndex = value;\n            if (this.$childrenRenderOrder == 2 /* Arch */)\n                this.appendChildrenList();\n        }\n    }\n    /**@override */\n    appendChildrenList() {\n        const cnt = this.$children.length;\n        if (cnt == 0)\n            return;\n        let i;\n        let child;\n        switch (this.$childrenRenderOrder) {\n            case 0 /* Ascent */:\n                {\n                    for (i = 0; i < cnt; i++) {\n                        child = this.$children[i];\n                        if (child.displayObject != null && child.finalVisible)\n                            this.$container.addChild(child.displayObject);\n                    }\n                }\n                break;\n            case 1 /* Descent */:\n                {\n                    for (i = cnt - 1; i >= 0; i--) {\n                        child = this.$children[i];\n                        if (child.displayObject != null && child.finalVisible)\n                            this.$container.addChild(child.displayObject);\n                    }\n                }\n                break;\n            case 2 /* Arch */:\n                {\n                    for (i = 0; i < this.$apexIndex; i++) {\n                        child = this.$children[i];\n                        if (child.displayObject != null && child.finalVisible)\n                            this.$container.addChild(child.displayObject);\n                    }\n                    for (i = cnt - 1; i >= this.$apexIndex; i--) {\n                        child = this.$children[i];\n                        if (child.displayObject != null && child.finalVisible)\n                            this.$container.addChild(child.displayObject);\n                    }\n                }\n                break;\n        }\n    }\n    /**@override */\n    setXY(xv, yv) {\n        if (this.$x != xv || this.$y != yv) {\n            this.$x = xv;\n            this.$y = yv;\n            this.handleXYChanged();\n            this.updateGear(1 /* XY */);\n            if (GObject.draggingObject == this && !GObject.sUpdatingWhileDragging)\n                this.localToGlobalRect(0, 0, this.width, this.height, GObject.sGlobalRect);\n        }\n    }\n    /**@override */\n    $setChildIndex(child, oldIndex, index = 0) {\n        let cnt = this.$children.length;\n        if (index > cnt)\n            index = cnt;\n        if (oldIndex == index)\n            return oldIndex;\n        this.$children.splice(oldIndex, 1);\n        this.$children.splice(index, 0, child);\n        if (child.inContainer) {\n            let displayIndex = 0;\n            let g;\n            let i;\n            if (this.$childrenRenderOrder == 0 /* Ascent */) {\n                for (i = 0; i < index; i++) {\n                    g = this.$children[i];\n                    if (g.inContainer)\n                        displayIndex++;\n                }\n                if (displayIndex == this.$container.children.length)\n                    displayIndex--;\n                this.$container.setChildIndex(child.displayObject, displayIndex);\n            }\n            else if (this.$childrenRenderOrder == 1 /* Descent */) {\n                for (i = cnt - 1; i > index; i--) {\n                    g = this.$children[i];\n                    if (g.inContainer)\n                        displayIndex++;\n                }\n                if (displayIndex == this.$container.children.length)\n                    displayIndex--;\n                this.$container.setChildIndex(child.displayObject, displayIndex);\n            }\n            else\n                GTimer.inst.callLater(this.appendChildrenList, this);\n            this.setBoundsChangedFlag();\n        }\n        return index;\n    }\n    /**@override */\n    childStateChanged(child) {\n        if (this.$buildingDisplayList)\n            return;\n        if (child instanceof GGroup) {\n            this.$children.forEach(g => {\n                if (g.group == child)\n                    this.childStateChanged(g);\n            }, this);\n            return;\n        }\n        if (!child.displayObject)\n            return;\n        if (child.finalVisible) {\n            let i, g;\n            let cnt = this.$children.length;\n            if (!child.displayObject.parent) {\n                let index = 0;\n                if (this.$childrenRenderOrder == 0 /* Ascent */) {\n                    for (let i = 0; i < cnt; i++) {\n                        g = this.$children[i];\n                        if (g == child)\n                            break;\n                        if (g.displayObject != null && g.displayObject.parent != null)\n                            index++;\n                    }\n                    this.$container.addChildAt(child.displayObject, index);\n                }\n                else if (this.$childrenRenderOrder == 1 /* Descent */) {\n                    for (i = cnt - 1; i >= 0; i--) {\n                        g = this.$children[i];\n                        if (g == child)\n                            break;\n                        if (g.displayObject != null && g.displayObject.parent != null)\n                            index++;\n                    }\n                    this.$container.addChildAt(child.displayObject, index);\n                }\n                else {\n                    this.$container.addChild(child.displayObject);\n                    GTimer.inst.callLater(this.appendChildrenList, this);\n                }\n            }\n        }\n        else {\n            if (child.displayObject.parent)\n                this.$container.removeChild(child.displayObject);\n        }\n    }\n    dispose() {\n        GTimer.inst.remove(this.$refreshVirtualList, this);\n        this.$pool.clear();\n        if (this.$scrollPane)\n            this.$scrollPane.off(\"__scroll\" /* SCROLL */, this.$scrolled);\n        super.dispose();\n    }\n    get layout() {\n        return this.$layout;\n    }\n    set layout(value) {\n        if (this.$layout != value) {\n            this.$layout = value;\n            this.setBoundsChangedFlag();\n            if (this.$virtual)\n                this.setVirtualListChangedFlag(true);\n        }\n    }\n    get lineCount() {\n        return this.$lineCount;\n    }\n    set lineCount(value) {\n        if (this.$lineCount != value) {\n            this.$lineCount = value;\n            if (this.$layout == 3 /* FlowVertical */ ||\n                this.$layout == 4 /* Pagination */) {\n                this.setBoundsChangedFlag();\n                if (this.$virtual)\n                    this.setVirtualListChangedFlag(true);\n            }\n        }\n    }\n    get columnCount() {\n        return this.$columnCount;\n    }\n    set columnCount(value) {\n        if (this.$columnCount != value) {\n            this.$columnCount = value;\n            if (this.$layout == 2 /* FlowHorizontal */ ||\n                this.$layout == 4 /* Pagination */) {\n                this.setBoundsChangedFlag();\n                if (this.$virtual)\n                    this.setVirtualListChangedFlag(true);\n            }\n        }\n    }\n    get lineGap() {\n        return this.$lineGap;\n    }\n    set lineGap(value) {\n        if (this.$lineGap != value) {\n            this.$lineGap = value;\n            this.setBoundsChangedFlag();\n            if (this.$virtual)\n                this.setVirtualListChangedFlag(true);\n        }\n    }\n    get columnGap() {\n        return this.$columnGap;\n    }\n    set columnGap(value) {\n        if (this.$columnGap != value) {\n            this.$columnGap = value;\n            this.setBoundsChangedFlag();\n            if (this.$virtual)\n                this.setVirtualListChangedFlag(true);\n        }\n    }\n    get align() {\n        return this.$align;\n    }\n    set align(value) {\n        if (this.$align != value) {\n            this.$align = value;\n            this.setBoundsChangedFlag();\n            if (this.$virtual)\n                this.setVirtualListChangedFlag(true);\n        }\n    }\n    get verticalAlign() {\n        return this.$verticalAlign;\n    }\n    set verticalAlign(value) {\n        if (this.$verticalAlign != value) {\n            this.$verticalAlign = value;\n            this.setBoundsChangedFlag();\n            if (this.$virtual)\n                this.setVirtualListChangedFlag(true);\n        }\n    }\n    get virtualItemSize() {\n        return this.$itemSize;\n    }\n    set virtualItemSize(value) {\n        if (this.$virtual) {\n            if (this.$itemSize == null)\n                this.$itemSize = new createjs.Point();\n            this.$itemSize.copy(value);\n            this.setVirtualListChangedFlag(true);\n        }\n    }\n    get defaultItem() {\n        return this.$defaultItem;\n    }\n    set defaultItem(val) {\n        this.$defaultItem = val;\n    }\n    get autoResizeItem() {\n        return this.$autoResizeItem;\n    }\n    set autoResizeItem(value) {\n        if (this.$autoResizeItem != value) {\n            this.$autoResizeItem = value;\n            this.setBoundsChangedFlag();\n            if (this.$virtual)\n                this.setVirtualListChangedFlag(true);\n        }\n    }\n    get selectionMode() {\n        return this.$selectionMode;\n    }\n    set selectionMode(value) {\n        this.$selectionMode = value;\n    }\n    get selectionController() {\n        return this.$selectionController;\n    }\n    set selectionController(value) {\n        this.$selectionController = value;\n    }\n    get itemPool() {\n        return this.$pool;\n    }\n    getFromPool(url = null) {\n        if (!url)\n            url = this.$defaultItem;\n        let obj = this.$pool.get(url);\n        if (obj != null)\n            obj.visible = true;\n        return obj;\n    }\n    returnToPool(obj) {\n        this.$pool.recycle(obj.resourceURL, obj);\n    }\n    addChildAt(child, index = 0) {\n        super.addChildAt(child, index);\n        if (child instanceof GButton) {\n            child.selected = false;\n            child.changeStateOnClick = false;\n        }\n        child.click(this.$clickItem, this);\n        return child;\n    }\n    addItem(url = null) {\n        if (!url)\n            url = this.$defaultItem;\n        return this.addChild(UIPackage.createObjectFromURL(url));\n    }\n    addItemFromPool(url = null) {\n        return this.addChild(this.getFromPool(url));\n    }\n    removeChildAt(index, dispose = false) {\n        if (index >= 0 && index < this.numChildren) {\n            let child = this.$children[index];\n            child.parent = null;\n            if (child.sortingOrder != 0)\n                this.$sortingChildCount--;\n            this.$children.splice(index, 1);\n            if (child.inContainer) {\n                this.$container.removeChild(child.displayObject);\n                if (this.$childrenRenderOrder == 2 /* Arch */)\n                    GTimer.inst.callLater(this.appendChildrenList, this);\n            }\n            if (dispose === true)\n                child.dispose();\n            this.setBoundsChangedFlag();\n            child.removeClick(this.$clickItem);\n            return child;\n        }\n        else\n            throw new Error('Invalid child index');\n    }\n    removeChildToPoolAt(index) {\n        let child = this.removeChildAt(index);\n        this.returnToPool(child);\n    }\n    removeChildToPool(child) {\n        super.removeChild(child);\n        this.returnToPool(child);\n    }\n    removeChildrenToPool(beginIndex = 0, endIndex = -1) {\n        if (endIndex < 0 || endIndex >= this.$children.length)\n            endIndex = this.$children.length - 1;\n        for (let i = beginIndex; i <= endIndex; ++i)\n            this.removeChildToPoolAt(beginIndex);\n    }\n    get selectedIndex() {\n        let i;\n        if (this.$virtual) {\n            for (i = 0; i < this.$realNumItems; i++) {\n                const ii = this.$virtualItems[i];\n                if ((ii.obj instanceof GButton && ii.obj.selected) || (ii.obj == null && ii.selected)) {\n                    if (this.$loop)\n                        return i % this.$numItems;\n                    else\n                        return i;\n                }\n            }\n        }\n        else {\n            const cnt = this.$children.length;\n            for (i = 0; i < cnt; i++) {\n                const obj = this.$children[i];\n                if (obj != null && obj.selected)\n                    return i;\n            }\n        }\n        return -1;\n    }\n    set selectedIndex(value) {\n        if (value >= 0 && value < this.numItems) {\n            if (this.selectionMode != 0 /* Single */)\n                this.clearSelection();\n            this.addSelection(value);\n        }\n        else\n            this.clearSelection();\n    }\n    getSelection() {\n        let ret = [];\n        let i;\n        if (this.$virtual) {\n            for (i = 0; i < this.$realNumItems; i++) {\n                const ii = this.$virtualItems[i];\n                if ((ii.obj instanceof GButton && ii.obj.selected) || (ii.obj == null && ii.selected)) {\n                    let j = i;\n                    if (this.$loop) {\n                        j = i % this.$numItems;\n                        if (ret.indexOf(j) != -1)\n                            continue;\n                    }\n                    ret.push(j);\n                }\n            }\n        }\n        else {\n            const cnt = this.$children.length;\n            for (i = 0; i < cnt; i++) {\n                const obj = this.$children[i];\n                if (obj != null && obj.selected)\n                    ret.push(i);\n            }\n        }\n        return ret;\n    }\n    addSelection(index, scrollIntoView = false) {\n        if (this.$selectionMode == 3 /* None */)\n            return;\n        this.checkVirtualList();\n        if (this.$selectionMode == 0 /* Single */)\n            this.clearSelection();\n        if (scrollIntoView)\n            this.scrollToView(index);\n        this.$lastSelectedIndex = index;\n        let obj = null;\n        if (this.$virtual) {\n            const ii = this.$virtualItems[index];\n            if (ii.obj != null)\n                obj = ii.obj;\n            ii.selected = true;\n        }\n        else\n            obj = this.getChildAt(index);\n        if (obj != null && !obj.selected) {\n            obj.selected = true;\n            this.updateSelectionController(index);\n        }\n    }\n    removeSelection(index) {\n        if (this.$selectionMode == 3 /* None */)\n            return;\n        let obj = null;\n        if (this.$virtual) {\n            const ii = this.$virtualItems[index];\n            if (ii.obj != null)\n                obj = ii.obj;\n            ii.selected = false;\n        }\n        else\n            obj = this.getChildAt(index);\n        if (obj != null)\n            obj.selected = false;\n    }\n    clearSelection() {\n        let i;\n        if (this.$virtual) {\n            for (i = 0; i < this.$realNumItems; i++) {\n                const ii = this.$virtualItems[i];\n                if (ii.obj instanceof GButton)\n                    ii.obj.selected = false;\n                ii.selected = false;\n            }\n        }\n        else {\n            const cnt = this.$children.length;\n            for (i = 0; i < cnt; i++) {\n                const obj = this.$children[i];\n                if (obj != null)\n                    obj.selected = false;\n            }\n        }\n    }\n    clearSelectionExcept(g) {\n        let i;\n        if (this.$virtual) {\n            for (i = 0; i < this.$realNumItems; i++) {\n                const ii = this.$virtualItems[i];\n                if (ii.obj != g) {\n                    if (ii.obj instanceof GButton)\n                        ii.obj.selected = false;\n                    ii.selected = false;\n                }\n            }\n        }\n        else {\n            const cnt = this.$children.length;\n            for (i = 0; i < cnt; i++) {\n                const obj = this.$children[i];\n                if (obj != null && obj != g)\n                    obj.selected = false;\n            }\n        }\n    }\n    selectAll() {\n        this.checkVirtualList();\n        let last = -1;\n        let i;\n        if (this.$virtual) {\n            for (i = 0; i < this.$realNumItems; i++) {\n                const ii = this.$virtualItems[i];\n                if (ii.obj instanceof GButton && !ii.obj.selected) {\n                    ii.obj.selected = true;\n                    last = i;\n                }\n                ii.selected = true;\n            }\n        }\n        else {\n            const cnt = this.$children.length;\n            for (i = 0; i < cnt; i++) {\n                const obj = this.$children[i];\n                if (obj != null && !obj.selected) {\n                    obj.selected = true;\n                    last = i;\n                }\n            }\n        }\n        if (last != -1)\n            this.updateSelectionController(last);\n    }\n    selectNone() {\n        this.clearSelection();\n    }\n    selectReverse() {\n        this.checkVirtualList();\n        let last = -1;\n        let i;\n        if (this.$virtual) {\n            for (i = 0; i < this.$realNumItems; i++) {\n                const ii = this.$virtualItems[i];\n                if (ii.obj instanceof GButton) {\n                    ii.obj.selected = !ii.obj.selected;\n                    if (ii.obj.selected)\n                        last = i;\n                }\n                ii.selected = !ii.selected;\n            }\n        }\n        else {\n            const cnt = this.$children.length;\n            for (i = 0; i < cnt; i++) {\n                const obj = this.$children[i];\n                if (obj != null) {\n                    obj.selected = !obj.selected;\n                    if (obj.selected)\n                        last = i;\n                }\n            }\n        }\n        if (last != -1)\n            this.updateSelectionController(last);\n    }\n    handleArrowKey(key) {\n        let index = this.selectedIndex;\n        if (index == -1)\n            return;\n        let current;\n        let k, i;\n        let obj;\n        switch (key) {\n            case 38 /* Up */:\n                if (this.$layout == 0 /* SingleColumn */ ||\n                    this.$layout == 3 /* FlowVertical */) {\n                    index--;\n                    if (index >= 0) {\n                        this.clearSelection();\n                        this.addSelection(index, true);\n                    }\n                }\n                else if (this.$layout == 2 /* FlowHorizontal */ ||\n                    this.$layout == 4 /* Pagination */) {\n                    current = this.$children[index];\n                    k = 0;\n                    for (i = index - 1; i >= 0; i--) {\n                        obj = this.$children[i];\n                        if (obj.y != current.y) {\n                            current = obj;\n                            break;\n                        }\n                        k++;\n                    }\n                    for (; i >= 0; i--) {\n                        obj = this.$children[i];\n                        if (obj.y != current.y) {\n                            this.clearSelection();\n                            this.addSelection(i + k + 1, true);\n                            break;\n                        }\n                    }\n                }\n                break;\n            case 39 /* Right */:\n                if (this.$layout == 1 /* SingleRow */ ||\n                    this.$layout == 2 /* FlowHorizontal */ ||\n                    this.$layout == 4 /* Pagination */) {\n                    index++;\n                    if (index < this.$children.length) {\n                        this.clearSelection();\n                        this.addSelection(index, true);\n                    }\n                }\n                else if (this.$layout == 3 /* FlowVertical */) {\n                    current = this.$children[index];\n                    k = 0;\n                    const cnt = this.$children.length;\n                    for (i = index + 1; i < cnt; i++) {\n                        obj = this.$children[i];\n                        if (obj.x != current.x) {\n                            current = obj;\n                            break;\n                        }\n                        k++;\n                    }\n                    for (; i < cnt; i++) {\n                        obj = this.$children[i];\n                        if (obj.x != current.x) {\n                            this.clearSelection();\n                            this.addSelection(i - k - 1, true);\n                            break;\n                        }\n                    }\n                }\n                break;\n            case 40 /* Down */:\n                if (this.$layout == 0 /* SingleColumn */ ||\n                    this.$layout == 3 /* FlowVertical */) {\n                    index++;\n                    if (index < this.$children.length) {\n                        this.clearSelection();\n                        this.addSelection(index, true);\n                    }\n                }\n                else if (this.$layout == 2 /* FlowHorizontal */ ||\n                    this.$layout == 4 /* Pagination */) {\n                    current = this.$children[index];\n                    k = 0;\n                    const cnt = this.$children.length;\n                    for (i = index + 1; i < cnt; i++) {\n                        obj = this.$children[i];\n                        if (obj.y != current.y) {\n                            current = obj;\n                            break;\n                        }\n                        k++;\n                    }\n                    for (; i < cnt; i++) {\n                        obj = this.$children[i];\n                        if (obj.y != current.y) {\n                            this.clearSelection();\n                            this.addSelection(i - k - 1, true);\n                            break;\n                        }\n                    }\n                }\n                break;\n            case 37 /* Left */:\n                if (this.$layout == 1 /* SingleRow */ ||\n                    this.$layout == 2 /* FlowHorizontal */ ||\n                    this.$layout == 4 /* Pagination */) {\n                    index--;\n                    if (index >= 0) {\n                        this.clearSelection();\n                        this.addSelection(index, true);\n                    }\n                }\n                else if (this.$layout == 3 /* FlowVertical */) {\n                    current = this.$children[index];\n                    k = 0;\n                    for (i = index - 1; i >= 0; i--) {\n                        obj = this.$children[i];\n                        if (obj.x != current.x) {\n                            current = obj;\n                            break;\n                        }\n                        k++;\n                    }\n                    for (; i >= 0; i--) {\n                        obj = this.$children[i];\n                        if (obj.x != current.x) {\n                            this.clearSelection();\n                            this.addSelection(i + k + 1, true);\n                            break;\n                        }\n                    }\n                }\n                break;\n        }\n    }\n    $clickItem(evt) {\n        if (this.$scrollPane != null && this.$scrollPane.isDragging)\n            return;\n        const item = GObject.castFromNativeObject(evt.currentTarget);\n        if (!item)\n            return;\n        this.setSelectionOnEvent(item);\n        if (this.$scrollPane && this.scrollItemToViewOnClick)\n            this.$scrollPane.scrollToView(item, true);\n        let event = new createjs.Event(\"__itemClick\" /* ItemClick */, true, false);\n        event.data = { item };\n        this.dispatchEvent(event, this);\n    }\n    setSelectionOnEvent(button) {\n        if (!(button instanceof GButton) || this.$selectionMode == 3 /* None */)\n            return;\n        let dontChangeLastIndex = false;\n        let index = this.childIndexToItemIndex(this.getChildIndex(button));\n        if (this.$selectionMode == 0 /* Single */) {\n            if (!button.selected) {\n                this.clearSelectionExcept(button);\n                button.selected = true;\n            }\n        }\n        else {\n            if (DOMEventManager.inst.isKeyPressed(16 /* Shift */)) {\n                if (!button.selected) {\n                    if (this.$lastSelectedIndex != -1) {\n                        const min = Math.min(this.$lastSelectedIndex, index);\n                        const max = Math.min(Math.max(this.$lastSelectedIndex, index), this.numItems - 1);\n                        let i;\n                        if (this.$virtual) {\n                            for (i = min; i <= max; i++) {\n                                const ii = this.$virtualItems[i];\n                                if (ii.obj instanceof GButton)\n                                    ii.obj.selected = true;\n                                ii.selected = true;\n                            }\n                        }\n                        else {\n                            for (i = min; i <= max; i++) {\n                                const obj = this.getChildAt(i);\n                                if (obj != null)\n                                    obj.selected = true;\n                            }\n                        }\n                        dontChangeLastIndex = true;\n                    }\n                    else\n                        button.selected = true;\n                }\n            }\n            else if (DOMEventManager.inst.isKeyPressed(17 /* Ctrl */) ||\n                this.$selectionMode == 2 /* Multiple_SingleClick */)\n                button.selected = !button.selected;\n            else {\n                if (!button.selected) {\n                    this.clearSelectionExcept(button);\n                    button.selected = true;\n                }\n                else\n                    this.clearSelectionExcept(button);\n            }\n        }\n        if (!dontChangeLastIndex)\n            this.$lastSelectedIndex = index;\n        if (button.selected)\n            this.updateSelectionController(index);\n    }\n    resizeToFit(itemCount = 1000000, minSize = 0) {\n        this.ensureBoundsCorrect();\n        const curCount = this.numItems;\n        if (itemCount > curCount)\n            itemCount = curCount;\n        if (this.$virtual) {\n            const lineCount = Math.ceil(itemCount / this.$curLineItemCount);\n            if (this.$layout == 0 /* SingleColumn */ ||\n                this.$layout == 2 /* FlowHorizontal */)\n                this.viewHeight = lineCount * this.$itemSize.y + Math.max(0, lineCount - 1) * this.$lineGap;\n            else\n                this.viewWidth = lineCount * this.$itemSize.x + Math.max(0, lineCount - 1) * this.$columnGap;\n        }\n        else if (itemCount == 0) {\n            if (this.$layout == 0 /* SingleColumn */ ||\n                this.$layout == 2 /* FlowHorizontal */)\n                this.viewHeight = minSize;\n            else\n                this.viewWidth = minSize;\n        }\n        else {\n            let i = itemCount - 1;\n            let obj;\n            while (i >= 0) {\n                obj = this.getChildAt(i);\n                if (!this.foldInvisibleItems || obj.visible)\n                    break;\n                i--;\n            }\n            if (i < 0) {\n                if (this.$layout == 0 /* SingleColumn */ ||\n                    this.$layout == 2 /* FlowHorizontal */)\n                    this.viewHeight = minSize;\n                else\n                    this.viewWidth = minSize;\n            }\n            else {\n                let size = 0;\n                if (this.$layout == 0 /* SingleColumn */ ||\n                    this.$layout == 2 /* FlowHorizontal */) {\n                    size = obj.y + obj.height;\n                    if (size < minSize)\n                        size = minSize;\n                    this.viewHeight = size;\n                }\n                else {\n                    size = obj.x + obj.width;\n                    if (size < minSize)\n                        size = minSize;\n                    this.viewWidth = size;\n                }\n            }\n        }\n    }\n    getMaxItemWidth() {\n        const cnt = this.$children.length;\n        let max = 0;\n        for (let i = 0; i < cnt; i++) {\n            const child = this.getChildAt(i);\n            if (child.width > max)\n                max = child.width;\n        }\n        return max;\n    }\n    handleSizeChanged() {\n        super.handleSizeChanged();\n        this.setBoundsChangedFlag();\n        if (this.$virtual)\n            this.setVirtualListChangedFlag(true);\n    }\n    handleControllerChanged(c) {\n        super.handleControllerChanged(c);\n        if (this.$selectionController == c)\n            this.selectedIndex = c.selectedIndex;\n    }\n    updateSelectionController(index) {\n        if (this.$selectionController != null &&\n            !this.$selectionController.$updating &&\n            index < this.selectionController.pageCount) {\n            const c = this.$selectionController;\n            this.$selectionController = null;\n            c.selectedIndex = index;\n            this.$selectionController = c;\n        }\n    }\n    getSnappingPosition(xValue, yValue, resultPoint = null) {\n        if (this.$virtual) {\n            if (!resultPoint)\n                resultPoint = new createjs.Point();\n            let saved;\n            let index;\n            if (this.$layout == 0 /* SingleColumn */ ||\n                this.$layout == 2 /* FlowHorizontal */) {\n                saved = yValue;\n                GList.$lastPosHelper = yValue;\n                index = this.getIndexOnPos1(false);\n                yValue = GList.$lastPosHelper;\n                if (index < this.$virtualItems.length &&\n                    saved - yValue > this.$virtualItems[index].height / 2 &&\n                    index < this.$realNumItems)\n                    yValue += this.$virtualItems[index].height + this.$lineGap;\n            }\n            else if (this.$layout == 1 /* SingleRow */ ||\n                this.$layout == 3 /* FlowVertical */) {\n                saved = xValue;\n                GList.$lastPosHelper = xValue;\n                index = this.getIndexOnPos2(false);\n                xValue = GList.$lastPosHelper;\n                if (index < this.$virtualItems.length &&\n                    saved - xValue > this.$virtualItems[index].width / 2 &&\n                    index < this.$realNumItems)\n                    xValue += this.$virtualItems[index].width + this.$columnGap;\n            }\n            else {\n                saved = xValue;\n                GList.$lastPosHelper = xValue;\n                index = this.getIndexOnPos3(false);\n                xValue = GList.$lastPosHelper;\n                if (index < this.$virtualItems.length &&\n                    saved - xValue > this.$virtualItems[index].width / 2 &&\n                    index < this.$realNumItems)\n                    xValue += this.$virtualItems[index].width + this.$columnGap;\n            }\n            resultPoint.x = xValue;\n            resultPoint.y = yValue;\n            return resultPoint;\n        }\n        else\n            return super.getSnappingPosition(xValue, yValue, resultPoint);\n    }\n    scrollToView(index, ani = false, snapToFirst = false) {\n        if (this.$virtual) {\n            if (this.$numItems == 0)\n                return;\n            this.checkVirtualList();\n            if (index >= this.$virtualItems.length)\n                throw new Error(`Invalid child index: ${index} is larger than max length: ${this.$virtualItems.length}`);\n            if (this.$loop)\n                index = Math.floor(this.$firstIndex / this.$numItems) * this.$numItems + index;\n            let rect;\n            const ii = this.$virtualItems[index];\n            let pos = 0;\n            let i;\n            if (this.$layout == 0 /* SingleColumn */ ||\n                this.$layout == 2 /* FlowHorizontal */) {\n                for (i = 0; i < index; i += this.$curLineItemCount)\n                    pos += this.$virtualItems[i].height + this.$lineGap;\n                rect = new createjs.Rectangle(0, pos, this.$itemSize.x, ii.height);\n            }\n            else if (this.$layout == 1 /* SingleRow */ ||\n                this.$layout == 3 /* FlowVertical */) {\n                for (i = 0; i < index; i += this.$curLineItemCount)\n                    pos += this.$virtualItems[i].width + this.$columnGap;\n                rect = new createjs.Rectangle(pos, 0, ii.width, this.$itemSize.y);\n            }\n            else {\n                const page = index / (this.$curLineItemCount * this.$curLineItemCount2);\n                rect = new createjs.Rectangle(page * this.viewWidth + (index % this.$curLineItemCount) * (ii.width + this.$columnGap), ((index / this.$curLineItemCount) % this.$curLineItemCount2) *\n                    (ii.height + this.$lineGap), ii.width, ii.height);\n            }\n            //the position will be also changed if the height of its parent (if changeable) is being changed, so here we need to forcely set this to true\n            snapToFirst = true;\n            if (this.$scrollPane != null)\n                this.$scrollPane.scrollToView(rect, ani, snapToFirst);\n        }\n        else {\n            const obj = this.getChildAt(index);\n            if (this.$scrollPane != null)\n                this.$scrollPane.scrollToView(obj, ani, snapToFirst);\n            else if (this.parent != null && this.parent.scrollPane != null)\n                this.parent.scrollPane.scrollToView(obj, ani, snapToFirst);\n        }\n    }\n    getFirstChildInView() {\n        return this.childIndexToItemIndex(super.getFirstChildInView());\n    }\n    childIndexToItemIndex(index) {\n        if (!this.$virtual)\n            return index;\n        if (this.$layout == 4 /* Pagination */) {\n            for (let i = this.$firstIndex; i < this.$realNumItems; i++) {\n                if (this.$virtualItems[i].obj != null) {\n                    index--;\n                    if (index < 0)\n                        return i;\n                }\n            }\n            return index;\n        }\n        else {\n            index += this.$firstIndex;\n            if (this.$loop && this.$numItems > 0)\n                index = index % this.$numItems;\n            return index;\n        }\n    }\n    itemIndexToChildIndex(index) {\n        if (!this.$virtual)\n            return index;\n        if (this.$layout == 4 /* Pagination */)\n            return this.getChildIndex(this.$virtualItems[index].obj);\n        else {\n            if (this.$loop && this.$numItems > 0) {\n                const j = this.$firstIndex % this.$numItems;\n                if (index >= j)\n                    index = this.$firstIndex + (index - j);\n                else\n                    index = this.$firstIndex + this.$numItems + (j - index);\n            }\n            else\n                index -= this.$firstIndex;\n            return index;\n        }\n    }\n    setVirtual() {\n        this.$setVirtual(false);\n    }\n    setVirtualAndLoop() {\n        this.$setVirtual(true);\n    }\n    $setVirtual(loop) {\n        if (!this.$virtual) {\n            if (this.$scrollPane == null)\n                throw new Error('Virtual list must be scrollable');\n            if (loop) {\n                if (this.$layout == 2 /* FlowHorizontal */ ||\n                    this.$layout == 3 /* FlowVertical */)\n                    throw new Error('Virtual list with loop mode is not supported for both FlowHorizontal and FlowVertical layout');\n                this.$scrollPane.bouncebackEffect = false;\n            }\n            this.$virtual = true;\n            this.$loop = loop;\n            this.$virtualItems = [];\n            this.removeChildrenToPool();\n            if (this.$itemSize == null) {\n                this.$itemSize = new createjs.Point();\n                const obj = this.getFromPool(null);\n                if (obj == null)\n                    throw new Error('Virtual list must have a default list item resource specified through list.defaultItem = resUrl.');\n                else {\n                    this.$itemSize.x = obj.width;\n                    this.$itemSize.y = obj.height;\n                }\n                this.returnToPool(obj);\n            }\n            if (this.$layout == 0 /* SingleColumn */ ||\n                this.$layout == 2 /* FlowHorizontal */) {\n                this.$scrollPane.scrollSpeed = this.$itemSize.y;\n                if (this.$loop)\n                    this.$scrollPane.$loop = 2;\n            }\n            else {\n                this.$scrollPane.scrollSpeed = this.$itemSize.x;\n                if (this.$loop)\n                    this.$scrollPane.$loop = 1;\n            }\n            this.$scrollPane.on(\"__scroll\" /* SCROLL */, this.$scrolled, this);\n            this.setVirtualListChangedFlag(true);\n        }\n    }\n    get numItems() {\n        if (this.$virtual)\n            return this.$numItems;\n        else\n            return this.$children.length;\n    }\n    set numItems(value) {\n        let i;\n        if (this.$virtual) {\n            if (this.itemRenderer == null)\n                throw new Error('list.itemRenderer is required');\n            this.$numItems = value;\n            if (this.$loop)\n                this.$realNumItems = this.$numItems * 6;\n            //enlarge for loop\n            else\n                this.$realNumItems = this.$numItems;\n            //increase only\n            const oldCount = this.$virtualItems.length;\n            if (this.$realNumItems > oldCount) {\n                for (i = oldCount; i < this.$realNumItems; i++) {\n                    let ii = new ItemInfo();\n                    ii.width = this.$itemSize.x;\n                    ii.height = this.$itemSize.y;\n                    this.$virtualItems.push(ii);\n                }\n            }\n            else {\n                for (i = this.$realNumItems; i < oldCount; i++)\n                    this.$virtualItems[i].selected = false;\n            }\n            if (this.$virtualListChanged != 0 /* None */)\n                GTimer.inst.remove(this.$refreshVirtualList, this);\n            //refresh now\n            this.$refreshVirtualList();\n        }\n        else {\n            const cnt = this.$children.length;\n            if (value > cnt) {\n                for (i = cnt; i < value; i++) {\n                    if (this.itemProvider == null)\n                        this.addItemFromPool();\n                    else\n                        this.addItemFromPool(this.itemProvider(i));\n                }\n            }\n            else\n                this.removeChildrenToPool(value, cnt);\n            if (this.itemRenderer != null) {\n                for (i = 0; i < value; i++)\n                    this.itemRenderer(i, this.getChildAt(i));\n            }\n        }\n    }\n    refreshVirtualList() {\n        this.setVirtualListChangedFlag(false);\n    }\n    checkVirtualList() {\n        if (this.$virtualListChanged != 0 /* None */) {\n            this.$refreshVirtualList();\n            GTimer.inst.remove(this.$refreshVirtualList, this);\n        }\n    }\n    setVirtualListChangedFlag(layoutChanged = false) {\n        if (layoutChanged)\n            this.$virtualListChanged = 2 /* SizeChanged */;\n        else if (this.$virtualListChanged == 0 /* None */)\n            this.$virtualListChanged = 1 /* ContentChanged */;\n        GTimer.inst.callLater(this.$refreshVirtualList, this);\n    }\n    $refreshVirtualList() {\n        const layoutChanged = this.$virtualListChanged == 2 /* SizeChanged */;\n        this.$virtualListChanged = 0 /* None */;\n        this.$eventLocked = true;\n        if (layoutChanged) {\n            if (this.$layout == 0 /* SingleColumn */ || this.$layout == 1 /* SingleRow */)\n                this.$curLineItemCount = 1;\n            else if (this.$layout == 2 /* FlowHorizontal */) {\n                if (this.$columnCount > 0)\n                    this.$curLineItemCount = this.$columnCount;\n                else {\n                    this.$curLineItemCount = Math.floor((this.$scrollPane.viewWidth + this.$columnGap) / (this.$itemSize.x + this.$columnGap));\n                    if (this.$curLineItemCount <= 0)\n                        this.$curLineItemCount = 1;\n                }\n            }\n            else if (this.$layout == 3 /* FlowVertical */) {\n                if (this.$lineCount > 0)\n                    this.$curLineItemCount = this.$lineCount;\n                else {\n                    this.$curLineItemCount = Math.floor((this.$scrollPane.viewHeight + this.$lineGap) / (this.$itemSize.y + this.$lineGap));\n                    if (this.$curLineItemCount <= 0)\n                        this.$curLineItemCount = 1;\n                }\n            } //pagination\n            else {\n                if (this.$columnCount > 0)\n                    this.$curLineItemCount = this.$columnCount;\n                else {\n                    this.$curLineItemCount = Math.floor((this.$scrollPane.viewWidth + this.$columnGap) / (this.$itemSize.x + this.$columnGap));\n                    if (this.$curLineItemCount <= 0)\n                        this.$curLineItemCount = 1;\n                }\n                if (this.$lineCount > 0)\n                    this.$curLineItemCount2 = this.$lineCount;\n                else {\n                    this.$curLineItemCount2 = Math.floor((this.$scrollPane.viewHeight + this.$lineGap) / (this.$itemSize.y + this.$lineGap));\n                    if (this.$curLineItemCount2 <= 0)\n                        this.$curLineItemCount2 = 1;\n                }\n            }\n        }\n        let ch = 0, cw = 0;\n        if (this.$realNumItems > 0) {\n            let i;\n            let len = Math.ceil(this.$realNumItems / this.$curLineItemCount) * this.$curLineItemCount;\n            let len2 = Math.min(this.$curLineItemCount, this.$realNumItems);\n            if (this.$layout == 0 /* SingleColumn */ ||\n                this.$layout == 2 /* FlowHorizontal */) {\n                for (i = 0; i < len; i += this.$curLineItemCount)\n                    ch += this.$virtualItems[i].height + this.$lineGap;\n                if (ch > 0)\n                    ch -= this.$lineGap;\n                if (this.$autoResizeItem)\n                    cw = this.$scrollPane.viewWidth;\n                else {\n                    for (i = 0; i < len2; i++)\n                        cw += this.$virtualItems[i].width + this.$columnGap;\n                    if (cw > 0)\n                        cw -= this.$columnGap;\n                }\n            }\n            else if (this.$layout == 1 /* SingleRow */ ||\n                this.$layout == 3 /* FlowVertical */) {\n                for (i = 0; i < len; i += this.$curLineItemCount)\n                    cw += this.$virtualItems[i].width + this.$columnGap;\n                if (cw > 0)\n                    cw -= this.$columnGap;\n                if (this.$autoResizeItem)\n                    ch = this.$scrollPane.viewHeight;\n                else {\n                    for (i = 0; i < len2; i++)\n                        ch += this.$virtualItems[i].height + this.$lineGap;\n                    if (ch > 0)\n                        ch -= this.$lineGap;\n                }\n            }\n            else {\n                const pageCount = Math.ceil(len / (this.$curLineItemCount * this.$curLineItemCount2));\n                cw = pageCount * this.viewWidth;\n                ch = this.viewHeight;\n            }\n        }\n        this.handleAlign(cw, ch);\n        this.$scrollPane.setContentSize(cw, ch);\n        this.$eventLocked = false;\n        this.handleScroll(true);\n    }\n    $scrolled() {\n        this.handleScroll(false);\n    }\n    getIndexOnPos1(forceUpdate) {\n        if (this.$realNumItems < this.$curLineItemCount) {\n            GList.$lastPosHelper = 0;\n            return 0;\n        }\n        let i;\n        let pos2;\n        let pos3;\n        if (this.numChildren > 0 && !forceUpdate) {\n            pos2 = this.getChildAt(0).y;\n            if (pos2 > GList.$lastPosHelper) {\n                for (i = this.$firstIndex - this.$curLineItemCount; i >= 0; i -= this.$curLineItemCount) {\n                    pos2 -= this.$virtualItems[i].height + this.$lineGap;\n                    if (pos2 <= GList.$lastPosHelper) {\n                        GList.$lastPosHelper = pos2;\n                        return i;\n                    }\n                }\n                GList.$lastPosHelper = 0;\n                return 0;\n            }\n            else {\n                for (i = this.$firstIndex; i < this.$realNumItems; i += this.$curLineItemCount) {\n                    pos3 = pos2 + this.$virtualItems[i].height + this.$lineGap;\n                    if (pos3 > GList.$lastPosHelper) {\n                        GList.$lastPosHelper = pos2;\n                        return i;\n                    }\n                    pos2 = pos3;\n                }\n                GList.$lastPosHelper = pos2;\n                return this.$realNumItems - this.$curLineItemCount;\n            }\n        }\n        else {\n            pos2 = 0;\n            for (i = 0; i < this.$realNumItems; i += this.$curLineItemCount) {\n                pos3 = pos2 + this.$virtualItems[i].height + this.$lineGap;\n                if (pos3 > GList.$lastPosHelper) {\n                    GList.$lastPosHelper = pos2;\n                    return i;\n                }\n                pos2 = pos3;\n            }\n            GList.$lastPosHelper = pos2;\n            return this.$realNumItems - this.$curLineItemCount;\n        }\n    }\n    getIndexOnPos2(forceUpdate) {\n        if (this.$realNumItems < this.$curLineItemCount) {\n            GList.$lastPosHelper = 0;\n            return 0;\n        }\n        let i;\n        let pos2;\n        let pos3;\n        if (this.numChildren > 0 && !forceUpdate) {\n            pos2 = this.getChildAt(0).x;\n            if (pos2 > GList.$lastPosHelper) {\n                for (i = this.$firstIndex - this.$curLineItemCount; i >= 0; i -= this.$curLineItemCount) {\n                    pos2 -= this.$virtualItems[i].width + this.$columnGap;\n                    if (pos2 <= GList.$lastPosHelper) {\n                        GList.$lastPosHelper = pos2;\n                        return i;\n                    }\n                }\n                GList.$lastPosHelper = 0;\n                return 0;\n            }\n            else {\n                for (i = this.$firstIndex; i < this.$realNumItems; i += this.$curLineItemCount) {\n                    pos3 = pos2 + this.$virtualItems[i].width + this.$columnGap;\n                    if (pos3 > GList.$lastPosHelper) {\n                        GList.$lastPosHelper = pos2;\n                        return i;\n                    }\n                    pos2 = pos3;\n                }\n                GList.$lastPosHelper = pos2;\n                return this.$realNumItems - this.$curLineItemCount;\n            }\n        }\n        else {\n            pos2 = 0;\n            for (i = 0; i < this.$realNumItems; i += this.$curLineItemCount) {\n                pos3 = pos2 + this.$virtualItems[i].width + this.$columnGap;\n                if (pos3 > GList.$lastPosHelper) {\n                    GList.$lastPosHelper = pos2;\n                    return i;\n                }\n                pos2 = pos3;\n            }\n            GList.$lastPosHelper = pos2;\n            return this.$realNumItems - this.$curLineItemCount;\n        }\n    }\n    getIndexOnPos3(forceUpdate) {\n        if (this.$realNumItems < this.$curLineItemCount) {\n            GList.$lastPosHelper = 0;\n            return 0;\n        }\n        const viewWidth = this.viewWidth;\n        const page = Math.floor(GList.$lastPosHelper / viewWidth);\n        const startIndex = page * (this.$curLineItemCount * this.$curLineItemCount2);\n        let i;\n        let pos3;\n        let pos2 = page * viewWidth;\n        for (i = 0; i < this.$curLineItemCount; i++) {\n            pos3 = pos2 + this.$virtualItems[startIndex + i].width + this.$columnGap;\n            if (pos3 > GList.$lastPosHelper) {\n                GList.$lastPosHelper = pos2;\n                return startIndex + i;\n            }\n            pos2 = pos3;\n        }\n        GList.$lastPosHelper = pos2;\n        return startIndex + this.$curLineItemCount - 1;\n    }\n    handleScroll(forceUpdate) {\n        if (this.$eventLocked)\n            return;\n        this.$enterCounter = 0;\n        if (this.$layout == 0 /* SingleColumn */ ||\n            this.$layout == 2 /* FlowHorizontal */) {\n            this.handleScroll1(forceUpdate);\n            this.handleArchOrder1();\n        }\n        else if (this.$layout == 1 /* SingleRow */ ||\n            this.$layout == 3 /* FlowVertical */) {\n            this.handleScroll2(forceUpdate);\n            this.handleArchOrder2();\n        }\n        else\n            this.handleScroll3(forceUpdate);\n        this.$boundsChanged = false;\n    }\n    handleScroll1(forceUpdate) {\n        this.$enterCounter++;\n        if (this.$enterCounter > 3) {\n            console.warn('this list view cannot be filled full as the itemRenderer function always returns an item with different size.');\n            return;\n        }\n        let pos = this.$scrollPane.scrollingPosY;\n        let max = pos + this.$scrollPane.viewHeight;\n        const end = max == this.$scrollPane.contentHeight; //indicates we need to scroll to end in spite of content size changing\n        //find the first item from current pos\n        GList.$lastPosHelper = pos;\n        const newFirstIndex = this.getIndexOnPos1(forceUpdate);\n        if (newFirstIndex == this.$firstIndex && !forceUpdate)\n            return;\n        pos = GList.$lastPosHelper;\n        const oldFirstIndex = this.$firstIndex;\n        this.$firstIndex = newFirstIndex;\n        let curIndex = newFirstIndex;\n        const forward = oldFirstIndex > newFirstIndex;\n        const oldCount = this.numChildren;\n        const lastIndex = oldFirstIndex + oldCount - 1;\n        let reuseIndex = forward ? lastIndex : oldFirstIndex;\n        let curX = 0, curY = pos;\n        let needRender;\n        let deltaSize = 0;\n        let firstItemDeltaSize = 0;\n        let url = this.defaultItem;\n        let ii, ii2;\n        let i, j;\n        const partSize = (this.$scrollPane.viewWidth - this.$columnGap * (this.$curLineItemCount - 1)) /\n            this.$curLineItemCount;\n        this.$itemInfoVer++;\n        while (curIndex < this.$realNumItems && (end || curY < max)) {\n            ii = this.$virtualItems[curIndex];\n            if (ii.obj == null || forceUpdate) {\n                if (this.itemProvider != null) {\n                    url = this.itemProvider(curIndex % this.$numItems);\n                    if (url == null)\n                        url = this.$defaultItem;\n                    url = UIPackage.normalizeURL(url);\n                }\n                if (ii.obj != null && ii.obj.resourceURL != url) {\n                    if (ii.obj instanceof GButton)\n                        ii.selected = ii.obj.selected;\n                    this.removeChildToPool(ii.obj);\n                    ii.obj = null;\n                }\n            }\n            if (ii.obj == null) {\n                //search for a most suitable item to reuse in order to render or create less item when refresh\n                if (forward) {\n                    for (j = reuseIndex; j >= oldFirstIndex; j--) {\n                        ii2 = this.$virtualItems[j];\n                        if (ii2.obj != null &&\n                            ii2.updateFlag != this.$itemInfoVer &&\n                            ii2.obj.resourceURL == url) {\n                            if (ii2.obj instanceof GButton)\n                                ii2.selected = ii2.obj.selected;\n                            ii.obj = ii2.obj;\n                            ii2.obj = null;\n                            if (j == reuseIndex)\n                                reuseIndex--;\n                            break;\n                        }\n                    }\n                }\n                else {\n                    for (j = reuseIndex; j <= lastIndex; j++) {\n                        ii2 = this.$virtualItems[j];\n                        if (ii2.obj != null &&\n                            ii2.updateFlag != this.$itemInfoVer &&\n                            ii2.obj.resourceURL == url) {\n                            if (ii2.obj instanceof GButton)\n                                ii2.selected = ii2.obj.selected;\n                            ii.obj = ii2.obj;\n                            ii2.obj = null;\n                            if (j == reuseIndex)\n                                reuseIndex++;\n                            break;\n                        }\n                    }\n                }\n                if (ii.obj != null)\n                    this.setChildIndex(ii.obj, forward ? curIndex - newFirstIndex : this.numChildren);\n                else {\n                    ii.obj = this.$pool.get(url);\n                    if (forward)\n                        this.addChildAt(ii.obj, curIndex - newFirstIndex);\n                    else\n                        this.addChild(ii.obj);\n                }\n                if (ii.obj instanceof GButton)\n                    ii.obj.selected = ii.selected;\n                needRender = true;\n            }\n            else\n                needRender = forceUpdate;\n            if (needRender) {\n                if (this.$autoResizeItem &&\n                    (this.$layout == 0 /* SingleColumn */ || this.$columnCount > 0))\n                    ii.obj.setSize(partSize, ii.obj.height, true);\n                this.itemRenderer(curIndex % this.$numItems, ii.obj);\n                if (curIndex % this.$curLineItemCount == 0) {\n                    deltaSize += Math.ceil(ii.obj.height) - ii.height;\n                    if (curIndex == newFirstIndex && oldFirstIndex > newFirstIndex) {\n                        //when scrolling down, we need to make compensation for the position to avoid flickering if the item's size changes\n                        firstItemDeltaSize = Math.ceil(ii.obj.height) - ii.height;\n                    }\n                }\n                ii.width = Math.ceil(ii.obj.width);\n                ii.height = Math.ceil(ii.obj.height);\n            }\n            ii.updateFlag = this.$itemInfoVer;\n            ii.obj.setXY(curX, curY);\n            if (curIndex == newFirstIndex)\n                //pad one more\n                max += ii.height;\n            curX += ii.width + this.$columnGap;\n            if (curIndex % this.$curLineItemCount == this.$curLineItemCount - 1) {\n                curX = 0;\n                curY += ii.height + this.$lineGap;\n            }\n            curIndex++;\n        }\n        for (i = 0; i < oldCount; i++) {\n            ii = this.$virtualItems[oldFirstIndex + i];\n            if (ii.updateFlag != this.$itemInfoVer && ii.obj != null) {\n                if (ii.obj instanceof GButton)\n                    ii.selected = ii.obj.selected;\n                this.removeChildToPool(ii.obj);\n                ii.obj = null;\n            }\n        }\n        if (deltaSize != 0 || firstItemDeltaSize != 0)\n            this.$scrollPane.changeContentSizeOnScrolling(0, deltaSize, 0, firstItemDeltaSize);\n        if (curIndex > 0 &&\n            this.numChildren > 0 &&\n            this.$container.y < 0 &&\n            this.getChildAt(0).y > -this.$container.y)\n            //last page is not full\n            this.handleScroll1(false); //recursive\n    }\n    handleScroll2(forceUpdate) {\n        this.$enterCounter++;\n        if (this.$enterCounter > 3) {\n            console.warn('this list view cannot be filled full as the itemRenderer function always returns an item with different size.');\n            return;\n        }\n        let pos = this.$scrollPane.scrollingPosX;\n        let max = pos + this.$scrollPane.viewWidth;\n        const end = pos == this.$scrollPane.contentWidth;\n        GList.$lastPosHelper = pos;\n        const newFirstIndex = this.getIndexOnPos2(forceUpdate);\n        if (newFirstIndex == this.$firstIndex && !forceUpdate)\n            return;\n        pos = GList.$lastPosHelper;\n        const oldFirstIndex = this.$firstIndex;\n        this.$firstIndex = newFirstIndex;\n        let curIndex = newFirstIndex;\n        const forward = oldFirstIndex > newFirstIndex;\n        const oldCount = this.numChildren;\n        let lastIndex = oldFirstIndex + oldCount - 1;\n        let reuseIndex = forward ? lastIndex : oldFirstIndex;\n        let curX = pos, curY = 0;\n        let needRender;\n        let deltaSize = 0;\n        let firstItemDeltaSize = 0;\n        let url = this.defaultItem;\n        let ii, ii2;\n        let i, j;\n        const partSize = (this.$scrollPane.viewHeight - this.$lineGap * (this.$curLineItemCount - 1)) /\n            this.$curLineItemCount;\n        this.$itemInfoVer++;\n        while (curIndex < this.$realNumItems && (end || curX < max)) {\n            ii = this.$virtualItems[curIndex];\n            if (ii.obj == null || forceUpdate) {\n                if (this.itemProvider != null) {\n                    url = this.itemProvider(curIndex % this.$numItems);\n                    if (url == null)\n                        url = this.$defaultItem;\n                    url = UIPackage.normalizeURL(url);\n                }\n                if (ii.obj != null && ii.obj.resourceURL != url) {\n                    if (ii.obj instanceof GButton)\n                        ii.selected = ii.obj.selected;\n                    this.removeChildToPool(ii.obj);\n                    ii.obj = null;\n                }\n            }\n            if (ii.obj == null) {\n                if (forward) {\n                    for (j = reuseIndex; j >= oldFirstIndex; j--) {\n                        ii2 = this.$virtualItems[j];\n                        if (ii2.obj != null &&\n                            ii2.updateFlag != this.$itemInfoVer &&\n                            ii2.obj.resourceURL == url) {\n                            if (ii2.obj instanceof GButton)\n                                ii2.selected = ii2.obj.selected;\n                            ii.obj = ii2.obj;\n                            ii2.obj = null;\n                            if (j == reuseIndex)\n                                reuseIndex--;\n                            break;\n                        }\n                    }\n                }\n                else {\n                    for (j = reuseIndex; j <= lastIndex; j++) {\n                        ii2 = this.$virtualItems[j];\n                        if (ii2.obj != null &&\n                            ii2.updateFlag != this.$itemInfoVer &&\n                            ii2.obj.resourceURL == url) {\n                            if (ii2.obj instanceof GButton)\n                                ii2.selected = ii2.obj.selected;\n                            ii.obj = ii2.obj;\n                            ii2.obj = null;\n                            if (j == reuseIndex)\n                                reuseIndex++;\n                            break;\n                        }\n                    }\n                }\n                if (ii.obj != null)\n                    this.setChildIndex(ii.obj, forward ? curIndex - newFirstIndex : this.numChildren);\n                else {\n                    ii.obj = this.$pool.get(url);\n                    if (forward)\n                        this.addChildAt(ii.obj, curIndex - newFirstIndex);\n                    else\n                        this.addChild(ii.obj);\n                }\n                if (ii.obj instanceof GButton)\n                    ii.obj.selected = ii.selected;\n                needRender = true;\n            }\n            else\n                needRender = forceUpdate;\n            if (needRender) {\n                if (this.$autoResizeItem &&\n                    (this.$layout == 1 /* SingleRow */ || this.$lineCount > 0))\n                    ii.obj.setSize(ii.obj.width, partSize, true);\n                this.itemRenderer(curIndex % this.$numItems, ii.obj);\n                if (curIndex % this.$curLineItemCount == 0) {\n                    deltaSize += Math.ceil(ii.obj.width) - ii.width;\n                    if (curIndex == newFirstIndex && oldFirstIndex > newFirstIndex)\n                        firstItemDeltaSize = Math.ceil(ii.obj.width) - ii.width;\n                }\n                ii.width = Math.ceil(ii.obj.width);\n                ii.height = Math.ceil(ii.obj.height);\n            }\n            ii.updateFlag = this.$itemInfoVer;\n            ii.obj.setXY(curX, curY);\n            if (curIndex == newFirstIndex)\n                max += ii.width;\n            curY += ii.height + this.$lineGap;\n            if (curIndex % this.$curLineItemCount == this.$curLineItemCount - 1) {\n                curY = 0;\n                curX += ii.width + this.$columnGap;\n            }\n            curIndex++;\n        }\n        for (i = 0; i < oldCount; i++) {\n            ii = this.$virtualItems[oldFirstIndex + i];\n            if (ii.updateFlag != this.$itemInfoVer && ii.obj != null) {\n                if (ii.obj instanceof GButton)\n                    ii.selected = ii.obj.selected;\n                this.removeChildToPool(ii.obj);\n                ii.obj = null;\n            }\n        }\n        if (deltaSize != 0 || firstItemDeltaSize != 0)\n            this.$scrollPane.changeContentSizeOnScrolling(deltaSize, 0, firstItemDeltaSize, 0);\n        if (curIndex > 0 &&\n            this.numChildren > 0 &&\n            this.$container.x < 0 &&\n            this.getChildAt(0).x > -this.$container.x)\n            this.handleScroll2(false);\n    }\n    handleScroll3(forceUpdate) {\n        let pos = this.$scrollPane.scrollingPosX;\n        GList.$lastPosHelper = pos;\n        const newFirstIndex = this.getIndexOnPos3(forceUpdate);\n        if (newFirstIndex == this.$firstIndex && !forceUpdate)\n            return;\n        pos = GList.$lastPosHelper;\n        const oldFirstIndex = this.$firstIndex;\n        this.$firstIndex = newFirstIndex;\n        //height-sync is not supported in pagnation mode, so just only render 1 page\n        let reuseIndex = oldFirstIndex;\n        const virtualItemCount = this.$virtualItems.length;\n        const pageSize = this.$curLineItemCount * this.$curLineItemCount2;\n        const startCol = newFirstIndex % this.$curLineItemCount;\n        const viewWidth = this.viewWidth;\n        const page = Math.floor(newFirstIndex / pageSize);\n        const startIndex = page * pageSize;\n        const lastIndex = startIndex + pageSize * 2;\n        let needRender;\n        let i;\n        let ii, ii2;\n        let col;\n        let url = this.$defaultItem;\n        const partWidth = (this.$scrollPane.viewWidth - this.$columnGap * (this.$curLineItemCount - 1)) /\n            this.$curLineItemCount;\n        const partHeight = (this.$scrollPane.viewHeight - this.$lineGap * (this.$curLineItemCount2 - 1)) /\n            this.$curLineItemCount2;\n        this.$itemInfoVer++;\n        //add mark for items used this time\n        for (i = startIndex; i < lastIndex; i++) {\n            if (i >= this.$realNumItems)\n                continue;\n            col = i % this.$curLineItemCount;\n            if (i - startIndex < pageSize) {\n                if (col < startCol)\n                    continue;\n            }\n            else {\n                if (col > startCol)\n                    continue;\n            }\n            ii = this.$virtualItems[i];\n            ii.updateFlag = this.$itemInfoVer;\n        }\n        let lastObj = null;\n        let insertIndex = 0;\n        for (i = startIndex; i < lastIndex; i++) {\n            if (i >= this.$realNumItems)\n                continue;\n            ii = this.$virtualItems[i];\n            if (ii.updateFlag != this.$itemInfoVer)\n                continue;\n            if (ii.obj == null) {\n                //find if any free item can be used\n                while (reuseIndex < virtualItemCount) {\n                    ii2 = this.$virtualItems[reuseIndex];\n                    if (ii2.obj != null && ii2.updateFlag != this.$itemInfoVer) {\n                        if (ii2.obj instanceof GButton)\n                            ii2.selected = ii2.obj.selected;\n                        ii.obj = ii2.obj;\n                        ii2.obj = null;\n                        break;\n                    }\n                    reuseIndex++;\n                }\n                if (insertIndex == -1)\n                    insertIndex = this.getChildIndex(lastObj) + 1;\n                if (ii.obj == null) {\n                    if (this.itemProvider != null) {\n                        url = this.itemProvider(i % this.$numItems);\n                        if (url == null)\n                            url = this.$defaultItem;\n                        url = UIPackage.normalizeURL(url);\n                    }\n                    ii.obj = this.$pool.get(url);\n                    this.addChildAt(ii.obj, insertIndex);\n                }\n                else\n                    insertIndex = this.setChildIndexBefore(ii.obj, insertIndex);\n                insertIndex++;\n                if (ii.obj instanceof GButton)\n                    ii.obj.selected = ii.selected;\n                needRender = true;\n            }\n            else {\n                needRender = forceUpdate;\n                insertIndex = -1;\n                lastObj = ii.obj;\n            }\n            if (needRender) {\n                if (this.$autoResizeItem) {\n                    if (this.$curLineItemCount == this.$columnCount &&\n                        this.$curLineItemCount2 == this.$lineCount)\n                        ii.obj.setSize(partWidth, partHeight, true);\n                    else if (this.$curLineItemCount == this.$columnCount)\n                        ii.obj.setSize(partWidth, ii.obj.height, true);\n                    else if (this.$curLineItemCount2 == this.$lineCount)\n                        ii.obj.setSize(ii.obj.width, partHeight, true);\n                }\n                this.itemRenderer(i % this.$numItems, ii.obj);\n                ii.width = Math.ceil(ii.obj.width);\n                ii.height = Math.ceil(ii.obj.height);\n            }\n        }\n        //layout\n        let borderX = (startIndex / pageSize) * viewWidth;\n        let xx = borderX;\n        let yy = 0;\n        let lineHeight = 0;\n        for (i = startIndex; i < lastIndex; i++) {\n            if (i >= this.$realNumItems)\n                continue;\n            ii = this.$virtualItems[i];\n            if (ii.updateFlag == this.$itemInfoVer)\n                ii.obj.setXY(xx, yy);\n            if (ii.height > lineHeight)\n                lineHeight = ii.height;\n            if (i % this.$curLineItemCount == this.$curLineItemCount - 1) {\n                xx = borderX;\n                yy += lineHeight + this.$lineGap;\n                lineHeight = 0;\n                if (i == startIndex + pageSize - 1) {\n                    borderX += viewWidth;\n                    xx = borderX;\n                    yy = 0;\n                }\n            }\n            else\n                xx += ii.width + this.$columnGap;\n        }\n        //release items not used\n        for (i = reuseIndex; i < virtualItemCount; i++) {\n            ii = this.$virtualItems[i];\n            if (ii.updateFlag != this.$itemInfoVer && ii.obj != null) {\n                if (ii.obj instanceof GButton)\n                    ii.selected = ii.obj.selected;\n                this.removeChildToPool(ii.obj);\n                ii.obj = null;\n            }\n        }\n    }\n    handleArchOrder1() {\n        if (this.$childrenRenderOrder == 2 /* Arch */) {\n            const mid = this.$scrollPane.posY + this.viewHeight / 2;\n            let minDist = Number.POSITIVE_INFINITY;\n            let dist = 0;\n            let apexIndex = 0;\n            const cnt = this.numChildren;\n            for (let i = 0; i < cnt; i++) {\n                const obj = this.getChildAt(i);\n                if (!this.foldInvisibleItems || obj.visible) {\n                    dist = Math.abs(mid - obj.y - obj.height / 2);\n                    if (dist < minDist) {\n                        minDist = dist;\n                        apexIndex = i;\n                    }\n                }\n            }\n            this.apexIndex = apexIndex;\n        }\n    }\n    handleArchOrder2() {\n        if (this.childrenRenderOrder == 2 /* Arch */) {\n            const mid = this.$scrollPane.posX + this.viewWidth / 2;\n            let minDist = Number.POSITIVE_INFINITY;\n            let dist = 0;\n            let apexIndex = 0;\n            const cnt = this.numChildren;\n            for (let i = 0; i < cnt; i++) {\n                const obj = this.getChildAt(i);\n                if (!this.foldInvisibleItems || obj.visible) {\n                    dist = Math.abs(mid - obj.x - obj.width / 2);\n                    if (dist < minDist) {\n                        minDist = dist;\n                        apexIndex = i;\n                    }\n                }\n            }\n            this.apexIndex = apexIndex;\n        }\n    }\n    handleAlign(contentWidth, contentHeight) {\n        let newOffsetX = 0;\n        let newOffsetY = 0;\n        if (contentHeight < this.viewHeight) {\n            if (this.$verticalAlign == 1 /* Middle */)\n                newOffsetY = Math.floor((this.viewHeight - contentHeight) / 2);\n            else if (this.$verticalAlign == 2 /* Bottom */)\n                newOffsetY = this.viewHeight - contentHeight;\n        }\n        if (contentWidth < this.viewWidth) {\n            if (this.$align == \"center\" /* Center */)\n                newOffsetX = Math.floor((this.viewWidth - contentWidth) / 2);\n            else if (this.$align == \"right\" /* Right */)\n                newOffsetX = this.viewWidth - contentWidth;\n        }\n        if (newOffsetX != this.$alignOffset.x || newOffsetY != this.$alignOffset.y) {\n            this.$alignOffset.setValues(newOffsetX, newOffsetY);\n            if (this.$scrollPane != null)\n                this.$scrollPane.adjustMaskContainer();\n            else {\n                this.$container.x = this.$margin.left + this.$alignOffset.x;\n                this.$container.y = this.$margin.top + this.$alignOffset.y;\n            }\n        }\n    }\n    /**@override */\n    updateBounds() {\n        if (this.$virtual)\n            return;\n        let i;\n        let child;\n        let curX = 0;\n        let curY = 0;\n        let maxWidth = 0;\n        let maxHeight = 0;\n        let cw = 0, ch = 0;\n        let j = 0;\n        let page = 0;\n        let k = 0;\n        const cnt = this.$children.length;\n        const viewWidth = this.viewWidth;\n        const viewHeight = this.viewHeight;\n        let lineSize = 0;\n        let lineStart = 0;\n        let ratio;\n        if (this.$layout == 0 /* SingleColumn */) {\n            for (i = 0; i < cnt; i++) {\n                child = this.getChildAt(i);\n                if (this.foldInvisibleItems && !child.visible)\n                    continue;\n                if (curY != 0)\n                    curY += this.$lineGap;\n                child.y = curY;\n                if (this.$autoResizeItem)\n                    child.setSize(viewWidth, child.height, true);\n                curY += Math.ceil(child.height);\n                if (child.width > maxWidth)\n                    maxWidth = child.width;\n            }\n            cw = Math.ceil(maxWidth);\n            ch = curY;\n        }\n        else if (this.$layout == 1 /* SingleRow */) {\n            for (i = 0; i < cnt; i++) {\n                child = this.getChildAt(i);\n                if (this.foldInvisibleItems && !child.visible)\n                    continue;\n                if (curX != 0)\n                    curX += this.$columnGap;\n                child.x = curX;\n                if (this.$autoResizeItem)\n                    child.setSize(child.width, viewHeight, true);\n                curX += Math.ceil(child.width);\n                if (child.height > maxHeight)\n                    maxHeight = child.height;\n            }\n            cw = curX;\n            ch = Math.ceil(maxHeight);\n        }\n        else if (this.$layout == 2 /* FlowHorizontal */) {\n            if (this.$autoResizeItem && this.$columnCount > 0) {\n                for (i = 0; i < cnt; i++) {\n                    child = this.getChildAt(i);\n                    if (this.foldInvisibleItems && !child.visible)\n                        continue;\n                    lineSize += child.sourceWidth;\n                    j++;\n                    if (j == this.$columnCount || i == cnt - 1) {\n                        ratio = (viewWidth - lineSize - (j - 1) * this.$columnGap) / lineSize;\n                        curX = 0;\n                        for (j = lineStart; j <= i; j++) {\n                            child = this.getChildAt(j);\n                            if (this.foldInvisibleItems && !child.visible)\n                                continue;\n                            child.setXY(curX, curY);\n                            if (j < i) {\n                                child.setSize(child.sourceWidth + Math.round(child.sourceWidth * ratio), child.height, true);\n                                curX += Math.ceil(child.width) + this.$columnGap;\n                            }\n                            else\n                                child.setSize(viewWidth - curX, child.height, true);\n                            if (child.height > maxHeight)\n                                maxHeight = child.height;\n                        }\n                        //new line\n                        curY += Math.ceil(maxHeight) + this.$lineGap;\n                        maxHeight = 0;\n                        j = 0;\n                        lineStart = i + 1;\n                        lineSize = 0;\n                    }\n                }\n                ch = curY + Math.ceil(maxHeight);\n                cw = viewWidth;\n            }\n            else {\n                for (i = 0; i < cnt; i++) {\n                    child = this.getChildAt(i);\n                    if (this.foldInvisibleItems && !child.visible)\n                        continue;\n                    if (curX != 0)\n                        curX += this.$columnGap;\n                    if ((this.$columnCount != 0 && j >= this.$columnCount) ||\n                        (this.$columnCount == 0 && curX + child.width > viewWidth && maxHeight != 0)) {\n                        //new line\n                        curX = 0;\n                        curY += Math.ceil(maxHeight) + this.$lineGap;\n                        maxHeight = 0;\n                        j = 0;\n                    }\n                    child.setXY(curX, curY);\n                    curX += Math.ceil(child.width);\n                    if (curX > maxWidth)\n                        maxWidth = curX;\n                    if (child.height > maxHeight)\n                        maxHeight = child.height;\n                    j++;\n                }\n                ch = curY + Math.ceil(maxHeight);\n                cw = Math.ceil(maxWidth);\n            }\n        }\n        else if (this.$layout == 3 /* FlowVertical */) {\n            if (this.$autoResizeItem && this.$lineCount > 0) {\n                for (i = 0; i < cnt; i++) {\n                    child = this.getChildAt(i);\n                    if (this.foldInvisibleItems && !child.visible)\n                        continue;\n                    lineSize += child.sourceHeight;\n                    j++;\n                    if (j == this.$lineCount || i == cnt - 1) {\n                        ratio = (viewHeight - lineSize - (j - 1) * this.$lineGap) / lineSize;\n                        curY = 0;\n                        for (j = lineStart; j <= i; j++) {\n                            child = this.getChildAt(j);\n                            if (this.foldInvisibleItems && !child.visible)\n                                continue;\n                            child.setXY(curX, curY);\n                            if (j < i) {\n                                child.setSize(child.width, child.sourceHeight + Math.round(child.sourceHeight * ratio), true);\n                                curY += Math.ceil(child.height) + this.$lineGap;\n                            }\n                            else\n                                child.setSize(child.width, viewHeight - curY, true);\n                            if (child.width > maxWidth)\n                                maxWidth = child.width;\n                        }\n                        //new line\n                        curX += Math.ceil(maxWidth) + this.$columnGap;\n                        maxWidth = 0;\n                        j = 0;\n                        lineStart = i + 1;\n                        lineSize = 0;\n                    }\n                }\n                cw = curX + Math.ceil(maxWidth);\n                ch = viewHeight;\n            }\n            else {\n                for (i = 0; i < cnt; i++) {\n                    child = this.getChildAt(i);\n                    if (this.foldInvisibleItems && !child.visible)\n                        continue;\n                    if (curY != 0)\n                        curY += this.$lineGap;\n                    if ((this.$lineCount != 0 && j >= this.$lineCount) ||\n                        (this.$lineCount == 0 && curY + child.height > viewHeight && maxWidth != 0)) {\n                        curY = 0;\n                        curX += Math.ceil(maxWidth) + this.$columnGap;\n                        maxWidth = 0;\n                        j = 0;\n                    }\n                    child.setXY(curX, curY);\n                    curY += Math.ceil(child.height);\n                    if (curY > maxHeight)\n                        maxHeight = curY;\n                    if (child.width > maxWidth)\n                        maxWidth = child.width;\n                    j++;\n                }\n                cw = curX + Math.ceil(maxWidth);\n                ch = Math.ceil(maxHeight);\n            }\n        } //pagination\n        else {\n            let eachHeight;\n            if (this.$autoResizeItem && this.$lineCount > 0)\n                eachHeight = Math.floor((viewHeight - (this.$lineCount - 1) * this.$lineGap) / this.$lineCount);\n            if (this.$autoResizeItem && this.$columnCount > 0) {\n                for (i = 0; i < cnt; i++) {\n                    child = this.getChildAt(i);\n                    if (this.foldInvisibleItems && !child.visible)\n                        continue;\n                    lineSize += child.sourceWidth;\n                    j++;\n                    if (j == this.$columnCount || i == cnt - 1) {\n                        ratio = (viewWidth - lineSize - (j - 1) * this.$columnGap) / lineSize;\n                        curX = 0;\n                        for (j = lineStart; j <= i; j++) {\n                            child = this.getChildAt(j);\n                            if (this.foldInvisibleItems && !child.visible)\n                                continue;\n                            child.setXY(page * viewWidth + curX, curY);\n                            if (j < i) {\n                                child.setSize(child.sourceWidth + Math.round(child.sourceWidth * ratio), this.$lineCount > 0 ? eachHeight : child.height, true);\n                                curX += Math.ceil(child.width) + this.$columnGap;\n                            }\n                            else\n                                child.setSize(viewWidth - curX, this.$lineCount > 0 ? eachHeight : child.height, true);\n                            if (child.height > maxHeight)\n                                maxHeight = child.height;\n                        }\n                        //new line\n                        curY += Math.ceil(maxHeight) + this.$lineGap;\n                        maxHeight = 0;\n                        j = 0;\n                        lineStart = i + 1;\n                        lineSize = 0;\n                        k++;\n                        if ((this.$lineCount != 0 && k >= this.$lineCount) ||\n                            (this.$lineCount == 0 && curY + child.height > viewHeight)) {\n                            //new page\n                            page++;\n                            curY = 0;\n                            k = 0;\n                        }\n                    }\n                }\n            }\n            else {\n                for (i = 0; i < cnt; i++) {\n                    child = this.getChildAt(i);\n                    if (this.foldInvisibleItems && !child.visible)\n                        continue;\n                    if (curX != 0)\n                        curX += this.$columnGap;\n                    if (this.$autoResizeItem && this.$lineCount > 0)\n                        child.setSize(child.width, eachHeight, true);\n                    if ((this.$columnCount != 0 && j >= this.$columnCount) ||\n                        (this.$columnCount == 0 && curX + child.width > viewWidth && maxHeight != 0)) {\n                        //new line\n                        curX = 0;\n                        curY += Math.ceil(maxHeight) + this.$lineGap;\n                        maxHeight = 0;\n                        j = 0;\n                        k++;\n                        if ((this.$lineCount != 0 && k >= this.$lineCount) ||\n                            (this.$lineCount == 0 && curY + child.height > viewHeight && maxWidth != 0)) {\n                            //new page\n                            page++;\n                            curY = 0;\n                            k = 0;\n                        }\n                    }\n                    child.setXY(page * viewWidth + curX, curY);\n                    curX += Math.ceil(child.width);\n                    if (curX > maxWidth)\n                        maxWidth = curX;\n                    if (child.height > maxHeight)\n                        maxHeight = child.height;\n                    j++;\n                }\n            }\n            ch = page > 0 ? viewHeight : curY + Math.ceil(maxHeight);\n            cw = (page + 1) * viewWidth;\n        }\n        this.handleAlign(cw, ch);\n        this.setBounds(0, 0, cw, ch);\n    }\n    setupBeforeAdd(xml) {\n        super.setupBeforeAdd(xml);\n        let str;\n        let arr;\n        str = xml.attributes.layout;\n        if (str)\n            this.$layout = ParseListLayoutType(str);\n        let overflow;\n        str = xml.attributes.overflow;\n        if (str)\n            overflow = ParseOverflowType(str);\n        else\n            overflow = 0 /* Visible */;\n        str = xml.attributes.margin;\n        if (str)\n            this.$margin.parse(str);\n        str = xml.attributes.align;\n        if (str)\n            this.$align = ParseAlignType(str);\n        str = xml.attributes.vAlign;\n        if (str)\n            this.$verticalAlign = ParseVertAlignType(str);\n        if (overflow == 2 /* Scroll */) {\n            let scroll;\n            str = xml.attributes.scroll;\n            if (str)\n                scroll = ParseScrollType(str);\n            else\n                scroll = 1 /* Vertical */;\n            let scrollBarDisplay;\n            str = xml.attributes.scrollBar;\n            if (str)\n                scrollBarDisplay = ParseScrollBarDisplayType(str);\n            else\n                scrollBarDisplay = 0 /* Default */;\n            let scrollBarFlags;\n            str = xml.attributes.scrollBarFlags;\n            if (str)\n                scrollBarFlags = parseInt(str);\n            else\n                scrollBarFlags = 0;\n            let scrollBarMargin = new Margin();\n            str = xml.attributes.scrollBarMargin;\n            if (str)\n                scrollBarMargin.parse(str);\n            let vtScrollBarRes;\n            let hzScrollBarRes;\n            str = xml.attributes.scrollBarRes;\n            if (str) {\n                arr = str.split(',');\n                vtScrollBarRes = arr[0];\n                hzScrollBarRes = arr[1];\n            }\n            let headerRes;\n            let footerRes;\n            str = xml.attributes.ptrRes;\n            if (str) {\n                arr = str.split(',');\n                headerRes = arr[0];\n                footerRes = arr[1];\n            }\n            this.setupScroll(scrollBarMargin, scroll, scrollBarDisplay, scrollBarFlags, vtScrollBarRes, hzScrollBarRes, headerRes, footerRes);\n        }\n        else\n            this.setupOverflow(overflow);\n        str = xml.attributes.lineGap;\n        if (str)\n            this.$lineGap = parseInt(str);\n        str = xml.attributes.colGap;\n        if (str)\n            this.$columnGap = parseInt(str);\n        str = xml.attributes.lineItemCount;\n        if (str) {\n            if (this.$layout == 2 /* FlowHorizontal */ ||\n                this.$layout == 4 /* Pagination */)\n                this.$columnCount = parseInt(str);\n            else if (this.$layout == 3 /* FlowVertical */)\n                this.$lineCount = parseInt(str);\n        }\n        str = xml.attributes.lineItemCount2;\n        if (str)\n            this.$lineCount = parseInt(str);\n        str = xml.attributes.selectionMode;\n        if (str)\n            this.$selectionMode = ParseListSelectionMode(str);\n        str = xml.attributes.defaultItem;\n        if (str)\n            this.$defaultItem = str;\n        str = xml.attributes.autoItemSize;\n        if (this.$layout == 1 /* SingleRow */ || this.$layout == 0 /* SingleColumn */)\n            this.$autoResizeItem = str != 'false';\n        else\n            this.$autoResizeItem = str == 'true';\n        str = xml.attributes.renderOrder;\n        if (str) {\n            this.$childrenRenderOrder = ParseListChildrenRenderOrder(str);\n            if (this.$childrenRenderOrder == 2 /* Arch */) {\n                str = xml.attributes.apex;\n                if (str)\n                    this.$apexIndex = parseInt(str);\n            }\n        }\n        let col = xml.children;\n        col.forEach(cxml => {\n            if (cxml.nodeName != 'item')\n                return;\n            let url = cxml.attributes.url;\n            if (!url)\n                url = this.$defaultItem;\n            if (!url)\n                return;\n            let obj = this.getFromPool(url);\n            if (obj != null) {\n                this.addChild(obj);\n                str = cxml.attributes.title;\n                if (str)\n                    obj.text = str;\n                str = cxml.attributes.icon;\n                if (str)\n                    obj.icon = str;\n                str = cxml.attributes.name;\n                if (str)\n                    obj.name = str;\n                str = cxml.attributes.selectedIcon;\n                if (str && obj instanceof GButton)\n                    obj.selectedIcon = str;\n            }\n        }, this);\n    }\n    setupAfterAdd(xml) {\n        super.setupAfterAdd(xml);\n        let str;\n        str = xml.attributes.selectionController;\n        if (str)\n            this.$selectionController = this.parent.getController(str);\n    }\n}\nGList.$lastPosHelper = 0;\n\nclass PopupMenu {\n    constructor(resourceURL = null) {\n        if (!resourceURL) {\n            resourceURL = UIConfig.popupMenu;\n            if (!resourceURL)\n                throw new Error('UIConfig.popupMenu not defined');\n        }\n        this.$contentPane = UIPackage.createObjectFromURL(resourceURL);\n        this.$contentPane.on('added', this.$addedToStage, this);\n        this.$list = this.$contentPane.getChild('list');\n        this.$list.removeChildrenToPool();\n        this.$list.addRelation(this.$contentPane, 14 /* Width */);\n        this.$list.removeRelation(this.$contentPane, 15 /* Height */);\n        this.$contentPane.addRelation(this.$list, 15 /* Height */);\n        this.$list.on(\"__itemClick\" /* ItemClick */, this.$clickItem, this);\n    }\n    dispose() {\n        GTimer.inst.remove(this.$delayClickItem, this);\n        this.$list.off(\"__itemClick\" /* ItemClick */, this.$clickItem);\n        this.$contentPane.off('added', this.$addedToStage);\n        this.$contentPane.dispose();\n    }\n    addItem(caption, handler) {\n        let item = this.$list.addItemFromPool();\n        item.title = caption;\n        item.data = handler;\n        item.grayed = false;\n        let c = item.getController('checked');\n        if (c != null)\n            c.selectedIndex = 0;\n        return item;\n    }\n    addItemAt(caption, index, handler) {\n        let item = this.$list.getFromPool();\n        this.$list.addChildAt(item, index);\n        item.title = caption;\n        item.data = handler;\n        item.grayed = false;\n        let c = item.getController('checked');\n        if (c != null)\n            c.selectedIndex = 0;\n        return item;\n    }\n    addSeperator() {\n        if (UIConfig.popupMenuSeperator == null)\n            throw new Error('UIConfig.popupMenuSeperator not defined');\n        this.$list.addItemFromPool(UIConfig.popupMenuSeperator);\n    }\n    getItemName(index) {\n        let item = this.$list.getChildAt(index);\n        return item.name;\n    }\n    setItemText(name, caption) {\n        let item = this.$list.getChild(name);\n        item.title = caption;\n    }\n    setItemVisible(name, visible) {\n        let item = this.$list.getChild(name);\n        if (item.visible != visible) {\n            item.visible = visible;\n            this.$list.setBoundsChangedFlag();\n        }\n    }\n    setItemGrayed(name, grayed) {\n        let item = this.$list.getChild(name);\n        item.grayed = grayed;\n    }\n    setItemCheckable(name, checkable) {\n        let item = this.$list.getChild(name);\n        let c = item.getController('checked');\n        if (c != null) {\n            if (checkable) {\n                if (c.selectedIndex == 0)\n                    c.selectedIndex = 1;\n            }\n            else\n                c.selectedIndex = 0;\n        }\n    }\n    setItemChecked(name, checked) {\n        let item = this.$list.getChild(name);\n        let c = item.getController('checked');\n        if (c != null)\n            c.selectedIndex = checked ? 2 : 1;\n    }\n    isItemChecked(name) {\n        let item = this.$list.getChild(name);\n        let c = item.getController('checked');\n        if (c != null)\n            return c.selectedIndex == 2;\n        else\n            return false;\n    }\n    removeItem(name) {\n        let item = this.$list.getChild(name);\n        if (item != null) {\n            let index = this.$list.getChildIndex(item);\n            this.$list.removeChildToPoolAt(index);\n            return true;\n        }\n        else\n            return false;\n    }\n    clearItems() {\n        this.$list.removeChildrenToPool();\n    }\n    get itemCount() {\n        return this.$list.numChildren;\n    }\n    get contentPane() {\n        return this.$contentPane;\n    }\n    get list() {\n        return this.$list;\n    }\n    show(target = null, dir) {\n        let r = target != null ? GRoot.findFor(target) : GRoot.inst;\n        r.showPopup(this.contentPane, target instanceof GRoot ? null : target, dir);\n    }\n    $clickItem(evt) {\n        let item = evt.data.item;\n        GTimer.inst.add(100, 1, this.$delayClickItem, this, item);\n    }\n    $delayClickItem(itemObject) {\n        if (!(itemObject instanceof GButton))\n            return;\n        if (itemObject.grayed) {\n            this.$list.selectedIndex = -1;\n            return;\n        }\n        let c = itemObject.getController('checked');\n        if (c != null && c.selectedIndex != 0) {\n            if (c.selectedIndex == 1)\n                c.selectedIndex = 2;\n            else\n                c.selectedIndex = 1;\n        }\n        let r = this.$contentPane.parent;\n        if (r)\n            r.hidePopup(this.contentPane);\n        if (itemObject.data != null)\n            itemObject.data.call(null);\n        GTimer.inst.remove(this.$delayClickItem, this);\n    }\n    $addedToStage() {\n        this.$list.selectedIndex = -1;\n        this.$list.resizeToFit(100000, 10);\n    }\n}\n\nclass UIObjectFactory {\n    static setPackageItemExtension(url, type) {\n        UIObjectFactory.packageItemExtensions[url.substring(5)] = type;\n    }\n    // public static setLoaderExtension(type: { new(): GLoader }): void {\n    //     UIObjectFactory.loaderExtension = type;\n    // }\n    static newObject(pi) {\n        switch (pi.type) {\n            case 0 /* Image */:\n                return new GImage();\n            case 2 /* MovieClip */:\n                return new GMovieClip();\n            case 4 /* Component */:\n                let cls = UIObjectFactory.packageItemExtensions[pi.owner.id + pi.id];\n                if (cls)\n                    return new cls();\n                let xml = pi.owner.getItemAsset(pi);\n                let extention = xml.attributes.extention;\n                if (extention != null) {\n                    switch (extention) {\n                        case 'Button':\n                            return new GButton();\n                        case 'ProgressBar':\n                            return new GProgressBar();\n                        case 'Label':\n                            return new GLabel();\n                        case 'Slider':\n                            return new GSlider();\n                        case 'ScrollBar':\n                            return new GScrollBar();\n                        case 'ComboBox':\n                            return new GComboBox();\n                        default:\n                            return new GComponent();\n                    }\n                }\n                else\n                    return new GComponent();\n        }\n        return null;\n    }\n    static newObjectDirectly(type) {\n        switch (type) {\n            case 'image':\n                return new GImage();\n            case 'movieclip':\n                return new GMovieClip();\n            case 'component':\n                return new GComponent();\n            case 'text':\n                return new GTextField();\n            case 'list':\n                return new GList();\n            case 'richtext':\n                return new GRichTextField();\n            case 'inputtext':\n                return new GTextInput();\n            case 'group':\n                return new GGroup();\n            case 'graph':\n                return new GGraph();\n            case 'loader':\n                if (UIObjectFactory.loaderExtension != null)\n                    return new UIObjectFactory.loaderExtension();\n                else\n                    return new GLoader();\n        }\n        return null;\n    }\n}\nUIObjectFactory.packageItemExtensions = {};\nDecls.UIObjectFactory = UIObjectFactory;\n\nclass DragIndicator {\n    constructor() {\n        this.$agent = new GLoader();\n        this.$agent.draggable = true;\n        this.$agent.touchable = false;\n        this.$agent.setSize(100, 100);\n        this.$agent.setPivot(0.5, 0.5, true);\n        this.$agent.align = \"center\" /* Center */;\n        this.$agent.verticalAlign = 1 /* Middle */;\n        this.$agent.sortingOrder = 1000000; //top most\n        this.$agent.on(\"__dragEnd\" /* END */, this.$dragEnd, this);\n    }\n    get dragAgent() {\n        return this.$agent;\n    }\n    get isDragging() {\n        return this.$agent.parent != null;\n    }\n    get sourceObject() {\n        return this.$sourceObject;\n    }\n    startDrag(source, icon, sourceData, touchPointID = -1) {\n        if (this.isDragging)\n            return;\n        this.$sourceObject = source;\n        this.$sourceData = sourceData;\n        this.$agent.url = icon;\n        GRoot.inst.addChild(this.$agent);\n        const pt = GRoot.inst.globalToLocal(GRoot.globalMouseStatus.mouseX, GRoot.globalMouseStatus.mouseY);\n        this.$agent.setXY(pt.x, pt.y);\n        this.$agent.startDrag(touchPointID);\n    }\n    cancel() {\n        if (this.$agent.parent != null) {\n            this.$agent.stopDrag();\n            GRoot.inst.removeChild(this.$agent);\n            this.$sourceData = null;\n        }\n    }\n    $dragEnd(evt) {\n        if (!this.isDragging)\n            return;\n        GRoot.inst.removeChild(this.$agent);\n        let sourceData = this.$sourceData;\n        this.$sourceData = null;\n        let obj = GRoot.inst.getObjectUnderPoint(evt.target.x, evt.target.y);\n        while (obj != null) {\n            if (obj.hasListener(\"__dragDrop\" /* DROP */)) {\n                obj.requestFocus();\n                let currentTarget = obj.displayObject;\n                let event = new createjs.Event(\"__dragDrop\" /* DROP */, true, false);\n                event.data = { currentTarget, sourceData };\n                obj.dispatchEvent(event, this);\n                return;\n            }\n            obj = obj.parent;\n        }\n    }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvZmFpcnlndWktY3JlYXRlanMvZGlzdC9mYWlyeWd1aS5tb2R1bGUuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL21haW4vLi9ub2RlX21vZHVsZXMvZmFpcnlndWktY3JlYXRlanMvZGlzdC9mYWlyeWd1aS5tb2R1bGUuanM/OWFkNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgaXNNb2JpbGVDYWxsIGZyb20gJ2lzbW9iaWxlanMnO1xuXG5jbGFzcyBVSUNvbnRhaW5lciBleHRlbmRzIGNyZWF0ZWpzLkNvbnRhaW5lciB7XG4gICAgY29uc3RydWN0b3Iob3duZXIpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5VSU93bmVyID0gb3duZXI7XG4gICAgICAgIHRoaXMubW91c2VFbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5tb3VzZUNoaWxkcmVuID0gdHJ1ZTtcbiAgICB9XG4gICAgZ2V0IHNjcm9sbFJlY3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRzY3JvbGxSZWN0O1xuICAgIH1cbiAgICBzZXQgc2Nyb2xsUmVjdChyZWN0KSB7XG4gICAgICAgIHRoaXMuJHNjcm9sbFJlY3QgPSByZWN0O1xuICAgICAgICBpZiAocmVjdCAhPSBudWxsKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuJHJlY3RNYXNrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kcmVjdE1hc2sgPSBuZXcgY3JlYXRlanMuR3JhcGhpY3MoKTtcbiAgICAgICAgICAgICAgICB2YXIgc2hhcGUgPSBuZXcgY3JlYXRlanMuU2hhcGUodGhpcy4kcmVjdE1hc2spO1xuICAgICAgICAgICAgICAgIHRoaXMubWFzayA9IHNoYXBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy4kcmVjdE1hc2suY2xlYXIoKTtcbiAgICAgICAgICAgIGlmIChyZWN0LndpZHRoID4gMCAmJiByZWN0LmhlaWdodCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRyZWN0TWFzay5iZWdpbkZpbGwoJyMwMDAnKTtcbiAgICAgICAgICAgICAgICB0aGlzLiRyZWN0TWFzay5kcmF3UmVjdCh0aGlzLiRzY3JvbGxSZWN0LngsIHRoaXMuJHNjcm9sbFJlY3QueSwgdGhpcy4kc2Nyb2xsUmVjdC53aWR0aCwgdGhpcy4kc2Nyb2xsUmVjdC5oZWlnaHQpO1xuICAgICAgICAgICAgICAgIHRoaXMuJHJlY3RNYXNrLmVuZEZpbGwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLm1hc2sgPSBudWxsO1xuICAgIH1cbn1cblxuY2xhc3MgSW50ZXJhY3RpdmVFdmVudHMge1xufVxuSW50ZXJhY3RpdmVFdmVudHMuRG93biA9IGNyZWF0ZWpzLlRvdWNoLmlzU3VwcG9ydGVkKCkgPyAnbW91c2Vkb3duJyA6ICdtb3VzZWRvd24nO1xuSW50ZXJhY3RpdmVFdmVudHMuQ2FuY2VsID0gY3JlYXRlanMuVG91Y2guaXNTdXBwb3J0ZWQoKSA/ICdtb3VzZWNhbmNlbCcgOiAnbW91c2VjYW5jZWwnO1xuSW50ZXJhY3RpdmVFdmVudHMuVXAgPSBjcmVhdGVqcy5Ub3VjaC5pc1N1cHBvcnRlZCgpID8gJ3N0YWdlbW91c2V1cCcgOiAnc3RhZ2Vtb3VzZXVwJztcbkludGVyYWN0aXZlRXZlbnRzLkNsaWNrID0gY3JlYXRlanMuVG91Y2guaXNTdXBwb3J0ZWQoKSA/ICdjbGljaycgOiAnY2xpY2snO1xuSW50ZXJhY3RpdmVFdmVudHMuVXBPdXRzaWRlID0gY3JlYXRlanMuVG91Y2guaXNTdXBwb3J0ZWQoKVxuICAgID8gJ21vdXNldXBvdXRzaWRlJ1xuICAgIDogJ21vdXNldXBvdXRzaWRlJztcbkludGVyYWN0aXZlRXZlbnRzLk1vdmUgPSBjcmVhdGVqcy5Ub3VjaC5pc1N1cHBvcnRlZCgpID8gJ3N0YWdlbW91c2Vtb3ZlJyA6ICdzdGFnZW1vdXNlbW92ZSc7XG5JbnRlcmFjdGl2ZUV2ZW50cy5PdmVyID0gY3JlYXRlanMuVG91Y2guaXNTdXBwb3J0ZWQoKSA/ICdtb3VzZW92ZXInIDogJ21vdXNlb3Zlcic7XG5JbnRlcmFjdGl2ZUV2ZW50cy5PdXQgPSBjcmVhdGVqcy5Ub3VjaC5pc1N1cHBvcnRlZCgpID8gJ21vdXNlb3V0JyA6ICdtb3VzZW91dCc7XG4vL21vdXNlIG9ubHlcbkludGVyYWN0aXZlRXZlbnRzLlJpZ2h0RG93biA9ICdyaWdodGRvd24nO1xuSW50ZXJhY3RpdmVFdmVudHMuUmlnaHRVcCA9ICdyaWdodHVwJztcbkludGVyYWN0aXZlRXZlbnRzLlJpZ2h0Q2xpY2sgPSAncmlnaHRjbGljayc7XG5JbnRlcmFjdGl2ZUV2ZW50cy5SaWdodFVwT3V0c2lkZSA9ICdyaWdodHVwb3V0c2lkZSc7XG5sZXQgR2VhclhNTE5vZGVOYW1lTWFwID0ge1xuICAgIGdlYXJEaXNwbGF5OiAwLFxuICAgIGdlYXJYWTogMSxcbiAgICBnZWFyU2l6ZTogMixcbiAgICBnZWFyTG9vazogMyxcbiAgICBnZWFyQ29sb3I6IDQsXG4gICAgZ2VhckFuaTogNSxcbiAgICBnZWFyVGV4dDogNixcbiAgICBnZWFySWNvbjogN1xufTtcbmxldCBCbGVuZE1vZGVNYXAgPSBbXG4gICAgJ05vcm1hbCcsXG4gICAgJ0FkZCcsXG4gICAgJ011bHRpcGx5JyxcbiAgICAnU2NyZWVuJyxcbiAgICAnT3ZlcmxheScsXG4gICAgJ0RhcmtlbicsXG4gICAgJ0xpZ2h0ZW4nLFxuICAgICdDb2xvckRvZGdlJyxcbiAgICAnQ29sb3JCdXJuJyxcbiAgICAnSGFyZExpZ2h0JyxcbiAgICAnU29mdExpZ2h0JyxcbiAgICAnRGlmZmVyZW5jZScsXG4gICAgJ0V4Y2x1c2lvbicsXG4gICAgJ0h1ZScsXG4gICAgJ1NhdHVyYXRpb24nLFxuICAgICdDb2xvcicsXG4gICAgJ0x1bWlub3NpdHknLFxuICAgICdOb3JtYWxOUE0nLFxuICAgICdBZGROUE0nLFxuICAgICdTY3JlZW5OUE0nIC8vICBTQ1JFRU5fTlBNXG5dO1xuZnVuY3Rpb24gUGFyc2VPdmVyZmxvd1R5cGUodmFsdWUpIHtcbiAgICBzd2l0Y2ggKHZhbHVlKSB7XG4gICAgICAgIGNhc2UgJ3Zpc2libGUnOlxuICAgICAgICAgICAgcmV0dXJuIDAgLyogVmlzaWJsZSAqLztcbiAgICAgICAgY2FzZSAnaGlkZGVuJzpcbiAgICAgICAgICAgIHJldHVybiAxIC8qIEhpZGRlbiAqLztcbiAgICAgICAgY2FzZSAnc2Nyb2xsJzpcbiAgICAgICAgICAgIHJldHVybiAyIC8qIFNjcm9sbCAqLztcbiAgICAgICAgY2FzZSAnc2NhbGUnOlxuICAgICAgICAgICAgcmV0dXJuIDMgLyogU2NhbGUgKi87XG4gICAgICAgIGNhc2UgJ3NjYWxlRnJlZSc6XG4gICAgICAgICAgICByZXR1cm4gNCAvKiBTY2FsZUZyZWUgKi87XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gMCAvKiBWaXNpYmxlICovO1xuICAgIH1cbn1cbmZ1bmN0aW9uIFBhcnNlU2Nyb2xsVHlwZSh2YWx1ZSkge1xuICAgIHN3aXRjaCAodmFsdWUpIHtcbiAgICAgICAgY2FzZSAnaG9yaXpvbnRhbCc6XG4gICAgICAgICAgICByZXR1cm4gMCAvKiBIb3Jpem9udGFsICovO1xuICAgICAgICBjYXNlICd2ZXJ0aWNhbCc6XG4gICAgICAgICAgICByZXR1cm4gMSAvKiBWZXJ0aWNhbCAqLztcbiAgICAgICAgY2FzZSAnYm90aCc6XG4gICAgICAgICAgICByZXR1cm4gMiAvKiBCb3RoICovO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIDEgLyogVmVydGljYWwgKi87XG4gICAgfVxufVxuZnVuY3Rpb24gUGFyc2VMb2FkZXJGaWxsVHlwZSh2YWx1ZSkge1xuICAgIHN3aXRjaCAodmFsdWUpIHtcbiAgICAgICAgY2FzZSAnbm9uZSc6XG4gICAgICAgICAgICByZXR1cm4gMCAvKiBOb25lICovO1xuICAgICAgICBjYXNlICdzY2FsZSc6XG4gICAgICAgICAgICByZXR1cm4gMSAvKiBTY2FsZSAqLztcbiAgICAgICAgY2FzZSAnc2NhbGVNYXRjaEhlaWdodCc6XG4gICAgICAgICAgICByZXR1cm4gMiAvKiBTY2FsZU1hdGNoSGVpZ2h0ICovO1xuICAgICAgICBjYXNlICdzY2FsZU1hdGNoV2lkdGgnOlxuICAgICAgICAgICAgcmV0dXJuIDMgLyogU2NhbGVNYXRjaFdpZHRoICovO1xuICAgICAgICBjYXNlICdzY2FsZUZyZWUnOlxuICAgICAgICAgICAgcmV0dXJuIDQgLyogU2NhbGVGcmVlICovO1xuICAgICAgICBjYXNlICdzY2FsZU5vQm9yZGVyJzpcbiAgICAgICAgICAgIHJldHVybiA1IC8qIFNjYWxlTm9Cb3JkZXIgKi87XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gMCAvKiBOb25lICovO1xuICAgIH1cbn1cbmZ1bmN0aW9uIFBhcnNlTGlzdExheW91dFR5cGUodmFsdWUpIHtcbiAgICBzd2l0Y2ggKHZhbHVlKSB7XG4gICAgICAgIGNhc2UgJ2NvbHVtbic6XG4gICAgICAgICAgICByZXR1cm4gMCAvKiBTaW5nbGVDb2x1bW4gKi87XG4gICAgICAgIGNhc2UgJ3Jvdyc6XG4gICAgICAgICAgICByZXR1cm4gMSAvKiBTaW5nbGVSb3cgKi87XG4gICAgICAgIGNhc2UgJ2Zsb3dfaHonOlxuICAgICAgICAgICAgcmV0dXJuIDIgLyogRmxvd0hvcml6b250YWwgKi87XG4gICAgICAgIGNhc2UgJ2Zsb3dfdnQnOlxuICAgICAgICAgICAgcmV0dXJuIDMgLyogRmxvd1ZlcnRpY2FsICovO1xuICAgICAgICBjYXNlICdwYWdpbmF0aW9uJzpcbiAgICAgICAgICAgIHJldHVybiA0IC8qIFBhZ2luYXRpb24gKi87XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gMCAvKiBTaW5nbGVDb2x1bW4gKi87XG4gICAgfVxufVxuZnVuY3Rpb24gUGFyc2VMaXN0U2VsZWN0aW9uTW9kZSh2YWx1ZSkge1xuICAgIHN3aXRjaCAodmFsdWUpIHtcbiAgICAgICAgY2FzZSAnc2luZ2xlJzpcbiAgICAgICAgICAgIHJldHVybiAwIC8qIFNpbmdsZSAqLztcbiAgICAgICAgY2FzZSAnbXVsdGlwbGUnOlxuICAgICAgICAgICAgcmV0dXJuIDEgLyogTXVsdGlwbGUgKi87XG4gICAgICAgIGNhc2UgJ211bHRpcGxlU2luZ2xlQ2xpY2snOlxuICAgICAgICAgICAgcmV0dXJuIDIgLyogTXVsdGlwbGVfU2luZ2xlQ2xpY2sgKi87XG4gICAgICAgIGNhc2UgJ25vbmUnOlxuICAgICAgICAgICAgcmV0dXJuIDMgLyogTm9uZSAqLztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiAwIC8qIFNpbmdsZSAqLztcbiAgICB9XG59XG5mdW5jdGlvbiBQYXJzZVBhY2thZ2VJdGVtVHlwZSh2YWx1ZSkge1xuICAgIHN3aXRjaCAodmFsdWUpIHtcbiAgICAgICAgY2FzZSAnaW1hZ2UnOlxuICAgICAgICAgICAgcmV0dXJuIDAgLyogSW1hZ2UgKi87XG4gICAgICAgIGNhc2UgJ21vdmllY2xpcCc6XG4gICAgICAgICAgICByZXR1cm4gMiAvKiBNb3ZpZUNsaXAgKi87XG4gICAgICAgIGNhc2UgJ3NvdW5kJzpcbiAgICAgICAgICAgIHJldHVybiAzIC8qIFNvdW5kICovO1xuICAgICAgICBjYXNlICdjb21wb25lbnQnOlxuICAgICAgICAgICAgcmV0dXJuIDQgLyogQ29tcG9uZW50ICovO1xuICAgICAgICBjYXNlICdzd2YnOlxuICAgICAgICAgICAgcmV0dXJuIDEgLyogU3dmICovO1xuICAgICAgICBjYXNlICdmb250JzpcbiAgICAgICAgICAgIHJldHVybiA2IC8qIEZvbnQgKi87XG4gICAgICAgIGNhc2UgJ2F0bGFzJzpcbiAgICAgICAgICAgIHJldHVybiA3IC8qIEF0bGFzICovO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIDUgLyogTWlzYyAqLztcbiAgICB9XG59XG5mdW5jdGlvbiBQYXJzZVByb2dyZXNzVGl0bGVUeXBlKHZhbHVlKSB7XG4gICAgc3dpdGNoICh2YWx1ZSkge1xuICAgICAgICBjYXNlICdwZXJjZW50JzpcbiAgICAgICAgICAgIHJldHVybiAwIC8qIFBlcmNlbnQgKi87XG4gICAgICAgIGNhc2UgJ3ZhbHVlQW5kbWF4JzpcbiAgICAgICAgICAgIHJldHVybiAxIC8qIFZhbHVlQW5kTWF4ICovO1xuICAgICAgICBjYXNlICd2YWx1ZSc6XG4gICAgICAgICAgICByZXR1cm4gMiAvKiBWYWx1ZSAqLztcbiAgICAgICAgY2FzZSAnbWF4JzpcbiAgICAgICAgICAgIHJldHVybiAzIC8qIE1heCAqLztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiAwIC8qIFBlcmNlbnQgKi87XG4gICAgfVxufVxuZnVuY3Rpb24gUGFyc2VTY3JvbGxCYXJEaXNwbGF5VHlwZSh2YWx1ZSkge1xuICAgIHN3aXRjaCAodmFsdWUpIHtcbiAgICAgICAgY2FzZSAnZGVmYXVsdCc6XG4gICAgICAgICAgICByZXR1cm4gMCAvKiBEZWZhdWx0ICovO1xuICAgICAgICBjYXNlICd2aXNpYmxlJzpcbiAgICAgICAgICAgIHJldHVybiAxIC8qIFZpc2libGUgKi87XG4gICAgICAgIGNhc2UgJ2F1dG8nOlxuICAgICAgICAgICAgcmV0dXJuIDIgLyogQXV0byAqLztcbiAgICAgICAgY2FzZSAnaGlkZGVuJzpcbiAgICAgICAgICAgIHJldHVybiAzIC8qIEhpZGRlbiAqLztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiAwIC8qIERlZmF1bHQgKi87XG4gICAgfVxufVxuZnVuY3Rpb24gUGFyc2VGbGlwVHlwZSh2YWx1ZSkge1xuICAgIHN3aXRjaCAodmFsdWUpIHtcbiAgICAgICAgY2FzZSAnaHonOlxuICAgICAgICAgICAgcmV0dXJuIDEgLyogSG9yaXpvbnRhbCAqLztcbiAgICAgICAgY2FzZSAndnQnOlxuICAgICAgICAgICAgcmV0dXJuIDIgLyogVmVydGljYWwgKi87XG4gICAgICAgIGNhc2UgJ2JvdGgnOlxuICAgICAgICAgICAgcmV0dXJuIDMgLyogQm90aCAqLztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiAwIC8qIE5vbmUgKi87XG4gICAgfVxufVxuZnVuY3Rpb24gUGFyc2VCdXR0b25Nb2RlKHZhbHVlKSB7XG4gICAgc3dpdGNoICh2YWx1ZSkge1xuICAgICAgICBjYXNlICdDb21tb24nOlxuICAgICAgICAgICAgcmV0dXJuIDAgLyogQ29tbW9uICovO1xuICAgICAgICBjYXNlICdDaGVjayc6XG4gICAgICAgICAgICByZXR1cm4gMSAvKiBDaGVjayAqLztcbiAgICAgICAgY2FzZSAnUmFkaW8nOlxuICAgICAgICAgICAgcmV0dXJuIDIgLyogUmFkaW8gKi87XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gMCAvKiBDb21tb24gKi87XG4gICAgfVxufVxuZnVuY3Rpb24gUGFyc2VBdXRvU2l6ZVR5cGUodmFsdWUpIHtcbiAgICBzd2l0Y2ggKHZhbHVlKSB7XG4gICAgICAgIGNhc2UgJ25vbmUnOlxuICAgICAgICAgICAgcmV0dXJuIDAgLyogTm9uZSAqLztcbiAgICAgICAgY2FzZSAnYm90aCc6XG4gICAgICAgICAgICByZXR1cm4gMSAvKiBCb3RoICovO1xuICAgICAgICBjYXNlICdoZWlnaHQnOlxuICAgICAgICAgICAgcmV0dXJuIDIgLyogSGVpZ2h0ICovO1xuICAgICAgICBjYXNlICdzaHJpbmsnOlxuICAgICAgICAgICAgcmV0dXJuIDMgLyogU2hyaW5rICovO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIDAgLyogTm9uZSAqLztcbiAgICB9XG59XG5mdW5jdGlvbiBQYXJzZUFsaWduVHlwZSh2YWx1ZSkge1xuICAgIHN3aXRjaCAodmFsdWUpIHtcbiAgICAgICAgY2FzZSAnbGVmdCc6XG4gICAgICAgICAgICByZXR1cm4gXCJsZWZ0XCIgLyogTGVmdCAqLztcbiAgICAgICAgY2FzZSAnY2VudGVyJzpcbiAgICAgICAgICAgIHJldHVybiBcImNlbnRlclwiIC8qIENlbnRlciAqLztcbiAgICAgICAgY2FzZSAncmlnaHQnOlxuICAgICAgICAgICAgcmV0dXJuIFwicmlnaHRcIiAvKiBSaWdodCAqLztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBcImxlZnRcIiAvKiBMZWZ0ICovO1xuICAgIH1cbn1cbmZ1bmN0aW9uIFBhcnNlVmVydEFsaWduVHlwZSh2YWx1ZSkge1xuICAgIHN3aXRjaCAodmFsdWUpIHtcbiAgICAgICAgY2FzZSAndG9wJzpcbiAgICAgICAgICAgIHJldHVybiAwIC8qIFRvcCAqLztcbiAgICAgICAgY2FzZSAnbWlkZGxlJzpcbiAgICAgICAgICAgIHJldHVybiAxIC8qIE1pZGRsZSAqLztcbiAgICAgICAgY2FzZSAnYm90dG9tJzpcbiAgICAgICAgICAgIHJldHVybiAyIC8qIEJvdHRvbSAqLztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiAwIC8qIFRvcCAqLztcbiAgICB9XG59XG5mdW5jdGlvbiBQYXJzZUxpc3RDaGlsZHJlblJlbmRlck9yZGVyKHZhbHVlKSB7XG4gICAgc3dpdGNoICh2YWx1ZSkge1xuICAgICAgICBjYXNlICdhc2NlbnQnOlxuICAgICAgICAgICAgcmV0dXJuIDAgLyogQXNjZW50ICovO1xuICAgICAgICBjYXNlICdkZXNjZW50JzpcbiAgICAgICAgICAgIHJldHVybiAxIC8qIERlc2NlbnQgKi87XG4gICAgICAgIGNhc2UgJ2FyY2gnOlxuICAgICAgICAgICAgcmV0dXJuIDIgLyogQXJjaCAqLztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiAwIC8qIEFzY2VudCAqLztcbiAgICB9XG59XG5sZXQgZWFzZU1hcCA9IHtcbiAgICBMaW5lYXI6IGNyZWF0ZWpzLkVhc2UubGluZWFyLFxuICAgICdFbGFzdGljLkluJzogY3JlYXRlanMuRWFzZS5lbGFzdGljSW4sXG4gICAgJ0VsYXN0aWMuT3V0JzogY3JlYXRlanMuRWFzZS5lbGFzdGljT3V0LFxuICAgICdFbGFzdGljLkluT3V0JzogY3JlYXRlanMuRWFzZS5lbGFzdGljSW5PdXQsXG4gICAgJ1F1YWQuSW4nOiBjcmVhdGVqcy5FYXNlLnF1YWRJbixcbiAgICAnUXVhZC5PdXQnOiBjcmVhdGVqcy5FYXNlLnF1YWRPdXQsXG4gICAgJ1F1YWQuSW5PdXQnOiBjcmVhdGVqcy5FYXNlLnF1YWRJbk91dCxcbiAgICAnQ3ViZS5Jbic6IGNyZWF0ZWpzLkVhc2UuY3ViaWNJbixcbiAgICAnQ3ViZS5PdXQnOiBjcmVhdGVqcy5FYXNlLmN1YmljT3V0LFxuICAgICdDdWJlLkluT3V0JzogY3JlYXRlanMuRWFzZS5jdWJpY0luT3V0LFxuICAgICdRdWFydC5Jbic6IGNyZWF0ZWpzLkVhc2UucXVhcnRJbixcbiAgICAnUXVhcnQuT3V0JzogY3JlYXRlanMuRWFzZS5xdWFydE91dCxcbiAgICAnUXVhcnQuSW5PdXQnOiBjcmVhdGVqcy5FYXNlLnF1YXJ0SW5PdXQsXG4gICAgJ1F1aW50LkluJzogY3JlYXRlanMuRWFzZS5xdWludEluLFxuICAgICdRdWludC5PdXQnOiBjcmVhdGVqcy5FYXNlLnF1aW50T3V0LFxuICAgICdRdWludC5Jbk91dCc6IGNyZWF0ZWpzLkVhc2UucXVpbnRJbk91dCxcbiAgICAnU2luZS5Jbic6IGNyZWF0ZWpzLkVhc2Uuc2luZUluLFxuICAgICdTaW5lLk91dCc6IGNyZWF0ZWpzLkVhc2Uuc2luZU91dCxcbiAgICAnU2luZS5Jbk91dCc6IGNyZWF0ZWpzLkVhc2Uuc2luZUluT3V0LFxuICAgICdCb3VuY2UuSW4nOiBjcmVhdGVqcy5FYXNlLmJvdW5jZUluLFxuICAgICdCb3VuY2UuT3V0JzogY3JlYXRlanMuRWFzZS5ib3VuY2VPdXQsXG4gICAgJ0JvdW5jZS5Jbk91dCc6IGNyZWF0ZWpzLkVhc2UuYm91bmNlSW5PdXQsXG4gICAgJ0NpcmMuSW4nOiBjcmVhdGVqcy5FYXNlLmNpcmNJbixcbiAgICAnQ2lyYy5PdXQnOiBjcmVhdGVqcy5FYXNlLmNpcmNPdXQsXG4gICAgJ0NpcmMuSW5PdXQnOiBjcmVhdGVqcy5FYXNlLmNpcmNJbk91dCxcbiAgICAnRXhwby5Jbic6IGNyZWF0ZWpzLkVhc2UucXVhcnRJbixcbiAgICAnRXhwby5PdXQnOiBjcmVhdGVqcy5FYXNlLnF1YXJ0T3V0LFxuICAgICdFeHBvLkluT3V0JzogY3JlYXRlanMuRWFzZS5xdWFydEluT3V0LFxuICAgICdCYWNrLkluJzogY3JlYXRlanMuRWFzZS5iYWNrSW4sXG4gICAgJ0JhY2suT3V0JzogY3JlYXRlanMuRWFzZS5iYWNrT3V0LFxuICAgICdCYWNrLkluT3V0JzogY3JlYXRlanMuRWFzZS5iYWNrSW5PdXRcbn07XG5mdW5jdGlvbiBQYXJzZUVhc2VUeXBlKG5hbWUpIHtcbiAgICByZXR1cm4gZWFzZU1hcFtuYW1lXSB8fCBlYXNlTWFwWydMaW5lYXInXTtcbn1cblxuLyoqZ2xvYmFsIHVpIGNvbmZpZ3VyYXRpb24gKi9cbmNsYXNzIFVJQ29uZmlnIHtcbn1cbi8qKmRlZmF1bHQgZm9udCBuYW1lIG9mIHlvdXIgcHJvamVjdC4gKi9cblVJQ29uZmlnLmRlZmF1bHRGb250ID0gXCJBcmlhbFwiO1xuLyoqIG1vZGFsIGxheWVyIGJhY2tncm91bmQgY29uZmlndXJhdGlvbi4gKi9cblVJQ29uZmlnLm1vZGFsTGF5ZXJDb2xvciA9IFwiIzMzMzMzM1wiO1xuVUlDb25maWcubW9kYWxMYXllckFscGhhID0gMC4yO1xuVUlDb25maWcuYnV0dG9uU291bmRWb2x1bWVTY2FsZSA9IDE7XG4vKiogc2Nyb2xsaW5nIGRpc3RhbmNlIHBlciBhY3Rpb24gaW4gcGl4ZWwqL1xuVUlDb25maWcuZGVmYXVsdFNjcm9sbFNwZWVkID0gMjU7XG4vKiogZGVmYXVsdCBzY3JvbGxiYXIgZGlzcGxheSBtb2RlLiBJdCdzIHJlY29tbWVuZGVkIHRvIHNldCBTY3JvbGxCYXJEaXNwbGF5VHlwZS5WaXNpYmxlIGZvciBEZXNrdG9wIGVudmlyb25tZW50IGFuZCBTY3JvbGxCYXJEaXNwbGF5VHlwZS5BdXRvIGZvciBtb2JpbGUgZW52aXJvbm1lbnQuKi9cblVJQ29uZmlnLmRlZmF1bHRTY3JvbGxCYXJEaXNwbGF5ID0gMSAvKiBWaXNpYmxlICovO1xuLyoqIGFsbG93IHVzZXIgdG8gZHJhZyB0aGUgY29udGVudCBvZiBhIGNvbnRhaW5lci4gU2V0IHRvIHRydWUgZm9yIG1vYmlsZSBpcyByZWNvbW1lbmRlZC4qL1xuVUlDb25maWcuZGVmYXVsdFNjcm9sbFRvdWNoRWZmZWN0ID0gdHJ1ZTtcbi8qKiBlbmFibGUgYm91bmNlIGVmZmVjdCB3aGVuIHRoZSBzY3JvbGxpbmcgcmVhY2hlcyB0byB0aGUgZWRnZSBvZiBhIGNvbnRhaW5lci4gU2V0IHRvIHRydWUgZm9yIG1vYmlsZSBpcyByZWNvbW1lbmRlZC4qL1xuVUlDb25maWcuZGVmYXVsdFNjcm9sbEJvdW5jZUVmZmVjdCA9IHRydWU7XG4vKiogRGVjZWxlcmF0aW9uIHJhdGlvIG9mIHNjcm9sbHBhbmUgd2hlbiBpdHMgaW4gdG91Y2ggZHJhZ2dpbmcuKi9cblVJQ29uZmlnLmRlZmF1bHRTY3JvbGxEZWNlbGVyYXRpb25SYXRlID0gLjk2Nztcbi8qKiBtYXhpbXVtIGNvdW50IG9mIGl0ZW1zIHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgdmlzaWJsZSB2aWV3cG9ydCBvZiB0aGUgR0NvbWJvYm94LiovXG5VSUNvbmZpZy5kZWZhdWx0Q29tYm9Cb3hWaXNpYmxlSXRlbUNvdW50ID0gMTA7XG4vKiogdGhlIGZpbmdlciBtb3ZpbmcgdGhyZXNob2xkIGluIHBpeGVsIHRvIHRyaWdnZXIgdGhlIHNjcm9sbGluZyBhY3Rpb24uKi9cblVJQ29uZmlnLnRvdWNoU2Nyb2xsU2Vuc2l0aXZpdHkgPSAyMDtcbi8qKiB0aGUgZmluZ2VyIG1vdmluZyB0aHJlc2hvbGQgaW4gcGl4ZWwgdG8gdHJpZ2dlciB0aGUgZHJhZ2dpbmcgZXZlbnQuKi9cblVJQ29uZmlnLnRvdWNoRHJhZ1NlbnNpdGl2aXR5ID0gMTA7XG4vKiogYXV0byBicmluZyB0aGUgd2luZG93IHlvdSBjbGlja2VkIHRvIHRoZSB0b3Btb3N0IGxldmVsIG9mIHRoZSBHUm9vdCBjaGlsZHJlbiBsaXN0LiovXG5VSUNvbmZpZy5icmluZ1dpbmRvd1RvRnJvbnRPbkNsaWNrID0gdHJ1ZTtcblxuY2xhc3MgR2VhckJhc2Uge1xuICAgIGNvbnN0cnVjdG9yKG93bmVyKSB7XG4gICAgICAgIHRoaXMuJGxvY2tUb2tlbiA9IDA7XG4gICAgICAgIHRoaXMuJG93bmVyID0gb3duZXI7XG4gICAgICAgIHRoaXMuJGVhc2VUeXBlID0gUGFyc2VFYXNlVHlwZSgnUXVhZC5PdXQnKTtcbiAgICAgICAgdGhpcy4kdHdlZW5UaW1lID0gMC4zO1xuICAgICAgICB0aGlzLiR0d2VlbkRlbGF5ID0gMDtcbiAgICB9XG4gICAgZ2V0IGNvbnRyb2xsZXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRjb250cm9sbGVyO1xuICAgIH1cbiAgICBzZXQgY29udHJvbGxlcih2YWwpIHtcbiAgICAgICAgaWYgKHZhbCAhPSB0aGlzLiRjb250cm9sbGVyKSB7XG4gICAgICAgICAgICB0aGlzLiRjb250cm9sbGVyID0gdmFsO1xuICAgICAgICAgICAgaWYgKHRoaXMuJGNvbnRyb2xsZXIpXG4gICAgICAgICAgICAgICAgdGhpcy5pbml0KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHR3ZWVuKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kdHdlZW47XG4gICAgfVxuICAgIHNldCB0d2Vlbih2YWwpIHtcbiAgICAgICAgdGhpcy4kdHdlZW4gPSB2YWw7XG4gICAgfVxuICAgIGdldCB0d2VlbkRlbGF5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kdHdlZW5EZWxheTtcbiAgICB9XG4gICAgc2V0IHR3ZWVuRGVsYXkodmFsKSB7XG4gICAgICAgIHRoaXMuJHR3ZWVuRGVsYXkgPSB2YWw7XG4gICAgfVxuICAgIGdldCB0d2VlblRpbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR0d2VlblRpbWU7XG4gICAgfVxuICAgIHNldCB0d2VlblRpbWUodmFsdWUpIHtcbiAgICAgICAgdGhpcy4kdHdlZW5UaW1lID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCBlYXNlVHlwZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGVhc2VUeXBlO1xuICAgIH1cbiAgICBzZXQgZWFzZVR5cGUodmFsdWUpIHtcbiAgICAgICAgdGhpcy4kZWFzZVR5cGUgPSB2YWx1ZTtcbiAgICB9XG4gICAgc2V0dXAoeG1sKSB7XG4gICAgICAgIHRoaXMuJGNvbnRyb2xsZXIgPSB0aGlzLiRvd25lci5wYXJlbnQuZ2V0Q29udHJvbGxlcih4bWwuYXR0cmlidXRlcy5jb250cm9sbGVyKTtcbiAgICAgICAgaWYgKHRoaXMuJGNvbnRyb2xsZXIgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy5pbml0KCk7XG4gICAgICAgIGxldCBzdHI7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnR3ZWVuO1xuICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgdGhpcy4kdHdlZW4gPSB0cnVlO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5lYXNlO1xuICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgdGhpcy4kZWFzZVR5cGUgPSBQYXJzZUVhc2VUeXBlKHN0cik7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmR1cmF0aW9uO1xuICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgdGhpcy4kdHdlZW5UaW1lID0gcGFyc2VGbG9hdChzdHIpO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5kZWxheTtcbiAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgIHRoaXMuJHR3ZWVuRGVsYXkgPSBwYXJzZUZsb2F0KHN0cik7XG4gICAgICAgIGlmICh0aGlzWyckdmlkJ10gIT0gbnVsbCkge1xuICAgICAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMucGFnZXM7XG4gICAgICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgICAgIHRoaXNbJ3BhZ2VzJ10gPSBzdHIuc3BsaXQoJywnKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGxldCBwYWdlcztcbiAgICAgICAgICAgIGxldCB2YWx1ZXM7XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5wYWdlcztcbiAgICAgICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICAgICAgcGFnZXMgPSBzdHIuc3BsaXQoJywnKTtcbiAgICAgICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnZhbHVlcztcbiAgICAgICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICAgICAgdmFsdWVzID0gc3RyLnNwbGl0KCd8Jyk7XG4gICAgICAgICAgICBpZiAocGFnZXMgJiYgdmFsdWVzKSB7XG4gICAgICAgICAgICAgICAgdmFsdWVzLmZvckVhY2goKHMsIGkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRTdGF0dXMocGFnZXNbaV0sIHMpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMuZGVmYXVsdDtcbiAgICAgICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICAgICAgdGhpcy5hZGRTdGF0dXMobnVsbCwgc3RyKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB1cGRhdGVGcm9tUmVsYXRpb25zKGR4LCBkeSkgeyB9XG4gICAgYWRkU3RhdHVzKHBhZ2VJZCwgdmFsdWUpIHsgfVxuICAgIGluaXQoKSB7IH1cbiAgICBhcHBseSgpIHsgfVxuICAgIHVwZGF0ZVN0YXRlKCkgeyB9XG59XG5HZWFyQmFzZS5kaXNhYmxlQWxsVHdlZW5FZmZlY3QgPSBmYWxzZTtcblxuY2xhc3MgR2VhckRpc3BsYXkgZXh0ZW5kcyBHZWFyQmFzZSB7XG4gICAgY29uc3RydWN0b3Iob3duZXIpIHtcbiAgICAgICAgc3VwZXIob3duZXIpO1xuICAgICAgICB0aGlzLiR2aWQgPSAwO1xuICAgICAgICB0aGlzLiRsb2NrVG9rZW4gPSAxO1xuICAgIH1cbiAgICBpbml0KCkge1xuICAgICAgICB0aGlzLnBhZ2VzID0gbnVsbDtcbiAgICB9XG4gICAgbG9jaygpIHtcbiAgICAgICAgdGhpcy4kdmlkKys7XG4gICAgICAgIHJldHVybiB0aGlzLiRsb2NrVG9rZW47XG4gICAgfVxuICAgIHJlbGVhc2UodG9rZW4pIHtcbiAgICAgICAgaWYgKHRva2VuID09IHRoaXMuJGxvY2tUb2tlbilcbiAgICAgICAgICAgIHRoaXMuJHZpZC0tO1xuICAgIH1cbiAgICBnZXQgY29ubmVjdGVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb250cm9sbGVyID09IG51bGwgfHwgdGhpcy4kdmlkID4gMDtcbiAgICB9XG4gICAgYXBwbHkoKSB7XG4gICAgICAgIHRoaXMuJGxvY2tUb2tlbisrO1xuICAgICAgICBpZiAodGhpcy4kbG9ja1Rva2VuIDw9IDApXG4gICAgICAgICAgICB0aGlzLiRsb2NrVG9rZW4gPSAxO1xuICAgICAgICBpZiAodGhpcy5wYWdlcyA9PSBudWxsIHx8XG4gICAgICAgICAgICB0aGlzLnBhZ2VzLmxlbmd0aCA9PSAwIHx8XG4gICAgICAgICAgICB0aGlzLnBhZ2VzLmluZGV4T2YodGhpcy4kY29udHJvbGxlci5zZWxlY3RlZFBhZ2VJZCkgIT0gLTEpXG4gICAgICAgICAgICB0aGlzLiR2aWQgPSAxO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLiR2aWQgPSAwO1xuICAgIH1cbn1cblxuY2xhc3MgQk1HbHlwaCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMueCA9IDA7XG4gICAgICAgIHRoaXMueSA9IDA7XG4gICAgICAgIHRoaXMub2Zmc2V0WCA9IDA7XG4gICAgICAgIHRoaXMub2Zmc2V0WSA9IDA7XG4gICAgICAgIHRoaXMud2lkdGggPSAwO1xuICAgICAgICB0aGlzLmhlaWdodCA9IDA7XG4gICAgICAgIHRoaXMuYWR2YW5jZSA9IDA7XG4gICAgICAgIHRoaXMubGluZUhlaWdodCA9IDA7XG4gICAgICAgIHRoaXMuY2hhbm5lbCA9IDA7XG4gICAgfVxufVxuY2xhc3MgQml0bWFwRm9udCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuc2l6ZSA9IDA7XG4gICAgICAgIHRoaXMuZ2x5cGhzID0ge307XG4gICAgfVxufVxuXG5jbGFzcyBGcmFtZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuYWRkRGVsYXkgPSAwO1xuICAgIH1cbn1cblxuY2xhc3MgQXNzZXRMb2FkZXIgZXh0ZW5kcyBjcmVhdGVqcy5Mb2FkUXVldWUge1xuICAgIGNvbnN0cnVjdG9yKHByZWZlclhIUiwgYmFzZVBhdGgsIGNyb3NzT3JpZ2luKSB7XG4gICAgICAgIHN1cGVyKHByZWZlclhIUiwgYmFzZVBhdGgpO1xuICAgICAgICB0aGlzLm9uKCdjb21wbGV0ZScsIHRoaXMuX29uQ29tcGxldGUsIHRoaXMpO1xuICAgIH1cbiAgICBfb25Db21wbGV0ZShldmVudCkge1xuICAgICAgICB2YXIgbG9hZGVyID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICB2YXIgcmVzdWx0ID0gbG9hZGVyW1wiX2xvYWRlZFJlc3VsdHNcIl07XG4gICAgICAgIEFzc2V0TG9hZGVyLmFkZFJlc291cmNlcyhyZXN1bHQpO1xuICAgIH1cbiAgICA7XG4gICAgc3RhdGljIGdldCByZXNvdXJjZXNQb29sKCkge1xuICAgICAgICByZXR1cm4gQXNzZXRMb2FkZXIuJHJlc291cmNlcztcbiAgICB9XG4gICAgc3RhdGljIGRlc3Ryb3lSZXNvdXJjZShrZXkpIHtcbiAgICAgICAgbGV0IHJlcyA9IEFzc2V0TG9hZGVyLiRyZXNvdXJjZXNba2V5XTtcbiAgICAgICAgaWYgKHJlcykge1xuICAgICAgICAgICAgZGVsZXRlIEFzc2V0TG9hZGVyLiRyZXNvdXJjZXNba2V5XTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzdGF0aWMgYWRkUmVzb3VyY2VzKHJlcykge1xuICAgICAgICBpZiAoIXJlcylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgZm9yIChsZXQga2V5IGluIHJlcykgLy9vdmVycmlkZSB0aGUgaXRlbSB3aGljaCBoYXMgc2FtZSBrZXkgbmFtZVxuICAgICAgICAgICAgQXNzZXRMb2FkZXIuJHJlc291cmNlc1trZXldID0gcmVzW2tleV07XG4gICAgfVxufVxuQXNzZXRMb2FkZXIuJHJlc291cmNlcyA9IHt9O1xuXG5jbGFzcyBFbmRpYW4ge1xufVxuRW5kaWFuLkxJVFRMRV9FTkRJQU4gPSBcImxpdHRsZUVuZGlhblwiO1xuRW5kaWFuLkJJR19FTkRJQU4gPSBcImJpZ0VuZGlhblwiO1xuY2xhc3MgQnl0ZUFycmF5IHtcbiAgICBjb25zdHJ1Y3RvcihidWZmZXIsIGJ1ZmZlckV4dFNpemUgPSAwKSB7XG4gICAgICAgIHRoaXMuYnVmZmVyRXh0U2l6ZSA9IDA7IC8vQnVmZmVyIGV4cGFuc2lvbiBzaXplXG4gICAgICAgIHRoaXMuRU9GX2J5dGUgPSAtMTtcbiAgICAgICAgdGhpcy5FT0ZfY29kZV9wb2ludCA9IC0xO1xuICAgICAgICBpZiAoYnVmZmVyRXh0U2l6ZSA8IDApIHtcbiAgICAgICAgICAgIGJ1ZmZlckV4dFNpemUgPSAwO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYnVmZmVyRXh0U2l6ZSA9IGJ1ZmZlckV4dFNpemU7XG4gICAgICAgIGxldCBieXRlcywgd3BvcyA9IDA7XG4gICAgICAgIGlmIChidWZmZXIpIHsgLy/mnInmlbDmja7vvIzliJnlj6/lhpnlrZfoioLmlbDku47lrZfoioLlsL7lvIDlp4tcbiAgICAgICAgICAgIGxldCB1aW50ODtcbiAgICAgICAgICAgIGlmIChidWZmZXIgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7XG4gICAgICAgICAgICAgICAgdWludDggPSBidWZmZXI7XG4gICAgICAgICAgICAgICAgd3BvcyA9IGJ1ZmZlci5sZW5ndGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB3cG9zID0gYnVmZmVyLmJ5dGVMZW5ndGg7XG4gICAgICAgICAgICAgICAgdWludDggPSBuZXcgVWludDhBcnJheShidWZmZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGJ1ZmZlckV4dFNpemUgPT0gMCkge1xuICAgICAgICAgICAgICAgIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkod3Bvcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsZXQgbXVsdGkgPSAod3BvcyAvIGJ1ZmZlckV4dFNpemUgfCAwKSArIDE7XG4gICAgICAgICAgICAgICAgYnl0ZXMgPSBuZXcgVWludDhBcnJheShtdWx0aSAqIGJ1ZmZlckV4dFNpemUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnl0ZXMuc2V0KHVpbnQ4KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyRXh0U2l6ZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy53cml0ZV9wb3NpdGlvbiA9IHdwb3M7XG4gICAgICAgIHRoaXMuX3Bvc2l0aW9uID0gMDtcbiAgICAgICAgdGhpcy5fYnl0ZXMgPSBieXRlcztcbiAgICAgICAgdGhpcy5kYXRhID0gbmV3IERhdGFWaWV3KGJ5dGVzLmJ1ZmZlcik7XG4gICAgICAgIHRoaXMuZW5kaWFuID0gRW5kaWFuLkJJR19FTkRJQU47XG4gICAgfVxuICAgIGdldCBlbmRpYW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRlbmRpYW4gPT0gMCAvKiBMSVRUTEVfRU5ESUFOICovID8gRW5kaWFuLkxJVFRMRV9FTkRJQU4gOiBFbmRpYW4uQklHX0VORElBTjtcbiAgICB9XG4gICAgc2V0IGVuZGlhbih2YWx1ZSkge1xuICAgICAgICB0aGlzLiRlbmRpYW4gPSB2YWx1ZSA9PSBFbmRpYW4uTElUVExFX0VORElBTiA/IDAgLyogTElUVExFX0VORElBTiAqLyA6IDEgLyogQklHX0VORElBTiAqLztcbiAgICB9XG4gICAgZ2V0IHJlYWRBdmFpbGFibGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndyaXRlX3Bvc2l0aW9uIC0gdGhpcy5fcG9zaXRpb247XG4gICAgfVxuICAgIGdldCBidWZmZXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEuYnVmZmVyLnNsaWNlKDAsIHRoaXMud3JpdGVfcG9zaXRpb24pO1xuICAgIH1cbiAgICBnZXQgcmF3QnVmZmVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhLmJ1ZmZlcjtcbiAgICB9XG4gICAgc2V0IGJ1ZmZlcih2YWx1ZSkge1xuICAgICAgICBsZXQgd3BvcyA9IHZhbHVlLmJ5dGVMZW5ndGg7XG4gICAgICAgIGxldCB1aW50OCA9IG5ldyBVaW50OEFycmF5KHZhbHVlKTtcbiAgICAgICAgbGV0IGJ1ZmZlckV4dFNpemUgPSB0aGlzLmJ1ZmZlckV4dFNpemU7XG4gICAgICAgIGxldCBieXRlcztcbiAgICAgICAgaWYgKGJ1ZmZlckV4dFNpemUgPT0gMCkge1xuICAgICAgICAgICAgYnl0ZXMgPSBuZXcgVWludDhBcnJheSh3cG9zKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGxldCBtdWx0aSA9ICh3cG9zIC8gYnVmZmVyRXh0U2l6ZSB8IDApICsgMTtcbiAgICAgICAgICAgIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkobXVsdGkgKiBidWZmZXJFeHRTaXplKTtcbiAgICAgICAgfVxuICAgICAgICBieXRlcy5zZXQodWludDgpO1xuICAgICAgICB0aGlzLndyaXRlX3Bvc2l0aW9uID0gd3BvcztcbiAgICAgICAgdGhpcy5fYnl0ZXMgPSBieXRlcztcbiAgICAgICAgdGhpcy5kYXRhID0gbmV3IERhdGFWaWV3KGJ5dGVzLmJ1ZmZlcik7XG4gICAgfVxuICAgIGdldCBieXRlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2J5dGVzO1xuICAgIH1cbiAgICBnZXQgZGF0YVZpZXcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGE7XG4gICAgfVxuICAgIHNldCBkYXRhVmlldyh2YWx1ZSkge1xuICAgICAgICB0aGlzLmJ1ZmZlciA9IHZhbHVlLmJ1ZmZlcjtcbiAgICB9XG4gICAgZ2V0IGJ1ZmZlck9mZnNldCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5ieXRlT2Zmc2V0O1xuICAgIH1cbiAgICBnZXQgcG9zaXRpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbjtcbiAgICB9XG4gICAgc2V0IHBvc2l0aW9uKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3Bvc2l0aW9uID0gdmFsdWU7XG4gICAgICAgIGlmICh2YWx1ZSA+IHRoaXMud3JpdGVfcG9zaXRpb24pIHtcbiAgICAgICAgICAgIHRoaXMud3JpdGVfcG9zaXRpb24gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgbGVuZ3RoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy53cml0ZV9wb3NpdGlvbjtcbiAgICB9XG4gICAgc2V0IGxlbmd0aCh2YWx1ZSkge1xuICAgICAgICB0aGlzLndyaXRlX3Bvc2l0aW9uID0gdmFsdWU7XG4gICAgICAgIGlmICh0aGlzLmRhdGEuYnl0ZUxlbmd0aCA+IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLl9wb3NpdGlvbiA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3ZhbGlkYXRlQnVmZmVyKHZhbHVlKTtcbiAgICB9XG4gICAgX3ZhbGlkYXRlQnVmZmVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLmRhdGEuYnl0ZUxlbmd0aCA8IHZhbHVlKSB7XG4gICAgICAgICAgICBsZXQgYmUgPSB0aGlzLmJ1ZmZlckV4dFNpemU7XG4gICAgICAgICAgICBsZXQgdG1wO1xuICAgICAgICAgICAgaWYgKGJlID09IDApIHtcbiAgICAgICAgICAgICAgICB0bXAgPSBuZXcgVWludDhBcnJheSh2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsZXQgbkxlbiA9ICgodmFsdWUgLyBiZSA+PiAwKSArIDEpICogYmU7XG4gICAgICAgICAgICAgICAgdG1wID0gbmV3IFVpbnQ4QXJyYXkobkxlbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0bXAuc2V0KHRoaXMuX2J5dGVzKTtcbiAgICAgICAgICAgIHRoaXMuX2J5dGVzID0gdG1wO1xuICAgICAgICAgICAgdGhpcy5kYXRhID0gbmV3IERhdGFWaWV3KHRtcC5idWZmZXIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBieXRlc0F2YWlsYWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5ieXRlTGVuZ3RoIC0gdGhpcy5fcG9zaXRpb247XG4gICAgfVxuICAgIGNsZWFyKCkge1xuICAgICAgICBsZXQgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKHRoaXMuYnVmZmVyRXh0U2l6ZSk7XG4gICAgICAgIHRoaXMuZGF0YSA9IG5ldyBEYXRhVmlldyhidWZmZXIpO1xuICAgICAgICB0aGlzLl9ieXRlcyA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlcik7XG4gICAgICAgIHRoaXMuX3Bvc2l0aW9uID0gMDtcbiAgICAgICAgdGhpcy53cml0ZV9wb3NpdGlvbiA9IDA7XG4gICAgfVxuICAgIHJlYWRCb29sZWFuKCkge1xuICAgICAgICBpZiAodGhpcy52YWxpZGF0ZSgxIC8qIFNJWkVfT0ZfQk9PTEVBTiAqLykpXG4gICAgICAgICAgICByZXR1cm4gISF0aGlzLl9ieXRlc1t0aGlzLnBvc2l0aW9uKytdO1xuICAgIH1cbiAgICByZWFkQnl0ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMudmFsaWRhdGUoMSAvKiBTSVpFX09GX0lOVDggKi8pKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5nZXRJbnQ4KHRoaXMucG9zaXRpb24rKyk7XG4gICAgfVxuICAgIHJlYWRCeXRlcyhieXRlcywgb2Zmc2V0ID0gMCwgbGVuZ3RoID0gMCkge1xuICAgICAgICBpZiAoIWJ5dGVzKSB7IC8v55Sx5LqOYnl0ZXPkuI3ov5Tlm57vvIzmiYDku6VuZXfmlrDnmoTml6DmhI/kuYlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgcG9zID0gdGhpcy5fcG9zaXRpb247XG4gICAgICAgIGxldCBhdmFpbGFibGUgPSB0aGlzLndyaXRlX3Bvc2l0aW9uIC0gcG9zO1xuICAgICAgICBpZiAoYXZhaWxhYmxlIDwgMCkge1xuICAgICAgICAgICAgLy8gZWdyZXQuJGVycm9yKDEwMjUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgbGVuZ3RoID0gYXZhaWxhYmxlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGxlbmd0aCA+IGF2YWlsYWJsZSkge1xuICAgICAgICAgICAgLy8gZWdyZXQuJGVycm9yKDEwMjUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gYnl0ZXMuX3Bvc2l0aW9uO1xuICAgICAgICBieXRlcy5fcG9zaXRpb24gPSAwO1xuICAgICAgICBieXRlcy52YWxpZGF0ZUJ1ZmZlcihvZmZzZXQgKyBsZW5ndGgpO1xuICAgICAgICBieXRlcy5fcG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgYnl0ZXMuX2J5dGVzLnNldCh0aGlzLl9ieXRlcy5zdWJhcnJheShwb3MsIHBvcyArIGxlbmd0aCksIG9mZnNldCk7XG4gICAgICAgIHRoaXMucG9zaXRpb24gKz0gbGVuZ3RoO1xuICAgIH1cbiAgICByZWFkRG91YmxlKCkge1xuICAgICAgICBpZiAodGhpcy52YWxpZGF0ZSg4IC8qIFNJWkVfT0ZfRkxPQVQ2NCAqLykpIHtcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IHRoaXMuZGF0YS5nZXRGbG9hdDY0KHRoaXMuX3Bvc2l0aW9uLCB0aGlzLiRlbmRpYW4gPT0gMCAvKiBMSVRUTEVfRU5ESUFOICovKTtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb24gKz0gOCAvKiBTSVpFX09GX0ZMT0FUNjQgKi87XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVhZEZsb2F0KCkge1xuICAgICAgICBpZiAodGhpcy52YWxpZGF0ZSg0IC8qIFNJWkVfT0ZfRkxPQVQzMiAqLykpIHtcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IHRoaXMuZGF0YS5nZXRGbG9hdDMyKHRoaXMuX3Bvc2l0aW9uLCB0aGlzLiRlbmRpYW4gPT0gMCAvKiBMSVRUTEVfRU5ESUFOICovKTtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb24gKz0gNCAvKiBTSVpFX09GX0ZMT0FUMzIgKi87XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVhZEludCgpIHtcbiAgICAgICAgaWYgKHRoaXMudmFsaWRhdGUoNCAvKiBTSVpFX09GX0lOVDMyICovKSkge1xuICAgICAgICAgICAgbGV0IHZhbHVlID0gdGhpcy5kYXRhLmdldEludDMyKHRoaXMuX3Bvc2l0aW9uLCB0aGlzLiRlbmRpYW4gPT0gMCAvKiBMSVRUTEVfRU5ESUFOICovKTtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb24gKz0gNCAvKiBTSVpFX09GX0lOVDMyICovO1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlYWRTaG9ydCgpIHtcbiAgICAgICAgaWYgKHRoaXMudmFsaWRhdGUoMiAvKiBTSVpFX09GX0lOVDE2ICovKSkge1xuICAgICAgICAgICAgbGV0IHZhbHVlID0gdGhpcy5kYXRhLmdldEludDE2KHRoaXMuX3Bvc2l0aW9uLCB0aGlzLiRlbmRpYW4gPT0gMCAvKiBMSVRUTEVfRU5ESUFOICovKTtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb24gKz0gMiAvKiBTSVpFX09GX0lOVDE2ICovO1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlYWRVbnNpZ25lZEJ5dGUoKSB7XG4gICAgICAgIGlmICh0aGlzLnZhbGlkYXRlKDEgLyogU0laRV9PRl9VSU5UOCAqLykpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fYnl0ZXNbdGhpcy5wb3NpdGlvbisrXTtcbiAgICB9XG4gICAgcmVhZFVuc2lnbmVkSW50KCkge1xuICAgICAgICBpZiAodGhpcy52YWxpZGF0ZSg0IC8qIFNJWkVfT0ZfVUlOVDMyICovKSkge1xuICAgICAgICAgICAgbGV0IHZhbHVlID0gdGhpcy5kYXRhLmdldFVpbnQzMih0aGlzLl9wb3NpdGlvbiwgdGhpcy4kZW5kaWFuID09IDAgLyogTElUVExFX0VORElBTiAqLyk7XG4gICAgICAgICAgICB0aGlzLnBvc2l0aW9uICs9IDQgLyogU0laRV9PRl9VSU5UMzIgKi87XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVhZFVuc2lnbmVkU2hvcnQoKSB7XG4gICAgICAgIGlmICh0aGlzLnZhbGlkYXRlKDIgLyogU0laRV9PRl9VSU5UMTYgKi8pKSB7XG4gICAgICAgICAgICBsZXQgdmFsdWUgPSB0aGlzLmRhdGEuZ2V0VWludDE2KHRoaXMuX3Bvc2l0aW9uLCB0aGlzLiRlbmRpYW4gPT0gMCAvKiBMSVRUTEVfRU5ESUFOICovKTtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb24gKz0gMiAvKiBTSVpFX09GX1VJTlQxNiAqLztcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZWFkVVRGKCkge1xuICAgICAgICBsZXQgbGVuZ3RoID0gdGhpcy5yZWFkVW5zaWduZWRTaG9ydCgpO1xuICAgICAgICBpZiAobGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVhZFVURkJ5dGVzKGxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZWFkVVRGQnl0ZXMobGVuZ3RoKSB7XG4gICAgICAgIGlmICghdGhpcy52YWxpZGF0ZShsZW5ndGgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGRhdGEgPSB0aGlzLmRhdGE7XG4gICAgICAgIGxldCBieXRlcyA9IG5ldyBVaW50OEFycmF5KGRhdGEuYnVmZmVyLCBkYXRhLmJ5dGVPZmZzZXQgKyB0aGlzLl9wb3NpdGlvbiwgbGVuZ3RoKTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiArPSBsZW5ndGg7XG4gICAgICAgIHJldHVybiB0aGlzLmRlY29kZVVURjgoYnl0ZXMpO1xuICAgIH1cbiAgICB3cml0ZUJvb2xlYW4odmFsdWUpIHtcbiAgICAgICAgdGhpcy52YWxpZGF0ZUJ1ZmZlcigxIC8qIFNJWkVfT0ZfQk9PTEVBTiAqLyk7XG4gICAgICAgIHRoaXMuX2J5dGVzW3RoaXMucG9zaXRpb24rK10gPSArdmFsdWU7XG4gICAgfVxuICAgIHdyaXRlQnl0ZSh2YWx1ZSkge1xuICAgICAgICB0aGlzLnZhbGlkYXRlQnVmZmVyKDEgLyogU0laRV9PRl9JTlQ4ICovKTtcbiAgICAgICAgdGhpcy5fYnl0ZXNbdGhpcy5wb3NpdGlvbisrXSA9IHZhbHVlICYgMHhmZjtcbiAgICB9XG4gICAgd3JpdGVCeXRlcyhieXRlcywgb2Zmc2V0ID0gMCwgbGVuZ3RoID0gMCkge1xuICAgICAgICBsZXQgd3JpdGVMZW5ndGg7XG4gICAgICAgIGlmIChvZmZzZXQgPCAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxlbmd0aCA8IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChsZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgd3JpdGVMZW5ndGggPSBieXRlcy5sZW5ndGggLSBvZmZzZXQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB3cml0ZUxlbmd0aCA9IE1hdGgubWluKGJ5dGVzLmxlbmd0aCAtIG9mZnNldCwgbGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAod3JpdGVMZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLnZhbGlkYXRlQnVmZmVyKHdyaXRlTGVuZ3RoKTtcbiAgICAgICAgICAgIHRoaXMuX2J5dGVzLnNldChieXRlcy5fYnl0ZXMuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyB3cml0ZUxlbmd0aCksIHRoaXMuX3Bvc2l0aW9uKTtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSB0aGlzLl9wb3NpdGlvbiArIHdyaXRlTGVuZ3RoO1xuICAgICAgICB9XG4gICAgfVxuICAgIHdyaXRlRG91YmxlKHZhbHVlKSB7XG4gICAgICAgIHRoaXMudmFsaWRhdGVCdWZmZXIoOCAvKiBTSVpFX09GX0ZMT0FUNjQgKi8pO1xuICAgICAgICB0aGlzLmRhdGEuc2V0RmxvYXQ2NCh0aGlzLl9wb3NpdGlvbiwgdmFsdWUsIHRoaXMuJGVuZGlhbiA9PSAwIC8qIExJVFRMRV9FTkRJQU4gKi8pO1xuICAgICAgICB0aGlzLnBvc2l0aW9uICs9IDggLyogU0laRV9PRl9GTE9BVDY0ICovO1xuICAgIH1cbiAgICB3cml0ZUZsb2F0KHZhbHVlKSB7XG4gICAgICAgIHRoaXMudmFsaWRhdGVCdWZmZXIoNCAvKiBTSVpFX09GX0ZMT0FUMzIgKi8pO1xuICAgICAgICB0aGlzLmRhdGEuc2V0RmxvYXQzMih0aGlzLl9wb3NpdGlvbiwgdmFsdWUsIHRoaXMuJGVuZGlhbiA9PSAwIC8qIExJVFRMRV9FTkRJQU4gKi8pO1xuICAgICAgICB0aGlzLnBvc2l0aW9uICs9IDQgLyogU0laRV9PRl9GTE9BVDMyICovO1xuICAgIH1cbiAgICB3cml0ZUludCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnZhbGlkYXRlQnVmZmVyKDQgLyogU0laRV9PRl9JTlQzMiAqLyk7XG4gICAgICAgIHRoaXMuZGF0YS5zZXRJbnQzMih0aGlzLl9wb3NpdGlvbiwgdmFsdWUsIHRoaXMuJGVuZGlhbiA9PSAwIC8qIExJVFRMRV9FTkRJQU4gKi8pO1xuICAgICAgICB0aGlzLnBvc2l0aW9uICs9IDQgLyogU0laRV9PRl9JTlQzMiAqLztcbiAgICB9XG4gICAgd3JpdGVTaG9ydCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnZhbGlkYXRlQnVmZmVyKDIgLyogU0laRV9PRl9JTlQxNiAqLyk7XG4gICAgICAgIHRoaXMuZGF0YS5zZXRJbnQxNih0aGlzLl9wb3NpdGlvbiwgdmFsdWUsIHRoaXMuJGVuZGlhbiA9PSAwIC8qIExJVFRMRV9FTkRJQU4gKi8pO1xuICAgICAgICB0aGlzLnBvc2l0aW9uICs9IDIgLyogU0laRV9PRl9JTlQxNiAqLztcbiAgICB9XG4gICAgd3JpdGVVbnNpZ25lZEludCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnZhbGlkYXRlQnVmZmVyKDQgLyogU0laRV9PRl9VSU5UMzIgKi8pO1xuICAgICAgICB0aGlzLmRhdGEuc2V0VWludDMyKHRoaXMuX3Bvc2l0aW9uLCB2YWx1ZSwgdGhpcy4kZW5kaWFuID09IDAgLyogTElUVExFX0VORElBTiAqLyk7XG4gICAgICAgIHRoaXMucG9zaXRpb24gKz0gNCAvKiBTSVpFX09GX1VJTlQzMiAqLztcbiAgICB9XG4gICAgd3JpdGVVbnNpZ25lZFNob3J0KHZhbHVlKSB7XG4gICAgICAgIHRoaXMudmFsaWRhdGVCdWZmZXIoMiAvKiBTSVpFX09GX1VJTlQxNiAqLyk7XG4gICAgICAgIHRoaXMuZGF0YS5zZXRVaW50MTYodGhpcy5fcG9zaXRpb24sIHZhbHVlLCB0aGlzLiRlbmRpYW4gPT0gMCAvKiBMSVRUTEVfRU5ESUFOICovKTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiArPSAyIC8qIFNJWkVfT0ZfVUlOVDE2ICovO1xuICAgIH1cbiAgICB3cml0ZVVURih2YWx1ZSkge1xuICAgICAgICBsZXQgdXRmOGJ5dGVzID0gdGhpcy5lbmNvZGVVVEY4KHZhbHVlKTtcbiAgICAgICAgbGV0IGxlbmd0aCA9IHV0ZjhieXRlcy5sZW5ndGg7XG4gICAgICAgIHRoaXMudmFsaWRhdGVCdWZmZXIoMiAvKiBTSVpFX09GX1VJTlQxNiAqLyArIGxlbmd0aCk7XG4gICAgICAgIHRoaXMuZGF0YS5zZXRVaW50MTYodGhpcy5fcG9zaXRpb24sIGxlbmd0aCwgdGhpcy4kZW5kaWFuID09IDAgLyogTElUVExFX0VORElBTiAqLyk7XG4gICAgICAgIHRoaXMucG9zaXRpb24gKz0gMiAvKiBTSVpFX09GX1VJTlQxNiAqLztcbiAgICAgICAgdGhpcy5fd3JpdGVVaW50OEFycmF5KHV0ZjhieXRlcywgZmFsc2UpO1xuICAgIH1cbiAgICB3cml0ZVVURkJ5dGVzKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3dyaXRlVWludDhBcnJheSh0aGlzLmVuY29kZVVURjgodmFsdWUpKTtcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiBcIltCeXRlQXJyYXldIGxlbmd0aDpcIiArIHRoaXMubGVuZ3RoICsgXCIsIGJ5dGVzQXZhaWxhYmxlOlwiICsgdGhpcy5ieXRlc0F2YWlsYWJsZTtcbiAgICB9XG4gICAgX3dyaXRlVWludDhBcnJheShieXRlcywgdmFsaWRhdGVCdWZmZXIgPSB0cnVlKSB7XG4gICAgICAgIGxldCBwb3MgPSB0aGlzLl9wb3NpdGlvbjtcbiAgICAgICAgbGV0IG5wb3MgPSBwb3MgKyBieXRlcy5sZW5ndGg7XG4gICAgICAgIGlmICh2YWxpZGF0ZUJ1ZmZlcikge1xuICAgICAgICAgICAgdGhpcy52YWxpZGF0ZUJ1ZmZlcihucG9zKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmJ5dGVzLnNldChieXRlcywgcG9zKTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IG5wb3M7XG4gICAgfVxuICAgIHZhbGlkYXRlKGxlbikge1xuICAgICAgICBsZXQgYmwgPSB0aGlzLl9ieXRlcy5sZW5ndGg7XG4gICAgICAgIGlmIChibCA+IDAgJiYgdGhpcy5fcG9zaXRpb24gKyBsZW4gPD0gYmwpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qICBQUklWQVRFIE1FVEhPRFMgICAqL1xuICAgIHZhbGlkYXRlQnVmZmVyKGxlbikge1xuICAgICAgICB0aGlzLndyaXRlX3Bvc2l0aW9uID0gbGVuID4gdGhpcy53cml0ZV9wb3NpdGlvbiA/IGxlbiA6IHRoaXMud3JpdGVfcG9zaXRpb247XG4gICAgICAgIGxlbiArPSB0aGlzLl9wb3NpdGlvbjtcbiAgICAgICAgdGhpcy5fdmFsaWRhdGVCdWZmZXIobGVuKTtcbiAgICB9XG4gICAgZW5jb2RlVVRGOChzdHIpIHtcbiAgICAgICAgbGV0IHBvcyA9IDA7XG4gICAgICAgIGxldCBjb2RlUG9pbnRzID0gdGhpcy5zdHJpbmdUb0NvZGVQb2ludHMoc3RyKTtcbiAgICAgICAgbGV0IG91dHB1dEJ5dGVzID0gW107XG4gICAgICAgIHdoaWxlIChjb2RlUG9pbnRzLmxlbmd0aCA+IHBvcykge1xuICAgICAgICAgICAgbGV0IGNvZGVfcG9pbnQgPSBjb2RlUG9pbnRzW3BvcysrXTtcbiAgICAgICAgICAgIGlmICh0aGlzLmluUmFuZ2UoY29kZV9wb2ludCwgMHhEODAwLCAweERGRkYpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbmNvZGVyRXJyb3IoY29kZV9wb2ludCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLmluUmFuZ2UoY29kZV9wb2ludCwgMHgwMDAwLCAweDAwN2YpKSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0Qnl0ZXMucHVzaChjb2RlX3BvaW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxldCBjb3VudCwgb2Zmc2V0O1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmluUmFuZ2UoY29kZV9wb2ludCwgMHgwMDgwLCAweDA3RkYpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvdW50ID0gMTtcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gMHhDMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5pblJhbmdlKGNvZGVfcG9pbnQsIDB4MDgwMCwgMHhGRkZGKSkge1xuICAgICAgICAgICAgICAgICAgICBjb3VudCA9IDI7XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IDB4RTA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuaW5SYW5nZShjb2RlX3BvaW50LCAweDEwMDAwLCAweDEwRkZGRikpIHtcbiAgICAgICAgICAgICAgICAgICAgY291bnQgPSAzO1xuICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSAweEYwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBvdXRwdXRCeXRlcy5wdXNoKHRoaXMuZGl2KGNvZGVfcG9pbnQsIE1hdGgucG93KDY0LCBjb3VudCkpICsgb2Zmc2V0KTtcbiAgICAgICAgICAgICAgICB3aGlsZSAoY291bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wID0gdGhpcy5kaXYoY29kZV9wb2ludCwgTWF0aC5wb3coNjQsIGNvdW50IC0gMSkpO1xuICAgICAgICAgICAgICAgICAgICBvdXRwdXRCeXRlcy5wdXNoKDB4ODAgKyAodGVtcCAlIDY0KSk7XG4gICAgICAgICAgICAgICAgICAgIGNvdW50IC09IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShvdXRwdXRCeXRlcyk7XG4gICAgfVxuICAgIGRlY29kZVVURjgoZGF0YSkge1xuICAgICAgICBsZXQgZmF0YWwgPSBmYWxzZTtcbiAgICAgICAgbGV0IHBvcyA9IDA7XG4gICAgICAgIGxldCByZXN1bHQgPSBcIlwiO1xuICAgICAgICBsZXQgY29kZV9wb2ludDtcbiAgICAgICAgbGV0IHV0ZjhfY29kZV9wb2ludCA9IDA7XG4gICAgICAgIGxldCB1dGY4X2J5dGVzX25lZWRlZCA9IDA7XG4gICAgICAgIGxldCB1dGY4X2J5dGVzX3NlZW4gPSAwO1xuICAgICAgICBsZXQgdXRmOF9sb3dlcl9ib3VuZGFyeSA9IDA7XG4gICAgICAgIHdoaWxlIChkYXRhLmxlbmd0aCA+IHBvcykge1xuICAgICAgICAgICAgbGV0IF9ieXRlID0gZGF0YVtwb3MrK107XG4gICAgICAgICAgICBpZiAoX2J5dGUgPT0gdGhpcy5FT0ZfYnl0ZSkge1xuICAgICAgICAgICAgICAgIGlmICh1dGY4X2J5dGVzX25lZWRlZCAhPSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvZGVfcG9pbnQgPSB0aGlzLmRlY29kZXJFcnJvcihmYXRhbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb2RlX3BvaW50ID0gdGhpcy5FT0ZfY29kZV9wb2ludDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodXRmOF9ieXRlc19uZWVkZWQgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pblJhbmdlKF9ieXRlLCAweDAwLCAweDdGKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29kZV9wb2ludCA9IF9ieXRlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5SYW5nZShfYnl0ZSwgMHhDMiwgMHhERikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4X2J5dGVzX25lZWRlZCA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmOF9sb3dlcl9ib3VuZGFyeSA9IDB4ODA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmOF9jb2RlX3BvaW50ID0gX2J5dGUgLSAweEMwO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5pblJhbmdlKF9ieXRlLCAweEUwLCAweEVGKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhfYnl0ZXNfbmVlZGVkID0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4X2xvd2VyX2JvdW5kYXJ5ID0gMHg4MDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmOF9jb2RlX3BvaW50ID0gX2J5dGUgLSAweEUwO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5pblJhbmdlKF9ieXRlLCAweEYwLCAweEY0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhfYnl0ZXNfbmVlZGVkID0gMztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4X2xvd2VyX2JvdW5kYXJ5ID0gMHgxMDAwMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4X2NvZGVfcG9pbnQgPSBfYnl0ZSAtIDB4RjA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlY29kZXJFcnJvcihmYXRhbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB1dGY4X2NvZGVfcG9pbnQgPSB1dGY4X2NvZGVfcG9pbnQgKiBNYXRoLnBvdyg2NCwgdXRmOF9ieXRlc19uZWVkZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29kZV9wb2ludCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoIXRoaXMuaW5SYW5nZShfYnl0ZSwgMHg4MCwgMHhCRikpIHtcbiAgICAgICAgICAgICAgICAgICAgdXRmOF9jb2RlX3BvaW50ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdXRmOF9ieXRlc19uZWVkZWQgPSAwO1xuICAgICAgICAgICAgICAgICAgICB1dGY4X2J5dGVzX3NlZW4gPSAwO1xuICAgICAgICAgICAgICAgICAgICB1dGY4X2xvd2VyX2JvdW5kYXJ5ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgcG9zLS07XG4gICAgICAgICAgICAgICAgICAgIGNvZGVfcG9pbnQgPSB0aGlzLmRlY29kZXJFcnJvcihmYXRhbCwgX2J5dGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdXRmOF9ieXRlc19zZWVuICs9IDE7XG4gICAgICAgICAgICAgICAgICAgIHV0ZjhfY29kZV9wb2ludCA9IHV0ZjhfY29kZV9wb2ludCArIChfYnl0ZSAtIDB4ODApICogTWF0aC5wb3coNjQsIHV0ZjhfYnl0ZXNfbmVlZGVkIC0gdXRmOF9ieXRlc19zZWVuKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHV0ZjhfYnl0ZXNfc2VlbiAhPT0gdXRmOF9ieXRlc19uZWVkZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVfcG9pbnQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNwID0gdXRmOF9jb2RlX3BvaW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGxvd2VyX2JvdW5kYXJ5ID0gdXRmOF9sb3dlcl9ib3VuZGFyeTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhfY29kZV9wb2ludCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB1dGY4X2J5dGVzX25lZWRlZCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB1dGY4X2J5dGVzX3NlZW4gPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXRmOF9sb3dlcl9ib3VuZGFyeSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pblJhbmdlKGNwLCBsb3dlcl9ib3VuZGFyeSwgMHgxMEZGRkYpICYmICF0aGlzLmluUmFuZ2UoY3AsIDB4RDgwMCwgMHhERkZGKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVfcG9pbnQgPSBjcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVfcG9pbnQgPSB0aGlzLmRlY29kZXJFcnJvcihmYXRhbCwgX2J5dGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9EZWNvZGUgc3RyaW5nXG4gICAgICAgICAgICBpZiAoY29kZV9wb2ludCAhPT0gbnVsbCAmJiBjb2RlX3BvaW50ICE9PSB0aGlzLkVPRl9jb2RlX3BvaW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvZGVfcG9pbnQgPD0gMHhGRkZGKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2RlX3BvaW50ID4gMClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGVfcG9pbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29kZV9wb2ludCAtPSAweDEwMDAwO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgweEQ4MDAgKyAoKGNvZGVfcG9pbnQgPj4gMTApICYgMHgzZmYpKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoMHhEQzAwICsgKGNvZGVfcG9pbnQgJiAweDNmZikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBlbmNvZGVyRXJyb3IoY29kZV9wb2ludCkge1xuICAgICAgICAvLyBlZ3JldC4kZXJyb3IoMTAyNiwgY29kZV9wb2ludCk7XG4gICAgfVxuICAgIGRlY29kZXJFcnJvcihmYXRhbCwgb3B0X2NvZGVfcG9pbnQpIHtcbiAgICAgICAgcmV0dXJuIG9wdF9jb2RlX3BvaW50IHx8IDB4RkZGRDtcbiAgICB9XG4gICAgaW5SYW5nZShhLCBtaW4sIG1heCkge1xuICAgICAgICByZXR1cm4gbWluIDw9IGEgJiYgYSA8PSBtYXg7XG4gICAgfVxuICAgIGRpdihuLCBkKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKG4gLyBkKTtcbiAgICB9XG4gICAgc3RyaW5nVG9Db2RlUG9pbnRzKHN0cmluZykge1xuICAgICAgICBsZXQgY3BzID0gW107XG4gICAgICAgIC8vIEJhc2VkIG9uIGh0dHA6Ly93d3cudzMub3JnL1RSL1dlYklETC8jaWRsLURPTVN0cmluZ1xuICAgICAgICBsZXQgaSA9IDAsIG4gPSBzdHJpbmcubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoaSA8IHN0cmluZy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGxldCBjID0gc3RyaW5nLmNoYXJDb2RlQXQoaSk7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaW5SYW5nZShjLCAweEQ4MDAsIDB4REZGRikpIHtcbiAgICAgICAgICAgICAgICBjcHMucHVzaChjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuaW5SYW5nZShjLCAweERDMDAsIDB4REZGRikpIHtcbiAgICAgICAgICAgICAgICBjcHMucHVzaCgweEZGRkQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7IC8vIChpblJhbmdlKGMsIDB4RDgwMCwgMHhEQkZGKSlcbiAgICAgICAgICAgICAgICBpZiAoaSA9PSBuIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICBjcHMucHVzaCgweEZGRkQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGQgPSBzdHJpbmcuY2hhckNvZGVBdChpICsgMSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmluUmFuZ2UoZCwgMHhEQzAwLCAweERGRkYpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgYSA9IGMgJiAweDNGRjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBiID0gZCAmIDB4M0ZGO1xuICAgICAgICAgICAgICAgICAgICAgICAgaSArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3BzLnB1c2goMHgxMDAwMCArIChhIDw8IDEwKSArIGIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3BzLnB1c2goMHhGRkZEKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGkgKz0gMTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY3BzO1xuICAgIH1cbn1cblxuY2xhc3MgUmF3Qnl0ZSB7XG4gICAgc3RhdGljIGluUmFuZ2UoYSwgbWluLCBtYXgpIHtcbiAgICAgICAgcmV0dXJuIG1pbiA8PSBhICYmIGEgPD0gbWF4O1xuICAgIH1cbiAgICBzdGF0aWMgZGVjb2RlVVRGOChkYXRhKSB7XG4gICAgICAgIGxldCBwb3MgPSAwO1xuICAgICAgICBsZXQgcmVzdWx0ID0gXCJcIjtcbiAgICAgICAgbGV0IGNvZGVfcG9pbnQ7XG4gICAgICAgIGxldCB1dGY4X2NvZGVfcG9pbnQgPSAwO1xuICAgICAgICBsZXQgdXRmOF9ieXRlc19uZWVkZWQgPSAwO1xuICAgICAgICBsZXQgdXRmOF9ieXRlc19zZWVuID0gMDtcbiAgICAgICAgbGV0IHV0ZjhfbG93ZXJfYm91bmRhcnkgPSAwO1xuICAgICAgICB3aGlsZSAoZGF0YS5sZW5ndGggPiBwb3MpIHtcbiAgICAgICAgICAgIGxldCBfYnl0ZSA9IGRhdGFbcG9zKytdO1xuICAgICAgICAgICAgaWYgKF9ieXRlID09IC0xIC8qIEVPRl9ieXRlICovKSB7XG4gICAgICAgICAgICAgICAgaWYgKHV0ZjhfYnl0ZXNfbmVlZGVkICE9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29kZV9wb2ludCA9IDY1NTMzIC8qIEZhdGFsX2NvZGVfcG9pbnQgKi87XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb2RlX3BvaW50ID0gLTEgLyogRU9GX2NvZGVfcG9pbnQgKi87XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHV0ZjhfYnl0ZXNfbmVlZGVkID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFJhd0J5dGUuaW5SYW5nZShfYnl0ZSwgMHgwMCwgMHg3RikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVfcG9pbnQgPSBfYnl0ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChSYXdCeXRlLmluUmFuZ2UoX2J5dGUsIDB4QzIsIDB4REYpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmOF9ieXRlc19uZWVkZWQgPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhfbG93ZXJfYm91bmRhcnkgPSAweDgwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhfY29kZV9wb2ludCA9IF9ieXRlIC0gMHhDMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKFJhd0J5dGUuaW5SYW5nZShfYnl0ZSwgMHhFMCwgMHhFRikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4X2J5dGVzX25lZWRlZCA9IDI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmOF9sb3dlcl9ib3VuZGFyeSA9IDB4ODAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhfY29kZV9wb2ludCA9IF9ieXRlIC0gMHhFMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKFJhd0J5dGUuaW5SYW5nZShfYnl0ZSwgMHhGMCwgMHhGNCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4X2J5dGVzX25lZWRlZCA9IDM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmOF9sb3dlcl9ib3VuZGFyeSA9IDB4MTAwMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmOF9jb2RlX3BvaW50ID0gX2J5dGUgLSAweEYwO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZmFpbGVkIHRvIGRlY29kZSB0aGUgcmF3IGJpbmFyeSBkYXRhXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdXRmOF9jb2RlX3BvaW50ID0gdXRmOF9jb2RlX3BvaW50ICogTWF0aC5wb3coNjQsIHV0ZjhfYnl0ZXNfbmVlZGVkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVfcG9pbnQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFSYXdCeXRlLmluUmFuZ2UoX2J5dGUsIDB4ODAsIDB4QkYpKSB7XG4gICAgICAgICAgICAgICAgICAgIHV0ZjhfY29kZV9wb2ludCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHV0ZjhfYnl0ZXNfbmVlZGVkID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdXRmOF9ieXRlc19zZWVuID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdXRmOF9sb3dlcl9ib3VuZGFyeSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHBvcy0tO1xuICAgICAgICAgICAgICAgICAgICBjb2RlX3BvaW50ID0gNjU1MzMgLyogRmF0YWxfY29kZV9wb2ludCAqLztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHV0ZjhfYnl0ZXNfc2VlbiArPSAxO1xuICAgICAgICAgICAgICAgICAgICB1dGY4X2NvZGVfcG9pbnQgPSB1dGY4X2NvZGVfcG9pbnQgKyAoX2J5dGUgLSAweDgwKSAqIE1hdGgucG93KDY0LCB1dGY4X2J5dGVzX25lZWRlZCAtIHV0ZjhfYnl0ZXNfc2Vlbik7XG4gICAgICAgICAgICAgICAgICAgIGlmICh1dGY4X2J5dGVzX3NlZW4gIT09IHV0ZjhfYnl0ZXNfbmVlZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlX3BvaW50ID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjcCA9IHV0ZjhfY29kZV9wb2ludDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBsb3dlcl9ib3VuZGFyeSA9IHV0ZjhfbG93ZXJfYm91bmRhcnk7XG4gICAgICAgICAgICAgICAgICAgICAgICB1dGY4X2NvZGVfcG9pbnQgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXRmOF9ieXRlc19uZWVkZWQgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXRmOF9ieXRlc19zZWVuID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhfbG93ZXJfYm91bmRhcnkgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFJhd0J5dGUuaW5SYW5nZShjcCwgbG93ZXJfYm91bmRhcnksIDB4MTBGRkZGKSAmJiAhdGhpcy5pblJhbmdlKGNwLCAweEQ4MDAsIDB4REZGRikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlX3BvaW50ID0gY3A7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlX3BvaW50ID0gX2J5dGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL0RlY29kZSBzdHJpbmdcbiAgICAgICAgICAgIGlmIChjb2RlX3BvaW50ICE9PSBudWxsICYmIGNvZGVfcG9pbnQgIT09IC0xIC8qIEVPRl9jb2RlX3BvaW50ICovKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvZGVfcG9pbnQgPD0gMHhGRkZGKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2RlX3BvaW50ID4gMClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGVfcG9pbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29kZV9wb2ludCAtPSAweDEwMDAwO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgweEQ4MDAgKyAoKGNvZGVfcG9pbnQgPj4gMTApICYgMHgzZmYpKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoMHhEQzAwICsgKGNvZGVfcG9pbnQgJiAweDNmZikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbn1cblxudmFyIEJ1ZmZlclR5cGU7XG4oZnVuY3Rpb24gKEJ1ZmZlclR5cGUpIHtcbiAgICBCdWZmZXJUeXBlW0J1ZmZlclR5cGVbXCJCTE9DS1wiXSA9IDBdID0gXCJCTE9DS1wiO1xuICAgIEJ1ZmZlclR5cGVbQnVmZmVyVHlwZVtcIkFEQVBUSVZFXCJdID0gMV0gPSBcIkFEQVBUSVZFXCI7XG59KShCdWZmZXJUeXBlIHx8IChCdWZmZXJUeXBlID0ge30pKTtcbi8qKiBAZGVmaW5lIHtudW1iZXJ9IGJ1ZmZlciBibG9jayBzaXplLiAqL1xuY29uc3QgWkxJQl9SQVdfSU5GTEFURV9CVUZGRVJfU0laRSA9IDB4ODAwMDsgLy8gWyAweDgwMDAgPj0gWkxJQl9CVUZGRVJfQkxPQ0tfU0laRSBdXG5jb25zdCBNYXhCYWNrd2FyZExlbmd0aCA9IDMyNzY4O1xuY29uc3QgTWF4Q29weUxlbmd0aCA9IDI1ODtcbmNvbnN0IE9yZGVyID0gbmV3IFVpbnQxNkFycmF5KFsxNiwgMTcsIDE4LCAwLCA4LCA3LCA5LCA2LCAxMCwgNSwgMTEsIDQsIDEyLCAzLCAxMywgMiwgMTQsIDEsIDE1XSk7XG5jb25zdCBMZW5ndGhDb2RlVGFibGUgPSBuZXcgVWludDE2QXJyYXkoW1xuICAgIDB4MDAwMywgMHgwMDA0LCAweDAwMDUsIDB4MDAwNiwgMHgwMDA3LCAweDAwMDgsIDB4MDAwOSwgMHgwMDBhLCAweDAwMGIsXG4gICAgMHgwMDBkLCAweDAwMGYsIDB4MDAxMSwgMHgwMDEzLCAweDAwMTcsIDB4MDAxYiwgMHgwMDFmLCAweDAwMjMsIDB4MDAyYixcbiAgICAweDAwMzMsIDB4MDAzYiwgMHgwMDQzLCAweDAwNTMsIDB4MDA2MywgMHgwMDczLCAweDAwODMsIDB4MDBhMywgMHgwMGMzLFxuICAgIDB4MDBlMywgMHgwMTAyLCAweDAxMDIsIDB4MDEwMlxuXSk7XG5jb25zdCBMZW5ndGhFeHRyYVRhYmxlID0gbmV3IFVpbnQ4QXJyYXkoW1xuICAgIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDEsIDEsIDEsIDEsIDIsIDIsIDIsIDIsIDMsIDMsIDMsIDMsIDQsIDQsIDQsIDQsIDUsIDUsXG4gICAgNSwgNSwgMCwgMCwgMFxuXSk7XG5jb25zdCBEaXN0Q29kZVRhYmxlID0gbmV3IFVpbnQxNkFycmF5KFtcbiAgICAweDAwMDEsIDB4MDAwMiwgMHgwMDAzLCAweDAwMDQsIDB4MDAwNSwgMHgwMDA3LCAweDAwMDksIDB4MDAwZCwgMHgwMDExLFxuICAgIDB4MDAxOSwgMHgwMDIxLCAweDAwMzEsIDB4MDA0MSwgMHgwMDYxLCAweDAwODEsIDB4MDBjMSwgMHgwMTAxLCAweDAxODEsXG4gICAgMHgwMjAxLCAweDAzMDEsIDB4MDQwMSwgMHgwNjAxLCAweDA4MDEsIDB4MGMwMSwgMHgxMDAxLCAweDE4MDEsIDB4MjAwMSxcbiAgICAweDMwMDEsIDB4NDAwMSwgMHg2MDAxXG5dKTtcbmNvbnN0IERpc3RFeHRyYVRhYmxlID0gbmV3IFVpbnQ4QXJyYXkoW1xuICAgIDAsIDAsIDAsIDAsIDEsIDEsIDIsIDIsIDMsIDMsIDQsIDQsIDUsIDUsIDYsIDYsIDcsIDcsIDgsIDgsIDksIDksIDEwLCAxMCwgMTEsXG4gICAgMTEsIDEyLCAxMiwgMTMsIDEzXG5dKTtcbmNvbnN0IGJ1aWxkSHVmZm1hblRhYmxlID0gKGxlbmd0aHMpID0+IHtcbiAgICAvKiogQHR5cGUge251bWJlcn0gbGVuZ3RoIGxpc3Qgc2l6ZS4gKi9cbiAgICB2YXIgbGlzdFNpemUgPSBsZW5ndGhzLmxlbmd0aDtcbiAgICAvKiogQHR5cGUge251bWJlcn0gbWF4IGNvZGUgbGVuZ3RoIGZvciB0YWJsZSBzaXplLiAqL1xuICAgIHZhciBtYXhDb2RlTGVuZ3RoID0gMDtcbiAgICAvKiogQHR5cGUge251bWJlcn0gbWluIGNvZGUgbGVuZ3RoIGZvciB0YWJsZSBzaXplLiAqL1xuICAgIHZhciBtaW5Db2RlTGVuZ3RoID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZO1xuICAgIC8qKiBAdHlwZSB7bnVtYmVyfSB0YWJsZSBzaXplLiAqL1xuICAgIHZhciBzaXplO1xuICAgIC8qKiBAdHlwZSB7IShBcnJheXxVaW50OEFycmF5KX0gaHVmZm1hbiBjb2RlIHRhYmxlLiAqL1xuICAgIHZhciB0YWJsZTtcbiAgICAvKiogQHR5cGUge251bWJlcn0gYml0IGxlbmd0aC4gKi9cbiAgICB2YXIgYml0TGVuZ3RoO1xuICAgIC8qKiBAdHlwZSB7bnVtYmVyfSBodWZmbWFuIGNvZGUuICovXG4gICAgdmFyIGNvZGU7XG4gICAgLyoqXG4gICAgICog44K144Kk44K644GMIDJebWF4bGVuZ3RoIOWAi+OBruODhuODvOODluODq+OCkuWfi+OCgeOCi+OBn+OCgeOBruOCueOCreODg+ODl+mVty5cbiAgICAgKiBAdHlwZSB7bnVtYmVyfSBza2lwIGxlbmd0aCBmb3IgdGFibGUgZmlsbGluZy5cbiAgICAgKi9cbiAgICB2YXIgc2tpcDtcbiAgICAvKiogQHR5cGUge251bWJlcn0gcmV2ZXJzZWQgY29kZS4gKi9cbiAgICB2YXIgcmV2ZXJzZWQ7XG4gICAgLyoqIEB0eXBlIHtudW1iZXJ9IHJldmVyc2UgdGVtcC4gKi9cbiAgICB2YXIgcnRlbXA7XG4gICAgLyoqIEB0eXBlIHtudW1iZXJ9IGxvb3AgY291bnRlci4gKi9cbiAgICB2YXIgaTtcbiAgICAvKiogQHR5cGUge251bWJlcn0gbG9vcCBsaW1pdC4gKi9cbiAgICB2YXIgaWw7XG4gICAgLyoqIEB0eXBlIHtudW1iZXJ9IGxvb3AgY291bnRlci4gKi9cbiAgICB2YXIgajtcbiAgICAvKiogQHR5cGUge251bWJlcn0gdGFibGUgdmFsdWUuICovXG4gICAgdmFyIHZhbHVlO1xuICAgIC8vIE1hdGgubWF4IOOBr+mBheOBhOOBruOBp+acgOmVt+OBruWApOOBryBmb3ItbG9vcCDjgaflj5blvpfjgZnjgotcbiAgICBmb3IgKGkgPSAwLCBpbCA9IGxpc3RTaXplOyBpIDwgaWw7ICsraSkge1xuICAgICAgICBpZiAobGVuZ3Roc1tpXSA+IG1heENvZGVMZW5ndGgpIHtcbiAgICAgICAgICAgIG1heENvZGVMZW5ndGggPSBsZW5ndGhzW2ldO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsZW5ndGhzW2ldIDwgbWluQ29kZUxlbmd0aCkge1xuICAgICAgICAgICAgbWluQ29kZUxlbmd0aCA9IGxlbmd0aHNbaV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2l6ZSA9IDEgPDwgbWF4Q29kZUxlbmd0aDtcbiAgICB0YWJsZSA9IG5ldyBVaW50MzJBcnJheShzaXplKTtcbiAgICAvLyDjg5Pjg4Pjg4jplbfjga7nn63jgYTpoIbjgYvjgonjg4/jg5Xjg57jg7PnrKblj7fjgpLlibLjgorlvZPjgabjgotcbiAgICBmb3IgKGJpdExlbmd0aCA9IDEsIGNvZGUgPSAwLCBza2lwID0gMjsgYml0TGVuZ3RoIDw9IG1heENvZGVMZW5ndGg7KSB7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBsaXN0U2l6ZTsgKytpKSB7XG4gICAgICAgICAgICBpZiAobGVuZ3Roc1tpXSA9PT0gYml0TGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgLy8g44OT44OD44OI44Kq44O844OA44O844GM6YCG44Gr44Gq44KL44Gf44KB44OT44OD44OI6ZW35YiG5Lim44Gz44KS5Y+N6Lui44GZ44KLXG4gICAgICAgICAgICAgICAgZm9yIChyZXZlcnNlZCA9IDAsIHJ0ZW1wID0gY29kZSwgaiA9IDA7IGogPCBiaXRMZW5ndGg7ICsraikge1xuICAgICAgICAgICAgICAgICAgICByZXZlcnNlZCA9IChyZXZlcnNlZCA8PCAxKSB8IChydGVtcCAmIDEpO1xuICAgICAgICAgICAgICAgICAgICBydGVtcCA+Pj0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8g5pyA5aSn44OT44OD44OI6ZW344KS44KC44Go44Gr44OG44O844OW44Or44KS5L2c44KL44Gf44KB44CBXG4gICAgICAgICAgICAgICAgLy8g5pyA5aSn44OT44OD44OI6ZW35Lul5aSW44Gn44GvIDAgLyAxIOOBqeOBoeOCieOBp+OCguiJr+OBhOeuh+aJgOOBjOOBp+OBjeOCi1xuICAgICAgICAgICAgICAgIC8vIOOBneOBruOBqeOBoeOCieOBp+OCguiJr+OBhOWgtOaJgOOBr+WQjOOBmOWApOOBp+Wfi+OCgeOCi+OBk+OBqOOBp1xuICAgICAgICAgICAgICAgIC8vIOacrOadpeOBruODk+ODg+ODiOmVt+S7peS4iuOBruODk+ODg+ODiOaVsOWPluW+l+OBl+OBpuOCguWVj+mhjOOBjOi1t+OBk+OCieOBquOBhOOCiOOBhuOBq+OBmeOCi1xuICAgICAgICAgICAgICAgIHZhbHVlID0gKGJpdExlbmd0aCA8PCAxNikgfCBpO1xuICAgICAgICAgICAgICAgIGZvciAoaiA9IHJldmVyc2VkOyBqIDwgc2l6ZTsgaiArPSBza2lwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYmxlW2pdID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICsrY29kZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyDmrKHjga7jg5Pjg4Pjg4jplbfjgbhcbiAgICAgICAgKytiaXRMZW5ndGg7XG4gICAgICAgIGNvZGUgPDw9IDE7XG4gICAgICAgIHNraXAgPDw9IDE7XG4gICAgfVxuICAgIHJldHVybiBbdGFibGUsIG1heENvZGVMZW5ndGgsIG1pbkNvZGVMZW5ndGhdO1xufTtcbmNvbnN0IEZpeGVkTGl0ZXJhbExlbmd0aFRhYmxlID0gKCgpID0+IHtcbiAgICBsZXQgbGVuZ3RocyA9IG5ldyBVaW50OEFycmF5KDI4OCk7XG4gICAgZm9yIChsZXQgaSA9IDAsIGlsID0gbGVuZ3Rocy5sZW5ndGg7IGkgPCBpbDsgKytpKSB7XG4gICAgICAgIGxlbmd0aHNbaV0gPVxuICAgICAgICAgICAgKGkgPD0gMTQzKSA/IDggOlxuICAgICAgICAgICAgICAgIChpIDw9IDI1NSkgPyA5IDpcbiAgICAgICAgICAgICAgICAgICAgKGkgPD0gMjc5KSA/IDcgOlxuICAgICAgICAgICAgICAgICAgICAgICAgODtcbiAgICB9XG4gICAgcmV0dXJuIGJ1aWxkSHVmZm1hblRhYmxlKGxlbmd0aHMpWzBdO1xufSkoKTtcbmNvbnN0IEZpeGVkRGlzdGFuY2VUYWJsZSA9ICgoKSA9PiB7XG4gICAgbGV0IGxlbmd0aHMgPSBuZXcgVWludDhBcnJheSgzMCk7XG4gICAgZm9yIChsZXQgaSA9IDAsIGlsID0gbGVuZ3Rocy5sZW5ndGg7IGkgPCBpbDsgKytpKSB7XG4gICAgICAgIGxlbmd0aHNbaV0gPSA1O1xuICAgIH1cbiAgICByZXR1cm4gYnVpbGRIdWZmbWFuVGFibGUobGVuZ3Rocyk7XG59KSgpO1xuY2xhc3MgUmF3SW5mbGF0ZSB7XG4gICAgY29uc3RydWN0b3IoaW5wdXQsIG9wdF9wYXJhbXMpIHtcbiAgICAgICAgdGhpcy5ibG9ja3MgPSBbXTtcbiAgICAgICAgdGhpcy5idWZmZXJTaXplID0gWkxJQl9SQVdfSU5GTEFURV9CVUZGRVJfU0laRTtcbiAgICAgICAgdGhpcy50b3RhbHBvcyA9IDA7XG4gICAgICAgIHRoaXMuaXAgPSAwO1xuICAgICAgICB0aGlzLmJpdHNidWYgPSAwO1xuICAgICAgICB0aGlzLmJpdHNidWZsZW4gPSAwO1xuICAgICAgICB0aGlzLmlucHV0ID0gbmV3IFVpbnQ4QXJyYXkoaW5wdXQpO1xuICAgICAgICB0aGlzLmJmaW5hbCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmJ1ZmZlclR5cGUgPSBCdWZmZXJUeXBlLkFEQVBUSVZFO1xuICAgICAgICB0aGlzLnJlc2l6ZSA9IGZhbHNlO1xuICAgICAgICAvLyBvcHRpb24gcGFyYW1ldGVyc1xuICAgICAgICBpZiAob3B0X3BhcmFtcykge1xuICAgICAgICAgICAgaWYgKG9wdF9wYXJhbXNbJ2luZGV4J10pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlwID0gb3B0X3BhcmFtc1snaW5kZXgnXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvcHRfcGFyYW1zWydidWZmZXJTaXplJ10pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlclNpemUgPSBvcHRfcGFyYW1zWydidWZmZXJTaXplJ107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob3B0X3BhcmFtc1snYnVmZmVyVHlwZSddKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5idWZmZXJUeXBlID0gb3B0X3BhcmFtc1snYnVmZmVyVHlwZSddO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9wdF9wYXJhbXNbJ3Jlc2l6ZSddKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNpemUgPSBvcHRfcGFyYW1zWydyZXNpemUnXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBpbml0aWFsaXplXG4gICAgICAgIHN3aXRjaCAodGhpcy5idWZmZXJUeXBlKSB7XG4gICAgICAgICAgICBjYXNlIEJ1ZmZlclR5cGUuQkxPQ0s6XG4gICAgICAgICAgICAgICAgdGhpcy5vcCA9IE1heEJhY2t3YXJkTGVuZ3RoO1xuICAgICAgICAgICAgICAgIHRoaXMub3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkoTWF4QmFja3dhcmRMZW5ndGggKyB0aGlzLmJ1ZmZlclNpemUgKyBNYXhDb3B5TGVuZ3RoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgQnVmZmVyVHlwZS5BREFQVElWRTpcbiAgICAgICAgICAgICAgICB0aGlzLm9wID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLm91dHB1dCA9IG5ldyBVaW50OEFycmF5KHRoaXMuYnVmZmVyU2l6ZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZCBpbmZsYXRlIG1vZGUnKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBkZWNvbXByZXNzKCkge1xuICAgICAgICB3aGlsZSAoIXRoaXMuYmZpbmFsKSB7XG4gICAgICAgICAgICB0aGlzLnBhcnNlQmxvY2soKTtcbiAgICAgICAgfVxuICAgICAgICBzd2l0Y2ggKHRoaXMuYnVmZmVyVHlwZSkge1xuICAgICAgICAgICAgY2FzZSBCdWZmZXJUeXBlLkJMT0NLOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbmNhdEJ1ZmZlckJsb2NrKCk7XG4gICAgICAgICAgICBjYXNlIEJ1ZmZlclR5cGUuQURBUFRJVkU6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uY2F0QnVmZmVyRHluYW1pYygpO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgaW5mbGF0ZSBtb2RlJyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcGFyc2VCbG9jaygpIHtcbiAgICAgICAgbGV0IGhkciA9IHRoaXMucmVhZEJpdHMoMyk7XG4gICAgICAgIGlmIChoZHIgJiAweDEpIHtcbiAgICAgICAgICAgIHRoaXMuYmZpbmFsID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBoZHIgPj4+PSAxO1xuICAgICAgICBzd2l0Y2ggKGhkcikge1xuICAgICAgICAgICAgLy8gdW5jb21wcmVzc2VkXG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJzZVVuY29tcHJlc3NlZEJsb2NrKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAvLyBmaXhlZCBodWZmbWFuXG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJzZUZpeGVkSHVmZm1hbkJsb2NrKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAvLyBkeW5hbWljIGh1ZmZtYW5cbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICB0aGlzLnBhcnNlRHluYW1pY0h1ZmZtYW5CbG9jaygpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgLy8gcmVzZXJ2ZWQgb3Igb3RoZXJcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCd1bmtub3duIEJUWVBFOiAnICsgaGRyKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICA7XG4gICAgcmVhZEJpdHMobGVuZ3RoKSB7XG4gICAgICAgIGxldCBiaXRzYnVmID0gdGhpcy5iaXRzYnVmO1xuICAgICAgICBsZXQgYml0c2J1ZmxlbiA9IHRoaXMuYml0c2J1ZmxlbjtcbiAgICAgICAgbGV0IGlucHV0ID0gdGhpcy5pbnB1dDtcbiAgICAgICAgbGV0IGlwID0gdGhpcy5pcDtcbiAgICAgICAgbGV0IGlucHV0TGVuZ3RoID0gaW5wdXQubGVuZ3RoO1xuICAgICAgICBsZXQgb2N0ZXQ7XG4gICAgICAgIGlmIChpcCArICgobGVuZ3RoIC0gYml0c2J1ZmxlbiArIDcpID4+IDMpID49IGlucHV0TGVuZ3RoKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2lucHV0IGJ1ZmZlciBpcyBicm9rZW4nKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBub3QgZW5vdWdoIGJ1ZmZlclxuICAgICAgICB3aGlsZSAoYml0c2J1ZmxlbiA8IGxlbmd0aCkge1xuICAgICAgICAgICAgYml0c2J1ZiB8PSBpbnB1dFtpcCsrXSA8PCBiaXRzYnVmbGVuO1xuICAgICAgICAgICAgYml0c2J1ZmxlbiArPSA4O1xuICAgICAgICB9XG4gICAgICAgIC8vIG91dHB1dCBieXRlXG4gICAgICAgIG9jdGV0ID0gYml0c2J1ZiAmIC8qIE1BU0sgKi8gKCgxIDw8IGxlbmd0aCkgLSAxKTtcbiAgICAgICAgYml0c2J1ZiA+Pj49IGxlbmd0aDtcbiAgICAgICAgYml0c2J1ZmxlbiAtPSBsZW5ndGg7XG4gICAgICAgIHRoaXMuYml0c2J1ZiA9IGJpdHNidWY7XG4gICAgICAgIHRoaXMuYml0c2J1ZmxlbiA9IGJpdHNidWZsZW47XG4gICAgICAgIHRoaXMuaXAgPSBpcDtcbiAgICAgICAgcmV0dXJuIG9jdGV0O1xuICAgIH1cbiAgICA7XG4gICAgcmVhZENvZGVCeVRhYmxlKHRhYmxlKSB7XG4gICAgICAgIGxldCBiaXRzYnVmID0gdGhpcy5iaXRzYnVmO1xuICAgICAgICBsZXQgYml0c2J1ZmxlbiA9IHRoaXMuYml0c2J1ZmxlbjtcbiAgICAgICAgbGV0IGlucHV0ID0gdGhpcy5pbnB1dDtcbiAgICAgICAgbGV0IGlwID0gdGhpcy5pcDtcbiAgICAgICAgLyoqIEB0eXBlIHtudW1iZXJ9ICovXG4gICAgICAgIGxldCBpbnB1dExlbmd0aCA9IGlucHV0Lmxlbmd0aDtcbiAgICAgICAgLyoqIEB0eXBlIHshKEFycmF5LjxudW1iZXI+fFVpbnQ4QXJyYXkpfSBodWZmbWFuIGNvZGUgdGFibGUgKi9cbiAgICAgICAgbGV0IGNvZGVUYWJsZSA9IHRhYmxlWzBdO1xuICAgICAgICAvKiogQHR5cGUge251bWJlcn0gKi9cbiAgICAgICAgbGV0IG1heENvZGVMZW5ndGggPSB0YWJsZVsxXTtcbiAgICAgICAgLyoqIEB0eXBlIHtudW1iZXJ9IGNvZGUgbGVuZ3RoICYgY29kZSAoMTZiaXQsIDE2Yml0KSAqL1xuICAgICAgICBsZXQgY29kZVdpdGhMZW5ndGg7XG4gICAgICAgIC8qKiBAdHlwZSB7bnVtYmVyfSBjb2RlIGJpdHMgbGVuZ3RoICovXG4gICAgICAgIGxldCBjb2RlTGVuZ3RoO1xuICAgICAgICAvLyBub3QgZW5vdWdoIGJ1ZmZlclxuICAgICAgICB3aGlsZSAoYml0c2J1ZmxlbiA8IG1heENvZGVMZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChpcCA+PSBpbnB1dExlbmd0aCkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYml0c2J1ZiB8PSBpbnB1dFtpcCsrXSA8PCBiaXRzYnVmbGVuO1xuICAgICAgICAgICAgYml0c2J1ZmxlbiArPSA4O1xuICAgICAgICB9XG4gICAgICAgIC8vIHJlYWQgbWF4IGxlbmd0aFxuICAgICAgICBjb2RlV2l0aExlbmd0aCA9IGNvZGVUYWJsZVtiaXRzYnVmICYgKCgxIDw8IG1heENvZGVMZW5ndGgpIC0gMSldO1xuICAgICAgICBjb2RlTGVuZ3RoID0gY29kZVdpdGhMZW5ndGggPj4+IDE2O1xuICAgICAgICBpZiAoY29kZUxlbmd0aCA+IGJpdHNidWZsZW4pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZCBjb2RlIGxlbmd0aDogJyArIGNvZGVMZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYml0c2J1ZiA9IGJpdHNidWYgPj4gY29kZUxlbmd0aDtcbiAgICAgICAgdGhpcy5iaXRzYnVmbGVuID0gYml0c2J1ZmxlbiAtIGNvZGVMZW5ndGg7XG4gICAgICAgIHRoaXMuaXAgPSBpcDtcbiAgICAgICAgcmV0dXJuIGNvZGVXaXRoTGVuZ3RoICYgMHhmZmZmO1xuICAgIH1cbiAgICA7XG4gICAgcGFyc2VVbmNvbXByZXNzZWRCbG9jaygpIHtcbiAgICAgICAgbGV0IGlucHV0ID0gdGhpcy5pbnB1dDtcbiAgICAgICAgbGV0IGlwID0gdGhpcy5pcDtcbiAgICAgICAgbGV0IG91dHB1dCA9IHRoaXMub3V0cHV0O1xuICAgICAgICBsZXQgb3AgPSB0aGlzLm9wO1xuICAgICAgICAvKiogQHR5cGUge251bWJlcn0gKi9cbiAgICAgICAgbGV0IGlucHV0TGVuZ3RoID0gaW5wdXQubGVuZ3RoO1xuICAgICAgICAvKiogQHR5cGUge251bWJlcn0gYmxvY2sgbGVuZ3RoICovXG4gICAgICAgIGxldCBsZW47XG4gICAgICAgIC8qKiBAdHlwZSB7bnVtYmVyfSBudW1iZXIgZm9yIGNoZWNrIGJsb2NrIGxlbmd0aCAqL1xuICAgICAgICBsZXQgbmxlbjtcbiAgICAgICAgLyoqIEB0eXBlIHtudW1iZXJ9IG91dHB1dCBidWZmZXIgbGVuZ3RoICovXG4gICAgICAgIGxldCBvbGVuZ3RoID0gb3V0cHV0Lmxlbmd0aDtcbiAgICAgICAgLyoqIEB0eXBlIHtudW1iZXJ9IGNvcHkgY291bnRlciAqL1xuICAgICAgICBsZXQgcHJlQ29weTtcbiAgICAgICAgLy8gc2tpcCBidWZmZXJlZCBoZWFkZXIgYml0c1xuICAgICAgICB0aGlzLmJpdHNidWYgPSAwO1xuICAgICAgICB0aGlzLmJpdHNidWZsZW4gPSAwO1xuICAgICAgICAvLyBsZW5cbiAgICAgICAgaWYgKGlwICsgMSA+PSBpbnB1dExlbmd0aCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkIHVuY29tcHJlc3NlZCBibG9jayBoZWFkZXI6IExFTicpO1xuICAgICAgICB9XG4gICAgICAgIGxlbiA9IGlucHV0W2lwKytdIHwgKGlucHV0W2lwKytdIDw8IDgpO1xuICAgICAgICAvLyBubGVuXG4gICAgICAgIGlmIChpcCArIDEgPj0gaW5wdXRMZW5ndGgpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZCB1bmNvbXByZXNzZWQgYmxvY2sgaGVhZGVyOiBOTEVOJyk7XG4gICAgICAgIH1cbiAgICAgICAgbmxlbiA9IGlucHV0W2lwKytdIHwgKGlucHV0W2lwKytdIDw8IDgpO1xuICAgICAgICAvLyBjaGVjayBsZW4gJiBubGVuXG4gICAgICAgIGlmIChsZW4gPT09IH5ubGVuKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgdW5jb21wcmVzc2VkIGJsb2NrIGhlYWRlcjogbGVuZ3RoIHZlcmlmeScpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGNoZWNrIHNpemVcbiAgICAgICAgaWYgKGlwICsgbGVuID4gaW5wdXQubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2lucHV0IGJ1ZmZlciBpcyBicm9rZW4nKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBleHBhbmQgYnVmZmVyXG4gICAgICAgIHN3aXRjaCAodGhpcy5idWZmZXJUeXBlKSB7XG4gICAgICAgICAgICBjYXNlIEJ1ZmZlclR5cGUuQkxPQ0s6XG4gICAgICAgICAgICAgICAgLy8gcHJlIGNvcHlcbiAgICAgICAgICAgICAgICB3aGlsZSAob3AgKyBsZW4gPiBvdXRwdXQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHByZUNvcHkgPSBvbGVuZ3RoIC0gb3A7XG4gICAgICAgICAgICAgICAgICAgIGxlbiAtPSBwcmVDb3B5O1xuICAgICAgICAgICAgICAgICAgICBvdXRwdXQuc2V0KGlucHV0LnN1YmFycmF5KGlwLCBpcCArIHByZUNvcHkpLCBvcCk7XG4gICAgICAgICAgICAgICAgICAgIG9wICs9IHByZUNvcHk7XG4gICAgICAgICAgICAgICAgICAgIGlwICs9IHByZUNvcHk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3AgPSBvcDtcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0ID0gdGhpcy5leHBhbmRCdWZmZXJCbG9jaygpO1xuICAgICAgICAgICAgICAgICAgICBvcCA9IHRoaXMub3A7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBCdWZmZXJUeXBlLkFEQVBUSVZFOlxuICAgICAgICAgICAgICAgIHdoaWxlIChvcCArIGxlbiA+IG91dHB1dC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0ID0gdGhpcy5leHBhbmRCdWZmZXJBZGFwdGl2ZSh7IGZpeFJhdGlvOiAyIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkIGluZmxhdGUgbW9kZScpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGNvcHlcbiAgICAgICAgb3V0cHV0LnNldChpbnB1dC5zdWJhcnJheShpcCwgaXAgKyBsZW4pLCBvcCk7XG4gICAgICAgIG9wICs9IGxlbjtcbiAgICAgICAgaXAgKz0gbGVuO1xuICAgICAgICB0aGlzLmlwID0gaXA7XG4gICAgICAgIHRoaXMub3AgPSBvcDtcbiAgICAgICAgdGhpcy5vdXRwdXQgPSBvdXRwdXQ7XG4gICAgfVxuICAgIDtcbiAgICBwYXJzZUZpeGVkSHVmZm1hbkJsb2NrKCkge1xuICAgICAgICBzd2l0Y2ggKHRoaXMuYnVmZmVyVHlwZSkge1xuICAgICAgICAgICAgY2FzZSBCdWZmZXJUeXBlLkFEQVBUSVZFOlxuICAgICAgICAgICAgICAgIHRoaXMuZGVjb2RlSHVmZm1hbkFkYXB0aXZlKEZpeGVkTGl0ZXJhbExlbmd0aFRhYmxlLCBGaXhlZERpc3RhbmNlVGFibGUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBCdWZmZXJUeXBlLkJMT0NLOlxuICAgICAgICAgICAgICAgIHRoaXMuZGVjb2RlSHVmZm1hbkJsb2NrKEZpeGVkTGl0ZXJhbExlbmd0aFRhYmxlLCBGaXhlZERpc3RhbmNlVGFibGUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgaW5mbGF0ZSBtb2RlJyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcGFyc2VEeW5hbWljSHVmZm1hbkJsb2NrKCkge1xuICAgICAgICAvKiogQHR5cGUge251bWJlcn0gbnVtYmVyIG9mIGxpdGVyYWwgYW5kIGxlbmd0aCBjb2Rlcy4gKi9cbiAgICAgICAgbGV0IGhsaXQgPSB0aGlzLnJlYWRCaXRzKDUpICsgMjU3O1xuICAgICAgICAvKiogQHR5cGUge251bWJlcn0gbnVtYmVyIG9mIGRpc3RhbmNlIGNvZGVzLiAqL1xuICAgICAgICBsZXQgaGRpc3QgPSB0aGlzLnJlYWRCaXRzKDUpICsgMTtcbiAgICAgICAgLyoqIEB0eXBlIHtudW1iZXJ9IG51bWJlciBvZiBjb2RlIGxlbmd0aHMuICovXG4gICAgICAgIGxldCBoY2xlbiA9IHRoaXMucmVhZEJpdHMoNCkgKyA0O1xuICAgICAgICAvKiogQHR5cGUgeyEoVWludDhBcnJheXxBcnJheS48bnVtYmVyPil9IGNvZGUgbGVuZ3Rocy4gKi9cbiAgICAgICAgbGV0IGNvZGVMZW5ndGhzID0gbmV3IFVpbnQ4QXJyYXkoT3JkZXIubGVuZ3RoKTtcbiAgICAgICAgLyoqIEB0eXBlIHshQXJyYXl9IGNvZGUgbGVuZ3RocyB0YWJsZS4gKi9cbiAgICAgICAgbGV0IGNvZGVMZW5ndGhzVGFibGU7XG4gICAgICAgIC8qKiBAdHlwZSB7IShVaW50OEFycmF5fEFycmF5LjxudW1iZXI+KX0gbGl0ZXJhbCBhbmQgbGVuZ3RoIGNvZGUgdGFibGUuICovXG4gICAgICAgIGxldCBsaXRsZW5UYWJsZTtcbiAgICAgICAgLyoqIEB0eXBlIHshKFVpbnQ4QXJyYXl8QXJyYXkuPG51bWJlcj4pfSBkaXN0YW5jZSBjb2RlIHRhYmxlLiAqL1xuICAgICAgICBsZXQgZGlzdFRhYmxlO1xuICAgICAgICAvKiogQHR5cGUge251bWJlcn0gKi9cbiAgICAgICAgbGV0IGNvZGU7XG4gICAgICAgIC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xuICAgICAgICBsZXQgcHJldjtcbiAgICAgICAgLyoqIEB0eXBlIHtudW1iZXJ9ICovXG4gICAgICAgIGxldCByZXBlYXQ7XG4gICAgICAgIC8qKiBAdHlwZSB7bnVtYmVyfSBsb29wIGNvdW50ZXIuICovXG4gICAgICAgIGxldCBpO1xuICAgICAgICAvKiogQHR5cGUge251bWJlcn0gbG9vcCBsaW1pdC4gKi9cbiAgICAgICAgbGV0IGlsO1xuICAgICAgICAvLyBkZWNvZGUgY29kZSBsZW5ndGhzXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBoY2xlbjsgKytpKSB7XG4gICAgICAgICAgICBjb2RlTGVuZ3Roc1tPcmRlcltpXV0gPSB0aGlzLnJlYWRCaXRzKDMpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGRlY29kZSBsZW5ndGggdGFibGVcbiAgICAgICAgY29kZUxlbmd0aHNUYWJsZSA9IGJ1aWxkSHVmZm1hblRhYmxlKGNvZGVMZW5ndGhzKTtcbiAgICAgICAgbGV0IGxlbmd0aFRhYmxlID0gbmV3IFVpbnQ4QXJyYXkoaGxpdCArIGhkaXN0KTtcbiAgICAgICAgZm9yIChpID0gMCwgaWwgPSBobGl0ICsgaGRpc3Q7IGkgPCBpbDspIHtcbiAgICAgICAgICAgIGNvZGUgPSB0aGlzLnJlYWRDb2RlQnlUYWJsZShjb2RlTGVuZ3Roc1RhYmxlKTtcbiAgICAgICAgICAgIHN3aXRjaCAoY29kZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMTY6XG4gICAgICAgICAgICAgICAgICAgIHJlcGVhdCA9IDMgKyB0aGlzLnJlYWRCaXRzKDIpO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAocmVwZWF0LS0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aFRhYmxlW2krK10gPSBwcmV2O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTc6XG4gICAgICAgICAgICAgICAgICAgIHJlcGVhdCA9IDMgKyB0aGlzLnJlYWRCaXRzKDMpO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAocmVwZWF0LS0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aFRhYmxlW2krK10gPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHByZXYgPSAwO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDE4OlxuICAgICAgICAgICAgICAgICAgICByZXBlYXQgPSAxMSArIHRoaXMucmVhZEJpdHMoNyk7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChyZXBlYXQtLSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoVGFibGVbaSsrXSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcHJldiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGxlbmd0aFRhYmxlW2krK10gPSBjb2RlO1xuICAgICAgICAgICAgICAgICAgICBwcmV2ID0gY29kZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGl0bGVuVGFibGUgPSBidWlsZEh1ZmZtYW5UYWJsZShsZW5ndGhUYWJsZS5zdWJhcnJheSgwLCBobGl0KSk7XG4gICAgICAgIGRpc3RUYWJsZSA9IGJ1aWxkSHVmZm1hblRhYmxlKGxlbmd0aFRhYmxlLnN1YmFycmF5KGhsaXQpKTtcbiAgICAgICAgc3dpdGNoICh0aGlzLmJ1ZmZlclR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgQnVmZmVyVHlwZS5BREFQVElWRTpcbiAgICAgICAgICAgICAgICB0aGlzLmRlY29kZUh1ZmZtYW5BZGFwdGl2ZShsaXRsZW5UYWJsZSwgZGlzdFRhYmxlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgQnVmZmVyVHlwZS5CTE9DSzpcbiAgICAgICAgICAgICAgICB0aGlzLmRlY29kZUh1ZmZtYW5CbG9jayhsaXRsZW5UYWJsZSwgZGlzdFRhYmxlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkIGluZmxhdGUgbW9kZScpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGRlY29kZUh1ZmZtYW5CbG9jayhsaXRsZW4sIGRpc3QpIHtcbiAgICAgICAgbGV0IG91dHB1dCA9IHRoaXMub3V0cHV0O1xuICAgICAgICBsZXQgb3AgPSB0aGlzLm9wO1xuICAgICAgICB0aGlzLmN1cnJlbnRMaXRsZW5UYWJsZSA9IGxpdGxlbjtcbiAgICAgICAgLyoqIEB0eXBlIHtudW1iZXJ9IG91dHB1dCBwb3NpdGlvbiBsaW1pdC4gKi9cbiAgICAgICAgbGV0IG9sZW5ndGggPSBvdXRwdXQubGVuZ3RoIC0gTWF4Q29weUxlbmd0aDtcbiAgICAgICAgLyoqIEB0eXBlIHtudW1iZXJ9IGh1ZmZtYW4gY29kZS4gKi9cbiAgICAgICAgbGV0IGNvZGU7XG4gICAgICAgIC8qKiBAdHlwZSB7bnVtYmVyfSB0YWJsZSBpbmRleC4gKi9cbiAgICAgICAgbGV0IHRpO1xuICAgICAgICAvKiogQHR5cGUge251bWJlcn0gaHVmZm1hbiBjb2RlIGRpc3RpbmF0aW9uLiAqL1xuICAgICAgICBsZXQgY29kZURpc3Q7XG4gICAgICAgIC8qKiBAdHlwZSB7bnVtYmVyfSBodWZmbWFuIGNvZGUgbGVuZ3RoLiAqL1xuICAgICAgICBsZXQgY29kZUxlbmd0aDtcbiAgICAgICAgbGV0IGxlbmd0aENvZGVUYWJsZSA9IExlbmd0aENvZGVUYWJsZTtcbiAgICAgICAgbGV0IGxlbmd0aEV4dHJhVGFibGUgPSBMZW5ndGhFeHRyYVRhYmxlO1xuICAgICAgICBsZXQgZGlzdENvZGVUYWJsZSA9IERpc3RDb2RlVGFibGU7XG4gICAgICAgIGxldCBkaXN0RXh0cmFUYWJsZSA9IERpc3RFeHRyYVRhYmxlO1xuICAgICAgICB3aGlsZSAoKGNvZGUgPSB0aGlzLnJlYWRDb2RlQnlUYWJsZShsaXRsZW4pKSAhPT0gMjU2KSB7XG4gICAgICAgICAgICAvLyBsaXRlcmFsXG4gICAgICAgICAgICBpZiAoY29kZSA8IDI1Nikge1xuICAgICAgICAgICAgICAgIGlmIChvcCA+PSBvbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3AgPSBvcDtcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0ID0gdGhpcy5leHBhbmRCdWZmZXJCbG9jaygpO1xuICAgICAgICAgICAgICAgICAgICBvcCA9IHRoaXMub3A7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG91dHB1dFtvcCsrXSA9IGNvZGU7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBsZW5ndGggY29kZVxuICAgICAgICAgICAgdGkgPSBjb2RlIC0gMjU3O1xuICAgICAgICAgICAgY29kZUxlbmd0aCA9IGxlbmd0aENvZGVUYWJsZVt0aV07XG4gICAgICAgICAgICBpZiAobGVuZ3RoRXh0cmFUYWJsZVt0aV0gPiAwKSB7XG4gICAgICAgICAgICAgICAgY29kZUxlbmd0aCArPSB0aGlzLnJlYWRCaXRzKGxlbmd0aEV4dHJhVGFibGVbdGldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGRpc3QgY29kZVxuICAgICAgICAgICAgY29kZSA9IHRoaXMucmVhZENvZGVCeVRhYmxlKGRpc3QpO1xuICAgICAgICAgICAgY29kZURpc3QgPSBkaXN0Q29kZVRhYmxlW2NvZGVdO1xuICAgICAgICAgICAgaWYgKGRpc3RFeHRyYVRhYmxlW2NvZGVdID4gMCkge1xuICAgICAgICAgICAgICAgIGNvZGVEaXN0ICs9IHRoaXMucmVhZEJpdHMoZGlzdEV4dHJhVGFibGVbY29kZV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gbHo3NyBkZWNvZGVcbiAgICAgICAgICAgIGlmIChvcCA+PSBvbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcCA9IG9wO1xuICAgICAgICAgICAgICAgIG91dHB1dCA9IHRoaXMuZXhwYW5kQnVmZmVyQmxvY2soKTtcbiAgICAgICAgICAgICAgICBvcCA9IHRoaXMub3A7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3aGlsZSAoY29kZUxlbmd0aC0tKSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0W29wXSA9IG91dHB1dFsob3ArKykgLSBjb2RlRGlzdF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgd2hpbGUgKHRoaXMuYml0c2J1ZmxlbiA+PSA4KSB7XG4gICAgICAgICAgICB0aGlzLmJpdHNidWZsZW4gLT0gODtcbiAgICAgICAgICAgIHRoaXMuaXAtLTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm9wID0gb3A7XG4gICAgfVxuICAgIDtcbiAgICBkZWNvZGVIdWZmbWFuQWRhcHRpdmUobGl0bGVuLCBkaXN0KSB7XG4gICAgICAgIGxldCBvdXRwdXQgPSB0aGlzLm91dHB1dDtcbiAgICAgICAgbGV0IG9wID0gdGhpcy5vcDtcbiAgICAgICAgdGhpcy5jdXJyZW50TGl0bGVuVGFibGUgPSBsaXRsZW47XG4gICAgICAgIC8qKiBAdHlwZSB7bnVtYmVyfSBvdXRwdXQgcG9zaXRpb24gbGltaXQuICovXG4gICAgICAgIGxldCBvbGVuZ3RoID0gb3V0cHV0Lmxlbmd0aDtcbiAgICAgICAgLyoqIEB0eXBlIHtudW1iZXJ9IGh1ZmZtYW4gY29kZS4gKi9cbiAgICAgICAgbGV0IGNvZGU7XG4gICAgICAgIC8qKiBAdHlwZSB7bnVtYmVyfSB0YWJsZSBpbmRleC4gKi9cbiAgICAgICAgbGV0IHRpO1xuICAgICAgICAvKiogQHR5cGUge251bWJlcn0gaHVmZm1hbiBjb2RlIGRpc3RpbmF0aW9uLiAqL1xuICAgICAgICBsZXQgY29kZURpc3Q7XG4gICAgICAgIC8qKiBAdHlwZSB7bnVtYmVyfSBodWZmbWFuIGNvZGUgbGVuZ3RoLiAqL1xuICAgICAgICBsZXQgY29kZUxlbmd0aDtcbiAgICAgICAgbGV0IGxlbmd0aENvZGVUYWJsZSA9IExlbmd0aENvZGVUYWJsZTtcbiAgICAgICAgbGV0IGxlbmd0aEV4dHJhVGFibGUgPSBMZW5ndGhFeHRyYVRhYmxlO1xuICAgICAgICBsZXQgZGlzdENvZGVUYWJsZSA9IERpc3RDb2RlVGFibGU7XG4gICAgICAgIGxldCBkaXN0RXh0cmFUYWJsZSA9IERpc3RFeHRyYVRhYmxlO1xuICAgICAgICB3aGlsZSAoKGNvZGUgPSB0aGlzLnJlYWRDb2RlQnlUYWJsZShsaXRsZW4pKSAhPT0gMjU2KSB7XG4gICAgICAgICAgICAvLyBsaXRlcmFsXG4gICAgICAgICAgICBpZiAoY29kZSA8IDI1Nikge1xuICAgICAgICAgICAgICAgIGlmIChvcCA+PSBvbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IHRoaXMuZXhwYW5kQnVmZmVyQWRhcHRpdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgb2xlbmd0aCA9IG91dHB1dC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG91dHB1dFtvcCsrXSA9IGNvZGU7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBsZW5ndGggY29kZVxuICAgICAgICAgICAgdGkgPSBjb2RlIC0gMjU3O1xuICAgICAgICAgICAgY29kZUxlbmd0aCA9IGxlbmd0aENvZGVUYWJsZVt0aV07XG4gICAgICAgICAgICBpZiAobGVuZ3RoRXh0cmFUYWJsZVt0aV0gPiAwKSB7XG4gICAgICAgICAgICAgICAgY29kZUxlbmd0aCArPSB0aGlzLnJlYWRCaXRzKGxlbmd0aEV4dHJhVGFibGVbdGldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGRpc3QgY29kZVxuICAgICAgICAgICAgY29kZSA9IHRoaXMucmVhZENvZGVCeVRhYmxlKGRpc3QpO1xuICAgICAgICAgICAgY29kZURpc3QgPSBkaXN0Q29kZVRhYmxlW2NvZGVdO1xuICAgICAgICAgICAgaWYgKGRpc3RFeHRyYVRhYmxlW2NvZGVdID4gMCkge1xuICAgICAgICAgICAgICAgIGNvZGVEaXN0ICs9IHRoaXMucmVhZEJpdHMoZGlzdEV4dHJhVGFibGVbY29kZV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gbHo3NyBkZWNvZGVcbiAgICAgICAgICAgIGlmIChvcCArIGNvZGVMZW5ndGggPiBvbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0ID0gdGhpcy5leHBhbmRCdWZmZXJBZGFwdGl2ZSgpO1xuICAgICAgICAgICAgICAgIG9sZW5ndGggPSBvdXRwdXQubGVuZ3RoO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd2hpbGUgKGNvZGVMZW5ndGgtLSkge1xuICAgICAgICAgICAgICAgIG91dHB1dFtvcF0gPSBvdXRwdXRbKG9wKyspIC0gY29kZURpc3RdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHdoaWxlICh0aGlzLmJpdHNidWZsZW4gPj0gOCkge1xuICAgICAgICAgICAgdGhpcy5iaXRzYnVmbGVuIC09IDg7XG4gICAgICAgICAgICB0aGlzLmlwLS07XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vcCA9IG9wO1xuICAgIH1cbiAgICBleHBhbmRCdWZmZXJCbG9jaygpIHtcbiAgICAgICAgbGV0IGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KHRoaXMub3AgLSBNYXhCYWNrd2FyZExlbmd0aCk7XG4gICAgICAgIGxldCBiYWNrd2FyZCA9IHRoaXMub3AgLSBNYXhCYWNrd2FyZExlbmd0aDtcbiAgICAgICAgbGV0IG91dHB1dCA9IHRoaXMub3V0cHV0O1xuICAgICAgICAvLyBjb3B5IHRvIG91dHB1dCBidWZmZXJcbiAgICAgICAgYnVmZmVyLnNldChvdXRwdXQuc3ViYXJyYXkoTWF4QmFja3dhcmRMZW5ndGgsIGJ1ZmZlci5sZW5ndGgpKTtcbiAgICAgICAgdGhpcy5ibG9ja3MucHVzaChidWZmZXIpO1xuICAgICAgICB0aGlzLnRvdGFscG9zICs9IGJ1ZmZlci5sZW5ndGg7XG4gICAgICAgIC8vIGNvcHkgdG8gYmFja3dhcmQgYnVmZmVyXG4gICAgICAgIG91dHB1dC5zZXQob3V0cHV0LnN1YmFycmF5KGJhY2t3YXJkLCBiYWNrd2FyZCArIE1heEJhY2t3YXJkTGVuZ3RoKSk7XG4gICAgICAgIHRoaXMub3AgPSBNYXhCYWNrd2FyZExlbmd0aDtcbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9XG4gICAgZXhwYW5kQnVmZmVyQWRhcHRpdmUob3B0X3BhcmFtKSB7XG4gICAgICAgIC8qKiBAdHlwZSB7IShBcnJheS48bnVtYmVyPnxVaW50OEFycmF5KX0gc3RvcmUgYnVmZmVyLiAqL1xuICAgICAgICBsZXQgYnVmZmVyO1xuICAgICAgICAvKiogQHR5cGUge251bWJlcn0gZXhwYW50aW9uIHJhdGlvLiAqL1xuICAgICAgICBsZXQgcmF0aW8gPSAodGhpcy5pbnB1dC5sZW5ndGggLyB0aGlzLmlwICsgMSkgfCAwO1xuICAgICAgICAvKiogQHR5cGUge251bWJlcn0gbWF4aW11bSBudW1iZXIgb2YgaHVmZm1hbiBjb2RlLiAqL1xuICAgICAgICBsZXQgbWF4SHVmZkNvZGU7XG4gICAgICAgIC8qKiBAdHlwZSB7bnVtYmVyfSBuZXcgb3V0cHV0IGJ1ZmZlciBzaXplLiAqL1xuICAgICAgICBsZXQgbmV3U2l6ZTtcbiAgICAgICAgLyoqIEB0eXBlIHtudW1iZXJ9IG1heCBpbmZsYXRlIHNpemUuICovXG4gICAgICAgIGxldCBtYXhJbmZsYXRlU2l6ZTtcbiAgICAgICAgbGV0IGlucHV0ID0gdGhpcy5pbnB1dDtcbiAgICAgICAgbGV0IG91dHB1dCA9IHRoaXMub3V0cHV0O1xuICAgICAgICBpZiAob3B0X3BhcmFtKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9wdF9wYXJhbS5maXhSYXRpbyA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgICAgICByYXRpbyA9IG9wdF9wYXJhbS5maXhSYXRpbztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0X3BhcmFtLmFkZFJhdGlvID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgIHJhdGlvICs9IG9wdF9wYXJhbS5hZGRSYXRpbztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBjYWxjdWxhdGUgbmV3IGJ1ZmZlciBzaXplXG4gICAgICAgIGlmIChyYXRpbyA8IDIpIHtcbiAgICAgICAgICAgIG1heEh1ZmZDb2RlID1cbiAgICAgICAgICAgICAgICAoaW5wdXQubGVuZ3RoIC0gdGhpcy5pcCkgLyB0aGlzLmN1cnJlbnRMaXRsZW5UYWJsZVsyXTtcbiAgICAgICAgICAgIG1heEluZmxhdGVTaXplID0gKG1heEh1ZmZDb2RlIC8gMiAqIDI1OCkgfCAwO1xuICAgICAgICAgICAgbmV3U2l6ZSA9IG1heEluZmxhdGVTaXplIDwgb3V0cHV0Lmxlbmd0aCA/XG4gICAgICAgICAgICAgICAgb3V0cHV0Lmxlbmd0aCArIG1heEluZmxhdGVTaXplIDpcbiAgICAgICAgICAgICAgICBvdXRwdXQubGVuZ3RoIDw8IDE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBuZXdTaXplID0gb3V0cHV0Lmxlbmd0aCAqIHJhdGlvO1xuICAgICAgICB9XG4gICAgICAgIGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KG5ld1NpemUpO1xuICAgICAgICBidWZmZXIuc2V0KG91dHB1dCk7XG4gICAgICAgIHRoaXMub3V0cHV0ID0gYnVmZmVyO1xuICAgICAgICByZXR1cm4gdGhpcy5vdXRwdXQ7XG4gICAgfVxuICAgIDtcbiAgICBjb25jYXRCdWZmZXJCbG9jaygpIHtcbiAgICAgICAgLyoqIEB0eXBlIHtudW1iZXJ9IGJ1ZmZlciBwb2ludGVyLiAqL1xuICAgICAgICBsZXQgcG9zID0gMDtcbiAgICAgICAgLyoqIEB0eXBlIHtudW1iZXJ9IGJ1ZmZlciBwb2ludGVyLiAqL1xuICAgICAgICBsZXQgbGltaXQgPSB0aGlzLnRvdGFscG9zICsgKHRoaXMub3AgLSBNYXhCYWNrd2FyZExlbmd0aCk7XG4gICAgICAgIC8qKiBAdHlwZSB7IShBcnJheS48bnVtYmVyPnxVaW50OEFycmF5KX0gb3V0cHV0IGJsb2NrIGFycmF5LiAqL1xuICAgICAgICBsZXQgb3V0cHV0ID0gdGhpcy5vdXRwdXQ7XG4gICAgICAgIC8qKiBAdHlwZSB7IUFycmF5fSBibG9ja3MgYXJyYXkuICovXG4gICAgICAgIGxldCBibG9ja3MgPSB0aGlzLmJsb2NrcztcbiAgICAgICAgLyoqIEB0eXBlIHshKEFycmF5LjxudW1iZXI+fFVpbnQ4QXJyYXkpfSBvdXRwdXQgYmxvY2sgYXJyYXkuICovXG4gICAgICAgIGxldCBibG9jaztcbiAgICAgICAgLyoqIEB0eXBlIHshKEFycmF5LjxudW1iZXI+fFVpbnQ4QXJyYXkpfSBvdXRwdXQgYnVmZmVyLiAqL1xuICAgICAgICBsZXQgYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkobGltaXQpO1xuICAgICAgICAvKiogQHR5cGUge251bWJlcn0gbG9vcCBjb3VudGVyLiAqL1xuICAgICAgICBsZXQgaTtcbiAgICAgICAgLyoqIEB0eXBlIHtudW1iZXJ9IGxvb3AgbGltaXRlci4gKi9cbiAgICAgICAgbGV0IGlsO1xuICAgICAgICAvKiogQHR5cGUge251bWJlcn0gbG9vcCBjb3VudGVyLiAqL1xuICAgICAgICBsZXQgajtcbiAgICAgICAgLyoqIEB0eXBlIHtudW1iZXJ9IGxvb3AgbGltaXRlci4gKi9cbiAgICAgICAgbGV0IGpsO1xuICAgICAgICAvLyBzaW5nbGUgYnVmZmVyXG4gICAgICAgIGlmIChibG9ja3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vdXRwdXQuc3ViYXJyYXkoTWF4QmFja3dhcmRMZW5ndGgsIHRoaXMub3ApO1xuICAgICAgICB9XG4gICAgICAgIC8vIGNvcHkgdG8gYnVmZmVyXG4gICAgICAgIGZvciAoaSA9IDAsIGlsID0gYmxvY2tzLmxlbmd0aDsgaSA8IGlsOyArK2kpIHtcbiAgICAgICAgICAgIGJsb2NrID0gYmxvY2tzW2ldO1xuICAgICAgICAgICAgZm9yIChqID0gMCwgamwgPSBibG9jay5sZW5ndGg7IGogPCBqbDsgKytqKSB7XG4gICAgICAgICAgICAgICAgYnVmZmVyW3BvcysrXSA9IGJsb2NrW2pdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIGN1cnJlbnQgYnVmZmVyXG4gICAgICAgIGZvciAoaSA9IE1heEJhY2t3YXJkTGVuZ3RoLCBpbCA9IHRoaXMub3A7IGkgPCBpbDsgKytpKSB7XG4gICAgICAgICAgICBidWZmZXJbcG9zKytdID0gb3V0cHV0W2ldO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYmxvY2tzID0gW107XG4gICAgICAgIHRoaXMuYnVmZmVyID0gYnVmZmVyO1xuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXI7XG4gICAgfVxuICAgIDtcbiAgICBjb25jYXRCdWZmZXJEeW5hbWljKCkge1xuICAgICAgICBsZXQgYnVmZmVyO1xuICAgICAgICBsZXQgb3AgPSB0aGlzLm9wO1xuICAgICAgICBpZiAodGhpcy5yZXNpemUpIHtcbiAgICAgICAgICAgIGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KG9wKTtcbiAgICAgICAgICAgIGJ1ZmZlci5zZXQodGhpcy5vdXRwdXQuc3ViYXJyYXkoMCwgb3ApKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGJ1ZmZlciA9IHRoaXMub3V0cHV0LnN1YmFycmF5KDAsIG9wKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmJ1ZmZlciA9IGJ1ZmZlcjtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyO1xuICAgIH1cbn1cblxuY2xhc3MgU3RyaW5nVXRpbCB7XG4gICAgc3RhdGljIGVuY29kZUhUTUwoc3RyKSB7XG4gICAgICAgIGlmICghc3RyKVxuICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBzdHIucmVwbGFjZShcIiZcIiwgXCImYW1wO1wiKS5yZXBsYWNlKFwiPFwiLCBcIiZsdDtcIikucmVwbGFjZShcIj5cIiwgXCImZ3Q7XCIpLnJlcGxhY2UoXCInXCIsIFwiJmFwb3M7XCIpO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0RmlsZU5hbWUoc291cmNlKSB7XG4gICAgICAgIGxldCBpID0gc291cmNlLmxhc3RJbmRleE9mKFwiL1wiKTtcbiAgICAgICAgaWYgKGkgIT0gLTEpXG4gICAgICAgICAgICBzb3VyY2UgPSBzb3VyY2Uuc3Vic3RyKGkgKyAxKTtcbiAgICAgICAgaSA9IHNvdXJjZS5sYXN0SW5kZXhPZihcIlxcXFxcIik7XG4gICAgICAgIGlmIChpICE9IC0xKVxuICAgICAgICAgICAgc291cmNlID0gc291cmNlLnN1YnN0cihpICsgMSk7XG4gICAgICAgIGkgPSBzb3VyY2UubGFzdEluZGV4T2YoXCIuXCIpO1xuICAgICAgICBpZiAoaSAhPSAtMSlcbiAgICAgICAgICAgIHJldHVybiBzb3VyY2Uuc3Vic3RyaW5nKDAsIGkpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gc291cmNlO1xuICAgIH1cbiAgICBzdGF0aWMgc3RhcnRzV2l0aChzb3VyY2UsIHN0ciwgaWdub3JlQ2FzZSA9IGZhbHNlKSB7XG4gICAgICAgIGlmICghc291cmNlKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBlbHNlIGlmIChzb3VyY2UubGVuZ3RoIDwgc3RyLmxlbmd0aClcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzb3VyY2UgPSBzb3VyY2Uuc3Vic3RyaW5nKDAsIHN0ci5sZW5ndGgpO1xuICAgICAgICAgICAgaWYgKCFpZ25vcmVDYXNlKVxuICAgICAgICAgICAgICAgIHJldHVybiBzb3VyY2UgPT0gc3RyO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHJldHVybiBzb3VyY2UudG9Mb3dlckNhc2UoKSA9PSBzdHIudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzdGF0aWMgZW5kc1dpdGgoc291cmNlLCBzdHIsIGlnbm9yZUNhc2UgPSBmYWxzZSkge1xuICAgICAgICBpZiAoIXNvdXJjZSlcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgZWxzZSBpZiAoc291cmNlLmxlbmd0aCA8IHN0ci5sZW5ndGgpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc291cmNlID0gc291cmNlLnN1YnN0cmluZyhzb3VyY2UubGVuZ3RoIC0gc3RyLmxlbmd0aCk7XG4gICAgICAgICAgICBpZiAoIWlnbm9yZUNhc2UpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNvdXJjZSA9PSBzdHI7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNvdXJjZS50b0xvd2VyQ2FzZSgpID09IHN0ci50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHN0YXRpYyB0cmltKHRhcmdldFN0cmluZykge1xuICAgICAgICByZXR1cm4gU3RyaW5nVXRpbC50cmltTGVmdChTdHJpbmdVdGlsLnRyaW1SaWdodCh0YXJnZXRTdHJpbmcpKTtcbiAgICB9XG4gICAgc3RhdGljIHRyaW1MZWZ0KHRhcmdldFN0cmluZykge1xuICAgICAgICBsZXQgdGVtcENoYXIgPSBcIlwiO1xuICAgICAgICBsZXQgaTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRhcmdldFN0cmluZy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGVtcENoYXIgPSB0YXJnZXRTdHJpbmcuY2hhckF0KGkpO1xuICAgICAgICAgICAgaWYgKHRlbXBDaGFyICE9IFwiIFwiICYmIHRlbXBDaGFyICE9IFwiXFxuXCIgJiYgdGVtcENoYXIgIT0gXCJcXHJcIilcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGFyZ2V0U3RyaW5nLnN1YnN0cihpKTtcbiAgICB9XG4gICAgc3RhdGljIHRyaW1SaWdodCh0YXJnZXRTdHJpbmcpIHtcbiAgICAgICAgbGV0IHRlbXBDaGFyID0gXCJcIjtcbiAgICAgICAgbGV0IGk7XG4gICAgICAgIGZvciAoaSA9IHRhcmdldFN0cmluZy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgdGVtcENoYXIgPSB0YXJnZXRTdHJpbmcuY2hhckF0KGkpO1xuICAgICAgICAgICAgaWYgKHRlbXBDaGFyICE9IFwiIFwiICYmIHRlbXBDaGFyICE9IFwiXFxuXCIgJiYgdGVtcENoYXIgIT0gXCJcXHJcIilcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGFyZ2V0U3RyaW5nLnN1YnN0cmluZygwLCBpICsgMSk7XG4gICAgfVxuICAgIHN0YXRpYyBjb252ZXJ0VG9IdG1sQ29sb3IoYXJnYiwgaGFzQWxwaGEgPSBmYWxzZSkge1xuICAgICAgICBsZXQgYWxwaGE7XG4gICAgICAgIGlmIChoYXNBbHBoYSlcbiAgICAgICAgICAgIGFscGhhID0gKGFyZ2IgPj4gMjQgJiAweEZGKS50b1N0cmluZygxNik7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGFscGhhID0gXCJcIjtcbiAgICAgICAgbGV0IHJlZCA9IChhcmdiID4+IDE2ICYgMHhGRikudG9TdHJpbmcoMTYpO1xuICAgICAgICBsZXQgZ3JlZW4gPSAoYXJnYiA+PiA4ICYgMHhGRikudG9TdHJpbmcoMTYpO1xuICAgICAgICBsZXQgYmx1ZSA9IChhcmdiICYgMHhGRikudG9TdHJpbmcoMTYpO1xuICAgICAgICBpZiAoYWxwaGEubGVuZ3RoID09IDEpXG4gICAgICAgICAgICBhbHBoYSA9IGAwJHthbHBoYX1gO1xuICAgICAgICBpZiAocmVkLmxlbmd0aCA9PSAxKVxuICAgICAgICAgICAgcmVkID0gYDAke3JlZH1gO1xuICAgICAgICBpZiAoZ3JlZW4ubGVuZ3RoID09IDEpXG4gICAgICAgICAgICBncmVlbiA9IGAwJHtncmVlbn1gO1xuICAgICAgICBpZiAoYmx1ZS5sZW5ndGggPT0gMSlcbiAgICAgICAgICAgIGJsdWUgPSBgMCR7Ymx1ZX1gO1xuICAgICAgICByZXR1cm4gYCMke2FscGhhfSR7cmVkfSR7Z3JlZW59JHtibHVlfWA7XG4gICAgfVxuICAgIHN0YXRpYyBjb252ZXJ0RnJvbUh0bWxDb2xvcihzdHIsIGhhc0FscGhhID0gZmFsc2UpIHtcbiAgICAgICAgaWYgKHN0ci5sZW5ndGggPCAxKVxuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIGlmIChzdHIuY2hhckF0KDApID09IFwiI1wiKVxuICAgICAgICAgICAgc3RyID0gc3RyLnN1YnN0cigxKTtcbiAgICAgICAgaWYgKHN0ci5sZW5ndGggPT0gOClcbiAgICAgICAgICAgIHJldHVybiAocGFyc2VJbnQoc3RyLnN1YnN0cigwLCAyKSwgMTYpIDw8IDI0KSArIHBhcnNlSW50KHN0ci5zdWJzdHIoMiksIDE2KTtcbiAgICAgICAgZWxzZSBpZiAoaGFzQWxwaGEpXG4gICAgICAgICAgICByZXR1cm4gMHhGRjAwMDAwMCArIHBhcnNlSW50KHN0ciwgMTYpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoc3RyLCAxNik7XG4gICAgfVxuICAgIHN0YXRpYyBjb252ZXJ0VG9SR0JBKHN0cikge1xuICAgICAgICBpZiAoc3RyLmNoYXJBdCgwKSA9PSBcIiNcIilcbiAgICAgICAgICAgIHN0ciA9IHN0ci5zdWJzdHIoMSk7XG4gICAgICAgIGxldCBhbHBoYSA9ICsocGFyc2VJbnQoJzB4JyArIHN0ci5zbGljZSgwLCAyKSkgLyAyNTUpLnRvRml4ZWQoMik7XG4gICAgICAgIHN0ciA9IHN0ci5zdWJzdHIoMik7XG4gICAgICAgIGxldCByID0gcGFyc2VJbnQoc3RyLnN1YnN0cmluZygwLCAyKSwgMTYpO1xuICAgICAgICBsZXQgZyA9IHBhcnNlSW50KHN0ci5zdWJzdHJpbmcoMiwgNCksIDE2KTtcbiAgICAgICAgbGV0IGIgPSBwYXJzZUludChzdHIuc3Vic3RyaW5nKDQpLCAxNik7XG4gICAgICAgIHJldHVybiBjcmVhdGVqcy5HcmFwaGljcy5nZXRSR0IociwgZywgYiwgYWxwaGEpO1xuICAgIH1cbiAgICBzdGF0aWMgSEVYMlJHQihoZXgpIHtcbiAgICAgICAgaWYgKGhleC5jaGFyQXQoMCkgPT0gXCIjXCIpXG4gICAgICAgICAgICBoZXggPSBoZXguc3Vic3RyKDEpO1xuICAgICAgICBpZiAoaGV4Lmxlbmd0aCA9PT0gMykge1xuICAgICAgICAgICAgaGV4ICs9IGhleDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYCR7dGhpcy5IRVgyREVDKGhleC5zdWJzdHJpbmcoMCwgMikpfSwke3RoaXMuSEVYMkRFQyhoZXguc3Vic3RyaW5nKDIsIDQpKX0sJHt0aGlzLkhFWDJERUMoaGV4LnN1YnN0cmluZyg0KSl9YDtcbiAgICB9XG4gICAgc3RhdGljIEhFWDJERUMoaGV4KSB7XG4gICAgICAgIHJldHVybiBwYXJzZUludChoZXgsIDE2KS50b1N0cmluZygpO1xuICAgIH1cbn1cblxuY2xhc3MgVXRpbHMge1xuICAgIHN0YXRpYyBkZWVwQ29weVByb3BlcnRpZXModGFyZ2V0LCBzb3VyY2UsIHByb3BlcnR5T2JqKSB7XG4gICAgICAgIGZvciAodmFyIHByb3AgaW4gcHJvcGVydHlPYmopIHtcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHNvdXJjZVtwcm9wXSkpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRbcHJvcF0gPSBzb3VyY2VbcHJvcF0uc2xpY2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRhcmdldFtwcm9wXSA9IHNvdXJjZVtwcm9wXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBzdGF0aWMgZmlsbFBhdGgoY3R4LCBwb2ludHMsIHB4LCBweSkge1xuICAgICAgICB2YXIgY250ID0gcG9pbnRzLmxlbmd0aDtcbiAgICAgICAgY3R4Lm1vdmVUbyhwb2ludHNbMF0gKyBweCwgcG9pbnRzWzFdICsgcHkpO1xuICAgICAgICBmb3IgKHZhciBpID0gMjsgaSA8IGNudDsgaSArPSAyKSB7XG4gICAgICAgICAgICBjdHgubGluZVRvKHBvaW50c1tpXSArIHB4LCBwb2ludHNbaSArIDFdICsgcHkpO1xuICAgICAgICB9XG4gICAgICAgIGN0eC5saW5lVG8ocG9pbnRzWzBdICsgcHgsIHBvaW50c1sxXSArIHB5KTtcbiAgICB9XG59XG5VdGlscy5UZXh0dXJlQ2FjaGUgPSB7fTtcblxuY2xhc3MgWG1sTm9kZSB7XG4gICAgY29uc3RydWN0b3IoZWxlKSB7XG4gICAgICAgIHRoaXMubm9kZU5hbWUgPSBlbGUubm9kZU5hbWU7XG4gICAgICAgIHRoaXMuY29udGV4dCA9IGVsZTtcbiAgICAgICAgdGhpcy50eXBlID0gZWxlLm5vZGVUeXBlO1xuICAgICAgICB0aGlzLnRleHQgPSAodGhpcy50eXBlID09IE5vZGUuQ09NTUVOVF9OT0RFIHx8IHRoaXMudHlwZSA9PSBOb2RlLlRFWFRfTk9ERSkgPyB0aGlzLmNvbnRleHQudGV4dENvbnRlbnQgOiBudWxsO1xuICAgIH1cbiAgICBnZXQgY2hpbGRyZW4oKSB7XG4gICAgICAgIGlmICghdGhpcy4kY2hpbGRyZW4pXG4gICAgICAgICAgICB0aGlzLiRjaGlsZHJlbiA9IFhtbFBhcnNlci5nZXRDaGlsZE5vZGVzKHRoaXMpO1xuICAgICAgICByZXR1cm4gdGhpcy4kY2hpbGRyZW47XG4gICAgfVxuICAgIGdldCBhdHRyaWJ1dGVzKCkge1xuICAgICAgICBpZiAoIXRoaXMuJGF0dHJpYnV0ZXMpXG4gICAgICAgICAgICB0aGlzLiRhdHRyaWJ1dGVzID0gWG1sUGFyc2VyLmdldE5vZGVBdHRyaWJ1dGVzKHRoaXMpO1xuICAgICAgICByZXR1cm4gdGhpcy4kYXR0cmlidXRlcztcbiAgICB9XG59XG5jbGFzcyBYbWxQYXJzZXIge1xuICAgIHN0YXRpYyB0cnlQYXJzZSh4bWxzdHJpbmcsIG1pbWVUeXBlID0gXCJhcHBsaWNhdGlvbi94bWxcIikge1xuICAgICAgICBsZXQgZG9jID0gWG1sUGFyc2VyLiRwYXJzZXIucGFyc2VGcm9tU3RyaW5nKHhtbHN0cmluZywgbWltZVR5cGUpO1xuICAgICAgICBpZiAoZG9jICYmIGRvYy5jaGlsZE5vZGVzICYmIGRvYy5jaGlsZE5vZGVzLmxlbmd0aCA+PSAxKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBYbWxOb2RlKGRvYy5maXJzdENoaWxkKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHN0YXRpYyBnZXRYbWxSb290KHhtbCkge1xuICAgICAgICBpZiAoIXhtbCB8fCAheG1sLmNvbnRleHQpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHhtbCBub2RlXCIpO1xuICAgICAgICBsZXQgcCA9IHhtbC5jb250ZXh0O1xuICAgICAgICB3aGlsZSAocC5wYXJlbnROb2RlICE9IG51bGwpXG4gICAgICAgICAgICBwID0gcC5wYXJlbnROb2RlO1xuICAgICAgICByZXR1cm4gcCA9PSB4bWwuY29udGV4dCA/IHhtbCA6IG5ldyBYbWxOb2RlKHApO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0Q2hpbGROb2Rlcyh4bWwsIG1hdGNoTmFtZSA9IG51bGwpIHtcbiAgICAgICAgbGV0IG5vZGVzID0geG1sLmNvbnRleHQuY2hpbGROb2RlcztcbiAgICAgICAgbGV0IHJldCA9IFtdO1xuICAgICAgICBpZiAoIW5vZGVzIHx8IG5vZGVzLmxlbmd0aCA8PSAwKVxuICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgbGV0IGxlbiA9IG5vZGVzLmxlbmd0aDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgbGV0IG4gPSBub2Rlcy5pdGVtKGkpO1xuICAgICAgICAgICAgaWYgKG4ubm9kZVR5cGUgPT0gTm9kZS5URVhUX05PREUpXG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICBpZiAoIW1hdGNoTmFtZSB8fCAobWF0Y2hOYW1lICYmIG1hdGNoTmFtZS5sZW5ndGggPiAwICYmIG4ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PSBtYXRjaE5hbWUudG9Mb3dlckNhc2UoKSkpXG4gICAgICAgICAgICAgICAgcmV0LnB1c2gobmV3IFhtbE5vZGUobikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfVxuICAgIHN0YXRpYyBnZXROb2RlQXR0cmlidXRlcyh4bWwpIHtcbiAgICAgICAgbGV0IGNvbnRleHQgPSB4bWwuY29udGV4dDtcbiAgICAgICAgbGV0IGFzTGlzdCA9IGNvbnRleHQuYXR0cmlidXRlcztcbiAgICAgICAgbGV0IHJldCA9IHt9O1xuICAgICAgICBpZiAoIWFzTGlzdCB8fCBhc0xpc3QubGVuZ3RoIDw9IDApXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICBsZXQgbGVuID0gYXNMaXN0Lmxlbmd0aDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgbGV0IGEgPSBhc0xpc3QuaXRlbShpKTtcbiAgICAgICAgICAgIHJldFthLm5vZGVOYW1lXSA9IGEubm9kZVZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfVxufVxuWG1sUGFyc2VyLiRwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7XG5cbmNsYXNzIERpc3BsYXlMaXN0SXRlbSB7XG4gICAgY29uc3RydWN0b3IocGFja2FnZUl0ZW0sIHR5cGUpIHtcbiAgICAgICAgdGhpcy5wYWNrYWdlSXRlbSA9IHBhY2thZ2VJdGVtO1xuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgIH1cbn1cblxuY2xhc3MgUGFja2FnZUl0ZW0ge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLndpZHRoID0gMDtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSAwO1xuICAgICAgICB0aGlzLnRpbGVkU2xpY2VzID0gMDtcbiAgICAgICAgLy9tb3ZpZWNsaXBcbiAgICAgICAgdGhpcy5pbnRlcnZhbCA9IDA7XG4gICAgICAgIHRoaXMucmVwZWF0RGVsYXkgPSAwO1xuICAgIH1cbiAgICBsb2FkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vd25lci5nZXRJdGVtQXNzZXQodGhpcyk7XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5uYW1lO1xuICAgIH1cbn1cblxuY2xhc3MgQXRsYXNDb25maWcge1xuICAgIGNvbnN0cnVjdG9yKGF0bGFzTmFtZSwgZnJhbWUsIG9yaWcsIHRyaW0sIHJvdGF0ZSkge1xuICAgICAgICB0aGlzLmF0bGFzTmFtZSA9IGF0bGFzTmFtZTtcbiAgICAgICAgdGhpcy5mcmFtZSA9IGZyYW1lO1xuICAgICAgICB0aGlzLm9yaWcgPSBvcmlnO1xuICAgICAgICB0aGlzLnRyaW0gPSB0cmltO1xuICAgICAgICB0aGlzLnJvdGF0ZSA9IHJvdGF0ZTtcbiAgICB9XG59XG5jbGFzcyBVSVBhY2thZ2Uge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLiRpdGVtcyA9IFtdO1xuICAgICAgICB0aGlzLiRhdGxhc0NvbmZpZ3MgPSB7fTtcbiAgICB9XG4gICAgc3RhdGljIGdldEJ5SWQoaWQpIHtcbiAgICAgICAgcmV0dXJuIFVJUGFja2FnZS4kcGFja2FnZUluc3RCeUlkW2lkXTtcbiAgICB9XG4gICAgc3RhdGljIGdldEJ5TmFtZShuYW1lKSB7XG4gICAgICAgIHJldHVybiBVSVBhY2thZ2UuJHBhY2thZ2VJbnN0QnlOYW1lW25hbWVdO1xuICAgIH1cbiAgICBzdGF0aWMgYWRkUGFja2FnZShyZXNLZXkpIHtcbiAgICAgICAgbGV0IHBrZyA9IG5ldyBVSVBhY2thZ2UoKTtcbiAgICAgICAgcGtnLiRyZXNLZXkgPSByZXNLZXk7XG4gICAgICAgIHBrZy5jcmVhdGUocmVzS2V5KTtcbiAgICAgICAgVUlQYWNrYWdlLiRwYWNrYWdlSW5zdEJ5SWRbcGtnLmlkXSA9IHBrZztcbiAgICAgICAgVUlQYWNrYWdlLiRwYWNrYWdlSW5zdEJ5TmFtZVtwa2cubmFtZV0gPSBwa2c7XG4gICAgICAgIHBrZy5jdXN0b21JZCA9IHJlc0tleTtcbiAgICAgICAgcmV0dXJuIHBrZztcbiAgICB9XG4gICAgc3RhdGljIHJlbW92ZVBhY2thZ2UocGFja2FnZUlkKSB7XG4gICAgICAgIGxldCBwa2cgPSBVSVBhY2thZ2UuJHBhY2thZ2VJbnN0QnlJZFtwYWNrYWdlSWRdO1xuICAgICAgICBwa2cuZGlzcG9zZSgpO1xuICAgICAgICBkZWxldGUgVUlQYWNrYWdlLiRwYWNrYWdlSW5zdEJ5SWRbcGtnLmlkXTtcbiAgICAgICAgaWYgKHBrZy4kY3VzdG9tSWQgIT0gbnVsbClcbiAgICAgICAgICAgIGRlbGV0ZSBVSVBhY2thZ2UuJHBhY2thZ2VJbnN0QnlJZFtwa2cuJGN1c3RvbUlkXTtcbiAgICAgICAgZGVsZXRlIFVJUGFja2FnZS4kcGFja2FnZUluc3RCeU5hbWVbcGtnLm5hbWVdO1xuICAgIH1cbiAgICBzdGF0aWMgY3JlYXRlT2JqZWN0KHBrZ05hbWUsIHJlc05hbWUsIHVzZXJDbGFzcykge1xuICAgICAgICBsZXQgcGtnID0gVUlQYWNrYWdlLmdldEJ5TmFtZShwa2dOYW1lKTtcbiAgICAgICAgaWYgKHBrZylcbiAgICAgICAgICAgIHJldHVybiBwa2cuY3JlYXRlT2JqZWN0KHJlc05hbWUsIHVzZXJDbGFzcyk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBzdGF0aWMgY3JlYXRlT2JqZWN0RnJvbVVSTCh1cmwsIHVzZXJDbGFzcykge1xuICAgICAgICBsZXQgcGkgPSBVSVBhY2thZ2UuZ2V0SXRlbUJ5VVJMKHVybCk7XG4gICAgICAgIGlmIChwaSlcbiAgICAgICAgICAgIHJldHVybiBwaS5vd25lci5pbnRlcm5hbENyZWF0ZU9iamVjdChwaSwgdXNlckNsYXNzKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHN0YXRpYyBnZXRJdGVtVVJMKHBrZ05hbWUsIHJlc05hbWUpIHtcbiAgICAgICAgbGV0IHBrZyA9IFVJUGFja2FnZS5nZXRCeU5hbWUocGtnTmFtZSk7XG4gICAgICAgIGlmICghcGtnKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIGxldCBwaSA9IHBrZy4kaXRlbXNCeU5hbWVbcmVzTmFtZV07XG4gICAgICAgIGlmICghcGkpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgcmV0dXJuIGB1aTovLyR7cGtnLmlkfSR7cGkuaWR9YDtcbiAgICB9XG4gICAgc3RhdGljIGdldEl0ZW1CeVVSTCh1cmwpIHtcbiAgICAgICAgbGV0IHBvczEgPSB1cmwuaW5kZXhPZignLy8nKTtcbiAgICAgICAgaWYgKHBvczEgPT0gLTEpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgbGV0IHBvczIgPSB1cmwuaW5kZXhPZignLycsIHBvczEgKyAyKTtcbiAgICAgICAgbGV0IHBrZztcbiAgICAgICAgaWYgKHBvczIgPT0gLTEpIHtcbiAgICAgICAgICAgIGlmICh1cmwubGVuZ3RoID4gMTMpIHtcbiAgICAgICAgICAgICAgICBsZXQgcGtnSWQgPSB1cmwuc3Vic3RyKDUsIDgpO1xuICAgICAgICAgICAgICAgIHBrZyA9IFVJUGFja2FnZS5nZXRCeUlkKHBrZ0lkKTtcbiAgICAgICAgICAgICAgICBpZiAocGtnICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHNyY0lkID0gdXJsLnN1YnN0cigxMyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwa2cuZ2V0SXRlbUJ5SWQoc3JjSWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGxldCBwa2dOYW1lID0gdXJsLnN1YnN0cihwb3MxICsgMiwgcG9zMiAtIHBvczEgLSAyKTtcbiAgICAgICAgICAgIHBrZyA9IFVJUGFja2FnZS5nZXRCeU5hbWUocGtnTmFtZSk7XG4gICAgICAgICAgICBpZiAocGtnICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBsZXQgc3JjTmFtZSA9IHVybC5zdWJzdHIocG9zMiArIDEpO1xuICAgICAgICAgICAgICAgIHJldHVybiBwa2cuZ2V0SXRlbUJ5TmFtZShzcmNOYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgc3RhdGljIGdldEJpdG1hcEZvbnRCeVVSTCh1cmwpIHtcbiAgICAgICAgcmV0dXJuIFVJUGFja2FnZS4kYml0bWFwRm9udHNbdXJsXTtcbiAgICB9XG4gICAgc3RhdGljIHNldFN0cmluZ3NTb3VyY2Uoc291cmNlKSB7XG4gICAgICAgIFVJUGFja2FnZS4kc3RyaW5nc1NvdXJjZSA9IHt9O1xuICAgICAgICBsZXQgeG1scm9vdCA9IFhtbFBhcnNlci50cnlQYXJzZShzb3VyY2UpO1xuICAgICAgICB4bWxyb290LmNoaWxkcmVuLmZvckVhY2goY3htbCA9PiB7XG4gICAgICAgICAgICBpZiAoY3htbC5ub2RlTmFtZSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIGxldCBrZXkgPSBjeG1sLmF0dHJpYnV0ZXMubmFtZTtcbiAgICAgICAgICAgICAgICBsZXQgaSA9IGtleS5pbmRleE9mKCctJyk7XG4gICAgICAgICAgICAgICAgaWYgKGkgPT0gLTEpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBsZXQgdGV4dCA9IGN4bWwuY2hpbGRyZW4ubGVuZ3RoID4gMCA/IGN4bWwuY2hpbGRyZW5bMF0udGV4dCA6ICcnO1xuICAgICAgICAgICAgICAgIGxldCBrZXkyID0ga2V5LnN1YnN0cigwLCBpKTtcbiAgICAgICAgICAgICAgICBsZXQga2V5MyA9IGtleS5zdWJzdHIoaSArIDEpO1xuICAgICAgICAgICAgICAgIGxldCBjb2wgPSBVSVBhY2thZ2UuJHN0cmluZ3NTb3VyY2Vba2V5Ml07XG4gICAgICAgICAgICAgICAgaWYgKCFjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgY29sID0ge307XG4gICAgICAgICAgICAgICAgICAgIFVJUGFja2FnZS4kc3RyaW5nc1NvdXJjZVtrZXkyXSA9IGNvbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29sW2tleTNdID0gdGV4dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGZvcm1hdCB0aGUgVVJMIGZyb20gb2xkIHZlcnNpb24gdG8gbmV3IHZlcnNpb25cbiAgICAgKiBAcGFyYW0gdXJsIHVybCB3aXRoIG9sZCB2ZXJzaW9uIGZvcm1hdFxuICAgICAqL1xuICAgIHN0YXRpYyBub3JtYWxpemVVUkwodXJsKSB7XG4gICAgICAgIGlmICh1cmwgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBsZXQgcG9zMSA9IHVybC5pbmRleE9mKCcvLycpO1xuICAgICAgICBpZiAocG9zMSA9PSAtMSlcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBsZXQgcG9zMiA9IHVybC5pbmRleE9mKCcvJywgcG9zMSArIDIpO1xuICAgICAgICBpZiAocG9zMiA9PSAtMSlcbiAgICAgICAgICAgIHJldHVybiB1cmw7XG4gICAgICAgIGxldCBwa2dOYW1lID0gdXJsLnN1YnN0cihwb3MxICsgMiwgcG9zMiAtIHBvczEgLSAyKTtcbiAgICAgICAgbGV0IHNyY05hbWUgPSB1cmwuc3Vic3RyKHBvczIgKyAxKTtcbiAgICAgICAgcmV0dXJuIFVJUGFja2FnZS5nZXRJdGVtVVJMKHBrZ05hbWUsIHNyY05hbWUpO1xuICAgIH1cbiAgICBjcmVhdGUocmVzS2V5KSB7XG4gICAgICAgIHRoaXMuJHJlc0tleSA9IHJlc0tleTtcbiAgICAgICAgbGV0IGJ1ZiA9IEFzc2V0TG9hZGVyLnJlc291cmNlc1Bvb2xbdGhpcy4kcmVzS2V5XTtcbiAgICAgICAgaWYgKCFidWYpIHtcbiAgICAgICAgICAgIGJ1ZiA9IEFzc2V0TG9hZGVyLnJlc291cmNlc1Bvb2xbYCR7dGhpcy4kcmVzS2V5fV9mdWlgXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWJ1Zikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBSZXNvdXJjZSAnJHt0aGlzLiRyZXNLZXl9JyBub3QgZm91bmQsIHBsZWFzZSBtYWtlIHN1cmUgdGhhdCB5b3UgdXNlIFwibmV3IGZndWkudXRpbHMuQXNzZXRMb2FkZXJcIiB0byBsb2FkIHJlc291cmNlc1wiLmApO1xuICAgICAgICB9XG4gICAgICAgIGlmICghYnVmIHx8ICEoYnVmIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFJlc291cmNlICcke3RoaXMuJHJlc0tleX0nIGlzIG5vdCBhIHByb3BlciBiaW5hcnkgcmVzb3VyY2UsIHBsZWFzZSBsb2FkIGl0IGFzIGJpbmFyeSBmb3JtYXQgaW4gbWFuaWZlc3QgZmlsZSBhZGRbeyBpZCwgc3JjLCB0eXBlOiBcImJpbmFyeVwiIH1dYCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sb2FkUGFja2FnZShidWYpO1xuICAgIH1cbiAgICBsb2FkUGFja2FnZShkZXNjRGF0YSkge1xuICAgICAgICB0aGlzLmRlY29tcHJlc3NQYWNrYWdlKGRlc2NEYXRhKTtcbiAgICAgICAgbGV0IHN0ciA9IHRoaXMuZ2V0UmVzRGVzY3JpcHRvcignc3ByaXRlcy5ieXRlcycpO1xuICAgICAgICBzdHIgJiZcbiAgICAgICAgICAgIHN0ci5zcGxpdChVSVBhY2thZ2Uuc2VwMSkuZm9yRWFjaCgoc3RyLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCA+PSAxICYmIHN0ciAmJiBzdHIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBhcnIgPSBzdHIuc3BsaXQoVUlQYWNrYWdlLnNlcDIpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgdGV4SUQ7XG4gICAgICAgICAgICAgICAgICAgIGxldCBpdGVtSWQgPSBhcnJbMF07XG4gICAgICAgICAgICAgICAgICAgIGxldCBiaW5JbmRleCA9IHBhcnNlSW50KGFyclsxXSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChiaW5JbmRleCA+PSAwKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4SUQgPSBgYXRsYXMke2JpbkluZGV4fWA7XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHBvcyA9IGl0ZW1JZC5pbmRleE9mKCdfJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocG9zID09IC0xKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleElEID0gYGF0bGFzXyR7aXRlbUlkfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4SUQgPSBgYXRsYXNfJHtpdGVtSWQuc3Vic3RyKDAsIHBvcyl9YDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsZXQgY2ZnID0gbmV3IEF0bGFzQ29uZmlnKHRleElEKTtcbiAgICAgICAgICAgICAgICAgICAgY2ZnLmZyYW1lID0gbmV3IGNyZWF0ZWpzLlJlY3RhbmdsZShwYXJzZUludChhcnJbMl0pLCBwYXJzZUludChhcnJbM10pLCBwYXJzZUludChhcnJbNF0pLCBwYXJzZUludChhcnJbNV0pKTtcbiAgICAgICAgICAgICAgICAgICAgY2ZnLnJvdGF0ZSA9IGFycls2XSA9PSAnMScgPyA2IDogMDtcbiAgICAgICAgICAgICAgICAgICAgY2ZnLm9yaWcgPVxuICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnJvdGF0ZSAhPSAwID8gbmV3IGNyZWF0ZWpzLlJlY3RhbmdsZSgwLCAwLCBjZmcuZnJhbWUuaGVpZ2h0LCBjZmcuZnJhbWUud2lkdGgpIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnRyaW0gPSB0cmltZWQ7ICAvL2lnbm9yZWQgZm9yIG5vdyAtIGVkaXRvciBub3Qgc3VwcG9ydFxuICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRhdGxhc0NvbmZpZ3NbaXRlbUlkXSA9IGNmZztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgc3RyID0gdGhpcy5nZXRSZXNEZXNjcmlwdG9yKCdwYWNrYWdlLnhtbCcpO1xuICAgICAgICBsZXQgeG1sID0gWG1sUGFyc2VyLnRyeVBhcnNlKHN0cik7XG4gICAgICAgIHRoaXMuJGlkID0geG1sLmF0dHJpYnV0ZXMuaWQ7XG4gICAgICAgIHRoaXMuJG5hbWUgPSB4bWwuYXR0cmlidXRlcy5uYW1lO1xuICAgICAgICBsZXQgcmVzb3VyY2VzID0geG1sLmNoaWxkcmVuWzBdLmNoaWxkcmVuO1xuICAgICAgICB0aGlzLiRpdGVtc0J5SWQgPSB7fTtcbiAgICAgICAgdGhpcy4kaXRlbXNCeU5hbWUgPSB7fTtcbiAgICAgICAgcmVzb3VyY2VzLmZvckVhY2goY3htbCA9PiB7XG4gICAgICAgICAgICBsZXQgcGkgPSBuZXcgUGFja2FnZUl0ZW0oKTtcbiAgICAgICAgICAgIHBpLnR5cGUgPSBQYXJzZVBhY2thZ2VJdGVtVHlwZShjeG1sLm5vZGVOYW1lKTtcbiAgICAgICAgICAgIHBpLmlkID0gY3htbC5hdHRyaWJ1dGVzLmlkO1xuICAgICAgICAgICAgcGkubmFtZSA9IGN4bWwuYXR0cmlidXRlcy5uYW1lO1xuICAgICAgICAgICAgcGkuZmlsZSA9IGN4bWwuYXR0cmlidXRlcy5maWxlO1xuICAgICAgICAgICAgc3RyID0gY3htbC5hdHRyaWJ1dGVzLnNpemU7XG4gICAgICAgICAgICBpZiAoc3RyKSB7XG4gICAgICAgICAgICAgICAgbGV0IGFyciA9IHN0ci5zcGxpdChVSVBhY2thZ2Uuc2VwMCk7XG4gICAgICAgICAgICAgICAgcGkud2lkdGggPSBwYXJzZUludChhcnJbMF0pO1xuICAgICAgICAgICAgICAgIHBpLmhlaWdodCA9IHBhcnNlSW50KGFyclsxXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzd2l0Y2ggKHBpLnR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDAgLyogSW1hZ2UgKi86IHtcbiAgICAgICAgICAgICAgICAgICAgc3RyID0gY3htbC5hdHRyaWJ1dGVzLnNjYWxlO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc3RyID09ICc5Z3JpZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ciA9IGN4bWwuYXR0cmlidXRlcy5zY2FsZTlncmlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0cikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBhcnIgPSBzdHIuc3BsaXQoVUlQYWNrYWdlLnNlcDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZWN0ID0gbmV3IGNyZWF0ZWpzLlJlY3RhbmdsZShwYXJzZUludChhcnJbMF0pLCBwYXJzZUludChhcnJbMV0pLCBwYXJzZUludChhcnJbMl0pLCBwYXJzZUludChhcnJbM10pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaS5zY2FsZTlHcmlkID0gcmVjdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHIgPSBjeG1sLmF0dHJpYnV0ZXMuZ3JpZFRpbGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGkudGlsZWRTbGljZXMgPSBwYXJzZUludChzdHIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHN0ciA9PSAndGlsZScpXG4gICAgICAgICAgICAgICAgICAgICAgICBwaS5zY2FsZUJ5VGlsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBpLm93bmVyID0gdGhpcztcbiAgICAgICAgICAgIHRoaXMuJGl0ZW1zLnB1c2gocGkpO1xuICAgICAgICAgICAgdGhpcy4kaXRlbXNCeUlkW3BpLmlkXSA9IHBpO1xuICAgICAgICAgICAgaWYgKHBpLm5hbWUgIT0gbnVsbClcbiAgICAgICAgICAgICAgICB0aGlzLiRpdGVtc0J5TmFtZVtwaS5uYW1lXSA9IHBpO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgdGhpcy4kaXRlbXMuZm9yRWFjaChwaSA9PiB7XG4gICAgICAgICAgICBpZiAocGkudHlwZSA9PSA2IC8qIEZvbnQgKi8pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRGb250KHBpKTtcbiAgICAgICAgICAgICAgICBVSVBhY2thZ2UuJGJpdG1hcEZvbnRzW3BpLmJpdG1hcEZvbnQuaWRdID0gcGkuYml0bWFwRm9udDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcyk7XG4gICAgfVxuICAgIGRlY29tcHJlc3NQYWNrYWdlKGJ1Zikge1xuICAgICAgICB0aGlzLiRyZXNEYXRhID0ge307XG4gICAgICAgIHZhciBtYXJrID0gbmV3IFVpbnQ4QXJyYXkoYnVmLnNsaWNlKDAsIDIpKTtcbiAgICAgICAgaWYgKG1hcmtbMF0gPT0gMHg1MCAmJiBtYXJrWzFdID09IDB4NGIpIHtcbiAgICAgICAgICAgIHRoaXMuZGVjb2RlVW5jb21wcmVzc2VkKGJ1Zik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGluZmxhdGVyID0gbmV3IFJhd0luZmxhdGUoYnVmKTtcbiAgICAgICAgbGV0IGRhdGEgPSBpbmZsYXRlci5kZWNvbXByZXNzKCk7XG4gICAgICAgIGxldCBzb3VyY2UgPSBSYXdCeXRlLmRlY29kZVVURjgoZGF0YSk7XG4gICAgICAgIGxldCBjdXJyID0gMDtcbiAgICAgICAgbGV0IGZuO1xuICAgICAgICBsZXQgc2l6ZTtcbiAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgIGxldCBwb3MgPSBzb3VyY2UuaW5kZXhPZignfCcsIGN1cnIpO1xuICAgICAgICAgICAgaWYgKHBvcyA9PSAtMSlcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGZuID0gc291cmNlLnN1YnN0cmluZyhjdXJyLCBwb3MpO1xuICAgICAgICAgICAgY3VyciA9IHBvcyArIDE7XG4gICAgICAgICAgICBwb3MgPSBzb3VyY2UuaW5kZXhPZignfCcsIGN1cnIpO1xuICAgICAgICAgICAgc2l6ZSA9IHBhcnNlSW50KHNvdXJjZS5zdWJzdHJpbmcoY3VyciwgcG9zKSk7XG4gICAgICAgICAgICBjdXJyID0gcG9zICsgMTtcbiAgICAgICAgICAgIHRoaXMuJHJlc0RhdGFbZm5dID0gc291cmNlLnN1YnN0cihjdXJyLCBzaXplKTtcbiAgICAgICAgICAgIGN1cnIgKz0gc2l6ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gYnVmXG4gICAgICovXG4gICAgZGVjb2RlVW5jb21wcmVzc2VkKGJ1Zikge1xuICAgICAgICB2YXIgYmEgPSBuZXcgQnl0ZUFycmF5KGJ1Zik7XG4gICAgICAgIGJhLmVuZGlhbiA9IEVuZGlhbi5MSVRUTEVfRU5ESUFOO1xuICAgICAgICB2YXIgcG9zID0gYmEubGVuZ3RoIC0gMjI7XG4gICAgICAgIGJhLnBvc2l0aW9uID0gcG9zICsgMTA7XG4gICAgICAgIHZhciBlbnRyeUNvdW50ID0gYmEucmVhZFVuc2lnbmVkU2hvcnQoKTtcbiAgICAgICAgYmEucG9zaXRpb24gPSBwb3MgKyAxNjtcbiAgICAgICAgcG9zID0gYmEucmVhZEludCgpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVudHJ5Q291bnQ7IGkrKykge1xuICAgICAgICAgICAgYmEucG9zaXRpb24gPSBwb3MgKyAyODtcbiAgICAgICAgICAgIHZhciBsZW4gPSBiYS5yZWFkVW5zaWduZWRTaG9ydCgpO1xuICAgICAgICAgICAgdmFyIGxlbjIgPSBiYS5yZWFkVW5zaWduZWRTaG9ydCgpICsgYmEucmVhZFVuc2lnbmVkU2hvcnQoKTtcbiAgICAgICAgICAgIGJhLnBvc2l0aW9uID0gcG9zICsgNDY7XG4gICAgICAgICAgICB2YXIgZW50cnlOYW1lID0gYmEucmVhZFVURkJ5dGVzKGxlbik7XG4gICAgICAgICAgICBpZiAoZW50cnlOYW1lW2VudHJ5TmFtZS5sZW5ndGggLSAxXSAhPSAnLycgJiYgZW50cnlOYW1lW2VudHJ5TmFtZS5sZW5ndGggLSAxXSAhPSAnXFxcXCcpIHtcbiAgICAgICAgICAgICAgICAvL25vdCBkaXJlY3RvcnlcbiAgICAgICAgICAgICAgICBiYS5wb3NpdGlvbiA9IHBvcyArIDIwO1xuICAgICAgICAgICAgICAgIHZhciBzaXplID0gYmEucmVhZEludCgpO1xuICAgICAgICAgICAgICAgIGJhLnBvc2l0aW9uID0gcG9zICsgNDI7XG4gICAgICAgICAgICAgICAgdmFyIG9mZnNldCA9IGJhLnJlYWRJbnQoKSArIDMwICsgbGVuO1xuICAgICAgICAgICAgICAgIGlmIChzaXplID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBiYS5wb3NpdGlvbiA9IG9mZnNldDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kcmVzRGF0YVtlbnRyeU5hbWVdID0gYmEucmVhZFVURkJ5dGVzKHNpemUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBvcyArPSA0NiArIGxlbiArIGxlbjI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZGlzcG9zZSgpIHtcbiAgICAgICAgdGhpcy4kaXRlbXMuZm9yRWFjaChwaSA9PiB7XG4gICAgICAgICAgICBsZXQgY2ZnID0gdGhpcy4kYXRsYXNDb25maWdzW3BpLmlkXTtcbiAgICAgICAgICAgIGlmIChjZmcpXG4gICAgICAgICAgICAgICAgQXNzZXRMb2FkZXIuZGVzdHJveVJlc291cmNlKGAke3RoaXMuJHJlc0tleX1AJHtjZmcuYXRsYXNOYW1lfWApO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICB9XG4gICAgZ2V0IGlkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kaWQ7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kbmFtZTtcbiAgICB9XG4gICAgZ2V0IGN1c3RvbUlkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kY3VzdG9tSWQ7XG4gICAgfVxuICAgIHNldCBjdXN0b21JZCh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kY3VzdG9tSWQgIT0gbnVsbClcbiAgICAgICAgICAgIGRlbGV0ZSBVSVBhY2thZ2UuJHBhY2thZ2VJbnN0QnlJZFt0aGlzLiRjdXN0b21JZF07XG4gICAgICAgIHRoaXMuJGN1c3RvbUlkID0gdmFsdWU7XG4gICAgICAgIGlmICh0aGlzLiRjdXN0b21JZCAhPSBudWxsKVxuICAgICAgICAgICAgVUlQYWNrYWdlLiRwYWNrYWdlSW5zdEJ5SWRbdGhpcy4kY3VzdG9tSWRdID0gdGhpcztcbiAgICB9XG4gICAgY3JlYXRlT2JqZWN0KHJlc05hbWUsIHVzZXJDbGFzcykge1xuICAgICAgICBsZXQgcGkgPSB0aGlzLiRpdGVtc0J5TmFtZVtyZXNOYW1lXTtcbiAgICAgICAgaWYgKHBpKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW50ZXJuYWxDcmVhdGVPYmplY3QocGksIHVzZXJDbGFzcyk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBpbnRlcm5hbENyZWF0ZU9iamVjdChpdGVtLCB1c2VyQ2xhc3MgPSBudWxsKSB7XG4gICAgICAgIGxldCBnID0gaXRlbS50eXBlID09IDQgLyogQ29tcG9uZW50ICovICYmIHVzZXJDbGFzcyAhPSBudWxsXG4gICAgICAgICAgICA/IG5ldyB1c2VyQ2xhc3MoKVxuICAgICAgICAgICAgOiBEZWNscy5VSU9iamVjdEZhY3RvcnkubmV3T2JqZWN0KGl0ZW0pO1xuICAgICAgICBpZiAoZyA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIFVJUGFja2FnZS4kY29uc3RydWN0aW5nT2JqZWN0cysrO1xuICAgICAgICBnLnBhY2thZ2VJdGVtID0gaXRlbTtcbiAgICAgICAgZy5jb25zdHJ1Y3RGcm9tUmVzb3VyY2UoKTtcbiAgICAgICAgVUlQYWNrYWdlLiRjb25zdHJ1Y3RpbmdPYmplY3RzLS07XG4gICAgICAgIHJldHVybiBnO1xuICAgIH1cbiAgICBnZXRJdGVtQnlJZChpdGVtSWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGl0ZW1zQnlJZFtpdGVtSWRdO1xuICAgIH1cbiAgICBnZXRJdGVtQnlOYW1lKHJlc05hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGl0ZW1zQnlOYW1lW3Jlc05hbWVdO1xuICAgIH1cbiAgICBnZXRJdGVtQXNzZXRCeU5hbWUocmVzTmFtZSkge1xuICAgICAgICBsZXQgcGkgPSB0aGlzLiRpdGVtc0J5TmFtZVtyZXNOYW1lXTtcbiAgICAgICAgaWYgKHBpID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFJlc291cmNlICcke3Jlc05hbWV9JyBub3QgZm91bmRgKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SXRlbUFzc2V0KHBpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogdG9kb1xuICAgICAqL1xuICAgIGNyZWF0ZVNwcml0ZVRleHR1cmUoY2ZnTmFtZSwgY2ZnKSB7XG4gICAgICAgIGxldCBhdGxhc0l0ZW0gPSB0aGlzLiRpdGVtc0J5SWRbY2ZnLmF0bGFzTmFtZV07XG4gICAgICAgIGlmIChhdGxhc0l0ZW0gIT0gbnVsbCkge1xuICAgICAgICAgICAgbGV0IGF0bGFzVGV4dHVyZSA9IHRoaXMuZ2V0SXRlbUFzc2V0KGF0bGFzSXRlbSk7XG4gICAgICAgICAgICBpZiAoIWF0bGFzVGV4dHVyZSlcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIGlmICghY2ZnLnRleENhY2hlSUQpIHtcbiAgICAgICAgICAgICAgICBjZmcudGV4Q2FjaGVJRCA9IGAke3RoaXMuJHJlc0tleX1AJHtjZmcuYXRsYXNOYW1lfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgdGV4ID0gVXRpbHMuVGV4dHVyZUNhY2hlW2NmZy50ZXhDYWNoZUlEXTtcbiAgICAgICAgICAgIC8vdG9kbyBhZGQgdG8gY2FjaGVcbiAgICAgICAgICAgIGlmICghdGV4KSB7XG4gICAgICAgICAgICAgICAgdGV4ID0ge1xuICAgICAgICAgICAgICAgICAgICBpbWFnZTogYXRsYXNUZXh0dXJlLFxuICAgICAgICAgICAgICAgICAgICByZWN0OiBjZmcuZnJhbWVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRleDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgZ2V0SXRlbUFzc2V0KGl0ZW0pIHtcbiAgICAgICAgc3dpdGNoIChpdGVtLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgMCAvKiBJbWFnZSAqLzpcbiAgICAgICAgICAgICAgICBpZiAoIWl0ZW0uZGVjb2RlZCkge1xuICAgICAgICAgICAgICAgICAgICBpdGVtLmRlY29kZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBsZXQgY2ZnID0gdGhpcy4kYXRsYXNDb25maWdzW2l0ZW0uaWRdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2ZnICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnRleHR1cmUgPSB0aGlzLmNyZWF0ZVNwcml0ZVRleHR1cmUoaXRlbS5pZCwgY2ZnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0udGV4dHVyZTtcbiAgICAgICAgICAgIGNhc2UgNyAvKiBBdGxhcyAqLzpcbiAgICAgICAgICAgICAgICBpZiAoIWl0ZW0uZGVjb2RlZCkge1xuICAgICAgICAgICAgICAgICAgICBpdGVtLmRlY29kZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBsZXQgZmlsZU5hbWUgPSBpdGVtLmZpbGUgIT0gbnVsbCAmJiBpdGVtLmZpbGUubGVuZ3RoID4gMCA/IGl0ZW0uZmlsZSA6IGAke2l0ZW0uaWR9LnBuZ2A7XG4gICAgICAgICAgICAgICAgICAgIGxldCByZXNOYW1lID0gYCR7dGhpcy4kcmVzS2V5fUAke1N0cmluZ1V0aWwuZ2V0RmlsZU5hbWUoZmlsZU5hbWUpfWA7XG4gICAgICAgICAgICAgICAgICAgIGxldCB0ZXh0dXJlID0gQXNzZXRMb2FkZXIucmVzb3VyY2VzUG9vbFtyZXNOYW1lXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0ZXh0dXJlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7cmVzTmFtZX0gbm90IGZvdW5kIGluIGZndWkuQXNzZXRMb2FkZXIucmVzb3VyY2VzUG9vbCwgcGxlYXNlIGxvYWQgYXNzZXRzIGZpcnN0IWApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0udGV4dHVyZSA9IHRleHR1cmU7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXRlbS50ZXh0dXJlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0dXJlID0gQXNzZXRMb2FkZXIucmVzb3VyY2VzUG9vbFtgJHt0aGlzLiRyZXNLZXl9QCR7ZmlsZU5hbWUucmVwbGFjZSgnLicsICdfJyl9YF07XG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnRleHR1cmUgPSB0ZXh0dXJlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnRleHR1cmU7XG4gICAgICAgICAgICBjYXNlIDMgLyogU291bmQgKi86XG4gICAgICAgICAgICAgICAgaWYgKCFpdGVtLmRlY29kZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5kZWNvZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkQXVkaW8oaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnNvdW5kO1xuICAgICAgICAgICAgY2FzZSA2IC8qIEZvbnQgKi86XG4gICAgICAgICAgICAgICAgaWYgKCFpdGVtLmRlY29kZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5kZWNvZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkRm9udChpdGVtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uYml0bWFwRm9udDtcbiAgICAgICAgICAgIGNhc2UgMiAvKiBNb3ZpZUNsaXAgKi86XG4gICAgICAgICAgICAgICAgaWYgKCFpdGVtLmRlY29kZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5kZWNvZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkTW92aWVDbGlwKGl0ZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5mcmFtZXM7XG4gICAgICAgICAgICBjYXNlIDQgLyogQ29tcG9uZW50ICovOlxuICAgICAgICAgICAgICAgIGlmICghaXRlbS5kZWNvZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uZGVjb2RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGxldCBzdHIgPSB0aGlzLmdldFJlc0Rlc2NyaXB0b3IoYCR7aXRlbS5pZH0ueG1sYCk7XG4gICAgICAgICAgICAgICAgICAgIGxldCB4bWwgPSBYbWxQYXJzZXIudHJ5UGFyc2Uoc3RyKTtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5jb21wb25lbnREYXRhID0geG1sO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWRDb21wb25lbnRDaGlsZHJlbihpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkQ29tcG9uZW50VHJhbnNsYXRpb24oaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmNvbXBvbmVudERhdGE7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBBc3NldExvYWRlci5yZXNvdXJjZXNQb29sW2Ake3RoaXMuJHJlc0tleX1AJHtpdGVtLmlkfWBdO1xuICAgICAgICB9XG4gICAgfVxuICAgIGxvYWRDb21wb25lbnRDaGlsZHJlbihpdGVtKSB7XG4gICAgICAgIGxldCBsaXN0Tm9kZSA9IFhtbFBhcnNlci5nZXRDaGlsZE5vZGVzKGl0ZW0uY29tcG9uZW50RGF0YSwgJ2Rpc3BsYXlMaXN0Jyk7XG4gICAgICAgIGlmIChsaXN0Tm9kZSAhPSBudWxsICYmIGxpc3ROb2RlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGl0ZW0uZGlzcGxheUxpc3QgPSBbXTtcbiAgICAgICAgICAgIGxpc3ROb2RlWzBdLmNoaWxkcmVuLmZvckVhY2goY3htbCA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHRhZ05hbWUgPSBjeG1sLm5vZGVOYW1lO1xuICAgICAgICAgICAgICAgIGxldCBkaTtcbiAgICAgICAgICAgICAgICBsZXQgc3JjID0gY3htbC5hdHRyaWJ1dGVzLnNyYztcbiAgICAgICAgICAgICAgICBpZiAoc3JjKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBwa2dJZCA9IGN4bWwuYXR0cmlidXRlcy5wa2c7XG4gICAgICAgICAgICAgICAgICAgIGxldCBwa2c7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwa2dJZCAmJiBwa2dJZCAhPSBpdGVtLm93bmVyLmlkKVxuICAgICAgICAgICAgICAgICAgICAgICAgcGtnID0gVUlQYWNrYWdlLmdldEJ5SWQocGtnSWQpO1xuICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICBwa2cgPSBpdGVtLm93bmVyO1xuICAgICAgICAgICAgICAgICAgICBsZXQgcGkgPSBwa2cgIT0gbnVsbCA/IHBrZy5nZXRJdGVtQnlJZChzcmMpIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBpICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBkaSA9IG5ldyBEaXNwbGF5TGlzdEl0ZW0ocGksIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICBkaSA9IG5ldyBEaXNwbGF5TGlzdEl0ZW0obnVsbCwgdGFnTmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGFnTmFtZSA9PSAndGV4dCcgJiYgY3htbC5hdHRyaWJ1dGVzLmlucHV0ID09ICd0cnVlJylcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpID0gbmV3IERpc3BsYXlMaXN0SXRlbShudWxsLCAnaW5wdXR0ZXh0Jyk7XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpID0gbmV3IERpc3BsYXlMaXN0SXRlbShudWxsLCB0YWdOYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGkuZGVzYyA9IGN4bWw7XG4gICAgICAgICAgICAgICAgaXRlbS5kaXNwbGF5TGlzdC5wdXNoKGRpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGl0ZW0uZGlzcGxheUxpc3QgPSBbXTtcbiAgICB9XG4gICAgZ2V0UmVzRGVzY3JpcHRvcihmbikge1xuICAgICAgICByZXR1cm4gdGhpcy4kcmVzRGF0YVtmbl07XG4gICAgfVxuICAgIGxvYWRDb21wb25lbnRUcmFuc2xhdGlvbihpdGVtKSB7XG4gICAgICAgIGlmIChVSVBhY2thZ2UuJHN0cmluZ3NTb3VyY2UgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbGV0IHN0cmluZ3MgPSBVSVBhY2thZ2UuJHN0cmluZ3NTb3VyY2VbdGhpcy5pZCArIGl0ZW0uaWRdO1xuICAgICAgICBpZiAoc3RyaW5ncyA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBsZXQgdmFsdWU7XG4gICAgICAgIGxldCBjeG1sLCBkeG1sO1xuICAgICAgICBsZXQgZW5hbWU7XG4gICAgICAgIGxldCBlbGVtZW50SWQ7XG4gICAgICAgIGxldCBzdHI7XG4gICAgICAgIGl0ZW0uZGlzcGxheUxpc3QuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgIGN4bWwgPSBpdGVtLmRlc2M7XG4gICAgICAgICAgICBlbmFtZSA9IGN4bWwubm9kZU5hbWU7XG4gICAgICAgICAgICBlbGVtZW50SWQgPSBjeG1sLmF0dHJpYnV0ZXMuaWQ7XG4gICAgICAgICAgICBzdHIgPSBjeG1sLmF0dHJpYnV0ZXMudG9vbHRpcHM7XG4gICAgICAgICAgICBpZiAoc3RyKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBzdHJpbmdzW2Ake2VsZW1lbnRJZH0tdGlwc2BdO1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgIGN4bWwuYXR0cmlidXRlcy50b29sdGlwcyA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGNzID0gWG1sUGFyc2VyLmdldENoaWxkTm9kZXMoY3htbCwgJ2dlYXJUZXh0Jyk7XG4gICAgICAgICAgICBkeG1sID0gY3MgJiYgY3NbMF07XG4gICAgICAgICAgICBpZiAoZHhtbCkge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gc3RyaW5nc1tgJHtlbGVtZW50SWR9LXRleHRzYF07XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgZHhtbC5hdHRyaWJ1dGVzLnZhbHVlcyA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIHZhbHVlID0gc3RyaW5nc1tgJHtlbGVtZW50SWR9LXRleHRzX2RlZmBdO1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgIGR4bWwuYXR0cmlidXRlcy5kZWZhdWx0ID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZW5hbWUgPT0gJ3RleHQnIHx8IGVuYW1lID09ICdyaWNodGV4dCcpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHN0cmluZ3NbZWxlbWVudElkXTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICBjeG1sLmF0dHJpYnV0ZXMudGV4dCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIHZhbHVlID0gc3RyaW5nc1tgJHtlbGVtZW50SWR9LXByb21wdGBdO1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgIGN4bWwuYXR0cmlidXRlcy5wcm9tcHQgPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGVuYW1lID09ICdsaXN0Jykge1xuICAgICAgICAgICAgICAgIGN4bWwuY2hpbGRyZW4uZm9yRWFjaCgoZXhtbCwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV4bWwubm9kZU5hbWUgIT0gJ2l0ZW0nKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHN0cmluZ3NbYCR7ZWxlbWVudElkfS0ke2luZGV4fWBdO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgZXhtbC5hdHRyaWJ1dGVzLnRpdGxlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChlbmFtZSA9PSAnY29tcG9uZW50Jykge1xuICAgICAgICAgICAgICAgIGNzID0gWG1sUGFyc2VyLmdldENoaWxkTm9kZXMoY3htbCwgJ0J1dHRvbicpO1xuICAgICAgICAgICAgICAgIGR4bWwgPSBjcyAmJiBjc1swXTtcbiAgICAgICAgICAgICAgICBpZiAoZHhtbCkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHN0cmluZ3NbZWxlbWVudElkXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgICAgIGR4bWwuYXR0cmlidXRlcy50aXRsZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHN0cmluZ3NbYCR7ZWxlbWVudElkfS0wYF07XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgICAgICBkeG1sLmF0dHJpYnV0ZXMuc2VsZWN0ZWRUaXRsZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNzID0gWG1sUGFyc2VyLmdldENoaWxkTm9kZXMoY3htbCwgJ0xhYmVsJyk7XG4gICAgICAgICAgICAgICAgZHhtbCA9IGNzICYmIGNzWzBdO1xuICAgICAgICAgICAgICAgIGlmIChkeG1sKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gc3RyaW5nc1tlbGVtZW50SWRdO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgZHhtbC5hdHRyaWJ1dGVzLnRpdGxlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY3MgPSBYbWxQYXJzZXIuZ2V0Q2hpbGROb2RlcyhjeG1sLCAnQ29tYm9Cb3gnKTtcbiAgICAgICAgICAgICAgICBkeG1sID0gY3MgJiYgY3NbMF07XG4gICAgICAgICAgICAgICAgaWYgKGR4bWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBzdHJpbmdzW2VsZW1lbnRJZF07XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgICAgICBkeG1sLmF0dHJpYnV0ZXMudGl0bGUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgZHhtbC5jaGlsZHJlbi5mb3JFYWNoKChleG1sLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4bWwubm9kZU5hbWUgIT0gJ2l0ZW0nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gc3RyaW5nc1tgJHtlbGVtZW50SWR9LSR7aW5kZXh9YF07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4bWwuYXR0cmlidXRlcy50aXRsZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGxvYWRNb3ZpZUNsaXAoaXRlbSkge1xuICAgICAgICBsZXQgeG1sID0gWG1sUGFyc2VyLnRyeVBhcnNlKHRoaXMuZ2V0UmVzRGVzY3JpcHRvcihgJHtpdGVtLmlkfS54bWxgKSk7XG4gICAgICAgIGxldCBzdHI7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmludGVydmFsO1xuICAgICAgICBpZiAoc3RyICE9IG51bGwpXG4gICAgICAgICAgICBpdGVtLmludGVydmFsID0gcGFyc2VJbnQoc3RyKTtcbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMuc3dpbmc7XG4gICAgICAgIGlmIChzdHIgIT0gbnVsbClcbiAgICAgICAgICAgIGl0ZW0uc3dpbmcgPSBzdHIgPT0gJ3RydWUnO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5yZXBlYXREZWxheTtcbiAgICAgICAgaWYgKHN0ciAhPSBudWxsKVxuICAgICAgICAgICAgaXRlbS5yZXBlYXREZWxheSA9IHBhcnNlSW50KHN0cik7XG4gICAgICAgIGl0ZW0uZnJhbWVzID0gW107XG4gICAgICAgIGxldCBmcmFtZU5vZGVzID0geG1sLmNoaWxkcmVuWzBdLmNoaWxkcmVuO1xuICAgICAgICBmcmFtZU5vZGVzLmZvckVhY2goKG5vZGUsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBsZXQgZnJhbWUgPSBuZXcgRnJhbWUoKTtcbiAgICAgICAgICAgIHN0ciA9IG5vZGUuYXR0cmlidXRlcy5yZWN0O1xuICAgICAgICAgICAgbGV0IGFyciA9IHN0ci5zcGxpdChVSVBhY2thZ2Uuc2VwMCk7XG4gICAgICAgICAgICBsZXQgdHJpbVJlY3QgPSBuZXcgY3JlYXRlanMuUmVjdGFuZ2xlKHBhcnNlSW50KGFyclswXSksIHBhcnNlSW50KGFyclsxXSksIHBhcnNlSW50KGFyclsyXSksIHBhcnNlSW50KGFyclszXSkpO1xuICAgICAgICAgICAgc3RyID0gbm9kZS5hdHRyaWJ1dGVzLmFkZERlbGF5O1xuICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICBmcmFtZS5hZGREZWxheSA9IHBhcnNlSW50KHN0cik7XG4gICAgICAgICAgICBpdGVtLmZyYW1lcy5wdXNoKGZyYW1lKTtcbiAgICAgICAgICAgIGlmICh0cmltUmVjdC53aWR0aCA8PSAwKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIHN0ciA9IG5vZGUuYXR0cmlidXRlcy5zcHJpdGU7XG4gICAgICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgICAgIHN0ciA9IGAke2l0ZW0uaWR9XyR7c3RyfWA7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgc3RyID0gYCR7aXRlbS5pZH1fJHtpbmRleH1gO1xuICAgICAgICAgICAgbGV0IGNmZyA9IHRoaXMuJGF0bGFzQ29uZmlnc1tzdHJdO1xuICAgICAgICAgICAgaWYgKGNmZyAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgZnJhbWUudGV4dHVyZSA9IHRoaXMuY3JlYXRlU3ByaXRlVGV4dHVyZShzdHIsIGNmZyk7XG4gICAgICAgICAgICAgICAgZnJhbWUudGV4dHVyZS50cmltID0gdHJpbVJlY3Q7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBsb2FkRm9udChpdGVtKSB7XG4gICAgICAgIGxldCBmb250ID0gbmV3IEJpdG1hcEZvbnQoKTtcbiAgICAgICAgZm9udC5pZCA9IGB1aTovLyR7dGhpcy5pZH0ke2l0ZW0uaWR9YDtcbiAgICAgICAgbGV0IHN0ciA9IHRoaXMuZ2V0UmVzRGVzY3JpcHRvcihgJHtpdGVtLmlkfS5mbnRgKTtcbiAgICAgICAgbGV0IGxpbmVzID0gc3RyLnNwbGl0KFVJUGFja2FnZS5zZXAxKTtcbiAgICAgICAgbGV0IGt2ID0ge307XG4gICAgICAgIGxldCB0dGYgPSBmYWxzZTtcbiAgICAgICAgbGV0IHNpemUgPSAwO1xuICAgICAgICBsZXQgeGFkdmFuY2UgPSAwO1xuICAgICAgICBsZXQgcmVzaXphYmxlID0gZmFsc2U7XG4gICAgICAgIGxldCBjb2xvcmFibGUgPSBmYWxzZTtcbiAgICAgICAgbGV0IGF0bGFzT2Zmc2V0WCA9IDAsIGF0bGFzT2Zmc2V0WSA9IDA7XG4gICAgICAgIGxldCBjaGFySW1nO1xuICAgICAgICBsZXQgbWFpblRleHR1cmU7XG4gICAgICAgIGxldCBsaW5lSGVpZ2h0ID0gMDtcbiAgICAgICAgbGV0IG1heENoYXJIZWlnaHQgPSAwO1xuICAgICAgICBsaW5lcy5mb3JFYWNoKGxpbmUgPT4ge1xuICAgICAgICAgICAgaWYgKGxpbmUgJiYgbGluZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBzdHIgPSBTdHJpbmdVdGlsLnRyaW0obGluZSk7XG4gICAgICAgICAgICAgICAgbGV0IGFyciA9IHN0ci5zcGxpdChVSVBhY2thZ2Uuc2VwMik7XG4gICAgICAgICAgICAgICAgYXJyLmZvckVhY2godiA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBhdCA9IHYuc3BsaXQoVUlQYWNrYWdlLnNlcDMpO1xuICAgICAgICAgICAgICAgICAgICBrdlthdFswXV0gPSBhdFsxXTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzdHIgPSBhcnJbMF07XG4gICAgICAgICAgICAgICAgaWYgKHN0ciA9PSAnY2hhcicpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGJnID0gbmV3IEJNR2x5cGgoKTtcbiAgICAgICAgICAgICAgICAgICAgYmcueCA9IHBhcnNlSW50KGt2LngpIHx8IDA7XG4gICAgICAgICAgICAgICAgICAgIGJnLnkgPSBwYXJzZUludChrdi55KSB8fCAwO1xuICAgICAgICAgICAgICAgICAgICBiZy5vZmZzZXRYID0gcGFyc2VJbnQoa3YueG9mZnNldCkgfHwgMDtcbiAgICAgICAgICAgICAgICAgICAgYmcub2Zmc2V0WSA9IHBhcnNlSW50KGt2LnlvZmZzZXQpIHx8IDA7XG4gICAgICAgICAgICAgICAgICAgIGJnLndpZHRoID0gcGFyc2VJbnQoa3Yud2lkdGgpIHx8IDA7XG4gICAgICAgICAgICAgICAgICAgIGJnLmhlaWdodCA9IHBhcnNlSW50KGt2LmhlaWdodCkgfHwgMDtcbiAgICAgICAgICAgICAgICAgICAgbWF4Q2hhckhlaWdodCA9IE1hdGgubWF4KGJnLmhlaWdodCwgbWF4Q2hhckhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIGJnLmFkdmFuY2UgPSBwYXJzZUludChrdi54YWR2YW5jZSkgfHwgMDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGt2LmNobmwgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiZy5jaGFubmVsID0gcGFyc2VJbnQoa3YuY2hubCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmcuY2hhbm5lbCA9PSAxNSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZy5jaGFubmVsID0gNDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJnLmNoYW5uZWwgPT0gMSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZy5jaGFubmVsID0gMztcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJnLmNoYW5uZWwgPT0gMilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZy5jaGFubmVsID0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZy5jaGFubmVsID0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoIXR0Zikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGt2LmltZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJJbWcgPSB0aGlzLiRpdGVtc0J5SWRba3YuaW1nXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hhckltZyAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJJbWcubG9hZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZy53aWR0aCA9IGNoYXJJbWcud2lkdGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJnLmhlaWdodCA9IGNoYXJJbWcuaGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZy50ZXh0dXJlID0gY2hhckltZy50ZXh0dXJlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChtYWluVGV4dHVyZSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWJnLnRleHR1cmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZy50ZXh0dXJlID0geyBpbWFnZTogbWFpblRleHR1cmUsIHJlY3Q6IHt9IH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBiZy50ZXh0dXJlLnJlY3QgPSBuZXcgY3JlYXRlanMuUmVjdGFuZ2xlKGJnLnggKyBhdGxhc09mZnNldFgsIGJnLnkgKyBhdGxhc09mZnNldFksIGJnLndpZHRoLCBiZy5oZWlnaHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0dGYpXG4gICAgICAgICAgICAgICAgICAgICAgICBiZy5saW5lSGVpZ2h0ID0gbGluZUhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmcuYWR2YW5jZSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHhhZHZhbmNlID09IDApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJnLmFkdmFuY2UgPSBiZy5vZmZzZXRYICsgYmcud2lkdGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZy5hZHZhbmNlID0geGFkdmFuY2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBiZy5saW5lSGVpZ2h0ID0gYmcub2Zmc2V0WSA8IDAgPyBiZy5oZWlnaHQgOiBiZy5vZmZzZXRZICsgYmcuaGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNpemUgPiAwICYmIGJnLmxpbmVIZWlnaHQgPCBzaXplKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJnLmxpbmVIZWlnaHQgPSBzaXplO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZvbnQuZ2x5cGhzW1N0cmluZy5mcm9tQ2hhckNvZGUoK2t2LmlkIHwgMCldID0gYmc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHN0ciA9PSAnaW5mbycpIHtcbiAgICAgICAgICAgICAgICAgICAgdHRmID0ga3YuZmFjZSAhPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBpZiAoa3Yuc2l6ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemUgPSBwYXJzZUludChrdi5zaXplKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzaXphYmxlID0ga3YucmVzaXphYmxlID09ICd0cnVlJztcbiAgICAgICAgICAgICAgICAgICAgY29sb3JhYmxlID0ga3YuY29sb3JlZCA9PSAndHJ1ZSc7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0dGYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjZmcgPSB0aGlzLiRhdGxhc0NvbmZpZ3NbaXRlbS5pZF07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2ZnICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdGxhc09mZnNldFggPSBjZmcuZnJhbWUueDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdGxhc09mZnNldFkgPSBjZmcuZnJhbWUueTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgYXRsYXNJdGVtID0gdGhpcy4kaXRlbXNCeUlkW2NmZy5hdGxhc05hbWVdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdGxhc0l0ZW0gIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpblRleHR1cmUgPSB0aGlzLmdldEl0ZW1Bc3NldChhdGxhc0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHN0ciA9PSAnY29tbW9uJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoa3YubGluZUhlaWdodClcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQgPSBwYXJzZUludChrdi5saW5lSGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNpemUgPT0gMClcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemUgPSBsaW5lSGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChsaW5lSGVpZ2h0ID09IDApXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0ID0gc2l6ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGt2LnhhZHZhbmNlKVxuICAgICAgICAgICAgICAgICAgICAgICAgeGFkdmFuY2UgPSBwYXJzZUludChrdi54YWR2YW5jZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHNpemUgPT0gMCAmJiBtYXhDaGFySGVpZ2h0ID4gMClcbiAgICAgICAgICAgIHNpemUgPSBtYXhDaGFySGVpZ2h0O1xuICAgICAgICBmb250LnR0ZiA9IHR0ZjtcbiAgICAgICAgZm9udC5zaXplID0gc2l6ZTtcbiAgICAgICAgZm9udC5yZXNpemFibGUgPSByZXNpemFibGU7XG4gICAgICAgIGZvbnQuY29sb3JhYmxlID0gY29sb3JhYmxlO1xuICAgICAgICBpdGVtLmJpdG1hcEZvbnQgPSBmb250O1xuICAgIH1cbiAgICBsb2FkQXVkaW8oaXRlbSkge1xuICAgICAgICBsZXQgZmlsZU5hbWUgPSBpdGVtLmZpbGUgIT0gbnVsbCAmJiBpdGVtLmZpbGUubGVuZ3RoID4gMCA/IGl0ZW0uZmlsZSA6IGAke2l0ZW0uaWR9Lm1wM2A7XG4gICAgICAgIGxldCByZXNOYW1lID0gYCR7dGhpcy4kcmVzS2V5fUAke1N0cmluZ1V0aWwuZ2V0RmlsZU5hbWUoZmlsZU5hbWUpfWA7XG4gICAgICAgIGxldCBzb3VuZCA9IEFzc2V0TG9hZGVyLnJlc291cmNlc1Bvb2xbcmVzTmFtZV07XG4gICAgICAgIGlmIChzb3VuZCkge1xuICAgICAgICAgICAgaXRlbS5zb3VuZCA9IGNyZWF0ZWpzLlNvdW5kLnBsYXkocmVzTmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJlc291cmNlICdcIiArIGl0ZW0uZmlsZSArIFwiJyBub3QgZm91bmQsIHBsZWFzZSBsb2FkTWFuaWZlc3QgZmlyc3QhXCIpO1xuICAgICAgICB9XG4gICAgfVxufVxuLyoqQGludGVybmFsICovXG5VSVBhY2thZ2UuJGNvbnN0cnVjdGluZ09iamVjdHMgPSAwO1xuVUlQYWNrYWdlLiRwYWNrYWdlSW5zdEJ5SWQgPSB7fTtcblVJUGFja2FnZS4kcGFja2FnZUluc3RCeU5hbWUgPSB7fTtcblVJUGFja2FnZS4kYml0bWFwRm9udHMgPSB7fTtcblVJUGFja2FnZS4kc3RyaW5nc1NvdXJjZSA9IG51bGw7XG5VSVBhY2thZ2Uuc2VwMCA9ICcsJztcblVJUGFja2FnZS5zZXAxID0gJ1xcbic7XG5VSVBhY2thZ2Uuc2VwMiA9ICcgJztcblVJUGFja2FnZS5zZXAzID0gJz0nO1xubGV0IERlY2xzID0ge307XG5cbmNsYXNzIEdlYXJMb29rIGV4dGVuZHMgR2VhckJhc2Uge1xuICAgIGNvbnN0cnVjdG9yKG93bmVyKSB7XG4gICAgICAgIHN1cGVyKG93bmVyKTtcbiAgICB9XG4gICAgaW5pdCgpIHtcbiAgICAgICAgdGhpcy4kZGVmYXVsdCA9IG5ldyBHZWFyTG9va1ZhbHVlKHRoaXMuJG93bmVyLmFscGhhLCB0aGlzLiRvd25lci5yb3RhdGlvbiwgdGhpcy4kb3duZXIuZ3JheWVkKTtcbiAgICAgICAgdGhpcy4kc3RvcmFnZSA9IHt9O1xuICAgIH1cbiAgICBhZGRTdGF0dXMocGFnZUlkLCB2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgPT0gJy0nKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBsZXQgYXJyID0gdmFsdWUuc3BsaXQoJywnKTtcbiAgICAgICAgbGV0IGd2O1xuICAgICAgICBpZiAocGFnZUlkID09IG51bGwpXG4gICAgICAgICAgICBndiA9IHRoaXMuJGRlZmF1bHQ7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZ3YgPSBuZXcgR2Vhckxvb2tWYWx1ZSgpO1xuICAgICAgICAgICAgdGhpcy4kc3RvcmFnZVtwYWdlSWRdID0gZ3Y7XG4gICAgICAgIH1cbiAgICAgICAgZ3YuYWxwaGEgPSBwYXJzZUZsb2F0KGFyclswXSk7XG4gICAgICAgIGd2LnJvdGF0aW9uID0gcGFyc2VJbnQoYXJyWzFdKTtcbiAgICAgICAgZ3YuZ3JheWVkID0gYXJyWzJdID09ICcxJyA/IHRydWUgOiBmYWxzZTtcbiAgICB9XG4gICAgYXBwbHkoKSB7XG4gICAgICAgIGxldCBndiA9IHRoaXMuJHN0b3JhZ2VbdGhpcy4kY29udHJvbGxlci5zZWxlY3RlZFBhZ2VJZF07XG4gICAgICAgIGlmICghZ3YpXG4gICAgICAgICAgICBndiA9IHRoaXMuJGRlZmF1bHQ7XG4gICAgICAgIGlmICh0aGlzLiR0d2VlbiAmJiAhVUlQYWNrYWdlLiRjb25zdHJ1Y3RpbmdPYmplY3RzICYmICFHZWFyQmFzZS5kaXNhYmxlQWxsVHdlZW5FZmZlY3QpIHtcbiAgICAgICAgICAgIHRoaXMuJG93bmVyLiRnZWFyTG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuJG93bmVyLmdyYXllZCA9IGd2LmdyYXllZDtcbiAgICAgICAgICAgIHRoaXMuJG93bmVyLiRnZWFyTG9ja2VkID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy4kdHdlZW5lcikge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiR0d2VlblRhcmdldC5hbHBoYSA9PT0gZ3YuYWxwaGEgJiYgdGhpcy4kdHdlZW5UYXJnZXQucm90YXRpb24gPT09IGd2LnJvdGF0aW9uKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5lci5nb3RvQW5kU3RvcCh0aGlzLiR0d2VlbmVyLmR1cmF0aW9uKTsgLy9zZXQgdG8gZW5kXG4gICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5lciA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgYSA9IGd2LmFscGhhICE9IHRoaXMuJG93bmVyLmFscGhhO1xuICAgICAgICAgICAgbGV0IGIgPSBndi5yb3RhdGlvbiAhPSB0aGlzLiRvd25lci5yb3RhdGlvbjtcbiAgICAgICAgICAgIGlmIChhIHx8IGIpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kb3duZXIuaGFzR2VhckNvbnRyb2xsZXIoMCwgdGhpcy4kY29udHJvbGxlcikpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGxvY2tUb2tlbiA9IHRoaXMuJG93bmVyLmxvY2tHZWFyRGlzcGxheSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuVGFyZ2V0ID0gZ3Y7XG4gICAgICAgICAgICAgICAgbGV0IHZhcnMgPSB7XG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRvd25lci4kZ2VhckxvY2tlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRvd25lci5hbHBoYSA9IHRoaXMuJHR3ZWVuVmFsdWUueDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJG93bmVyLnJvdGF0aW9uID0gdGhpcy4kdHdlZW5WYWx1ZS55O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kb3duZXIuJGdlYXJMb2NrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJHR3ZWVuVmFsdWUgPT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5WYWx1ZSA9IG5ldyBjcmVhdGVqcy5Qb2ludCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuVmFsdWUueCA9IHRoaXMuJG93bmVyLmFscGhhO1xuICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuVmFsdWUueSA9IHRoaXMuJG93bmVyLnJvdGF0aW9uO1xuICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuZXIgPSBjcmVhdGVqcy5Ud2Vlbi5nZXQodGhpcy4kdHdlZW5WYWx1ZSwgdmFycylcbiAgICAgICAgICAgICAgICAgICAgLndhaXQodGhpcy4kdHdlZW5EZWxheSAqIDEwMDApXG4gICAgICAgICAgICAgICAgICAgIC50byh7IHg6IGd2LmFscGhhLCB5OiBndi5yb3RhdGlvbiB9LCB0aGlzLiR0d2VlblRpbWUgKiAxMDAwLCB0aGlzLiRlYXNlVHlwZSlcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwodGhpcy50d2VlbkNvbXBsZXRlLCBudWxsLCB0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuJG93bmVyLiRnZWFyTG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuJG93bmVyLmdyYXllZCA9IGd2LmdyYXllZDtcbiAgICAgICAgICAgIHRoaXMuJG93bmVyLmFscGhhID0gZ3YuYWxwaGE7XG4gICAgICAgICAgICB0aGlzLiRvd25lci5yb3RhdGlvbiA9IGd2LnJvdGF0aW9uO1xuICAgICAgICAgICAgdGhpcy4kb3duZXIuJGdlYXJMb2NrZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB0d2VlbkNvbXBsZXRlKCkge1xuICAgICAgICBpZiAodGhpcy4kbG9ja1Rva2VuICE9IDApIHtcbiAgICAgICAgICAgIHRoaXMuJG93bmVyLnJlbGVhc2VHZWFyRGlzcGxheSh0aGlzLiRsb2NrVG9rZW4pO1xuICAgICAgICAgICAgdGhpcy4kbG9ja1Rva2VuID0gMDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiR0d2VlbmVyID0gbnVsbDtcbiAgICAgICAgbGV0IGV2dCA9IG5ldyBjcmVhdGVqcy5FdmVudChcIl9fZ2VhclN0b3BcIiAvKiBHRUFSX1NUT1AgKi8sIHRydWUsIGZhbHNlKTtcbiAgICAgICAgdGhpcy4kb3duZXIuZGlzcGF0Y2hFdmVudChldnQsIHRoaXMpO1xuICAgIH1cbiAgICB1cGRhdGVTdGF0ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuJGNvbnRyb2xsZXIgPT0gbnVsbCB8fCB0aGlzLiRvd25lci4kZ2VhckxvY2tlZCB8fCB0aGlzLiRvd25lci4kaW5Qcm9ncmVzc0J1aWxkaW5nKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBsZXQgZ3YgPSB0aGlzLiRzdG9yYWdlW3RoaXMuJGNvbnRyb2xsZXIuc2VsZWN0ZWRQYWdlSWRdO1xuICAgICAgICBpZiAoIWd2KSB7XG4gICAgICAgICAgICBndiA9IG5ldyBHZWFyTG9va1ZhbHVlKCk7XG4gICAgICAgICAgICB0aGlzLiRzdG9yYWdlW3RoaXMuJGNvbnRyb2xsZXIuc2VsZWN0ZWRQYWdlSWRdID0gZ3Y7XG4gICAgICAgIH1cbiAgICAgICAgZ3YuYWxwaGEgPSB0aGlzLiRvd25lci5hbHBoYTtcbiAgICAgICAgZ3Yucm90YXRpb24gPSB0aGlzLiRvd25lci5yb3RhdGlvbjtcbiAgICAgICAgZ3YuZ3JheWVkID0gdGhpcy4kb3duZXIuZ3JheWVkO1xuICAgIH1cbn1cbmNsYXNzIEdlYXJMb29rVmFsdWUge1xuICAgIGNvbnN0cnVjdG9yKGFscGhhID0gMCwgcm90YXRpb24gPSAwLCBncmF5ZWQgPSBmYWxzZSkge1xuICAgICAgICB0aGlzLmFscGhhID0gYWxwaGE7XG4gICAgICAgIHRoaXMucm90YXRpb24gPSByb3RhdGlvbjtcbiAgICAgICAgdGhpcy5ncmF5ZWQgPSBncmF5ZWQ7XG4gICAgfVxufVxuXG5jbGFzcyBHZWFyU2l6ZSBleHRlbmRzIEdlYXJCYXNlIHtcbiAgICBjb25zdHJ1Y3Rvcihvd25lcikge1xuICAgICAgICBzdXBlcihvd25lcik7XG4gICAgfVxuICAgIGluaXQoKSB7XG4gICAgICAgIHRoaXMuJGRlZmF1bHQgPSBuZXcgR2VhclNpemVWYWx1ZSh0aGlzLiRvd25lci53aWR0aCwgdGhpcy4kb3duZXIuaGVpZ2h0LCB0aGlzLiRvd25lci5zY2FsZVgsIHRoaXMuJG93bmVyLnNjYWxlWSk7XG4gICAgICAgIHRoaXMuJHN0b3JhZ2UgPSB7fTtcbiAgICB9XG4gICAgYWRkU3RhdHVzKHBhZ2VJZCwgdmFsdWUpIHtcbiAgICAgICAgaWYgKHZhbHVlID09ICctJylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbGV0IGFyciA9IHZhbHVlLnNwbGl0KCcsJyk7XG4gICAgICAgIGxldCBndjtcbiAgICAgICAgaWYgKHBhZ2VJZCA9PSBudWxsKVxuICAgICAgICAgICAgZ3YgPSB0aGlzLiRkZWZhdWx0O1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGd2ID0gbmV3IEdlYXJTaXplVmFsdWUoKTtcbiAgICAgICAgICAgIHRoaXMuJHN0b3JhZ2VbcGFnZUlkXSA9IGd2O1xuICAgICAgICB9XG4gICAgICAgIGd2LndpZHRoID0gcGFyc2VJbnQoYXJyWzBdKTtcbiAgICAgICAgZ3YuaGVpZ2h0ID0gcGFyc2VJbnQoYXJyWzFdKTtcbiAgICAgICAgaWYgKGFyci5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgICBndi5zY2FsZVggPSBwYXJzZUZsb2F0KGFyclsyXSk7XG4gICAgICAgICAgICBndi5zY2FsZVkgPSBwYXJzZUZsb2F0KGFyclszXSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXBwbHkoKSB7XG4gICAgICAgIGxldCBndiA9IHRoaXMuJHN0b3JhZ2VbdGhpcy4kY29udHJvbGxlci5zZWxlY3RlZFBhZ2VJZF07XG4gICAgICAgIGlmICghZ3YpXG4gICAgICAgICAgICBndiA9IHRoaXMuJGRlZmF1bHQ7XG4gICAgICAgIGlmICh0aGlzLiR0d2VlbiAmJiAhVUlQYWNrYWdlLiRjb25zdHJ1Y3RpbmdPYmplY3RzICYmICFHZWFyQmFzZS5kaXNhYmxlQWxsVHdlZW5FZmZlY3QpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiR0d2VlbmVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJHR3ZWVuVGFyZ2V0LndpZHRoICE9IGd2LndpZHRoIHx8XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuVGFyZ2V0LmhlaWdodCAhPSBndi5oZWlnaHQgfHxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5UYXJnZXQuc2NhbGVYICE9IGd2LnNjYWxlWCB8fFxuICAgICAgICAgICAgICAgICAgICB0aGlzLiR0d2VlblRhcmdldC5zY2FsZVkgIT0gZ3Yuc2NhbGVZKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuZXIuZ290b0FuZFN0b3AodGhpcy4kdHdlZW5lci5kdXJhdGlvbik7IC8vc2V0IHRvIGVuZFxuICAgICAgICAgICAgICAgICAgICB0aGlzLiR0d2VlbmVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgYSA9IGd2LndpZHRoICE9IHRoaXMuJG93bmVyLndpZHRoIHx8IGd2LmhlaWdodCAhPSB0aGlzLiRvd25lci5oZWlnaHQ7XG4gICAgICAgICAgICBsZXQgYiA9IGd2LnNjYWxlWCAhPSB0aGlzLiRvd25lci5zY2FsZVggfHwgZ3Yuc2NhbGVZICE9IHRoaXMuJG93bmVyLnNjYWxlWTtcbiAgICAgICAgICAgIGlmIChhIHx8IGIpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kb3duZXIuaGFzR2VhckNvbnRyb2xsZXIoMCwgdGhpcy4kY29udHJvbGxlcikpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGxvY2tUb2tlbiA9IHRoaXMuJG93bmVyLmxvY2tHZWFyRGlzcGxheSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuVGFyZ2V0ID0gZ3Y7XG4gICAgICAgICAgICAgICAgbGV0IHZhcnMgPSB7XG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRvd25lci4kZ2VhckxvY2tlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRvd25lci5zZXRTaXplKHRoaXMuJHR3ZWVuVmFsdWUud2lkdGgsIHRoaXMuJHR3ZWVuVmFsdWUuaGVpZ2h0LCB0aGlzLiRvd25lci5nZWFyWFkuY29udHJvbGxlciA9PSB0aGlzLiRjb250cm9sbGVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJG93bmVyLnNldFNjYWxlKHRoaXMuJHR3ZWVuVmFsdWUuc2NhbGVYLCB0aGlzLiR0d2VlblZhbHVlLnNjYWxlWSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRvd25lci4kZ2VhckxvY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kdHdlZW5WYWx1ZSA9PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiR0d2VlblZhbHVlID0gbmV3IEdlYXJTaXplVmFsdWUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLiR0d2VlblZhbHVlLndpZHRoID0gdGhpcy4kb3duZXIud2lkdGg7XG4gICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5WYWx1ZS5oZWlnaHQgPSB0aGlzLiRvd25lci5oZWlnaHQ7XG4gICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5WYWx1ZS5zY2FsZVggPSB0aGlzLiRvd25lci5zY2FsZVg7XG4gICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5WYWx1ZS5zY2FsZVkgPSB0aGlzLiRvd25lci5zY2FsZVk7XG4gICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5lciA9IGNyZWF0ZWpzLlR3ZWVuLmdldCh0aGlzLiR0d2VlblZhbHVlLCB2YXJzKVxuICAgICAgICAgICAgICAgICAgICAud2FpdCh0aGlzLiR0d2VlbkRlbGF5ICogMTAwMClcbiAgICAgICAgICAgICAgICAgICAgLnRvKHsgd2lkdGg6IGd2LndpZHRoLCBoZWlnaHQ6IGd2LmhlaWdodCwgc2NhbGVYOiBndi5zY2FsZVgsIHNjYWxlWTogZ3Yuc2NhbGVZIH0sIHRoaXMuJHR3ZWVuVGltZSAqIDEwMDAsIHRoaXMuJGVhc2VUeXBlKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbCh0aGlzLnR3ZWVuQ29tcGxldGUsIG51bGwsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy4kb3duZXIuJGdlYXJMb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy4kb3duZXIuc2V0U2l6ZShndi53aWR0aCwgZ3YuaGVpZ2h0LCB0aGlzLiRvd25lci5nZWFyWFkuY29udHJvbGxlciA9PSB0aGlzLiRjb250cm9sbGVyKTtcbiAgICAgICAgICAgIHRoaXMuJG93bmVyLnNldFNjYWxlKGd2LnNjYWxlWCwgZ3Yuc2NhbGVZKTtcbiAgICAgICAgICAgIHRoaXMuJG93bmVyLiRnZWFyTG9ja2VkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdHdlZW5Db21wbGV0ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuJGxvY2tUb2tlbiAhPSAwKSB7XG4gICAgICAgICAgICB0aGlzLiRvd25lci5yZWxlYXNlR2VhckRpc3BsYXkodGhpcy4kbG9ja1Rva2VuKTtcbiAgICAgICAgICAgIHRoaXMuJGxvY2tUb2tlbiA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kdHdlZW5lciA9IG51bGw7XG4gICAgICAgIGxldCBldnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoXCJfX2dlYXJTdG9wXCIgLyogR0VBUl9TVE9QICovLCB0cnVlLCBmYWxzZSk7XG4gICAgICAgIHRoaXMuJG93bmVyLmRpc3BhdGNoRXZlbnQoZXZ0LCB0aGlzKTtcbiAgICB9XG4gICAgdXBkYXRlU3RhdGUoKSB7XG4gICAgICAgIGlmICh0aGlzLiRjb250cm9sbGVyID09IG51bGwgfHwgdGhpcy4kb3duZXIuJGdlYXJMb2NrZWQgfHwgdGhpcy4kb3duZXIuJGluUHJvZ3Jlc3NCdWlsZGluZylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbGV0IGd2ID0gdGhpcy4kc3RvcmFnZVt0aGlzLiRjb250cm9sbGVyLnNlbGVjdGVkUGFnZUlkXTtcbiAgICAgICAgaWYgKCFndikge1xuICAgICAgICAgICAgZ3YgPSBuZXcgR2VhclNpemVWYWx1ZSgpO1xuICAgICAgICAgICAgdGhpcy4kc3RvcmFnZVt0aGlzLiRjb250cm9sbGVyLnNlbGVjdGVkUGFnZUlkXSA9IGd2O1xuICAgICAgICB9XG4gICAgICAgIGd2LndpZHRoID0gdGhpcy4kb3duZXIud2lkdGg7XG4gICAgICAgIGd2LmhlaWdodCA9IHRoaXMuJG93bmVyLmhlaWdodDtcbiAgICAgICAgZ3Yuc2NhbGVYID0gdGhpcy4kb3duZXIuc2NhbGVYO1xuICAgICAgICBndi5zY2FsZVkgPSB0aGlzLiRvd25lci5zY2FsZVk7XG4gICAgfVxuICAgIHVwZGF0ZUZyb21SZWxhdGlvbnMoZHgsIGR5KSB7XG4gICAgICAgIGlmICh0aGlzLiRjb250cm9sbGVyID09IG51bGwgfHwgdGhpcy4kc3RvcmFnZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBmb3IgKGxldCBrZXkgaW4gdGhpcy4kc3RvcmFnZSkge1xuICAgICAgICAgICAgbGV0IGd2ID0gdGhpcy4kc3RvcmFnZVtrZXldO1xuICAgICAgICAgICAgZ3Yud2lkdGggKz0gZHg7XG4gICAgICAgICAgICBndi5oZWlnaHQgKz0gZHk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kZGVmYXVsdC53aWR0aCArPSBkeDtcbiAgICAgICAgdGhpcy4kZGVmYXVsdC5oZWlnaHQgKz0gZHk7XG4gICAgICAgIHRoaXMudXBkYXRlU3RhdGUoKTtcbiAgICB9XG59XG5jbGFzcyBHZWFyU2l6ZVZhbHVlIHtcbiAgICBjb25zdHJ1Y3Rvcih3aWR0aCA9IDAsIGhlaWdodCA9IDAsIHNjYWxlWCA9IDAsIHNjYWxlWSA9IDApIHtcbiAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoO1xuICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgdGhpcy5zY2FsZVggPSBzY2FsZVg7XG4gICAgICAgIHRoaXMuc2NhbGVZID0gc2NhbGVZO1xuICAgIH1cbn1cblxuY2xhc3MgR2VhclhZIGV4dGVuZHMgR2VhckJhc2Uge1xuICAgIGNvbnN0cnVjdG9yKG93bmVyKSB7XG4gICAgICAgIHN1cGVyKG93bmVyKTtcbiAgICB9XG4gICAgaW5pdCgpIHtcbiAgICAgICAgdGhpcy4kZGVmYXVsdCA9IG5ldyBjcmVhdGVqcy5Qb2ludCh0aGlzLiRvd25lci54LCB0aGlzLiRvd25lci55KTtcbiAgICAgICAgdGhpcy4kc3RvcmFnZSA9IHt9O1xuICAgIH1cbiAgICBhZGRTdGF0dXMocGFnZUlkLCB2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgPT0gJy0nKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBsZXQgYXJyID0gdmFsdWUuc3BsaXQoJywnKTtcbiAgICAgICAgbGV0IHB0O1xuICAgICAgICBpZiAocGFnZUlkID09IG51bGwpXG4gICAgICAgICAgICBwdCA9IHRoaXMuJGRlZmF1bHQ7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcHQgPSBuZXcgY3JlYXRlanMuUG9pbnQoKTtcbiAgICAgICAgICAgIHRoaXMuJHN0b3JhZ2VbcGFnZUlkXSA9IHB0O1xuICAgICAgICB9XG4gICAgICAgIHB0LnggPSBwYXJzZUludChhcnJbMF0pO1xuICAgICAgICBwdC55ID0gcGFyc2VJbnQoYXJyWzFdKTtcbiAgICB9XG4gICAgYXBwbHkoKSB7XG4gICAgICAgIGxldCBwdCA9IHRoaXMuJHN0b3JhZ2VbdGhpcy4kY29udHJvbGxlci5zZWxlY3RlZFBhZ2VJZF07XG4gICAgICAgIGlmICghcHQpXG4gICAgICAgICAgICBwdCA9IHRoaXMuJGRlZmF1bHQ7XG4gICAgICAgIGlmICh0aGlzLiR0d2VlbiAmJiAhVUlQYWNrYWdlLiRjb25zdHJ1Y3RpbmdPYmplY3RzICYmICFHZWFyQmFzZS5kaXNhYmxlQWxsVHdlZW5FZmZlY3QpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiR0d2VlbmVyKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJHR3ZWVuVGFyZ2V0LnggPT09IHB0LnggJiYgdGhpcy4kdHdlZW5UYXJnZXQueSA9PT0gcHQueSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuZXIuZ290b0FuZFN0b3AodGhpcy4kdHdlZW5lci5kdXJhdGlvbik7IC8vc2V0IHRvIGVuZFxuICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuZXIgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuJG93bmVyLnggIT0gcHQueCB8fCB0aGlzLiRvd25lci55ICE9IHB0LnkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRvd25lci5oYXNHZWFyQ29udHJvbGxlcigwLCB0aGlzLiRjb250cm9sbGVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLiRsb2NrVG9rZW4gPSB0aGlzLiRvd25lci5sb2NrR2VhckRpc3BsYXkoKTtcbiAgICAgICAgICAgICAgICB0aGlzLiR0d2VlblRhcmdldCA9IHB0O1xuICAgICAgICAgICAgICAgIGxldCB2YXJzID0ge1xuICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kb3duZXIuJGdlYXJMb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kb3duZXIuc2V0WFkodGhpcy4kdHdlZW5WYWx1ZS54LCB0aGlzLiR0d2VlblZhbHVlLnkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kb3duZXIuJGdlYXJMb2NrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJHR3ZWVuVmFsdWUgPT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5WYWx1ZSA9IG5ldyBjcmVhdGVqcy5Qb2ludCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuVmFsdWUueCA9IHRoaXMuJG93bmVyLng7XG4gICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5WYWx1ZS55ID0gdGhpcy4kb3duZXIueTtcbiAgICAgICAgICAgICAgICB0aGlzLiR0d2VlbmVyID0gY3JlYXRlanMuVHdlZW4uZ2V0KHRoaXMuJHR3ZWVuVmFsdWUsIHZhcnMpXG4gICAgICAgICAgICAgICAgICAgIC53YWl0KHRoaXMuJHR3ZWVuRGVsYXkgKiAxMDAwKVxuICAgICAgICAgICAgICAgICAgICAudG8oeyB4OiBwdC54LCB5OiBwdC55IH0sIHRoaXMuJHR3ZWVuVGltZSAqIDEwMDAsIHRoaXMuJGVhc2VUeXBlKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbCh0aGlzLnR3ZWVuQ29tcGxldGUsIG51bGwsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy4kb3duZXIuJGdlYXJMb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy4kb3duZXIuc2V0WFkocHQueCwgcHQueSk7XG4gICAgICAgICAgICB0aGlzLiRvd25lci4kZ2VhckxvY2tlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHR3ZWVuQ29tcGxldGUoKSB7XG4gICAgICAgIGlmICh0aGlzLiRsb2NrVG9rZW4gIT0gMCkge1xuICAgICAgICAgICAgdGhpcy4kb3duZXIucmVsZWFzZUdlYXJEaXNwbGF5KHRoaXMuJGxvY2tUb2tlbik7XG4gICAgICAgICAgICB0aGlzLiRsb2NrVG9rZW4gPSAwO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuJHR3ZWVuZXIgPSBudWxsO1xuICAgICAgICBsZXQgZXZ0ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KFwiX19nZWFyU3RvcFwiIC8qIEdFQVJfU1RPUCAqLywgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICB0aGlzLiRvd25lci5kaXNwYXRjaEV2ZW50KGV2dCwgdGhpcyk7XG4gICAgfVxuICAgIHVwZGF0ZVN0YXRlKCkge1xuICAgICAgICBpZiAodGhpcy4kY29udHJvbGxlciA9PSBudWxsIHx8IHRoaXMuJG93bmVyLiRnZWFyTG9ja2VkIHx8IHRoaXMuJG93bmVyLiRpblByb2dyZXNzQnVpbGRpbmcpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGxldCBwdCA9IHRoaXMuJHN0b3JhZ2VbdGhpcy4kY29udHJvbGxlci5zZWxlY3RlZFBhZ2VJZF07XG4gICAgICAgIGlmICghcHQpIHtcbiAgICAgICAgICAgIHB0ID0gbmV3IGNyZWF0ZWpzLlBvaW50KCk7XG4gICAgICAgICAgICB0aGlzLiRzdG9yYWdlW3RoaXMuJGNvbnRyb2xsZXIuc2VsZWN0ZWRQYWdlSWRdID0gcHQ7XG4gICAgICAgIH1cbiAgICAgICAgcHQueCA9IHRoaXMuJG93bmVyLng7XG4gICAgICAgIHB0LnkgPSB0aGlzLiRvd25lci55O1xuICAgIH1cbiAgICB1cGRhdGVGcm9tUmVsYXRpb25zKGR4LCBkeSkge1xuICAgICAgICBpZiAodGhpcy4kY29udHJvbGxlciA9PSBudWxsIHx8IHRoaXMuJHN0b3JhZ2UgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgZm9yIChsZXQga2V5IGluIHRoaXMuJHN0b3JhZ2UpIHtcbiAgICAgICAgICAgIGxldCBwdCA9IHRoaXMuJHN0b3JhZ2Vba2V5XTtcbiAgICAgICAgICAgIHB0LnggKz0gZHg7XG4gICAgICAgICAgICBwdC55ICs9IGR5O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuJGRlZmF1bHQueCArPSBkeDtcbiAgICAgICAgdGhpcy4kZGVmYXVsdC55ICs9IGR5O1xuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKCk7XG4gICAgfVxufVxuXG5sZXQgaXNVSU9iamVjdCA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICByZXR1cm4gb2JqICYmICdVSU93bmVyJyBpbiBvYmogJiYgb2JqLlVJT3duZXIgIT0gbnVsbDtcbn07XG5cbmNsYXNzIFJlbGF0aW9uRGVmIHtcbiAgICBjb3B5RnJvbShzb3VyY2UpIHtcbiAgICAgICAgdGhpcy5wZXJjZW50ID0gc291cmNlLnBlcmNlbnQ7XG4gICAgICAgIHRoaXMudHlwZSA9IHNvdXJjZS50eXBlO1xuICAgIH1cbn1cbmNsYXNzIFJlbGF0aW9uSXRlbSB7XG4gICAgY29uc3RydWN0b3Iob3duZXIpIHtcbiAgICAgICAgdGhpcy4kb3duZXIgPSBvd25lcjtcbiAgICAgICAgdGhpcy4kZGVmcyA9IFtdO1xuICAgIH1cbiAgICBnZXQgb3duZXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRvd25lcjtcbiAgICB9XG4gICAgc2V0IHRhcmdldCh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kdGFyZ2V0ICE9IHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy4kdGFyZ2V0KVxuICAgICAgICAgICAgICAgIHRoaXMucmVsZWFzZVJlZlRhcmdldCh0aGlzLiR0YXJnZXQpO1xuICAgICAgICAgICAgdGhpcy4kdGFyZ2V0ID0gdmFsdWU7XG4gICAgICAgICAgICBpZiAodGhpcy4kdGFyZ2V0KVxuICAgICAgICAgICAgICAgIHRoaXMuYWRkUmVmVGFyZ2V0KHRoaXMuJHRhcmdldCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHRhcmdldCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHRhcmdldDtcbiAgICB9XG4gICAgYWRkKHJlbGF0aW9uVHlwZSwgdXNlUGVyY2VudCkge1xuICAgICAgICBpZiAocmVsYXRpb25UeXBlID09IDI0IC8qIFNpemUgKi8pIHtcbiAgICAgICAgICAgIHRoaXMuYWRkKDE0IC8qIFdpZHRoICovLCB1c2VQZXJjZW50KTtcbiAgICAgICAgICAgIHRoaXMuYWRkKDE1IC8qIEhlaWdodCAqLywgdXNlUGVyY2VudCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGxlbmd0aCA9IHRoaXMuJGRlZnMubGVuZ3RoO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgZGVmID0gdGhpcy4kZGVmc1tpXTtcbiAgICAgICAgICAgIGlmIChkZWYudHlwZSA9PSByZWxhdGlvblR5cGUpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW50ZXJuYWxBZGQocmVsYXRpb25UeXBlLCB1c2VQZXJjZW50KTtcbiAgICB9XG4gICAgaW50ZXJuYWxBZGQocmVsYXRpb25UeXBlLCB1c2VQZXJjZW50KSB7XG4gICAgICAgIGlmIChyZWxhdGlvblR5cGUgPT0gMjQgLyogU2l6ZSAqLykge1xuICAgICAgICAgICAgdGhpcy5pbnRlcm5hbEFkZCgxNCAvKiBXaWR0aCAqLywgdXNlUGVyY2VudCk7XG4gICAgICAgICAgICB0aGlzLmludGVybmFsQWRkKDE1IC8qIEhlaWdodCAqLywgdXNlUGVyY2VudCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGluZm8gPSBuZXcgUmVsYXRpb25EZWYoKTtcbiAgICAgICAgaW5mby5wZXJjZW50ID0gdXNlUGVyY2VudDtcbiAgICAgICAgaW5mby50eXBlID0gcmVsYXRpb25UeXBlO1xuICAgICAgICB0aGlzLiRkZWZzLnB1c2goaW5mbyk7XG4gICAgICAgIC8vQ0VOVEVSIHJlbGF0aW9uIHdpbGwgY2F1c2UgZmxvYXQgcGl4ZWwsIHNvIGVuYWJsZSB0aGUgYXV0by1waXhlbC1zbmFwcGluZyBoZXJlXG4gICAgICAgIGlmICh1c2VQZXJjZW50IHx8XG4gICAgICAgICAgICByZWxhdGlvblR5cGUgPT0gMSAvKiBMZWZ0X0NlbnRlciAqLyB8fFxuICAgICAgICAgICAgcmVsYXRpb25UeXBlID09IDMgLyogQ2VudGVyX0NlbnRlciAqLyB8fFxuICAgICAgICAgICAgcmVsYXRpb25UeXBlID09IDUgLyogUmlnaHRfQ2VudGVyICovIHx8XG4gICAgICAgICAgICByZWxhdGlvblR5cGUgPT0gOCAvKiBUb3BfTWlkZGxlICovIHx8XG4gICAgICAgICAgICByZWxhdGlvblR5cGUgPT0gMTAgLyogTWlkZGxlX01pZGRsZSAqLyB8fFxuICAgICAgICAgICAgcmVsYXRpb25UeXBlID09IDEyIC8qIEJvdHRvbV9NaWRkbGUgKi8pIHtcbiAgICAgICAgICAgIHRoaXMuJG93bmVyLnBpeGVsU25hcHBpbmcgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbW92ZShyZWxhdGlvblR5cGUgPSAwKSB7XG4gICAgICAgIGlmIChyZWxhdGlvblR5cGUgPT0gMjQgLyogU2l6ZSAqLykge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmUoMTQgLyogV2lkdGggKi8pO1xuICAgICAgICAgICAgdGhpcy5yZW1vdmUoMTUgLyogSGVpZ2h0ICovKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgZGMgPSB0aGlzLiRkZWZzLmxlbmd0aDtcbiAgICAgICAgZm9yIChsZXQgayA9IGRjIC0gMTsgayA+PSAwOyBrLS0pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRkZWZzW2tdLnR5cGUgPT0gcmVsYXRpb25UeXBlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kZGVmcy5zcGxpY2UoaywgMSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29weUZyb20oc291cmNlKSB7XG4gICAgICAgIHRoaXMudGFyZ2V0ID0gc291cmNlLnRhcmdldDtcbiAgICAgICAgdGhpcy4kZGVmcy5sZW5ndGggPSAwO1xuICAgICAgICBzb3VyY2UuJGRlZnMuZm9yRWFjaChpbmZvID0+IHtcbiAgICAgICAgICAgIGxldCBpbmZvMiA9IG5ldyBSZWxhdGlvbkRlZigpO1xuICAgICAgICAgICAgaW5mbzIuY29weUZyb20oaW5mbyk7XG4gICAgICAgICAgICB0aGlzLiRkZWZzLnB1c2goaW5mbzIpO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICB9XG4gICAgZGlzcG9zZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuJHRhcmdldCAhPSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLnJlbGVhc2VSZWZUYXJnZXQodGhpcy4kdGFyZ2V0KTtcbiAgICAgICAgICAgIHRoaXMuJHRhcmdldCA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRkZWZzLmxlbmd0aCA9PSAwO1xuICAgIH1cbiAgICBhcHBseU9uU2VsZlJlc2l6ZWQoZFdpZHRoLCBkSGVpZ2h0KSB7XG4gICAgICAgIGxldCBveCA9IHRoaXMuJG93bmVyLng7XG4gICAgICAgIGxldCBveSA9IHRoaXMuJG93bmVyLnk7XG4gICAgICAgIHRoaXMuJGRlZnMuZm9yRWFjaChpbmZvID0+IHtcbiAgICAgICAgICAgIHN3aXRjaCAoaW5mby50eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAzIC8qIENlbnRlcl9DZW50ZXIgKi86XG4gICAgICAgICAgICAgICAgY2FzZSA1IC8qIFJpZ2h0X0NlbnRlciAqLzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kb3duZXIueCAtPSBkV2lkdGggLyAyO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDQgLyogUmlnaHRfTGVmdCAqLzpcbiAgICAgICAgICAgICAgICBjYXNlIDYgLyogUmlnaHRfUmlnaHQgKi86XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJG93bmVyLnggLT0gZFdpZHRoO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDEwIC8qIE1pZGRsZV9NaWRkbGUgKi86XG4gICAgICAgICAgICAgICAgY2FzZSAxMiAvKiBCb3R0b21fTWlkZGxlICovOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRvd25lci55IC09IGRIZWlnaHQgLyAyO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDExIC8qIEJvdHRvbV9Ub3AgKi86XG4gICAgICAgICAgICAgICAgY2FzZSAxMyAvKiBCb3R0b21fQm90dG9tICovOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRvd25lci55IC09IGRIZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgaWYgKG94ICE9IHRoaXMuJG93bmVyLnggfHwgb3kgIT0gdGhpcy4kb3duZXIueSkge1xuICAgICAgICAgICAgb3ggPSB0aGlzLiRvd25lci54IC0gb3g7XG4gICAgICAgICAgICBveSA9IHRoaXMuJG93bmVyLnkgLSBveTtcbiAgICAgICAgICAgIHRoaXMuJG93bmVyLnVwZGF0ZUdlYXJGcm9tUmVsYXRpb25zKDEgLyogWFkgKi8sIG94LCBveSk7XG4gICAgICAgICAgICBpZiAodGhpcy4kb3duZXIucGFyZW50ICE9IG51bGwgJiYgdGhpcy4kb3duZXIucGFyZW50LiR0cmFuc2l0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kb3duZXIucGFyZW50LiR0cmFuc2l0aW9ucy5mb3JFYWNoKHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0LnVwZGF0ZUZyb21SZWxhdGlvbnModGhpcy4kb3duZXIuaWQsIG94LCBveSk7XG4gICAgICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXBwbHlPblhZQ2hhbmdlZChpbmZvLCBkeCwgZHkpIHtcbiAgICAgICAgbGV0IHRtcDtcbiAgICAgICAgc3dpdGNoIChpbmZvLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgMCAvKiBMZWZ0X0xlZnQgKi86XG4gICAgICAgICAgICBjYXNlIDEgLyogTGVmdF9DZW50ZXIgKi86XG4gICAgICAgICAgICBjYXNlIDIgLyogTGVmdF9SaWdodCAqLzpcbiAgICAgICAgICAgIGNhc2UgMyAvKiBDZW50ZXJfQ2VudGVyICovOlxuICAgICAgICAgICAgY2FzZSA0IC8qIFJpZ2h0X0xlZnQgKi86XG4gICAgICAgICAgICBjYXNlIDUgLyogUmlnaHRfQ2VudGVyICovOlxuICAgICAgICAgICAgY2FzZSA2IC8qIFJpZ2h0X1JpZ2h0ICovOlxuICAgICAgICAgICAgICAgIHRoaXMuJG93bmVyLnggKz0gZHg7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDcgLyogVG9wX1RvcCAqLzpcbiAgICAgICAgICAgIGNhc2UgOCAvKiBUb3BfTWlkZGxlICovOlxuICAgICAgICAgICAgY2FzZSA5IC8qIFRvcF9Cb3R0b20gKi86XG4gICAgICAgICAgICBjYXNlIDEwIC8qIE1pZGRsZV9NaWRkbGUgKi86XG4gICAgICAgICAgICBjYXNlIDExIC8qIEJvdHRvbV9Ub3AgKi86XG4gICAgICAgICAgICBjYXNlIDEyIC8qIEJvdHRvbV9NaWRkbGUgKi86XG4gICAgICAgICAgICBjYXNlIDEzIC8qIEJvdHRvbV9Cb3R0b20gKi86XG4gICAgICAgICAgICAgICAgdGhpcy4kb3duZXIueSArPSBkeTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMTQgLyogV2lkdGggKi86XG4gICAgICAgICAgICBjYXNlIDE1IC8qIEhlaWdodCAqLzpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMTYgLyogTGVmdEV4dF9MZWZ0ICovOlxuICAgICAgICAgICAgY2FzZSAxNyAvKiBMZWZ0RXh0X1JpZ2h0ICovOlxuICAgICAgICAgICAgICAgIHRtcCA9IHRoaXMuJG93bmVyLng7XG4gICAgICAgICAgICAgICAgdGhpcy4kb3duZXIueCArPSBkeDtcbiAgICAgICAgICAgICAgICB0aGlzLiRvd25lci53aWR0aCA9IHRoaXMuJG93bmVyLiRyYXdXaWR0aCAtICh0aGlzLiRvd25lci54IC0gdG1wKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMTggLyogUmlnaHRFeHRfTGVmdCAqLzpcbiAgICAgICAgICAgIGNhc2UgMTkgLyogUmlnaHRFeHRfUmlnaHQgKi86XG4gICAgICAgICAgICAgICAgdGhpcy4kb3duZXIud2lkdGggPSB0aGlzLiRvd25lci4kcmF3V2lkdGggKyBkeDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMjAgLyogVG9wRXh0X1RvcCAqLzpcbiAgICAgICAgICAgIGNhc2UgMjEgLyogVG9wRXh0X0JvdHRvbSAqLzpcbiAgICAgICAgICAgICAgICB0bXAgPSB0aGlzLiRvd25lci55O1xuICAgICAgICAgICAgICAgIHRoaXMuJG93bmVyLnkgKz0gZHk7XG4gICAgICAgICAgICAgICAgdGhpcy4kb3duZXIuaGVpZ2h0ID0gdGhpcy4kb3duZXIuJHJhd0hlaWdodCAtICh0aGlzLiRvd25lci55IC0gdG1wKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMjIgLyogQm90dG9tRXh0X1RvcCAqLzpcbiAgICAgICAgICAgIGNhc2UgMjMgLyogQm90dG9tRXh0X0JvdHRvbSAqLzpcbiAgICAgICAgICAgICAgICB0aGlzLiRvd25lci5oZWlnaHQgPSB0aGlzLiRvd25lci4kcmF3SGVpZ2h0ICsgZHk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXBwbHlPblNpemVDaGFuZ2VkKGluZm8pIHtcbiAgICAgICAgbGV0IHRhcmdldFgsIHRhcmdldFk7XG4gICAgICAgIGlmICh0aGlzLiR0YXJnZXQgIT0gdGhpcy4kb3duZXIucGFyZW50KSB7XG4gICAgICAgICAgICB0YXJnZXRYID0gdGhpcy4kdGFyZ2V0Lng7XG4gICAgICAgICAgICB0YXJnZXRZID0gdGhpcy4kdGFyZ2V0Lnk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0YXJnZXRYID0gMDtcbiAgICAgICAgICAgIHRhcmdldFkgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGxldCB2LCB0bXA7XG4gICAgICAgIHN3aXRjaCAoaW5mby50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIDAgLyogTGVmdF9MZWZ0ICovOlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAxIC8qIExlZnRfQ2VudGVyICovOlxuICAgICAgICAgICAgICAgIHYgPSB0aGlzLiRvd25lci54IC0gKHRhcmdldFggKyB0aGlzLiR0YXJnZXRXaWR0aCAvIDIpO1xuICAgICAgICAgICAgICAgIGlmIChpbmZvLnBlcmNlbnQpXG4gICAgICAgICAgICAgICAgICAgIHYgPSAodiAvIHRoaXMuJHRhcmdldFdpZHRoKSAqIHRoaXMuJHRhcmdldC4kcmF3V2lkdGg7XG4gICAgICAgICAgICAgICAgdGhpcy4kb3duZXIueCA9IHRhcmdldFggKyB0aGlzLiR0YXJnZXQuJHJhd1dpZHRoIC8gMiArIHY7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDIgLyogTGVmdF9SaWdodCAqLzpcbiAgICAgICAgICAgICAgICB2ID0gdGhpcy4kb3duZXIueCAtICh0YXJnZXRYICsgdGhpcy4kdGFyZ2V0V2lkdGgpO1xuICAgICAgICAgICAgICAgIGlmIChpbmZvLnBlcmNlbnQpXG4gICAgICAgICAgICAgICAgICAgIHYgPSAodiAvIHRoaXMuJHRhcmdldFdpZHRoKSAqIHRoaXMuJHRhcmdldC4kcmF3V2lkdGg7XG4gICAgICAgICAgICAgICAgdGhpcy4kb3duZXIueCA9IHRhcmdldFggKyB0aGlzLiR0YXJnZXQuJHJhd1dpZHRoICsgdjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMyAvKiBDZW50ZXJfQ2VudGVyICovOlxuICAgICAgICAgICAgICAgIHYgPSB0aGlzLiRvd25lci54ICsgdGhpcy4kb3duZXIuJHJhd1dpZHRoIC8gMiAtICh0YXJnZXRYICsgdGhpcy4kdGFyZ2V0V2lkdGggLyAyKTtcbiAgICAgICAgICAgICAgICBpZiAoaW5mby5wZXJjZW50KVxuICAgICAgICAgICAgICAgICAgICB2ID0gKHYgLyB0aGlzLiR0YXJnZXRXaWR0aCkgKiB0aGlzLiR0YXJnZXQuJHJhd1dpZHRoO1xuICAgICAgICAgICAgICAgIHRoaXMuJG93bmVyLnggPSB0YXJnZXRYICsgdGhpcy4kdGFyZ2V0LiRyYXdXaWR0aCAvIDIgKyB2IC0gdGhpcy4kb3duZXIuJHJhd1dpZHRoIC8gMjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNCAvKiBSaWdodF9MZWZ0ICovOlxuICAgICAgICAgICAgICAgIHYgPSB0aGlzLiRvd25lci54ICsgdGhpcy4kb3duZXIuJHJhd1dpZHRoIC0gdGFyZ2V0WDtcbiAgICAgICAgICAgICAgICBpZiAoaW5mby5wZXJjZW50KVxuICAgICAgICAgICAgICAgICAgICB2ID0gKHYgLyB0aGlzLiR0YXJnZXRXaWR0aCkgKiB0aGlzLiR0YXJnZXQuJHJhd1dpZHRoO1xuICAgICAgICAgICAgICAgIHRoaXMuJG93bmVyLnggPSB0YXJnZXRYICsgdiAtIHRoaXMuJG93bmVyLiRyYXdXaWR0aDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNSAvKiBSaWdodF9DZW50ZXIgKi86XG4gICAgICAgICAgICAgICAgdiA9IHRoaXMuJG93bmVyLnggKyB0aGlzLiRvd25lci4kcmF3V2lkdGggLSAodGFyZ2V0WCArIHRoaXMuJHRhcmdldFdpZHRoIC8gMik7XG4gICAgICAgICAgICAgICAgaWYgKGluZm8ucGVyY2VudClcbiAgICAgICAgICAgICAgICAgICAgdiA9ICh2IC8gdGhpcy4kdGFyZ2V0V2lkdGgpICogdGhpcy4kdGFyZ2V0LiRyYXdXaWR0aDtcbiAgICAgICAgICAgICAgICB0aGlzLiRvd25lci54ID0gdGFyZ2V0WCArIHRoaXMuJHRhcmdldC4kcmF3V2lkdGggLyAyICsgdiAtIHRoaXMuJG93bmVyLiRyYXdXaWR0aDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNiAvKiBSaWdodF9SaWdodCAqLzpcbiAgICAgICAgICAgICAgICB2ID0gdGhpcy4kb3duZXIueCArIHRoaXMuJG93bmVyLiRyYXdXaWR0aCAtICh0YXJnZXRYICsgdGhpcy4kdGFyZ2V0V2lkdGgpO1xuICAgICAgICAgICAgICAgIGlmIChpbmZvLnBlcmNlbnQpXG4gICAgICAgICAgICAgICAgICAgIHYgPSAodiAvIHRoaXMuJHRhcmdldFdpZHRoKSAqIHRoaXMuJHRhcmdldC4kcmF3V2lkdGg7XG4gICAgICAgICAgICAgICAgdGhpcy4kb3duZXIueCA9IHRhcmdldFggKyB0aGlzLiR0YXJnZXQuJHJhd1dpZHRoICsgdiAtIHRoaXMuJG93bmVyLiRyYXdXaWR0aDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNyAvKiBUb3BfVG9wICovOlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA4IC8qIFRvcF9NaWRkbGUgKi86XG4gICAgICAgICAgICAgICAgdiA9IHRoaXMuJG93bmVyLnkgLSAodGFyZ2V0WSArIHRoaXMuJHRhcmdldEhlaWdodCAvIDIpO1xuICAgICAgICAgICAgICAgIGlmIChpbmZvLnBlcmNlbnQpXG4gICAgICAgICAgICAgICAgICAgIHYgPSAodiAvIHRoaXMuJHRhcmdldEhlaWdodCkgKiB0aGlzLiR0YXJnZXQuJHJhd0hlaWdodDtcbiAgICAgICAgICAgICAgICB0aGlzLiRvd25lci55ID0gdGFyZ2V0WSArIHRoaXMuJHRhcmdldC4kcmF3SGVpZ2h0IC8gMiArIHY7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDkgLyogVG9wX0JvdHRvbSAqLzpcbiAgICAgICAgICAgICAgICB2ID0gdGhpcy4kb3duZXIueSAtICh0YXJnZXRZICsgdGhpcy4kdGFyZ2V0SGVpZ2h0KTtcbiAgICAgICAgICAgICAgICBpZiAoaW5mby5wZXJjZW50KVxuICAgICAgICAgICAgICAgICAgICB2ID0gKHYgLyB0aGlzLiR0YXJnZXRIZWlnaHQpICogdGhpcy4kdGFyZ2V0LiRyYXdIZWlnaHQ7XG4gICAgICAgICAgICAgICAgdGhpcy4kb3duZXIueSA9IHRhcmdldFkgKyB0aGlzLiR0YXJnZXQuJHJhd0hlaWdodCArIHY7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDEwIC8qIE1pZGRsZV9NaWRkbGUgKi86XG4gICAgICAgICAgICAgICAgdiA9IHRoaXMuJG93bmVyLnkgKyB0aGlzLiRvd25lci4kcmF3SGVpZ2h0IC8gMiAtICh0YXJnZXRZICsgdGhpcy4kdGFyZ2V0SGVpZ2h0IC8gMik7XG4gICAgICAgICAgICAgICAgaWYgKGluZm8ucGVyY2VudClcbiAgICAgICAgICAgICAgICAgICAgdiA9ICh2IC8gdGhpcy4kdGFyZ2V0SGVpZ2h0KSAqIHRoaXMuJHRhcmdldC4kcmF3SGVpZ2h0O1xuICAgICAgICAgICAgICAgIHRoaXMuJG93bmVyLnkgPSB0YXJnZXRZICsgdGhpcy4kdGFyZ2V0LiRyYXdIZWlnaHQgLyAyICsgdiAtIHRoaXMuJG93bmVyLiRyYXdIZWlnaHQgLyAyO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAxMSAvKiBCb3R0b21fVG9wICovOlxuICAgICAgICAgICAgICAgIHYgPSB0aGlzLiRvd25lci55ICsgdGhpcy4kb3duZXIuJHJhd0hlaWdodCAtIHRhcmdldFk7XG4gICAgICAgICAgICAgICAgaWYgKGluZm8ucGVyY2VudClcbiAgICAgICAgICAgICAgICAgICAgdiA9ICh2IC8gdGhpcy4kdGFyZ2V0SGVpZ2h0KSAqIHRoaXMuJHRhcmdldC4kcmF3SGVpZ2h0O1xuICAgICAgICAgICAgICAgIHRoaXMuJG93bmVyLnkgPSB0YXJnZXRZICsgdiAtIHRoaXMuJG93bmVyLiRyYXdIZWlnaHQ7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDEyIC8qIEJvdHRvbV9NaWRkbGUgKi86XG4gICAgICAgICAgICAgICAgdiA9IHRoaXMuJG93bmVyLnkgKyB0aGlzLiRvd25lci4kcmF3SGVpZ2h0IC0gKHRhcmdldFkgKyB0aGlzLiR0YXJnZXRIZWlnaHQgLyAyKTtcbiAgICAgICAgICAgICAgICBpZiAoaW5mby5wZXJjZW50KVxuICAgICAgICAgICAgICAgICAgICB2ID0gKHYgLyB0aGlzLiR0YXJnZXRIZWlnaHQpICogdGhpcy4kdGFyZ2V0LiRyYXdIZWlnaHQ7XG4gICAgICAgICAgICAgICAgdGhpcy4kb3duZXIueSA9IHRhcmdldFkgKyB0aGlzLiR0YXJnZXQuJHJhd0hlaWdodCAvIDIgKyB2IC0gdGhpcy4kb3duZXIuJHJhd0hlaWdodDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMTMgLyogQm90dG9tX0JvdHRvbSAqLzpcbiAgICAgICAgICAgICAgICB2ID0gdGhpcy4kb3duZXIueSArIHRoaXMuJG93bmVyLiRyYXdIZWlnaHQgLSAodGFyZ2V0WSArIHRoaXMuJHRhcmdldEhlaWdodCk7XG4gICAgICAgICAgICAgICAgaWYgKGluZm8ucGVyY2VudClcbiAgICAgICAgICAgICAgICAgICAgdiA9ICh2IC8gdGhpcy4kdGFyZ2V0SGVpZ2h0KSAqIHRoaXMuJHRhcmdldC4kcmF3SGVpZ2h0O1xuICAgICAgICAgICAgICAgIHRoaXMuJG93bmVyLnkgPSB0YXJnZXRZICsgdGhpcy4kdGFyZ2V0LiRyYXdIZWlnaHQgKyB2IC0gdGhpcy4kb3duZXIuJHJhd0hlaWdodDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMTQgLyogV2lkdGggKi86XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJG93bmVyLiRpblByb2dyZXNzQnVpbGRpbmcgJiYgdGhpcy4kb3duZXIgPT0gdGhpcy4kdGFyZ2V0LnBhcmVudClcbiAgICAgICAgICAgICAgICAgICAgdiA9IHRoaXMuJG93bmVyLnNvdXJjZVdpZHRoIC0gdGhpcy4kdGFyZ2V0LiRpbml0V2lkdGg7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB2ID0gdGhpcy4kb3duZXIuJHJhd1dpZHRoIC0gdGhpcy4kdGFyZ2V0V2lkdGg7XG4gICAgICAgICAgICAgICAgaWYgKGluZm8ucGVyY2VudClcbiAgICAgICAgICAgICAgICAgICAgdiA9ICh2IC8gdGhpcy4kdGFyZ2V0V2lkdGgpICogdGhpcy4kdGFyZ2V0LiRyYXdXaWR0aDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kdGFyZ2V0ID09IHRoaXMuJG93bmVyLnBhcmVudClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kb3duZXIuc2V0U2l6ZSh0aGlzLiR0YXJnZXQuJHJhd1dpZHRoICsgdiwgdGhpcy4kb3duZXIuJHJhd0hlaWdodCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRvd25lci53aWR0aCA9IHRoaXMuJHRhcmdldC4kcmF3V2lkdGggKyB2O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAxNSAvKiBIZWlnaHQgKi86XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJG93bmVyLiRpblByb2dyZXNzQnVpbGRpbmcgJiYgdGhpcy4kb3duZXIgPT0gdGhpcy4kdGFyZ2V0LnBhcmVudClcbiAgICAgICAgICAgICAgICAgICAgdiA9IHRoaXMuJG93bmVyLnNvdXJjZUhlaWdodCAtIHRoaXMuJHRhcmdldC4kaW5pdEhlaWdodDtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHYgPSB0aGlzLiRvd25lci4kcmF3SGVpZ2h0IC0gdGhpcy4kdGFyZ2V0SGVpZ2h0O1xuICAgICAgICAgICAgICAgIGlmIChpbmZvLnBlcmNlbnQpXG4gICAgICAgICAgICAgICAgICAgIHYgPSAodiAvIHRoaXMuJHRhcmdldEhlaWdodCkgKiB0aGlzLiR0YXJnZXQuJHJhd0hlaWdodDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kdGFyZ2V0ID09IHRoaXMuJG93bmVyLnBhcmVudClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kb3duZXIuc2V0U2l6ZSh0aGlzLiRvd25lci4kcmF3V2lkdGgsIHRoaXMuJHRhcmdldC4kcmF3SGVpZ2h0ICsgdiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRvd25lci5oZWlnaHQgPSB0aGlzLiR0YXJnZXQuJHJhd0hlaWdodCArIHY7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDE2IC8qIExlZnRFeHRfTGVmdCAqLzpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMTcgLyogTGVmdEV4dF9SaWdodCAqLzpcbiAgICAgICAgICAgICAgICB2ID0gdGhpcy4kb3duZXIueCAtICh0YXJnZXRYICsgdGhpcy4kdGFyZ2V0V2lkdGgpO1xuICAgICAgICAgICAgICAgIGlmIChpbmZvLnBlcmNlbnQpXG4gICAgICAgICAgICAgICAgICAgIHYgPSAodiAvIHRoaXMuJHRhcmdldFdpZHRoKSAqIHRoaXMuJHRhcmdldC4kcmF3V2lkdGg7XG4gICAgICAgICAgICAgICAgdG1wID0gdGhpcy4kb3duZXIueDtcbiAgICAgICAgICAgICAgICB0aGlzLiRvd25lci54ID0gdGFyZ2V0WCArIHRoaXMuJHRhcmdldC4kcmF3V2lkdGggKyB2O1xuICAgICAgICAgICAgICAgIHRoaXMuJG93bmVyLndpZHRoID0gdGhpcy4kb3duZXIuJHJhd1dpZHRoIC0gKHRoaXMuJG93bmVyLnggLSB0bXApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAxOCAvKiBSaWdodEV4dF9MZWZ0ICovOlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAxOSAvKiBSaWdodEV4dF9SaWdodCAqLzpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kb3duZXIuJGluUHJvZ3Jlc3NCdWlsZGluZyAmJiB0aGlzLiRvd25lciA9PSB0aGlzLiR0YXJnZXQucGFyZW50KVxuICAgICAgICAgICAgICAgICAgICB2ID0gdGhpcy4kb3duZXIuc291cmNlV2lkdGggLSAodGFyZ2V0WCArIHRoaXMuJHRhcmdldC4kaW5pdFdpZHRoKTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHYgPSB0aGlzLiRvd25lci53aWR0aCAtICh0YXJnZXRYICsgdGhpcy4kdGFyZ2V0V2lkdGgpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRvd25lciAhPSB0aGlzLiR0YXJnZXQucGFyZW50KVxuICAgICAgICAgICAgICAgICAgICB2ICs9IHRoaXMuJG93bmVyLng7XG4gICAgICAgICAgICAgICAgaWYgKGluZm8ucGVyY2VudClcbiAgICAgICAgICAgICAgICAgICAgdiA9ICh2IC8gdGhpcy4kdGFyZ2V0V2lkdGgpICogdGhpcy4kdGFyZ2V0LiRyYXdXaWR0aDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kb3duZXIgIT0gdGhpcy4kdGFyZ2V0LnBhcmVudClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kb3duZXIud2lkdGggPSB0YXJnZXRYICsgdGhpcy4kdGFyZ2V0LiRyYXdXaWR0aCArIHYgLSB0aGlzLiRvd25lci54O1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kb3duZXIud2lkdGggPSB0YXJnZXRYICsgdGhpcy4kdGFyZ2V0LiRyYXdXaWR0aCArIHY7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDIwIC8qIFRvcEV4dF9Ub3AgKi86XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDIxIC8qIFRvcEV4dF9Cb3R0b20gKi86XG4gICAgICAgICAgICAgICAgdiA9IHRoaXMuJG93bmVyLnkgLSAodGFyZ2V0WSArIHRoaXMuJHRhcmdldEhlaWdodCk7XG4gICAgICAgICAgICAgICAgaWYgKGluZm8ucGVyY2VudClcbiAgICAgICAgICAgICAgICAgICAgdiA9ICh2IC8gdGhpcy4kdGFyZ2V0SGVpZ2h0KSAqIHRoaXMuJHRhcmdldC4kcmF3SGVpZ2h0O1xuICAgICAgICAgICAgICAgIHRtcCA9IHRoaXMuJG93bmVyLnk7XG4gICAgICAgICAgICAgICAgdGhpcy4kb3duZXIueSA9IHRhcmdldFkgKyB0aGlzLiR0YXJnZXQuJHJhd0hlaWdodCArIHY7XG4gICAgICAgICAgICAgICAgdGhpcy4kb3duZXIuaGVpZ2h0ID0gdGhpcy4kb3duZXIuJHJhd0hlaWdodCAtICh0aGlzLiRvd25lci55IC0gdG1wKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMjIgLyogQm90dG9tRXh0X1RvcCAqLzpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMjMgLyogQm90dG9tRXh0X0JvdHRvbSAqLzpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kb3duZXIuJGluUHJvZ3Jlc3NCdWlsZGluZyAmJiB0aGlzLiRvd25lciA9PSB0aGlzLiR0YXJnZXQucGFyZW50KVxuICAgICAgICAgICAgICAgICAgICB2ID0gdGhpcy4kb3duZXIuc291cmNlSGVpZ2h0IC0gKHRhcmdldFkgKyB0aGlzLiR0YXJnZXQuJGluaXRIZWlnaHQpO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdiA9IHRoaXMuJG93bmVyLiRyYXdIZWlnaHQgLSAodGFyZ2V0WSArIHRoaXMuJHRhcmdldEhlaWdodCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJG93bmVyICE9IHRoaXMuJHRhcmdldC5wYXJlbnQpXG4gICAgICAgICAgICAgICAgICAgIHYgKz0gdGhpcy4kb3duZXIueTtcbiAgICAgICAgICAgICAgICBpZiAoaW5mby5wZXJjZW50KVxuICAgICAgICAgICAgICAgICAgICB2ID0gKHYgLyB0aGlzLiR0YXJnZXRIZWlnaHQpICogdGhpcy4kdGFyZ2V0LiRyYXdIZWlnaHQ7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJG93bmVyICE9IHRoaXMuJHRhcmdldC5wYXJlbnQpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJG93bmVyLmhlaWdodCA9IHRhcmdldFkgKyB0aGlzLiR0YXJnZXQuJHJhd0hlaWdodCArIHYgLSB0aGlzLiRvd25lci55O1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kb3duZXIuaGVpZ2h0ID0gdGFyZ2V0WSArIHRoaXMuJHRhcmdldC4kcmF3SGVpZ2h0ICsgdjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICBhZGRSZWZUYXJnZXQodGFyZ2V0KSB7XG4gICAgICAgIGlmICh0YXJnZXQgIT0gdGhpcy4kb3duZXIucGFyZW50KVxuICAgICAgICAgICAgdGFyZ2V0Lm9uKFwiX194eUNoYW5nZWRcIiAvKiBYWV9DSEFOR0VEICovLCB0aGlzLiR0YXJnZXRYWUNoYW5nZWQsIHRoaXMpO1xuICAgICAgICB0YXJnZXQub24oXCJfX3NpemVDaGFuZ2VkXCIgLyogU0laRV9DSEFOR0VEICovLCB0aGlzLiR0YXJnZXRTaXplQ2hhbmdlZCwgdGhpcyk7XG4gICAgICAgIHRhcmdldC5vbihcIl9fc2l6ZURlbGF5Q2hhbmdlXCIgLyogU0laRV9ERUxBWV9DSEFOR0UgKi8sIHRoaXMuJHRhcmdldFNpemVXaWxsQ2hhbmdlLCB0aGlzKTtcbiAgICAgICAgdGhpcy4kdGFyZ2V0WCA9IHRoaXMuJHRhcmdldC54O1xuICAgICAgICB0aGlzLiR0YXJnZXRZID0gdGhpcy4kdGFyZ2V0Lnk7XG4gICAgICAgIHRoaXMuJHRhcmdldFdpZHRoID0gdGhpcy4kdGFyZ2V0LiRyYXdXaWR0aDtcbiAgICAgICAgdGhpcy4kdGFyZ2V0SGVpZ2h0ID0gdGhpcy4kdGFyZ2V0LiRyYXdIZWlnaHQ7XG4gICAgfVxuICAgIHJlbGVhc2VSZWZUYXJnZXQodGFyZ2V0KSB7XG4gICAgICAgIHRhcmdldC5vZmYoXCJfX3h5Q2hhbmdlZFwiIC8qIFhZX0NIQU5HRUQgKi8sIHRoaXMuJHRhcmdldFhZQ2hhbmdlZCk7XG4gICAgICAgIHRhcmdldC5vZmYoXCJfX3NpemVDaGFuZ2VkXCIgLyogU0laRV9DSEFOR0VEICovLCB0aGlzLiR0YXJnZXRTaXplQ2hhbmdlZCk7XG4gICAgICAgIHRhcmdldC5vZmYoXCJfX3NpemVEZWxheUNoYW5nZVwiIC8qIFNJWkVfREVMQVlfQ0hBTkdFICovLCB0aGlzLiR0YXJnZXRTaXplV2lsbENoYW5nZSk7XG4gICAgfVxuICAgICR0YXJnZXRYWUNoYW5nZWQoZXZ0KSB7XG4gICAgICAgIGlmICh0aGlzLiRvd25lci5yZWxhdGlvbnMuJGRlYWxpbmcgIT0gbnVsbCB8fFxuICAgICAgICAgICAgKHRoaXMuJG93bmVyLmdyb3VwICE9IG51bGwgJiYgdGhpcy4kb3duZXIuZ3JvdXAuJHVwZGF0aW5nKSkge1xuICAgICAgICAgICAgdGhpcy4kdGFyZ2V0WCA9IHRoaXMuJHRhcmdldC54O1xuICAgICAgICAgICAgdGhpcy4kdGFyZ2V0WSA9IHRoaXMuJHRhcmdldC55O1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuJG93bmVyLnJlbGF0aW9ucy4kZGVhbGluZyA9IHRoaXMuJHRhcmdldDtcbiAgICAgICAgbGV0IG94ID0gdGhpcy4kb3duZXIueDtcbiAgICAgICAgbGV0IG95ID0gdGhpcy4kb3duZXIueTtcbiAgICAgICAgbGV0IGR4ID0gdGhpcy4kdGFyZ2V0LnggLSB0aGlzLiR0YXJnZXRYO1xuICAgICAgICBsZXQgZHkgPSB0aGlzLiR0YXJnZXQueSAtIHRoaXMuJHRhcmdldFk7XG4gICAgICAgIHRoaXMuJGRlZnMuZm9yRWFjaChpbmZvID0+IHtcbiAgICAgICAgICAgIHRoaXMuYXBwbHlPblhZQ2hhbmdlZChpbmZvLCBkeCwgZHkpO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgdGhpcy4kdGFyZ2V0WCA9IHRoaXMuJHRhcmdldC54O1xuICAgICAgICB0aGlzLiR0YXJnZXRZID0gdGhpcy4kdGFyZ2V0Lnk7XG4gICAgICAgIGlmIChveCAhPSB0aGlzLiRvd25lci54IHx8IG95ICE9IHRoaXMuJG93bmVyLnkpIHtcbiAgICAgICAgICAgIG94ID0gdGhpcy4kb3duZXIueCAtIG94O1xuICAgICAgICAgICAgb3kgPSB0aGlzLiRvd25lci55IC0gb3k7XG4gICAgICAgICAgICB0aGlzLiRvd25lci51cGRhdGVHZWFyRnJvbVJlbGF0aW9ucygxIC8qIFhZICovLCBveCwgb3kpO1xuICAgICAgICAgICAgaWYgKHRoaXMuJG93bmVyLnBhcmVudCAhPSBudWxsICYmIHRoaXMuJG93bmVyLnBhcmVudC4kdHJhbnNpdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuJG93bmVyLnBhcmVudC4kdHJhbnNpdGlvbnMuZm9yRWFjaCh0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdC51cGRhdGVGcm9tUmVsYXRpb25zKHRoaXMuJG93bmVyLmlkLCBveCwgb3kpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuJG93bmVyLnJlbGF0aW9ucy4kZGVhbGluZyA9IG51bGw7XG4gICAgfVxuICAgICR0YXJnZXRTaXplQ2hhbmdlZChldnQpIHtcbiAgICAgICAgaWYgKHRoaXMuJG93bmVyLnJlbGF0aW9ucy4kZGVhbGluZyAhPSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLiRvd25lci5yZWxhdGlvbnMuJGRlYWxpbmcgPSB0aGlzLiR0YXJnZXQ7XG4gICAgICAgIGxldCBveCA9IHRoaXMuJG93bmVyLng7XG4gICAgICAgIGxldCBveSA9IHRoaXMuJG93bmVyLnk7XG4gICAgICAgIGxldCBvdyA9IHRoaXMuJG93bmVyLiRyYXdXaWR0aDtcbiAgICAgICAgbGV0IG9oID0gdGhpcy4kb3duZXIuJHJhd0hlaWdodDtcbiAgICAgICAgdGhpcy4kZGVmcy5mb3JFYWNoKGluZm8gPT4ge1xuICAgICAgICAgICAgdGhpcy5hcHBseU9uU2l6ZUNoYW5nZWQoaW5mbyk7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgICAgICB0aGlzLiR0YXJnZXRXaWR0aCA9IHRoaXMuJHRhcmdldC4kcmF3V2lkdGg7XG4gICAgICAgIHRoaXMuJHRhcmdldEhlaWdodCA9IHRoaXMuJHRhcmdldC4kcmF3SGVpZ2h0O1xuICAgICAgICBpZiAob3ggIT0gdGhpcy4kb3duZXIueCB8fCBveSAhPSB0aGlzLiRvd25lci55KSB7XG4gICAgICAgICAgICBveCA9IHRoaXMuJG93bmVyLnggLSBveDtcbiAgICAgICAgICAgIG95ID0gdGhpcy4kb3duZXIueSAtIG95O1xuICAgICAgICAgICAgdGhpcy4kb3duZXIudXBkYXRlR2VhckZyb21SZWxhdGlvbnMoMSAvKiBYWSAqLywgb3gsIG95KTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRvd25lci5wYXJlbnQgIT0gbnVsbCAmJiB0aGlzLiRvd25lci5wYXJlbnQuJHRyYW5zaXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRvd25lci5wYXJlbnQuJHRyYW5zaXRpb25zLmZvckVhY2godCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHQudXBkYXRlRnJvbVJlbGF0aW9ucyh0aGlzLiRvd25lci5pZCwgb3gsIG95KTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAob3cgIT0gdGhpcy4kb3duZXIuJHJhd1dpZHRoIHx8IG9oICE9IHRoaXMuJG93bmVyLiRyYXdIZWlnaHQpIHtcbiAgICAgICAgICAgIG93ID0gdGhpcy4kb3duZXIuJHJhd1dpZHRoIC0gb3c7XG4gICAgICAgICAgICBvaCA9IHRoaXMuJG93bmVyLiRyYXdIZWlnaHQgLSBvaDtcbiAgICAgICAgICAgIHRoaXMuJG93bmVyLnVwZGF0ZUdlYXJGcm9tUmVsYXRpb25zKDIgLyogU2l6ZSAqLywgb3csIG9oKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiRvd25lci5yZWxhdGlvbnMuJGRlYWxpbmcgPSBudWxsO1xuICAgIH1cbiAgICAkdGFyZ2V0U2l6ZVdpbGxDaGFuZ2UoZXZ0KSB7XG4gICAgICAgIHRoaXMuJG93bmVyLnJlbGF0aW9ucy5zaXplRGlydHkgPSB0cnVlO1xuICAgIH1cbn1cblxuY2xhc3MgUmVsYXRpb25zIHtcbiAgICBjb25zdHJ1Y3Rvcihvd25lcikge1xuICAgICAgICB0aGlzLnNpemVEaXJ0eSA9IGZhbHNlO1xuICAgICAgICB0aGlzLiRvd25lciA9IG93bmVyO1xuICAgICAgICB0aGlzLiRpdGVtcyA9IFtdO1xuICAgIH1cbiAgICBhZGQodGFyZ2V0LCByZWxhdGlvblR5cGUsIHVzZVBlcmNlbnQgPSBmYWxzZSkge1xuICAgICAgICBsZXQgbGVuZ3RoID0gdGhpcy4kaXRlbXMubGVuZ3RoO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgaXRlbSA9IHRoaXMuJGl0ZW1zW2ldO1xuICAgICAgICAgICAgaWYgKGl0ZW0udGFyZ2V0ID09IHRhcmdldCkge1xuICAgICAgICAgICAgICAgIGl0ZW0uYWRkKHJlbGF0aW9uVHlwZSwgdXNlUGVyY2VudCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGxldCBuZXdJdGVtID0gbmV3IFJlbGF0aW9uSXRlbSh0aGlzLiRvd25lcik7XG4gICAgICAgIG5ld0l0ZW0udGFyZ2V0ID0gdGFyZ2V0O1xuICAgICAgICBuZXdJdGVtLmFkZChyZWxhdGlvblR5cGUsIHVzZVBlcmNlbnQpO1xuICAgICAgICB0aGlzLiRpdGVtcy5wdXNoKG5ld0l0ZW0pO1xuICAgIH1cbiAgICBhZGRJdGVtcyh0YXJnZXQsIHNpZGVQYWlycykge1xuICAgICAgICBsZXQgYXJyID0gc2lkZVBhaXJzLnNwbGl0KCcsJyk7XG4gICAgICAgIGxldCBzO1xuICAgICAgICBsZXQgdXNlUGVyY2VudDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyOyBpKyspIHtcbiAgICAgICAgICAgIHMgPSBhcnJbaV07XG4gICAgICAgICAgICBpZiAoIXMpXG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICBpZiAocy5jaGFyQXQocy5sZW5ndGggLSAxKSA9PSAnJScpIHtcbiAgICAgICAgICAgICAgICBzID0gcy5zdWJzdHIoMCwgcy5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgICAgICB1c2VQZXJjZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB1c2VQZXJjZW50ID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAocy5pbmRleE9mKCctJykgPT0gLTEpXG4gICAgICAgICAgICAgICAgcyA9IGAke3N9LSR7c31gO1xuICAgICAgICAgICAgbGV0IHQgPSBSZWxhdGlvbnMuUkVMQVRJT05fTkFNRVMuaW5kZXhPZihzKTtcbiAgICAgICAgICAgIGlmICh0ID09IC0xKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCByZWxhdGlvbiB0eXBlJyk7XG4gICAgICAgICAgICB0aGlzLmFkZCh0YXJnZXQsIHQsIHVzZVBlcmNlbnQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbW92ZSh0YXJnZXQsIHJlbGF0aW9uVHlwZSA9IDApIHtcbiAgICAgICAgbGV0IGNudCA9IHRoaXMuJGl0ZW1zLmxlbmd0aDtcbiAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICB3aGlsZSAoaSA8IGNudCkge1xuICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLiRpdGVtc1tpXTtcbiAgICAgICAgICAgIGlmIChpdGVtLnRhcmdldCA9PSB0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICBpdGVtLnJlbW92ZShyZWxhdGlvblR5cGUpO1xuICAgICAgICAgICAgICAgIGlmIChpdGVtLmlzRW1wdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5kaXNwb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGl0ZW1zLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgY250LS07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb250YWlucyh0YXJnZXQpIHtcbiAgICAgICAgbGV0IGxlbmd0aCA9IHRoaXMuJGl0ZW1zLmxlbmd0aDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKHRoaXMuJGl0ZW1zW2ldLnRhcmdldCA9PSB0YXJnZXQpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjbGVhckZvcih0YXJnZXQpIHtcbiAgICAgICAgbGV0IGNudCA9IHRoaXMuJGl0ZW1zLmxlbmd0aDtcbiAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICB3aGlsZSAoaSA8IGNudCkge1xuICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLiRpdGVtc1tpXTtcbiAgICAgICAgICAgIGlmIChpdGVtLnRhcmdldCA9PSB0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICBpdGVtLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgICAgICB0aGlzLiRpdGVtcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgY250LS07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNsZWFyQWxsKCkge1xuICAgICAgICB0aGlzLiRpdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgICAgaXRlbS5kaXNwb3NlKCk7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgICAgICB0aGlzLiRpdGVtcy5sZW5ndGggPSAwO1xuICAgIH1cbiAgICBjb3B5RnJvbShzb3VyY2UpIHtcbiAgICAgICAgdGhpcy5jbGVhckFsbCgpO1xuICAgICAgICBzb3VyY2UuJGl0ZW1zLmZvckVhY2gocmkgPT4ge1xuICAgICAgICAgICAgbGV0IGl0ZW0gPSBuZXcgUmVsYXRpb25JdGVtKHRoaXMuJG93bmVyKTtcbiAgICAgICAgICAgIGl0ZW0uY29weUZyb20ocmkpO1xuICAgICAgICAgICAgdGhpcy4kaXRlbXMucHVzaChpdGVtKTtcbiAgICAgICAgfSwgdGhpcyk7XG4gICAgfVxuICAgIGRpc3Bvc2UoKSB7XG4gICAgICAgIHRoaXMuY2xlYXJBbGwoKTtcbiAgICB9XG4gICAgb25Pd25lclNpemVDaGFuZ2VkKGRXaWR0aCwgZEhlaWdodCkge1xuICAgICAgICBpZiAodGhpcy4kaXRlbXMubGVuZ3RoIDw9IDApXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuJGl0ZW1zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICBpdGVtLmFwcGx5T25TZWxmUmVzaXplZChkV2lkdGgsIGRIZWlnaHQpO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICB9XG4gICAgZW5zdXJlUmVsYXRpb25zU2l6ZUNvcnJlY3QoKSB7XG4gICAgICAgIGlmICh0aGlzLiRpdGVtcy5sZW5ndGggPT0gMClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy5zaXplRGlydHkgPSBmYWxzZTtcbiAgICAgICAgdGhpcy4kaXRlbXMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgIGl0ZW0udGFyZ2V0LmVuc3VyZVNpemVDb3JyZWN0KCk7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgIH1cbiAgICBnZXQgZW1wdHkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRpdGVtcy5sZW5ndGggPT0gMDtcbiAgICB9XG4gICAgc2V0dXAoeG1sKSB7XG4gICAgICAgIHhtbC5jaGlsZHJlbi5mb3JFYWNoKGN4bWwgPT4ge1xuICAgICAgICAgICAgaWYgKGN4bWwubm9kZU5hbWUgIT0gJ3JlbGF0aW9uJylcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBsZXQgdGFyZ2V0SWQ7XG4gICAgICAgICAgICBsZXQgdGFyZ2V0O1xuICAgICAgICAgICAgdGFyZ2V0SWQgPSBjeG1sLmF0dHJpYnV0ZXMudGFyZ2V0O1xuICAgICAgICAgICAgaWYgKHRoaXMuJG93bmVyLnBhcmVudCkge1xuICAgICAgICAgICAgICAgIGlmICh0YXJnZXRJZClcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGhpcy4kb3duZXIucGFyZW50LmdldENoaWxkQnlJZCh0YXJnZXRJZCk7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzLiRvd25lci5wYXJlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL2NhbGwgZnJvbSB0aGUgY29tcG9uZW50J3MgY29uc3RydWN0b3JcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzLiRvd25lci5nZXRDaGlsZEJ5SWQodGFyZ2V0SWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRhcmdldClcbiAgICAgICAgICAgICAgICB0aGlzLmFkZEl0ZW1zKHRhcmdldCwgY3htbC5hdHRyaWJ1dGVzLnNpZGVQYWlyKTtcbiAgICAgICAgfSwgdGhpcyk7XG4gICAgfVxufVxuUmVsYXRpb25zLlJFTEFUSU9OX05BTUVTID0gW1xuICAgICdsZWZ0LWxlZnQnLFxuICAgICdsZWZ0LWNlbnRlcicsXG4gICAgJ2xlZnQtcmlnaHQnLFxuICAgICdjZW50ZXItY2VudGVyJyxcbiAgICAncmlnaHQtbGVmdCcsXG4gICAgJ3JpZ2h0LWNlbnRlcicsXG4gICAgJ3JpZ2h0LXJpZ2h0JyxcbiAgICAndG9wLXRvcCcsXG4gICAgJ3RvcC1taWRkbGUnLFxuICAgICd0b3AtYm90dG9tJyxcbiAgICAnbWlkZGxlLW1pZGRsZScsXG4gICAgJ2JvdHRvbS10b3AnLFxuICAgICdib3R0b20tbWlkZGxlJyxcbiAgICAnYm90dG9tLWJvdHRvbScsXG4gICAgJ3dpZHRoLXdpZHRoJyxcbiAgICAnaGVpZ2h0LWhlaWdodCcsXG4gICAgJ2xlZnRleHQtbGVmdCcsXG4gICAgJ2xlZnRleHQtcmlnaHQnLFxuICAgICdyaWdodGV4dC1sZWZ0JyxcbiAgICAncmlnaHRleHQtcmlnaHQnLFxuICAgICd0b3BleHQtdG9wJyxcbiAgICAndG9wZXh0LWJvdHRvbScsXG4gICAgJ2JvdHRvbWV4dC10b3AnLFxuICAgICdib3R0b21leHQtYm90dG9tJyAvLzIzXG5dO1xuXG5sZXQgaXNDb2xvckdlYXIgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgcmV0dXJuIG9iaiAmJiBcImNvbG9yXCIgaW4gb2JqO1xufTtcblxuY2xhc3MgR2VhckNvbG9yIGV4dGVuZHMgR2VhckJhc2Uge1xuICAgIGNvbnN0cnVjdG9yKG93bmVyKSB7XG4gICAgICAgIHN1cGVyKG93bmVyKTtcbiAgICAgICAgdGhpcy4kZGVmYXVsdCA9ICcjZmZmZmZmJztcbiAgICB9XG4gICAgaW5pdCgpIHtcbiAgICAgICAgdGhpcy4kZGVmYXVsdCA9IHRoaXMuJG93bmVyWydjb2xvciddO1xuICAgICAgICB0aGlzLiRzdG9yYWdlID0ge307XG4gICAgfVxuICAgIGFkZFN0YXR1cyhwYWdlSWQsIHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSA9PSAnLScpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGxldCBjb2wgPSB2YWx1ZTtcbiAgICAgICAgaWYgKHBhZ2VJZCA9PSBudWxsKVxuICAgICAgICAgICAgdGhpcy4kZGVmYXVsdCA9IGNvbDtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kc3RvcmFnZVtwYWdlSWRdID0gY29sO1xuICAgIH1cbiAgICBhcHBseSgpIHtcbiAgICAgICAgdGhpcy4kb3duZXIuJGdlYXJMb2NrZWQgPSB0cnVlO1xuICAgICAgICBsZXQgZGF0YSA9IHRoaXMuJHN0b3JhZ2VbdGhpcy4kY29udHJvbGxlci5zZWxlY3RlZFBhZ2VJZF07XG4gICAgICAgIGlmIChkYXRhICE9IHVuZGVmaW5lZClcbiAgICAgICAgICAgIHRoaXMuJG93bmVyWydjb2xvciddID0gU3RyaW5nVXRpbC5IRVgyUkdCKGRhdGEpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLiRvd25lclsnY29sb3InXSA9IFN0cmluZ1V0aWwuSEVYMlJHQih0aGlzLiRkZWZhdWx0KTtcbiAgICAgICAgdGhpcy4kb3duZXIuJGdlYXJMb2NrZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgdXBkYXRlU3RhdGUoKSB7XG4gICAgICAgIGlmICh0aGlzLiRjb250cm9sbGVyID09IG51bGwgfHwgdGhpcy4kb3duZXIuJGdlYXJMb2NrZWQgfHwgdGhpcy4kb3duZXIuJGluUHJvZ3Jlc3NCdWlsZGluZylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy4kc3RvcmFnZVt0aGlzLiRjb250cm9sbGVyLnNlbGVjdGVkUGFnZUlkXSA9IHRoaXMuJG93bmVyWydjb2xvciddO1xuICAgIH1cbn1cblxubGV0IGlzQW5pbWF0aW9uR2VhciA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICByZXR1cm4gb2JqICYmIFwicGxheWluZ1wiIGluIG9iaiAmJiBcImZyYW1lXCIgaW4gb2JqO1xufTtcblxuY2xhc3MgR2VhckFuaW1hdGlvbiBleHRlbmRzIEdlYXJCYXNlIHtcbiAgICBjb25zdHJ1Y3Rvcihvd25lcikge1xuICAgICAgICBzdXBlcihvd25lcik7XG4gICAgfVxuICAgIGluaXQoKSB7XG4gICAgICAgIHRoaXMuJGRlZmF1bHQgPSBuZXcgR2VhckFuaW1hdGlvblZhbHVlKHRoaXMuJG93bmVyWydwbGF5aW5nJ10sIHRoaXMuJG93bmVyWydmcmFtZSddKTtcbiAgICAgICAgdGhpcy4kc3RvcmFnZSA9IHt9O1xuICAgIH1cbiAgICBhZGRTdGF0dXMocGFnZUlkLCB2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgPT0gJy0nKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBsZXQgZ3Y7XG4gICAgICAgIGlmIChwYWdlSWQgPT0gbnVsbClcbiAgICAgICAgICAgIGd2ID0gdGhpcy4kZGVmYXVsdDtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBndiA9IG5ldyBHZWFyQW5pbWF0aW9uVmFsdWUoKTtcbiAgICAgICAgICAgIHRoaXMuJHN0b3JhZ2VbcGFnZUlkXSA9IGd2O1xuICAgICAgICB9XG4gICAgICAgIGxldCBhcnIgPSB2YWx1ZS5zcGxpdCgnLCcpO1xuICAgICAgICBndi5mcmFtZSA9IHBhcnNlSW50KGFyclswXSk7XG4gICAgICAgIGd2LnBsYXlpbmcgPSBhcnJbMV0gPT0gJ3AnO1xuICAgIH1cbiAgICBhcHBseSgpIHtcbiAgICAgICAgdGhpcy4kb3duZXIuJGdlYXJMb2NrZWQgPSB0cnVlO1xuICAgICAgICBsZXQgZ3YgPSB0aGlzLiRzdG9yYWdlW3RoaXMuJGNvbnRyb2xsZXIuc2VsZWN0ZWRQYWdlSWRdO1xuICAgICAgICBpZiAoIWd2KVxuICAgICAgICAgICAgZ3YgPSB0aGlzLiRkZWZhdWx0O1xuICAgICAgICB0aGlzLiRvd25lclsnZnJhbWUnXSA9IGd2LmZyYW1lO1xuICAgICAgICB0aGlzLiRvd25lclsncGxheWluZyddID0gZ3YucGxheWluZztcbiAgICAgICAgdGhpcy4kb3duZXIuJGdlYXJMb2NrZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgdXBkYXRlU3RhdGUoKSB7XG4gICAgICAgIGlmICh0aGlzLiRjb250cm9sbGVyID09IG51bGwgfHwgdGhpcy4kb3duZXIuJGdlYXJMb2NrZWQgfHwgdGhpcy4kb3duZXIuJGluUHJvZ3Jlc3NCdWlsZGluZylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbGV0IGd2ID0gdGhpcy4kc3RvcmFnZVt0aGlzLiRjb250cm9sbGVyLnNlbGVjdGVkUGFnZUlkXTtcbiAgICAgICAgaWYgKCFndikge1xuICAgICAgICAgICAgZ3YgPSBuZXcgR2VhckFuaW1hdGlvblZhbHVlKCk7XG4gICAgICAgICAgICB0aGlzLiRzdG9yYWdlW3RoaXMuJGNvbnRyb2xsZXIuc2VsZWN0ZWRQYWdlSWRdID0gZ3Y7XG4gICAgICAgIH1cbiAgICAgICAgZ3YuZnJhbWUgPSB0aGlzLiRvd25lclsnZnJhbWUnXTtcbiAgICAgICAgZ3YucGxheWluZyA9IHRoaXMuJG93bmVyWydwbGF5aW5nJ107XG4gICAgfVxufVxuY2xhc3MgR2VhckFuaW1hdGlvblZhbHVlIHtcbiAgICBjb25zdHJ1Y3RvcihwbGF5aW5nID0gdHJ1ZSwgZnJhbWUgPSAwKSB7XG4gICAgICAgIHRoaXMucGxheWluZyA9IHBsYXlpbmc7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBmcmFtZTtcbiAgICB9XG59XG5cbmNsYXNzIFNwcml0ZSBleHRlbmRzIGNyZWF0ZWpzLkRpc3BsYXlPYmplY3Qge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLiR0aW50ID0gJyNmZmYnO1xuICAgICAgICB0aGlzLiRpc1RyaW0gPSBmYWxzZTtcbiAgICB9XG4gICAgZ2V0IHRpbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR0aW50O1xuICAgIH1cbiAgICBzZXQgdGludCh2KSB7XG4gICAgICAgIHRoaXMuJHRpbnQgPSB2O1xuICAgICAgICBsZXQgcmdiID0gdi5zcGxpdCgnLCcpO1xuICAgICAgICB0aGlzLmZpbHRlcnMgPSBbXG4gICAgICAgICAgICBuZXcgY3JlYXRlanMuQ29sb3JGaWx0ZXIoK3JnYlswXSAvIDI1NSwgK3JnYlsxXSAvIDI1NSwgK3JnYlsyXSAvIDI1NSwgMSwgMCwgMCwgMCwgMSlcbiAgICAgICAgXTtcbiAgICB9XG4gICAgc2V0IHNvdXJjZVJlY3QocmVjdCkge1xuICAgICAgICB0aGlzLiRzb3VyY2VSZWN0ID0gcmVjdDtcbiAgICB9XG4gICAgZ2V0IHNvdXJjZVJlY3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRzb3VyY2VSZWN0O1xuICAgIH1cbiAgICBzZXQgdGV4dHVyZVJlY3QocmVjdCkge1xuICAgICAgICB0aGlzLiR0ZXh0dXJlUmVjdCA9IHJlY3Q7XG4gICAgfVxuICAgIGdldCB0ZXh0dXJlUmVjdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHRleHR1cmVSZWN0O1xuICAgIH1cbiAgICBpc1Zpc2libGUoKSB7XG4gICAgICAgIHZhciBoYXNDb250ZW50ID0gdGhpcy5jYWNoZUNhbnZhcyB8fFxuICAgICAgICAgICAgKHRoaXMudGV4dHVyZSAmJlxuICAgICAgICAgICAgICAgICh0aGlzLnRleHR1cmVbJ25hdHVyYWxXaWR0aCddIHx8XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dHVyZVsnZ2V0Q29udGV4dCddIHx8XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dHVyZVsncmVhZHlTdGF0ZSddID49IDIpKTtcbiAgICAgICAgcmV0dXJuICEhKHRoaXMudmlzaWJsZSAmJiB0aGlzLmFscGhhID4gMCAmJiB0aGlzLnNjYWxlWCAhPSAwICYmIHRoaXMuc2NhbGVZICE9IDAgJiYgaGFzQ29udGVudCk7XG4gICAgfVxuICAgIGdldEJvdW5kcygpIHtcbiAgICAgICAgdmFyIHJlY3QgPSBzdXBlci5nZXRCb3VuZHMoKTtcbiAgICAgICAgaWYgKHJlY3QpIHtcbiAgICAgICAgICAgIHJldHVybiByZWN0O1xuICAgICAgICB9XG4gICAgICAgIHZhciB0ZXh0dXJlID0gdGhpcy50ZXh0dXJlLCBvID0gdGhpcy5zb3VyY2VSZWN0IHx8IHRleHR1cmU7XG4gICAgICAgIHZhciBoYXNDb250ZW50ID0gdGV4dHVyZSAmJiAodGV4dHVyZVsnbmF0dXJhbFdpZHRoJ10gfHwgdGV4dHVyZVsnZ2V0Q29udGV4dCddIHx8IHRleHR1cmVbJ3JlYWR5U3RhdGUnXSA+PSAyKTtcbiAgICAgICAgcmV0dXJuIGhhc0NvbnRlbnQgPyB0aGlzLnNvdXJjZVJlY3Quc2V0VmFsdWVzKDAsIDAsIG8ud2lkdGgsIG8uaGVpZ2h0KSA6IG51bGw7XG4gICAgfVxuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIC8vdG9kb1xuICAgIH1cbn1cblNwcml0ZS4kY2FjaGVkVGV4dHVyZVBvb2wgPSB7fTtcblxuY2xhc3MgR2Vhckljb24gZXh0ZW5kcyBHZWFyQmFzZSB7XG4gICAgY29uc3RydWN0b3Iob3duZXIpIHtcbiAgICAgICAgc3VwZXIob3duZXIpO1xuICAgIH1cbiAgICBpbml0KCkge1xuICAgICAgICB0aGlzLiRkZWZhdWx0ID0gdGhpcy4kb3duZXIuaWNvbjtcbiAgICAgICAgdGhpcy4kc3RvcmFnZSA9IHt9O1xuICAgIH1cbiAgICBhZGRTdGF0dXMocGFnZUlkLCB2YWx1ZSkge1xuICAgICAgICBpZiAocGFnZUlkID09IG51bGwpXG4gICAgICAgICAgICB0aGlzLiRkZWZhdWx0ID0gdmFsdWU7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRoaXMuJHN0b3JhZ2VbcGFnZUlkXSA9IHZhbHVlO1xuICAgIH1cbiAgICBhcHBseSgpIHtcbiAgICAgICAgdGhpcy4kb3duZXIuJGdlYXJMb2NrZWQgPSB0cnVlO1xuICAgICAgICBsZXQgZGF0YSA9IHRoaXMuJHN0b3JhZ2VbdGhpcy4kY29udHJvbGxlci5zZWxlY3RlZFBhZ2VJZF07XG4gICAgICAgIGlmIChkYXRhICE9IHVuZGVmaW5lZClcbiAgICAgICAgICAgIHRoaXMuJG93bmVyLmljb24gPSBkYXRhO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLiRvd25lci5pY29uID0gdGhpcy4kZGVmYXVsdDtcbiAgICAgICAgdGhpcy4kb3duZXIuJGdlYXJMb2NrZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgdXBkYXRlU3RhdGUoKSB7XG4gICAgICAgIGlmICh0aGlzLiRjb250cm9sbGVyID09IG51bGwgfHwgdGhpcy4kb3duZXIuJGdlYXJMb2NrZWQgfHwgdGhpcy4kb3duZXIuJGluUHJvZ3Jlc3NCdWlsZGluZylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy4kc3RvcmFnZVt0aGlzLiRjb250cm9sbGVyLnNlbGVjdGVkUGFnZUlkXSA9IHRoaXMuJG93bmVyLmljb247XG4gICAgfVxufVxuXG5jbGFzcyBHZWFyVGV4dCBleHRlbmRzIEdlYXJCYXNlIHtcbiAgICBjb25zdHJ1Y3Rvcihvd25lcikge1xuICAgICAgICBzdXBlcihvd25lcik7XG4gICAgfVxuICAgIGluaXQoKSB7XG4gICAgICAgIHRoaXMuJGRlZmF1bHQgPSB0aGlzLiRvd25lci50ZXh0O1xuICAgICAgICB0aGlzLiRzdG9yYWdlID0ge307XG4gICAgfVxuICAgIGFkZFN0YXR1cyhwYWdlSWQsIHZhbHVlKSB7XG4gICAgICAgIGlmIChwYWdlSWQgPT0gbnVsbClcbiAgICAgICAgICAgIHRoaXMuJGRlZmF1bHQgPSB2YWx1ZTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kc3RvcmFnZVtwYWdlSWRdID0gdmFsdWU7XG4gICAgfVxuICAgIGFwcGx5KCkge1xuICAgICAgICB0aGlzLiRvd25lci4kZ2VhckxvY2tlZCA9IHRydWU7XG4gICAgICAgIGxldCBkYXRhID0gdGhpcy4kc3RvcmFnZVt0aGlzLiRjb250cm9sbGVyLnNlbGVjdGVkUGFnZUlkXTtcbiAgICAgICAgaWYgKGRhdGEgIT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgdGhpcy4kb3duZXIudGV4dCA9IGRhdGE7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRoaXMuJG93bmVyLnRleHQgPSB0aGlzLiRkZWZhdWx0O1xuICAgICAgICB0aGlzLiRvd25lci4kZ2VhckxvY2tlZCA9IGZhbHNlO1xuICAgIH1cbiAgICB1cGRhdGVTdGF0ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuJGNvbnRyb2xsZXIgPT0gbnVsbCB8fCB0aGlzLiRvd25lci4kZ2VhckxvY2tlZCB8fCB0aGlzLiRvd25lci4kaW5Qcm9ncmVzc0J1aWxkaW5nKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLiRzdG9yYWdlW3RoaXMuJGNvbnRyb2xsZXIuc2VsZWN0ZWRQYWdlSWRdID0gdGhpcy4kb3duZXIudGV4dDtcbiAgICB9XG59XG5cbmNsYXNzIEdPYmplY3QgZXh0ZW5kcyBjcmVhdGVqcy5FdmVudERpc3BhdGNoZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLiR4ID0gMDtcbiAgICAgICAgdGhpcy4keSA9IDA7XG4gICAgICAgIHRoaXMuJHdpZHRoID0gMDtcbiAgICAgICAgdGhpcy4kaGVpZ2h0ID0gMDtcbiAgICAgICAgdGhpcy4kYWxwaGEgPSAxO1xuICAgICAgICB0aGlzLiRyb3RhdGlvbiA9IDA7XG4gICAgICAgIHRoaXMuJHZpc2libGUgPSB0cnVlO1xuICAgICAgICB0aGlzLiR0b3VjaGFibGUgPSB0cnVlO1xuICAgICAgICB0aGlzLiRncmF5ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy4kZHJhZ2dhYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuJHNjYWxlWCA9IDE7XG4gICAgICAgIHRoaXMuJHNjYWxlWSA9IDE7XG4gICAgICAgIHRoaXMuJHNrZXdYID0gMDtcbiAgICAgICAgdGhpcy4kc2tld1kgPSAwO1xuICAgICAgICB0aGlzLiRwaXZvdCA9IG5ldyBjcmVhdGVqcy5Qb2ludCgpO1xuICAgICAgICB0aGlzLiRwaXZvdEFzQW5jaG9yID0gZmFsc2U7XG4gICAgICAgIHRoaXMuJHBpdm90T2Zmc2V0ID0gbmV3IGNyZWF0ZWpzLlBvaW50KCk7XG4gICAgICAgIHRoaXMuJHNvcnRpbmdPcmRlciA9IDA7XG4gICAgICAgIHRoaXMuJGludGVybmFsVmlzaWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMuJGZvY3VzYWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLiRwaXhlbFNuYXBwaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuJGhhbmRsaW5nQ29udHJvbGxlciA9IGZhbHNlO1xuICAgICAgICB0aGlzLiRsYXN0Q29sb3JDb21wb25lbnRzID0gbnVsbDtcbiAgICAgICAgdGhpcy4kZGlzcGxheUV2ZW50TWFwID0ge307XG4gICAgICAgIC8qKkBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLiRyYXdXaWR0aCA9IDA7XG4gICAgICAgIC8qKkBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLiRyYXdIZWlnaHQgPSAwO1xuICAgICAgICAvKipAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy4kaW5pdFdpZHRoID0gMDtcbiAgICAgICAgLyoqQGludGVybmFsICovXG4gICAgICAgIHRoaXMuJGluaXRIZWlnaHQgPSAwO1xuICAgICAgICB0aGlzLiRzb3VyY2VXaWR0aCA9IDA7XG4gICAgICAgIHRoaXMuJHNvdXJjZUhlaWdodCA9IDA7XG4gICAgICAgIHRoaXMuJGlkID0gYCR7R09iamVjdC5nSW5zdGFuY2VDb3VudGVyKyt9YDtcbiAgICAgICAgdGhpcy4kbmFtZSA9ICcnO1xuICAgICAgICB0aGlzLmNyZWF0ZURpc3BsYXlPYmplY3QoKTtcbiAgICAgICAgdGhpcy4kcmVsYXRpb25zID0gbmV3IFJlbGF0aW9ucyh0aGlzKTtcbiAgICAgICAgdGhpcy4kZ2VhcnMgPSBbXTtcbiAgICAgICAgdGhpcy4kdG91Y2hhYmxlID0gdHJ1ZTtcbiAgICB9XG4gICAgZ2V0IGlkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kaWQ7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kbmFtZTtcbiAgICB9XG4gICAgc2V0IG5hbWUodmFsdWUpIHtcbiAgICAgICAgdGhpcy4kbmFtZSA9IHZhbHVlO1xuICAgIH1cbiAgICBnZXQgeCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHg7XG4gICAgfVxuICAgIHNldCB4KHZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0WFkodmFsdWUsIHRoaXMuJHkpO1xuICAgIH1cbiAgICBnZXQgeSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHk7XG4gICAgfVxuICAgIHNldCB5KHZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0WFkodGhpcy4keCwgdmFsdWUpO1xuICAgIH1cbiAgICBzZXRYWSh4diwgeXYpIHtcbiAgICAgICAgaWYgKHRoaXMuJHggIT0geHYgfHwgdGhpcy4keSAhPSB5dikge1xuICAgICAgICAgICAgdGhpcy4keCA9IHh2O1xuICAgICAgICAgICAgdGhpcy4keSA9IHl2O1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVYWUNoYW5nZWQoKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlR2VhcigxIC8qIFhZICovKTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRwYXJlbnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRwYXJlbnQuc2V0Qm91bmRzQ2hhbmdlZEZsYWcoKTtcbiAgICAgICAgICAgICAgICBsZXQgZXZ0ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KFwiX194eUNoYW5nZWRcIiAvKiBYWV9DSEFOR0VEICovLCB0cnVlLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgdGhpcy4kZGlzcGxheU9iamVjdC5kaXNwYXRjaEV2ZW50KGV2dCwgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoR09iamVjdC5kcmFnZ2luZ09iamVjdCA9PSB0aGlzICYmICFHT2JqZWN0LnNVcGRhdGluZ1doaWxlRHJhZ2dpbmcpXG4gICAgICAgICAgICAgICAgdGhpcy5sb2NhbFRvR2xvYmFsUmVjdCgwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCwgR09iamVjdC5zR2xvYmFsUmVjdCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHBpeGVsU25hcHBpbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRwaXhlbFNuYXBwaW5nO1xuICAgIH1cbiAgICBzZXQgcGl4ZWxTbmFwcGluZyh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kcGl4ZWxTbmFwcGluZyAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kcGl4ZWxTbmFwcGluZyA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVYWUNoYW5nZWQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjZW50ZXIocmVzdHJhaW50ID0gZmFsc2UpIHtcbiAgICAgICAgbGV0IHI7XG4gICAgICAgIGlmICh0aGlzLiRwYXJlbnQgIT0gbnVsbClcbiAgICAgICAgICAgIHIgPSB0aGlzLnBhcmVudDtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgciA9IERlY2xzJDEuR1Jvb3QuaW5zdDtcbiAgICAgICAgdGhpcy5zZXRYWSgoci53aWR0aCAtIHRoaXMud2lkdGgpIC8gMiwgKHIuaGVpZ2h0IC0gdGhpcy5oZWlnaHQpIC8gMik7XG4gICAgICAgIGlmIChyZXN0cmFpbnQpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkUmVsYXRpb24ociwgMyAvKiBDZW50ZXJfQ2VudGVyICovKTtcbiAgICAgICAgICAgIHRoaXMuYWRkUmVsYXRpb24ociwgMTAgLyogTWlkZGxlX01pZGRsZSAqLyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHdpZHRoKCkge1xuICAgICAgICB0aGlzLmVuc3VyZVNpemVDb3JyZWN0KCk7XG4gICAgICAgIGlmICh0aGlzLiRyZWxhdGlvbnMuc2l6ZURpcnR5KVxuICAgICAgICAgICAgdGhpcy4kcmVsYXRpb25zLmVuc3VyZVJlbGF0aW9uc1NpemVDb3JyZWN0KCk7XG4gICAgICAgIHJldHVybiB0aGlzLiR3aWR0aDtcbiAgICB9XG4gICAgc2V0IHdpZHRoKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0U2l6ZSh2YWx1ZSwgdGhpcy4kcmF3SGVpZ2h0KTtcbiAgICB9XG4gICAgZ2V0IGhlaWdodCgpIHtcbiAgICAgICAgdGhpcy5lbnN1cmVTaXplQ29ycmVjdCgpO1xuICAgICAgICBpZiAodGhpcy4kcmVsYXRpb25zLnNpemVEaXJ0eSlcbiAgICAgICAgICAgIHRoaXMuJHJlbGF0aW9ucy5lbnN1cmVSZWxhdGlvbnNTaXplQ29ycmVjdCgpO1xuICAgICAgICByZXR1cm4gdGhpcy4kaGVpZ2h0O1xuICAgIH1cbiAgICBzZXQgaGVpZ2h0KHZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0U2l6ZSh0aGlzLiRyYXdXaWR0aCwgdmFsdWUpO1xuICAgIH1cbiAgICBzZXRTaXplKHd2LCBodiwgaWdub3JlUGl2b3QgPSBmYWxzZSkge1xuICAgICAgICBpZiAodGhpcy4kcmF3V2lkdGggIT0gd3YgfHwgdGhpcy4kcmF3SGVpZ2h0ICE9IGh2KSB7XG4gICAgICAgICAgICB0aGlzLiRyYXdXaWR0aCA9IHd2O1xuICAgICAgICAgICAgdGhpcy4kcmF3SGVpZ2h0ID0gaHY7XG4gICAgICAgICAgICB3diA9IE1hdGgubWF4KDAsIHd2KTtcbiAgICAgICAgICAgIGh2ID0gTWF0aC5tYXgoMCwgaHYpO1xuICAgICAgICAgICAgbGV0IGRpZmZ3ID0gd3YgLSB0aGlzLm1hcFBpdm90V2lkdGgoMSk7XG4gICAgICAgICAgICBsZXQgZGlmZmggPSBodiAtIHRoaXMubWFwUGl2b3RIZWlnaHQoMSk7XG4gICAgICAgICAgICB0aGlzLiR3aWR0aCA9IHd2O1xuICAgICAgICAgICAgdGhpcy4kaGVpZ2h0ID0gaHY7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZVNpemVDaGFuZ2VkKCk7XG4gICAgICAgICAgICBpZiAodGhpcy4kcGl2b3QueCAhPSAwIHx8IHRoaXMuJHBpdm90LnkgIT0gMCkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy4kcGl2b3RBc0FuY2hvcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWlnbm9yZVBpdm90KVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRYWSh0aGlzLnggLSB0aGlzLiRwaXZvdC54ICogZGlmZncsIHRoaXMueSAtIHRoaXMuJHBpdm90LnkgKiBkaWZmaCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUGl2b3RPZmZzZXQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlQaXZvdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudXBkYXRlR2VhcigyIC8qIFNpemUgKi8pO1xuICAgICAgICAgICAgaWYgKHRoaXMuJHBhcmVudCkge1xuICAgICAgICAgICAgICAgIHRoaXMuJHJlbGF0aW9ucy5vbk93bmVyU2l6ZUNoYW5nZWQoZGlmZncsIGRpZmZoKTtcbiAgICAgICAgICAgICAgICB0aGlzLiRwYXJlbnQuc2V0Qm91bmRzQ2hhbmdlZEZsYWcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBldnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoXCJfX3NpemVDaGFuZ2VkXCIgLyogU0laRV9DSEFOR0VEICovLCB0cnVlLCBmYWxzZSk7XG4gICAgICAgICAgICB0aGlzLiRkaXNwbGF5T2JqZWN0LmRpc3BhdGNoRXZlbnQoZXZ0LCB0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbnN1cmVTaXplQ29ycmVjdCgpIHsgfVxuICAgIGdldCBzb3VyY2VIZWlnaHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRzb3VyY2VIZWlnaHQ7XG4gICAgfVxuICAgIGdldCBzb3VyY2VXaWR0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHNvdXJjZVdpZHRoO1xuICAgIH1cbiAgICBnZXQgaW5pdEhlaWdodCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGluaXRIZWlnaHQ7XG4gICAgfVxuICAgIGdldCBpbml0V2lkdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRpbml0V2lkdGg7XG4gICAgfVxuICAgIGdldCBhY3R1YWxXaWR0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2lkdGggKiBNYXRoLmFicyh0aGlzLiRzY2FsZVgpO1xuICAgIH1cbiAgICBnZXQgYWN0dWFsSGVpZ2h0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5oZWlnaHQgKiBNYXRoLmFicyh0aGlzLiRzY2FsZVkpO1xuICAgIH1cbiAgICBnZXQgc2NhbGVYKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kc2NhbGVYO1xuICAgIH1cbiAgICBzZXQgc2NhbGVYKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0U2NhbGUodmFsdWUsIHRoaXMuJHNjYWxlWSk7XG4gICAgfVxuICAgIGdldCBzY2FsZVkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRzY2FsZVk7XG4gICAgfVxuICAgIHNldCBzY2FsZVkodmFsdWUpIHtcbiAgICAgICAgdGhpcy5zZXRTY2FsZSh0aGlzLiRzY2FsZVgsIHZhbHVlKTtcbiAgICB9XG4gICAgc2V0U2NhbGUoc3gsIHN5KSB7XG4gICAgICAgIGlmICh0aGlzLiRzY2FsZVggIT0gc3ggfHwgdGhpcy4kc2NhbGVZICE9IHN5KSB7XG4gICAgICAgICAgICB0aGlzLiRzY2FsZVggPSBzeDtcbiAgICAgICAgICAgIHRoaXMuJHNjYWxlWSA9IHN5O1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVTY2FsZUNoYW5nZWQoKTtcbiAgICAgICAgICAgIHRoaXMuYXBwbHlQaXZvdCgpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVHZWFyKDIgLyogU2l6ZSAqLyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHNrZXdYKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kc2tld1g7XG4gICAgfVxuICAgIHNldCBza2V3WCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldFNrZXcodmFsdWUsIHRoaXMuJHNrZXdZKTtcbiAgICB9XG4gICAgZ2V0IHNrZXdZKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kc2tld1k7XG4gICAgfVxuICAgIHNldCBza2V3WSh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldFNrZXcodGhpcy4kc2tld1gsIHZhbHVlKTtcbiAgICB9XG4gICAgc2V0U2tldyh4diwgeXYpIHtcbiAgICAgICAgaWYgKHRoaXMuJHNrZXdYICE9IHh2IHx8IHRoaXMuJHNrZXdZICE9IHl2KSB7XG4gICAgICAgICAgICB0aGlzLiRza2V3WCA9IHh2O1xuICAgICAgICAgICAgdGhpcy4kc2tld1kgPSB5djtcbiAgICAgICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3Quc2tld1ggPSB4djtcbiAgICAgICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3Quc2tld1kgPSB5djtcbiAgICAgICAgICAgIHRoaXMuYXBwbHlQaXZvdCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIG1hcFBpdm90V2lkdGgoc2NhbGUpIHtcbiAgICAgICAgcmV0dXJuIHNjYWxlICogdGhpcy4kd2lkdGg7XG4gICAgfVxuICAgIG1hcFBpdm90SGVpZ2h0KHNjYWxlKSB7XG4gICAgICAgIHJldHVybiBzY2FsZSAqIHRoaXMuJGhlaWdodDtcbiAgICB9XG4gICAgZ2V0IHBpdm90WCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHBpdm90Lng7XG4gICAgfVxuICAgIGdldCBwaXZvdFkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRwaXZvdC55O1xuICAgIH1cbiAgICBzZXQgcGl2b3RYKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0UGl2b3QodmFsdWUsIHRoaXMucGl2b3RZKTtcbiAgICB9XG4gICAgc2V0IHBpdm90WSh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldFBpdm90KHRoaXMucGl2b3RYLCB2YWx1ZSk7XG4gICAgfVxuICAgIHNldFBpdm90KHh2LCB5diwgYXNBbmNob3IgPSBmYWxzZSkge1xuICAgICAgICBpZiAodGhpcy4kcGl2b3QueCAhPSB4diB8fCB0aGlzLiRwaXZvdC55ICE9IHl2IHx8IHRoaXMuJHBpdm90QXNBbmNob3IgIT0gYXNBbmNob3IpIHtcbiAgICAgICAgICAgIHRoaXMuJHBpdm90LnNldFZhbHVlcyh4diwgeXYpO1xuICAgICAgICAgICAgdGhpcy4kcGl2b3RBc0FuY2hvciA9IGFzQW5jaG9yO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVQaXZvdE9mZnNldCgpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVYWUNoYW5nZWQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpbnRlcm5hbFNldFBpdm90KHh2LCB5diwgYXNBbmNob3IpIHtcbiAgICAgICAgdGhpcy4kcGl2b3Quc2V0VmFsdWVzKHh2LCB5dik7XG4gICAgICAgIHRoaXMuJHBpdm90QXNBbmNob3IgPSBhc0FuY2hvcjtcbiAgICAgICAgaWYgKGFzQW5jaG9yKVxuICAgICAgICAgICAgdGhpcy5oYW5kbGVYWUNoYW5nZWQoKTtcbiAgICB9XG4gICAgdXBkYXRlUGl2b3RPZmZzZXQoKSB7XG4gICAgICAgIGxldCB0cmFuc2Zvcm0gPSB0aGlzLiRkaXNwbGF5T2JqZWN0LmdldE1hdHJpeCgpO1xuICAgICAgICBpZiAodGhpcy4kcGl2b3QueCAhPSAwIHx8ICh0aGlzLiRwaXZvdC55ICE9IDAgJiYgdHJhbnNmb3JtKSkge1xuICAgICAgICAgICAgbGV0IHZ4ID0gdGhpcy5tYXBQaXZvdFdpZHRoKHRoaXMuJHBpdm90LngpLCB2eSA9IHRoaXMubWFwUGl2b3RIZWlnaHQodGhpcy4kcGl2b3QueSk7XG4gICAgICAgICAgICBHT2JqZWN0LnNIZWxwZXJQb2ludC5zZXRWYWx1ZXModngsIHZ5KTtcbiAgICAgICAgICAgIGxldCBwID0gdHJhbnNmb3JtLnRyYW5zZm9ybVBvaW50KEdPYmplY3Quc0hlbHBlclBvaW50LngsIEdPYmplY3Quc0hlbHBlclBvaW50LnkpO1xuICAgICAgICAgICAgKHAueCAtPSB0cmFuc2Zvcm0udHgpLCAocC55IC09IHRyYW5zZm9ybS50eSk7XG4gICAgICAgICAgICBsZXQgb2Zmc2V0WCA9IHRoaXMuJHBpdm90LnggKiB0aGlzLiR3aWR0aCAtIHAueDtcbiAgICAgICAgICAgIGxldCBvZmZzZXRZID0gdGhpcy4kcGl2b3QueSAqIHRoaXMuJGhlaWdodCAtIHAueTtcbiAgICAgICAgICAgIHRoaXMuJHBpdm90T2Zmc2V0LnNldFZhbHVlcyhvZmZzZXRYLCBvZmZzZXRZKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLiRwaXZvdE9mZnNldC5zZXRWYWx1ZXMoMCwgMCk7XG4gICAgfVxuICAgIGFwcGx5UGl2b3QoKSB7XG4gICAgICAgIGlmICh0aGlzLiRwaXZvdC54ICE9IDAgfHwgdGhpcy4kcGl2b3QueSAhPSAwKSB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVBpdm90T2Zmc2V0KCk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZVhZQ2hhbmdlZCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCB0b3VjaGFibGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR0b3VjaGFibGU7XG4gICAgfVxuICAgIHNldCB0b3VjaGFibGUodmFsdWUpIHtcbiAgICAgICAgdGhpcy4kdG91Y2hhYmxlID0gdmFsdWU7XG4gICAgICAgIGlmICh0aGlzLiR0b3VjaGFibGUpIHtcbiAgICAgICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3QubW91c2VFbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3QubW91c2VFbmFibGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGdyYXllZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGdyYXllZDtcbiAgICB9XG4gICAgc2V0IGdyYXllZCh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kZ3JheWVkICE9IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiRncmF5ZWQgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlR3JheWVkQ2hhbmdlZCgpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVHZWFyKDMgLyogTG9vayAqLyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGVuYWJsZWQoKSB7XG4gICAgICAgIHJldHVybiAhdGhpcy4kZ3JheWVkICYmIHRoaXMuJHRvdWNoYWJsZTtcbiAgICB9XG4gICAgc2V0IGVuYWJsZWQodmFsdWUpIHtcbiAgICAgICAgdGhpcy5ncmF5ZWQgPSAhdmFsdWU7XG4gICAgICAgIHRoaXMudG91Y2hhYmxlID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCByb3RhdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHJvdGF0aW9uO1xuICAgIH1cbiAgICBzZXQgcm90YXRpb24odmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJHJvdGF0aW9uICE9IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiRyb3RhdGlvbiA9IHZhbHVlO1xuICAgICAgICAgICAgaWYgKHRoaXMuJGRpc3BsYXlPYmplY3QpXG4gICAgICAgICAgICAgICAgdGhpcy4kZGlzcGxheU9iamVjdC5yb3RhdGlvbiA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5hcHBseVBpdm90KCk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUdlYXIoMyAvKiBMb29rICovKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgbm9ybWFsaXplUm90YXRpb24oKSB7XG4gICAgICAgIGxldCByb3QgPSB0aGlzLiRyb3RhdGlvbiAlIDM2MDtcbiAgICAgICAgaWYgKHJvdCA+IDE4MClcbiAgICAgICAgICAgIHJvdCAtPSAzNjA7XG4gICAgICAgIGVsc2UgaWYgKHJvdCA8IC0xODApXG4gICAgICAgICAgICByb3QgKz0gMzYwO1xuICAgICAgICByZXR1cm4gcm90O1xuICAgIH1cbiAgICBnZXQgYWxwaGEoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRhbHBoYTtcbiAgICB9XG4gICAgc2V0IGFscGhhKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiRhbHBoYSAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kYWxwaGEgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQWxwaGEoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB1cGRhdGVBbHBoYSgpIHtcbiAgICAgICAgaWYgKHRoaXMuJGRpc3BsYXlPYmplY3QpXG4gICAgICAgICAgICB0aGlzLiRkaXNwbGF5T2JqZWN0LmFscGhhID0gdGhpcy4kYWxwaGE7XG4gICAgICAgIHRoaXMudXBkYXRlR2VhcigzIC8qIExvb2sgKi8pO1xuICAgIH1cbiAgICBnZXQgdmlzaWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHZpc2libGU7XG4gICAgfVxuICAgIHNldCB2aXNpYmxlKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiR2aXNpYmxlICE9IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiR2aXNpYmxlID0gdmFsdWU7XG4gICAgICAgICAgICBpZiAodGhpcy4kZGlzcGxheU9iamVjdClcbiAgICAgICAgICAgICAgICB0aGlzLiRkaXNwbGF5T2JqZWN0LnZpc2libGUgPSB0aGlzLiR2aXNpYmxlO1xuICAgICAgICAgICAgaWYgKHRoaXMuJHBhcmVudCkge1xuICAgICAgICAgICAgICAgIHRoaXMuJHBhcmVudC5jaGlsZFN0YXRlQ2hhbmdlZCh0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLiRwYXJlbnQuc2V0Qm91bmRzQ2hhbmdlZEZsYWcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBldmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudChcIl9fdmlzaWJsZUNoYW5nZWRcIiAvKiBWSVNJQkxFX0NIQU5HRUQgKi8sIHRydWUsIGZhbHNlKTtcbiAgICAgICAgICAgIGV2ZW50LmRhdGEgPSB7IHZpc2libGU6IHRoaXMuJHZpc2libGUgfTtcbiAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChldmVudCwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqQGludGVybmFsICovXG4gICAgc2V0IGludGVybmFsVmlzaWJsZSh2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgIT0gdGhpcy4kaW50ZXJuYWxWaXNpYmxlKSB7XG4gICAgICAgICAgICB0aGlzLiRpbnRlcm5hbFZpc2libGUgPSB2YWx1ZTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRwYXJlbnQpXG4gICAgICAgICAgICAgICAgdGhpcy4kcGFyZW50LmNoaWxkU3RhdGVDaGFuZ2VkKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKkBpbnRlcm5hbCAqL1xuICAgIGdldCBpbnRlcm5hbFZpc2libGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRpbnRlcm5hbFZpc2libGU7XG4gICAgfVxuICAgIGdldCBmaW5hbFZpc2libGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR2aXNpYmxlICYmIHRoaXMuJGludGVybmFsVmlzaWJsZSAmJiAoIXRoaXMuJGdyb3VwIHx8IHRoaXMuJGdyb3VwLmZpbmFsVmlzaWJsZSk7XG4gICAgfVxuICAgIGdldCBzb3J0aW5nT3JkZXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRzb3J0aW5nT3JkZXI7XG4gICAgfVxuICAgIHNldCBzb3J0aW5nT3JkZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHZhbHVlIDwgMClcbiAgICAgICAgICAgIHZhbHVlID0gMDtcbiAgICAgICAgaWYgKHRoaXMuJHNvcnRpbmdPcmRlciAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgbGV0IG9sZCA9IHRoaXMuJHNvcnRpbmdPcmRlcjtcbiAgICAgICAgICAgIHRoaXMuJHNvcnRpbmdPcmRlciA9IHZhbHVlO1xuICAgICAgICAgICAgaWYgKHRoaXMuJHBhcmVudCAhPSBudWxsKVxuICAgICAgICAgICAgICAgIHRoaXMuJHBhcmVudC5jaGlsZFNvcnRpbmdPcmRlckNoYW5nZWQodGhpcywgb2xkLCB0aGlzLiRzb3J0aW5nT3JkZXIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBmb2N1c2FibGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRmb2N1c2FibGU7XG4gICAgfVxuICAgIHNldCBmb2N1c2FibGUodmFsdWUpIHtcbiAgICAgICAgdGhpcy4kZm9jdXNhYmxlID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCBmb2N1c2VkKCkge1xuICAgICAgICByZXR1cm4gRGVjbHMkMS5HUm9vdC5pbnN0LmZvY3VzID09IHRoaXM7XG4gICAgfVxuICAgIHJlcXVlc3RGb2N1cygpIHtcbiAgICAgICAgbGV0IHAgPSB0aGlzO1xuICAgICAgICB3aGlsZSAocCAmJiAhcC4kZm9jdXNhYmxlKVxuICAgICAgICAgICAgcCA9IHAucGFyZW50O1xuICAgICAgICBpZiAocCAhPSBudWxsKVxuICAgICAgICAgICAgRGVjbHMkMS5HUm9vdC5pbnN0LmZvY3VzID0gcDtcbiAgICB9XG4gICAgZ2V0IHRvb2x0aXBzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kdG9vbHRpcHM7XG4gICAgfVxuICAgIHNldCB0b29sdGlwcyh2YWx1ZSkge1xuICAgICAgICB0aGlzLiR0b29sdGlwcyA9IHZhbHVlO1xuICAgIH1cbiAgICBnZXQgYmxlbmRNb2RlKCkge1xuICAgICAgICBpZiAodGhpcy4kZGlzcGxheU9iamVjdCAmJiB0aGlzLiRkaXNwbGF5T2JqZWN0IGluc3RhbmNlb2YgU3ByaXRlKVxuICAgICAgICAgICAgcmV0dXJuIEJsZW5kTW9kZU1hcFt0aGlzLiRkaXNwbGF5T2JqZWN0LmNvbXBvc2l0ZU9wZXJhdGlvbl0gfHwgJ05vbmUnO1xuICAgICAgICByZXR1cm4gQmxlbmRNb2RlTWFwWzBdOyAvL05vcm1hbFxuICAgIH1cbiAgICBzZXQgYmxlbmRNb2RlKHZhbHVlKSB7XG4gICAgICAgIGlmICghdmFsdWUgfHwgIXZhbHVlLmxlbmd0aCB8fCAhdGhpcy4kZGlzcGxheU9iamVjdCB8fCAhKHRoaXMuJGRpc3BsYXlPYmplY3QgaW5zdGFuY2VvZiBTcHJpdGUpKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IEJsZW5kTW9kZU1hcC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKEJsZW5kTW9kZU1hcFtpXS50b0xvd2VyQ2FzZSgpID09PSB2YWx1ZS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kZGlzcGxheU9iamVjdC5jb21wb3NpdGVPcGVyYXRpb24gPSBCbGVuZE1vZGVNYXBbaV07XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBmaWx0ZXJzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kZGlzcGxheU9iamVjdC5maWx0ZXJzO1xuICAgIH1cbiAgICBzZXQgZmlsdGVycyh2YWx1ZSkge1xuICAgICAgICB0aGlzLiRkaXNwbGF5T2JqZWN0LmZpbHRlcnMgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IGluQ29udGFpbmVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kZGlzcGxheU9iamVjdC5wYXJlbnQgIT0gbnVsbDtcbiAgICB9XG4gICAgc3RhdGljIGlzRGlzcGxheU9iamVjdE9uU3RhZ2UoZGlzcGxheSkge1xuICAgICAgICBpZiAoIWRpc3BsYXkgfHwgIWRpc3BsYXkucGFyZW50KVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICBsZXQgcCA9IGRpc3BsYXk7XG4gICAgICAgIHdoaWxlIChwICE9IG51bGwpIHtcbiAgICAgICAgICAgIGlmIChwID09IERlY2xzJDEuR1Jvb3QuaW5zdC5uYXRpdmVTdGFnZSlcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIHAgPSBwLnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGdldCBvblN0YWdlKCkge1xuICAgICAgICByZXR1cm4gR09iamVjdC5pc0Rpc3BsYXlPYmplY3RPblN0YWdlKHRoaXMuJGRpc3BsYXlPYmplY3QpO1xuICAgIH1cbiAgICBnZXQgcmVzb3VyY2VVUkwoKSB7XG4gICAgICAgIGlmICh0aGlzLnBhY2thZ2VJdGVtICE9IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gYHVpOi8vJHt0aGlzLnBhY2thZ2VJdGVtLm93bmVyLmlkfSR7dGhpcy5wYWNrYWdlSXRlbS5pZH1gO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgc2V0IGdyb3VwKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuJGdyb3VwID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCBncm91cCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGdyb3VwO1xuICAgIH1cbiAgICBnZXRHZWFyKGluZGV4KSB7XG4gICAgICAgIGxldCBnZWFyID0gdGhpcy4kZ2VhcnNbaW5kZXhdO1xuICAgICAgICBpZiAoZ2VhciA9PSBudWxsKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKGluZGV4KSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwIC8qIERpc3BsYXkgKi86XG4gICAgICAgICAgICAgICAgICAgIGdlYXIgPSBuZXcgR2VhckRpc3BsYXkodGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMSAvKiBYWSAqLzpcbiAgICAgICAgICAgICAgICAgICAgZ2VhciA9IG5ldyBHZWFyWFkodGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMiAvKiBTaXplICovOlxuICAgICAgICAgICAgICAgICAgICBnZWFyID0gbmV3IEdlYXJTaXplKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDMgLyogTG9vayAqLzpcbiAgICAgICAgICAgICAgICAgICAgZ2VhciA9IG5ldyBHZWFyTG9vayh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA0IC8qIENvbG9yICovOlxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNDb2xvckdlYXIodGhpcykpXG4gICAgICAgICAgICAgICAgICAgICAgICBnZWFyID0gbmV3IEdlYXJDb2xvcih0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGNvbXBvbmVudCB0eXBlIHRvIGFkZCBHZWFyQ29sb3IgZmVhdHVyZSwgcGxlYXNlIGNoZWNrIHRoZSBjb21wb25lbnQgbmFtZWQgJHt0aGlzLiRuYW1lfSBpbiB0aGUgRWRpdG9yLmApO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDUgLyogQW5pbWF0aW9uICovOlxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNBbmltYXRpb25HZWFyKHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgZ2VhciA9IG5ldyBHZWFyQW5pbWF0aW9uKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgY29tcG9uZW50IHR5cGUgdG8gYWRkIEdlYXJBbmltYXRpb24gZmVhdHVyZSwgcGxlYXNlIGNoZWNrIHRoZSBjb21wb25lbnQgbmFtZWQgJHt0aGlzLiRuYW1lfSBpbiB0aGUgRWRpdG9yLmApO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDYgLyogVGV4dCAqLzpcbiAgICAgICAgICAgICAgICAgICAgZ2VhciA9IG5ldyBHZWFyVGV4dCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA3IC8qIEljb24gKi86XG4gICAgICAgICAgICAgICAgICAgIGdlYXIgPSBuZXcgR2Vhckljb24odGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRkdVSTogaW52YWxpZCBnZWFyIHR5cGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuJGdlYXJzW2luZGV4XSA9IGdlYXI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGdlYXI7XG4gICAgfVxuICAgIHVwZGF0ZUdlYXIoaW5kZXgpIHtcbiAgICAgICAgaWYgKHRoaXMuJGdlYXJzW2luZGV4XSAhPSBudWxsKVxuICAgICAgICAgICAgdGhpcy4kZ2VhcnNbaW5kZXhdLnVwZGF0ZVN0YXRlKCk7XG4gICAgfVxuICAgIHVwZGF0ZUdlYXJGcm9tUmVsYXRpb25zKGluZGV4LCBkeCwgZHkpIHtcbiAgICAgICAgaWYgKHRoaXMuJGdlYXJzW2luZGV4XSAhPSBudWxsKVxuICAgICAgICAgICAgdGhpcy4kZ2VhcnNbaW5kZXhdLnVwZGF0ZUZyb21SZWxhdGlvbnMoZHgsIGR5KTtcbiAgICB9XG4gICAgaGFzR2VhckNvbnRyb2xsZXIoaW5kZXgsIGMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGdlYXJzW2luZGV4XSAmJiB0aGlzLiRnZWFyc1tpbmRleF0uY29udHJvbGxlciA9PSBjO1xuICAgIH1cbiAgICAvKipAaW50ZXJuYWwgKi9cbiAgICBsb2NrR2VhckRpc3BsYXkoKSB7XG4gICAgICAgIGxldCBnID0gdGhpcy4kZ2VhcnNbMF07XG4gICAgICAgIGlmIChnICYmIGcuY29udHJvbGxlcikge1xuICAgICAgICAgICAgbGV0IHJldCA9IGcubG9jaygpO1xuICAgICAgICAgICAgdGhpcy5jaGVja0dlYXJWaXNpYmxlKCk7XG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICAvKipAaW50ZXJuYWwgKi9cbiAgICByZWxlYXNlR2VhckRpc3BsYXkodG9rZW4pIHtcbiAgICAgICAgbGV0IGcgPSB0aGlzLiRnZWFyc1swXTtcbiAgICAgICAgaWYgKGcgJiYgZy5jb250cm9sbGVyKSB7XG4gICAgICAgICAgICBnLnJlbGVhc2UodG9rZW4pO1xuICAgICAgICAgICAgdGhpcy5jaGVja0dlYXJWaXNpYmxlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2hlY2tHZWFyVmlzaWJsZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuJGhhbmRsaW5nQ29udHJvbGxlcilcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbGV0IGcgPSB0aGlzLiRnZWFyc1swXTtcbiAgICAgICAgbGV0IHYgPSAhZyB8fCBnLmNvbm5lY3RlZDtcbiAgICAgICAgaWYgKHYgIT0gdGhpcy4kaW50ZXJuYWxWaXNpYmxlKSB7XG4gICAgICAgICAgICB0aGlzLiRpbnRlcm5hbFZpc2libGUgPSB2O1xuICAgICAgICAgICAgaWYgKHRoaXMuJHBhcmVudClcbiAgICAgICAgICAgICAgICB0aGlzLiRwYXJlbnQuY2hpbGRTdGF0ZUNoYW5nZWQodGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGdlYXJYWSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0R2VhcigxIC8qIFhZICovKTtcbiAgICB9XG4gICAgZ2V0IGdlYXJTaXplKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRHZWFyKDIgLyogU2l6ZSAqLyk7XG4gICAgfVxuICAgIGdldCBnZWFyTG9vaygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0R2VhcigzIC8qIExvb2sgKi8pO1xuICAgIH1cbiAgICBnZXQgcmVsYXRpb25zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kcmVsYXRpb25zO1xuICAgIH1cbiAgICBhZGRSZWxhdGlvbih0YXJnZXQsIHJlbGF0aW9uVHlwZSwgdXNlUGVyY2VudCA9IGZhbHNlKSB7XG4gICAgICAgIHRoaXMuJHJlbGF0aW9ucy5hZGQodGFyZ2V0LCByZWxhdGlvblR5cGUsIHVzZVBlcmNlbnQpO1xuICAgIH1cbiAgICByZW1vdmVSZWxhdGlvbih0YXJnZXQsIHJlbGF0aW9uVHlwZSA9IDApIHtcbiAgICAgICAgdGhpcy4kcmVsYXRpb25zLnJlbW92ZSh0YXJnZXQsIHJlbGF0aW9uVHlwZSk7XG4gICAgfVxuICAgIGdldCBkaXNwbGF5T2JqZWN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kZGlzcGxheU9iamVjdDtcbiAgICB9XG4gICAgY3JlYXRlRGlzcGxheU9iamVjdCgpIHsgfVxuICAgIHNldERpc3BsYXlPYmplY3QodmFsdWUpIHtcbiAgICAgICAgdGhpcy4kZGlzcGxheU9iamVjdCA9IHZhbHVlO1xuICAgIH1cbiAgICBnZXQgcGFyZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kcGFyZW50O1xuICAgIH1cbiAgICBzZXQgcGFyZW50KHZhbCkge1xuICAgICAgICB0aGlzLiRwYXJlbnQgPSB2YWw7XG4gICAgfVxuICAgIHJlbW92ZUZyb21QYXJlbnQoKSB7XG4gICAgICAgIGlmICh0aGlzLiRwYXJlbnQpXG4gICAgICAgICAgICB0aGlzLiRwYXJlbnQucmVtb3ZlQ2hpbGQodGhpcyk7XG4gICAgfVxuICAgIC8qKiBAdmlydHVhbCAqL1xuICAgIGdldCB0ZXh0KCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqIEB2aXJ0dWFsICovXG4gICAgc2V0IHRleHQodmFsdWUpIHsgfVxuICAgIC8qKiBAdmlydHVhbCAqL1xuICAgIGdldCBpY29uKCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqIEB2aXJ0dWFsICovXG4gICAgc2V0IGljb24odmFsdWUpIHsgfVxuICAgIGRpc3Bvc2UoKSB7XG4gICAgICAgIHRoaXMucmVtb3ZlRnJvbVBhcmVudCgpO1xuICAgICAgICB0aGlzLiRyZWxhdGlvbnMuZGlzcG9zZSgpO1xuICAgICAgICB0aGlzLnJlbW92ZUFsbExpc3RlbmVycygpO1xuICAgICAgICB0aGlzLiRtb3VzZU1vdmVFdmVudCA9IERlY2xzJDEuR1Jvb3QuaW5zdC5uYXRpdmVTdGFnZS5vZmYoSW50ZXJhY3RpdmVFdmVudHMuTW92ZSwgdGhpcy4kbW92aW5nKTtcbiAgICAgICAgdGhpcy4kbW91c2VVcEV2ZW50ID0gRGVjbHMkMS5HUm9vdC5pbnN0Lm5hdGl2ZVN0YWdlLm9mZihJbnRlcmFjdGl2ZUV2ZW50cy5VcCwgdGhpcy4kZW5kKTtcbiAgICAgICAgdGhpcy4kbW91c2VNb3ZlMkV2ZW50ID0gRGVjbHMkMS5HUm9vdC5pbnN0Lm5hdGl2ZVN0YWdlLm9mZihJbnRlcmFjdGl2ZUV2ZW50cy5Nb3ZlLCB0aGlzLiRtb3ZpbmcyKTtcbiAgICAgICAgdGhpcy4kbW91c2VVcDJFdmVudCA9IERlY2xzJDEuR1Jvb3QuaW5zdC5uYXRpdmVTdGFnZS5vZmYoSW50ZXJhY3RpdmVFdmVudHMuVXAsIHRoaXMuJGVuZDIpO1xuICAgICAgICAvLyB0aGlzLiRkaXNwbGF5T2JqZWN0LmRlc3Ryb3koKTsgIC8vY2pzIG5vdCB0aGUgZGVzdHJveSBBUElcbiAgICB9XG4gICAgY2xpY2sobGlzdGVuZXIsIHRoaXNPYmopIHtcbiAgICAgICAgdGhpcy5vbihJbnRlcmFjdGl2ZUV2ZW50cy5DbGljaywgbGlzdGVuZXIsIHRoaXNPYmopO1xuICAgIH1cbiAgICByZW1vdmVDbGljayhsaXN0ZW5lcikge1xuICAgICAgICB0aGlzLm9mZihJbnRlcmFjdGl2ZUV2ZW50cy5DbGljaywgbGlzdGVuZXIpO1xuICAgIH1cbiAgICBoYXNDbGljayhmbikge1xuICAgICAgICByZXR1cm4gdGhpcy5oYXNMaXN0ZW5lcihJbnRlcmFjdGl2ZUV2ZW50cy5DbGljayk7XG4gICAgfVxuICAgIG9uKHR5cGUsIGxpc3RlbmVyLCB0aGlzT2JqZWN0LCBvbmNlID0gZmFsc2UpIHtcbiAgICAgICAgaWYgKHR5cGUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICBsZXQgZm4gPSB0aGlzLiRkaXNwbGF5T2JqZWN0Lm9uKHR5cGUsIGxpc3RlbmVyLCB0aGlzT2JqZWN0LCBvbmNlKTtcbiAgICAgICAgdGhpcy4kZGlzcGxheUV2ZW50TWFwW3R5cGVdID0gZm47XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBvZmYodHlwZSwgbGlzdGVuZXIpIHtcbiAgICAgICAgaWYgKHRoaXMuJGRpc3BsYXlPYmplY3QuaGFzRXZlbnRMaXN0ZW5lcih0eXBlKSkge1xuICAgICAgICAgICAgdGhpcy4kZGlzcGxheU9iamVjdC5vZmYodHlwZSwgdGhpcy4kZGlzcGxheUV2ZW50TWFwW3R5cGVdKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBvbmNlKHR5cGUsIGxpc3RlbmVyLCB0aGlzT2JqZWN0KSB7XG4gICAgICAgIGlmICh0eXBlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgdGhpcy5vbih0eXBlLCBsaXN0ZW5lciwgdGhpc09iamVjdCwgdHJ1ZSk7XG4gICAgfVxuICAgIGhhc0xpc3RlbmVyKGV2ZW50KSB7XG4gICAgICAgIC8vZG8gd2UgbmVlZCB0byBhbHNvIGNoZWNrIHRoZSBjb250ZXh0P1xuICAgICAgICAvLyBzdXBlci5oYXNFdmVudExpc3RlbmVyKGV2ZW50KVxuICAgICAgICByZXR1cm4gdGhpcy4kZGlzcGxheU9iamVjdC5oYXNFdmVudExpc3RlbmVyKGV2ZW50KTtcbiAgICB9XG4gICAgZGlzcGF0Y2hFdmVudChldmVudCwgLi4uYXJncykge1xuICAgICAgICAvLyBzdXBlci5kaXNwYXRjaEV2ZW50KGV2ZW50LCBhcmdzKVxuICAgICAgICBpZiAoIWFyZ3MgfHwgYXJncy5sZW5ndGggPD0gMClcbiAgICAgICAgICAgIGFyZ3MgPSBbZXZlbnRdO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBhcmdzLnVuc2hpZnQoZXZlbnQpO1xuICAgICAgICByZXR1cm4gdGhpcy4kZGlzcGxheU9iamVjdC5kaXNwYXRjaEV2ZW50KGV2ZW50LCB0aGlzLiRkaXNwbGF5T2JqZWN0KTtcbiAgICB9XG4gICAgcmVtb3ZlQWxsTGlzdGVuZXJzKHR5cGUpIHtcbiAgICAgICAgdGhpcy5yZW1vdmVBbGxFdmVudExpc3RlbmVycyh0eXBlKTtcbiAgICB9XG4gICAgZ2V0IGRyYWdnYWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGRyYWdnYWJsZTtcbiAgICB9XG4gICAgc2V0IGRyYWdnYWJsZSh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kZHJhZ2dhYmxlICE9IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiRkcmFnZ2FibGUgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMuaW5pdERyYWcoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgZHJhZ0JvdW5kcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGRyYWdCb3VuZHM7XG4gICAgfVxuICAgIHNldCBkcmFnQm91bmRzKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuJGRyYWdCb3VuZHMgPSB2YWx1ZTtcbiAgICB9XG4gICAgc3RhcnREcmFnKHRvdWNoUG9pbnRJRCA9IC0xKSB7XG4gICAgICAgIGlmICghdGhpcy5vblN0YWdlKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLmRyYWdCZWdpbigpO1xuICAgIH1cbiAgICBzdG9wRHJhZygpIHtcbiAgICAgICAgdGhpcy5kcmFnRW5kKCk7XG4gICAgfVxuICAgIGdldCBkcmFnZ2luZygpIHtcbiAgICAgICAgcmV0dXJuIEdPYmplY3QuZHJhZ2dpbmdPYmplY3QgPT0gdGhpcztcbiAgICB9XG4gICAgbG9jYWxUb0dsb2JhbChheCA9IDAsIGF5ID0gMCwgcmVzdWx0UG9pbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuJHBpdm90QXNBbmNob3IpIHtcbiAgICAgICAgICAgIGF4ICs9IHRoaXMuJHBpdm90LnggKiB0aGlzLiR3aWR0aDtcbiAgICAgICAgICAgIGF5ICs9IHRoaXMuJHBpdm90LnkgKiB0aGlzLiRoZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFyZXN1bHRQb2ludClcbiAgICAgICAgICAgIHJlc3VsdFBvaW50ID0gR09iamVjdC5zSGVscGVyUG9pbnQ7XG4gICAgICAgIHJlc3VsdFBvaW50LnggPSBheDtcbiAgICAgICAgcmVzdWx0UG9pbnQueSA9IGF5O1xuICAgICAgICByZXR1cm4gdGhpcy4kZGlzcGxheU9iamVjdC5sb2NhbFRvR2xvYmFsKHJlc3VsdFBvaW50LngsIHJlc3VsdFBvaW50LnkpO1xuICAgIH1cbiAgICBnbG9iYWxUb0xvY2FsKGF4ID0gMCwgYXkgPSAwLCByZXN1bHRQb2ludCkge1xuICAgICAgICBpZiAoIXJlc3VsdFBvaW50KVxuICAgICAgICAgICAgcmVzdWx0UG9pbnQgPSBHT2JqZWN0LnNIZWxwZXJQb2ludDtcbiAgICAgICAgcmVzdWx0UG9pbnQuc2V0VmFsdWVzKGF4LCBheSk7XG4gICAgICAgIHJlc3VsdFBvaW50ID0gdGhpcy4kZGlzcGxheU9iamVjdC5nbG9iYWxUb0xvY2FsKHJlc3VsdFBvaW50LngsIHJlc3VsdFBvaW50LnkpO1xuICAgICAgICBpZiAodGhpcy4kcGl2b3RBc0FuY2hvcikge1xuICAgICAgICAgICAgcmVzdWx0UG9pbnQueCAtPSB0aGlzLiRwaXZvdC54ICogdGhpcy4kd2lkdGg7XG4gICAgICAgICAgICByZXN1bHRQb2ludC55IC09IHRoaXMuJHBpdm90LnkgKiB0aGlzLiRoZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdFBvaW50O1xuICAgIH1cbiAgICBsb2NhbFRvUm9vdChheCA9IDAsIGF5ID0gMCwgcmVzdWx0UG9pbnQpIHtcbiAgICAgICAgbGV0IHB0ID0gdGhpcy5sb2NhbFRvR2xvYmFsKGF4LCBheSwgcmVzdWx0UG9pbnQpO1xuICAgICAgICBwdC54IC89IERlY2xzJDEuR1Jvb3QuaW5zdC5jb250ZW50U2NhbGVGYWN0b3I7XG4gICAgICAgIHB0LnkgLz0gRGVjbHMkMS5HUm9vdC5pbnN0LmNvbnRlbnRTY2FsZUZhY3RvcjtcbiAgICAgICAgcmV0dXJuIHB0O1xuICAgIH1cbiAgICByb290VG9Mb2NhbChheCA9IDAsIGF5ID0gMCwgcmVzdWx0UG9pbnQpIHtcbiAgICAgICAgYXggKj0gRGVjbHMkMS5HUm9vdC5pbnN0LmNvbnRlbnRTY2FsZUZhY3RvcjtcbiAgICAgICAgYXkgKj0gRGVjbHMkMS5HUm9vdC5pbnN0LmNvbnRlbnRTY2FsZUZhY3RvcjtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2xvYmFsVG9Mb2NhbChheCwgYXksIHJlc3VsdFBvaW50KTtcbiAgICB9XG4gICAgbG9jYWxUb0dsb2JhbFJlY3QoYXggPSAwLCBheSA9IDAsIGFXaWR0aCA9IDAsIGFIZWlnaHQgPSAwLCByZXN1bHRSZWN0KSB7XG4gICAgICAgIGlmIChyZXN1bHRSZWN0ID09IG51bGwpXG4gICAgICAgICAgICByZXN1bHRSZWN0ID0gR09iamVjdC5zRHJhZ0hlbHBlclJlY3Q7XG4gICAgICAgIGxldCBwdCA9IHRoaXMubG9jYWxUb0dsb2JhbChheCwgYXkpO1xuICAgICAgICByZXN1bHRSZWN0LnggPSBwdC54O1xuICAgICAgICByZXN1bHRSZWN0LnkgPSBwdC55O1xuICAgICAgICByZXN1bHRSZWN0LndpZHRoID0gYVdpZHRoO1xuICAgICAgICByZXN1bHRSZWN0LmhlaWdodCA9IGFIZWlnaHQ7XG4gICAgICAgIHJldHVybiByZXN1bHRSZWN0O1xuICAgIH1cbiAgICBnbG9iYWxUb0xvY2FsUmVjdChheCA9IDAsIGF5ID0gMCwgYVdpZHRoID0gMCwgYUhlaWdodCA9IDAsIHJlc3VsdFJlY3QpIHtcbiAgICAgICAgaWYgKHJlc3VsdFJlY3QgPT0gbnVsbClcbiAgICAgICAgICAgIHJlc3VsdFJlY3QgPSBHT2JqZWN0LnNEcmFnSGVscGVyUmVjdDtcbiAgICAgICAgbGV0IHB0ID0gdGhpcy5nbG9iYWxUb0xvY2FsKGF4LCBheSk7XG4gICAgICAgIHJlc3VsdFJlY3QueCA9IHB0Lng7XG4gICAgICAgIHJlc3VsdFJlY3QueSA9IHB0Lnk7XG4gICAgICAgIHJlc3VsdFJlY3Qud2lkdGggPSBhV2lkdGg7XG4gICAgICAgIHJlc3VsdFJlY3QuaGVpZ2h0ID0gYUhlaWdodDtcbiAgICAgICAgcmV0dXJuIHJlc3VsdFJlY3Q7XG4gICAgfVxuICAgIGhhbmRsZUNvbnRyb2xsZXJDaGFuZ2VkKGMpIHtcbiAgICAgICAgdGhpcy4kaGFuZGxpbmdDb250cm9sbGVyID0gdHJ1ZTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4IC8qIENvdW50ICovOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBnZWFyID0gdGhpcy4kZ2VhcnNbaV07XG4gICAgICAgICAgICBpZiAoZ2VhciAhPSBudWxsICYmIGdlYXIuY29udHJvbGxlciA9PSBjKVxuICAgICAgICAgICAgICAgIGdlYXIuYXBwbHkoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiRoYW5kbGluZ0NvbnRyb2xsZXIgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jaGVja0dlYXJWaXNpYmxlKCk7XG4gICAgfVxuICAgIHN3aXRjaERpc3BsYXlPYmplY3QobmV3T2JqKSB7XG4gICAgICAgIGlmIChuZXdPYmogPT0gdGhpcy4kZGlzcGxheU9iamVjdClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbGV0IG9sZCA9IHRoaXMuJGRpc3BsYXlPYmplY3Q7XG4gICAgICAgIGlmICh0aGlzLmluQ29udGFpbmVyKSB7XG4gICAgICAgICAgICBsZXQgaSA9IHRoaXMuJGRpc3BsYXlPYmplY3QucGFyZW50LmdldENoaWxkSW5kZXgodGhpcy4kZGlzcGxheU9iamVjdCk7XG4gICAgICAgICAgICB0aGlzLiRkaXNwbGF5T2JqZWN0LnBhcmVudC5hZGRDaGlsZEF0KG5ld09iaiwgaSk7XG4gICAgICAgICAgICB0aGlzLiRkaXNwbGF5T2JqZWN0LnBhcmVudC5yZW1vdmVDaGlsZCh0aGlzLiRkaXNwbGF5T2JqZWN0KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiRkaXNwbGF5T2JqZWN0ID0gbmV3T2JqO1xuICAgICAgICB0aGlzLiRkaXNwbGF5T2JqZWN0LnggPSBvbGQueDtcbiAgICAgICAgdGhpcy4kZGlzcGxheU9iamVjdC55ID0gb2xkLnk7XG4gICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3Qucm90YXRpb24gPSBvbGQucm90YXRpb247XG4gICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3QuYWxwaGEgPSBvbGQuYWxwaGE7XG4gICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3QudmlzaWJsZSA9IG9sZC52aXNpYmxlO1xuICAgICAgICB0aGlzLiRkaXNwbGF5T2JqZWN0LnNjYWxlWCA9IG9sZC5zY2FsZVg7XG4gICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3Quc2NhbGVZID0gb2xkLnNjYWxlWTtcbiAgICAgICAgdGhpcy4kZGlzcGxheU9iamVjdC5tb3VzZUVuYWJsZWQgPSBvbGQubW91c2VFbmFibGVkO1xuICAgIH1cbiAgICBoYW5kbGVYWUNoYW5nZWQoKSB7XG4gICAgICAgIGlmICh0aGlzLiRkaXNwbGF5T2JqZWN0KSB7XG4gICAgICAgICAgICBsZXQgeHYgPSB0aGlzLiR4O1xuICAgICAgICAgICAgbGV0IHl2ID0gdGhpcy4keTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRwaXZvdEFzQW5jaG9yKSB7XG4gICAgICAgICAgICAgICAgeHYgLT0gdGhpcy4kcGl2b3QueCAqIHRoaXMuJHdpZHRoO1xuICAgICAgICAgICAgICAgIHl2IC09IHRoaXMuJHBpdm90LnkgKiB0aGlzLiRoZWlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy4kcGl4ZWxTbmFwcGluZykge1xuICAgICAgICAgICAgICAgIHh2ID0gTWF0aC5yb3VuZCh4dik7XG4gICAgICAgICAgICAgICAgeXYgPSBNYXRoLnJvdW5kKHl2KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3QueCA9IHh2ICsgdGhpcy4kcGl2b3RPZmZzZXQueDtcbiAgICAgICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3QueSA9IHl2ICsgdGhpcy4kcGl2b3RPZmZzZXQueTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBoYW5kbGVTaXplQ2hhbmdlZCgpIHsgfVxuICAgIGhhbmRsZVNjYWxlQ2hhbmdlZCgpIHtcbiAgICAgICAgaWYgKHRoaXMuJGRpc3BsYXlPYmplY3QpXG4gICAgICAgICAgICB0aGlzLiRkaXNwbGF5T2JqZWN0LnNjYWxlWCA9IHRoaXMuJHNjYWxlWDtcbiAgICAgICAgdGhpcy4kZGlzcGxheU9iamVjdC5zY2FsZVkgPSB0aGlzLiRzY2FsZVk7XG4gICAgfVxuICAgIGdldCBjb2xvckZpbHRlcigpIHtcbiAgICAgICAgaWYgKHRoaXMuJGNvbG9yRmlsdGVyKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGNvbG9yRmlsdGVyO1xuICAgICAgICAvKipcbiAgICAgICAgICogdG9kb1xuICAgICAgICAgKi9cbiAgICAgICAgdmFyIG1hdHJpeCA9IG5ldyBjcmVhdGVqcy5Db2xvck1hdHJpeCgpO1xuICAgICAgICB0aGlzLiRjb2xvckZpbHRlciA9IG5ldyBjcmVhdGVqcy5Db2xvck1hdHJpeEZpbHRlcihtYXRyaXgpO1xuICAgICAgICBpZiAodGhpcy4kZGlzcGxheU9iamVjdCkge1xuICAgICAgICAgICAgbGV0IGEgPSB0aGlzLiRkaXNwbGF5T2JqZWN0LmZpbHRlcnMgfHwgW107XG4gICAgICAgICAgICBhLnB1c2godGhpcy4kY29sb3JGaWx0ZXIpO1xuICAgICAgICAgICAgdGhpcy4kZGlzcGxheU9iamVjdC5maWx0ZXJzID0gYTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy4kY29sb3JGaWx0ZXI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHVwZGF0ZSBjb2xvciBhcHBlYXJhbmNlXG4gICAgICogQHBhcmFtIGJyaWdodG5lc3MgdmFsdWUgb2YgdGhlIGJyaWd0aG5lc3MgKC0xIC0gMSwgd2hlcmUgLTEgaXMgYmxhY2spXG4gICAgICogQHBhcmFtIGNvbnRyYXN0IHZhbHVlIG9mIHRoZSBjb250cmFzdCAoLTEgLSAxKVxuICAgICAqIEBwYXJhbSBzYXR1cmF0ZSBUaGUgc2F0dXJhdGlvbiBhbW91bnQgKC0xIC0gMSlcbiAgICAgKiBAcGFyYW0gaHVlIFRoZSBodWUgcHJvcGVydHkgb2YgdGhlIGNvbG9yIGluIGRlZ3Jlc3MgKC0xIC0gMSwgd2hlcmUgMSBpcyAzNjBkZWcpXG4gICAgICovXG4gICAgdXBkYXRlQ29sb3JDb21wb25lbnRzKGJyaWdodG5lc3MsIGNvbnRyYXN0LCBzYXR1cmF0ZSwgaHVlKSB7XG4gICAgICAgIHZhciBtYXRyaXggPSBuZXcgY3JlYXRlanMuQ29sb3JNYXRyaXgoKVxuICAgICAgICAgICAgLmFkanVzdEJyaWdodG5lc3MoYnJpZ2h0bmVzcylcbiAgICAgICAgICAgIC5hZGp1c3RDb250cmFzdChjb250cmFzdCAqIDEwMClcbiAgICAgICAgICAgIC5hZGp1c3RIdWUoaHVlICogMTgwKVxuICAgICAgICAgICAgLmFkanVzdFNhdHVyYXRpb24oc2F0dXJhdGUgKiAxMDApO1xuICAgICAgICB0aGlzLiRkaXNwbGF5T2JqZWN0LmZpbHRlcnMgPSBbbmV3IGNyZWF0ZWpzLkNvbG9yTWF0cml4RmlsdGVyKG1hdHJpeCldO1xuICAgICAgICB0aGlzLiRkaXNwbGF5T2JqZWN0LmNhY2hlKDAsIDAsIHRoaXMuJHdpZHRoLCB0aGlzLiRoZWlnaHQpO1xuICAgICAgICBpZiAoIXRoaXMuJGxhc3RDb2xvckNvbXBvbmVudHMpXG4gICAgICAgICAgICB0aGlzLiRsYXN0Q29sb3JDb21wb25lbnRzID0gW107XG4gICAgICAgIHRoaXMuJGxhc3RDb2xvckNvbXBvbmVudHMubGVuZ3RoID0gMDtcbiAgICAgICAgdGhpcy4kbGFzdENvbG9yQ29tcG9uZW50cy5wdXNoKGJyaWdodG5lc3MsIGNvbnRyYXN0LCBzYXR1cmF0ZSwgaHVlKTtcbiAgICB9XG4gICAgaGFuZGxlR3JheWVkQ2hhbmdlZCgpIHtcbiAgICAgICAgaWYgKHRoaXMuJGRpc3BsYXlPYmplY3QpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRncmF5ZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgR3JheXNjYWxlID0gbmV3IGNyZWF0ZWpzLkNvbG9yTWF0cml4RmlsdGVyKFtcbiAgICAgICAgICAgICAgICAgICAgMC4zLCAwLjMsIDAuMywgMCwgMCxcbiAgICAgICAgICAgICAgICAgICAgMC4zLCAwLjMsIDAuMywgMCwgMCxcbiAgICAgICAgICAgICAgICAgICAgMC4zLCAwLjMsIDAuMywgMCwgMCxcbiAgICAgICAgICAgICAgICAgICAgMCwgMCwgMCwgMSwgMCAvLyBhbHBoYVxuICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3QuZmlsdGVycyA9IFtHcmF5c2NhbGVdO1xuICAgICAgICAgICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3QuY2FjaGUoMCwgMCwgdGhpcy4kd2lkdGgsIHRoaXMuJGhlaWdodCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kbGFzdENvbG9yQ29tcG9uZW50cyAmJiB0aGlzLiRsYXN0Q29sb3JDb21wb25lbnRzLmxlbmd0aCA+PSA0KVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbG9yQ29tcG9uZW50cyh0aGlzLiRsYXN0Q29sb3JDb21wb25lbnRzWzBdLCB0aGlzLiRsYXN0Q29sb3JDb21wb25lbnRzWzFdLCB0aGlzLiRsYXN0Q29sb3JDb21wb25lbnRzWzJdLCB0aGlzLiRsYXN0Q29sb3JDb21wb25lbnRzWzNdKTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3QuZmlsdGVycyA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKkBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdEZyb21SZXNvdXJjZSgpIHtcbiAgICB9XG4gICAgc2V0dXBCZWZvcmVBZGQoeG1sKSB7XG4gICAgICAgIGxldCBzdHI7XG4gICAgICAgIGxldCBhcnI7XG4gICAgICAgIHRoaXMuJGlkID0geG1sLmF0dHJpYnV0ZXMuaWQ7XG4gICAgICAgIHRoaXMuJG5hbWUgPSB4bWwuYXR0cmlidXRlcy5uYW1lO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy54eTtcbiAgICAgICAgYXJyID0gc3RyLnNwbGl0KCcsJyk7XG4gICAgICAgIHRoaXMuc2V0WFkocGFyc2VJbnQoYXJyWzBdKSwgcGFyc2VJbnQoYXJyWzFdKSk7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnNpemU7XG4gICAgICAgIGlmIChzdHIpIHtcbiAgICAgICAgICAgIGFyciA9IHN0ci5zcGxpdCgnLCcpO1xuICAgICAgICAgICAgdGhpcy4kaW5pdFdpZHRoID0gcGFyc2VJbnQoYXJyWzBdKTtcbiAgICAgICAgICAgIHRoaXMuJGluaXRIZWlnaHQgPSBwYXJzZUludChhcnJbMV0pO1xuICAgICAgICAgICAgdGhpcy5zZXRTaXplKHRoaXMuJGluaXRXaWR0aCwgdGhpcy4kaW5pdEhlaWdodCwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMuc2NhbGU7XG4gICAgICAgIGlmIChzdHIpIHtcbiAgICAgICAgICAgIGFyciA9IHN0ci5zcGxpdCgnLCcpO1xuICAgICAgICAgICAgdGhpcy5zZXRTY2FsZShwYXJzZUZsb2F0KGFyclswXSksIHBhcnNlRmxvYXQoYXJyWzFdKSk7XG4gICAgICAgIH1cbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMucm90YXRpb247XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICB0aGlzLnJvdGF0aW9uID0gcGFyc2VJbnQoc3RyKTtcbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMuc2tldztcbiAgICAgICAgaWYgKHN0cikge1xuICAgICAgICAgICAgYXJyID0gc3RyLnNwbGl0KCcsJyk7XG4gICAgICAgICAgICB0aGlzLnNldFNrZXcocGFyc2VGbG9hdChhcnJbMF0pLCBwYXJzZUZsb2F0KGFyclsxXSkpO1xuICAgICAgICB9XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnBpdm90O1xuICAgICAgICBpZiAoc3RyKSB7XG4gICAgICAgICAgICBhcnIgPSBzdHIuc3BsaXQoJywnKTtcbiAgICAgICAgICAgIGxldCBuMSA9IHBhcnNlRmxvYXQoYXJyWzBdKSwgbjIgPSBwYXJzZUZsb2F0KGFyclsxXSk7XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5hbmNob3I7XG4gICAgICAgICAgICB0aGlzLnNldFBpdm90KG4xLCBuMiwgc3RyID09ICd0cnVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMuYWxwaGE7XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICB0aGlzLmFscGhhID0gcGFyc2VGbG9hdChzdHIpO1xuICAgICAgICBpZiAoeG1sLmF0dHJpYnV0ZXMudG91Y2hhYmxlID09ICdmYWxzZScpXG4gICAgICAgICAgICB0aGlzLnRvdWNoYWJsZSA9IGZhbHNlO1xuICAgICAgICBpZiAoeG1sLmF0dHJpYnV0ZXMudmlzaWJsZSA9PSAnZmFsc2UnKVxuICAgICAgICAgICAgdGhpcy52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIGlmICh4bWwuYXR0cmlidXRlcy5ncmF5ZWQgPT0gJ3RydWUnKVxuICAgICAgICAgICAgdGhpcy5ncmF5ZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLnRvb2x0aXBzID0geG1sLmF0dHJpYnV0ZXMudG9vbHRpcHM7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmJsZW5kO1xuICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgdGhpcy5ibGVuZE1vZGUgPSBzdHI7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmZpbHRlcjtcbiAgICAgICAgaWYgKHN0cikge1xuICAgICAgICAgICAgc3dpdGNoIChzdHIpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdjb2xvcic6XG4gICAgICAgICAgICAgICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmZpbHRlckRhdGE7XG4gICAgICAgICAgICAgICAgICAgIGFyciA9IHN0ci5zcGxpdCgnLCcpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbG9yQ29tcG9uZW50cyhwYXJzZUZsb2F0KGFyclswXSksIHBhcnNlRmxvYXQoYXJyWzFdKSwgcGFyc2VGbG9hdChhcnJbMl0pLCBwYXJzZUZsb2F0KGFyclszXSkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXR1cEFmdGVyQWRkKHhtbCkge1xuICAgICAgICBsZXQgc3RyID0geG1sLmF0dHJpYnV0ZXMuZ3JvdXA7XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICB0aGlzLiRncm91cCA9IHRoaXMuJHBhcmVudC5nZXRDaGlsZEJ5SWQoc3RyKTtcbiAgICAgICAgbGV0IGNvbCA9IHhtbC5jaGlsZHJlbjtcbiAgICAgICAgY29sLmZvckVhY2goY3htbCA9PiB7XG4gICAgICAgICAgICBsZXQgaW5kZXggPSBHZWFyWE1MTm9kZU5hbWVNYXBbY3htbC5ub2RlTmFtZV07XG4gICAgICAgICAgICBpZiAoaW5kZXggIT0gdm9pZCAwKVxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0R2VhcihpbmRleCkuc2V0dXAoY3htbCk7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgIH1cbiAgICBzdGF0aWMgY2FzdEZyb21OYXRpdmVPYmplY3QoZGlzcCkge1xuICAgICAgICBpZiAoaXNVSU9iamVjdChkaXNwKSlcbiAgICAgICAgICAgIHJldHVybiBkaXNwLlVJT3duZXI7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBpbml0RHJhZygpIHtcbiAgICAgICAgaWYgKHRoaXMuJGRyYWdnYWJsZSlcbiAgICAgICAgICAgIHRoaXMub24oSW50ZXJhY3RpdmVFdmVudHMuRG93biwgdGhpcy4kdG91Y2hCZWdpbiwgdGhpcyk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRoaXMub2ZmKEludGVyYWN0aXZlRXZlbnRzLkRvd24sIHRoaXMuJHRvdWNoQmVnaW4pO1xuICAgIH1cbiAgICBkcmFnQmVnaW4oKSB7XG4gICAgICAgIGlmIChHT2JqZWN0LmRyYWdnaW5nT2JqZWN0ICE9IG51bGwpXG4gICAgICAgICAgICBHT2JqZWN0LmRyYWdnaW5nT2JqZWN0LnN0b3BEcmFnKCk7XG4gICAgICAgIEdPYmplY3Quc0dsb2JhbERyYWdTdGFydC54ID0gRGVjbHMkMS5HUm9vdC5nbG9iYWxNb3VzZVN0YXR1cy5tb3VzZVg7XG4gICAgICAgIEdPYmplY3Quc0dsb2JhbERyYWdTdGFydC55ID0gRGVjbHMkMS5HUm9vdC5nbG9iYWxNb3VzZVN0YXR1cy5tb3VzZVk7XG4gICAgICAgIHRoaXMubG9jYWxUb0dsb2JhbFJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQsIEdPYmplY3Quc0dsb2JhbFJlY3QpO1xuICAgICAgICBHT2JqZWN0LmRyYWdnaW5nT2JqZWN0ID0gdGhpcztcbiAgICAgICAgdGhpcy4kbW91c2VNb3ZlMkV2ZW50ID0gRGVjbHMkMS5HUm9vdC5pbnN0Lm5hdGl2ZVN0YWdlLm9uKEludGVyYWN0aXZlRXZlbnRzLk1vdmUsIHRoaXMuJG1vdmluZzIsIHRoaXMpO1xuICAgICAgICB0aGlzLiRtb3VzZVVwMkV2ZW50ID0gRGVjbHMkMS5HUm9vdC5pbnN0Lm5hdGl2ZVN0YWdlLm9uKEludGVyYWN0aXZlRXZlbnRzLlVwLCB0aGlzLiRlbmQyLCB0aGlzKTtcbiAgICB9XG4gICAgZHJhZ0VuZCgpIHtcbiAgICAgICAgaWYgKEdPYmplY3QuZHJhZ2dpbmdPYmplY3QgPT0gdGhpcykge1xuICAgICAgICAgICAgRGVjbHMkMS5HUm9vdC5pbnN0Lm5hdGl2ZVN0YWdlLm9mZihJbnRlcmFjdGl2ZUV2ZW50cy5Nb3ZlLCB0aGlzLiRtb3VzZU1vdmUyRXZlbnQpO1xuICAgICAgICAgICAgRGVjbHMkMS5HUm9vdC5pbnN0Lm5hdGl2ZVN0YWdlLm9mZihJbnRlcmFjdGl2ZUV2ZW50cy5VcCwgdGhpcy4kbW91c2VVcDJFdmVudCk7XG4gICAgICAgICAgICBHT2JqZWN0LmRyYWdnaW5nT2JqZWN0ID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBHT2JqZWN0LiRkcmFnQmVnaW5DYW5jZWxsZWQgPSB0cnVlO1xuICAgIH1cbiAgICByZXNldCgpIHtcbiAgICAgICAgRGVjbHMkMS5HUm9vdC5pbnN0Lm5hdGl2ZVN0YWdlLm9mZihJbnRlcmFjdGl2ZUV2ZW50cy5Nb3ZlLCB0aGlzLiRtb3VzZU1vdmVFdmVudCk7XG4gICAgICAgIERlY2xzJDEuR1Jvb3QuaW5zdC5uYXRpdmVTdGFnZS5vZmYoSW50ZXJhY3RpdmVFdmVudHMuVXAsIHRoaXMuJG1vdXNlVXBFdmVudCk7XG4gICAgfVxuICAgICR0b3VjaEJlZ2luKGV2dCkge1xuICAgICAgICBpZiAodGhpcy4kdG91Y2hEb3duUG9pbnQgPT0gbnVsbClcbiAgICAgICAgICAgIHRoaXMuJHRvdWNoRG93blBvaW50ID0gbmV3IGNyZWF0ZWpzLlBvaW50KCk7XG4gICAgICAgIHRoaXMuJHRvdWNoRG93blBvaW50LnggPSBldnQuc3RhZ2VYO1xuICAgICAgICB0aGlzLiR0b3VjaERvd25Qb2ludC55ID0gZXZ0LnN0YWdlWTtcbiAgICAgICAgdGhpcy4kbW91c2VNb3ZlRXZlbnQgPSBEZWNscyQxLkdSb290Lmluc3QubmF0aXZlU3RhZ2Uub24oSW50ZXJhY3RpdmVFdmVudHMuTW92ZSwgdGhpcy4kbW92aW5nLCB0aGlzKTtcbiAgICAgICAgdGhpcy4kbW91c2VVcEV2ZW50ID0gRGVjbHMkMS5HUm9vdC5pbnN0Lm5hdGl2ZVN0YWdlLm9uKEludGVyYWN0aXZlRXZlbnRzLlVwLCB0aGlzLiRlbmQsIHRoaXMpO1xuICAgIH1cbiAgICAkZW5kKGV2dCkge1xuICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgfVxuICAgICRtb3ZpbmcoZXZ0KSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwibW92aW5nXCIpO1xuICAgICAgICBsZXQgc2Vuc2l0aXZpdHkgPSBVSUNvbmZpZy50b3VjaERyYWdTZW5zaXRpdml0eTtcbiAgICAgICAgaWYgKHRoaXMuJHRvdWNoRG93blBvaW50ICE9IG51bGwgJiZcbiAgICAgICAgICAgIE1hdGguYWJzKHRoaXMuJHRvdWNoRG93blBvaW50LnggLSBldnQuc3RhZ2VYKSA8IHNlbnNpdGl2aXR5ICYmXG4gICAgICAgICAgICBNYXRoLmFicyh0aGlzLiR0b3VjaERvd25Qb2ludC55IC0gZXZ0LnN0YWdlWSkgPCBzZW5zaXRpdml0eSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICBHT2JqZWN0LiRkcmFnQmVnaW5DYW5jZWxsZWQgPSBmYWxzZTtcbiAgICAgICAgbGV0IGV2ZW50ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KFwiX19kcmFnU3RhcnRcIiAvKiBTVEFSVCAqLywgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICBldmVudC5kYXRhID0geyBjdXJyZW50VGFyZ2V0OiB0aGlzLiRkaXNwbGF5T2JqZWN0IH07XG4gICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3QuZGlzcGF0Y2hFdmVudChldmVudCwgdGhpcyk7XG4gICAgICAgIGlmICghR09iamVjdC4kZHJhZ0JlZ2luQ2FuY2VsbGVkKVxuICAgICAgICAgICAgLy91c2VyIG1heSBjYWxsIG9iai5zdG9wRHJhZyBpbiB0aGUgRHJhZ1N0YXJ0IGV2ZW50IGhhbmRsZXJcbiAgICAgICAgICAgIHRoaXMuZHJhZ0JlZ2luKCk7XG4gICAgfVxuICAgICRtb3ZpbmcyKGV2dCkge1xuICAgICAgICBsZXQgeHggPSBldnQuc3RhZ2VYIC0gR09iamVjdC5zR2xvYmFsRHJhZ1N0YXJ0LnggKyBHT2JqZWN0LnNHbG9iYWxSZWN0Lng7XG4gICAgICAgIGxldCB5eSA9IGV2dC5zdGFnZVkgLSBHT2JqZWN0LnNHbG9iYWxEcmFnU3RhcnQueSArIEdPYmplY3Quc0dsb2JhbFJlY3QueTtcbiAgICAgICAgaWYgKHRoaXMuJGRyYWdCb3VuZHMgIT0gbnVsbCkge1xuICAgICAgICAgICAgbGV0IHJlY3QgPSBEZWNscyQxLkdSb290Lmluc3QubG9jYWxUb0dsb2JhbFJlY3QodGhpcy4kZHJhZ0JvdW5kcy54LCB0aGlzLiRkcmFnQm91bmRzLnksIHRoaXMuJGRyYWdCb3VuZHMud2lkdGgsIHRoaXMuJGRyYWdCb3VuZHMuaGVpZ2h0LCBHT2JqZWN0LnNEcmFnSGVscGVyUmVjdCk7XG4gICAgICAgICAgICBpZiAoeHggPCByZWN0LngpXG4gICAgICAgICAgICAgICAgeHggPSByZWN0Lng7XG4gICAgICAgICAgICBlbHNlIGlmICh4eCArIEdPYmplY3Quc0dsb2JhbFJlY3Qud2lkdGggPiByZWN0LnggKyByZWN0LndpZHRoKSB7XG4gICAgICAgICAgICAgICAgeHggPSByZWN0LnggKyByZWN0LndpZHRoIC0gR09iamVjdC5zR2xvYmFsUmVjdC53aWR0aDtcbiAgICAgICAgICAgICAgICBpZiAoeHggPCByZWN0LngpXG4gICAgICAgICAgICAgICAgICAgIHh4ID0gcmVjdC54O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHl5IDwgcmVjdC55KVxuICAgICAgICAgICAgICAgIHl5ID0gcmVjdC55O1xuICAgICAgICAgICAgZWxzZSBpZiAoeXkgKyBHT2JqZWN0LnNHbG9iYWxSZWN0LmhlaWdodCA+IHJlY3QueSArIHJlY3QuaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgeXkgPSByZWN0LnkgKyByZWN0LmhlaWdodCAtIEdPYmplY3Quc0dsb2JhbFJlY3QuaGVpZ2h0O1xuICAgICAgICAgICAgICAgIGlmICh5eSA8IHJlY3QueSlcbiAgICAgICAgICAgICAgICAgICAgeXkgPSByZWN0Lnk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgR09iamVjdC5zVXBkYXRpbmdXaGlsZURyYWdnaW5nID0gdHJ1ZTtcbiAgICAgICAgR09iamVjdC5zSGVscGVyUG9pbnQueCA9IHh4O1xuICAgICAgICBHT2JqZWN0LnNIZWxwZXJQb2ludC55ID0geXk7XG4gICAgICAgIGxldCBwdCA9IHRoaXMucGFyZW50Lmdsb2JhbFRvTG9jYWwoeHgsIHl5LCBHT2JqZWN0LnNIZWxwZXJQb2ludCk7XG4gICAgICAgIHRoaXMuc2V0WFkoTWF0aC5yb3VuZChwdC54KSwgTWF0aC5yb3VuZChwdC55KSk7XG4gICAgICAgIEdPYmplY3Quc1VwZGF0aW5nV2hpbGVEcmFnZ2luZyA9IGZhbHNlO1xuICAgICAgICBsZXQgY3VycmVudFRhcmdldCA9IHRoaXMuJGRpc3BsYXlPYmplY3Q7XG4gICAgICAgIGxldCBldmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudChcIl9fZHJhZ01vdmluZ1wiIC8qIE1PVklORyAqLywgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICBldmVudC5kYXRhID0geyBjdXJyZW50VGFyZ2V0IH07XG4gICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3QuZGlzcGF0Y2hFdmVudChldmVudCwgdGhpcyk7XG4gICAgfVxuICAgICRlbmQyKGV2dCkge1xuICAgICAgICBpZiAoR09iamVjdC5kcmFnZ2luZ09iamVjdCA9PSB0aGlzKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3BEcmFnKCk7XG4gICAgICAgICAgICBsZXQgY3VycmVudFRhcmdldCA9IHRoaXMuJGRpc3BsYXlPYmplY3Q7XG4gICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoXCJfX2RyYWdFbmRcIiAvKiBFTkQgKi8sIHRydWUsIGZhbHNlKTtcbiAgICAgICAgICAgIGV2ZW50LmRhdGEgPSB7IGN1cnJlbnRUYXJnZXQgfTtcbiAgICAgICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3QuZGlzcGF0Y2hFdmVudChldmVudCwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG59XG5HT2JqZWN0LmdJbnN0YW5jZUNvdW50ZXIgPSAwO1xuLy9kcmFnZ2luZ1xuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5HT2JqZWN0LnNHbG9iYWxEcmFnU3RhcnQgPSBuZXcgY3JlYXRlanMuUG9pbnQoKTtcbkdPYmplY3Quc0dsb2JhbFJlY3QgPSBuZXcgY3JlYXRlanMuUmVjdGFuZ2xlKCk7XG5HT2JqZWN0LnNIZWxwZXJQb2ludCA9IG5ldyBjcmVhdGVqcy5Qb2ludCgpO1xuR09iamVjdC5zRHJhZ0hlbHBlclJlY3QgPSBuZXcgY3JlYXRlanMuUmVjdGFuZ2xlKCk7XG5sZXQgRGVjbHMkMSA9IHt9O1xuXG5jbGFzcyBHR3JvdXAgZXh0ZW5kcyBHT2JqZWN0IHtcbiAgICBjcmVhdGVEaXNwbGF5T2JqZWN0KCkge1xuICAgICAgICBsZXQgYyA9IG5ldyBVSUNvbnRhaW5lcih0aGlzKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHRvZG9cbiAgICAgICAgICovXG4gICAgICAgIC8vIGMuaW50ZXJhY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgYy5tb3VzZUVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zZXREaXNwbGF5T2JqZWN0KGMpO1xuICAgIH1cbiAgICB1cGRhdGVCb3VuZHMoKSB7XG4gICAgICAgIGlmICh0aGlzLiR1cGRhdGluZyB8fCAhdGhpcy5wYXJlbnQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGxldCBjbnQgPSB0aGlzLiRwYXJlbnQubnVtQ2hpbGRyZW47XG4gICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgbGV0IGF4ID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCBheSA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWTtcbiAgICAgICAgbGV0IGFyID0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLCBhYiA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWTtcbiAgICAgICAgdGhpcy4kZW1wdHkgPSB0cnVlO1xuICAgICAgICBsZXQgY2hpbGQ7XG4gICAgICAgIGxldCB0bXAgPSAwO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY250OyBpKyspIHtcbiAgICAgICAgICAgIGNoaWxkID0gdGhpcy4kcGFyZW50LmdldENoaWxkQXQoaSk7XG4gICAgICAgICAgICBpZiAoY2hpbGQuZ3JvdXAgPT0gdGhpcykge1xuICAgICAgICAgICAgICAgIHRtcCA9IGNoaWxkLng7XG4gICAgICAgICAgICAgICAgaWYgKHRtcCA8IGF4KVxuICAgICAgICAgICAgICAgICAgICBheCA9IHRtcDtcbiAgICAgICAgICAgICAgICB0bXAgPSBjaGlsZC55O1xuICAgICAgICAgICAgICAgIGlmICh0bXAgPCBheSlcbiAgICAgICAgICAgICAgICAgICAgYXkgPSB0bXA7XG4gICAgICAgICAgICAgICAgdG1wID0gY2hpbGQueCArIGNoaWxkLndpZHRoO1xuICAgICAgICAgICAgICAgIGlmICh0bXAgPiBhcilcbiAgICAgICAgICAgICAgICAgICAgYXIgPSB0bXA7XG4gICAgICAgICAgICAgICAgdG1wID0gY2hpbGQueSArIGNoaWxkLmhlaWdodDtcbiAgICAgICAgICAgICAgICBpZiAodG1wID4gYWIpXG4gICAgICAgICAgICAgICAgICAgIGFiID0gdG1wO1xuICAgICAgICAgICAgICAgIHRoaXMuJGVtcHR5ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kdXBkYXRpbmcgPSB0cnVlO1xuICAgICAgICBpZiAoIXRoaXMuJGVtcHR5KSB7XG4gICAgICAgICAgICB0aGlzLnNldFhZKGF4LCBheSk7XG4gICAgICAgICAgICB0aGlzLnNldFNpemUoYXIgLSBheCwgYWIgLSBheSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy5zZXRTaXplKDAsIDApO1xuICAgICAgICB0aGlzLiR1cGRhdGluZyA9IGZhbHNlO1xuICAgIH1cbiAgICBzZXRYWSh4diwgeXYpIHtcbiAgICAgICAgaWYgKHRoaXMuJHggIT0geHYgfHwgdGhpcy4keSAhPSB5dikge1xuICAgICAgICAgICAgbGV0IGR4ID0geHYgLSB0aGlzLiR4O1xuICAgICAgICAgICAgbGV0IGR5ID0geXYgLSB0aGlzLiR5O1xuICAgICAgICAgICAgc3VwZXIuc2V0WFkoeHYsIHl2KTtcbiAgICAgICAgICAgIHRoaXMubW92ZUNoaWxkcmVuKGR4LCBkeSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbW92ZUNoaWxkcmVuKGR4LCBkeSkge1xuICAgICAgICBpZiAodGhpcy4kdXBkYXRpbmcgfHwgIXRoaXMuJHBhcmVudClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy4kdXBkYXRpbmcgPSB0cnVlO1xuICAgICAgICBsZXQgY250ID0gdGhpcy4kcGFyZW50Lm51bUNoaWxkcmVuO1xuICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgIGxldCBjaGlsZDtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNudDsgaSsrKSB7XG4gICAgICAgICAgICBjaGlsZCA9IHRoaXMuJHBhcmVudC5nZXRDaGlsZEF0KGkpO1xuICAgICAgICAgICAgaWYgKGNoaWxkLmdyb3VwID09IHRoaXMpIHtcbiAgICAgICAgICAgICAgICBjaGlsZC5zZXRYWShjaGlsZC54ICsgZHgsIGNoaWxkLnkgKyBkeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kdXBkYXRpbmcgPSBmYWxzZTtcbiAgICB9XG4gICAgdXBkYXRlQWxwaGEoKSB7XG4gICAgICAgIHN1cGVyLnVwZGF0ZUFscGhhKCk7XG4gICAgICAgIGlmICh0aGlzLiRpblByb2dyZXNzQnVpbGRpbmcpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGxldCBjbnQgPSB0aGlzLiRwYXJlbnQubnVtQ2hpbGRyZW47XG4gICAgICAgIGxldCBpO1xuICAgICAgICBsZXQgY2hpbGQ7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBjbnQ7IGkrKykge1xuICAgICAgICAgICAgY2hpbGQgPSB0aGlzLiRwYXJlbnQuZ2V0Q2hpbGRBdChpKTtcbiAgICAgICAgICAgIGlmIChjaGlsZC5ncm91cCA9PSB0aGlzKVxuICAgICAgICAgICAgICAgIGNoaWxkLmFscGhhID0gdGhpcy5hbHBoYTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuY2xhc3MgVUlTcHJpdGUgZXh0ZW5kcyBjcmVhdGVqcy5TaGFwZSB7XG4gICAgY29uc3RydWN0b3Iob3duZXIpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5VSU93bmVyID0gb3duZXI7XG4gICAgICAgIHRoaXMubW91c2VFbmFibGVkID0gZmFsc2U7XG4gICAgICAgIC8vIHRoaXMuaW50ZXJhY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgLy8gdGhpcy5pbnRlcmFjdGl2ZUNoaWxkcmVuID0gZmFsc2U7XG4gICAgfVxufVxuXG5jbGFzcyBHR3JhcGggZXh0ZW5kcyBHT2JqZWN0IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy4kdHlwZSA9IDA7XG4gICAgICAgIHRoaXMuJGxpbmVTaXplID0gMTtcbiAgICAgICAgdGhpcy4kc2lkZXMgPSAwO1xuICAgICAgICB0aGlzLiRzdGFydEFuZ2xlID0gMDtcbiAgICAgICAgdGhpcy4kcG9pbnRzID0gW107XG4gICAgICAgIHRoaXMuJGxpbmVTaXplID0gMTtcbiAgICAgICAgdGhpcy4kbGluZUNvbG9yID0gJyMwMDAwMDAnO1xuICAgICAgICB0aGlzLiRmaWxsQ29sb3IgPSAnI0ZGRkZGRic7XG4gICAgfVxuICAgIGRyYXdSZWN0KGxpbmVTaXplLCBsaW5lQ29sb3IsIGZpbGxDb2xvcikge1xuICAgICAgICB0aGlzLiR0eXBlID0gMTtcbiAgICAgICAgdGhpcy4kbGluZVNpemUgPSBsaW5lU2l6ZTtcbiAgICAgICAgdGhpcy4kbGluZUNvbG9yID0gbGluZUNvbG9yO1xuICAgICAgICB0aGlzLiRmaWxsQ29sb3IgPSBmaWxsQ29sb3I7XG4gICAgICAgIHRoaXMuZHJhd0dyYXBoKCk7XG4gICAgfVxuICAgIGRyYXdFbGxpcHNlKGxpbmVTaXplLCBsaW5lQ29sb3IsIGZpbGxDb2xvcikge1xuICAgICAgICB0aGlzLiR0eXBlID0gMjtcbiAgICAgICAgdGhpcy4kbGluZVNpemUgPSBsaW5lU2l6ZTtcbiAgICAgICAgdGhpcy4kbGluZUNvbG9yID0gbGluZUNvbG9yO1xuICAgICAgICB0aGlzLiRmaWxsQ29sb3IgPSBmaWxsQ29sb3I7XG4gICAgICAgIHRoaXMuZHJhd0dyYXBoKCk7XG4gICAgfVxuICAgIGdldCBjb2xvcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGZpbGxDb2xvcjtcbiAgICB9XG4gICAgc2V0IGNvbG9yKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuJGZpbGxDb2xvciA9IHZhbHVlO1xuICAgICAgICBpZiAodGhpcy4kdHlwZSAhPSAwKVxuICAgICAgICAgICAgdGhpcy5kcmF3R3JhcGgoKTtcbiAgICB9XG4gICAgZHJhd0dyYXBoKCkge1xuICAgICAgICBsZXQgc2hhcGUgPSB0aGlzLiRkaXNwbGF5T2JqZWN0O1xuICAgICAgICBsZXQgZyA9IHNoYXBlLmdyYXBoaWNzO1xuICAgICAgICBnLmNsZWFyKCk7XG4gICAgICAgIGxldCB3ID0gdGhpcy53aWR0aDtcbiAgICAgICAgbGV0IGggPSB0aGlzLmhlaWdodDtcbiAgICAgICAgaWYgKHcgPT0gMCB8fCBoID09IDApXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGcuYmVnaW5TdHJva2UodGhpcy4kbGluZUNvbG9yKTtcbiAgICAgICAgaWYgKHRoaXMuJGxpbmVTaXplID09IDApIHtcbiAgICAgICAgICAgIGcuc2V0U3Ryb2tlU3R5bGUoMC4xKTsgLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9DcmVhdGVKUy9FYXNlbEpTL2lzc3Vlcy83MzRcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGcuc2V0U3Ryb2tlU3R5bGUodGhpcy4kbGluZVNpemUpO1xuICAgICAgICAgICAgdyAtPSB0aGlzLiRsaW5lU2l6ZTtcbiAgICAgICAgICAgIGggLT0gdGhpcy4kbGluZVNpemU7XG4gICAgICAgIH1cbiAgICAgICAgZy5iZWdpbkZpbGwodGhpcy4kZmlsbENvbG9yKTtcbiAgICAgICAgaWYgKHRoaXMuJHR5cGUgPT0gMSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuJGNvcm5lciAmJiB0aGlzLiRjb3JuZXIubGVuZ3RoID49IDEpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kY29ybmVyLmxlbmd0aCA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGcuZHJhd1JvdW5kUmVjdCh0aGlzLiRsaW5lU2l6ZSAvIDIsIHRoaXMuJGxpbmVTaXplIC8gMiwgdywgaCwgdGhpcy4kY29ybmVyWzBdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGcuZHJhd1JvdW5kUmVjdENvbXBsZXgodGhpcy4kbGluZVNpemUgLyAyLCB0aGlzLiRsaW5lU2l6ZSAvIDIsIHcsIGgsIHRoaXMuJGNvcm5lclswXSwgdGhpcy4kY29ybmVyWzFdLCB0aGlzLiRjb3JuZXJbM10sIHRoaXMuJGNvcm5lclsyXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZy5kcmF3UmVjdCh0aGlzLiRsaW5lU2l6ZSAvIDIsIHRoaXMuJGxpbmVTaXplIC8gMiwgdywgaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy4kdHlwZSA9PSAyKSB7XG4gICAgICAgICAgICBsZXQgaGFsZlcgPSB3ICogMC41O1xuICAgICAgICAgICAgaWYgKHcgPT0gaClcbiAgICAgICAgICAgICAgICBnLmRyYXdDaXJjbGUoaGFsZlcgKyB0aGlzLiRsaW5lU2l6ZSAvIDIsIGhhbGZXICsgdGhpcy4kbGluZVNpemUgLyAyLCBoYWxmVyk7XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB3ID0gdyAtIHRoaXMuJGxpbmVTaXplO1xuICAgICAgICAgICAgICAgIGggPSBoIC0gdGhpcy4kbGluZVNpemU7XG4gICAgICAgICAgICAgICAgZy5kcmF3RWxsaXBzZSh0aGlzLiRsaW5lU2l6ZSAvIDIsIHRoaXMuJGxpbmVTaXplIC8gMiwgdywgaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy4kdHlwZSA9PSAzKSB7XG4gICAgICAgICAgICBsZXQgcmFkaXVzID0gdyA+IGggPyB3IC8gMiA6IGggLyAyO1xuICAgICAgICAgICAgZy5kcmF3UG9seVN0YXIoMCArIHJhZGl1cywgMCArIHJhZGl1cywgcmFkaXVzLCB0aGlzLiRzaWRlcywgMCwgdGhpcy4kc3RhcnRBbmdsZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy4kdHlwZSA9PSA0KSB7XG4gICAgICAgICAgICBVdGlscy5maWxsUGF0aChnLCB0aGlzLiRwb2ludHMsIDAsIDApO1xuICAgICAgICB9XG4gICAgICAgIGcuZW5kRmlsbCgpO1xuICAgICAgICBzaGFwZS5jYWNoZSgwLCAwLCB0aGlzLiR3aWR0aCwgdGhpcy4kaGVpZ2h0KTtcbiAgICB9XG4gICAgcmVwbGFjZU1lKHRhcmdldCkge1xuICAgICAgICBpZiAoIXRoaXMuJHBhcmVudClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigncGFyZW50IG5vdCBzZXQnKTtcbiAgICAgICAgdGFyZ2V0Lm5hbWUgPSB0aGlzLm5hbWU7XG4gICAgICAgIHRhcmdldC5hbHBoYSA9IHRoaXMuYWxwaGE7XG4gICAgICAgIHRhcmdldC5yb3RhdGlvbiA9IHRoaXMucm90YXRpb247XG4gICAgICAgIHRhcmdldC52aXNpYmxlID0gdGhpcy52aXNpYmxlO1xuICAgICAgICB0YXJnZXQudG91Y2hhYmxlID0gdGhpcy50b3VjaGFibGU7XG4gICAgICAgIHRhcmdldC5ncmF5ZWQgPSB0aGlzLmdyYXllZDtcbiAgICAgICAgdGFyZ2V0LnNldFhZKHRoaXMueCwgdGhpcy55KTtcbiAgICAgICAgdGFyZ2V0LnNldFNpemUodGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICBsZXQgaW5kZXggPSB0aGlzLiRwYXJlbnQuZ2V0Q2hpbGRJbmRleCh0aGlzKTtcbiAgICAgICAgdGhpcy4kcGFyZW50LmFkZENoaWxkQXQodGFyZ2V0LCBpbmRleCk7XG4gICAgICAgIHRhcmdldC5yZWxhdGlvbnMuY29weUZyb20odGhpcy5yZWxhdGlvbnMpO1xuICAgICAgICB0aGlzLiRwYXJlbnQucmVtb3ZlQ2hpbGQodGhpcywgdHJ1ZSk7XG4gICAgfVxuICAgIGFkZEJlZm9yZU1lKHRhcmdldCkge1xuICAgICAgICBpZiAodGhpcy4kcGFyZW50ID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3BhcmVudCBub3Qgc2V0Jyk7XG4gICAgICAgIGxldCBpbmRleCA9IHRoaXMuJHBhcmVudC5nZXRDaGlsZEluZGV4KHRoaXMpO1xuICAgICAgICB0aGlzLiRwYXJlbnQuYWRkQ2hpbGRBdCh0YXJnZXQsIGluZGV4KTtcbiAgICB9XG4gICAgYWRkQWZ0ZXJNZSh0YXJnZXQpIHtcbiAgICAgICAgaWYgKHRoaXMuJHBhcmVudCA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdwYXJlbnQgbm90IHNldCcpO1xuICAgICAgICBsZXQgaW5kZXggPSB0aGlzLiRwYXJlbnQuZ2V0Q2hpbGRJbmRleCh0aGlzKTtcbiAgICAgICAgaW5kZXgrKztcbiAgICAgICAgdGhpcy4kcGFyZW50LmFkZENoaWxkQXQodGFyZ2V0LCBpbmRleCk7XG4gICAgfVxuICAgIGNyZWF0ZURpc3BsYXlPYmplY3QoKSB7XG4gICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3QgPSBuZXcgVUlTcHJpdGUodGhpcyk7XG4gICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3QubW91c2VFbmFibGVkID0gdHJ1ZTtcbiAgICB9XG4gICAgaGFuZGxlU2l6ZUNoYW5nZWQoKSB7XG4gICAgICAgIGlmICh0aGlzLiR0eXBlICE9IDApXG4gICAgICAgICAgICB0aGlzLmRyYXdHcmFwaCgpO1xuICAgIH1cbiAgICBzZXR1cEJlZm9yZUFkZCh4bWwpIHtcbiAgICAgICAgc3VwZXIuc2V0dXBCZWZvcmVBZGQoeG1sKTtcbiAgICAgICAgbGV0IHR5cGUgPSB4bWwuYXR0cmlidXRlcy50eXBlO1xuICAgICAgICBpZiAodHlwZSAmJiB0eXBlICE9ICdlbXB0eScpIHtcbiAgICAgICAgICAgIGxldCBzdHI7XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5saW5lU2l6ZTtcbiAgICAgICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICAgICAgdGhpcy4kbGluZVNpemUgPSBwYXJzZUludChzdHIpO1xuICAgICAgICAgICAgbGV0IGM7XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5saW5lQ29sb3I7XG4gICAgICAgICAgICBpZiAoc3RyKSB7XG4gICAgICAgICAgICAgICAgYyA9IFN0cmluZ1V0aWwuY29udmVydFRvUkdCQShzdHIpO1xuICAgICAgICAgICAgICAgIHRoaXMuJGxpbmVDb2xvciA9IGM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5maWxsQ29sb3I7XG4gICAgICAgICAgICBpZiAoc3RyKSB7XG4gICAgICAgICAgICAgICAgYyA9IFN0cmluZ1V0aWwuY29udmVydFRvUkdCQShzdHIpO1xuICAgICAgICAgICAgICAgIHRoaXMuJGZpbGxDb2xvciA9IGM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgYXJyO1xuICAgICAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMuY29ybmVyO1xuICAgICAgICAgICAgaWYgKHN0cikge1xuICAgICAgICAgICAgICAgIGFyciA9IHN0ci5zcGxpdCgnLCcpO1xuICAgICAgICAgICAgICAgIGlmIChhcnIubGVuZ3RoID4gMSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kY29ybmVyID0gW3BhcnNlSW50KGFyclswXSksIHBhcnNlSW50KGFyclsxXSksIHBhcnNlSW50KGFyclsyXSksIHBhcnNlSW50KGFyclszXSldO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kY29ybmVyID0gW3BhcnNlSW50KGFyclswXSldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGUgPT0gJ3JlY3QnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kdHlwZSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlID09ICdlY2xpcHNlJykge1xuICAgICAgICAgICAgICAgIHRoaXMuJHR5cGUgPSAyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PSAncmVndWxhcl9wb2x5Z29uJykge1xuICAgICAgICAgICAgICAgIHRoaXMuJHR5cGUgPSAzO1xuICAgICAgICAgICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnNpZGVzO1xuICAgICAgICAgICAgICAgIGlmIChzdHIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc2lkZXMgPSBwYXJzZUludChzdHIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5zdGFydEFuZ2xlO1xuICAgICAgICAgICAgICAgIGlmIChzdHIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc3RhcnRBbmdsZSA9IHBhcnNlSW50KHN0cik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PSAncG9seWdvbicpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiR0eXBlID0gNDtcbiAgICAgICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5wb2ludHM7XG4gICAgICAgICAgICAgICAgaWYgKHN0cikge1xuICAgICAgICAgICAgICAgICAgICBhcnIgPSBzdHIuc3BsaXQoJywnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kcG9pbnRzID0gYXJyLm1hcChwb2ludCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQocG9pbnQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmRyYXdHcmFwaCgpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5jbGFzcyBCaXRtYXAgZXh0ZW5kcyBTcHJpdGUge1xuICAgIGNvbnN0cnVjdG9yKGl0ZW0pIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgaWYgKGl0ZW0pIHtcbiAgICAgICAgICAgIGxldCB7IHdpZHRoLCBoZWlnaHQsIHRleHR1cmUsIGlkIH0gPSBpdGVtO1xuICAgICAgICAgICAgdGhpcy4kZnJhbWVJZCA9IGlkO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB0ZXh0dXJlID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0dXJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0dXJlLnNyYyA9IHRleHR1cmU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRleHR1cmUgPSB0ZXh0dXJlLmltYWdlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zb3VyY2VSZWN0ID0gbmV3IGNyZWF0ZWpzLlJlY3RhbmdsZSgwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgICAgIHRoaXMudGV4dHVyZVJlY3QgPSB0ZXh0dXJlLnJlY3Q7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZHJhdyhjdHgsIGlnbm9yZUNhY2hlKSB7XG4gICAgICAgIGxldCBmbGFnID0gc3VwZXIuZHJhdyhjdHgsIGlnbm9yZUNhY2hlKTtcbiAgICAgICAgaWYgKGZsYWcpIHtcbiAgICAgICAgICAgIHJldHVybiBmbGFnO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNvdXJjZVJlY3QgJiYgdGhpcy50ZXh0dXJlUmVjdCkge1xuICAgICAgICAgICAgbGV0IHsgeCwgeSwgd2lkdGgsIGhlaWdodCB9ID0gdGhpcy5zb3VyY2VSZWN0O1xuICAgICAgICAgICAgeCA9IHRoaXMuJGlzVHJpbSA/IHggOiAwO1xuICAgICAgICAgICAgeSA9IHRoaXMuJGlzVHJpbSA/IHkgOiAwO1xuICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSh0aGlzLnRleHR1cmUsIHRoaXMudGV4dHVyZVJlY3QueCwgdGhpcy50ZXh0dXJlUmVjdC55LCB0aGlzLnRleHR1cmVSZWN0LndpZHRoLCB0aGlzLnRleHR1cmVSZWN0LmhlaWdodCwgeCwgeSwgd2lkdGgsIGhlaWdodCk7IC8vR09iamVjdOadpeaOp+WItuS9jee9ruWdkOagh1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSh0aGlzLnRleHR1cmUsIDAsIDApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBnZXRCb3VuZHMoKSB7XG4gICAgICAgIHZhciByZWN0ID0gc3VwZXIuZ2V0Qm91bmRzKCk7XG4gICAgICAgIGlmIChyZWN0KSB7XG4gICAgICAgICAgICByZXR1cm4gcmVjdDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdGV4dHVyZSA9IHRoaXMudGV4dHVyZSwgbyA9IHRoaXMuc291cmNlUmVjdCB8fCB0ZXh0dXJlO1xuICAgICAgICB2YXIgaGFzQ29udGVudCA9IHRleHR1cmUgJiYgKHRleHR1cmVbJ25hdHVyYWxXaWR0aCddIHx8IHRleHR1cmVbJ2dldENvbnRleHQnXSB8fCB0ZXh0dXJlWydyZWFkeVN0YXRlJ10gPj0gMik7XG4gICAgICAgIHJldHVybiBoYXNDb250ZW50ID8gdGhpcy5zb3VyY2VSZWN0LnNldFZhbHVlcygwLCAwLCBvLndpZHRoLCBvLmhlaWdodCkgOiBudWxsO1xuICAgIH1cbn1cblxuY2xhc3MgU2NhbGVCaXRtYXAgZXh0ZW5kcyBTcHJpdGUge1xuICAgIGNvbnN0cnVjdG9yKGl0ZW0sIHNjYWxlOUdyaWQpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgaWYgKGl0ZW0pIHtcbiAgICAgICAgICAgIGxldCB7IHdpZHRoLCBoZWlnaHQsIHRleHR1cmUsIGlkIH0gPSBpdGVtO1xuICAgICAgICAgICAgdGhpcy4kZnJhbWVJZCA9IGlkO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB0ZXh0dXJlID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0dXJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0dXJlLnNyYyA9IHRleHR1cmU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRleHR1cmUgPSB0ZXh0dXJlLmltYWdlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zb3VyY2VSZWN0ID0gbmV3IGNyZWF0ZWpzLlJlY3RhbmdsZSgwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgICAgIHRoaXMudGV4dHVyZVJlY3QgPSB0ZXh0dXJlLnJlY3Q7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zY2FsZTlHcmlkID0gc2NhbGU5R3JpZDtcbiAgICAgICAgdGhpcy5zbmFwVG9QaXhlbCA9IHRydWU7XG4gICAgfVxuICAgIGRyYXcoY3R4LCBpZ25vcmVDYWNoZSkge1xuICAgICAgICBsZXQgZmxhZyA9IHN1cGVyLmRyYXcoY3R4LCBpZ25vcmVDYWNoZSk7XG4gICAgICAgIGlmIChmbGFnKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgY2VudGVyWCA9IHRoaXMuc2NhbGU5R3JpZC53aWR0aDtcbiAgICAgICAgdmFyIGNlbnRlclkgPSB0aGlzLnNjYWxlOUdyaWQuaGVpZ2h0O1xuICAgICAgICB2YXIgc2NhbGVkQ2VudGVyWDtcbiAgICAgICAgdmFyIHNjYWxlZENlbnRlclk7XG4gICAgICAgIHZhciBpbWFnZUhlaWdodCA9IHRoaXMuc291cmNlUmVjdC5oZWlnaHQ7XG4gICAgICAgIHZhciBpbWFnZVdpZHRoID0gdGhpcy5zb3VyY2VSZWN0LndpZHRoO1xuICAgICAgICBpZiAoY2VudGVyWCA9PSAwKSB7XG4gICAgICAgICAgICAvL3ZlcnRpY2FsXG4gICAgICAgICAgICBpZiAoY2VudGVyWSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgJ09uZSBvZiBzY2FsZTlHcmlkIHdpZHRoIG9yIGhlaWdodCBtdXN0IGJlIGdyZWF0ZXIgdGhhbiB6ZXJvLic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgc2NhbGUzUmVnaW9uMiA9IHRoaXMudGV4dHVyZVJlY3QueSArIHRoaXMuc2NhbGU5R3JpZC55O1xuICAgICAgICAgICAgdmFyIHNjYWxlM1JlZ2lvbjMgPSB0aGlzLnRleHR1cmVSZWN0LnkgKyB0aGlzLnNjYWxlOUdyaWQueSArIHRoaXMuc2NhbGU5R3JpZC5oZWlnaHQ7XG4gICAgICAgICAgICB2YXIgc2NhbGVkRmlyc3RSZWdpb24gPSB0aGlzLnNjYWxlOUdyaWQueTtcbiAgICAgICAgICAgIHZhciBzY2FsZWRTZWNvbmRSZWdpb24gPSB0aGlzLnNjYWxlOUdyaWQuaGVpZ2h0O1xuICAgICAgICAgICAgdmFyIHNjYWxlZFRoaXJkUmVnaW9uID0gdGhpcy50ZXh0dXJlUmVjdC5oZWlnaHQgLSBzY2FsZWRGaXJzdFJlZ2lvbiAtIHNjYWxlZFNlY29uZFJlZ2lvbjtcbiAgICAgICAgICAgIHNjYWxlZENlbnRlclkgPSBpbWFnZUhlaWdodCAtIHNjYWxlZEZpcnN0UmVnaW9uIC0gc2NhbGVkVGhpcmRSZWdpb247XG4gICAgICAgICAgICBjdHguZHJhd0ltYWdlKHRoaXMudGV4dHVyZSwgdGhpcy50ZXh0dXJlUmVjdC54LCB0aGlzLnRleHR1cmVSZWN0LnksIHRoaXMudGV4dHVyZVJlY3Qud2lkdGgsIHNjYWxlZEZpcnN0UmVnaW9uLCAwLCAwLCBpbWFnZVdpZHRoLCBzY2FsZWRGaXJzdFJlZ2lvbik7XG4gICAgICAgICAgICBjdHguZHJhd0ltYWdlKHRoaXMudGV4dHVyZSwgdGhpcy50ZXh0dXJlUmVjdC54LCBzY2FsZTNSZWdpb24yLCB0aGlzLnRleHR1cmVSZWN0LndpZHRoLCBzY2FsZWRTZWNvbmRSZWdpb24sIDAsIHNjYWxlZEZpcnN0UmVnaW9uLCBpbWFnZVdpZHRoLCBzY2FsZWRDZW50ZXJZKTtcbiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UodGhpcy50ZXh0dXJlLCB0aGlzLnRleHR1cmVSZWN0LngsIHNjYWxlM1JlZ2lvbjMsIHRoaXMudGV4dHVyZVJlY3Qud2lkdGgsIHNjYWxlZFRoaXJkUmVnaW9uLCAwLCBzY2FsZWRDZW50ZXJZICsgc2NhbGVkRmlyc3RSZWdpb24sIGltYWdlV2lkdGgsIHNjYWxlZFRoaXJkUmVnaW9uKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjZW50ZXJZID09IDApIHtcbiAgICAgICAgICAgIC8vaG9yaXpvbnRhbFxuICAgICAgICAgICAgdmFyIHNjYWxlM1JlZ2lvbjIgPSB0aGlzLnRleHR1cmVSZWN0LnggKyB0aGlzLnNjYWxlOUdyaWQueDtcbiAgICAgICAgICAgIHZhciBzY2FsZTNSZWdpb24zID0gdGhpcy50ZXh0dXJlUmVjdC54ICsgdGhpcy5zY2FsZTlHcmlkLnggKyB0aGlzLnNjYWxlOUdyaWQud2lkdGg7XG4gICAgICAgICAgICB2YXIgc2NhbGVkRmlyc3RSZWdpb24gPSB0aGlzLnNjYWxlOUdyaWQueDtcbiAgICAgICAgICAgIHZhciBzY2FsZWRTZWNvbmRSZWdpb24gPSB0aGlzLnNjYWxlOUdyaWQud2lkdGg7XG4gICAgICAgICAgICB2YXIgc2NhbGVkVGhpcmRSZWdpb24gPSB0aGlzLnRleHR1cmVSZWN0LndpZHRoIC0gc2NhbGVkRmlyc3RSZWdpb24gLSBzY2FsZWRTZWNvbmRSZWdpb247XG4gICAgICAgICAgICBzY2FsZWRDZW50ZXJYID0gaW1hZ2VXaWR0aCAtIHNjYWxlZEZpcnN0UmVnaW9uIC0gc2NhbGVkVGhpcmRSZWdpb247XG4gICAgICAgICAgICBjdHguZHJhd0ltYWdlKHRoaXMudGV4dHVyZSwgdGhpcy50ZXh0dXJlUmVjdC54LCB0aGlzLnRleHR1cmVSZWN0LnksIHNjYWxlZEZpcnN0UmVnaW9uLCB0aGlzLnRleHR1cmVSZWN0LmhlaWdodCwgMCwgMCwgc2NhbGVkRmlyc3RSZWdpb24sIGltYWdlSGVpZ2h0KTtcbiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UodGhpcy50ZXh0dXJlLCBzY2FsZTNSZWdpb24yLCB0aGlzLnRleHR1cmVSZWN0LnksIHNjYWxlZFNlY29uZFJlZ2lvbiwgdGhpcy50ZXh0dXJlUmVjdC5oZWlnaHQsIHNjYWxlZEZpcnN0UmVnaW9uLCAwLCBzY2FsZWRDZW50ZXJYLCBpbWFnZUhlaWdodCk7XG4gICAgICAgICAgICBjdHguZHJhd0ltYWdlKHRoaXMudGV4dHVyZSwgc2NhbGUzUmVnaW9uMywgdGhpcy50ZXh0dXJlUmVjdC55LCBzY2FsZWRUaGlyZFJlZ2lvbiwgdGhpcy50ZXh0dXJlUmVjdC5oZWlnaHQsIHNjYWxlZEZpcnN0UmVnaW9uICsgc2NhbGVkQ2VudGVyWCwgMCwgc2NhbGVkVGhpcmRSZWdpb24sIGltYWdlSGVpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBsZWZ0ID0gdGhpcy5zY2FsZTlHcmlkLng7XG4gICAgICAgICAgICB2YXIgdG9wID0gdGhpcy5zY2FsZTlHcmlkLnk7XG4gICAgICAgICAgICB2YXIgcmlnaHQgPSB0aGlzLnRleHR1cmVSZWN0LndpZHRoIC0gY2VudGVyWCAtIGxlZnQ7XG4gICAgICAgICAgICB2YXIgYm90dG9tID0gdGhpcy50ZXh0dXJlUmVjdC5oZWlnaHQgLSBjZW50ZXJZIC0gdG9wO1xuICAgICAgICAgICAgc2NhbGVkQ2VudGVyWCA9IGltYWdlV2lkdGggLSBsZWZ0IC0gcmlnaHQ7XG4gICAgICAgICAgICBzY2FsZWRDZW50ZXJZID0gaW1hZ2VIZWlnaHQgLSB0b3AgLSBib3R0b207XG4gICAgICAgICAgICBjdHguZHJhd0ltYWdlKHRoaXMudGV4dHVyZSwgdGhpcy50ZXh0dXJlUmVjdC54LCB0aGlzLnRleHR1cmVSZWN0LnksIGxlZnQsIHRvcCwgMCwgMCwgbGVmdCwgdG9wKTtcbiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UodGhpcy50ZXh0dXJlLCB0aGlzLnRleHR1cmVSZWN0LnggKyBsZWZ0LCB0aGlzLnRleHR1cmVSZWN0LnksIGNlbnRlclgsIHRvcCwgbGVmdCwgMCwgc2NhbGVkQ2VudGVyWCwgdG9wKTtcbiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UodGhpcy50ZXh0dXJlLCB0aGlzLnRleHR1cmVSZWN0LnggKyBsZWZ0ICsgY2VudGVyWCwgdGhpcy50ZXh0dXJlUmVjdC55LCByaWdodCwgdG9wLCBsZWZ0ICsgc2NhbGVkQ2VudGVyWCwgMCwgcmlnaHQsIHRvcCk7XG4gICAgICAgICAgICBjdHguZHJhd0ltYWdlKHRoaXMudGV4dHVyZSwgdGhpcy50ZXh0dXJlUmVjdC54LCB0aGlzLnRleHR1cmVSZWN0LnkgKyB0b3AsIGxlZnQsIGNlbnRlclksIDAsIHRvcCwgbGVmdCwgc2NhbGVkQ2VudGVyWSk7XG4gICAgICAgICAgICBjdHguZHJhd0ltYWdlKHRoaXMudGV4dHVyZSwgdGhpcy50ZXh0dXJlUmVjdC54ICsgbGVmdCwgdGhpcy50ZXh0dXJlUmVjdC55ICsgdG9wLCBjZW50ZXJYLCBjZW50ZXJZLCBsZWZ0LCB0b3AsIHNjYWxlZENlbnRlclgsIHNjYWxlZENlbnRlclkpO1xuICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSh0aGlzLnRleHR1cmUsIHRoaXMudGV4dHVyZVJlY3QueCArIGxlZnQgKyBjZW50ZXJYLCB0aGlzLnRleHR1cmVSZWN0LnkgKyB0b3AsIHJpZ2h0LCBjZW50ZXJZLCBsZWZ0ICsgc2NhbGVkQ2VudGVyWCwgdG9wLCByaWdodCwgc2NhbGVkQ2VudGVyWSk7XG4gICAgICAgICAgICBjdHguZHJhd0ltYWdlKHRoaXMudGV4dHVyZSwgdGhpcy50ZXh0dXJlUmVjdC54LCB0aGlzLnRleHR1cmVSZWN0LnkgKyB0b3AgKyBjZW50ZXJZLCBsZWZ0LCBib3R0b20sIDAsIHRvcCArIHNjYWxlZENlbnRlclksIGxlZnQsIGJvdHRvbSk7XG4gICAgICAgICAgICBjdHguZHJhd0ltYWdlKHRoaXMudGV4dHVyZSwgdGhpcy50ZXh0dXJlUmVjdC54ICsgbGVmdCwgdGhpcy50ZXh0dXJlUmVjdC55ICsgdG9wICsgY2VudGVyWSwgY2VudGVyWCwgYm90dG9tLCBsZWZ0LCB0b3AgKyBzY2FsZWRDZW50ZXJZLCBzY2FsZWRDZW50ZXJYLCBib3R0b20pO1xuICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSh0aGlzLnRleHR1cmUsIHRoaXMudGV4dHVyZVJlY3QueCArIGxlZnQgKyBjZW50ZXJYLCB0aGlzLnRleHR1cmVSZWN0LnkgKyB0b3AgKyBjZW50ZXJZLCByaWdodCwgYm90dG9tLCBsZWZ0ICsgc2NhbGVkQ2VudGVyWCwgdG9wICsgc2NhbGVkQ2VudGVyWSwgcmlnaHQsIGJvdHRvbSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufVxuXG5jbGFzcyBUaWxpbmdCaXRtYXAgZXh0ZW5kcyBTcHJpdGUge1xuICAgIGNvbnN0cnVjdG9yKGl0ZW0pIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgaWYgKGl0ZW0pIHtcbiAgICAgICAgICAgIGxldCB7IHdpZHRoLCBoZWlnaHQsIHRleHR1cmUsIGlkIH0gPSBpdGVtO1xuICAgICAgICAgICAgdGhpcy4kZnJhbWVJZCA9IGlkO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB0ZXh0dXJlID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0dXJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0dXJlLnNyYyA9IHRleHR1cmU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRleHR1cmUgPSB0ZXh0dXJlLmltYWdlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zb3VyY2VSZWN0ID0gbmV3IGNyZWF0ZWpzLlJlY3RhbmdsZSgwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgICAgIHRoaXMudGV4dHVyZVJlY3QgPSB0ZXh0dXJlLnJlY3Q7XG4gICAgICAgICAgICBsZXQgb2Zmc2V0Q2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgICAgICAgICBsZXQgb2Zmc2V0Q2FudmFzQ29udGV4dCA9IG9mZnNldENhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICAgICAgb2Zmc2V0Q2FudmFzLndpZHRoID0gdGhpcy50ZXh0dXJlUmVjdC53aWR0aDtcbiAgICAgICAgICAgIG9mZnNldENhbnZhcy5oZWlnaHQgPSB0aGlzLnRleHR1cmVSZWN0LmhlaWdodDtcbiAgICAgICAgICAgIG9mZnNldENhbnZhc0NvbnRleHQuZHJhd0ltYWdlKHRoaXMudGV4dHVyZSwgdGhpcy50ZXh0dXJlUmVjdC54LCB0aGlzLnRleHR1cmVSZWN0LnksIHRoaXMudGV4dHVyZVJlY3Qud2lkdGgsIHRoaXMudGV4dHVyZVJlY3QuaGVpZ2h0LCAwLCAwLCB0aGlzLnRleHR1cmVSZWN0LndpZHRoLCB0aGlzLnRleHR1cmVSZWN0LmhlaWdodCk7XG4gICAgICAgICAgICB0aGlzLl9wYXR0ZXJuID0gb2Zmc2V0Q2FudmFzQ29udGV4dC5jcmVhdGVQYXR0ZXJuKG9mZnNldENhbnZhcywgJ3JlcGVhdCcpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGRyYXcoY3R4LCBpZ25vcmVDYWNoZSkge1xuICAgICAgICBsZXQgZmxhZyA9IHN1cGVyLmRyYXcoY3R4LCBpZ25vcmVDYWNoZSk7XG4gICAgICAgIGlmIChmbGFnKSB7XG4gICAgICAgICAgICByZXR1cm4gZmxhZztcbiAgICAgICAgfVxuICAgICAgICAvLyBjdHguc2F2ZSgpO1xuICAgICAgICBsZXQgeyB3aWR0aCwgaGVpZ2h0IH0gPSB0aGlzLnNvdXJjZVJlY3Q7XG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLl9wYXR0ZXJuO1xuICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7XG4gICAgICAgIC8vIGN0eC5yZXN0b3JlKCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn1cblxuY2xhc3MgVUlJbWFnZSBleHRlbmRzIGNyZWF0ZWpzLkNvbnRhaW5lciB7XG4gICAgY29uc3RydWN0b3Iob3duZXIpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5VSU93bmVyID0gb3duZXI7XG4gICAgICAgIC8vIHRoaXMubW91c2VFbmFibGVkID0gdGhpcy5tb3VzZUNoaWxkcmVuID0gZmFsc2U7XG4gICAgfVxuICAgIHNldCBzb3VyY2VSZWN0KHJlY3QpIHtcbiAgICAgICAgdGhpcy4kZGlzcC5zb3VyY2VSZWN0ID0gcmVjdDtcbiAgICB9XG4gICAgc2V0Q2FjaGUoeCwgeSwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgICB0aGlzLiRkaXNwLmNhY2hlKHgsIHksIHdpZHRoLCBoZWlnaHQpO1xuICAgIH1cbiAgICAvKipAaW50ZXJuYWwgKi9cbiAgICAkaW5pdERpc3AoaXRlbSkge1xuICAgICAgICBpZiAodGhpcy4kZGlzcClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKGl0ZW0pIHtcbiAgICAgICAgICAgIGl0ZW0ubG9hZCgpO1xuICAgICAgICAgICAgaWYgKGl0ZW0uc2NhbGVCeVRpbGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRkaXNwID0gbmV3IFRpbGluZ0JpdG1hcChpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGl0ZW0uc2NhbGU5R3JpZCkge1xuICAgICAgICAgICAgICAgIGxldCByZWN0ID0gbmV3IGNyZWF0ZWpzLlJlY3RhbmdsZShpdGVtLnNjYWxlOUdyaWQueCwgaXRlbS5zY2FsZTlHcmlkLnksIE1hdGgubWF4KDAsIGl0ZW0uc2NhbGU5R3JpZC53aWR0aCksIE1hdGgubWF4KDAsIGl0ZW0uc2NhbGU5R3JpZC5oZWlnaHQpKTtcbiAgICAgICAgICAgICAgICB0aGlzLiRkaXNwID0gbmV3IFNjYWxlQml0bWFwKGl0ZW0sIHJlY3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kZGlzcCA9IG5ldyBCaXRtYXAoaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLiRkaXNwID0gbmV3IEJpdG1hcCgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy4kZGlzcCk7XG4gICAgfVxuICAgIGdldCB0aW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kZGlzcC50aW50O1xuICAgIH1cbiAgICBzZXQgdGludCh2YWx1ZSkge1xuICAgICAgICB0aGlzLiRkaXNwLnRpbnQgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IGhlaWdodCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGRpc3Auc291cmNlUmVjdC5oZWlnaHQ7XG4gICAgfVxuICAgIHNldCBoZWlnaHQodikge1xuICAgICAgICB0aGlzLiRkaXNwLnNvdXJjZVJlY3QuaGVpZ2h0ID0gdjtcbiAgICB9XG4gICAgZ2V0IHdpZHRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kZGlzcC5zb3VyY2VSZWN0LndpZHRoO1xuICAgIH1cbiAgICBzZXQgd2lkdGgodikge1xuICAgICAgICB0aGlzLiRkaXNwLnNvdXJjZVJlY3Qud2lkdGggPSB2O1xuICAgIH1cbiAgICBnZXQgdGV4dHVyZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGRpc3AudGV4dHVyZTtcbiAgICB9XG4gICAgc2V0IHRleHR1cmUodikge1xuICAgICAgICB0aGlzLiRkaXNwLnRleHR1cmUgPSB2O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiByZWN0ID0geCx5LHcsaCA9IGwsdCxyLGJcbiAgICAgKi9cbiAgICBnZXQgc2NhbGU5R3JpZCgpIHtcbiAgICAgICAgaWYgKHRoaXMuJGRpc3AgaW5zdGFuY2VvZiBTY2FsZUJpdG1hcCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGRpc3Auc2NhbGU5R3JpZDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogcmVjdCA9IHgseSx3LGggPSBsLHQscixiXG4gICAgICovXG4gICAgc2V0IHNjYWxlOUdyaWQocmVjdCkge1xuICAgICAgICBpZiAodGhpcy4kZGlzcCBpbnN0YW5jZW9mIFNjYWxlQml0bWFwKSB7XG4gICAgICAgICAgICB0aGlzLiRkaXNwLnNjYWxlOUdyaWQgPSByZWN0O1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHRvZG9cbiAgICAgKi9cbiAgICBkZXN0cm95KCkge1xuICAgICAgICAvLyAgICAgaWYodGhpcy4kZGlzcCkge1xuICAgICAgICAvLyAgICAgICAgIHRoaXMuJGRpc3AuZGVzdHJveShvcHRpb25zKTtcbiAgICAgICAgLy8gICAgICAgICB0aGlzLiRkaXNwID0gbnVsbDtcbiAgICAgICAgLy8gICAgIH1cbiAgICAgICAgLy8gICAgIHN1cGVyLmRlc3Ryb3kob3B0aW9ucyk7XG4gICAgfVxufVxuXG5jbGFzcyBHSW1hZ2UgZXh0ZW5kcyBHT2JqZWN0IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICB9XG4gICAgZ2V0IHRvdWNoYWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBzZXQgdG91Y2hhYmxlKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuJHRvdWNoYWJsZSA9IGZhbHNlOyAvL0dJbWFnZSBoYXMgbm8gaW50ZXJhY3Rpb25cbiAgICB9XG4gICAgZ2V0IGNvbG9yKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kY29udGVudC50aW50O1xuICAgIH1cbiAgICBzZXQgY29sb3IodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuY29sb3IgIT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlR2Vhcig0IC8qIENvbG9yICovKTtcbiAgICAgICAgICAgIHRoaXMuJGNvbnRlbnQudGludCA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy4kY29udGVudC5zZXRDYWNoZSgwLCAwLCB0aGlzLiR3aWR0aCwgdGhpcy4kaGVpZ2h0KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgZmxpcCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGZsaXA7XG4gICAgfVxuICAgIHNldCBmbGlwKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiRmbGlwICE9IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiRmbGlwID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLiRjb250ZW50LnNjYWxlWCA9IHRoaXMuJGNvbnRlbnQuc2NhbGVZID0gMTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRmbGlwID09IDEgLyogSG9yaXpvbnRhbCAqLyB8fCB0aGlzLiRmbGlwID09IDMgLyogQm90aCAqLykge1xuICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRlbnQuc2NhbGVYID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy4kZmxpcCA9PSAyIC8qIFZlcnRpY2FsICovIHx8IHRoaXMuJGZsaXAgPT0gMyAvKiBCb3RoICovKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGVudC5zY2FsZVkgPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuaGFuZGxlWFlDaGFuZ2VkKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHRleHR1cmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRjb250ZW50LnRleHR1cmU7XG4gICAgfVxuICAgIHNldCB0ZXh0dXJlKHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLiRzb3VyY2VXaWR0aCA9IHZhbHVlLndpZHRoO1xuICAgICAgICAgICAgdGhpcy4kc291cmNlSGVpZ2h0ID0gdmFsdWUuaGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRoaXMuJHNvdXJjZVdpZHRoID0gdGhpcy4kc291cmNlSGVpZ2h0ID0gMDtcbiAgICAgICAgdGhpcy4kaW5pdFdpZHRoID0gdGhpcy4kc291cmNlV2lkdGg7XG4gICAgICAgIHRoaXMuJGluaXRIZWlnaHQgPSB0aGlzLiRzb3VyY2VIZWlnaHQ7XG4gICAgICAgIHRoaXMuJGNvbnRlbnQudGV4dHVyZSA9IHZhbHVlO1xuICAgIH1cbiAgICBjcmVhdGVEaXNwbGF5T2JqZWN0KCkge1xuICAgICAgICB0aGlzLiRjb250ZW50ID0gbmV3IFVJSW1hZ2UodGhpcyk7XG4gICAgICAgIHRoaXMuc2V0RGlzcGxheU9iamVjdCh0aGlzLiRjb250ZW50KTtcbiAgICB9XG4gICAgZGlzcG9zZSgpIHtcbiAgICAgICAgdGhpcy4kY29udGVudC5kZXN0cm95KCk7XG4gICAgICAgIHN1cGVyLmRpc3Bvc2UoKTtcbiAgICB9XG4gICAgY29uc3RydWN0RnJvbVJlc291cmNlKCkge1xuICAgICAgICB0aGlzLiRzb3VyY2VXaWR0aCA9IHRoaXMucGFja2FnZUl0ZW0ud2lkdGg7XG4gICAgICAgIHRoaXMuJHNvdXJjZUhlaWdodCA9IHRoaXMucGFja2FnZUl0ZW0uaGVpZ2h0O1xuICAgICAgICB0aGlzLiRpbml0V2lkdGggPSB0aGlzLiRzb3VyY2VXaWR0aDtcbiAgICAgICAgdGhpcy4kaW5pdEhlaWdodCA9IHRoaXMuJHNvdXJjZUhlaWdodDtcbiAgICAgICAgdGhpcy4kY29udGVudC4kaW5pdERpc3AodGhpcy5wYWNrYWdlSXRlbSk7XG4gICAgICAgIHRoaXMuc2V0U2l6ZSh0aGlzLiRzb3VyY2VXaWR0aCwgdGhpcy4kc291cmNlSGVpZ2h0KTtcbiAgICB9XG4gICAgaGFuZGxlWFlDaGFuZ2VkKCkge1xuICAgICAgICBzdXBlci5oYW5kbGVYWUNoYW5nZWQoKTtcbiAgICAgICAgaWYgKHRoaXMuJGZsaXAgIT0gMCAvKiBOb25lICovKSB7XG4gICAgICAgICAgICBpZiAodGhpcy4kY29udGVudC5zY2FsZVggPT0gLTEpXG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGVudC54ICs9IHRoaXMud2lkdGg7XG4gICAgICAgICAgICBpZiAodGhpcy4kY29udGVudC5zY2FsZVkgPT0gLTEpXG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGVudC55ICs9IHRoaXMuaGVpZ2h0O1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZVNpemVDaGFuZ2VkKCkge1xuICAgICAgICB0aGlzLiRjb250ZW50LndpZHRoID0gdGhpcy53aWR0aDtcbiAgICAgICAgdGhpcy4kY29udGVudC5oZWlnaHQgPSB0aGlzLmhlaWdodDtcbiAgICAgICAgbGV0IHJlY3QgPSBuZXcgY3JlYXRlanMuUmVjdGFuZ2xlKHRoaXMueCwgdGhpcy55LCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gICAgICAgIHRoaXMuJGNvbnRlbnQuc291cmNlUmVjdCA9IHJlY3Q7XG4gICAgfVxuICAgIHNldHVwQmVmb3JlQWRkKHhtbCkge1xuICAgICAgICBzdXBlci5zZXR1cEJlZm9yZUFkZCh4bWwpO1xuICAgICAgICBsZXQgc3RyO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5jb2xvcjtcbiAgICAgICAgaWYgKHN0cikge1xuICAgICAgICAgICAgdGhpcy5jb2xvciA9IFN0cmluZ1V0aWwuSEVYMlJHQihzdHIpO1xuICAgICAgICB9XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmZsaXA7XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICB0aGlzLmZsaXAgPSBQYXJzZUZsaXBUeXBlKHN0cik7XG4gICAgfVxufVxuXG5jbGFzcyBHVGltZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLiRlbnVtSWR4ID0gMDtcbiAgICAgICAgdGhpcy4kZW51bUNvdW50ID0gMDtcbiAgICAgICAgdGhpcy4kY3VyVGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIHRoaXMuJGl0ZW1zID0gW107XG4gICAgICAgIHRoaXMuJGl0ZW1Qb29sID0gW107XG4gICAgICAgIC8vIHRoaXMuJGxhc3RUaW1lID0gY3JlYXRlanMuVGlja2VyLmdldFRpbWUoKTtcbiAgICAgICAgLy8gR1RpbWVyLnRpbWUgPSB0aGlzLiRsYXN0VGltZTtcbiAgICAgICAgY3JlYXRlanMuVGlja2VyLm9uKCd0aWNrJywgdGhpcy5hZHZhbmNlLCB0aGlzKTtcbiAgICB9XG4gICAgZ2V0SXRlbSgpIHtcbiAgICAgICAgaWYgKHRoaXMuJGl0ZW1Qb29sLmxlbmd0aClcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiRpdGVtUG9vbC5wb3AoKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBUaW1lckl0ZW0oKTtcbiAgICB9XG4gICAgZmluZEl0ZW0oY2FsbGJhY2ssIHRoaXNPYmopIHtcbiAgICAgICAgbGV0IGxlbiA9IHRoaXMuJGl0ZW1zLmxlbmd0aDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLiRpdGVtc1tpXTtcbiAgICAgICAgICAgIGlmIChpdGVtLmNhbGxiYWNrID09IGNhbGxiYWNrICYmIGl0ZW0udGhpc09iaiA9PSB0aGlzT2JqKVxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvL3JlcGVhdCA8PSAwIG1lYW5zIGxvb3BcbiAgICBhZGQoZGVsYXlJbk1zLCByZXBlYXQsIGNhbGxiYWNrLCB0aGlzT2JqLCBjYWxsYmFja1BhcmFtKSB7XG4gICAgICAgIGxldCBpdGVtID0gdGhpcy5maW5kSXRlbShjYWxsYmFjaywgdGhpc09iaik7XG4gICAgICAgIGlmICghaXRlbSkge1xuICAgICAgICAgICAgaXRlbSA9IHRoaXMuZ2V0SXRlbSgpO1xuICAgICAgICAgICAgaXRlbS5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgICAgICAgICAgaXRlbS50aGlzT2JqID0gdGhpc09iajtcbiAgICAgICAgICAgIHRoaXMuJGl0ZW1zLnB1c2goaXRlbSk7XG4gICAgICAgIH1cbiAgICAgICAgaXRlbS5kZWxheSA9IGRlbGF5SW5NcztcbiAgICAgICAgaXRlbS5jb3VudGVyID0gMDtcbiAgICAgICAgaXRlbS5yZXBlYXQgPSByZXBlYXQ7XG4gICAgICAgIGl0ZW0ucGFyYW0gPSBjYWxsYmFja1BhcmFtO1xuICAgICAgICBpdGVtLmVuZCA9IGZhbHNlO1xuICAgIH1cbiAgICBhZGRMb29wKGRlbGF5SW5NcywgY2FsbGJhY2ssIHRoaXNPYmosIGNhbGxiYWNrUGFyYW0pIHtcbiAgICAgICAgdGhpcy5hZGQoZGVsYXlJbk1zLCAwLCBjYWxsYmFjaywgdGhpc09iaiwgY2FsbGJhY2tQYXJhbSk7XG4gICAgfVxuICAgIGNhbGxMYXRlcihjYWxsYmFjaywgdGhpc09iaiwgY2FsbGJhY2tQYXJhbSkge1xuICAgICAgICB0aGlzLmFkZCgxLCAxLCBjYWxsYmFjaywgdGhpc09iaiwgY2FsbGJhY2tQYXJhbSk7XG4gICAgfVxuICAgIGNhbGxEZWxheShkZWxheUluTXMsIGNhbGxiYWNrLCB0aGlzT2JqLCBjYWxsYmFja1BhcmFtKSB7XG4gICAgICAgIHRoaXMuYWRkKGRlbGF5SW5NcywgMSwgY2FsbGJhY2ssIHRoaXNPYmosIGNhbGxiYWNrUGFyYW0pO1xuICAgIH1cbiAgICBleGlzdHMoY2FsbGJhY2ssIHRoaXNPYmopIHtcbiAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLmZpbmRJdGVtKGNhbGxiYWNrLCB0aGlzT2JqKTtcbiAgICAgICAgcmV0dXJuIGl0ZW0gIT0gbnVsbDtcbiAgICB9XG4gICAgcmVtb3ZlKGNhbGxiYWNrLCB0aGlzT2JqKSB7XG4gICAgICAgIGxldCBpdGVtID0gdGhpcy5maW5kSXRlbShjYWxsYmFjaywgdGhpc09iaik7XG4gICAgICAgIGlmIChpdGVtKSB7XG4gICAgICAgICAgICBsZXQgaSA9IHRoaXMuJGl0ZW1zLmluZGV4T2YoaXRlbSk7XG4gICAgICAgICAgICB0aGlzLiRpdGVtcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICBpZiAoaSA8IHRoaXMuJGVudW1JZHgpXG4gICAgICAgICAgICAgICAgdGhpcy4kZW51bUlkeC0tO1xuICAgICAgICAgICAgdGhpcy4kZW51bUNvdW50LS07XG4gICAgICAgICAgICBpdGVtLmNhbGxiYWNrID0gbnVsbDtcbiAgICAgICAgICAgIGl0ZW0ucGFyYW0gPSBudWxsO1xuICAgICAgICAgICAgdGhpcy4kaXRlbVBvb2wucHVzaChpdGVtKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgdGlja2VyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kdGlja2VyO1xuICAgIH1cbiAgICBnZXQgY3VyVGltZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGN1clRpbWU7XG4gICAgfVxuICAgIGFkdmFuY2UoKSB7XG4gICAgICAgIHRoaXMuJGVudW1JZHggPSAwO1xuICAgICAgICB0aGlzLiRlbnVtQ291bnQgPSB0aGlzLiRpdGVtcy5sZW5ndGg7XG4gICAgICAgIHdoaWxlICh0aGlzLiRlbnVtSWR4IDwgdGhpcy4kZW51bUNvdW50KSB7XG4gICAgICAgICAgICBsZXQgaXRlbSA9IHRoaXMuJGl0ZW1zW3RoaXMuJGVudW1JZHhdO1xuICAgICAgICAgICAgdGhpcy4kZW51bUlkeCsrO1xuICAgICAgICAgICAgbGV0IG1zID0gY3JlYXRlanMuVGlja2VyLmludGVydmFsO1xuICAgICAgICAgICAgdGhpcy4kY3VyVGltZSArPSBtcztcbiAgICAgICAgICAgIGlmIChpdGVtLmFkdmFuY2UobXMpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uZW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGVudW1JZHgtLTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZW51bUNvdW50LS07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGl0ZW1zLnNwbGljZSh0aGlzLiRlbnVtSWR4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kaXRlbVBvb2wucHVzaChpdGVtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGFyZ3MgPSBbbXNdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5wYXJhbSAmJiBpdGVtLnBhcmFtIGluc3RhbmNlb2YgQXJyYXkpXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gaXRlbS5wYXJhbS5jb25jYXQoYXJncyk7XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGl0ZW0ucGFyYW0gIT09IHZvaWQgMClcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MudW5zaGlmdChpdGVtLnBhcmFtKTtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5jYWxsYmFjay5hcHBseShpdGVtLnRoaXNPYmosIGFyZ3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5lbmQpXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uY2FsbGJhY2sgPSBpdGVtLnRoaXNPYmogPSBpdGVtLnBhcmFtID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbkdUaW1lci5pbnN0ID0gbmV3IEdUaW1lcigpO1xuY2xhc3MgVGltZXJJdGVtIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5kZWxheSA9IDA7XG4gICAgICAgIHRoaXMuY291bnRlciA9IDA7XG4gICAgICAgIHRoaXMucmVwZWF0ID0gMDtcbiAgICB9XG4gICAgYWR2YW5jZShkZWx0YSA9IDApIHtcbiAgICAgICAgdGhpcy5jb3VudGVyICs9IGRlbHRhO1xuICAgICAgICBpZiAodGhpcy5jb3VudGVyID49IHRoaXMuZGVsYXkpIHtcbiAgICAgICAgICAgIHRoaXMuY291bnRlciAtPSB0aGlzLmRlbGF5O1xuICAgICAgICAgICAgaWYgKHRoaXMuY291bnRlciA+IHRoaXMuZGVsYXkpXG4gICAgICAgICAgICAgICAgdGhpcy5jb3VudGVyID0gdGhpcy5kZWxheTtcbiAgICAgICAgICAgIGlmICh0aGlzLnJlcGVhdCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlcGVhdC0tO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlcGVhdCA9PSAwKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVuZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuXG5jbGFzcyBNYXRoVXRpbCB7XG4gICAgc3RhdGljIGNsYW1wKHZhbHVlLCBtaW4sIG1heCkge1xuICAgICAgICBpZiAodmFsdWUgPCBtaW4pXG4gICAgICAgICAgICB2YWx1ZSA9IG1pbjtcbiAgICAgICAgZWxzZSBpZiAodmFsdWUgPiBtYXgpXG4gICAgICAgICAgICB2YWx1ZSA9IG1heDtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgICBzdGF0aWMgY2xhbXAwMSh2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgPiAxKVxuICAgICAgICAgICAgdmFsdWUgPSAxO1xuICAgICAgICBlbHNlIGlmICh2YWx1ZSA8IDApXG4gICAgICAgICAgICB2YWx1ZSA9IDA7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gICAgc3RhdGljIGlzTnVtYmVyKG4pIHtcbiAgICAgICAgaWYgKHR5cGVvZiAobikgIT0gXCJudW1iZXJcIilcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKGlzTmFOKG4pKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgc3RhdGljIHNpZ24oeCkge1xuICAgICAgICB4ID0gTnVtYmVyKHgpO1xuICAgICAgICBpZiAoeCA9PT0gMCB8fCBpc05hTih4KSlcbiAgICAgICAgICAgIHJldHVybiB4O1xuICAgICAgICByZXR1cm4geCA+IDAgPyAxIDogLTE7XG4gICAgfVxuICAgIHN0YXRpYyBhbmdsZVRvUmFkaWFuKG4pIHtcbiAgICAgICAgcmV0dXJuIG4gKiBNYXRoVXRpbC5SQURJQU47XG4gICAgfVxuICAgIHN0YXRpYyBsZXJwKHMsIGUsIHApIHtcbiAgICAgICAgcmV0dXJuIHMgKyBwICogKGUgLSBzKTtcbiAgICB9XG59XG5NYXRoVXRpbC5SQURJQU4gPSBNYXRoLlBJIC8gMTgwO1xuXG5jbGFzcyBNb3ZpZUNsaXBEYXRhIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5yZXBlYXRlZENvdW50ID0gMDtcbiAgICAgICAgdGhpcy4kY3VyRnJhbWUgPSAwO1xuICAgICAgICB0aGlzLiRsYXN0VGltZSA9IDA7XG4gICAgICAgIHRoaXMuJGN1ckZyYW1lRGVsYXkgPSAwO1xuICAgICAgICB0aGlzLiRsYXN0VGltZSA9IERhdGUubm93KCk7XG4gICAgfVxuICAgIHVwZGF0ZShtYykge1xuICAgICAgICBsZXQgdCA9IERhdGUubm93KCk7XG4gICAgICAgIGxldCBlbGFwc2VkID0gdCAtIHRoaXMuJGxhc3RUaW1lO1xuICAgICAgICB0aGlzLiRsYXN0VGltZSA9IHQ7XG4gICAgICAgIGxldCBjdXIgPSB0aGlzLiRjdXJGcmFtZTtcbiAgICAgICAgaWYgKGN1ciA+PSBtYy5mcmFtZUNvdW50KVxuICAgICAgICAgICAgY3VyID0gbWMuZnJhbWVDb3VudCAtIDE7XG4gICAgICAgIHRoaXMucmVhY2hlc0VuZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLiRjdXJGcmFtZURlbGF5ICs9IGVsYXBzZWQ7XG4gICAgICAgIGxldCBpbnRlcnZhbCA9IG1jLmludGVydmFsICsgbWMuZnJhbWVzW2N1cl0uYWRkRGVsYXlcbiAgICAgICAgICAgICsgKChjdXIgPT0gMCAmJiB0aGlzLnJlcGVhdGVkQ291bnQgPiAwKSA/IG1jLnJlcGVhdERlbGF5IDogMCk7XG4gICAgICAgIGlmICh0aGlzLiRjdXJGcmFtZURlbGF5IDwgaW50ZXJ2YWwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuJGN1ckZyYW1lRGVsYXkgLT0gaW50ZXJ2YWw7XG4gICAgICAgIGlmICh0aGlzLiRjdXJGcmFtZURlbGF5ID4gbWMuaW50ZXJ2YWwpXG4gICAgICAgICAgICB0aGlzLiRjdXJGcmFtZURlbGF5ID0gbWMuaW50ZXJ2YWw7XG4gICAgICAgIGlmIChtYy5zd2luZykge1xuICAgICAgICAgICAgaWYgKHRoaXMucmV2ZXJzZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRjdXJGcmFtZS0tO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRjdXJGcmFtZSA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kY3VyRnJhbWUgPSBNYXRoLm1pbigxLCBtYy5mcmFtZUNvdW50IC0gMSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVwZWF0ZWRDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJldmVyc2VkID0gIXRoaXMucmV2ZXJzZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kY3VyRnJhbWUrKztcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kY3VyRnJhbWUgPiBtYy5mcmFtZUNvdW50IC0gMSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjdXJGcmFtZSA9IE1hdGgubWF4KDAsIG1jLmZyYW1lQ291bnQgLSAyKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXBlYXRlZENvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVhY2hlc0VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmV2ZXJzZWQgPSAhdGhpcy5yZXZlcnNlZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLiRjdXJGcmFtZSsrO1xuICAgICAgICAgICAgaWYgKHRoaXMuJGN1ckZyYW1lID4gbWMuZnJhbWVDb3VudCAtIDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRjdXJGcmFtZSA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXBlYXRlZENvdW50Kys7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWFjaGVzRW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgY3VycmVudEZyYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kY3VyRnJhbWU7XG4gICAgfVxuICAgIHNldCBjdXJyZW50RnJhbWUodmFsdWUpIHtcbiAgICAgICAgdGhpcy4kY3VyRnJhbWUgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy4kY3VyRnJhbWVEZWxheSA9IDA7XG4gICAgfVxuICAgIHJld2luZCgpIHtcbiAgICAgICAgdGhpcy4kY3VyRnJhbWUgPSAwO1xuICAgICAgICB0aGlzLiRjdXJGcmFtZURlbGF5ID0gMDtcbiAgICAgICAgdGhpcy5yZXZlcnNlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJlYWNoZXNFbmQgPSBmYWxzZTtcbiAgICB9XG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMuJGN1ckZyYW1lID0gMDtcbiAgICAgICAgdGhpcy4kY3VyRnJhbWVEZWxheSA9IDA7XG4gICAgICAgIHRoaXMucmVwZWF0ZWRDb3VudCA9IDA7XG4gICAgICAgIHRoaXMucmVhY2hlc0VuZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJldmVyc2VkID0gZmFsc2U7XG4gICAgfVxuICAgIGNvcHkoc3JjKSB7XG4gICAgICAgIHRoaXMuJGN1ckZyYW1lID0gc3JjLiRjdXJGcmFtZTtcbiAgICAgICAgdGhpcy4kY3VyRnJhbWVEZWxheSA9IHNyYy4kY3VyRnJhbWVEZWxheTtcbiAgICAgICAgdGhpcy5yZXBlYXRlZENvdW50ID0gc3JjLnJlcGVhdGVkQ291bnQ7XG4gICAgICAgIHRoaXMucmVhY2hlc0VuZCA9IHNyYy5yZWFjaGVzRW5kO1xuICAgICAgICB0aGlzLnJldmVyc2VkID0gc3JjLnJldmVyc2VkO1xuICAgIH1cbn1cblxuY2xhc3MgRGVmYXVsdE1vdmllQ2xpcFNldHRpbmdzIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLyoqdGhlIGZpcnN0IGZyYW1lIG51bWJlciB0byBzdGFydCB0byBwbGF5ICovXG4gICAgICAgIHRoaXMuc3RhcnRGcmFtZSA9IDA7XG4gICAgICAgIC8qKnRoZSBlbmQgZnJhbWUgdGhlIHBsYXlpbmcgd2lsbCBlbmQgYXQsIC0xIG1lYW5zIHRvIHRoZSB0YWlsICovXG4gICAgICAgIHRoaXMuZW5kRnJhbWUgPSAtMTtcbiAgICAgICAgLyoqcGxheSBjb3VudCwgMCBtZWFucyBlbmRlbGVzcyAqL1xuICAgICAgICB0aGlzLnJlcGVhdENvdW50ID0gMDtcbiAgICAgICAgLyoqb25jZSB0aGUgcmVwZWF0ZWQgcGxheWluZyBjb21wbGV0ZXMsIHRoZSBwbGF5aW5nIHdpbGwgZW5kIGF0LCAtMSBtZWFucyB0byB0aGUgdGFpbCAqL1xuICAgICAgICB0aGlzLmxvb3BFbmRBdCA9IC0xO1xuICAgICAgICAvKipjb21wbGV0ZSBjYWxsYmFjayBoYW5kbGVyICovXG4gICAgICAgIHRoaXMuZW5kQ2FsbGJhY2sgPSBudWxsO1xuICAgICAgICAvKipjb250ZXh0IG9iamVjdCBmb3IgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uICovXG4gICAgICAgIHRoaXMuZW5kQ2FsbGJhY2tDb250ZXh0ID0gbnVsbDtcbiAgICB9XG4gICAgLyoqbW9kaWZ5IHRoZSBjdXJyZW50IHNldHRpbmdzIHdpdGhvdXQgd2hvbGUgcGFyYW1ldGVycyBwcm92aWRlZCAqL1xuICAgIG1peChvdGhlcikge1xuICAgICAgICBsZXQgcmV0ID0gdGhpcztcbiAgICAgICAgZm9yIChsZXQga2V5IGluIG90aGVyKSB7XG4gICAgICAgICAgICBpZiAoa2V5ID09IFwibWl4XCIpXG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICByZXRba2V5XSA9IG90aGVyW2tleV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxufVxuXG5jbGFzcyBNb3ZpZUNsaXAgZXh0ZW5kcyBCaXRtYXAge1xuICAgIGNvbnN0cnVjdG9yKG93bmVyKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuaW50ZXJ2YWwgPSAwO1xuICAgICAgICB0aGlzLnJlcGVhdERlbGF5ID0gMDtcbiAgICAgICAgdGhpcy4kZnJhbWVDb3VudCA9IDA7XG4gICAgICAgIHRoaXMuJGN1cnJlbnRGcmFtZSA9IDA7XG4gICAgICAgIHRoaXMuJHN0YXR1cyA9IDAgLyogTk9STUFMICovO1xuICAgICAgICB0aGlzLlVJT3duZXIgPSBvd25lcjtcbiAgICAgICAgdGhpcy5kYXRhID0gbmV3IE1vdmllQ2xpcERhdGEoKTtcbiAgICAgICAgdGhpcy4kcGxheWluZyA9IHRydWU7XG4gICAgICAgIHRoaXMubW91c2VFbmFibGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuJHNldHRpbmdzID0gbmV3IERlZmF1bHRNb3ZpZUNsaXBTZXR0aW5ncygpO1xuICAgICAgICB0aGlzLiRpc1RyaW0gPSB0cnVlO1xuICAgICAgICB0aGlzLm9uKCdhZGRlZCcsIHRoaXMuYWRkZWQsIHRoaXMpO1xuICAgICAgICB0aGlzLm9uKCdyZW1vdmVkJywgdGhpcy5yZW1vdmVkLCB0aGlzKTtcbiAgICB9XG4gICAgLy8gZHJhdyhjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgaWdub3JlQ2FjaGU6IGJvb2xlYW4pOiBib29sZWFuIHtcbiAgICAvLyAgICAgLy8gbGV0IGZsYWcgPSBzdXBlci5kcmF3KGN0eCwgaWdub3JlQ2FjaGUpO1xuICAgIC8vICAgICAvLyBpZiAoZmxhZykge1xuICAgIC8vICAgICAvLyAgICAgcmV0dXJuIGZsYWc7XG4gICAgLy8gICAgIC8vIH1cbiAgICAvLyAgICAgaWYgKHRoaXMuc291cmNlUmVjdCAmJiB0aGlzLnRleHR1cmVSZWN0KSB7XG4gICAgLy8gICAgICAgICBsZXQgeyB4LCB5LCB3aWR0aCwgaGVpZ2h0IH0gPSB0aGlzLnRleHR1cmVSZWN0O1xuICAgIC8vICAgICAgICAgY3R4LmRyYXdJbWFnZSh0aGlzLnRleHR1cmUsIHgsIHksIHdpZHRoLCBoZWlnaHQsIHRoaXMuc291cmNlUmVjdC54LCB0aGlzLnNvdXJjZVJlY3QueSwgdGhpcy5zb3VyY2VSZWN0LndpZHRoLCB0aGlzLnNvdXJjZVJlY3QuaGVpZ2h0KTsvL0dPYmplY3TmnaXmjqfliLbkvY3nva7lnZDmoIdcbiAgICAvLyAgICAgfSBlbHNlIHtcbiAgICAvLyAgICAgICAgIGN0eC5kcmF3SW1hZ2UodGhpcy50ZXh0dXJlLCAwLCAwKTtcbiAgICAvLyAgICAgfVxuICAgIC8vICAgICByZXR1cm4gdHJ1ZTtcbiAgICAvLyB9XG4gICAgZ2V0IGZyYW1lcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGZyYW1lcztcbiAgICB9XG4gICAgc2V0IGZyYW1lcyh2YWx1ZSkge1xuICAgICAgICB0aGlzLiRmcmFtZXMgPSB2YWx1ZTtcbiAgICAgICAgaWYgKHRoaXMuJGZyYW1lcyAhPSBudWxsKVxuICAgICAgICAgICAgdGhpcy4kZnJhbWVDb3VudCA9IHRoaXMuJGZyYW1lcy5sZW5ndGg7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRoaXMuJGZyYW1lQ291bnQgPSAwO1xuICAgICAgICBpZiAodGhpcy4kc2V0dGluZ3MuZW5kRnJhbWUgPT0gLTEgfHwgdGhpcy4kc2V0dGluZ3MuZW5kRnJhbWUgPiB0aGlzLiRmcmFtZUNvdW50IC0gMSlcbiAgICAgICAgICAgIHRoaXMuJHNldHRpbmdzLmVuZEZyYW1lID0gdGhpcy4kZnJhbWVDb3VudCAtIDE7XG4gICAgICAgIGlmICh0aGlzLiRzZXR0aW5ncy5sb29wRW5kQXQgPT0gLTEgfHwgdGhpcy4kc2V0dGluZ3MubG9vcEVuZEF0ID4gdGhpcy4kZnJhbWVDb3VudCAtIDEpXG4gICAgICAgICAgICB0aGlzLiRzZXR0aW5ncy5sb29wRW5kQXQgPSB0aGlzLiRmcmFtZUNvdW50IC0gMTtcbiAgICAgICAgaWYgKHRoaXMuJGN1cnJlbnRGcmFtZSA8IDAgfHwgdGhpcy4kY3VycmVudEZyYW1lID4gdGhpcy4kZnJhbWVDb3VudCAtIDEpXG4gICAgICAgICAgICB0aGlzLiRjdXJyZW50RnJhbWUgPSB0aGlzLiRmcmFtZUNvdW50IC0gMTtcbiAgICAgICAgaWYgKHRoaXMuJGZyYW1lQ291bnQgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLnNldEZyYW1lKHRoaXMuJGZyYW1lc1t0aGlzLiRjdXJyZW50RnJhbWVdKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0RnJhbWUobnVsbCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kYXRhLnJld2luZCgpO1xuICAgIH1cbiAgICBnZXQgZnJhbWVDb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGZyYW1lQ291bnQ7XG4gICAgfVxuICAgIC8vIHB1YmxpYyBnZXQgYm91bmRzUmVjdCgpOiBjcmVhdGVqcy5SZWN0YW5nbGUge1xuICAgIC8vICAgICByZXR1cm4gdGhpcy5nZXRCb3VuZHMoKTtcbiAgICAvLyAgICAgLy8gcmV0dXJuIHRoaXMuX2JvdW5kc1JlY3Q7XG4gICAgLy8gfVxuICAgIHNldCBib3VuZHNSZWN0KHZhbHVlKSB7XG4gICAgICAgIC8vIHRoaXMuX2JvdW5kc1JlY3QgPSB2YWx1ZTtcbiAgICAgICAgLy8gdGhpcy5zb3VyY2VSZWN0ID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCBjdXJyZW50RnJhbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRjdXJyZW50RnJhbWU7XG4gICAgfVxuICAgIHNldCBjdXJyZW50RnJhbWUodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJGN1cnJlbnRGcmFtZSAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kY3VycmVudEZyYW1lID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLmRhdGEuY3VycmVudEZyYW1lID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnNldEZyYW1lKHRoaXMuJGN1cnJlbnRGcmFtZSA8IHRoaXMuJGZyYW1lQ291bnQgPyB0aGlzLiRmcmFtZXNbdGhpcy4kY3VycmVudEZyYW1lXSA6IG51bGwpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBwbGF5aW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kcGxheWluZztcbiAgICB9XG4gICAgc2V0IHBsYXlpbmcodmFsdWUpIHtcbiAgICAgICAgdGhpcy4kcGxheWluZyA9IHZhbHVlO1xuICAgICAgICBpZiAodmFsdWUgJiYgR09iamVjdC5pc0Rpc3BsYXlPYmplY3RPblN0YWdlKHRoaXMpKVxuICAgICAgICAgICAgR1RpbWVyLmluc3QuYWRkKDAsIDAsIHRoaXMudXBkYXRlLCB0aGlzKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgR1RpbWVyLmluc3QucmVtb3ZlKHRoaXMudXBkYXRlLCB0aGlzKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICAgKiBNb2RpZnkgdGhlIHBsYXlpbmcgc2V0dGluZ3MgZm9yIHRoZSBjdXJyZW50IE1vdmllQ2xpcCBvYmplY3QsIHRoZXJlIGFyZSB0d28gd2F5cyB0byBjYWxsIHRoaXMgbWV0aG9kOlxuICAgICAgICogMSkgcGFzcyB3aG9sZSBwYXJhbWV0ZXJzOlxuICAgICAgICAgICAgICBzdGFydEZyYW1lOiBudW1iZXI7XG4gICAgICAgICAgICAgIGVuZEZyYW1lOiBudW1iZXI7XG4gICAgICAgICAgICAgIHJlcGVhdENvdW50OiBudW1iZXI7XG4gICAgICAgICAgICAgIGxvb3BFbmRBdDogbnVtYmVyO1xuICAgICAgICAgICAgICBlbmRDYWxsYmFjazogKHRhcmdldD86IE1vdmllQ2xpcCkgPT4gdm9pZDtcbiAgICAgICAgICAgICAgZW5kQ2FsbGJhY2tDb250ZXh0OiBhbnk7XG4gICAgICAgKiAyKSBqdXN0IHBhc3MgMSBvYmplY3Qgd2hpY2ggaW1wbGVtZW50cyBNb3ZpZUNsaXBTZXR0aW5ncyAocmVjb21tZW5kZWQpXG4gICAgICAgKi9cbiAgICBzZXRQbGF5U2V0dGluZ3MoLi4uYXJncykge1xuICAgICAgICBpZiAoYXJncy5sZW5ndGggPT0gMSAmJiB0eXBlb2YgYXJnc1swXSA9PSAnb2JqZWN0JylcbiAgICAgICAgICAgIHRoaXMuJHNldHRpbmdzLm1peChhcmdzWzBdKTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBsZXQgcyA9IGFyZ3NbMF0sIGUgPSBhcmdzWzFdLCByID0gYXJnc1syXSwgbCA9IGFyZ3NbM10sIGVjID0gYXJnc1s0XSwgZWNjID0gYXJnc1s1XTtcbiAgICAgICAgICAgIGxldCBvID0ge307XG4gICAgICAgICAgICBpZiAoTWF0aFV0aWwuaXNOdW1iZXIocykpXG4gICAgICAgICAgICAgICAgby5zdGFydEZyYW1lID0gcztcbiAgICAgICAgICAgIGlmIChNYXRoVXRpbC5pc051bWJlcihlKSlcbiAgICAgICAgICAgICAgICBvLmVuZEZyYW1lID0gZTtcbiAgICAgICAgICAgIGlmIChNYXRoVXRpbC5pc051bWJlcihyKSlcbiAgICAgICAgICAgICAgICBvLnJlcGVhdENvdW50ID0gcjtcbiAgICAgICAgICAgIGlmIChNYXRoVXRpbC5pc051bWJlcihsKSlcbiAgICAgICAgICAgICAgICBvLmxvb3BFbmRBdCA9IGw7XG4gICAgICAgICAgICBpZiAoZWMgJiYgdHlwZW9mIGVjID09ICdmdW5jdGlvbicpXG4gICAgICAgICAgICAgICAgby5lbmRDYWxsYmFjayA9IGVjO1xuICAgICAgICAgICAgaWYgKGVjYylcbiAgICAgICAgICAgICAgICBvLmVuZENhbGxiYWNrQ29udGV4dCA9IGVjYztcbiAgICAgICAgICAgIHRoaXMuJHNldHRpbmdzLm1peChvKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy4kc2V0dGluZ3MuZW5kRnJhbWUgPT0gLTEgfHwgdGhpcy4kc2V0dGluZ3MuZW5kRnJhbWUgPiB0aGlzLiRmcmFtZUNvdW50IC0gMSlcbiAgICAgICAgICAgIHRoaXMuJHNldHRpbmdzLmVuZEZyYW1lID0gdGhpcy4kZnJhbWVDb3VudCAtIDE7XG4gICAgICAgIGlmICh0aGlzLiRzZXR0aW5ncy5sb29wRW5kQXQgPT0gLTEpXG4gICAgICAgICAgICB0aGlzLiRzZXR0aW5ncy5sb29wRW5kQXQgPSB0aGlzLiRzZXR0aW5ncy5lbmRGcmFtZTtcbiAgICAgICAgdGhpcy4kc3RhdHVzID0gMCAvKiBOT1JNQUwgKi87XG4gICAgICAgIHRoaXMuY3VycmVudEZyYW1lID0gdGhpcy4kc2V0dGluZ3Muc3RhcnRGcmFtZTtcbiAgICB9XG4gICAgdXBkYXRlKCkge1xuICAgICAgICBpZiAodGhpcy5VSU93bmVyLiRpblByb2dyZXNzQnVpbGRpbmcpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmICh0aGlzLiRwbGF5aW5nICYmIHRoaXMuJGZyYW1lQ291bnQgIT0gMCAmJiB0aGlzLiRzdGF0dXMgIT0gMyAvKiBFTkRFRCAqLykge1xuICAgICAgICAgICAgdGhpcy5kYXRhLnVwZGF0ZSh0aGlzKTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRjdXJyZW50RnJhbWUgIT0gdGhpcy5kYXRhLmN1cnJlbnRGcmFtZSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRzdGF0dXMgPT0gMSAvKiBMT09QSU5HICovKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGN1cnJlbnRGcmFtZSA9IHRoaXMuJHNldHRpbmdzLnN0YXJ0RnJhbWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5jdXJyZW50RnJhbWUgPSB0aGlzLiRjdXJyZW50RnJhbWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHN0YXR1cyA9IDAgLyogTk9STUFMICovO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLiRzdGF0dXMgPT0gMiAvKiBTVE9QUElORyAqLykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjdXJyZW50RnJhbWUgPSB0aGlzLiRzZXR0aW5ncy5sb29wRW5kQXQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5jdXJyZW50RnJhbWUgPSB0aGlzLiRjdXJyZW50RnJhbWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHN0YXR1cyA9IDMgLyogRU5ERUQgKi87XG4gICAgICAgICAgICAgICAgICAgIC8vcGxheSBlbmRcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJHNldHRpbmdzLmVuZENhbGxiYWNrICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICBHVGltZXIuaW5zdC5jYWxsTGF0ZXIodGhpcy4kcGxheUVuZCwgdGhpcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjdXJyZW50RnJhbWUgPSB0aGlzLmRhdGEuY3VycmVudEZyYW1lO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kY3VycmVudEZyYW1lID09IHRoaXMuJHNldHRpbmdzLmVuZEZyYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kc2V0dGluZ3MucmVwZWF0Q291bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc2V0dGluZ3MucmVwZWF0Q291bnQtLTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kc2V0dGluZ3MucmVwZWF0Q291bnQgPT0gMClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc3RhdHVzID0gMiAvKiBTVE9QUElORyAqLztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHN0YXR1cyA9IDEgLyogTE9PUElORyAqLztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnNldEZyYW1lKHRoaXMuJGZyYW1lc1t0aGlzLiRjdXJyZW50RnJhbWVdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAkcGxheUVuZCgpIHtcbiAgICAgICAgaWYgKHRoaXMuJHNldHRpbmdzLmVuZENhbGxiYWNrICE9IG51bGwpIHtcbiAgICAgICAgICAgIGxldCBmID0gdGhpcy4kc2V0dGluZ3MuZW5kQ2FsbGJhY2s7XG4gICAgICAgICAgICBsZXQgZk9iaiA9IHRoaXMuJHNldHRpbmdzLmVuZENhbGxiYWNrQ29udGV4dDtcbiAgICAgICAgICAgIHRoaXMuJHNldHRpbmdzLmVuZENhbGxiYWNrID0gdGhpcy4kc2V0dGluZ3MuZW5kQ2FsbGJhY2tDb250ZXh0ID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuJHNldHRpbmdzLmVuZENhbGxiYWNrQ29udGV4dCA9IG51bGw7XG4gICAgICAgICAgICBpZiAoZilcbiAgICAgICAgICAgICAgICBmLmNhbGwoZk9iaiwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0RnJhbWUoZnJhbWUpIHtcbiAgICAgICAgdGhpcy50ZXh0dXJlID0gZnJhbWUgPT0gbnVsbCA/IG51bGwgOiBmcmFtZS50ZXh0dXJlLmltYWdlO1xuICAgICAgICB0aGlzLnRleHR1cmVSZWN0ID0gZnJhbWUudGV4dHVyZS5yZWN0O1xuICAgICAgICB0aGlzLnNvdXJjZVJlY3QgPSBmcmFtZS50ZXh0dXJlLnRyaW07XG4gICAgICAgIGxldCB7IHgsIHksIHdpZHRoLCBoZWlnaHQgfSA9IHRoaXMuc291cmNlUmVjdDtcbiAgICAgICAgdGhpcy5jYWNoZSh4LCB5LCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgLy8gdGhpcy5fdGV4dHVyZUlEID0gLTE7XG4gICAgfVxuICAgIGFkZGVkKGRpc3ApIHtcbiAgICAgICAgaWYgKHRoaXMuJHBsYXlpbmcpXG4gICAgICAgICAgICBHVGltZXIuaW5zdC5hZGQoMCwgMCwgdGhpcy51cGRhdGUsIHRoaXMpO1xuICAgIH1cbiAgICByZW1vdmVkKGRpc3ApIHtcbiAgICAgICAgaWYgKHRoaXMuJHBsYXlpbmcpXG4gICAgICAgICAgICBHVGltZXIuaW5zdC5yZW1vdmUodGhpcy51cGRhdGUsIHRoaXMpO1xuICAgIH1cbiAgICBkZXN0cm95KCkge1xuICAgICAgICBHVGltZXIuaW5zdC5yZW1vdmUodGhpcy51cGRhdGUsIHRoaXMpO1xuICAgICAgICB0aGlzLm9mZignYWRkZWQnLCB0aGlzLmFkZGVkKTtcbiAgICAgICAgdGhpcy5vZmYoJ3JlbW92ZWQnLCB0aGlzLnJlbW92ZWQpO1xuICAgICAgICBzdXBlci5kZXN0cm95KCk7XG4gICAgfVxufVxuXG5jbGFzcyBHTW92aWVDbGlwIGV4dGVuZHMgR09iamVjdCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgfVxuICAgIG1hcFBpdm90V2lkdGgoc2NhbGUpIHtcbiAgICAgICAgcmV0dXJuIHNjYWxlICogdGhpcy4kc291cmNlV2lkdGg7XG4gICAgfVxuICAgIG1hcFBpdm90SGVpZ2h0KHNjYWxlKSB7XG4gICAgICAgIHJldHVybiBzY2FsZSAqIHRoaXMuJHNvdXJjZUhlaWdodDtcbiAgICB9XG4gICAgaGFuZGxlU2l6ZUNoYW5nZWQoKSB7XG4gICAgICAgIGlmICh0aGlzLiRkaXNwbGF5T2JqZWN0ICE9IG51bGwgJiYgdGhpcy4kc291cmNlV2lkdGggIT0gMCAmJiB0aGlzLiRzb3VyY2VIZWlnaHQgIT0gMClcbiAgICAgICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3Quc2V0KHtcbiAgICAgICAgICAgICAgICBzY2FsZVg6ICh0aGlzLiR3aWR0aCAvIHRoaXMuJHNvdXJjZVdpZHRoKSAqIHRoaXMuJHNjYWxlWCxcbiAgICAgICAgICAgICAgICBzY2FsZVk6ICh0aGlzLiRoZWlnaHQgLyB0aGlzLiRzb3VyY2VIZWlnaHQpICogdGhpcy4kc2NhbGVZXG4gICAgICAgICAgICB9KTtcbiAgICB9XG4gICAgaGFuZGxlU2NhbGVDaGFuZ2VkKCkge1xuICAgICAgICBpZiAodGhpcy4kZGlzcGxheU9iamVjdCAhPSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLiRkaXNwbGF5T2JqZWN0LnNldCh7XG4gICAgICAgICAgICAgICAgc2NhbGVYOiAodGhpcy4kd2lkdGggLyB0aGlzLiRzb3VyY2VXaWR0aCkgKiB0aGlzLiRzY2FsZVgsXG4gICAgICAgICAgICAgICAgc2NhbGVZOiAodGhpcy4kaGVpZ2h0IC8gdGhpcy4kc291cmNlSGVpZ2h0KSAqIHRoaXMuJHNjYWxlWVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHRvdWNoYWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBzZXQgdG91Y2hhYmxlKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuJHRvdWNoYWJsZSA9IGZhbHNlOyAvL0dNb3ZpZUNsaXAgaGFzIG5vIGludGVyYWN0aW9uXG4gICAgfVxuICAgIGdldCBjb2xvcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJG1vdmllQ2xpcC50aW50O1xuICAgIH1cbiAgICBzZXQgY29sb3IodmFsdWUpIHtcbiAgICAgICAgdGhpcy4kbW92aWVDbGlwLnRpbnQgPSB2YWx1ZTtcbiAgICB9XG4gICAgY3JlYXRlRGlzcGxheU9iamVjdCgpIHtcbiAgICAgICAgdGhpcy4kbW92aWVDbGlwID0gbmV3IE1vdmllQ2xpcCh0aGlzKTtcbiAgICAgICAgdGhpcy5zZXREaXNwbGF5T2JqZWN0KHRoaXMuJG1vdmllQ2xpcCk7XG4gICAgfVxuICAgIGdldCBwbGF5aW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kbW92aWVDbGlwLnBsYXlpbmc7XG4gICAgfVxuICAgIHNldCBwbGF5aW5nKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiRtb3ZpZUNsaXAucGxheWluZyAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kbW92aWVDbGlwLnBsYXlpbmcgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlR2Vhcig1IC8qIEFuaW1hdGlvbiAqLyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGZyYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kbW92aWVDbGlwLmN1cnJlbnRGcmFtZTtcbiAgICB9XG4gICAgc2V0IGZyYW1lKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiRtb3ZpZUNsaXAuY3VycmVudEZyYW1lICE9IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiRtb3ZpZUNsaXAuY3VycmVudEZyYW1lID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUdlYXIoNSAvKiBBbmltYXRpb24gKi8pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAgICogTW9kaWZ5IHRoZSBwbGF5aW5nIHNldHRpbmdzIGZvciB0aGUgY3VycmVudCBNb3ZpZUNsaXAgb2JqZWN0LCB0aGVyZSBhcmUgdHdvIHdheXMgdG8gY2FsbCB0aGlzIG1ldGhvZDpcbiAgICAgICAqIDEpIHBhc3Mgd2hvbGUgcGFyYW1ldGVyczpcbiAgICAgICAgICAgICAgc3RhcnRGcmFtZTogbnVtYmVyO1xuICAgICAgICAgICAgICBlbmRGcmFtZTogbnVtYmVyO1xuICAgICAgICAgICAgICByZXBlYXRDb3VudDogbnVtYmVyO1xuICAgICAgICAgICAgICBsb29wRW5kQXQ6IG51bWJlcjtcbiAgICAgICAgICAgICAgZW5kQ2FsbGJhY2s6ICh0YXJnZXQ/OiBNb3ZpZUNsaXApID0+IHZvaWQ7XG4gICAgICAgICAgICAgIGVuZENhbGxiYWNrQ29udGV4dDogYW55O1xuICAgICAgICogMikganVzdCBwYXNzIDEgb2JqZWN0IHdoaWNoIGltcGxlbWVudHMgTW92aWVDbGlwU2V0dGluZ3MgKHJlY29tbWVuZGVkKVxuICAgICAgICovXG4gICAgc2V0UGxheVNldHRpbmdzKC4uLmFyZ3MpIHtcbiAgICAgICAgdGhpcy4kbW92aWVDbGlwLnNldFBsYXlTZXR0aW5ncy5hcHBseSh0aGlzLiRtb3ZpZUNsaXAsIGFyZ3MpO1xuICAgIH1cbiAgICBjb25zdHJ1Y3RGcm9tUmVzb3VyY2UoKSB7XG4gICAgICAgIHRoaXMuJHNvdXJjZVdpZHRoID0gdGhpcy5wYWNrYWdlSXRlbS53aWR0aDtcbiAgICAgICAgdGhpcy4kc291cmNlSGVpZ2h0ID0gdGhpcy5wYWNrYWdlSXRlbS5oZWlnaHQ7XG4gICAgICAgIHRoaXMuJGluaXRXaWR0aCA9IHRoaXMuJHNvdXJjZVdpZHRoO1xuICAgICAgICB0aGlzLiRpbml0SGVpZ2h0ID0gdGhpcy4kc291cmNlSGVpZ2h0O1xuICAgICAgICB0aGlzLnNldFNpemUodGhpcy4kc291cmNlV2lkdGgsIHRoaXMuJHNvdXJjZUhlaWdodCk7XG4gICAgICAgIHRoaXMucGFja2FnZUl0ZW0ubG9hZCgpO1xuICAgICAgICB0aGlzLiRtb3ZpZUNsaXAuaW50ZXJ2YWwgPSB0aGlzLnBhY2thZ2VJdGVtLmludGVydmFsO1xuICAgICAgICB0aGlzLiRtb3ZpZUNsaXAuc3dpbmcgPSB0aGlzLnBhY2thZ2VJdGVtLnN3aW5nO1xuICAgICAgICB0aGlzLiRtb3ZpZUNsaXAucmVwZWF0RGVsYXkgPSB0aGlzLnBhY2thZ2VJdGVtLnJlcGVhdERlbGF5O1xuICAgICAgICB0aGlzLiRtb3ZpZUNsaXAuZnJhbWVzID0gdGhpcy5wYWNrYWdlSXRlbS5mcmFtZXM7XG4gICAgICAgIHRoaXMuJG1vdmllQ2xpcC5ib3VuZHNSZWN0ID0gbmV3IGNyZWF0ZWpzLlJlY3RhbmdsZSgwLCAwLCB0aGlzLiRzb3VyY2VXaWR0aCwgdGhpcy4kc291cmNlSGVpZ2h0KTtcbiAgICB9XG4gICAgc2V0dXBCZWZvcmVBZGQoeG1sKSB7XG4gICAgICAgIHN1cGVyLnNldHVwQmVmb3JlQWRkKHhtbCk7XG4gICAgICAgIGxldCBzdHI7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmZyYW1lO1xuICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgdGhpcy4kbW92aWVDbGlwLmN1cnJlbnRGcmFtZSA9IHBhcnNlSW50KHN0cik7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnBsYXlpbmc7XG4gICAgICAgIHRoaXMuJG1vdmllQ2xpcC5wbGF5aW5nID0gc3RyICE9ICdmYWxzZSc7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmNvbG9yO1xuICAgICAgICBpZiAoc3RyKSB7XG4gICAgICAgICAgICB0aGlzLmNvbG9yID0gU3RyaW5nVXRpbC5IRVgyUkdCKHN0cik7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmNsYXNzIERPTUV2ZW50TWFuYWdlciBleHRlbmRzIGNyZWF0ZWpzLkV2ZW50RGlzcGF0Y2hlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMucmV0RXZlbnQgPSB7fTtcbiAgICAgICAgdGhpcy5udWxsTG93ZXN0RGVsdGFUaW1lb3V0ID0gTmFOO1xuICAgICAgICAvKioqKioqKioqKioqKioqKioqKmtleXMqKioqKioqKioqKioqKioqKioqL1xuICAgICAgICB0aGlzLiRwcmVzc2VkS2V5cyA9IHt9O1xuICAgICAgICB0aGlzLiRyZWxlYXNlZEtleXMgPSB7fTtcbiAgICAgICAgdGhpcy4kZG93bktleXMgPSBbXTtcbiAgICAgICAgLy9yZXNpemVcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGUgPT4gdGhpcy5ub3RpZnlSZXNpemVFdmVudHMoZSksIGZhbHNlKTtcbiAgICAgICAgLy9tb2RpZmVyIGtleXNcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBlID0+IHRoaXMub25XaW5kb3dLZXlEb3duKGUpLCBmYWxzZSk7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGUgPT4gdGhpcy5vbldpbmRvd0tleVVwKGUpLCBmYWxzZSk7XG4gICAgICAgIC8vbW91c2Ugd2hlZWxcbiAgICAgICAgY29uc3QgdG9CaW5kID0gJ29ud2hlZWwnIGluIGRvY3VtZW50IHx8IGRvY3VtZW50Wydkb2N1bWVudE1vZGUnXSA+PSA5XG4gICAgICAgICAgICA/IFsnd2hlZWwnXVxuICAgICAgICAgICAgOiBbJ21vdXNld2hlZWwnLCAnRG9tTW91c2VTY3JvbGwnLCAnTW96TW91c2VQaXhlbFNjcm9sbCddO1xuICAgICAgICBmb3IgKGxldCBpID0gdG9CaW5kLmxlbmd0aDsgaTspIHtcbiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKHRvQmluZFstLWldLCBlID0+IHRoaXMub25Nb3VzZVdoZWVsKGUpLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy9yZXNpemVcbiAgICBub3RpZnlSZXNpemVFdmVudHMoZSkge1xuICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoJ3Jlc2l6ZScpO1xuICAgIH1cbiAgICBvbk1vdXNlV2hlZWwoZXZlbnQpIHtcbiAgICAgICAgbGV0IG9yZ0V2ZW50ID0gZXZlbnQgfHwgd2luZG93LmV2ZW50LCBkZWx0YSA9IDAsIGRlbHRhWCA9IDAsIGRlbHRhWSA9IDAsIGFic0RlbHRhID0gMDtcbiAgICAgICAgaWYgKCdkZXRhaWwnIGluIG9yZ0V2ZW50KSB7XG4gICAgICAgICAgICBkZWx0YVkgPSBvcmdFdmVudC5kZXRhaWwgKiAtMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoJ3doZWVsRGVsdGEnIGluIG9yZ0V2ZW50KSB7XG4gICAgICAgICAgICBkZWx0YVkgPSBvcmdFdmVudC53aGVlbERlbHRhO1xuICAgICAgICB9XG4gICAgICAgIGlmICgnd2hlZWxEZWx0YVknIGluIG9yZ0V2ZW50KSB7XG4gICAgICAgICAgICBkZWx0YVkgPSBvcmdFdmVudC53aGVlbERlbHRhWTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoJ3doZWVsRGVsdGFYJyBpbiBvcmdFdmVudCkge1xuICAgICAgICAgICAgZGVsdGFYID0gb3JnRXZlbnQud2hlZWxEZWx0YVggKiAtMTtcbiAgICAgICAgfVxuICAgICAgICAvL0ZGIERPTU1vdXNlU2Nyb2xsXG4gICAgICAgIGlmICgnYXhpcycgaW4gb3JnRXZlbnQgJiYgb3JnRXZlbnQuYXhpcyA9PT0gb3JnRXZlbnQuSE9SSVpPTlRBTF9BWElTKSB7XG4gICAgICAgICAgICBkZWx0YVggPSBkZWx0YVkgKiAtMTtcbiAgICAgICAgICAgIGRlbHRhWSA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgZGVsdGEgPSBkZWx0YVkgPT09IDAgPyBkZWx0YVggOiBkZWx0YVk7XG4gICAgICAgIGlmICgnZGVsdGFZJyBpbiBvcmdFdmVudCkge1xuICAgICAgICAgICAgZGVsdGFZID0gb3JnRXZlbnQuZGVsdGFZICogLTE7XG4gICAgICAgICAgICBkZWx0YSA9IGRlbHRhWTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoJ2RlbHRhWCcgaW4gb3JnRXZlbnQpIHtcbiAgICAgICAgICAgIGRlbHRhWCA9IG9yZ0V2ZW50LmRlbHRhWDtcbiAgICAgICAgICAgIGlmIChkZWx0YVkgPT09IDApIHtcbiAgICAgICAgICAgICAgICBkZWx0YSA9IGRlbHRhWCAqIC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChkZWx0YVkgPT09IDAgJiYgZGVsdGFYID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gRGVsdGEgbW9kZXM6XG4gICAgICAgIC8vICAgKiBkZWx0YU1vZGUgMCBpcyBieSBwaXhlbHMsIG5vdGhpbmcgdG8gZG9cbiAgICAgICAgLy8gICAqIGRlbHRhTW9kZSAxIGlzIGJ5IGxpbmVzXG4gICAgICAgIC8vICAgKiBkZWx0YU1vZGUgMiBpcyBieSBwYWdlc1xuICAgICAgICBpZiAob3JnRXZlbnQuZGVsdGFNb2RlID09PSAxKSB7XG4gICAgICAgICAgICBjb25zdCBsaW5lSGVpZ2h0ID0gMTY7IC8vZm9udFNpemUgLSBsaW5lLWhlaWdodDtcbiAgICAgICAgICAgIGRlbHRhICo9IGxpbmVIZWlnaHQ7XG4gICAgICAgICAgICBkZWx0YVkgKj0gbGluZUhlaWdodDtcbiAgICAgICAgICAgIGRlbHRhWCAqPSBsaW5lSGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG9yZ0V2ZW50LmRlbHRhTW9kZSA9PT0gMikge1xuICAgICAgICAgICAgY29uc3QgcGFnZUhlaWdodCA9IDE2OyAvL2RvbS5jbGllbnRIZWlnaHQgPSBwYWdlLWhlaWdodFxuICAgICAgICAgICAgZGVsdGEgKj0gcGFnZUhlaWdodDtcbiAgICAgICAgICAgIGRlbHRhWSAqPSBwYWdlSGVpZ2h0O1xuICAgICAgICAgICAgZGVsdGFYICo9IHBhZ2VIZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgYWJzRGVsdGEgPSBNYXRoLm1heChNYXRoLmFicyhkZWx0YVkpLCBNYXRoLmFicyhkZWx0YVgpKTtcbiAgICAgICAgaWYgKCF0aGlzLmxvd2VzdERlbHRhIHx8IGFic0RlbHRhIDwgdGhpcy5sb3dlc3REZWx0YSkge1xuICAgICAgICAgICAgdGhpcy5sb3dlc3REZWx0YSA9IGFic0RlbHRhO1xuICAgICAgICAgICAgaWYgKG9yZ0V2ZW50LnR5cGUgPT09ICdtb3VzZXdoZWVsJyAmJiBhYnNEZWx0YSAlIDEyMCA9PT0gMClcbiAgICAgICAgICAgICAgICB0aGlzLmxvd2VzdERlbHRhIC89IDQwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcmdFdmVudC50eXBlID09PSAnbW91c2V3aGVlbCcgJiYgYWJzRGVsdGEgJSAxMjAgPT09IDApIHtcbiAgICAgICAgICAgIGRlbHRhIC89IDQwO1xuICAgICAgICAgICAgZGVsdGFYIC89IDQwO1xuICAgICAgICAgICAgZGVsdGFZIC89IDQwO1xuICAgICAgICB9XG4gICAgICAgIGRlbHRhID0gTWF0aFtkZWx0YSA+PSAxID8gJ2Zsb29yJyA6ICdjZWlsJ10oZGVsdGEgLyB0aGlzLmxvd2VzdERlbHRhKTtcbiAgICAgICAgZGVsdGFYID0gTWF0aFtkZWx0YVggPj0gMSA/ICdmbG9vcicgOiAnY2VpbCddKGRlbHRhWCAvIHRoaXMubG93ZXN0RGVsdGEpO1xuICAgICAgICBkZWx0YVkgPSBNYXRoW2RlbHRhWSA+PSAxID8gJ2Zsb29yJyA6ICdjZWlsJ10oZGVsdGFZIC8gdGhpcy5sb3dlc3REZWx0YSk7XG4gICAgICAgIHRoaXMucmV0RXZlbnQuZGVsdGEgPSBkZWx0YTtcbiAgICAgICAgdGhpcy5yZXRFdmVudC5kZWx0YVggPSBkZWx0YVg7XG4gICAgICAgIHRoaXMucmV0RXZlbnQuZGVsdGFZID0gZGVsdGFZO1xuICAgICAgICB0aGlzLnJldEV2ZW50LmRlbHRhRmFjdG9yID0gdGhpcy5sb3dlc3REZWx0YTtcbiAgICAgICAgdGhpcy5yZXRFdmVudC5kZWx0YU1vZGUgPSAwO1xuICAgICAgICBpZiAodGhpcy5udWxsTG93ZXN0RGVsdGFUaW1lb3V0KSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5udWxsTG93ZXN0RGVsdGFUaW1lb3V0KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm51bGxMb3dlc3REZWx0YVRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB0aGlzLm51bGxMb3dlc3REZWx0YSgpLCAyMDApO1xuICAgICAgICBsZXQgZXZ0ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KFwiX19tb3VzZVdoZWVsXCIgLyogTU9VU0VfV0hFRUwgKi8sIHRydWUsIGZhbHNlKTtcbiAgICAgICAgZXZ0LmRhdGEgPSB7IGV2ZW50OiB0aGlzLnJldEV2ZW50IH07XG4gICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChldnQsIHRoaXMpO1xuICAgIH1cbiAgICBudWxsTG93ZXN0RGVsdGEoKSB7XG4gICAgICAgIHRoaXMubG93ZXN0RGVsdGEgPSBudWxsO1xuICAgIH1cbiAgICBpc0tleURvd24oa2V5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRkb3duS2V5cy5pbmRleE9mKGtleSkgPj0gMDtcbiAgICB9XG4gICAgaXNLZXlQcmVzc2VkKGtleSkge1xuICAgICAgICByZXR1cm4gISF0aGlzLiRwcmVzc2VkS2V5c1trZXldO1xuICAgIH1cbiAgICBpc0tleVJlbGVhc2VkKGtleSkge1xuICAgICAgICByZXR1cm4gISF0aGlzLiRyZWxlYXNlZEtleXNba2V5XTtcbiAgICB9XG4gICAgb25XaW5kb3dLZXlEb3duKGV2dCkge1xuICAgICAgICBsZXQga2V5ID0gZXZ0LndoaWNoIHx8IGV2dC5rZXlDb2RlO1xuICAgICAgICBpZiAoIXRoaXMuaXNLZXlEb3duKGtleSkpIHtcbiAgICAgICAgICAgIHRoaXMuJGRvd25LZXlzLnB1c2goa2V5KTtcbiAgICAgICAgICAgIHRoaXMuJHByZXNzZWRLZXlzW2tleV0gPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KCdrZXlQcmVzc2VkJywga2V5KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBvbldpbmRvd0tleVVwKGV2dCkge1xuICAgICAgICBsZXQga2V5ID0gZXZ0LndoaWNoIHx8IGV2dC5rZXlDb2RlO1xuICAgICAgICBpZiAodGhpcy5pc0tleURvd24oa2V5KSkge1xuICAgICAgICAgICAgdGhpcy4kcHJlc3NlZEtleXNba2V5XSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy4kcmVsZWFzZWRLZXlzW2tleV0gPSB0cnVlO1xuICAgICAgICAgICAgbGV0IGluZGV4ID0gdGhpcy4kZG93bktleXMuaW5kZXhPZihrZXkpO1xuICAgICAgICAgICAgaWYgKGluZGV4ID49IDApXG4gICAgICAgICAgICAgICAgdGhpcy4kZG93bktleXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudCgna2V5UmVsZWFzZWQnLCBrZXkpO1xuICAgICAgICB9XG4gICAgfVxufVxuRE9NRXZlbnRNYW5hZ2VyLmluc3QgPSBuZXcgRE9NRXZlbnRNYW5hZ2VyKCk7XG5cbmNsYXNzIEhUTUxJbnB1dCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8qKkBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLiRyZXF1ZXN0VG9TaG93ID0gZmFsc2U7XG4gICAgICAgIC8qKkBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLiRzY2FsZVggPSAxO1xuICAgICAgICAvKipAaW50ZXJuYWwgKi9cbiAgICAgICAgdGhpcy4kc2NhbGVZID0gMTtcbiAgICB9XG4gICAgc3RhdGljIGdldCBpbnN0KCkge1xuICAgICAgICBpZiAoIUhUTUxJbnB1dC4kaW5zdGFuY2UpXG4gICAgICAgICAgICBIVE1MSW5wdXQuJGluc3RhbmNlID0gbmV3IEhUTUxJbnB1dCgpO1xuICAgICAgICByZXR1cm4gSFRNTElucHV0LiRpbnN0YW5jZTtcbiAgICB9XG4gICAgaW5pdGlhbGl6ZShjb250YWluZXIsIHZpZXcpIHtcbiAgICAgICAgdGhpcy4kY2FudmFzID0gdmlldztcbiAgICAgICAgbGV0IGRpdjtcbiAgICAgICAgaWYgKCF0aGlzLiRkZWxlZ2F0ZURpdikge1xuICAgICAgICAgICAgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICB0aGlzLiRkZWxlZ2F0ZURpdiA9IGRpdjtcbiAgICAgICAgICAgIGRpdi5pZCA9ICdfX2RlbGVnYXRlRGl2JztcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaXYpO1xuICAgICAgICAgICAgdGhpcy5pbml0RG9tUG9zKGRpdik7XG4gICAgICAgICAgICB0aGlzLiR3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICB0aGlzLmluaXREb21Qb3ModGhpcy4kd3JhcHBlcik7XG4gICAgICAgICAgICB0aGlzLiR3cmFwcGVyLnN0eWxlLndpZHRoID0gJzBweCc7XG4gICAgICAgICAgICB0aGlzLiR3cmFwcGVyLnN0eWxlLmhlaWdodCA9ICcwcHgnO1xuICAgICAgICAgICAgdGhpcy4kd3JhcHBlci5zdHlsZS5sZWZ0ID0gJzBweCc7XG4gICAgICAgICAgICB0aGlzLiR3cmFwcGVyLnN0eWxlLnRvcCA9ICctMTAwcHgnO1xuICAgICAgICAgICAgdGhpcy5zZXRUcmFuc2Zvcm0odGhpcy4kd3JhcHBlciwgJzAlIDAlIDBweCcpO1xuICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkKHRoaXMuJHdyYXBwZXIpO1xuICAgICAgICAgICAgRGVjbHMkMS5HUm9vdC5pbnN0Lm9uKEludGVyYWN0aXZlRXZlbnRzLkNsaWNrLCB0aGlzLmNhbnZhc0NsaWNrSGFuZGxlciwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLmluaXRJbnB1dEVsZW1lbnQodHJ1ZSk7IC8vaW5wdXRcbiAgICAgICAgICAgIHRoaXMuaW5pdElucHV0RWxlbWVudChmYWxzZSk7IC8vdGV4dGFyZWFcbiAgICAgICAgfVxuICAgIH1cbiAgICBpc0lucHV0T24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRpbnB1dCAhPSBudWxsO1xuICAgIH1cbiAgICBjYW52YXNDbGlja0hhbmRsZXIoZSkge1xuICAgICAgICBpZiAodGhpcy4kcmVxdWVzdFRvU2hvdykge1xuICAgICAgICAgICAgdGhpcy4kcmVxdWVzdFRvU2hvdyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy4kaW5wdXQub25DbGlja0hhbmRsZXIoZSk7XG4gICAgICAgICAgICB0aGlzLnNob3coKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRjdXJFbGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFySW5wdXRFbGVtZW50KCk7XG4gICAgICAgICAgICAgICAgdGhpcy4kY3VyRWxlLmJsdXIoKTtcbiAgICAgICAgICAgICAgICB0aGlzLiRjdXJFbGUgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGlzSW5wdXRTaG93bigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGlucHV0ICE9IG51bGw7XG4gICAgfVxuICAgIGlzQ3VycmVudElucHV0KGlucHV0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRpbnB1dCA9PSBpbnB1dDtcbiAgICB9XG4gICAgaW5pdERvbVBvcyhkb20pIHtcbiAgICAgICAgZG9tLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcbiAgICAgICAgZG9tLnN0eWxlLmxlZnQgPSAnMHB4JztcbiAgICAgICAgZG9tLnN0eWxlLnRvcCA9ICcwcHgnO1xuICAgICAgICBkb20uc3R5bGUuYm9yZGVyID0gJ25vbmUnO1xuICAgICAgICBkb20uc3R5bGUucGFkZGluZyA9ICcwJztcbiAgICB9XG4gICAgc2V0VHJhbnNmb3JtKGVsLCBvcmlnaW4sIHRyYW5zZm9ybSkge1xuICAgICAgICBsZXQgc3R5bGUgPSBlbC5zdHlsZTtcbiAgICAgICAgc3R5bGUudHJhbnNmb3JtT3JpZ2luID0gc3R5bGUud2Via2l0VHJhbnNmb3JtT3JpZ2luID0gc3R5bGUubXNUcmFuc2Zvcm1PcmlnaW4gPSBzdHlsZS5tb3pUcmFuc2Zvcm1PcmlnaW4gPSBzdHlsZS5vVHJhbnNmb3JtT3JpZ2luID0gb3JpZ2luO1xuICAgICAgICBpZiAodHJhbnNmb3JtICYmIHRyYW5zZm9ybS5sZW5ndGggPiAwKVxuICAgICAgICAgICAgc3R5bGUudHJhbnNmb3JtID0gc3R5bGUud2Via2l0VHJhbnNmb3JtID0gc3R5bGUubXNUcmFuc2Zvcm0gPSBzdHlsZS5tb3pUcmFuc2Zvcm0gPSBzdHlsZS5vVHJhbnNmb3JtID0gdHJhbnNmb3JtO1xuICAgIH1cbiAgICAvKipAaW50ZXJuYWwgKi9cbiAgICB1cGRhdGVTaXplKHN4LCBzeSkge1xuICAgICAgICBpZiAoIXRoaXMuJGNhbnZhcylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy4kc2NhbGVYID0gc3g7XG4gICAgICAgIHRoaXMuJHNjYWxlWSA9IHN5O1xuICAgICAgICB0aGlzLiRkZWxlZ2F0ZURpdi5zdHlsZS5sZWZ0ID0gdGhpcy4kY2FudmFzLnN0eWxlLmxlZnQ7XG4gICAgICAgIHRoaXMuJGRlbGVnYXRlRGl2LnN0eWxlLnRvcCA9IHRoaXMuJGNhbnZhcy5zdHlsZS50b3A7XG4gICAgICAgIGxldCBjdnNTdHlsZSA9IHRoaXMuJGNhbnZhcy5zdHlsZTtcbiAgICAgICAgdGhpcy5zZXRUcmFuc2Zvcm0odGhpcy4kZGVsZWdhdGVEaXYsICcwJSAwJSAwcHgnLCBjdnNTdHlsZS50cmFuc2Zvcm0gfHxcbiAgICAgICAgICAgIGN2c1N0eWxlLndlYmtpdFRyYW5zZm9ybSB8fFxuICAgICAgICAgICAgY3ZzU3R5bGUubXNUcmFuc2Zvcm0gfHxcbiAgICAgICAgICAgIGN2c1N0eWxlLm1velRyYW5zZm9ybSB8fFxuICAgICAgICAgICAgY3ZzU3R5bGUub1RyYW5zZm9ybSk7XG4gICAgfVxuICAgIGluaXRJbnB1dEVsZW1lbnQobXVsdGlsaW5lKSB7XG4gICAgICAgIGxldCBpbnB1dEVsZW1lbnQ7XG4gICAgICAgIGlmIChtdWx0aWxpbmUpIHtcbiAgICAgICAgICAgIGlucHV0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RleHRhcmVhJyk7XG4gICAgICAgICAgICBpbnB1dEVsZW1lbnQuc3R5bGUucmVzaXplID0gJ25vbmUnO1xuICAgICAgICAgICAgdGhpcy4kbXVsdGlMaW5lID0gaW5wdXRFbGVtZW50O1xuICAgICAgICAgICAgaW5wdXRFbGVtZW50LmlkID0gJ3N0YWdlVGV4dEFyZWFFbGUnO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaW5wdXRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICAgICAgICAgIHRoaXMuJHNpbmdsZUxpbmUgPSBpbnB1dEVsZW1lbnQ7XG4gICAgICAgICAgICBpbnB1dEVsZW1lbnQudHlwZSA9ICd0ZXh0JztcbiAgICAgICAgICAgIGlucHV0RWxlbWVudC5pZCA9ICdzdGFnZUlucHV0RWxlJztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiR3cmFwcGVyLmFwcGVuZENoaWxkKGlucHV0RWxlbWVudCk7XG4gICAgICAgIGlucHV0RWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJy0xJyk7XG4gICAgICAgIGlucHV0RWxlbWVudC5zdHlsZS53aWR0aCA9ICcxcHgnO1xuICAgICAgICBpbnB1dEVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gJzEycHgnO1xuICAgICAgICB0aGlzLmluaXREb21Qb3MoaW5wdXRFbGVtZW50KTtcbiAgICAgICAgbGV0IHN0eWxlID0gaW5wdXRFbGVtZW50LnN0eWxlO1xuICAgICAgICBzdHlsZS5vdXRsaW5lID0gJ3RoaW4nO1xuICAgICAgICBzdHlsZS5iYWNrZ3JvdW5kID0gJ25vbmUnO1xuICAgICAgICBzdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xuICAgICAgICBzdHlsZS53b3JkQnJlYWsgPSAnYnJlYWstYWxsJztcbiAgICAgICAgc3R5bGUub3BhY2l0eSA9IDA7XG4gICAgICAgIGlucHV0RWxlbWVudC5vbmlucHV0ID0gZSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy4kaW5wdXQpXG4gICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQub25JbnB1dEhhbmRsZXIoKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgc2hvdygpIHtcbiAgICAgICAgR1RpbWVyLmluc3QuY2FsbExhdGVyKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuJGN1ckVsZS5zdHlsZS5vcGFjaXR5ID0gJzEnO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICB9XG4gICAgZGlzY29ubmVjdChlbGUpIHtcbiAgICAgICAgaWYgKHRoaXMuJGlucHV0ID09IG51bGwgfHwgdGhpcy4kaW5wdXQgPT0gZWxlKSB7XG4gICAgICAgICAgICB0aGlzLmNsZWFySW5wdXRFbGVtZW50KCk7XG4gICAgICAgICAgICBpZiAodGhpcy4kY3VyRWxlKVxuICAgICAgICAgICAgICAgIHRoaXMuJGN1ckVsZS5ibHVyKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2xlYXJBdHRyaWJ1dGVzKG9iaikge1xuICAgICAgICBpZiAodGhpcy4kY3VyRWxlKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gb2JqKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kY3VyRWxlLnJlbW92ZUF0dHJpYnV0ZShrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNsZWFySW5wdXRFbGVtZW50KCkge1xuICAgICAgICBpZiAodGhpcy4kY3VyRWxlKSB7XG4gICAgICAgICAgICB0aGlzLiRjdXJFbGUudmFsdWUgPSAnJztcbiAgICAgICAgICAgIHRoaXMuJGN1ckVsZS5vbmJsdXIgPSBudWxsO1xuICAgICAgICAgICAgbGV0IHN0eWxlID0gdGhpcy4kY3VyRWxlLnN0eWxlO1xuICAgICAgICAgICAgc3R5bGUud2lkdGggPSAnMXB4JztcbiAgICAgICAgICAgIHN0eWxlLmhlaWdodCA9ICcxMnB4JztcbiAgICAgICAgICAgIHN0eWxlLmxlZnQgPSAnMHB4JztcbiAgICAgICAgICAgIHN0eWxlLnRvcCA9ICcwcHgnO1xuICAgICAgICAgICAgc3R5bGUub3BhY2l0eSA9ICcwJztcbiAgICAgICAgICAgIGxldCBlbDI7XG4gICAgICAgICAgICBpZiAodGhpcy4kc2luZ2xlTGluZSA9PSB0aGlzLiRjdXJFbGUpXG4gICAgICAgICAgICAgICAgZWwyID0gdGhpcy4kbXVsdGlMaW5lO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGVsMiA9IHRoaXMuJHNpbmdsZUxpbmU7XG4gICAgICAgICAgICBlbDIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgICAgICB0aGlzLiR3cmFwcGVyLnN0eWxlLmxlZnQgPSAnMHB4JztcbiAgICAgICAgICAgIHRoaXMuJHdyYXBwZXIuc3R5bGUudG9wID0gJy0xMDBweCc7XG4gICAgICAgICAgICB0aGlzLiR3cmFwcGVyLnN0eWxlLmhlaWdodCA9ICcwcHgnO1xuICAgICAgICAgICAgdGhpcy4kd3JhcHBlci5zdHlsZS53aWR0aCA9ICcwcHgnO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLiRpbnB1dCkge1xuICAgICAgICAgICAgdGhpcy4kaW5wdXQub25EaXNjb25uZWN0KCk7XG4gICAgICAgICAgICB0aGlzLiRpbnB1dCA9IG51bGw7XG4gICAgICAgICAgICBIVE1MSW5wdXQuaXNUeXBpbmcgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXF1ZXN0SW5wdXQoZWxlKSB7XG4gICAgICAgIHRoaXMuY2xlYXJJbnB1dEVsZW1lbnQoKTtcbiAgICAgICAgdGhpcy4kaW5wdXQgPSBlbGU7XG4gICAgICAgIEhUTUxJbnB1dC5pc1R5cGluZyA9IHRydWU7XG4gICAgICAgIGxldCBlbDI7XG4gICAgICAgIGlmICh0aGlzLiRpbnB1dC50ZXh0RmllbGQubXVsdGlwbGVMaW5lKSB7XG4gICAgICAgICAgICB0aGlzLiRjdXJFbGUgPSB0aGlzLiRtdWx0aUxpbmU7XG4gICAgICAgICAgICBlbDIgPSB0aGlzLiRzaW5nbGVMaW5lO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy4kY3VyRWxlID0gdGhpcy4kc2luZ2xlTGluZTtcbiAgICAgICAgICAgIGVsMiA9IHRoaXMuJG11bHRpTGluZTtcbiAgICAgICAgfVxuICAgICAgICBlbDIuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgcmV0dXJuIHRoaXMuJGN1ckVsZTtcbiAgICB9XG59XG5IVE1MSW5wdXQuaXNUeXBpbmcgPSBmYWxzZTtcblxuY2xhc3MgRGVmYXVsdFVJU3RhZ2VPcHRpb25zIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5zY2FsZU1vZGUgPSBcInNob3dBbGxcIiAvKiBTSE9XX0FMTCAqLztcbiAgICAgICAgdGhpcy5vcmllbnRhdGlvbiA9IFwiYXV0b1wiIC8qIEFVVE8gKi87XG4gICAgICAgIHRoaXMucmVzb2x1dGlvbiA9IDE7XG4gICAgICAgIHRoaXMuZGVzaWduV2lkdGggPSA4MDA7XG4gICAgICAgIHRoaXMuZGVzaWduSGVpZ2h0ID0gNjAwO1xuICAgICAgICB0aGlzLmFsaWduViA9IDQgLyogTUlERExFICovO1xuICAgICAgICB0aGlzLmFsaWduSCA9IDEgLyogQ0VOVEVSICovO1xuICAgICAgICB0aGlzLmZhbGxiYWNrV2lkdGggPSAwO1xuICAgICAgICB0aGlzLmZhbGxiYWNrSGVpZ2h0ID0gMDtcbiAgICB9XG59XG5jbGFzcyBEZWZhdWx0Qm91ZGluZ1JlY3RDYWxjdWxhdG9yIHtcbiAgICBnZXRSZWN0KHZpZXcsIGZhbGxiYWNrV2lkdGgsIGZhbGxiYWNrSGVpZ2h0KSB7XG4gICAgICAgIGxldCBwID0gdmlldy5wYXJlbnRFbGVtZW50O1xuICAgICAgICBpZiAoIXApXG4gICAgICAgICAgICAvL3RoaXMgc2hvdWxkIGJlIGltcG9zc2libGUgc2l0dWF0aW9uIHVubGVzcyB0aGUgdXNlciBmb3JnZXQgdG8gYXBwZW5kIHRoZSB2aWV3IGludG8gdGhlIERPTS5cbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIllvdXIgdmlldyBvZiBQSVhJIGFyZSBzdGlsbCBpbiBtZW1vcnkgYnV0IG5vdCBhcHBlbmRlZCB0byBET00geWV0PyBpdCdzIG5lY2Vzc2FyeSB0aGF0IHRoZXJlIGlzIGEgcGFyZW50IGVsZW1lbnQgdG8gd3JhcCB5b3VyIHZpZXcgdXAuXCIpO1xuICAgICAgICBsZXQgcmVjdCA9IHAuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgIGxldCByZXQgPSB7XG4gICAgICAgICAgICB4OiAwLFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIHdpZHRoOiAwLFxuICAgICAgICAgICAgaGVpZ2h0OiAwXG4gICAgICAgIH07XG4gICAgICAgIGlmICghcmVjdCB8fCByZWN0LndpZHRoIDw9IDAgfHwgcmVjdC5oZWlnaHQgPD0gMCkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdJdCBzZWVtcyB0aGF0IHlvdSBkaWQgbm90IHNldCBhIGV4cGxpY2l0IHNpemUgZm9yIHRoZSBwYXJlbnQgZWxlbWVudCBvZiB5b3VyIHZpZXcsIG5vdyBmYWxsIGJhY2sgdG8gd2luZG93IHNpemUgaW5zdGVhZC4nKTtcbiAgICAgICAgICAgIHJldC53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgICAgICAgcmV0LmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICAgICAgICAgIHJldC54ID0gMDtcbiAgICAgICAgICAgIHJldC55ID0gMDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldC54ID0gcmVjdC5sZWZ0O1xuICAgICAgICAgICAgcmV0LnkgPSByZWN0LnRvcDtcbiAgICAgICAgICAgIHJldC53aWR0aCA9IHJlY3Qud2lkdGg7XG4gICAgICAgICAgICByZXQuaGVpZ2h0ID0gcmVjdC5oZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgLy9jb25zaWRlciB0aGUgd29yc3Qgc2l0dWF0aW9uOiB3aW5kb3cgZG9lcyBub3QgaGF2ZSBzaXplISFcbiAgICAgICAgaWYgKHJldC53aWR0aCA8PSAwIHx8IHJldC5oZWlnaHQgPD0gMCkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdmZXRjaCBjb250YWluZXIgc2l6ZSB0byBpbml0aWFsaXplIFBJWEkgaW4gYWxsIHdheXMgaGF2ZSBmYWlsZWQsIG5vdyB1c2UgZGVmYXVsdCBzaXplIChmYWxsYmFja1dpZHRoIC8gZmFsbGJhY2tIZWlnaHQpIHNwZWNpZmllZCBpbiB0aGUgb3B0aW9ucyBpbnN0ZWFkLicpO1xuICAgICAgICAgICAgcmV0LndpZHRoID0gZmFsbGJhY2tXaWR0aDtcbiAgICAgICAgICAgIHJldC5oZWlnaHQgPSBmYWxsYmFja0hlaWdodDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH1cbn1cbmNsYXNzIFVJU3RhZ2UgZXh0ZW5kcyBjcmVhdGVqcy5FdmVudERpc3BhdGNoZXIge1xuICAgIGNvbnN0cnVjdG9yKGFwcCwgc3RhZ2VPcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuJHdpZHRoID0gMDtcbiAgICAgICAgdGhpcy4kaGVpZ2h0ID0gMDtcbiAgICAgICAgdGhpcy4kc2NhbGVYID0gMTtcbiAgICAgICAgdGhpcy4kc2NhbGVZID0gMTtcbiAgICAgICAgdGhpcy4kY2FudmFzTWF0cml4ID0gbmV3IGNyZWF0ZWpzLk1hdHJpeDJEKCk7XG4gICAgICAgIHRoaXMub2Zmc2V0WCA9IDA7XG4gICAgICAgIHRoaXMub2Zmc2V0WSA9IDA7XG4gICAgICAgIHRoaXMuJHNpemVDYWxjZXIgPSBuZXcgRGVmYXVsdEJvdWRpbmdSZWN0Q2FsY3VsYXRvcigpO1xuICAgICAgICBVSVN0YWdlSW5zdC5wdXNoKHRoaXMpO1xuICAgICAgICB0aGlzLiRhcHBDb250ZXh0ID0gYXBwO1xuICAgICAgICBsZXQgb3B0O1xuICAgICAgICBpZiAoc3RhZ2VPcHRpb25zIGluc3RhbmNlb2YgRGVmYXVsdFVJU3RhZ2VPcHRpb25zKVxuICAgICAgICAgICAgb3B0ID0gc3RhZ2VPcHRpb25zO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG9wdCA9IG5ldyBEZWZhdWx0VUlTdGFnZU9wdGlvbnMoKTtcbiAgICAgICAgICAgIGlmIChzdGFnZU9wdGlvbnMgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgaW4gc3RhZ2VPcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdFtpXSA9IHN0YWdlT3B0aW9uc1tpXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFvcHQuZGVzaWduV2lkdGggfHwgIW9wdC5kZXNpZ25IZWlnaHQpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGRlc2lnbldpZHRoIC8gZGVzaWduSGVpZ2h0IGluIHRoZSBwYXJhbWV0ZXIgJ3N0YWdlT3B0aW9ucycuXCIpO1xuICAgICAgICB0aGlzLiRvcHRpb25zID0gb3B0O1xuICAgICAgICB0aGlzLiRhcHBDb250ZXh0LmNhbnZhcy5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XG4gICAgICAgIGxldCBjb250YWluZXIgPSB0aGlzLiRhcHBDb250ZXh0LmNhbnZhcy5wYXJlbnRFbGVtZW50O1xuICAgICAgICBsZXQgc3R5bGUgPSBjb250YWluZXIuc3R5bGU7XG4gICAgICAgIC8vaWYgcGFyZW50IGlzIG5vdCBhIERJViBib3gsIG1ha2Ugb25lXG4gICAgICAgIGlmIChjb250YWluZXIudGFnTmFtZSAhPSAnRElWJykge1xuICAgICAgICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnRElWJyk7XG4gICAgICAgICAgICBzdHlsZS5wb3NpdGlvbiA9ICdyZWxhdGl2ZSc7XG4gICAgICAgICAgICBzdHlsZS5sZWZ0ID0gc3R5bGUudG9wID0gJzBweCc7XG4gICAgICAgICAgICBzdHlsZS53aWR0aCA9IHN0eWxlLmhlaWdodCA9ICcxMDAlJzsgLy9hbmQgc2V0IGRlZmF1bHQgZnVsbC1zY3JlZW5cbiAgICAgICAgICAgIHN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7XG4gICAgICAgICAgICAvLyB0aGlzLiRhcHBDb250ZXh0LnZpZXcucGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZChjb250YWluZXIpOyAvL3RvZG9cbiAgICAgICAgICAgIC8vIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLiRhcHBDb250ZXh0LnZpZXcpOyAvL3RvZG9cbiAgICAgICAgfVxuICAgICAgICBsZXQgY29udGFpbmVyUG9zaXRpb247XG4gICAgICAgIGlmIChkb2N1bWVudC5kZWZhdWx0VmlldyAmJiBkb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKVxuICAgICAgICAgICAgY29udGFpbmVyUG9zaXRpb24gPSBkb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKGNvbnRhaW5lcikucG9zaXRpb247XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGNvbnRhaW5lclBvc2l0aW9uID0gc3R5bGUucG9zaXRpb247XG4gICAgICAgIGlmIChjb250YWluZXJQb3NpdGlvbiA9PSAnJyB8fCBjb250YWluZXJQb3NpdGlvbiA9PSAnc3RhdGljJykge1xuICAgICAgICAgICAgY29udGFpbmVyUG9zaXRpb24gPSAncmVsYXRpdmUnO1xuICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLnBvc2l0aW9uID0gY29udGFpbmVyUG9zaXRpb247XG4gICAgICAgIH1cbiAgICAgICAgSFRNTElucHV0Lmluc3QuaW5pdGlhbGl6ZShjb250YWluZXIsIHRoaXMuJGFwcENvbnRleHQuY2FudmFzKTtcbiAgICAgICAgdGhpcy51cGRhdGVTY3JlZW5TaXplKCk7XG4gICAgfVxuICAgIGdldCBvcmllbnRhdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJG9wdGlvbnMub3JpZW50YXRpb247XG4gICAgfVxuICAgIGdldCBzdGFnZVdpZHRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kd2lkdGg7XG4gICAgfVxuICAgIGdldCBzdGFnZUhlaWdodCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGhlaWdodDtcbiAgICB9XG4gICAgZ2V0IGFwcGxpY2F0aW9uQ29udGV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGFwcENvbnRleHQ7XG4gICAgfVxuICAgIGdldCBuYXRpdmVTdGFnZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGFwcENvbnRleHQ7XG4gICAgfVxuICAgIGdldCByZXNvbHV0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kb3B0aW9ucy5yZXNvbHV0aW9uO1xuICAgIH1cbiAgICBzZXQgcmVzb2x1dGlvbih2KSB7XG4gICAgICAgIHRoaXMuJG9wdGlvbnMucmVzb2x1dGlvbiA9IHY7XG4gICAgICAgIHRoaXMudXBkYXRlU2NyZWVuU2l6ZSgpO1xuICAgIH1cbiAgICBnZXQgc2NhbGVYKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kc2NhbGVYO1xuICAgIH1cbiAgICBnZXQgc2NhbGVZKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kc2NhbGVZO1xuICAgIH1cbiAgICBnZXQgZGVzaWduV2lkdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRvcHRpb25zLmRlc2lnbldpZHRoO1xuICAgIH1cbiAgICBnZXQgZGVzaWduSGVpZ2h0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kb3B0aW9ucy5kZXNpZ25IZWlnaHQ7XG4gICAgfVxuICAgIHNldERlc2lnblNpemUod2lkdGgsIGhlaWdodCkge1xuICAgICAgICBsZXQgb3B0aW9uID0gdGhpcy4kb3B0aW9ucztcbiAgICAgICAgb3B0aW9uLmRlc2lnbldpZHRoID0gd2lkdGg7XG4gICAgICAgIG9wdGlvbi5kZXNpZ25IZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgIHRoaXMudXBkYXRlU2NyZWVuU2l6ZSgpO1xuICAgIH1cbiAgICBjYWxjdWxhdGVTdGFnZVNpemUoc2NhbGVNb2RlLCBzY3JlZW5XaWR0aCwgc2NyZWVuSGVpZ2h0LCBjb250ZW50V2lkdGgsIGNvbnRlbnRIZWlnaHQpIHtcbiAgICAgICAgbGV0IGRpc3BsYXlXaWR0aCA9IHNjcmVlbldpZHRoO1xuICAgICAgICBsZXQgZGlzcGxheUhlaWdodCA9IHNjcmVlbkhlaWdodDtcbiAgICAgICAgbGV0IHN0YWdlV2lkdGggPSBjb250ZW50V2lkdGg7XG4gICAgICAgIGxldCBzdGFnZUhlaWdodCA9IGNvbnRlbnRIZWlnaHQ7XG4gICAgICAgIGxldCBzY2FsZVggPSBzY3JlZW5XaWR0aCAvIHN0YWdlV2lkdGggfHwgMDtcbiAgICAgICAgbGV0IHNjYWxlWSA9IHNjcmVlbkhlaWdodCAvIHN0YWdlSGVpZ2h0IHx8IDA7XG4gICAgICAgIHN3aXRjaCAoc2NhbGVNb2RlKSB7XG4gICAgICAgICAgICBjYXNlIFwiZXhhY3RGaXRcIiAvKiBFWEFDVF9GSVQgKi86XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZml4ZWRIZWlnaHRcIiAvKiBGSVhFRF9IRUlHSFQgKi86XG4gICAgICAgICAgICAgICAgc3RhZ2VXaWR0aCA9IE1hdGgucm91bmQoc2NyZWVuV2lkdGggLyBzY2FsZVkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImZpeGVkV2lkdGhcIiAvKiBGSVhFRF9XSURUSCAqLzpcbiAgICAgICAgICAgICAgICBzdGFnZUhlaWdodCA9IE1hdGgucm91bmQoc2NyZWVuSGVpZ2h0IC8gc2NhbGVYKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJub0JvcmRlclwiIC8qIE5PX0JPUkRFUiAqLzpcbiAgICAgICAgICAgICAgICBpZiAoc2NhbGVYID4gc2NhbGVZKVxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5SGVpZ2h0ID0gTWF0aC5yb3VuZChzdGFnZUhlaWdodCAqIHNjYWxlWCk7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5V2lkdGggPSBNYXRoLnJvdW5kKHN0YWdlV2lkdGggKiBzY2FsZVkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInNob3dBbGxcIiAvKiBTSE9XX0FMTCAqLzpcbiAgICAgICAgICAgICAgICBpZiAoc2NhbGVYID4gc2NhbGVZKVxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5V2lkdGggPSBNYXRoLnJvdW5kKHN0YWdlV2lkdGggKiBzY2FsZVkpO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheUhlaWdodCA9IE1hdGgucm91bmQoc3RhZ2VIZWlnaHQgKiBzY2FsZVgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImZpeGVkQXV0b1wiIC8qIEZJWEVEX0FVVE8gKi86XG4gICAgICAgICAgICAgICAgaWYgKGRpc3BsYXlXaWR0aCAvIGRpc3BsYXlIZWlnaHQgPCBzdGFnZVdpZHRoIC8gc3RhZ2VIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NhbGVZID0gc2NhbGVYO1xuICAgICAgICAgICAgICAgICAgICBzdGFnZUhlaWdodCA9IE1hdGgucm91bmQoc2NyZWVuSGVpZ2h0IC8gc2NhbGVYKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNjYWxlWCA9IHNjYWxlWTtcbiAgICAgICAgICAgICAgICAgICAgc3RhZ2VXaWR0aCA9IE1hdGgucm91bmQoc2NyZWVuV2lkdGggLyBzY2FsZVkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgc3RhZ2VXaWR0aCA9IHNjcmVlbldpZHRoO1xuICAgICAgICAgICAgICAgIHN0YWdlSGVpZ2h0ID0gc2NyZWVuSGVpZ2h0O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdGFnZVdpZHRoOiBzdGFnZVdpZHRoLFxuICAgICAgICAgICAgc3RhZ2VIZWlnaHQ6IHN0YWdlSGVpZ2h0LFxuICAgICAgICAgICAgZGlzcGxheVdpZHRoOiBkaXNwbGF5V2lkdGgsXG4gICAgICAgICAgICBkaXNwbGF5SGVpZ2h0OiBkaXNwbGF5SGVpZ2h0XG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKkBpbnRlcm5hbCAqL1xuICAgIHVwZGF0ZVNjcmVlblNpemUoKSB7XG4gICAgICAgIGlmIChIVE1MSW5wdXQuaXNUeXBpbmcpXG4gICAgICAgICAgICByZXR1cm47IC8vdG9kb1xuICAgICAgICBsZXQgY2FudmFzID0gdGhpcy4kYXBwQ29udGV4dC5jYW52YXM7XG4gICAgICAgIGxldCBjYW52YXNTdHlsZSA9IGNhbnZhcy5zdHlsZTtcbiAgICAgICAgLy8gdG9kb1xuICAgICAgICBsZXQgcmVjdCA9IHRoaXMuJHNpemVDYWxjZXIuZ2V0UmVjdChjYW52YXMsIHRoaXMuJG9wdGlvbnMuZmFsbGJhY2tXaWR0aCwgdGhpcy4kb3B0aW9ucy5mYWxsYmFja0hlaWdodCk7XG4gICAgICAgIGxldCBzaG91bGRSb3RhdGUgPSBmYWxzZTtcbiAgICAgICAgbGV0IG9yaWVudGF0aW9uID0gdGhpcy4kb3B0aW9ucy5vcmllbnRhdGlvbjtcbiAgICAgICAgaWYgKG9yaWVudGF0aW9uICE9IFwiYXV0b1wiIC8qIEFVVE8gKi8pIHtcbiAgICAgICAgICAgIHNob3VsZFJvdGF0ZSA9XG4gICAgICAgICAgICAgICAgKG9yaWVudGF0aW9uICE9IFwicG9ydHJhaXRcIiAvKiBQT1JUUkFJVCAqLyAmJiByZWN0LmhlaWdodCA+IHJlY3Qud2lkdGgpIHx8XG4gICAgICAgICAgICAgICAgICAgIChvcmllbnRhdGlvbiA9PSBcInBvcnRyYWl0XCIgLyogUE9SVFJBSVQgKi8gJiYgcmVjdC53aWR0aCA+IHJlY3QuaGVpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgc2NyZWVuV2lkdGggPSBzaG91bGRSb3RhdGUgPyByZWN0LmhlaWdodCA6IHJlY3Qud2lkdGg7XG4gICAgICAgIGxldCBzY3JlZW5IZWlnaHQgPSBzaG91bGRSb3RhdGUgPyByZWN0LndpZHRoIDogcmVjdC5oZWlnaHQ7XG4gICAgICAgIGxldCBzdGFnZVNpemUgPSB0aGlzLmNhbGN1bGF0ZVN0YWdlU2l6ZSh0aGlzLiRvcHRpb25zLnNjYWxlTW9kZSwgc2NyZWVuV2lkdGgsIHNjcmVlbkhlaWdodCwgdGhpcy4kb3B0aW9ucy5kZXNpZ25XaWR0aCwgdGhpcy4kb3B0aW9ucy5kZXNpZ25IZWlnaHQpO1xuICAgICAgICBsZXQgc3RhZ2VXaWR0aCA9IHN0YWdlU2l6ZS5zdGFnZVdpZHRoO1xuICAgICAgICBsZXQgc3RhZ2VIZWlnaHQgPSBzdGFnZVNpemUuc3RhZ2VIZWlnaHQ7XG4gICAgICAgIGxldCBkaXNwbGF5V2lkdGggPSBzdGFnZVNpemUuZGlzcGxheVdpZHRoO1xuICAgICAgICBsZXQgZGlzcGxheUhlaWdodCA9IHN0YWdlU2l6ZS5kaXNwbGF5SGVpZ2h0O1xuICAgICAgICBpZiAoY2FudmFzLndpZHRoICE9PSBzdGFnZVdpZHRoKVxuICAgICAgICAgICAgY2FudmFzLndpZHRoID0gc3RhZ2VXaWR0aDtcbiAgICAgICAgaWYgKGNhbnZhcy5oZWlnaHQgIT09IHN0YWdlSGVpZ2h0KVxuICAgICAgICAgICAgY2FudmFzLmhlaWdodCA9IHN0YWdlSGVpZ2h0O1xuICAgICAgICBjYW52YXNTdHlsZS50cmFuc2Zvcm1PcmlnaW4gPSBjYW52YXNTdHlsZS53ZWJraXRUcmFuc2Zvcm1PcmlnaW4gPSBjYW52YXNTdHlsZS5tc1RyYW5zZm9ybU9yaWdpbiA9IGNhbnZhc1N0eWxlLm1velRyYW5zZm9ybU9yaWdpbiA9IGNhbnZhc1N0eWxlLm9UcmFuc2Zvcm1PcmlnaW4gPVxuICAgICAgICAgICAgJzBweCAwcHggMHB4JztcbiAgICAgICAgY2FudmFzU3R5bGUud2lkdGggPSBkaXNwbGF5V2lkdGggKyAncHgnO1xuICAgICAgICBjYW52YXNTdHlsZS5oZWlnaHQgPSBkaXNwbGF5SGVpZ2h0ICsgJ3B4JztcbiAgICAgICAgbGV0IG1hdCA9IHRoaXMuJGNhbnZhc01hdHJpeC5pZGVudGl0eSgpO1xuICAgICAgICBsZXQgZGlzcFdpZHRoID0gc2hvdWxkUm90YXRlID8gZGlzcGxheUhlaWdodCA6IGRpc3BsYXlXaWR0aDtcbiAgICAgICAgbGV0IGRpc3BIZWlnaHQgPSBzaG91bGRSb3RhdGUgPyBkaXNwbGF5V2lkdGggOiBkaXNwbGF5SGVpZ2h0O1xuICAgICAgICBsZXQgb2ZmeCwgb2ZmeTtcbiAgICAgICAgaWYgKHRoaXMuJG9wdGlvbnMuYWxpZ25IID09IDAgLyogTEVGVCAqLylcbiAgICAgICAgICAgIG9mZnggPSAwO1xuICAgICAgICBlbHNlIGlmICh0aGlzLiRvcHRpb25zLmFsaWduSCA9PSAyIC8qIFJJR0hUICovKVxuICAgICAgICAgICAgb2ZmeCA9IHJlY3Qud2lkdGggLSBkaXNwV2lkdGg7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIG9mZnggPSAocmVjdC53aWR0aCAtIGRpc3BXaWR0aCkgKiAwLjU7XG4gICAgICAgIGlmICh0aGlzLiRvcHRpb25zLmFsaWduViA9PSAzIC8qIFRPUCAqLylcbiAgICAgICAgICAgIG9mZnkgPSAwO1xuICAgICAgICBlbHNlIGlmICh0aGlzLiRvcHRpb25zLmFsaWduViA9PSA1IC8qIEJPVFRPTSAqLylcbiAgICAgICAgICAgIG9mZnkgPSByZWN0LmhlaWdodCAtIGRpc3BIZWlnaHQ7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIG9mZnkgPSAocmVjdC5oZWlnaHQgLSBkaXNwSGVpZ2h0KSAqIDAuNTtcbiAgICAgICAgaWYgKHNob3VsZFJvdGF0ZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuJG9wdGlvbnMub3JpZW50YXRpb24gPT0gXCJsYW5kc2NhcGVcIiAvKiBMQU5EU0NBUEUgKi8pIHtcbiAgICAgICAgICAgICAgICBtYXQucm90YXRlKE1hdGguUEkgLyAyKTtcbiAgICAgICAgICAgICAgICBtYXQudHJhbnNsYXRlKHNjcmVlbkhlaWdodCAtIG9mZngsIG9mZnkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbWF0LnJvdGF0ZSgtTWF0aC5QSSAvIDIpO1xuICAgICAgICAgICAgICAgIG1hdC50cmFuc2xhdGUob2ZmeCwgc2NyZWVuV2lkdGggLSBvZmZ5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBtYXQudHJhbnNsYXRlKG9mZngsIG9mZnkpO1xuICAgICAgICBpZiAoc2hvdWxkUm90YXRlKSB7XG4gICAgICAgICAgICBtYXQudHggKz0gdGhpcy5vZmZzZXRZO1xuICAgICAgICAgICAgbWF0LnR5ICs9IHRoaXMub2Zmc2V0WDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1hdC50eCArPSB0aGlzLm9mZnNldFg7XG4gICAgICAgICAgICBtYXQudHkgKz0gdGhpcy5vZmZzZXRZO1xuICAgICAgICB9XG4gICAgICAgIChtYXQuYSA9IHRoaXMuZm9ybWF0RGF0YShtYXQuYSkpLFxuICAgICAgICAgICAgKG1hdC5kID0gdGhpcy5mb3JtYXREYXRhKG1hdC5kKSksXG4gICAgICAgICAgICAobWF0LnR4ID0gdGhpcy5mb3JtYXREYXRhKG1hdC50eCkpLFxuICAgICAgICAgICAgKG1hdC50eSA9IHRoaXMuZm9ybWF0RGF0YShtYXQudHkpKTtcbiAgICAgICAgY2FudmFzU3R5bGUudHJhbnNmb3JtT3JpZ2luID0gY2FudmFzU3R5bGUud2Via2l0VHJhbnNmb3JtT3JpZ2luID0gY2FudmFzU3R5bGUubXNUcmFuc2Zvcm1PcmlnaW4gPSBjYW52YXNTdHlsZS5tb3pUcmFuc2Zvcm1PcmlnaW4gPSBjYW52YXNTdHlsZS5vVHJhbnNmb3JtT3JpZ2luID1cbiAgICAgICAgICAgICcwcHggMHB4IDBweCc7XG4gICAgICAgIGNhbnZhc1N0eWxlLnRyYW5zZm9ybSA9IGNhbnZhc1N0eWxlLndlYmtpdFRyYW5zZm9ybSA9IGNhbnZhc1N0eWxlLm1zVHJhbnNmb3JtID0gY2FudmFzU3R5bGUubW96VHJhbnNmb3JtID0gY2FudmFzU3R5bGUub1RyYW5zZm9ybSA9IGBtYXRyaXgoJHttYXQuYX0sJHttYXQuYn0sJHttYXQuY30sJHttYXQuZH0sJHttYXQudHh9LCR7bWF0LnR5fSlgO1xuICAgICAgICB0aGlzLiR3aWR0aCA9IHN0YWdlV2lkdGg7XG4gICAgICAgIHRoaXMuJGhlaWdodCA9IHN0YWdlSGVpZ2h0O1xuICAgICAgICB0aGlzLiRzY2FsZVggPSBzdGFnZVdpZHRoIC8gZGlzcGxheVdpZHRoO1xuICAgICAgICB0aGlzLiRzY2FsZVkgPSBzdGFnZUhlaWdodCAvIGRpc3BsYXlIZWlnaHQ7XG4gICAgICAgIHRoaXMuJGFwcENvbnRleHQuc2V0KHsgd2lkdGg6IHN0YWdlV2lkdGgsIGhlaWdodDogc3RhZ2VIZWlnaHQgfSk7XG4gICAgICAgIEhUTUxJbnB1dC5pbnN0LnVwZGF0ZVNpemUoZGlzcGxheVdpZHRoIC8gc3RhZ2VXaWR0aCwgZGlzcGxheUhlaWdodCAvIHN0YWdlSGVpZ2h0KTtcbiAgICAgICAgbGV0IGV2dCA9IG5ldyBjcmVhdGVqcy5FdmVudChcIl9fc2l6ZUNoYW5nZWRcIiAvKiBTSVpFX0NIQU5HRUQgKi8sIHRydWUsIGZhbHNlKTtcbiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGV2dCwgdGhpcyk7XG4gICAgfVxuICAgIGZvcm1hdERhdGEodmFsdWUpIHtcbiAgICAgICAgaWYgKE1hdGguYWJzKHZhbHVlKSA8IDAuMDAwMDAxKVxuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIGlmIChNYXRoLmFicygxIC0gdmFsdWUpIDwgMC4wMDEpXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUgPiAwID8gMSA6IC0xO1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIGRpc3Bvc2UoKSB7XG4gICAgICAgIGxldCBpID0gVUlTdGFnZUluc3QubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoaS0tID49IDApIHtcbiAgICAgICAgICAgIGlmIChVSVN0YWdlSW5zdFtpXSA9PT0gdGhpcylcbiAgICAgICAgICAgICAgICBVSVN0YWdlSW5zdC5zcGxpY2UoaSwgMSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5sZXQgVUlTdGFnZUluc3QgPSBbXTtcbmxldCByZXNpemVDaGVja1RpbWVyID0gTmFOO1xuZnVuY3Rpb24gcmVzaXplSGFuZGxlcigpIHtcbiAgICBVSVN0YWdlSW5zdC5mb3JFYWNoKHN0YWdlID0+IHtcbiAgICAgICAgc3RhZ2UudXBkYXRlU2NyZWVuU2l6ZSgpO1xuICAgIH0pO1xufVxuRE9NRXZlbnRNYW5hZ2VyLmluc3Qub24oJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHtcbiAgICBjbGVhclRpbWVvdXQocmVzaXplQ2hlY2tUaW1lcik7XG4gICAgcmVzaXplQ2hlY2tUaW1lciA9IHdpbmRvdy5zZXRUaW1lb3V0KHJlc2l6ZUhhbmRsZXIsIDMwMCk7XG59KTtcblxuY2xhc3MgQWN0aW9uIHtcbiAgICBleGVjdXRlKGNvbnRyb2xsZXIsIHByZXZQYWdlLCBjdXJQYWdlKSB7XG4gICAgICAgIGlmICgoIXRoaXMuZnJvbVBhZ2UgfHwgdGhpcy5mcm9tUGFnZS5sZW5ndGggPT0gMCB8fCB0aGlzLmZyb21QYWdlLmluZGV4T2YocHJldlBhZ2UpICE9IC0xKVxuICAgICAgICAgICAgJiYgKCF0aGlzLnRvUGFnZSB8fCB0aGlzLnRvUGFnZS5sZW5ndGggPT0gMCB8fCB0aGlzLnRvUGFnZS5pbmRleE9mKGN1clBhZ2UpICE9IC0xKSlcbiAgICAgICAgICAgIHRoaXMuZW50ZXIoY29udHJvbGxlcik7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRoaXMubGVhdmUoY29udHJvbGxlcik7XG4gICAgfVxuICAgIGVudGVyKGNvbnRyb2xsZXIpIHtcbiAgICB9XG4gICAgbGVhdmUoY29udHJvbGxlcikge1xuICAgIH1cbiAgICBzZXR1cCh4bWwpIHtcbiAgICAgICAgbGV0IHN0cjtcbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMuZnJvbVBhZ2U7XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICB0aGlzLmZyb21QYWdlID0gc3RyLnNwbGl0KFwiLFwiKTtcbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMudG9QYWdlO1xuICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgdGhpcy50b1BhZ2UgPSBzdHIuc3BsaXQoXCIsXCIpO1xuICAgIH1cbn1cblxuY2xhc3MgQ2hhbmdlUGFnZUFjdGlvbiBleHRlbmRzIEFjdGlvbiB7XG4gICAgZW50ZXIoY29udHJvbGxlcikge1xuICAgICAgICBpZiAoIXRoaXMuY29udHJvbGxlck5hbWUpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGxldCBnY29tO1xuICAgICAgICBpZiAodGhpcy5vYmplY3RJZClcbiAgICAgICAgICAgIGdjb20gPSBjb250cm9sbGVyLnBhcmVudC5nZXRDaGlsZEJ5SWQodGhpcy5vYmplY3RJZCk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGdjb20gPSBjb250cm9sbGVyLnBhcmVudDtcbiAgICAgICAgaWYgKGdjb20pIHtcbiAgICAgICAgICAgIGxldCBjYyA9IGdjb20uZ2V0Q29udHJvbGxlcih0aGlzLmNvbnRyb2xsZXJOYW1lKTtcbiAgICAgICAgICAgIGlmIChjYyAmJiBjYyAhPSBjb250cm9sbGVyICYmICFjYy4kdXBkYXRpbmcpXG4gICAgICAgICAgICAgICAgY2Muc2VsZWN0ZWRQYWdlSWQgPSB0aGlzLnRhcmdldFBhZ2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0dXAoeG1sKSB7XG4gICAgICAgIHN1cGVyLnNldHVwKHhtbCk7XG4gICAgICAgIHRoaXMub2JqZWN0SWQgPSB4bWwuYXR0cmlidXRlcy5vYmplY3RJZDtcbiAgICAgICAgdGhpcy5jb250cm9sbGVyTmFtZSA9IHhtbC5hdHRyaWJ1dGVzLmNvbnRyb2xsZXI7XG4gICAgICAgIHRoaXMudGFyZ2V0UGFnZSA9IHhtbC5hdHRyaWJ1dGVzLnRhcmdldFBhZ2U7XG4gICAgfVxufVxuXG5jbGFzcyBQbGF5VHJhbnNpdGlvbkFjdGlvbiBleHRlbmRzIEFjdGlvbiB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG4gICAgICAgIHRoaXMucmVwZWF0ID0gMTtcbiAgICAgICAgdGhpcy5kZWxheSA9IDA7XG4gICAgICAgIHRoaXMuc3RvcE9uRXhpdCA9IGZhbHNlO1xuICAgIH1cbiAgICBlbnRlcihjb250cm9sbGVyKSB7XG4gICAgICAgIGxldCB0cmFucyA9IGNvbnRyb2xsZXIucGFyZW50LmdldFRyYW5zaXRpb24odGhpcy50cmFuc2l0aW9uTmFtZSk7XG4gICAgICAgIGlmICh0cmFucykge1xuICAgICAgICAgICAgaWYgKHRoaXMuJGN1cnJlbnRUcmFuc2l0aW9uICYmIHRoaXMuJGN1cnJlbnRUcmFuc2l0aW9uLnBsYXlpbmcpXG4gICAgICAgICAgICAgICAgdHJhbnMuY2hhbmdlUmVwZWF0KHRoaXMucmVwZWF0KTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB0cmFucy5wbGF5KHtcbiAgICAgICAgICAgICAgICAgICAgdGltZXM6IHRoaXMucmVwZWF0LFxuICAgICAgICAgICAgICAgICAgICBkZWxheTogdGhpcy5kZWxheVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy4kY3VycmVudFRyYW5zaXRpb24gPSB0cmFucztcbiAgICAgICAgfVxuICAgIH1cbiAgICBsZWF2ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RvcE9uRXhpdCAmJiB0aGlzLiRjdXJyZW50VHJhbnNpdGlvbikge1xuICAgICAgICAgICAgdGhpcy4kY3VycmVudFRyYW5zaXRpb24uc3RvcCgpO1xuICAgICAgICAgICAgdGhpcy4kY3VycmVudFRyYW5zaXRpb24gPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKkBpbnRlcm5hbCAqL1xuICAgIHNldHVwKHhtbCkge1xuICAgICAgICBzdXBlci5zZXR1cCh4bWwpO1xuICAgICAgICB0aGlzLnRyYW5zaXRpb25OYW1lID0geG1sLmF0dHJpYnV0ZXMudHJhbnNpdGlvbjtcbiAgICAgICAgbGV0IHN0cjtcbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMucmVwZWF0O1xuICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgdGhpcy5yZXBlYXQgPSBwYXJzZUludChzdHIpO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5kZWxheTtcbiAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgIHRoaXMuZGVsYXkgPSBwYXJzZUZsb2F0KHN0cik7XG4gICAgICAgIHRoaXMuc3RvcE9uRXhpdCA9IHhtbC5hdHRyaWJ1dGVzLnN0b3BPbkV4aXQgPT0gXCJ0cnVlXCI7XG4gICAgfVxufVxuXG5jbGFzcyBDb250cm9sbGVyIGV4dGVuZHMgY3JlYXRlanMuRXZlbnREaXNwYXRjaGVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy4kc2VsZWN0ZWRJbmRleCA9IDA7XG4gICAgICAgIHRoaXMuJHByZXZpb3VzSW5kZXggPSAwO1xuICAgICAgICB0aGlzLiRwYWdlSWRzID0gW107XG4gICAgICAgIHRoaXMuJHBhZ2VOYW1lcyA9IFtdO1xuICAgICAgICB0aGlzLiRzZWxlY3RlZEluZGV4ID0gLTE7XG4gICAgICAgIHRoaXMuJHByZXZpb3VzSW5kZXggPSAtMTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRuYW1lO1xuICAgIH1cbiAgICBzZXQgbmFtZSh2YWx1ZSkge1xuICAgICAgICB0aGlzLiRuYW1lID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCBwYXJlbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRwYXJlbnQ7XG4gICAgfVxuICAgIGdldCBzZWxlY3RlZEluZGV4KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kc2VsZWN0ZWRJbmRleDtcbiAgICB9XG4gICAgc2V0IHNlbGVjdGVkSW5kZXgodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJHNlbGVjdGVkSW5kZXggIT0gdmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSA+IHRoaXMuJHBhZ2VJZHMubGVuZ3RoIC0gMSlcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGluZGV4IG91dCBvZiByYW5nZTogJHt2YWx1ZX1gKTtcbiAgICAgICAgICAgIHRoaXMuJHVwZGF0aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuJHByZXZpb3VzSW5kZXggPSB0aGlzLiRzZWxlY3RlZEluZGV4O1xuICAgICAgICAgICAgdGhpcy4kc2VsZWN0ZWRJbmRleCA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy4kcGFyZW50LmFwcGx5Q29udHJvbGxlcih0aGlzKTtcbiAgICAgICAgICAgIGxldCBldmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudChcIl9fc3RhdGVDaGFuZ2VkXCIgLyogQ0hBTkdFRCAqLywgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGV2ZW50LCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuJHVwZGF0aW5nID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy9zYW1lIGVmZmVjdCBhcyBzZWxlY3RlZEluZGV4IGJ1dCB3aXRob3V0IGV2ZW50IGVtaXR0ZWRcbiAgICBzZXRTZWxlY3RlZEluZGV4KHZhbHVlID0gMCkge1xuICAgICAgICBpZiAodGhpcy4kc2VsZWN0ZWRJbmRleCAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlID4gdGhpcy4kcGFnZUlkcy5sZW5ndGggLSAxKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgaW5kZXggb3V0IG9mIHJhbmdlOiAke3ZhbHVlfWApO1xuICAgICAgICAgICAgdGhpcy4kdXBkYXRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy4kcHJldmlvdXNJbmRleCA9IHRoaXMuJHNlbGVjdGVkSW5kZXg7XG4gICAgICAgICAgICB0aGlzLiRzZWxlY3RlZEluZGV4ID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLiRwYXJlbnQuYXBwbHlDb250cm9sbGVyKHRoaXMpO1xuICAgICAgICAgICAgdGhpcy4kdXBkYXRpbmcgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgcHJldmlzb3VzSW5kZXgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRwcmV2aW91c0luZGV4O1xuICAgIH1cbiAgICBnZXQgc2VsZWN0ZWRQYWdlKCkge1xuICAgICAgICBpZiAodGhpcy4kc2VsZWN0ZWRJbmRleCA9PSAtMSlcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kcGFnZU5hbWVzW3RoaXMuJHNlbGVjdGVkSW5kZXhdO1xuICAgIH1cbiAgICBzZXQgc2VsZWN0ZWRQYWdlKHZhbCkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSBNYXRoLm1heCgwLCB0aGlzLiRwYWdlTmFtZXMuaW5kZXhPZih2YWwpKTtcbiAgICB9XG4gICAgc2V0U2VsZWN0ZWRQYWdlKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0U2VsZWN0ZWRJbmRleChNYXRoLm1heCgwLCB0aGlzLiRwYWdlTmFtZXMuaW5kZXhPZih2YWx1ZSkpKTtcbiAgICB9XG4gICAgZ2V0IHByZXZpb3VzUGFnZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuJHByZXZpb3VzSW5kZXggPT0gLTEpXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHBhZ2VOYW1lc1t0aGlzLiRwcmV2aW91c0luZGV4XTtcbiAgICB9XG4gICAgZ2V0IHBhZ2VDb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHBhZ2VJZHMubGVuZ3RoO1xuICAgIH1cbiAgICBnZXRQYWdlTmFtZShpbmRleCA9IDApIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHBhZ2VOYW1lc1tpbmRleF07XG4gICAgfVxuICAgIGFkZFBhZ2UobmFtZSA9ICcnKSB7XG4gICAgICAgIHRoaXMuYWRkUGFnZUF0KG5hbWUsIHRoaXMuJHBhZ2VJZHMubGVuZ3RoKTtcbiAgICB9XG4gICAgYWRkUGFnZUF0KG5hbWUsIGluZGV4ID0gMCkge1xuICAgICAgICBsZXQgbmlkID0gYCR7Q29udHJvbGxlci4kbmV4dFBhZ2VJZCsrfWA7XG4gICAgICAgIGlmIChpbmRleCA9PSB0aGlzLiRwYWdlSWRzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy4kcGFnZUlkcy5wdXNoKG5pZCk7XG4gICAgICAgICAgICB0aGlzLiRwYWdlTmFtZXMucHVzaChuYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuJHBhZ2VJZHMuc3BsaWNlKGluZGV4LCAwLCBuaWQpO1xuICAgICAgICAgICAgdGhpcy4kcGFnZU5hbWVzLnNwbGljZShpbmRleCwgMCwgbmFtZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVtb3ZlUGFnZShuYW1lKSB7XG4gICAgICAgIGxldCBpID0gdGhpcy4kcGFnZU5hbWVzLmluZGV4T2YobmFtZSk7XG4gICAgICAgIGlmIChpICE9IC0xKSB7XG4gICAgICAgICAgICB0aGlzLiRwYWdlSWRzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIHRoaXMuJHBhZ2VOYW1lcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICBpZiAodGhpcy4kc2VsZWN0ZWRJbmRleCA+PSB0aGlzLiRwYWdlSWRzLmxlbmd0aClcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSB0aGlzLiRzZWxlY3RlZEluZGV4IC0gMTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB0aGlzLiRwYXJlbnQuYXBwbHlDb250cm9sbGVyKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbW92ZVBhZ2VBdChpbmRleCA9IDApIHtcbiAgICAgICAgdGhpcy4kcGFnZUlkcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB0aGlzLiRwYWdlTmFtZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgaWYgKHRoaXMuJHNlbGVjdGVkSW5kZXggPj0gdGhpcy4kcGFnZUlkcy5sZW5ndGgpXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSB0aGlzLiRzZWxlY3RlZEluZGV4IC0gMTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kcGFyZW50LmFwcGx5Q29udHJvbGxlcih0aGlzKTtcbiAgICB9XG4gICAgY2xlYXJQYWdlcygpIHtcbiAgICAgICAgdGhpcy4kcGFnZUlkcy5sZW5ndGggPSAwO1xuICAgICAgICB0aGlzLiRwYWdlTmFtZXMubGVuZ3RoID0gMDtcbiAgICAgICAgaWYgKHRoaXMuJHNlbGVjdGVkSW5kZXggIT0gLTEpXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSAtMTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kcGFyZW50LmFwcGx5Q29udHJvbGxlcih0aGlzKTtcbiAgICB9XG4gICAgaGFzUGFnZShhTmFtZSkge1xuICAgICAgICByZXR1cm4gdGhpcy4kcGFnZU5hbWVzLmluZGV4T2YoYU5hbWUpID49IDA7XG4gICAgfVxuICAgIGdldFBhZ2VJbmRleEJ5SWQoYUlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRwYWdlSWRzLmluZGV4T2YoYUlkKTtcbiAgICB9XG4gICAgZ2V0UGFnZUlkQnlOYW1lKGFOYW1lKSB7XG4gICAgICAgIGxldCBpID0gdGhpcy4kcGFnZU5hbWVzLmluZGV4T2YoYU5hbWUpO1xuICAgICAgICBpZiAoaSAhPSAtMSlcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiRwYWdlSWRzW2ldO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgZ2V0UGFnZU5hbWVCeUlkKGFJZCkge1xuICAgICAgICBsZXQgaSA9IHRoaXMuJHBhZ2VJZHMuaW5kZXhPZihhSWQpO1xuICAgICAgICBpZiAoaSAhPSAtMSlcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiRwYWdlTmFtZXNbaV07XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBnZXRQYWdlSWQoaW5kZXggPSAwKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRwYWdlSWRzW2luZGV4XTtcbiAgICB9XG4gICAgZ2V0IHNlbGVjdGVkUGFnZUlkKCkge1xuICAgICAgICBpZiAodGhpcy4kc2VsZWN0ZWRJbmRleCA9PSAtMSlcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kcGFnZUlkc1t0aGlzLiRzZWxlY3RlZEluZGV4XTtcbiAgICB9XG4gICAgc2V0IHNlbGVjdGVkUGFnZUlkKHZhbCkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSB0aGlzLiRwYWdlSWRzLmluZGV4T2YodmFsKTtcbiAgICB9XG4gICAgc2V0IG9wcG9zaXRlUGFnZUlkKHZhbCkge1xuICAgICAgICBsZXQgaSA9IHRoaXMuJHBhZ2VJZHMuaW5kZXhPZih2YWwpO1xuICAgICAgICBpZiAoaSA+IDApXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSAwO1xuICAgICAgICBlbHNlIGlmICh0aGlzLiRwYWdlSWRzLmxlbmd0aCA+IDEpXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSAxO1xuICAgIH1cbiAgICBnZXQgcHJldmlvdXNQYWdlSWQoKSB7XG4gICAgICAgIGlmICh0aGlzLiRwcmV2aW91c0luZGV4ID09IC0xKVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiRwYWdlSWRzW3RoaXMuJHByZXZpb3VzSW5kZXhdO1xuICAgIH1cbiAgICBleGVjdXRlQWN0aW9ucygpIHtcbiAgICAgICAgaWYgKHRoaXMuJGFjdGlvbnMgJiYgdGhpcy4kYWN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLiRhY3Rpb25zLmZvckVhY2goYSA9PiB7XG4gICAgICAgICAgICAgICAgYS5leGVjdXRlKHRoaXMsIHRoaXMucHJldmlvdXNQYWdlSWQsIHRoaXMuc2VsZWN0ZWRQYWdlSWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY3JlYXRlQWN0aW9uKHR5cGUpIHtcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdwbGF5X3RyYW5zaXRpb24nOlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUGxheVRyYW5zaXRpb25BY3Rpb24oKTtcbiAgICAgICAgICAgIGNhc2UgJ2NoYW5nZV9wYWdlJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IENoYW5nZVBhZ2VBY3Rpb24oKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgc2V0dXAoeG1sKSB7XG4gICAgICAgIHRoaXMuJG5hbWUgPSB4bWwuYXR0cmlidXRlcy5uYW1lO1xuICAgICAgICB0aGlzLiRhdXRvUmFkaW9Hcm91cERlcHRoID0geG1sLmF0dHJpYnV0ZXMuYXV0b1JhZGlvR3JvdXBEZXB0aCA9PSAndHJ1ZSc7XG4gICAgICAgIGxldCBzdHIgPSB4bWwuYXR0cmlidXRlcy5wYWdlcztcbiAgICAgICAgaWYgKHN0cikge1xuICAgICAgICAgICAgbGV0IGFyciA9IHN0ci5zcGxpdCgnLCcpO1xuICAgICAgICAgICAgbGV0IGNudCA9IGFyci5sZW5ndGg7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNudDsgaSArPSAyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kcGFnZUlkcy5wdXNoKGFycltpXSk7XG4gICAgICAgICAgICAgICAgdGhpcy4kcGFnZU5hbWVzLnB1c2goYXJyW2kgKyAxXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGNvbCA9IHhtbC5jaGlsZHJlbjtcbiAgICAgICAgaWYgKGNvbC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLiRhY3Rpb25zID0gdGhpcy4kYWN0aW9ucyB8fCBbXTtcbiAgICAgICAgICAgIGNvbC5mb3JFYWNoKGN4bWwgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBhY3Rpb24gPSB0aGlzLmNyZWF0ZUFjdGlvbihjeG1sLmF0dHJpYnV0ZXMudHlwZSk7XG4gICAgICAgICAgICAgICAgYWN0aW9uLnNldHVwKGN4bWwpO1xuICAgICAgICAgICAgICAgIHRoaXMuJGFjdGlvbnMucHVzaChhY3Rpb24pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMudHJhbnNpdGlvbnM7XG4gICAgICAgIGlmIChzdHIpIHtcbiAgICAgICAgICAgIHRoaXMuJGFjdGlvbnMgPSB0aGlzLiRhY3Rpb25zIHx8IFtdO1xuICAgICAgICAgICAgbGV0IGssIGU7XG4gICAgICAgICAgICBzdHIuc3BsaXQoJywnKS5mb3JFYWNoKHN0ciA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHN0ciAmJiBzdHIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBwdCA9IG5ldyBQbGF5VHJhbnNpdGlvbkFjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBrID0gc3RyLmluZGV4T2YoJz0nKTtcbiAgICAgICAgICAgICAgICAgICAgcHQudHJhbnNpdGlvbk5hbWUgPSBzdHIuc3Vic3RyKGsgKyAxKTtcbiAgICAgICAgICAgICAgICAgICAgc3RyID0gc3RyLnN1YnN0cmluZygwLCBrKTtcbiAgICAgICAgICAgICAgICAgICAgayA9IHN0ci5pbmRleE9mKCctJyk7XG4gICAgICAgICAgICAgICAgICAgIGUgPSBwYXJzZUludChzdHIuc3Vic3RyaW5nKGsgKyAxKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlIDwgdGhpcy4kcGFnZUlkcy5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgICAgICBwdC50b1BhZ2UgPSBbdGhpcy4kcGFnZUlkc1tlXV07XG4gICAgICAgICAgICAgICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoMCwgayk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdHIgIT0gJyonKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlID0gcGFyc2VJbnQoc3RyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlIDwgdGhpcy4kcGFnZUlkcy5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHQuZnJvbVBhZ2UgPSBbdGhpcy4kcGFnZUlkc1tlXV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcHQuc3RvcE9uRXhpdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGFjdGlvbnMucHVzaChwdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuJHBhcmVudCAmJiB0aGlzLiRwYWdlSWRzLmxlbmd0aCA+IDApXG4gICAgICAgICAgICB0aGlzLiRzZWxlY3RlZEluZGV4ID0gMDtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kc2VsZWN0ZWRJbmRleCA9IC0xO1xuICAgIH1cbn1cbkNvbnRyb2xsZXIuJG5leHRQYWdlSWQgPSAwO1xuXG5jbGFzcyBOdW1iZXJVdGlsIHtcbiAgICBzdGF0aWMgY2xhbXAodmFsdWUsIG1pbiwgbWF4KSB7XG4gICAgICAgIGlmICh2YWx1ZSA8IG1pbilcbiAgICAgICAgICAgIHZhbHVlID0gbWluO1xuICAgICAgICBlbHNlIGlmICh2YWx1ZSA+IG1heClcbiAgICAgICAgICAgIHZhbHVlID0gbWF4O1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIHN0YXRpYyBjbGFtcDAxKHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSA+IDEpXG4gICAgICAgICAgICB2YWx1ZSA9IDE7XG4gICAgICAgIGVsc2UgaWYgKHZhbHVlIDwgMClcbiAgICAgICAgICAgIHZhbHVlID0gMDtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgICBzdGF0aWMgaXNOdW1iZXIobikge1xuICAgICAgICBpZiAodHlwZW9mIG4gIT0gJ251bWJlcicpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmIChpc05hTihuKSlcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHN0YXRpYyBzaWduKHgpIHtcbiAgICAgICAgeCA9IE51bWJlcih4KTtcbiAgICAgICAgaWYgKHggPT09IDAgfHwgaXNOYU4oeCkpXG4gICAgICAgICAgICByZXR1cm4geDtcbiAgICAgICAgcmV0dXJuIHggPiAwID8gMSA6IC0xO1xuICAgIH1cbiAgICBzdGF0aWMgYW5nbGVUb1JhZGlhbihuKSB7XG4gICAgICAgIHJldHVybiBuICogTnVtYmVyVXRpbC5SQURJQU47XG4gICAgfVxuICAgIHN0YXRpYyBsZXJwKHMsIGUsIHApIHtcbiAgICAgICAgcmV0dXJuIHMgKyBwICogKGUgLSBzKTtcbiAgICB9XG59XG5OdW1iZXJVdGlsLlJBRElBTiA9IE1hdGguUEkgLyAxODA7XG5cbmNvbnN0IGlzTW9iaWxlID0gaXNNb2JpbGVDYWxsKHdpbmRvdy5uYXZpZ2F0b3IpO1xuXG5jbGFzcyBTY3JvbGxQYW5lIGV4dGVuZHMgY3JlYXRlanMuRXZlbnREaXNwYXRjaGVyIHtcbiAgICBjb25zdHJ1Y3Rvcihvd25lciwgc2Nyb2xsVHlwZSwgc2Nyb2xsQmFyTWFyZ2luLCBzY3JvbGxCYXJEaXNwbGF5LCBmbGFncywgdnRTY3JvbGxCYXJSZXMsIGh6U2Nyb2xsQmFyUmVzLCBoZWFkZXJSZXMsIGZvb3RlclJlcykge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLiRpc0RyYWdnaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuJG93bmVyID0gb3duZXI7XG4gICAgICAgIHRoaXMuJG1hc2tDb250YWluZXIgPSBuZXcgVUlDb250YWluZXIobnVsbCk7XG4gICAgICAgIHRoaXMuJG93bmVyLiRyb290Q29udGFpbmVyLmFkZENoaWxkKHRoaXMuJG1hc2tDb250YWluZXIpO1xuICAgICAgICB0aGlzLiRjb250YWluZXIgPSB0aGlzLiRvd25lci4kY29udGFpbmVyO1xuICAgICAgICB0aGlzLiRjb250YWluZXIueCA9IDA7XG4gICAgICAgIHRoaXMuJGNvbnRhaW5lci55ID0gMDtcbiAgICAgICAgdGhpcy4kbWFza0NvbnRhaW5lci5hZGRDaGlsZCh0aGlzLiRjb250YWluZXIpO1xuICAgICAgICB0aGlzLiRzY3JvbGxCYXJNYXJnaW4gPSBzY3JvbGxCYXJNYXJnaW47XG4gICAgICAgIHRoaXMuJHNjcm9sbFR5cGUgPSBzY3JvbGxUeXBlO1xuICAgICAgICB0aGlzLiRzY3JvbGxTcGVlZCA9IFVJQ29uZmlnLmRlZmF1bHRTY3JvbGxTcGVlZDtcbiAgICAgICAgdGhpcy4kbW91c2VXaGVlbFNwZWVkID0gdGhpcy4kc2Nyb2xsU3BlZWQgKiAyO1xuICAgICAgICB0aGlzLiRkZWNlbGVyYXRpb25SYXRlID0gVUlDb25maWcuZGVmYXVsdFNjcm9sbERlY2VsZXJhdGlvblJhdGU7XG4gICAgICAgIHRoaXMuJGRpc3BsYXlPbkxlZnQgPSAoZmxhZ3MgJiAxIC8qIERpc3BsYXlPbkxlZnQgKi8pICE9IDA7XG4gICAgICAgIHRoaXMuJHNuYXBUb0l0ZW0gPSAoZmxhZ3MgJiAyIC8qIFNuYXBUb0l0ZW0gKi8pICE9IDA7XG4gICAgICAgIHRoaXMuJGRpc3BsYXlPbkRlbWFuZCA9IChmbGFncyAmIDQgLyogRGlzcGxheU9uRGVtYW5kICovKSAhPSAwO1xuICAgICAgICB0aGlzLiRwYWdlTW9kZSA9IChmbGFncyAmIDggLyogUGFnZU1vZGUgKi8pICE9IDA7XG4gICAgICAgIGlmIChmbGFncyAmIDE2IC8qIFRvdWNoRWZmZWN0ICovKVxuICAgICAgICAgICAgdGhpcy4kdG91Y2hFZmZlY3QgPSB0cnVlO1xuICAgICAgICBlbHNlIGlmIChmbGFncyAmIDMyIC8qIERpc2FibGVUb3VjaEVmZmVjdCAqLylcbiAgICAgICAgICAgIHRoaXMuJHRvdWNoRWZmZWN0ID0gZmFsc2U7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRoaXMuJHRvdWNoRWZmZWN0ID0gVUlDb25maWcuZGVmYXVsdFNjcm9sbFRvdWNoRWZmZWN0O1xuICAgICAgICBpZiAoZmxhZ3MgJiA2NCAvKiBCb3VuY2VFZmZlY3QgKi8pXG4gICAgICAgICAgICB0aGlzLiRib3VuY2ViYWNrRWZmZWN0ID0gdHJ1ZTtcbiAgICAgICAgZWxzZSBpZiAoZmxhZ3MgJiAxMjggLyogRGlzYWJsZUJvdW5jZUVmZmVjdCAqLylcbiAgICAgICAgICAgIHRoaXMuJGJvdW5jZWJhY2tFZmZlY3QgPSBmYWxzZTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kYm91bmNlYmFja0VmZmVjdCA9IFVJQ29uZmlnLmRlZmF1bHRTY3JvbGxCb3VuY2VFZmZlY3Q7XG4gICAgICAgIHRoaXMuJGluZXJ0aWFEaXNhYmxlZCA9IChmbGFncyAmIDI1NiAvKiBEaXNhYmxlSW5lcnRpYSAqLykgIT0gMDtcbiAgICAgICAgaWYgKChmbGFncyAmIDUxMiAvKiBEaXNhYmxlU2Npc3NvclJlY3QgKi8pID09IDApXG4gICAgICAgICAgICB0aGlzLiRtYXNrQ29udGFpbmVyLnNjcm9sbFJlY3QgPSBuZXcgY3JlYXRlanMuUmVjdGFuZ2xlKCk7XG4gICAgICAgIHRoaXMuJHNjcm9sbEJhclZpc2libGUgPSB0cnVlO1xuICAgICAgICB0aGlzLiRtb3VzZVdoZWVsRW5hYmxlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuJHhQb3MgPSAwO1xuICAgICAgICB0aGlzLiR5UG9zID0gMDtcbiAgICAgICAgdGhpcy4kYW5pRmxhZyA9IDA7XG4gICAgICAgIHRoaXMuJGZvb3RlckxvY2tlZFNpemUgPSAwO1xuICAgICAgICB0aGlzLiRoZWFkZXJMb2NrZWRTaXplID0gMDtcbiAgICAgICAgaWYgKHNjcm9sbEJhckRpc3BsYXkgPT0gMCAvKiBEZWZhdWx0ICovKVxuICAgICAgICAgICAgc2Nyb2xsQmFyRGlzcGxheSA9IFVJQ29uZmlnLmRlZmF1bHRTY3JvbGxCYXJEaXNwbGF5O1xuICAgICAgICB0aGlzLiR2aWV3U2l6ZSA9IG5ldyBjcmVhdGVqcy5Qb2ludCgpO1xuICAgICAgICB0aGlzLiRjb250ZW50U2l6ZSA9IG5ldyBjcmVhdGVqcy5Qb2ludCgpO1xuICAgICAgICB0aGlzLiRwYWdlU2l6ZSA9IG5ldyBjcmVhdGVqcy5Qb2ludCgxLCAxKTtcbiAgICAgICAgdGhpcy4kb3ZlcmxhcFNpemUgPSBuZXcgY3JlYXRlanMuUG9pbnQoKTtcbiAgICAgICAgdGhpcy4kdHdlZW5pbmcgPSAwO1xuICAgICAgICB0aGlzLiR0d2VlblRpbWUgPSBuZXcgY3JlYXRlanMuUG9pbnQoKTtcbiAgICAgICAgdGhpcy4kdHdlZW5TdGFydCA9IG5ldyBjcmVhdGVqcy5Qb2ludCgpO1xuICAgICAgICB0aGlzLiR0d2VlbkR1cmF0aW9uID0gbmV3IGNyZWF0ZWpzLlBvaW50KCk7XG4gICAgICAgIHRoaXMuJHR3ZWVuQ2hhbmdlID0gbmV3IGNyZWF0ZWpzLlBvaW50KCk7XG4gICAgICAgIHRoaXMuJHZlbG9jaXR5ID0gbmV3IGNyZWF0ZWpzLlBvaW50KCk7XG4gICAgICAgIHRoaXMuJGNvbnRhaW5lclBvcyA9IG5ldyBjcmVhdGVqcy5Qb2ludCgpO1xuICAgICAgICB0aGlzLiRiZWdpblRvdWNoUG9zID0gbmV3IGNyZWF0ZWpzLlBvaW50KCk7XG4gICAgICAgIHRoaXMuJGxhc3RUb3VjaFBvcyA9IG5ldyBjcmVhdGVqcy5Qb2ludCgpO1xuICAgICAgICB0aGlzLiRsYXN0VG91Y2hHbG9iYWxQb3MgPSBuZXcgY3JlYXRlanMuUG9pbnQoKTtcbiAgICAgICAgbGV0IHJlcztcbiAgICAgICAgaWYgKHNjcm9sbEJhckRpc3BsYXkgIT0gMyAvKiBIaWRkZW4gKi8pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRzY3JvbGxUeXBlID09IDIgLyogQm90aCAqLyB8fCB0aGlzLiRzY3JvbGxUeXBlID09IDEgLyogVmVydGljYWwgKi8pIHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXMgPSB2dFNjcm9sbEJhclJlcyA/IHZ0U2Nyb2xsQmFyUmVzIDogVUlDb25maWcudmVydGljYWxTY3JvbGxCYXI7XG4gICAgICAgICAgICAgICAgaWYgKHJlcykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiR2dFNjcm9sbEJhciA9IFVJUGFja2FnZS5jcmVhdGVPYmplY3RGcm9tVVJMKHJlcyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy4kdnRTY3JvbGxCYXIpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjcmVhdGUgc2Nyb2xsYmFyIGZyb20gJHtyZXN9YCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHZ0U2Nyb2xsQmFyLnNldFNjcm9sbFBhbmUodGhpcywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJG93bmVyLiRyb290Q29udGFpbmVyLmFkZENoaWxkKHRoaXMuJHZ0U2Nyb2xsQmFyLmRpc3BsYXlPYmplY3QpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLiRzY3JvbGxUeXBlID09IDIgLyogQm90aCAqLyB8fCB0aGlzLiRzY3JvbGxUeXBlID09IDAgLyogSG9yaXpvbnRhbCAqLykge1xuICAgICAgICAgICAgICAgIHJlcyA9IGh6U2Nyb2xsQmFyUmVzID8gaHpTY3JvbGxCYXJSZXMgOiBVSUNvbmZpZy5ob3Jpem9udGFsU2Nyb2xsQmFyO1xuICAgICAgICAgICAgICAgIGlmIChyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kaHpTY3JvbGxCYXIgPSBVSVBhY2thZ2UuY3JlYXRlT2JqZWN0RnJvbVVSTChyZXMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuJGh6U2Nyb2xsQmFyKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY3JlYXRlIHNjcm9sbGJhciBmcm9tICR7cmVzfWApO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRoelNjcm9sbEJhci5zZXRTY3JvbGxQYW5lKHRoaXMsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kb3duZXIuJHJvb3RDb250YWluZXIuYWRkQ2hpbGQodGhpcy4kaHpTY3JvbGxCYXIuZGlzcGxheU9iamVjdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy4kc2Nyb2xsQmFyRGlzcGxheUF1dG8gPSBzY3JvbGxCYXJEaXNwbGF5ID09IDIgLyogQXV0byAqLztcbiAgICAgICAgICAgIGlmICh0aGlzLiRzY3JvbGxCYXJEaXNwbGF5QXV0bykge1xuICAgICAgICAgICAgICAgIHRoaXMuJHNjcm9sbEJhclZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kdnRTY3JvbGxCYXIpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHZ0U2Nyb2xsQmFyLmRpc3BsYXlPYmplY3QudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRoelNjcm9sbEJhcilcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kaHpTY3JvbGxCYXIuZGlzcGxheU9iamVjdC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kbW91c2VXaGVlbEVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgaWYgKGhlYWRlclJlcykge1xuICAgICAgICAgICAgdGhpcy4kaGVhZGVyID0gVUlQYWNrYWdlLmNyZWF0ZU9iamVjdEZyb21VUkwoaGVhZGVyUmVzKTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRoZWFkZXIgPT0gbnVsbClcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjcmVhdGUgc2Nyb2xsUGFuZS5oZWFkZXIgZnJvbSAke3Jlc31gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZm9vdGVyUmVzKSB7XG4gICAgICAgICAgICB0aGlzLiRmb290ZXIgPSBVSVBhY2thZ2UuY3JlYXRlT2JqZWN0RnJvbVVSTChmb290ZXJSZXMpO1xuICAgICAgICAgICAgaWYgKHRoaXMuJGZvb3RlciA9PSBudWxsKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNyZWF0ZSBzY3JvbGxQYW5lLmZvb3RlciBmcm9tICR7cmVzfWApO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLiRoZWFkZXIgIT0gbnVsbCB8fCB0aGlzLiRmb290ZXIgIT0gbnVsbClcbiAgICAgICAgICAgIHRoaXMuJHJlZnJlc2hCYXJBeGlzID1cbiAgICAgICAgICAgICAgICB0aGlzLiRzY3JvbGxUeXBlID09IDIgLyogQm90aCAqLyB8fCB0aGlzLiRzY3JvbGxUeXBlID09IDEgLyogVmVydGljYWwgKi8gPyAneScgOiAneCc7XG4gICAgICAgIHRoaXMuc2V0U2l6ZShvd25lci53aWR0aCwgb3duZXIuaGVpZ2h0KTtcbiAgICAgICAgdGhpcy4kb3duZXIub24oSW50ZXJhY3RpdmVFdmVudHMuT3ZlciwgdGhpcy4kcm9sbE92ZXIsIHRoaXMpO1xuICAgICAgICB0aGlzLiRvd25lci5vbihJbnRlcmFjdGl2ZUV2ZW50cy5PdXQsIHRoaXMuJHJvbGxPdXQsIHRoaXMpO1xuICAgICAgICB0aGlzLiRvd25lci5vbihJbnRlcmFjdGl2ZUV2ZW50cy5Eb3duLCB0aGlzLiRtb3VzZURvd24sIHRoaXMpO1xuICAgICAgICB0aGlzLiRvd25lci5vbihcIl9fbW91c2VXaGVlbFwiIC8qIE1PVVNFX1dIRUVMICovLCB0aGlzLiRtb3VzZVdoZWVsLCB0aGlzKTtcbiAgICB9XG4gICAgZ2V0IG93bmVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kb3duZXI7XG4gICAgfVxuICAgIGRpc3Bvc2UoKSB7XG4gICAgICAgIGlmICh0aGlzLiR0d2VlbmluZyAhPSAwKVxuICAgICAgICAgICAgR1RpbWVyLmluc3QucmVtb3ZlKHRoaXMudHdlZW5VcGRhdGUsIHRoaXMpO1xuICAgICAgICB0aGlzLiRwYWdlQ29udHJvbGxlciA9IG51bGw7XG4gICAgICAgIGlmICh0aGlzLiRoelNjcm9sbEJhciAhPSBudWxsKVxuICAgICAgICAgICAgdGhpcy4kaHpTY3JvbGxCYXIuZGlzcG9zZSgpO1xuICAgICAgICBpZiAodGhpcy4kdnRTY3JvbGxCYXIgIT0gbnVsbClcbiAgICAgICAgICAgIHRoaXMuJHZ0U2Nyb2xsQmFyLmRpc3Bvc2UoKTtcbiAgICAgICAgaWYgKHRoaXMuJGhlYWRlciAhPSBudWxsKVxuICAgICAgICAgICAgdGhpcy4kaGVhZGVyLmRpc3Bvc2UoKTtcbiAgICAgICAgaWYgKHRoaXMuJGZvb3RlciAhPSBudWxsKVxuICAgICAgICAgICAgdGhpcy4kZm9vdGVyLmRpc3Bvc2UoKTtcbiAgICAgICAgRGVjbHMkMS5HUm9vdC5pbnN0Lm5hdGl2ZVN0YWdlLm9mZihJbnRlcmFjdGl2ZUV2ZW50cy5Nb3ZlLCB0aGlzLiRtb3VzZU1vdmVFdmVudCk7XG4gICAgICAgIERlY2xzJDEuR1Jvb3QuaW5zdC5uYXRpdmVTdGFnZS5vZmYoSW50ZXJhY3RpdmVFdmVudHMuVXAsIHRoaXMuJG1vdXNlVXBFdmVudCk7XG4gICAgICAgIERlY2xzJDEuR1Jvb3QuaW5zdC5uYXRpdmVTdGFnZS5vZmYoSW50ZXJhY3RpdmVFdmVudHMuQ2xpY2ssIHRoaXMuJGNsaWNrRXZlbnQpO1xuICAgICAgICB0aGlzLiRvd25lci5vZmYoSW50ZXJhY3RpdmVFdmVudHMuT3ZlciwgdGhpcy4kcm9sbE92ZXIpO1xuICAgICAgICB0aGlzLiRvd25lci5vZmYoSW50ZXJhY3RpdmVFdmVudHMuT3V0LCB0aGlzLiRyb2xsT3V0KTtcbiAgICAgICAgdGhpcy4kb3duZXIub2ZmKEludGVyYWN0aXZlRXZlbnRzLkRvd24sIHRoaXMuJG1vdXNlRG93bik7XG4gICAgICAgIHRoaXMuJG93bmVyLm9mZihcIl9fbW91c2VXaGVlbFwiIC8qIE1PVVNFX1dIRUVMICovLCB0aGlzLiRtb3VzZVdoZWVsKTtcbiAgICB9XG4gICAgZ2V0IGhvcnpTY3JvbGxCYXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRoelNjcm9sbEJhcjtcbiAgICB9XG4gICAgZ2V0IHZlcnRTY3JvbGxCYXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR2dFNjcm9sbEJhcjtcbiAgICB9XG4gICAgZ2V0IGhlYWRlcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGhlYWRlcjtcbiAgICB9XG4gICAgZ2V0IGZvb3RlcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGZvb3RlcjtcbiAgICB9XG4gICAgZ2V0IGJvdW5jZWJhY2tFZmZlY3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRib3VuY2ViYWNrRWZmZWN0O1xuICAgIH1cbiAgICBzZXQgYm91bmNlYmFja0VmZmVjdChzYykge1xuICAgICAgICB0aGlzLiRib3VuY2ViYWNrRWZmZWN0ID0gc2M7XG4gICAgfVxuICAgIGdldCB0b3VjaEVmZmVjdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHRvdWNoRWZmZWN0O1xuICAgIH1cbiAgICBzZXQgdG91Y2hFZmZlY3Qoc2MpIHtcbiAgICAgICAgdGhpcy4kdG91Y2hFZmZlY3QgPSBzYztcbiAgICB9XG4gICAgc2V0IHNjcm9sbFNwZWVkKHZhbCkge1xuICAgICAgICB0aGlzLiRzY3JvbGxTcGVlZCA9IHZhbDtcbiAgICAgICAgaWYgKHRoaXMuJHNjcm9sbFNwZWVkID09IDApXG4gICAgICAgICAgICB0aGlzLiRzY3JvbGxTcGVlZCA9IFVJQ29uZmlnLmRlZmF1bHRTY3JvbGxTcGVlZDtcbiAgICAgICAgdGhpcy4kbW91c2VXaGVlbFNwZWVkID0gdGhpcy4kc2Nyb2xsU3BlZWQgKiAyO1xuICAgIH1cbiAgICBnZXQgc2Nyb2xsU3BlZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRzY3JvbGxTcGVlZDtcbiAgICB9XG4gICAgZ2V0IHNuYXBUb0l0ZW0oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRzbmFwVG9JdGVtO1xuICAgIH1cbiAgICBzZXQgc25hcFRvSXRlbSh2YWx1ZSkge1xuICAgICAgICB0aGlzLiRzbmFwVG9JdGVtID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCBtb3VzZVdoZWVsRW5hYmxlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJG1vdXNlV2hlZWxFbmFibGVkO1xuICAgIH1cbiAgICBzZXQgbW91c2VXaGVlbEVuYWJsZWQodmFsdWUpIHtcbiAgICAgICAgdGhpcy4kbW91c2VXaGVlbEVuYWJsZWQgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IGRlY2VsZXJhdGlvblJhdGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRkZWNlbGVyYXRpb25SYXRlO1xuICAgIH1cbiAgICBzZXQgZGVjZWxlcmF0aW9uUmF0ZSh2YWx1ZSkge1xuICAgICAgICB0aGlzLiRkZWNlbGVyYXRpb25SYXRlID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCBwZXJjWCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJG92ZXJsYXBTaXplLnggPT0gMCA/IDAgOiB0aGlzLiR4UG9zIC8gdGhpcy4kb3ZlcmxhcFNpemUueDtcbiAgICB9XG4gICAgc2V0IHBlcmNYKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0UGVyY1godmFsdWUsIGZhbHNlKTtcbiAgICB9XG4gICAgc2V0UGVyY1godmFsdWUsIGFuaSA9IGZhbHNlKSB7XG4gICAgICAgIHRoaXMuJG93bmVyLmVuc3VyZUJvdW5kc0NvcnJlY3QoKTtcbiAgICAgICAgdGhpcy5zZXRQb3NYKHRoaXMuJG92ZXJsYXBTaXplLnggKiBOdW1iZXJVdGlsLmNsYW1wMDEodmFsdWUpLCBhbmkpO1xuICAgIH1cbiAgICBnZXQgcGVyY1koKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRvdmVybGFwU2l6ZS55ID09IDAgPyAwIDogdGhpcy4keVBvcyAvIHRoaXMuJG92ZXJsYXBTaXplLnk7XG4gICAgfVxuICAgIHNldCBwZXJjWSh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldFBlcmNZKHZhbHVlLCBmYWxzZSk7XG4gICAgfVxuICAgIHNldFBlcmNZKHZhbHVlLCBhbmkgPSBmYWxzZSkge1xuICAgICAgICB0aGlzLiRvd25lci5lbnN1cmVCb3VuZHNDb3JyZWN0KCk7XG4gICAgICAgIHRoaXMuc2V0UG9zWSh0aGlzLiRvdmVybGFwU2l6ZS55ICogTnVtYmVyVXRpbC5jbGFtcDAxKHZhbHVlKSwgYW5pKTtcbiAgICB9XG4gICAgZ2V0IHBvc1goKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR4UG9zO1xuICAgIH1cbiAgICBzZXQgcG9zWCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldFBvc1godmFsdWUsIGZhbHNlKTtcbiAgICB9XG4gICAgc2V0UG9zWCh2YWx1ZSwgYW5pID0gZmFsc2UpIHtcbiAgICAgICAgdGhpcy4kb3duZXIuZW5zdXJlQm91bmRzQ29ycmVjdCgpO1xuICAgICAgICBpZiAodGhpcy4kbG9vcCA9PSAxKVxuICAgICAgICAgICAgdmFsdWUgPSB0aGlzLmxvb3BDaGVja2luZ05ld1Bvcyh2YWx1ZSwgJ3gnKTtcbiAgICAgICAgdmFsdWUgPSBOdW1iZXJVdGlsLmNsYW1wKHZhbHVlLCAwLCB0aGlzLiRvdmVybGFwU2l6ZS54KTtcbiAgICAgICAgaWYgKHZhbHVlICE9IHRoaXMuJHhQb3MpIHtcbiAgICAgICAgICAgIHRoaXMuJHhQb3MgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMucG9zQ2hhbmdlZChhbmkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBwb3NZKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4keVBvcztcbiAgICB9XG4gICAgc2V0IHBvc1kodmFsdWUpIHtcbiAgICAgICAgdGhpcy5zZXRQb3NZKHZhbHVlLCBmYWxzZSk7XG4gICAgfVxuICAgIHNldFBvc1kodmFsdWUsIGFuaSA9IGZhbHNlKSB7XG4gICAgICAgIHRoaXMuJG93bmVyLmVuc3VyZUJvdW5kc0NvcnJlY3QoKTtcbiAgICAgICAgaWYgKHRoaXMuJGxvb3AgPT0gMSlcbiAgICAgICAgICAgIHZhbHVlID0gdGhpcy5sb29wQ2hlY2tpbmdOZXdQb3ModmFsdWUsICd5Jyk7XG4gICAgICAgIHZhbHVlID0gTnVtYmVyVXRpbC5jbGFtcCh2YWx1ZSwgMCwgdGhpcy4kb3ZlcmxhcFNpemUueSk7XG4gICAgICAgIGlmICh2YWx1ZSAhPSB0aGlzLiR5UG9zKSB7XG4gICAgICAgICAgICB0aGlzLiR5UG9zID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnBvc0NoYW5nZWQoYW5pKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgY29udGVudFdpZHRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kY29udGVudFNpemUueDtcbiAgICB9XG4gICAgZ2V0IGNvbnRlbnRIZWlnaHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRjb250ZW50U2l6ZS55O1xuICAgIH1cbiAgICBnZXQgdmlld1dpZHRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kdmlld1NpemUueDtcbiAgICB9XG4gICAgc2V0IHZpZXdXaWR0aCh2YWx1ZSkge1xuICAgICAgICB2YWx1ZSA9IHZhbHVlICsgdGhpcy4kb3duZXIubWFyZ2luLmxlZnQgKyB0aGlzLiRvd25lci5tYXJnaW4ucmlnaHQ7XG4gICAgICAgIGlmICh0aGlzLiR2dFNjcm9sbEJhciAhPSBudWxsKVxuICAgICAgICAgICAgdmFsdWUgKz0gdGhpcy4kdnRTY3JvbGxCYXIud2lkdGg7XG4gICAgICAgIHRoaXMuJG93bmVyLndpZHRoID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCB2aWV3SGVpZ2h0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kdmlld1NpemUueTtcbiAgICB9XG4gICAgc2V0IHZpZXdIZWlnaHQodmFsdWUpIHtcbiAgICAgICAgdmFsdWUgPSB2YWx1ZSArIHRoaXMuJG93bmVyLm1hcmdpbi50b3AgKyB0aGlzLiRvd25lci5tYXJnaW4uYm90dG9tO1xuICAgICAgICBpZiAodGhpcy4kaHpTY3JvbGxCYXIgIT0gbnVsbClcbiAgICAgICAgICAgIHZhbHVlICs9IHRoaXMuJGh6U2Nyb2xsQmFyLmhlaWdodDtcbiAgICAgICAgdGhpcy4kb3duZXIuaGVpZ2h0ID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCBjdXJyZW50UGFnZVgoKSB7XG4gICAgICAgIGlmICghdGhpcy4kcGFnZU1vZGUpXG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgdmFyIHBhZ2UgPSBNYXRoLmZsb29yKHRoaXMuJHhQb3MgLyB0aGlzLiRwYWdlU2l6ZS54KTtcbiAgICAgICAgaWYgKHRoaXMuJHhQb3MgLSBwYWdlICogdGhpcy4kcGFnZVNpemUueCA+IHRoaXMuJHBhZ2VTaXplLnggKiAwLjUpXG4gICAgICAgICAgICBwYWdlKys7XG4gICAgICAgIHJldHVybiBwYWdlO1xuICAgIH1cbiAgICBzZXQgY3VycmVudFBhZ2VYKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiRwYWdlTW9kZSAmJiB0aGlzLiRvdmVybGFwU2l6ZS54ID4gMClcbiAgICAgICAgICAgIHRoaXMuc2V0UG9zWCh2YWx1ZSAqIHRoaXMuJHBhZ2VTaXplLngsIGZhbHNlKTtcbiAgICB9XG4gICAgZ2V0IGN1cnJlbnRQYWdlWSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLiRwYWdlTW9kZSlcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICBsZXQgcGFnZSA9IE1hdGguZmxvb3IodGhpcy4keVBvcyAvIHRoaXMuJHBhZ2VTaXplLnkpO1xuICAgICAgICBpZiAodGhpcy4keVBvcyAtIHBhZ2UgKiB0aGlzLiRwYWdlU2l6ZS55ID4gdGhpcy4kcGFnZVNpemUueSAqIDAuNSlcbiAgICAgICAgICAgIHBhZ2UrKztcbiAgICAgICAgcmV0dXJuIHBhZ2U7XG4gICAgfVxuICAgIHNldCBjdXJyZW50UGFnZVkodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJHBhZ2VNb2RlICYmIHRoaXMuJG92ZXJsYXBTaXplLnkgPiAwKVxuICAgICAgICAgICAgdGhpcy5zZXRQb3NZKHZhbHVlICogdGhpcy4kcGFnZVNpemUueSwgZmFsc2UpO1xuICAgIH1cbiAgICBnZXQgaXNCb3R0b21Nb3N0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4keVBvcyA9PSB0aGlzLiRvdmVybGFwU2l6ZS55IHx8IHRoaXMuJG92ZXJsYXBTaXplLnkgPT0gMDtcbiAgICB9XG4gICAgZ2V0IGlzUmlnaHRNb3N0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4keFBvcyA9PSB0aGlzLiRvdmVybGFwU2l6ZS54IHx8IHRoaXMuJG92ZXJsYXBTaXplLnggPT0gMDtcbiAgICB9XG4gICAgZ2V0IHBhZ2VDb250cm9sbGVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kcGFnZUNvbnRyb2xsZXI7XG4gICAgfVxuICAgIHNldCBwYWdlQ29udHJvbGxlcih2YWx1ZSkge1xuICAgICAgICB0aGlzLiRwYWdlQ29udHJvbGxlciA9IHZhbHVlO1xuICAgIH1cbiAgICBnZXQgc2Nyb2xsaW5nUG9zWCgpIHtcbiAgICAgICAgcmV0dXJuIE51bWJlclV0aWwuY2xhbXAoLXRoaXMuJGNvbnRhaW5lci54LCAwLCB0aGlzLiRvdmVybGFwU2l6ZS54KTtcbiAgICB9XG4gICAgZ2V0IHNjcm9sbGluZ1Bvc1koKSB7XG4gICAgICAgIHJldHVybiBOdW1iZXJVdGlsLmNsYW1wKC10aGlzLiRjb250YWluZXIueSwgMCwgdGhpcy4kb3ZlcmxhcFNpemUueSk7XG4gICAgfVxuICAgIHNjcm9sbFRvcChhbmkgPSBmYWxzZSkge1xuICAgICAgICB0aGlzLnNldFBlcmNZKDAsIGFuaSk7XG4gICAgfVxuICAgIHNjcm9sbEJvdHRvbShhbmkgPSBmYWxzZSkge1xuICAgICAgICB0aGlzLnNldFBlcmNZKDEsIGFuaSk7XG4gICAgfVxuICAgIHNjcm9sbFVwKHJhdGlvID0gMSwgYW5pID0gZmFsc2UpIHtcbiAgICAgICAgaWYgKHRoaXMuJHBhZ2VNb2RlKVxuICAgICAgICAgICAgdGhpcy5zZXRQb3NZKHRoaXMuJHlQb3MgLSB0aGlzLiRwYWdlU2l6ZS55ICogcmF0aW8sIGFuaSk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRoaXMuc2V0UG9zWSh0aGlzLiR5UG9zIC0gdGhpcy4kc2Nyb2xsU3BlZWQgKiByYXRpbywgYW5pKTtcbiAgICB9XG4gICAgc2Nyb2xsRG93bihyYXRpbyA9IDEsIGFuaSA9IGZhbHNlKSB7XG4gICAgICAgIGlmICh0aGlzLiRwYWdlTW9kZSlcbiAgICAgICAgICAgIHRoaXMuc2V0UG9zWSh0aGlzLiR5UG9zICsgdGhpcy4kcGFnZVNpemUueSAqIHJhdGlvLCBhbmkpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLnNldFBvc1kodGhpcy4keVBvcyArIHRoaXMuJHNjcm9sbFNwZWVkICogcmF0aW8sIGFuaSk7XG4gICAgfVxuICAgIHNjcm9sbExlZnQocmF0aW8gPSAxLCBhbmkgPSBmYWxzZSkge1xuICAgICAgICBpZiAodGhpcy4kcGFnZU1vZGUpXG4gICAgICAgICAgICB0aGlzLnNldFBvc1godGhpcy4keFBvcyAtIHRoaXMuJHBhZ2VTaXplLnggKiByYXRpbywgYW5pKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy5zZXRQb3NYKHRoaXMuJHhQb3MgLSB0aGlzLiRzY3JvbGxTcGVlZCAqIHJhdGlvLCBhbmkpO1xuICAgIH1cbiAgICBzY3JvbGxSaWdodChyYXRpbyA9IDEsIGFuaSA9IGZhbHNlKSB7XG4gICAgICAgIGlmICh0aGlzLiRwYWdlTW9kZSlcbiAgICAgICAgICAgIHRoaXMuc2V0UG9zWCh0aGlzLiR4UG9zICsgdGhpcy4kcGFnZVNpemUueCAqIHJhdGlvLCBhbmkpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLnNldFBvc1godGhpcy4keFBvcyArIHRoaXMuJHNjcm9sbFNwZWVkICogcmF0aW8sIGFuaSk7XG4gICAgfVxuICAgIHNjcm9sbFRvVmlldyh0YXJnZXQsIGFuaSA9IGZhbHNlLCBzbmFwVG9GaXJzdCA9IGZhbHNlKSB7XG4gICAgICAgIHRoaXMuJG93bmVyLmVuc3VyZUJvdW5kc0NvcnJlY3QoKTtcbiAgICAgICAgaWYgKHRoaXMuJG5lZWRSZWZyZXNoKVxuICAgICAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgICAgIGxldCByZWN0O1xuICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgR09iamVjdCkge1xuICAgICAgICAgICAgaWYgKHRhcmdldC5wYXJlbnQgIT0gdGhpcy4kb3duZXIpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQucGFyZW50LmxvY2FsVG9HbG9iYWxSZWN0KHRhcmdldC54LCB0YXJnZXQueSwgdGFyZ2V0LndpZHRoLCB0YXJnZXQuaGVpZ2h0LCBTY3JvbGxQYW5lLnNIZWxwZXJSZWN0KTtcbiAgICAgICAgICAgICAgICByZWN0ID0gdGhpcy4kb3duZXIuZ2xvYmFsVG9Mb2NhbFJlY3QoU2Nyb2xsUGFuZS5zSGVscGVyUmVjdC54LCBTY3JvbGxQYW5lLnNIZWxwZXJSZWN0LnksIFNjcm9sbFBhbmUuc0hlbHBlclJlY3Qud2lkdGgsIFNjcm9sbFBhbmUuc0hlbHBlclJlY3QuaGVpZ2h0LCBTY3JvbGxQYW5lLnNIZWxwZXJSZWN0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlY3QgPSBTY3JvbGxQYW5lLnNIZWxwZXJSZWN0O1xuICAgICAgICAgICAgICAgIHJlY3QueCA9IHRhcmdldC54O1xuICAgICAgICAgICAgICAgIHJlY3QueSA9IHRhcmdldC55O1xuICAgICAgICAgICAgICAgIHJlY3Qud2lkdGggPSB0YXJnZXQud2lkdGg7XG4gICAgICAgICAgICAgICAgcmVjdC5oZWlnaHQgPSB0YXJnZXQuaGVpZ2h0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJlY3QgPSB0YXJnZXQ7XG4gICAgICAgIGlmICh0aGlzLiRvdmVybGFwU2l6ZS55ID4gMCkge1xuICAgICAgICAgICAgY29uc3QgYm90dG9tID0gdGhpcy4keVBvcyArIHRoaXMuJHZpZXdTaXplLnk7XG4gICAgICAgICAgICBpZiAoc25hcFRvRmlyc3QgfHwgcmVjdC55IDw9IHRoaXMuJHlQb3MgfHwgcmVjdC5oZWlnaHQgPj0gdGhpcy4kdmlld1NpemUueSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRwYWdlTW9kZSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRQb3NZKE1hdGguZmxvb3IocmVjdC55IC8gdGhpcy4kcGFnZVNpemUueSkgKiB0aGlzLiRwYWdlU2l6ZS55LCBhbmkpO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRQb3NZKHJlY3QueSwgYW5pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHJlY3QueSArIHJlY3QuaGVpZ2h0ID4gYm90dG9tKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJHBhZ2VNb2RlKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFBvc1koTWF0aC5mbG9vcihyZWN0LnkgLyB0aGlzLiRwYWdlU2l6ZS55KSAqIHRoaXMuJHBhZ2VTaXplLnksIGFuaSk7XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocmVjdC5oZWlnaHQgPD0gdGhpcy4kdmlld1NpemUueSAvIDIpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0UG9zWShyZWN0LnkgKyByZWN0LmhlaWdodCAqIDIgLSB0aGlzLiR2aWV3U2l6ZS55LCBhbmkpO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRQb3NZKHJlY3QueSArIHJlY3QuaGVpZ2h0IC0gdGhpcy4kdmlld1NpemUueSwgYW5pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy4kb3ZlcmxhcFNpemUueCA+IDApIHtcbiAgICAgICAgICAgIGxldCByaWdodCA9IHRoaXMuJHhQb3MgKyB0aGlzLiR2aWV3U2l6ZS54O1xuICAgICAgICAgICAgaWYgKHNuYXBUb0ZpcnN0IHx8IHJlY3QueCA8PSB0aGlzLiR4UG9zIHx8IHJlY3Qud2lkdGggPj0gdGhpcy4kdmlld1NpemUueCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRwYWdlTW9kZSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRQb3NYKE1hdGguZmxvb3IocmVjdC54IC8gdGhpcy4kcGFnZVNpemUueCkgKiB0aGlzLiRwYWdlU2l6ZS54LCBhbmkpO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRQb3NYKHJlY3QueCwgYW5pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHJlY3QueCArIHJlY3Qud2lkdGggPiByaWdodCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRwYWdlTW9kZSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRQb3NYKE1hdGguZmxvb3IocmVjdC54IC8gdGhpcy4kcGFnZVNpemUueCkgKiB0aGlzLiRwYWdlU2l6ZS54LCBhbmkpO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlY3Qud2lkdGggPD0gdGhpcy4kdmlld1NpemUueCAvIDIpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0UG9zWChyZWN0LnggKyByZWN0LndpZHRoICogMiAtIHRoaXMuJHZpZXdTaXplLngsIGFuaSk7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFBvc1gocmVjdC54ICsgcmVjdC53aWR0aCAtIHRoaXMuJHZpZXdTaXplLngsIGFuaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFhbmkgJiYgdGhpcy4kbmVlZFJlZnJlc2gpXG4gICAgICAgICAgICB0aGlzLnJlZnJlc2goKTtcbiAgICB9XG4gICAgaXNDaGlsZEluVmlldyhvYmopIHtcbiAgICAgICAgaWYgKHRoaXMuJG92ZXJsYXBTaXplLnkgPiAwKSB7XG4gICAgICAgICAgICB2YXIgZGlzdCA9IG9iai55ICsgdGhpcy4kY29udGFpbmVyLnk7XG4gICAgICAgICAgICBpZiAoZGlzdCA8IC1vYmouaGVpZ2h0IHx8IGRpc3QgPiB0aGlzLiR2aWV3U2l6ZS55KVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy4kb3ZlcmxhcFNpemUueCA+IDApIHtcbiAgICAgICAgICAgIGRpc3QgPSBvYmoueCArIHRoaXMuJGNvbnRhaW5lci54O1xuICAgICAgICAgICAgaWYgKGRpc3QgPCAtb2JqLndpZHRoIHx8IGRpc3QgPiB0aGlzLiR2aWV3U2l6ZS54KVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY2FuY2VsRHJhZ2dpbmcoKSB7XG4gICAgICAgIERlY2xzJDEuR1Jvb3QuaW5zdC5uYXRpdmVTdGFnZS5vZmYoSW50ZXJhY3RpdmVFdmVudHMuTW92ZSwgdGhpcy4kbW91c2VNb3ZlRXZlbnQpO1xuICAgICAgICBEZWNscyQxLkdSb290Lmluc3QubmF0aXZlU3RhZ2Uub2ZmKEludGVyYWN0aXZlRXZlbnRzLlVwLCB0aGlzLiRtb3VzZVVwRXZlbnQpO1xuICAgICAgICBEZWNscyQxLkdSb290Lmluc3QubmF0aXZlU3RhZ2Uub2ZmKEludGVyYWN0aXZlRXZlbnRzLkNsaWNrLCB0aGlzLiRjbGlja0V2ZW50KTtcbiAgICAgICAgaWYgKFNjcm9sbFBhbmUuZHJhZ2dpbmdQYW5lID09IHRoaXMpXG4gICAgICAgICAgICBTY3JvbGxQYW5lLmRyYWdnaW5nUGFuZSA9IG51bGw7XG4gICAgICAgIFNjcm9sbFBhbmUuJGdlc3R1cmVGbGFnID0gMDtcbiAgICAgICAgdGhpcy4kaXNEcmFnZ2luZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLiRtYXNrQ29udGFpbmVyLm1vdXNlRW5hYmxlZCA9IHRydWU7XG4gICAgfVxuICAgIGdldCBpc0RyYWdnaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kaXNEcmFnZ2luZztcbiAgICB9XG4gICAgbG9ja0hlYWRlcihzaXplKSB7XG4gICAgICAgIGlmICh0aGlzLiRoZWFkZXJMb2NrZWRTaXplID09IHNpemUpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuJGhlYWRlckxvY2tlZFNpemUgPSBzaXplO1xuICAgICAgICBpZiAoIXRoaXMuJHJlZnJlc2hFdmVudERpc3BhdGNoaW5nICYmXG4gICAgICAgICAgICB0aGlzLiRjb250YWluZXJbdGhpcy4kcmVmcmVzaEJhckF4aXNdID49IDApIHtcbiAgICAgICAgICAgIHRoaXMuJHR3ZWVuU3RhcnQuc2V0VmFsdWVzKHRoaXMuJGNvbnRhaW5lci54LCB0aGlzLiRjb250YWluZXIueSk7XG4gICAgICAgICAgICB0aGlzLiR0d2VlbkNoYW5nZS5zZXRWYWx1ZXMoMCwgMCk7XG4gICAgICAgICAgICB0aGlzLiR0d2VlbkNoYW5nZVt0aGlzLiRyZWZyZXNoQmFyQXhpc10gPVxuICAgICAgICAgICAgICAgIHRoaXMuJGhlYWRlckxvY2tlZFNpemUgLSB0aGlzLiR0d2VlblN0YXJ0W3RoaXMuJHJlZnJlc2hCYXJBeGlzXTtcbiAgICAgICAgICAgIHRoaXMuJHR3ZWVuRHVyYXRpb24uc2V0VmFsdWVzKFNjcm9sbFBhbmUuVFdFRU5fREVGQVVMVF9EVVJBVElPTiwgU2Nyb2xsUGFuZS5UV0VFTl9ERUZBVUxUX0RVUkFUSU9OKTtcbiAgICAgICAgICAgIHRoaXMuJHR3ZWVuVGltZS5zZXRWYWx1ZXMoMCwgMCk7XG4gICAgICAgICAgICB0aGlzLiR0d2VlbmluZyA9IDI7XG4gICAgICAgICAgICBHVGltZXIuaW5zdC5hZGRMb29wKDEsIHRoaXMudHdlZW5VcGRhdGUsIHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGxvY2tGb290ZXIoc2l6ZSkge1xuICAgICAgICBpZiAodGhpcy4kZm9vdGVyTG9ja2VkU2l6ZSA9PSBzaXplKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLiRmb290ZXJMb2NrZWRTaXplID0gc2l6ZTtcbiAgICAgICAgaWYgKCF0aGlzLiRyZWZyZXNoRXZlbnREaXNwYXRjaGluZyAmJlxuICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyW3RoaXMuJHJlZnJlc2hCYXJBeGlzXSA8PVxuICAgICAgICAgICAgICAgIC10aGlzLiRvdmVybGFwU2l6ZVt0aGlzLiRyZWZyZXNoQmFyQXhpc10pIHtcbiAgICAgICAgICAgIHRoaXMuJHR3ZWVuU3RhcnQuc2V0VmFsdWVzKHRoaXMuJGNvbnRhaW5lci54LCB0aGlzLiRjb250YWluZXIueSk7XG4gICAgICAgICAgICB0aGlzLiR0d2VlbkNoYW5nZS5zZXRWYWx1ZXMoMCwgMCk7XG4gICAgICAgICAgICBsZXQgbWF4ID0gdGhpcy4kb3ZlcmxhcFNpemVbdGhpcy4kcmVmcmVzaEJhckF4aXNdO1xuICAgICAgICAgICAgaWYgKG1heCA9PSAwKVxuICAgICAgICAgICAgICAgIG1heCA9IE1hdGgubWF4KHRoaXMuJGNvbnRlbnRTaXplW3RoaXMuJHJlZnJlc2hCYXJBeGlzXSArXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGZvb3RlckxvY2tlZFNpemUgLVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiR2aWV3U2l6ZVt0aGlzLiRyZWZyZXNoQmFyQXhpc10sIDApO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIG1heCArPSB0aGlzLiRmb290ZXJMb2NrZWRTaXplO1xuICAgICAgICAgICAgdGhpcy4kdHdlZW5DaGFuZ2VbdGhpcy4kcmVmcmVzaEJhckF4aXNdID1cbiAgICAgICAgICAgICAgICAtbWF4IC0gdGhpcy4kdHdlZW5TdGFydFt0aGlzLiRyZWZyZXNoQmFyQXhpc107XG4gICAgICAgICAgICB0aGlzLiR0d2VlbkR1cmF0aW9uLnNldFZhbHVlcyhTY3JvbGxQYW5lLlRXRUVOX0RFRkFVTFRfRFVSQVRJT04sIFNjcm9sbFBhbmUuVFdFRU5fREVGQVVMVF9EVVJBVElPTik7XG4gICAgICAgICAgICB0aGlzLiR0d2VlblRpbWUuc2V0VmFsdWVzKDAsIDApO1xuICAgICAgICAgICAgdGhpcy4kdHdlZW5pbmcgPSAyO1xuICAgICAgICAgICAgR1RpbWVyLmluc3QuYWRkTG9vcCgxLCB0aGlzLnR3ZWVuVXBkYXRlLCB0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBvbk93bmVyU2l6ZUNoYW5nZWQoKSB7XG4gICAgICAgIHRoaXMuc2V0U2l6ZSh0aGlzLiRvd25lci53aWR0aCwgdGhpcy4kb3duZXIuaGVpZ2h0KTtcbiAgICAgICAgdGhpcy5wb3NDaGFuZ2VkKGZhbHNlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgaGFuZGxlQ29udHJvbGxlckNoYW5nZWQoYykge1xuICAgICAgICBpZiAodGhpcy4kcGFnZUNvbnRyb2xsZXIgPT0gYykge1xuICAgICAgICAgICAgaWYgKHRoaXMuJHNjcm9sbFR5cGUgPT0gMCAvKiBIb3Jpem9udGFsICovKVxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2VYID0gYy5zZWxlY3RlZEluZGV4O1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2VZID0gYy5zZWxlY3RlZEluZGV4O1xuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZVBhZ2VDb250cm9sbGVyKCkge1xuICAgICAgICBpZiAodGhpcy4kcGFnZUNvbnRyb2xsZXIgIT0gbnVsbCAmJiAhdGhpcy4kcGFnZUNvbnRyb2xsZXIuJHVwZGF0aW5nKSB7XG4gICAgICAgICAgICBsZXQgaW5kZXg7XG4gICAgICAgICAgICBpZiAodGhpcy4kc2Nyb2xsVHlwZSA9PSAwIC8qIEhvcml6b250YWwgKi8pXG4gICAgICAgICAgICAgICAgaW5kZXggPSB0aGlzLmN1cnJlbnRQYWdlWDtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBpbmRleCA9IHRoaXMuY3VycmVudFBhZ2VZO1xuICAgICAgICAgICAgaWYgKGluZGV4IDwgdGhpcy4kcGFnZUNvbnRyb2xsZXIucGFnZUNvdW50KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYyA9IHRoaXMuJHBhZ2VDb250cm9sbGVyO1xuICAgICAgICAgICAgICAgIHRoaXMuJHBhZ2VDb250cm9sbGVyID0gbnVsbDsgLy9wcmV2ZW50IGZyb20gaGFuZGxlQ29udHJvbGxlckNoYW5nZWQgY2FsbGluZ1xuICAgICAgICAgICAgICAgIGMuc2VsZWN0ZWRJbmRleCA9IGluZGV4O1xuICAgICAgICAgICAgICAgIHRoaXMuJHBhZ2VDb250cm9sbGVyID0gYztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBhZGp1c3RNYXNrQ29udGFpbmVyKCkge1xuICAgICAgICBsZXQgeCwgeTtcbiAgICAgICAgaWYgKHRoaXMuJGRpc3BsYXlPbkxlZnQgJiYgdGhpcy4kdnRTY3JvbGxCYXIgIT0gbnVsbClcbiAgICAgICAgICAgIHggPSBNYXRoLmZsb29yKHRoaXMuJG93bmVyLm1hcmdpbi5sZWZ0ICsgdGhpcy4kdnRTY3JvbGxCYXIud2lkdGgpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB4ID0gTWF0aC5mbG9vcih0aGlzLiRvd25lci5tYXJnaW4ubGVmdCk7XG4gICAgICAgIHkgPSBNYXRoLmZsb29yKHRoaXMuJG93bmVyLm1hcmdpbi50b3ApO1xuICAgICAgICB0aGlzLiRtYXNrQ29udGFpbmVyLnNldCh7IHgsIHkgfSk7XG4gICAgICAgIGlmICh0aGlzLiRvd25lci4kYWxpZ25PZmZzZXQueCAhPSAwIHx8IHRoaXMuJG93bmVyLiRhbGlnbk9mZnNldC55ICE9IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRhbGlnbkNvbnRhaW5lciA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kYWxpZ25Db250YWluZXIgPSBuZXcgY3JlYXRlanMuQ29udGFpbmVyKCk7XG4gICAgICAgICAgICAgICAgdGhpcy4kbWFza0NvbnRhaW5lci5hZGRDaGlsZCh0aGlzLiRhbGlnbkNvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgdGhpcy4kYWxpZ25Db250YWluZXIuYWRkQ2hpbGQodGhpcy4kY29udGFpbmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuJGFsaWduQ29udGFpbmVyLnNldCh7IHg6IHRoaXMuJG93bmVyLiRhbGlnbk9mZnNldC54LCB5OiB0aGlzLiRvd25lci4kYWxpZ25PZmZzZXQueSB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLiRhbGlnbkNvbnRhaW5lcilcbiAgICAgICAgICAgIHRoaXMuJGFsaWduQ29udGFpbmVyLnNldCh7IHg6IDAsIHk6IDAgfSk7XG4gICAgfVxuICAgIHNldFNpemUod2lkdGgsIGhlaWdodCkge1xuICAgICAgICB0aGlzLmFkanVzdE1hc2tDb250YWluZXIoKTtcbiAgICAgICAgaWYgKHRoaXMuJGh6U2Nyb2xsQmFyKSB7XG4gICAgICAgICAgICB0aGlzLiRoelNjcm9sbEJhci55ID0gaGVpZ2h0IC0gdGhpcy4kaHpTY3JvbGxCYXIuaGVpZ2h0O1xuICAgICAgICAgICAgaWYgKHRoaXMuJHZ0U2Nyb2xsQmFyICYmICF0aGlzLiR2U2Nyb2xsTm9uZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuJGh6U2Nyb2xsQmFyLndpZHRoID1cbiAgICAgICAgICAgICAgICAgICAgd2lkdGggLSB0aGlzLiR2dFNjcm9sbEJhci53aWR0aCAtIHRoaXMuJHNjcm9sbEJhck1hcmdpbi5sZWZ0IC0gdGhpcy4kc2Nyb2xsQmFyTWFyZ2luLnJpZ2h0O1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRkaXNwbGF5T25MZWZ0KVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRoelNjcm9sbEJhci54ID0gdGhpcy4kc2Nyb2xsQmFyTWFyZ2luLmxlZnQgKyB0aGlzLiR2dFNjcm9sbEJhci53aWR0aDtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGh6U2Nyb2xsQmFyLnggPSB0aGlzLiRzY3JvbGxCYXJNYXJnaW4ubGVmdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuJGh6U2Nyb2xsQmFyLndpZHRoID0gd2lkdGggLSB0aGlzLiRzY3JvbGxCYXJNYXJnaW4ubGVmdCAtIHRoaXMuJHNjcm9sbEJhck1hcmdpbi5yaWdodDtcbiAgICAgICAgICAgICAgICB0aGlzLiRoelNjcm9sbEJhci54ID0gdGhpcy4kc2Nyb2xsQmFyTWFyZ2luLmxlZnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuJHZ0U2Nyb2xsQmFyKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuJGRpc3BsYXlPbkxlZnQpXG4gICAgICAgICAgICAgICAgdGhpcy4kdnRTY3JvbGxCYXIueCA9IHdpZHRoIC0gdGhpcy4kdnRTY3JvbGxCYXIud2lkdGg7XG4gICAgICAgICAgICBpZiAodGhpcy4kaHpTY3JvbGxCYXIpXG4gICAgICAgICAgICAgICAgdGhpcy4kdnRTY3JvbGxCYXIuaGVpZ2h0ID1cbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0IC1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGh6U2Nyb2xsQmFyLmhlaWdodCAtXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzY3JvbGxCYXJNYXJnaW4udG9wIC1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHNjcm9sbEJhck1hcmdpbi5ib3R0b207XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGhpcy4kdnRTY3JvbGxCYXIuaGVpZ2h0ID0gaGVpZ2h0IC0gdGhpcy4kc2Nyb2xsQmFyTWFyZ2luLnRvcCAtIHRoaXMuJHNjcm9sbEJhck1hcmdpbi5ib3R0b207XG4gICAgICAgICAgICB0aGlzLiR2dFNjcm9sbEJhci55ID0gdGhpcy4kc2Nyb2xsQmFyTWFyZ2luLnRvcDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiR2aWV3U2l6ZS54ID0gd2lkdGg7XG4gICAgICAgIHRoaXMuJHZpZXdTaXplLnkgPSBoZWlnaHQ7XG4gICAgICAgIGlmICh0aGlzLiRoelNjcm9sbEJhciAmJiAhdGhpcy4kaFNjcm9sbE5vbmUpXG4gICAgICAgICAgICB0aGlzLiR2aWV3U2l6ZS55IC09IHRoaXMuJGh6U2Nyb2xsQmFyLmhlaWdodDtcbiAgICAgICAgaWYgKHRoaXMuJHZ0U2Nyb2xsQmFyICYmICF0aGlzLiR2U2Nyb2xsTm9uZSlcbiAgICAgICAgICAgIHRoaXMuJHZpZXdTaXplLnggLT0gdGhpcy4kdnRTY3JvbGxCYXIud2lkdGg7XG4gICAgICAgIHRoaXMuJHZpZXdTaXplLnggLT0gdGhpcy4kb3duZXIubWFyZ2luLmxlZnQgKyB0aGlzLiRvd25lci5tYXJnaW4ucmlnaHQ7XG4gICAgICAgIHRoaXMuJHZpZXdTaXplLnkgLT0gdGhpcy4kb3duZXIubWFyZ2luLnRvcCArIHRoaXMuJG93bmVyLm1hcmdpbi5ib3R0b207XG4gICAgICAgIHRoaXMuJHZpZXdTaXplLnggPSBNYXRoLm1heCgxLCB0aGlzLiR2aWV3U2l6ZS54KTtcbiAgICAgICAgdGhpcy4kdmlld1NpemUueSA9IE1hdGgubWF4KDEsIHRoaXMuJHZpZXdTaXplLnkpO1xuICAgICAgICB0aGlzLiRwYWdlU2l6ZS54ID0gdGhpcy4kdmlld1NpemUueDtcbiAgICAgICAgdGhpcy4kcGFnZVNpemUueSA9IHRoaXMuJHZpZXdTaXplLnk7XG4gICAgICAgIHRoaXMuaGFuZGxlU2l6ZUNoYW5nZWQoKTtcbiAgICB9XG4gICAgc2V0Q29udGVudFNpemUodywgaCkge1xuICAgICAgICBpZiAodGhpcy4kY29udGVudFNpemUueCA9PSB3ICYmIHRoaXMuJGNvbnRlbnRTaXplLnkgPT0gaClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy4kY29udGVudFNpemUueCA9IHc7XG4gICAgICAgIHRoaXMuJGNvbnRlbnRTaXplLnkgPSBoO1xuICAgICAgICB0aGlzLmhhbmRsZVNpemVDaGFuZ2VkKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNoYW5nZUNvbnRlbnRTaXplT25TY3JvbGxpbmcoZGVsdGFXaWR0aCwgZGVsdGFIZWlnaHQsIGRlbHRhUG9zWCwgZGVsdGFQb3NZKSB7XG4gICAgICAgIGNvbnN0IGlzUmlnaHRtb3N0ID0gdGhpcy4keFBvcyA9PSB0aGlzLiRvdmVybGFwU2l6ZS54O1xuICAgICAgICBjb25zdCBpc0JvdHRvbSA9IHRoaXMuJHlQb3MgPT0gdGhpcy4kb3ZlcmxhcFNpemUueTtcbiAgICAgICAgdGhpcy4kY29udGVudFNpemUueCArPSBkZWx0YVdpZHRoO1xuICAgICAgICB0aGlzLiRjb250ZW50U2l6ZS55ICs9IGRlbHRhSGVpZ2h0O1xuICAgICAgICB0aGlzLmhhbmRsZVNpemVDaGFuZ2VkKCk7XG4gICAgICAgIGlmICh0aGlzLiR0d2VlbmluZyA9PSAxKSB7XG4gICAgICAgICAgICAvL2lmIHRoZSBsYXN0IHNjcm9sbCBpcyBDTElOR0lORy1TSURFLCB0aGVuIGp1c3QgY29udGludWUgdG8gY2xpbmdcbiAgICAgICAgICAgIGlmIChkZWx0YVdpZHRoICE9IDAgJiYgaXNSaWdodG1vc3QgJiYgdGhpcy4kdHdlZW5DaGFuZ2UueCA8IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLiR4UG9zID0gdGhpcy4kb3ZlcmxhcFNpemUueDtcbiAgICAgICAgICAgICAgICB0aGlzLiR0d2VlbkNoYW5nZS54ID0gLXRoaXMuJHhQb3MgLSB0aGlzLiR0d2VlblN0YXJ0Lng7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGVsdGFIZWlnaHQgIT0gMCAmJiBpc0JvdHRvbSAmJiB0aGlzLiR0d2VlbkNoYW5nZS55IDwgMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuJHlQb3MgPSB0aGlzLiRvdmVybGFwU2l6ZS55O1xuICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuQ2hhbmdlLnkgPSAtdGhpcy4keVBvcyAtIHRoaXMuJHR3ZWVuU3RhcnQueTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLiR0d2VlbmluZyA9PSAyKSB7XG4gICAgICAgICAgICAvL3JlLXBvcyB0byBlbnN1cmUgdGhlIHNjcm9sbGluZyB3aWxsIGdvIG9uIHNtb290aFxuICAgICAgICAgICAgaWYgKGRlbHRhUG9zWCAhPSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnggLT0gZGVsdGFQb3NYO1xuICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuU3RhcnQueCAtPSBkZWx0YVBvc1g7XG4gICAgICAgICAgICAgICAgdGhpcy4keFBvcyA9IC10aGlzLiRjb250YWluZXIueDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkZWx0YVBvc1kgIT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci55IC09IGRlbHRhUG9zWTtcbiAgICAgICAgICAgICAgICB0aGlzLiR0d2VlblN0YXJ0LnkgLT0gZGVsdGFQb3NZO1xuICAgICAgICAgICAgICAgIHRoaXMuJHlQb3MgPSAtdGhpcy4kY29udGFpbmVyLnk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy4kaXNEcmFnZ2luZykge1xuICAgICAgICAgICAgaWYgKGRlbHRhUG9zWCAhPSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnggLT0gZGVsdGFQb3NYO1xuICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lclBvcy54IC09IGRlbHRhUG9zWDtcbiAgICAgICAgICAgICAgICB0aGlzLiR4UG9zID0gLXRoaXMuJGNvbnRhaW5lci54O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRlbHRhUG9zWSAhPSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnkgLT0gZGVsdGFQb3NZO1xuICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lclBvcy55IC09IGRlbHRhUG9zWTtcbiAgICAgICAgICAgICAgICB0aGlzLiR5UG9zID0gLXRoaXMuJGNvbnRhaW5lci55O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy9pZiB0aGUgbGFzdCBzY3JvbGwgaXMgQ0xJTkdJTkctU0lERSwgdGhlbiBqdXN0IGNvbnRpbnVlIHRvIGNsaW5nXG4gICAgICAgICAgICBpZiAoZGVsdGFXaWR0aCAhPSAwICYmIGlzUmlnaHRtb3N0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy4keFBvcyA9IHRoaXMuJG92ZXJsYXBTaXplLng7XG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnggPSAtdGhpcy4keFBvcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkZWx0YUhlaWdodCAhPSAwICYmIGlzQm90dG9tKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4keVBvcyA9IHRoaXMuJG92ZXJsYXBTaXplLnk7XG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnkgPSAtdGhpcy4keVBvcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy4kcGFnZU1vZGUpXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVBhZ2VDb250cm9sbGVyKCk7XG4gICAgfVxuICAgIGhhbmRsZVNpemVDaGFuZ2VkKG9uU2Nyb2xsaW5nID0gZmFsc2UpIHtcbiAgICAgICAgaWYgKHRoaXMuJGRpc3BsYXlPbkRlbWFuZCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuJHZ0U2Nyb2xsQmFyKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJGNvbnRlbnRTaXplLnkgPD0gdGhpcy4kdmlld1NpemUueSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuJHZTY3JvbGxOb25lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiR2U2Nyb2xsTm9uZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiR2aWV3U2l6ZS54ICs9IHRoaXMuJHZ0U2Nyb2xsQmFyLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kdlNjcm9sbE5vbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHZTY3JvbGxOb25lID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiR2aWV3U2l6ZS54IC09IHRoaXMuJHZ0U2Nyb2xsQmFyLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuJGh6U2Nyb2xsQmFyKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJGNvbnRlbnRTaXplLnggPD0gdGhpcy4kdmlld1NpemUueCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuJGhTY3JvbGxOb25lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRoU2Nyb2xsTm9uZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiR2aWV3U2l6ZS55ICs9IHRoaXMuJGh6U2Nyb2xsQmFyLmhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJGhTY3JvbGxOb25lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRoU2Nyb2xsTm9uZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kdmlld1NpemUueSAtPSB0aGlzLiRoelNjcm9sbEJhci5oZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuJHZ0U2Nyb2xsQmFyKSB7XG4gICAgICAgICAgICBpZiAodGhpcy4kdmlld1NpemUueSA8IHRoaXMuJHZ0U2Nyb2xsQmFyLm1pblNpemUpXG4gICAgICAgICAgICAgICAgLy91c2UgdGhpcy4kdnRTY3JvbGxCYXIuZGlzcGxheU9iamVjdC52aXNpYmxlIGluc3RlYWQgb2YgdGhpcy4kdnRTY3JvbGxCYXIudmlzaWJsZS4uLiBTY3JvbGxCYXIgYWN0dWFsbHkgaXMgbm90IGluIGl0cyBvd25lcidzIGRpc3BsYXkgdHJlZSwgc28gdnRTY3JvbGxCYXIudmlzaWJsZSB3aWxsIG5vdCB3b3JrXG4gICAgICAgICAgICAgICAgdGhpcy4kdnRTY3JvbGxCYXIuZGlzcGxheU9iamVjdC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLiR2dFNjcm9sbEJhci5kaXNwbGF5T2JqZWN0LnZpc2libGUgPSB0aGlzLiRzY3JvbGxCYXJWaXNpYmxlICYmICF0aGlzLiR2U2Nyb2xsTm9uZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kY29udGVudFNpemUueSA9PSAwKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiR2dFNjcm9sbEJhci5kaXNwbGF5UGVyYyA9IDA7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiR2dFNjcm9sbEJhci5kaXNwbGF5UGVyYyA9IE1hdGgubWluKDEsIHRoaXMuJHZpZXdTaXplLnkgLyB0aGlzLiRjb250ZW50U2l6ZS55KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy4kaHpTY3JvbGxCYXIpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiR2aWV3U2l6ZS54IDwgdGhpcy4kaHpTY3JvbGxCYXIubWluU2l6ZSlcbiAgICAgICAgICAgICAgICB0aGlzLiRoelNjcm9sbEJhci5kaXNwbGF5T2JqZWN0LnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuJGh6U2Nyb2xsQmFyLmRpc3BsYXlPYmplY3QudmlzaWJsZSA9IHRoaXMuJHNjcm9sbEJhclZpc2libGUgJiYgIXRoaXMuJGhTY3JvbGxOb25lO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRjb250ZW50U2l6ZS54ID09IDApXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGh6U2Nyb2xsQmFyLmRpc3BsYXlQZXJjID0gMDtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGh6U2Nyb2xsQmFyLmRpc3BsYXlQZXJjID0gTWF0aC5taW4oMSwgdGhpcy4kdmlld1NpemUueCAvIHRoaXMuJGNvbnRlbnRTaXplLngpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlY3QgPSB0aGlzLiRtYXNrQ29udGFpbmVyLnNjcm9sbFJlY3Q7XG4gICAgICAgIGlmIChyZWN0KSB7XG4gICAgICAgICAgICByZWN0LndpZHRoID0gdGhpcy4kdmlld1NpemUueDtcbiAgICAgICAgICAgIHJlY3QuaGVpZ2h0ID0gdGhpcy4kdmlld1NpemUueTtcbiAgICAgICAgICAgIHRoaXMuJG1hc2tDb250YWluZXIuc2Nyb2xsUmVjdCA9IHJlY3Q7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuJHNjcm9sbFR5cGUgPT0gMCAvKiBIb3Jpem9udGFsICovIHx8IHRoaXMuJHNjcm9sbFR5cGUgPT0gMiAvKiBCb3RoICovKVxuICAgICAgICAgICAgdGhpcy4kb3ZlcmxhcFNpemUueCA9IE1hdGguY2VpbChNYXRoLm1heCgwLCB0aGlzLiRjb250ZW50U2l6ZS54IC0gdGhpcy4kdmlld1NpemUueCkpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLiRvdmVybGFwU2l6ZS54ID0gMDtcbiAgICAgICAgaWYgKHRoaXMuJHNjcm9sbFR5cGUgPT0gMSAvKiBWZXJ0aWNhbCAqLyB8fCB0aGlzLiRzY3JvbGxUeXBlID09IDIgLyogQm90aCAqLylcbiAgICAgICAgICAgIHRoaXMuJG92ZXJsYXBTaXplLnkgPSBNYXRoLmNlaWwoTWF0aC5tYXgoMCwgdGhpcy4kY29udGVudFNpemUueSAtIHRoaXMuJHZpZXdTaXplLnkpKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kb3ZlcmxhcFNpemUueSA9IDA7XG4gICAgICAgIC8vYm91bmRzIGNoZWNraW5nXG4gICAgICAgIHRoaXMuJHhQb3MgPSBOdW1iZXJVdGlsLmNsYW1wKHRoaXMuJHhQb3MsIDAsIHRoaXMuJG92ZXJsYXBTaXplLngpO1xuICAgICAgICB0aGlzLiR5UG9zID0gTnVtYmVyVXRpbC5jbGFtcCh0aGlzLiR5UG9zLCAwLCB0aGlzLiRvdmVybGFwU2l6ZS55KTtcbiAgICAgICAgaWYgKHRoaXMuJHJlZnJlc2hCYXJBeGlzICE9IG51bGwpIHtcbiAgICAgICAgICAgIHZhciBtYXggPSB0aGlzLiRvdmVybGFwU2l6ZVt0aGlzLiRyZWZyZXNoQmFyQXhpc107XG4gICAgICAgICAgICBpZiAobWF4ID09IDApXG4gICAgICAgICAgICAgICAgbWF4ID0gTWF0aC5tYXgodGhpcy4kY29udGVudFNpemVbdGhpcy4kcmVmcmVzaEJhckF4aXNdICtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZm9vdGVyTG9ja2VkU2l6ZSAtXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHZpZXdTaXplW3RoaXMuJHJlZnJlc2hCYXJBeGlzXSwgMCk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgbWF4ICs9IHRoaXMuJGZvb3RlckxvY2tlZFNpemU7XG4gICAgICAgICAgICBpZiAodGhpcy4kcmVmcmVzaEJhckF4aXMgPT0gJ3gnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnNldCh7XG4gICAgICAgICAgICAgICAgICAgIHg6IE51bWJlclV0aWwuY2xhbXAodGhpcy4kY29udGFpbmVyLngsIC1tYXgsIHRoaXMuJGhlYWRlckxvY2tlZFNpemUpLFxuICAgICAgICAgICAgICAgICAgICB5OiBOdW1iZXJVdGlsLmNsYW1wKHRoaXMuJGNvbnRhaW5lci55LCAtdGhpcy4kb3ZlcmxhcFNpemUueSwgMClcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci5zZXQoe1xuICAgICAgICAgICAgICAgICAgICB4OiBOdW1iZXJVdGlsLmNsYW1wKHRoaXMuJGNvbnRhaW5lci54LCAtdGhpcy4kb3ZlcmxhcFNpemUueCwgMCksXG4gICAgICAgICAgICAgICAgICAgIHk6IE51bWJlclV0aWwuY2xhbXAodGhpcy4kY29udGFpbmVyLnksIC1tYXgsIHRoaXMuJGhlYWRlckxvY2tlZFNpemUpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy4kaGVhZGVyICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kcmVmcmVzaEJhckF4aXMgPT0gJ3gnKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRoZWFkZXIuaGVpZ2h0ID0gdGhpcy4kdmlld1NpemUueTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGhlYWRlci53aWR0aCA9IHRoaXMuJHZpZXdTaXplLng7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy4kZm9vdGVyICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kcmVmcmVzaEJhckF4aXMgPT0gJ3knKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRmb290ZXIuaGVpZ2h0ID0gdGhpcy4kdmlld1NpemUueTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGZvb3Rlci53aWR0aCA9IHRoaXMuJHZpZXdTaXplLng7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLiRjb250YWluZXIuc2V0KHtcbiAgICAgICAgICAgICAgICB4OiBOdW1iZXJVdGlsLmNsYW1wKHRoaXMuJGNvbnRhaW5lci54LCAtdGhpcy4kb3ZlcmxhcFNpemUueCwgMCksXG4gICAgICAgICAgICAgICAgeTogTnVtYmVyVXRpbC5jbGFtcCh0aGlzLiRjb250YWluZXIueSwgLXRoaXMuJG92ZXJsYXBTaXplLnksIDApXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN5bmNTY3JvbGxCYXIoKTtcbiAgICAgICAgdGhpcy5jaGVja1JlZnJlc2hCYXIoKTtcbiAgICAgICAgaWYgKHRoaXMuJHBhZ2VNb2RlKVxuICAgICAgICAgICAgdGhpcy51cGRhdGVQYWdlQ29udHJvbGxlcigpO1xuICAgIH1cbiAgICBwb3NDaGFuZ2VkKGFuaSkge1xuICAgICAgICBpZiAodGhpcy4kYW5pRmxhZyA9PSAwKVxuICAgICAgICAgICAgdGhpcy4kYW5pRmxhZyA9IGFuaSA/IDEgOiAtMTtcbiAgICAgICAgZWxzZSBpZiAodGhpcy4kYW5pRmxhZyA9PSAxICYmICFhbmkpXG4gICAgICAgICAgICB0aGlzLiRhbmlGbGFnID0gLTE7XG4gICAgICAgIHRoaXMuJG5lZWRSZWZyZXNoID0gdHJ1ZTtcbiAgICAgICAgR1RpbWVyLmluc3QuY2FsbExhdGVyKHRoaXMucmVmcmVzaCwgdGhpcyk7XG4gICAgfVxuICAgIHJlZnJlc2goKSB7XG4gICAgICAgIHRoaXMuJG5lZWRSZWZyZXNoID0gZmFsc2U7XG4gICAgICAgIEdUaW1lci5pbnN0LnJlbW92ZSh0aGlzLnJlZnJlc2gsIHRoaXMpO1xuICAgICAgICBpZiAodGhpcy4kcGFnZU1vZGUgfHwgdGhpcy4kc25hcFRvSXRlbSkge1xuICAgICAgICAgICAgU2Nyb2xsUGFuZS5zRW5kUG9zLnNldFZhbHVlcygtdGhpcy4keFBvcywgLXRoaXMuJHlQb3MpO1xuICAgICAgICAgICAgdGhpcy5hbGlnblBvc2l0aW9uKFNjcm9sbFBhbmUuc0VuZFBvcywgZmFsc2UpO1xuICAgICAgICAgICAgdGhpcy4keFBvcyA9IC1TY3JvbGxQYW5lLnNFbmRQb3MueDtcbiAgICAgICAgICAgIHRoaXMuJHlQb3MgPSAtU2Nyb2xsUGFuZS5zRW5kUG9zLnk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZWZyZXNoMigpO1xuICAgICAgICBsZXQgZXZ0ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KFwiX19zY3JvbGxcIiAvKiBTQ1JPTEwgKi8sIHRydWUsIGZhbHNlKTtcbiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGV2dCwgdGhpcyk7XG4gICAgICAgIGlmICh0aGlzLiRuZWVkUmVmcmVzaCkge1xuICAgICAgICAgICAgLy9kZXZlbG9wZXIgbWlnaHQgbW9kaWZ5IHBvc2l0aW9uIGluIHRoZSBjYWxsYmFjaywgc28gaGVyZSByZWZyZXNoIGFnYWluIHRvIGF2b2lkIGZsaWNrZXJpbmdcbiAgICAgICAgICAgIHRoaXMuJG5lZWRSZWZyZXNoID0gZmFsc2U7XG4gICAgICAgICAgICBHVGltZXIuaW5zdC5yZW1vdmUodGhpcy5yZWZyZXNoLCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaDIoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN5bmNTY3JvbGxCYXIoKTtcbiAgICAgICAgdGhpcy4kYW5pRmxhZyA9IDA7XG4gICAgfVxuICAgIHJlZnJlc2gyKCkge1xuICAgICAgICBpZiAodGhpcy4kYW5pRmxhZyA9PSAxICYmICF0aGlzLiRpc0RyYWdnaW5nKSB7XG4gICAgICAgICAgICBsZXQgcG9zWDtcbiAgICAgICAgICAgIGxldCBwb3NZO1xuICAgICAgICAgICAgaWYgKHRoaXMuJG92ZXJsYXBTaXplLnggPiAwKVxuICAgICAgICAgICAgICAgIHBvc1ggPSAtTWF0aC5mbG9vcih0aGlzLiR4UG9zKTtcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRjb250YWluZXIueCAhPSAwKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXIueCA9IDA7XG4gICAgICAgICAgICAgICAgcG9zWCA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy4kb3ZlcmxhcFNpemUueSA+IDApXG4gICAgICAgICAgICAgICAgcG9zWSA9IC1NYXRoLmZsb29yKHRoaXMuJHlQb3MpO1xuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJGNvbnRhaW5lci55ICE9IDApXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci55ID0gMDtcbiAgICAgICAgICAgICAgICBwb3NZID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwb3NYICE9IHRoaXMuJGNvbnRhaW5lci54IHx8IHBvc1kgIT0gdGhpcy4kY29udGFpbmVyLnkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiR0d2VlbmluZyA9IDE7XG4gICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5UaW1lLnNldFZhbHVlcygwLCAwKTtcbiAgICAgICAgICAgICAgICB0aGlzLiR0d2VlbkR1cmF0aW9uLnNldFZhbHVlcyhTY3JvbGxQYW5lLlRXRUVOX01BTlVBTExZX1NFVF9EVVJBVElPTiwgU2Nyb2xsUGFuZS5UV0VFTl9NQU5VQUxMWV9TRVRfRFVSQVRJT04pO1xuICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuU3RhcnQuc2V0VmFsdWVzKHRoaXMuJGNvbnRhaW5lci54LCB0aGlzLiRjb250YWluZXIueSk7XG4gICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5DaGFuZ2Uuc2V0VmFsdWVzKHBvc1ggLSB0aGlzLiR0d2VlblN0YXJ0LngsIHBvc1kgLSB0aGlzLiR0d2VlblN0YXJ0LnkpO1xuICAgICAgICAgICAgICAgIEdUaW1lci5pbnN0LmFkZExvb3AoMSwgdGhpcy50d2VlblVwZGF0ZSwgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLiR0d2VlbmluZyAhPSAwKVxuICAgICAgICAgICAgICAgIHRoaXMua2lsbFR3ZWVuKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy4kdHdlZW5pbmcgIT0gMClcbiAgICAgICAgICAgICAgICB0aGlzLmtpbGxUd2VlbigpO1xuICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnNldCh7IHg6IE1hdGguZmxvb3IoLXRoaXMuJHhQb3MpLCB5OiBNYXRoLmZsb29yKC10aGlzLiR5UG9zKSB9KTtcbiAgICAgICAgICAgIHRoaXMubG9vcENoZWNraW5nQ3VycmVudCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLiRwYWdlTW9kZSlcbiAgICAgICAgICAgIHRoaXMudXBkYXRlUGFnZUNvbnRyb2xsZXIoKTtcbiAgICB9XG4gICAgc3luY1Njcm9sbEJhcihlbmQgPSBmYWxzZSkge1xuICAgICAgICBpZiAodGhpcy4kdnRTY3JvbGxCYXIgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy4kdnRTY3JvbGxCYXIuc2Nyb2xsUGVyYyA9XG4gICAgICAgICAgICAgICAgdGhpcy4kb3ZlcmxhcFNpemUueSA9PSAwXG4gICAgICAgICAgICAgICAgICAgID8gMFxuICAgICAgICAgICAgICAgICAgICA6IE51bWJlclV0aWwuY2xhbXAoLXRoaXMuJGNvbnRhaW5lci55LCAwLCB0aGlzLiRvdmVybGFwU2l6ZS55KSAvIHRoaXMuJG92ZXJsYXBTaXplLnk7XG4gICAgICAgICAgICBpZiAodGhpcy4kc2Nyb2xsQmFyRGlzcGxheUF1dG8pXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93U2Nyb2xsQmFyKCFlbmQpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLiRoelNjcm9sbEJhciAhPSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLiRoelNjcm9sbEJhci5zY3JvbGxQZXJjID1cbiAgICAgICAgICAgICAgICB0aGlzLiRvdmVybGFwU2l6ZS54ID09IDBcbiAgICAgICAgICAgICAgICAgICAgPyAwXG4gICAgICAgICAgICAgICAgICAgIDogTnVtYmVyVXRpbC5jbGFtcCgtdGhpcy4kY29udGFpbmVyLngsIDAsIHRoaXMuJG92ZXJsYXBTaXplLngpIC8gdGhpcy4kb3ZlcmxhcFNpemUueDtcbiAgICAgICAgICAgIGlmICh0aGlzLiRzY3JvbGxCYXJEaXNwbGF5QXV0bylcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dTY3JvbGxCYXIoIWVuZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVuZClcbiAgICAgICAgICAgIHRoaXMuJG1hc2tDb250YWluZXIubW91c2VFbmFibGVkID0gdHJ1ZTtcbiAgICB9XG4gICAgJG1vdXNlRG93bihlKSB7XG4gICAgICAgIGlmICghdGhpcy4kdG91Y2hFZmZlY3QpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmICh0aGlzLiR0d2VlbmluZyAhPSAwKSB7XG4gICAgICAgICAgICB0aGlzLmtpbGxUd2VlbigpO1xuICAgICAgICAgICAgdGhpcy4kaXNEcmFnZ2luZyA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kaXNEcmFnZ2luZyA9IGZhbHNlO1xuICAgICAgICBjb25zdCBnbG9iYWxNb3VzZSA9IGlzTW9iaWxlLmFueVxuICAgICAgICAgICAgPyB0aGlzLiRvd25lci5nbG9iYWxUb0xvY2FsKGUubG9jYWxYLCBlLmxvY2FsWSlcbiAgICAgICAgICAgIDogdGhpcy4kb3duZXIuZ2xvYmFsVG9Mb2NhbChEZWNscyQxLkdSb290Lmdsb2JhbE1vdXNlU3RhdHVzLm1vdXNlWCwgRGVjbHMkMS5HUm9vdC5nbG9iYWxNb3VzZVN0YXR1cy5tb3VzZVksIFNjcm9sbFBhbmUuc0hlbHBlclBvaW50KTtcbiAgICAgICAgdGhpcy4kY29udGFpbmVyUG9zLnNldFZhbHVlcyh0aGlzLiRjb250YWluZXIueCwgdGhpcy4kY29udGFpbmVyLnkpO1xuICAgICAgICB0aGlzLiRiZWdpblRvdWNoUG9zLmNvcHkoZ2xvYmFsTW91c2UpO1xuICAgICAgICB0aGlzLiRsYXN0VG91Y2hQb3MuY29weShnbG9iYWxNb3VzZSk7XG4gICAgICAgIHRoaXMuJGxhc3RUb3VjaEdsb2JhbFBvcy5jb3B5KGdsb2JhbE1vdXNlKTtcbiAgICAgICAgdGhpcy4kaXNIb2xkQXJlYURvbmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy4kdmVsb2NpdHkuc2V0VmFsdWVzKDAsIDApO1xuICAgICAgICB0aGlzLiR2ZWxvY2l0eVNjYWxlID0gMTtcbiAgICAgICAgdGhpcy4kbGFzdE1vdmVUaW1lID0gR1RpbWVyLmluc3QuY3VyVGltZSAvIDEwMDA7XG4gICAgICAgIHRoaXMuJG1vdXNlTW92ZUV2ZW50ID0gRGVjbHMkMS5HUm9vdC5pbnN0Lm5hdGl2ZVN0YWdlLm9uKEludGVyYWN0aXZlRXZlbnRzLk1vdmUsIHRoaXMuJG1vdXNlTW92ZSwgdGhpcyk7XG4gICAgICAgIHRoaXMuJG1vdXNlVXBFdmVudCA9IERlY2xzJDEuR1Jvb3QuaW5zdC5uYXRpdmVTdGFnZS5vbihJbnRlcmFjdGl2ZUV2ZW50cy5VcCwgdGhpcy4kbW91c2VVcCwgdGhpcyk7XG4gICAgICAgIHRoaXMuJGNsaWNrRXZlbnQgPSBEZWNscyQxLkdSb290Lmluc3QubmF0aXZlU3RhZ2Uub24oSW50ZXJhY3RpdmVFdmVudHMuQ2xpY2ssIHRoaXMuJGNsaWNrLCB0aGlzKTtcbiAgICB9XG4gICAgJG1vdXNlTW92ZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLiR0b3VjaEVmZmVjdClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKChTY3JvbGxQYW5lLmRyYWdnaW5nUGFuZSAhPSBudWxsICYmIFNjcm9sbFBhbmUuZHJhZ2dpbmdQYW5lICE9IHRoaXMpIHx8XG4gICAgICAgICAgICBHT2JqZWN0LmRyYWdnaW5nT2JqZWN0ICE9IG51bGwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGxldCBzZW5zaXRpdml0eSA9IFVJQ29uZmlnLnRvdWNoU2Nyb2xsU2Vuc2l0aXZpdHk7XG4gICAgICAgIGNvbnN0IGdsb2JhbE1vdXNlID0gdGhpcy4kb3duZXIuZ2xvYmFsVG9Mb2NhbChEZWNscyQxLkdSb290Lmdsb2JhbE1vdXNlU3RhdHVzLm1vdXNlWCwgRGVjbHMkMS5HUm9vdC5nbG9iYWxNb3VzZVN0YXR1cy5tb3VzZVksIFNjcm9sbFBhbmUuc0hlbHBlclBvaW50KTtcbiAgICAgICAgbGV0IGRpZmYsIGRpZmYyO1xuICAgICAgICBsZXQgc3YsIHNoO1xuICAgICAgICBpZiAodGhpcy4kc2Nyb2xsVHlwZSA9PSAxIC8qIFZlcnRpY2FsICovKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuJGlzSG9sZEFyZWFEb25lKSB7XG4gICAgICAgICAgICAgICAgLy9nZXN0dXJlIG9uIHZlcnRpY2FsIGRpciBpcyBiZWluZyBvYnNlcnZlZFxuICAgICAgICAgICAgICAgIFNjcm9sbFBhbmUuJGdlc3R1cmVGbGFnIHw9IDE7XG4gICAgICAgICAgICAgICAgZGlmZiA9IE1hdGguYWJzKHRoaXMuJGJlZ2luVG91Y2hQb3MueSAtIGdsb2JhbE1vdXNlLnkpO1xuICAgICAgICAgICAgICAgIGlmIChkaWZmIDwgc2Vuc2l0aXZpdHkpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBpZiAoKFNjcm9sbFBhbmUuJGdlc3R1cmVGbGFnICYgMikgIT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBkaWZmMiA9IE1hdGguYWJzKHRoaXMuJGJlZ2luVG91Y2hQb3MueCAtIGdsb2JhbE1vdXNlLngpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGlmZiA8IGRpZmYyKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN2ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLiRzY3JvbGxUeXBlID09IDAgLyogSG9yaXpvbnRhbCAqLykge1xuICAgICAgICAgICAgaWYgKCF0aGlzLiRpc0hvbGRBcmVhRG9uZSkge1xuICAgICAgICAgICAgICAgIFNjcm9sbFBhbmUuJGdlc3R1cmVGbGFnIHw9IDI7IC8vZ2VzdHVyZSBvbiBob3J6IGRpciBpcyBiZWluZyBvYnNlcnZlZFxuICAgICAgICAgICAgICAgIGRpZmYgPSBNYXRoLmFicyh0aGlzLiRiZWdpblRvdWNoUG9zLnggLSBnbG9iYWxNb3VzZS54KTtcbiAgICAgICAgICAgICAgICBpZiAoZGlmZiA8IHNlbnNpdGl2aXR5KVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgaWYgKChTY3JvbGxQYW5lLiRnZXN0dXJlRmxhZyAmIDEpICE9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZGlmZjIgPSBNYXRoLmFicyh0aGlzLiRiZWdpblRvdWNoUG9zLnkgLSBnbG9iYWxNb3VzZS55KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpZmYgPCBkaWZmMilcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzaCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBTY3JvbGxQYW5lLiRnZXN0dXJlRmxhZyA9IDM7IC8vYm90aFxuICAgICAgICAgICAgaWYgKCF0aGlzLiRpc0hvbGRBcmVhRG9uZSkge1xuICAgICAgICAgICAgICAgIGRpZmYgPSBNYXRoLmFicyh0aGlzLiRiZWdpblRvdWNoUG9zLnkgLSBnbG9iYWxNb3VzZS55KTtcbiAgICAgICAgICAgICAgICBpZiAoZGlmZiA8IHNlbnNpdGl2aXR5KSB7XG4gICAgICAgICAgICAgICAgICAgIGRpZmYgPSBNYXRoLmFicyh0aGlzLiRiZWdpblRvdWNoUG9zLnggLSBnbG9iYWxNb3VzZS54KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpZmYgPCBzZW5zaXRpdml0eSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzdiA9IHNoID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgbmV3UG9zWCA9IE1hdGguZmxvb3IodGhpcy4kY29udGFpbmVyUG9zLnggKyBnbG9iYWxNb3VzZS54IC0gdGhpcy4kYmVnaW5Ub3VjaFBvcy54KTtcbiAgICAgICAgbGV0IG5ld1Bvc1kgPSBNYXRoLmZsb29yKHRoaXMuJGNvbnRhaW5lclBvcy55ICsgZ2xvYmFsTW91c2UueSAtIHRoaXMuJGJlZ2luVG91Y2hQb3MueSk7XG4gICAgICAgIGlmIChzdikge1xuICAgICAgICAgICAgaWYgKG5ld1Bvc1kgPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLiRib3VuY2ViYWNrRWZmZWN0KVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXIueSA9IDA7XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy4kaGVhZGVyICE9IG51bGwgJiYgdGhpcy4kaGVhZGVyLmhlaWdodCAhPSAwKVxuICAgICAgICAgICAgICAgICAgICAvL1RPRE86IGhlaWdodCAtPiBtYXhIZWlnaHRcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnkgPSBNYXRoLmZsb29yKE1hdGgubWluKG5ld1Bvc1kgKiAwLjUsIHRoaXMuJGhlYWRlci5oZWlnaHQpKTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci55ID0gTWF0aC5mbG9vcihNYXRoLm1pbihuZXdQb3NZICogMC41LCB0aGlzLiR2aWV3U2l6ZS55ICogU2Nyb2xsUGFuZS5QVUxMX0RJU1RfUkFUSU8pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG5ld1Bvc1kgPCAtdGhpcy4kb3ZlcmxhcFNpemUueSkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy4kYm91bmNlYmFja0VmZmVjdClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnkgPSAtdGhpcy4kb3ZlcmxhcFNpemUueTtcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLiRmb290ZXIgIT0gbnVsbCAmJiB0aGlzLiRmb290ZXIuaGVpZ2h0ID4gMClcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPOiBoZWlnaHQgLT4gbWF4SGVpZ2h0XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci55ID0gTWF0aC5mbG9vcihNYXRoLm1heCgobmV3UG9zWSArIHRoaXMuJG92ZXJsYXBTaXplLnkpICogMC41LCAtdGhpcy4kZm9vdGVyLmhlaWdodCkgLVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kb3ZlcmxhcFNpemUueSk7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXIueSA9IE1hdGguZmxvb3IoTWF0aC5tYXgoKG5ld1Bvc1kgKyB0aGlzLiRvdmVybGFwU2l6ZS55KSAqIDAuNSwgLXRoaXMuJHZpZXdTaXplLnkgKiBTY3JvbGxQYW5lLlBVTExfRElTVF9SQVRJTykgLSB0aGlzLiRvdmVybGFwU2l6ZS55KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXIueSA9IG5ld1Bvc1k7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNoKSB7XG4gICAgICAgICAgICBpZiAobmV3UG9zWCA+IDApIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuJGJvdW5jZWJhY2tFZmZlY3QpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci54ID0gMDtcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLiRoZWFkZXIgIT0gbnVsbCAmJiB0aGlzLiRoZWFkZXIud2lkdGggIT0gMClcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPOiB3aWR0aCAtPiBtYXhXaWR0aFxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXIueCA9IE1hdGguZmxvb3IoTWF0aC5taW4obmV3UG9zWCAqIDAuNSwgdGhpcy4kaGVhZGVyLndpZHRoKSk7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXIueCA9IE1hdGguZmxvb3IoTWF0aC5taW4obmV3UG9zWCAqIDAuNSwgdGhpcy4kdmlld1NpemUueCAqIFNjcm9sbFBhbmUuUFVMTF9ESVNUX1JBVElPKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChuZXdQb3NYIDwgMCAtIHRoaXMuJG92ZXJsYXBTaXplLngpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuJGJvdW5jZWJhY2tFZmZlY3QpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci54ID0gLXRoaXMuJG92ZXJsYXBTaXplLng7XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy4kZm9vdGVyICE9IG51bGwgJiYgdGhpcy4kZm9vdGVyLndpZHRoID4gMClcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPOiB3aWR0aCAtPiBtYXhXaWR0aFxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXIueCA9IE1hdGguZmxvb3IoTWF0aC5tYXgoKG5ld1Bvc1ggKyB0aGlzLiRvdmVybGFwU2l6ZS54KSAqIDAuNSwgLXRoaXMuJGZvb3Rlci53aWR0aCkgLVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kb3ZlcmxhcFNpemUueCk7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXIueCA9IE1hdGguZmxvb3IoTWF0aC5tYXgoKG5ld1Bvc1ggKyB0aGlzLiRvdmVybGFwU2l6ZS54KSAqIDAuNSwgLXRoaXMuJHZpZXdTaXplLnggKiBTY3JvbGxQYW5lLlBVTExfRElTVF9SQVRJTykgLSB0aGlzLiRvdmVybGFwU2l6ZS54KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXIueCA9IG5ld1Bvc1g7XG4gICAgICAgIH1cbiAgICAgICAgLy91cGRhdGUgYWNjZWxlcmF0aW9uXG4gICAgICAgIGNvbnN0IGZyYW1lUmF0ZSA9IGNyZWF0ZWpzLlRpY2tlci5mcmFtZXJhdGU7XG4gICAgICAgIGNvbnN0IG5vdyA9IEdUaW1lci5pbnN0LmN1clRpbWUgLyAxMDAwO1xuICAgICAgICBjb25zdCBkZWx0YVRpbWUgPSBNYXRoLm1heChub3cgLSB0aGlzLiRsYXN0TW92ZVRpbWUsIDEgLyBmcmFtZVJhdGUpO1xuICAgICAgICBsZXQgZGVsdGFQb3NpdGlvblggPSBnbG9iYWxNb3VzZS54IC0gdGhpcy4kbGFzdFRvdWNoUG9zLng7XG4gICAgICAgIGxldCBkZWx0YVBvc2l0aW9uWSA9IGdsb2JhbE1vdXNlLnkgLSB0aGlzLiRsYXN0VG91Y2hQb3MueTtcbiAgICAgICAgaWYgKCFzaClcbiAgICAgICAgICAgIGRlbHRhUG9zaXRpb25YID0gMDtcbiAgICAgICAgaWYgKCFzdilcbiAgICAgICAgICAgIGRlbHRhUG9zaXRpb25ZID0gMDtcbiAgICAgICAgaWYgKGRlbHRhVGltZSAhPSAwKSB7XG4gICAgICAgICAgICBjb25zdCBlbGFwc2VkID0gZGVsdGFUaW1lICogZnJhbWVSYXRlIC0gMTtcbiAgICAgICAgICAgIGlmIChlbGFwc2VkID4gMSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZhY3RvciA9IE1hdGgucG93KDAuODMzLCBlbGFwc2VkKTtcbiAgICAgICAgICAgICAgICB0aGlzLiR2ZWxvY2l0eS54ID0gdGhpcy4kdmVsb2NpdHkueCAqIGZhY3RvcjtcbiAgICAgICAgICAgICAgICB0aGlzLiR2ZWxvY2l0eS55ID0gdGhpcy4kdmVsb2NpdHkueSAqIGZhY3RvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuJHZlbG9jaXR5LnggPSBOdW1iZXJVdGlsLmxlcnAodGhpcy4kdmVsb2NpdHkueCwgKGRlbHRhUG9zaXRpb25YICogNjApIC8gZnJhbWVSYXRlIC8gZGVsdGFUaW1lLCBkZWx0YVRpbWUgKiAxMCk7XG4gICAgICAgICAgICB0aGlzLiR2ZWxvY2l0eS55ID0gTnVtYmVyVXRpbC5sZXJwKHRoaXMuJHZlbG9jaXR5LnksIChkZWx0YVBvc2l0aW9uWSAqIDYwKSAvIGZyYW1lUmF0ZSAvIGRlbHRhVGltZSwgZGVsdGFUaW1lICogMTApO1xuICAgICAgICB9XG4gICAgICAgIC8vaW4gdGhlIGluZXJ0aWEgc2Nyb2xsaW5nIHdlIG5lZWQgdGhlIG9mZnNldCB2YWx1ZSB0byBzY3JlZW4gc3BhY2UsIHNvIGhlcmUgd2UgbmVlZCB0byByZW9jcmQgdGhlIG9mZnNldCByYXRpb1xuICAgICAgICBjb25zdCBkZWx0YUdsb2JhbFBvc2l0aW9uWCA9IHRoaXMuJGxhc3RUb3VjaEdsb2JhbFBvcy54IC0gZ2xvYmFsTW91c2UueDtcbiAgICAgICAgY29uc3QgZGVsdGFHbG9iYWxQb3NpdGlvblkgPSB0aGlzLiRsYXN0VG91Y2hHbG9iYWxQb3MueSAtIGdsb2JhbE1vdXNlLnk7XG4gICAgICAgIGlmIChkZWx0YVBvc2l0aW9uWCAhPSAwKVxuICAgICAgICAgICAgdGhpcy4kdmVsb2NpdHlTY2FsZSA9IE1hdGguYWJzKGRlbHRhR2xvYmFsUG9zaXRpb25YIC8gZGVsdGFQb3NpdGlvblgpO1xuICAgICAgICBlbHNlIGlmIChkZWx0YVBvc2l0aW9uWSAhPSAwKVxuICAgICAgICAgICAgdGhpcy4kdmVsb2NpdHlTY2FsZSA9IE1hdGguYWJzKGRlbHRhR2xvYmFsUG9zaXRpb25ZIC8gZGVsdGFQb3NpdGlvblkpO1xuICAgICAgICB0aGlzLiRsYXN0VG91Y2hQb3MuY29weShnbG9iYWxNb3VzZSk7XG4gICAgICAgIHRoaXMuJGxhc3RUb3VjaEdsb2JhbFBvcy5jb3B5KGdsb2JhbE1vdXNlKTtcbiAgICAgICAgdGhpcy4kbGFzdE1vdmVUaW1lID0gbm93O1xuICAgICAgICAvL3VwZGF0ZSBwb3NpdGlvblxuICAgICAgICBpZiAodGhpcy4kb3ZlcmxhcFNpemUueCA+IDApXG4gICAgICAgICAgICB0aGlzLiR4UG9zID0gTnVtYmVyVXRpbC5jbGFtcCgtdGhpcy4kY29udGFpbmVyLngsIDAsIHRoaXMuJG92ZXJsYXBTaXplLngpO1xuICAgICAgICBpZiAodGhpcy4kb3ZlcmxhcFNpemUueSA+IDApXG4gICAgICAgICAgICB0aGlzLiR5UG9zID0gTnVtYmVyVXRpbC5jbGFtcCgtdGhpcy4kY29udGFpbmVyLnksIDAsIHRoaXMuJG92ZXJsYXBTaXplLnkpO1xuICAgICAgICBpZiAodGhpcy4kbG9vcCAhPSAwKSB7XG4gICAgICAgICAgICBuZXdQb3NYID0gdGhpcy4kY29udGFpbmVyLng7XG4gICAgICAgICAgICBuZXdQb3NZID0gdGhpcy4kY29udGFpbmVyLnk7XG4gICAgICAgICAgICBpZiAodGhpcy5sb29wQ2hlY2tpbmdDdXJyZW50KCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXJQb3MueCArPSB0aGlzLiRjb250YWluZXIueCAtIG5ld1Bvc1g7XG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyUG9zLnkgKz0gdGhpcy4kY29udGFpbmVyLnkgLSBuZXdQb3NZO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFNjcm9sbFBhbmUuZHJhZ2dpbmdQYW5lID0gdGhpcztcbiAgICAgICAgdGhpcy4kaXNIb2xkQXJlYURvbmUgPSB0cnVlO1xuICAgICAgICB0aGlzLiRpc0RyYWdnaW5nID0gdHJ1ZTtcbiAgICAgICAgLy8gdGhpcy4kbWFza0NvbnRhaW5lci5pbnRlcmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnN5bmNTY3JvbGxCYXIoKTtcbiAgICAgICAgdGhpcy5jaGVja1JlZnJlc2hCYXIoKTtcbiAgICAgICAgaWYgKHRoaXMuJHBhZ2VNb2RlKVxuICAgICAgICAgICAgdGhpcy51cGRhdGVQYWdlQ29udHJvbGxlcigpO1xuICAgICAgICBsZXQgZXZ0ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KFwiX19zY3JvbGxcIiAvKiBTQ1JPTEwgKi8sIHRydWUsIGZhbHNlKTtcbiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGV2dCwgdGhpcyk7XG4gICAgfVxuICAgICRtb3VzZVVwKCkge1xuICAgICAgICBEZWNscyQxLkdSb290Lmluc3QubmF0aXZlU3RhZ2Uub2ZmKEludGVyYWN0aXZlRXZlbnRzLk1vdmUsIHRoaXMuJG1vdXNlTW92ZUV2ZW50KTtcbiAgICAgICAgRGVjbHMkMS5HUm9vdC5pbnN0Lm5hdGl2ZVN0YWdlLm9mZihJbnRlcmFjdGl2ZUV2ZW50cy5VcCwgdGhpcy4kbW91c2VNb3ZlRXZlbnQpO1xuICAgICAgICBEZWNscyQxLkdSb290Lmluc3QubmF0aXZlU3RhZ2Uub2ZmKEludGVyYWN0aXZlRXZlbnRzLkNsaWNrLCB0aGlzLiRjbGlja0V2ZW50KTtcbiAgICAgICAgaWYgKFNjcm9sbFBhbmUuZHJhZ2dpbmdQYW5lID09IHRoaXMpXG4gICAgICAgICAgICBTY3JvbGxQYW5lLmRyYWdnaW5nUGFuZSA9IG51bGw7XG4gICAgICAgIFNjcm9sbFBhbmUuJGdlc3R1cmVGbGFnID0gMDtcbiAgICAgICAgaWYgKCF0aGlzLiRpc0RyYWdnaW5nIHx8ICF0aGlzLiR0b3VjaEVmZmVjdCkge1xuICAgICAgICAgICAgdGhpcy4kaXNEcmFnZ2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy4kbWFza0NvbnRhaW5lci5tb3VzZUVuYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuJGlzRHJhZ2dpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy4kbWFza0NvbnRhaW5lci5tb3VzZUVuYWJsZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLiR0d2VlblN0YXJ0LnNldFZhbHVlcyh0aGlzLiRjb250YWluZXIueCwgdGhpcy4kY29udGFpbmVyLnkpO1xuICAgICAgICBTY3JvbGxQYW5lLnNFbmRQb3Muc2V0VmFsdWVzKHRoaXMuJHR3ZWVuU3RhcnQueCwgdGhpcy4kdHdlZW5TdGFydC55KTtcbiAgICAgICAgbGV0IGZsYWcgPSBmYWxzZTtcbiAgICAgICAgaWYgKHRoaXMuJGNvbnRhaW5lci54ID4gMCkge1xuICAgICAgICAgICAgU2Nyb2xsUGFuZS5zRW5kUG9zLnggPSAwO1xuICAgICAgICAgICAgZmxhZyA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy4kY29udGFpbmVyLnggPCAtdGhpcy4kb3ZlcmxhcFNpemUueCkge1xuICAgICAgICAgICAgU2Nyb2xsUGFuZS5zRW5kUG9zLnggPSAtdGhpcy4kb3ZlcmxhcFNpemUueDtcbiAgICAgICAgICAgIGZsYWcgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLiRjb250YWluZXIueSA+IDApIHtcbiAgICAgICAgICAgIFNjcm9sbFBhbmUuc0VuZFBvcy55ID0gMDtcbiAgICAgICAgICAgIGZsYWcgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuJGNvbnRhaW5lci55IDwgLXRoaXMuJG92ZXJsYXBTaXplLnkpIHtcbiAgICAgICAgICAgIFNjcm9sbFBhbmUuc0VuZFBvcy55ID0gLXRoaXMuJG92ZXJsYXBTaXplLnk7XG4gICAgICAgICAgICBmbGFnID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZmxhZykge1xuICAgICAgICAgICAgdGhpcy4kdHdlZW5DaGFuZ2Uuc2V0VmFsdWVzKFNjcm9sbFBhbmUuc0VuZFBvcy54IC0gdGhpcy4kdHdlZW5TdGFydC54LCBTY3JvbGxQYW5lLnNFbmRQb3MueSAtIHRoaXMuJHR3ZWVuU3RhcnQueSk7XG4gICAgICAgICAgICBpZiAodGhpcy4kdHdlZW5DaGFuZ2UueCA8IC1VSUNvbmZpZy50b3VjaERyYWdTZW5zaXRpdml0eSB8fFxuICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuQ2hhbmdlLnkgPCAtVUlDb25maWcudG91Y2hEcmFnU2Vuc2l0aXZpdHkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRyZWZyZXNoRXZlbnREaXNwYXRjaGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgbGV0IGV2dCA9IG5ldyBjcmVhdGVqcy5FdmVudChcIl9fcHVsbERvd25SZWxlYXNlXCIgLyogUFVMTF9ET1dOX1JFTEVBU0UgKi8sIHRydWUsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZXZ0LCB0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLiRyZWZyZXNoRXZlbnREaXNwYXRjaGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy4kdHdlZW5DaGFuZ2UueCA+IFVJQ29uZmlnLnRvdWNoRHJhZ1NlbnNpdGl2aXR5IHx8XG4gICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5DaGFuZ2UueSA+IFVJQ29uZmlnLnRvdWNoRHJhZ1NlbnNpdGl2aXR5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kcmVmcmVzaEV2ZW50RGlzcGF0Y2hpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGxldCBldnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoXCJfX3B1bGxVcFJlbGVhc2VcIiAvKiBQVUxMX1VQX1JFTEVBU0UgKi8sIHRydWUsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZXZ0LCB0aGlzKTtcbiAgICAgICAgICAgICAgICB0aGlzLiRyZWZyZXNoRXZlbnREaXNwYXRjaGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuJGhlYWRlckxvY2tlZFNpemUgPiAwICYmXG4gICAgICAgICAgICAgICAgU2Nyb2xsUGFuZS5zRW5kUG9zW3RoaXMuJHJlZnJlc2hCYXJBeGlzXSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgU2Nyb2xsUGFuZS5zRW5kUG9zW3RoaXMuJHJlZnJlc2hCYXJBeGlzXSA9IHRoaXMuJGhlYWRlckxvY2tlZFNpemU7XG4gICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5DaGFuZ2UueCA9IFNjcm9sbFBhbmUuc0VuZFBvcy54IC0gdGhpcy4kdHdlZW5TdGFydC54O1xuICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuQ2hhbmdlLnkgPSBTY3JvbGxQYW5lLnNFbmRQb3MueSAtIHRoaXMuJHR3ZWVuU3RhcnQueTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuJGZvb3RlckxvY2tlZFNpemUgPiAwICYmXG4gICAgICAgICAgICAgICAgU2Nyb2xsUGFuZS5zRW5kUG9zW3RoaXMuJHJlZnJlc2hCYXJBeGlzXSA9PVxuICAgICAgICAgICAgICAgICAgICAtdGhpcy4kb3ZlcmxhcFNpemVbdGhpcy4kcmVmcmVzaEJhckF4aXNdKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1heCA9IHRoaXMuJG92ZXJsYXBTaXplW3RoaXMuJHJlZnJlc2hCYXJBeGlzXTtcbiAgICAgICAgICAgICAgICBpZiAobWF4ID09IDApXG4gICAgICAgICAgICAgICAgICAgIG1heCA9IE1hdGgubWF4KHRoaXMuJGNvbnRlbnRTaXplW3RoaXMuJHJlZnJlc2hCYXJBeGlzXSArXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRmb290ZXJMb2NrZWRTaXplIC1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHZpZXdTaXplW3RoaXMuJHJlZnJlc2hCYXJBeGlzXSwgMCk7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBtYXggKz0gdGhpcy4kZm9vdGVyTG9ja2VkU2l6ZTtcbiAgICAgICAgICAgICAgICBTY3JvbGxQYW5lLnNFbmRQb3NbdGhpcy4kcmVmcmVzaEJhckF4aXNdID0gLW1heDtcbiAgICAgICAgICAgICAgICB0aGlzLiR0d2VlbkNoYW5nZS54ID0gU2Nyb2xsUGFuZS5zRW5kUG9zLnggLSB0aGlzLiR0d2VlblN0YXJ0Lng7XG4gICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5DaGFuZ2UueSA9IFNjcm9sbFBhbmUuc0VuZFBvcy55IC0gdGhpcy4kdHdlZW5TdGFydC55O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy4kdHdlZW5EdXJhdGlvbi5zZXRWYWx1ZXMoU2Nyb2xsUGFuZS5UV0VFTl9ERUZBVUxUX0RVUkFUSU9OLCBTY3JvbGxQYW5lLlRXRUVOX0RFRkFVTFRfRFVSQVRJT04pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKCF0aGlzLiRpbmVydGlhRGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBmcmFtZVJhdGUgPSBjcmVhdGVqcy5UaWNrZXIuZnJhbWVyYXRlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGVsYXBzZWQgPSAoR1RpbWVyLmluc3QuY3VyVGltZSAvIDEwMDAgLSB0aGlzLiRsYXN0TW92ZVRpbWUpICogZnJhbWVSYXRlIC0gMTtcbiAgICAgICAgICAgICAgICBpZiAoZWxhcHNlZCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmFjdG9yID0gTWF0aC5wb3coMC44MzMsIGVsYXBzZWQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiR2ZWxvY2l0eS54ID0gdGhpcy4kdmVsb2NpdHkueCAqIGZhY3RvcjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kdmVsb2NpdHkueSA9IHRoaXMuJHZlbG9jaXR5LnkgKiBmYWN0b3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vY2FsYyBkaXN0ICYgZHVyYXRpb24gYnkgc3BlZWRcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVRhcmdldEFuZER1cmF0aW9uKHRoaXMuJHR3ZWVuU3RhcnQsIFNjcm9sbFBhbmUuc0VuZFBvcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5EdXJhdGlvbi5zZXRWYWx1ZXMoU2Nyb2xsUGFuZS5UV0VFTl9ERUZBVUxUX0RVUkFUSU9OLCBTY3JvbGxQYW5lLlRXRUVOX0RFRkFVTFRfRFVSQVRJT04pO1xuICAgICAgICAgICAgU2Nyb2xsUGFuZS5zT2xkQ2hhbmdlLnNldFZhbHVlcyhTY3JvbGxQYW5lLnNFbmRQb3MueCAtIHRoaXMuJHR3ZWVuU3RhcnQueCwgU2Nyb2xsUGFuZS5zRW5kUG9zLnkgLSB0aGlzLiR0d2VlblN0YXJ0LnkpO1xuICAgICAgICAgICAgLy9hZGp1c3RcbiAgICAgICAgICAgIHRoaXMubG9vcENoZWNraW5nVGFyZ2V0KFNjcm9sbFBhbmUuc0VuZFBvcyk7XG4gICAgICAgICAgICBpZiAodGhpcy4kcGFnZU1vZGUgfHwgdGhpcy4kc25hcFRvSXRlbSlcbiAgICAgICAgICAgICAgICB0aGlzLmFsaWduUG9zaXRpb24oU2Nyb2xsUGFuZS5zRW5kUG9zLCB0cnVlKTtcbiAgICAgICAgICAgIHRoaXMuJHR3ZWVuQ2hhbmdlLnggPSBTY3JvbGxQYW5lLnNFbmRQb3MueCAtIHRoaXMuJHR3ZWVuU3RhcnQueDtcbiAgICAgICAgICAgIHRoaXMuJHR3ZWVuQ2hhbmdlLnkgPSBTY3JvbGxQYW5lLnNFbmRQb3MueSAtIHRoaXMuJHR3ZWVuU3RhcnQueTtcbiAgICAgICAgICAgIGlmICh0aGlzLiR0d2VlbkNoYW5nZS54ID09IDAgJiYgdGhpcy4kdHdlZW5DaGFuZ2UueSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJHNjcm9sbEJhckRpc3BsYXlBdXRvKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dTY3JvbGxCYXIoZmFsc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLiRwYWdlTW9kZSB8fCB0aGlzLiRzbmFwVG9JdGVtKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maXhEdXJhdGlvbigneCcsIFNjcm9sbFBhbmUuc09sZENoYW5nZS54KTtcbiAgICAgICAgICAgICAgICB0aGlzLmZpeER1cmF0aW9uKCd5JywgU2Nyb2xsUGFuZS5zT2xkQ2hhbmdlLnkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuJHR3ZWVuaW5nID0gMjtcbiAgICAgICAgdGhpcy4kdHdlZW5UaW1lLnNldFZhbHVlcygwLCAwKTtcbiAgICAgICAgR1RpbWVyLmluc3QuYWRkTG9vcCgxLCB0aGlzLnR3ZWVuVXBkYXRlLCB0aGlzKTtcbiAgICB9XG4gICAgJGNsaWNrKCkge1xuICAgICAgICB0aGlzLiRpc0RyYWdnaW5nID0gZmFsc2U7XG4gICAgfVxuICAgICRtb3VzZVdoZWVsKGV2dCkge1xuICAgICAgICBsZXQgZXZlbnQgPSBldnQuZGF0YS5ldmVudDtcbiAgICAgICAgaWYgKCF0aGlzLiRtb3VzZVdoZWVsRW5hYmxlZClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgZGVsdGEgPSBldmVudC5kZWx0YSA+IDAgPyAtMSA6IGV2ZW50LmRlbHRhIDwgMCA/IDEgOiAwO1xuICAgICAgICBpZiAodGhpcy4kb3ZlcmxhcFNpemUueCA+IDAgJiYgdGhpcy4kb3ZlcmxhcFNpemUueSA9PSAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy4kcGFnZU1vZGUpXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRQb3NYKHRoaXMuJHhQb3MgKyB0aGlzLiRwYWdlU2l6ZS54ICogZGVsdGEsIGZhbHNlKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB0aGlzLnNldFBvc1godGhpcy4keFBvcyArIHRoaXMuJG1vdXNlV2hlZWxTcGVlZCAqIGRlbHRhLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy4kcGFnZU1vZGUpXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRQb3NZKHRoaXMuJHlQb3MgKyB0aGlzLiRwYWdlU2l6ZS55ICogZGVsdGEsIGZhbHNlKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB0aGlzLnNldFBvc1kodGhpcy4keVBvcyArIHRoaXMuJG1vdXNlV2hlZWxTcGVlZCAqIGRlbHRhLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgJHJvbGxPdmVyKCkge1xuICAgICAgICB0aGlzLnNob3dTY3JvbGxCYXIodHJ1ZSk7XG4gICAgfVxuICAgICRyb2xsT3V0KCkge1xuICAgICAgICB0aGlzLnNob3dTY3JvbGxCYXIoZmFsc2UpO1xuICAgIH1cbiAgICBzaG93U2Nyb2xsQmFyKHZpc2libGUpIHtcbiAgICAgICAgaWYgKHZpc2libGUpIHtcbiAgICAgICAgICAgIEdUaW1lci5pbnN0LnJlbW92ZSh0aGlzLnNldFNjcm9sbEJhclZpc2libGUsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5zZXRTY3JvbGxCYXJWaXNpYmxlKHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEdUaW1lci5pbnN0LmFkZCg1MDAsIDEsIHRoaXMuc2V0U2Nyb2xsQmFyVmlzaWJsZSwgdGhpcywgdmlzaWJsZSk7XG4gICAgfVxuICAgIHNldFNjcm9sbEJhclZpc2libGUodmlzaWJsZSkge1xuICAgICAgICB0aGlzLiRzY3JvbGxCYXJWaXNpYmxlID0gdmlzaWJsZSAmJiB0aGlzLiR2aWV3U2l6ZS54ID4gMCAmJiB0aGlzLiR2aWV3U2l6ZS55ID4gMDtcbiAgICAgICAgaWYgKHRoaXMuJHZ0U2Nyb2xsQmFyKVxuICAgICAgICAgICAgdGhpcy4kdnRTY3JvbGxCYXIuZGlzcGxheU9iamVjdC52aXNpYmxlID0gdGhpcy4kc2Nyb2xsQmFyVmlzaWJsZSAmJiAhdGhpcy4kdlNjcm9sbE5vbmU7XG4gICAgICAgIGlmICh0aGlzLiRoelNjcm9sbEJhcilcbiAgICAgICAgICAgIHRoaXMuJGh6U2Nyb2xsQmFyLmRpc3BsYXlPYmplY3QudmlzaWJsZSA9IHRoaXMuJHNjcm9sbEJhclZpc2libGUgJiYgIXRoaXMuJGhTY3JvbGxOb25lO1xuICAgIH1cbiAgICBnZXRMb29wUGFydFNpemUoZGl2aXNpb24sIGF4aXMpIHtcbiAgICAgICAgbGV0IHBhZCA9IDA7XG4gICAgICAgIC8vIGlmICh0aGlzLiRvd25lciBpbnN0YW5jZW9mIEdMaXN0KVxuICAgICAgICAvLyAgICAgcGFkID0gYXhpcyA9PSBcInhcIiA/IHRoaXMuJG93bmVyLmNvbHVtbkdhcCA6IHRoaXMuJG93bmVyLmxpbmVHYXA7XG4gICAgICAgIHJldHVybiAodGhpcy4kY29udGVudFNpemVbYXhpc10gKyBwYWQpIC8gZGl2aXNpb247XG4gICAgfVxuICAgIGxvb3BDaGVja2luZ0N1cnJlbnQoKSB7XG4gICAgICAgIGxldCBjaGFuZ2VkID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLiRsb29wID09IDEgJiYgdGhpcy4kb3ZlcmxhcFNpemUueCA+IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiR4UG9zIDwgMC4wMDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiR4UG9zICs9IHRoaXMuZ2V0TG9vcFBhcnRTaXplKDIsICd4Jyk7XG4gICAgICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLiR4UG9zID49IHRoaXMuJG92ZXJsYXBTaXplLngpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiR4UG9zIC09IHRoaXMuZ2V0TG9vcFBhcnRTaXplKDIsICd4Jyk7XG4gICAgICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy4kbG9vcCA9PSAyICYmIHRoaXMuJG92ZXJsYXBTaXplLnkgPiAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy4keVBvcyA8IDAuMDAxKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4keVBvcyArPSB0aGlzLmdldExvb3BQYXJ0U2l6ZSgyLCAneScpO1xuICAgICAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy4keVBvcyA+PSB0aGlzLiRvdmVybGFwU2l6ZS55KSB7XG4gICAgICAgICAgICAgICAgdGhpcy4keVBvcyAtPSB0aGlzLmdldExvb3BQYXJ0U2l6ZSgyLCAneScpO1xuICAgICAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChjaGFuZ2VkKVxuICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnNldCh7IHg6IE1hdGguZmxvb3IoLXRoaXMuJHhQb3MpLCB5OiBNYXRoLmZsb29yKC10aGlzLiR5UG9zKSB9KTtcbiAgICAgICAgcmV0dXJuIGNoYW5nZWQ7XG4gICAgfVxuICAgIGxvb3BDaGVja2luZ1RhcmdldChlbmRQb3MpIHtcbiAgICAgICAgaWYgKHRoaXMuJGxvb3AgPT0gMSlcbiAgICAgICAgICAgIHRoaXMubG9vcENoZWNraW5nVGFyZ2V0MihlbmRQb3MsICd4Jyk7XG4gICAgICAgIGlmICh0aGlzLiRsb29wID09IDIpXG4gICAgICAgICAgICB0aGlzLmxvb3BDaGVja2luZ1RhcmdldDIoZW5kUG9zLCAneScpO1xuICAgIH1cbiAgICBsb29wQ2hlY2tpbmdUYXJnZXQyKGVuZFBvcywgYXhpcykge1xuICAgICAgICBsZXQgaGFsZlNpemU7XG4gICAgICAgIGxldCB0bXA7XG4gICAgICAgIGlmIChlbmRQb3NbYXhpc10gPiAwKSB7XG4gICAgICAgICAgICBoYWxmU2l6ZSA9IHRoaXMuZ2V0TG9vcFBhcnRTaXplKDIsIGF4aXMpO1xuICAgICAgICAgICAgdG1wID0gdGhpcy4kdHdlZW5TdGFydFtheGlzXSAtIGhhbGZTaXplO1xuICAgICAgICAgICAgaWYgKHRtcCA8PSAwICYmIHRtcCA+PSAtdGhpcy4kb3ZlcmxhcFNpemVbYXhpc10pIHtcbiAgICAgICAgICAgICAgICBlbmRQb3NbYXhpc10gLT0gaGFsZlNpemU7XG4gICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5TdGFydFtheGlzXSA9IHRtcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChlbmRQb3NbYXhpc10gPCAtdGhpcy4kb3ZlcmxhcFNpemVbYXhpc10pIHtcbiAgICAgICAgICAgIGhhbGZTaXplID0gdGhpcy5nZXRMb29wUGFydFNpemUoMiwgYXhpcyk7XG4gICAgICAgICAgICB0bXAgPSB0aGlzLiR0d2VlblN0YXJ0W2F4aXNdICsgaGFsZlNpemU7XG4gICAgICAgICAgICBpZiAodG1wIDw9IDAgJiYgdG1wID49IC10aGlzLiRvdmVybGFwU2l6ZVtheGlzXSkge1xuICAgICAgICAgICAgICAgIGVuZFBvc1theGlzXSArPSBoYWxmU2l6ZTtcbiAgICAgICAgICAgICAgICB0aGlzLiR0d2VlblN0YXJ0W2F4aXNdID0gdG1wO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGxvb3BDaGVja2luZ05ld1Bvcyh2YWx1ZSwgYXhpcykge1xuICAgICAgICBpZiAodGhpcy4kb3ZlcmxhcFNpemVbYXhpc10gPT0gMClcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgbGV0IHBvcyA9IGF4aXMgPT0gJ3gnID8gdGhpcy4keFBvcyA6IHRoaXMuJHlQb3M7XG4gICAgICAgIGxldCBjaGFuZ2VkID0gZmFsc2U7XG4gICAgICAgIGxldCB2O1xuICAgICAgICBpZiAodmFsdWUgPCAwLjAwMSkge1xuICAgICAgICAgICAgdmFsdWUgKz0gdGhpcy5nZXRMb29wUGFydFNpemUoMiwgYXhpcyk7XG4gICAgICAgICAgICBpZiAodmFsdWUgPiBwb3MpIHtcbiAgICAgICAgICAgICAgICB2ID0gdGhpcy5nZXRMb29wUGFydFNpemUoNiwgYXhpcyk7XG4gICAgICAgICAgICAgICAgdiA9IE1hdGguY2VpbCgodmFsdWUgLSBwb3MpIC8gdikgKiB2O1xuICAgICAgICAgICAgICAgIHBvcyA9IE51bWJlclV0aWwuY2xhbXAocG9zICsgdiwgMCwgdGhpcy4kb3ZlcmxhcFNpemVbYXhpc10pO1xuICAgICAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHZhbHVlID49IHRoaXMuJG92ZXJsYXBTaXplW2F4aXNdKSB7XG4gICAgICAgICAgICB2YWx1ZSAtPSB0aGlzLmdldExvb3BQYXJ0U2l6ZSgyLCBheGlzKTtcbiAgICAgICAgICAgIGlmICh2YWx1ZSA8IHBvcykge1xuICAgICAgICAgICAgICAgIHYgPSB0aGlzLmdldExvb3BQYXJ0U2l6ZSg2LCBheGlzKTtcbiAgICAgICAgICAgICAgICB2ID0gTWF0aC5jZWlsKChwb3MgLSB2YWx1ZSkgLyB2KSAqIHY7XG4gICAgICAgICAgICAgICAgcG9zID0gTnVtYmVyVXRpbC5jbGFtcChwb3MgLSB2LCAwLCB0aGlzLiRvdmVybGFwU2l6ZVtheGlzXSk7XG4gICAgICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoYW5nZWQpIHtcbiAgICAgICAgICAgIGlmIChheGlzID09ICd4JylcbiAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXIueCA9IC1NYXRoLmZsb29yKHBvcyk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnkgPSAtTWF0aC5mbG9vcihwb3MpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gICAgYWxpZ25Qb3NpdGlvbihwb3MsIGluZXJ0aWFsU2Nyb2xsaW5nKSB7XG4gICAgICAgIGlmICh0aGlzLiRwYWdlTW9kZSkge1xuICAgICAgICAgICAgcG9zLnggPSB0aGlzLmFsaWduQnlQYWdlKHBvcy54LCAneCcsIGluZXJ0aWFsU2Nyb2xsaW5nKTtcbiAgICAgICAgICAgIHBvcy55ID0gdGhpcy5hbGlnbkJ5UGFnZShwb3MueSwgJ3knLCBpbmVydGlhbFNjcm9sbGluZyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy4kc25hcFRvSXRlbSkge1xuICAgICAgICAgICAgdmFyIHB0ID0gdGhpcy4kb3duZXIuZ2V0U25hcHBpbmdQb3NpdGlvbigtcG9zLngsIC1wb3MueSwgU2Nyb2xsUGFuZS5zSGVscGVyUG9pbnQpO1xuICAgICAgICAgICAgaWYgKHBvcy54IDwgMCAmJiBwb3MueCA+IC10aGlzLiRvdmVybGFwU2l6ZS54KVxuICAgICAgICAgICAgICAgIHBvcy54ID0gLXB0Lng7XG4gICAgICAgICAgICBpZiAocG9zLnkgPCAwICYmIHBvcy55ID4gLXRoaXMuJG92ZXJsYXBTaXplLnkpXG4gICAgICAgICAgICAgICAgcG9zLnkgPSAtcHQueTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhbGlnbkJ5UGFnZShwb3MsIGF4aXMsIGluZXJ0aWFsU2Nyb2xsaW5nKSB7XG4gICAgICAgIGxldCBwYWdlO1xuICAgICAgICBpZiAocG9zID4gMClcbiAgICAgICAgICAgIHBhZ2UgPSAwO1xuICAgICAgICBlbHNlIGlmIChwb3MgPCAtdGhpcy4kb3ZlcmxhcFNpemVbYXhpc10pXG4gICAgICAgICAgICBwYWdlID1cbiAgICAgICAgICAgICAgICBNYXRoLmNlaWwodGhpcy4kY29udGVudFNpemVbYXhpc10gLyB0aGlzLiRwYWdlU2l6ZVtheGlzXSkgLSAxO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHBhZ2UgPSBNYXRoLmZsb29yKC1wb3MgLyB0aGlzLiRwYWdlU2l6ZVtheGlzXSk7XG4gICAgICAgICAgICB2YXIgY2hhbmdlID0gaW5lcnRpYWxTY3JvbGxpbmdcbiAgICAgICAgICAgICAgICA/IHBvcyAtIHRoaXMuJGNvbnRhaW5lclBvc1theGlzXVxuICAgICAgICAgICAgICAgIDogcG9zIC0gdGhpcy4kY29udGFpbmVyW2F4aXNdO1xuICAgICAgICAgICAgdmFyIHRlc3RQYWdlU2l6ZSA9IE1hdGgubWluKHRoaXMuJHBhZ2VTaXplW2F4aXNdLCB0aGlzLiRjb250ZW50U2l6ZVtheGlzXSAtXG4gICAgICAgICAgICAgICAgKHBhZ2UgKyAxKSAqIHRoaXMuJHBhZ2VTaXplW2F4aXNdKTtcbiAgICAgICAgICAgIHZhciBkZWx0YSA9IC1wb3MgLSBwYWdlICogdGhpcy4kcGFnZVNpemVbYXhpc107XG4gICAgICAgICAgICAvL3BhZ2UgbW9kZSBtYWduZXRpY1xuICAgICAgICAgICAgaWYgKE1hdGguYWJzKGNoYW5nZSkgPiB0aGlzLiRwYWdlU2l6ZVtheGlzXSkge1xuICAgICAgICAgICAgICAgIGlmIChkZWx0YSA+IHRlc3RQYWdlU2l6ZSAqIDAuNSlcbiAgICAgICAgICAgICAgICAgICAgcGFnZSsrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGRlbHRhID4gdGVzdFBhZ2VTaXplICogKGNoYW5nZSA8IDAgPyAwLjMgOiAwLjcpKVxuICAgICAgICAgICAgICAgICAgICBwYWdlKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL3JlLWNhbGMgZGlzdFxuICAgICAgICAgICAgY29uc3QgZHN0ID0gdGhpcy4kcGFnZVNpemVbYXhpc107XG4gICAgICAgICAgICBwb3MgPSAtcGFnZSAqIGRzdDtcbiAgICAgICAgICAgIGlmIChwb3MgPCAtZHN0KVxuICAgICAgICAgICAgICAgIHBvcyA9IC1kc3Q7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGluZXJ0aWFsU2Nyb2xsaW5nKSB7XG4gICAgICAgICAgICB2YXIgb2xkUG9zID0gdGhpcy4kdHdlZW5TdGFydFtheGlzXTtcbiAgICAgICAgICAgIHZhciBvbGRQYWdlO1xuICAgICAgICAgICAgaWYgKG9sZFBvcyA+IDApXG4gICAgICAgICAgICAgICAgb2xkUGFnZSA9IDA7XG4gICAgICAgICAgICBlbHNlIGlmIChvbGRQb3MgPCAtdGhpcy4kb3ZlcmxhcFNpemVbYXhpc10pXG4gICAgICAgICAgICAgICAgb2xkUGFnZSA9XG4gICAgICAgICAgICAgICAgICAgIE1hdGguY2VpbCh0aGlzLiRjb250ZW50U2l6ZVtheGlzXSAvIHRoaXMuJHBhZ2VTaXplW2F4aXNdKSAtIDE7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgb2xkUGFnZSA9IE1hdGguZmxvb3IoLW9sZFBvcyAvIHRoaXMuJHBhZ2VTaXplW2F4aXNdKTtcbiAgICAgICAgICAgIHZhciBzdGFydFBhZ2UgPSBNYXRoLmZsb29yKC10aGlzLiRjb250YWluZXJQb3NbYXhpc10gLyB0aGlzLiRwYWdlU2l6ZVtheGlzXSk7XG4gICAgICAgICAgICBpZiAoTWF0aC5hYnMocGFnZSAtIHN0YXJ0UGFnZSkgPiAxICYmIE1hdGguYWJzKG9sZFBhZ2UgLSBzdGFydFBhZ2UpIDw9IDEpIHtcbiAgICAgICAgICAgICAgICBpZiAocGFnZSA+IHN0YXJ0UGFnZSlcbiAgICAgICAgICAgICAgICAgICAgcGFnZSA9IHN0YXJ0UGFnZSArIDE7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBwYWdlID0gc3RhcnRQYWdlIC0gMTtcbiAgICAgICAgICAgICAgICBwb3MgPSAtcGFnZSAqIHRoaXMuJHBhZ2VTaXplW2F4aXNdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwb3M7XG4gICAgfVxuICAgIHVwZGF0ZVRhcmdldEFuZER1cmF0aW9uKG9yaWduUG9zLCByZXN1bHRQb3MpIHtcbiAgICAgICAgcmVzdWx0UG9zLnggPSB0aGlzLnVwZGF0ZVRhcmdldEFuZER1cmF0aW9uMihvcmlnblBvcy54LCAneCcpO1xuICAgICAgICByZXN1bHRQb3MueSA9IHRoaXMudXBkYXRlVGFyZ2V0QW5kRHVyYXRpb24yKG9yaWduUG9zLnksICd5Jyk7XG4gICAgfVxuICAgIHVwZGF0ZVRhcmdldEFuZER1cmF0aW9uMihwb3MsIGF4aXMpIHtcbiAgICAgICAgbGV0IHYgPSB0aGlzLiR2ZWxvY2l0eVtheGlzXTtcbiAgICAgICAgdmFyIGR1cmF0aW9uID0gMDtcbiAgICAgICAgaWYgKHBvcyA+IDApXG4gICAgICAgICAgICBwb3MgPSAwO1xuICAgICAgICBlbHNlIGlmIChwb3MgPCAtdGhpcy4kb3ZlcmxhcFNpemVbYXhpc10pXG4gICAgICAgICAgICBwb3MgPSAtdGhpcy4kb3ZlcmxhcFNpemVbYXhpc107XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbGV0IHYyID0gTWF0aC5hYnModikgKiB0aGlzLiR2ZWxvY2l0eVNjYWxlO1xuICAgICAgICAgICAgaWYgKGlzTW9iaWxlLmFueSlcbiAgICAgICAgICAgICAgICB2MiAqPVxuICAgICAgICAgICAgICAgICAgICBNYXRoLm1heChEZWNscyQxLkdSb290Lmluc3Quc3RhZ2VXcmFwcGVyLmRlc2lnbldpZHRoLCBEZWNscyQxLkdSb290Lmluc3Quc3RhZ2VXcmFwcGVyLmRlc2lnbkhlaWdodCkgLyBNYXRoLm1heChEZWNscyQxLkdSb290Lmluc3Quc3RhZ2VXaWR0aCwgRGVjbHMkMS5HUm9vdC5pbnN0LnN0YWdlSGVpZ2h0KTtcbiAgICAgICAgICAgIC8vdGhyZXNob2xkLCBpZiB0b28gc2xvdywgc3RvcCBpdFxuICAgICAgICAgICAgbGV0IHJhdGlvID0gMDtcbiAgICAgICAgICAgIGlmICh0aGlzLiRwYWdlTW9kZSB8fCAhaXNNb2JpbGUuYW55KSB7XG4gICAgICAgICAgICAgICAgaWYgKHYyID4gNTAwKVxuICAgICAgICAgICAgICAgICAgICByYXRpbyA9IE1hdGgucG93KCh2MiAtIDUwMCkgLyA1MDAsIDIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHYyID4gMTAwMClcbiAgICAgICAgICAgICAgICAgICAgcmF0aW8gPSBNYXRoLnBvdygodjIgLSAxMDAwKSAvIDEwMDAsIDIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJhdGlvICE9IDApIHtcbiAgICAgICAgICAgICAgICBpZiAocmF0aW8gPiAxKVxuICAgICAgICAgICAgICAgICAgICByYXRpbyA9IDE7XG4gICAgICAgICAgICAgICAgdjIgKj0gcmF0aW87XG4gICAgICAgICAgICAgICAgdiAqPSByYXRpbztcbiAgICAgICAgICAgICAgICB0aGlzLiR2ZWxvY2l0eVtheGlzXSA9IHY7XG4gICAgICAgICAgICAgICAgZHVyYXRpb24gPSBNYXRoLmxvZyg2MCAvIHYyKSAvIE1hdGgubG9nKHRoaXMuJGRlY2VsZXJhdGlvblJhdGUpIC8gNjA7XG4gICAgICAgICAgICAgICAgY29uc3QgY2hhbmdlID0gKHYgLyA2MCAtIDEpIC8gKDEgLSB0aGlzLiRkZWNlbGVyYXRpb25SYXRlKTtcbiAgICAgICAgICAgICAgICAvL2NvbnN0IGNoYW5nZTogbnVtYmVyID0gTWF0aC5mbG9vcih2ICogZHVyYXRpb24gKiAwLjQpO1xuICAgICAgICAgICAgICAgIHBvcyArPSBjaGFuZ2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGR1cmF0aW9uIDwgU2Nyb2xsUGFuZS5UV0VFTl9ERUZBVUxUX0RVUkFUSU9OKVxuICAgICAgICAgICAgZHVyYXRpb24gPSBTY3JvbGxQYW5lLlRXRUVOX0RFRkFVTFRfRFVSQVRJT047XG4gICAgICAgIHRoaXMuJHR3ZWVuRHVyYXRpb25bYXhpc10gPSBkdXJhdGlvbjtcbiAgICAgICAgcmV0dXJuIHBvcztcbiAgICB9XG4gICAgZml4RHVyYXRpb24oYXhpcywgb2xkQ2hhbmdlKSB7XG4gICAgICAgIGlmICh0aGlzLiR0d2VlbkNoYW5nZVtheGlzXSA9PSAwIHx8XG4gICAgICAgICAgICBNYXRoLmFicyh0aGlzLiR0d2VlbkNoYW5nZVtheGlzXSkgPj0gTWF0aC5hYnMob2xkQ2hhbmdlKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbGV0IG5ld0R1cmF0aW9uID0gTWF0aC5hYnModGhpcy4kdHdlZW5DaGFuZ2VbYXhpc10gLyBvbGRDaGFuZ2UpICpcbiAgICAgICAgICAgIHRoaXMuJHR3ZWVuRHVyYXRpb25bYXhpc107XG4gICAgICAgIGlmIChuZXdEdXJhdGlvbiA8IFNjcm9sbFBhbmUuVFdFRU5fREVGQVVMVF9EVVJBVElPTilcbiAgICAgICAgICAgIG5ld0R1cmF0aW9uID0gU2Nyb2xsUGFuZS5UV0VFTl9ERUZBVUxUX0RVUkFUSU9OO1xuICAgICAgICB0aGlzLiR0d2VlbkR1cmF0aW9uW2F4aXNdID0gbmV3RHVyYXRpb247XG4gICAgfVxuICAgIGtpbGxUd2VlbigpIHtcbiAgICAgICAgLy90d2VlbmluZyA9PSAxOiBzZXQgdG8gZW5kIGltbWVkaWF0ZWx5XG4gICAgICAgIGlmICh0aGlzLiR0d2VlbmluZyA9PSAxKSB7XG4gICAgICAgICAgICB0aGlzLiRjb250YWluZXIuc2V0KHtcbiAgICAgICAgICAgICAgICB4OiB0aGlzLiR0d2VlblN0YXJ0LnggKyB0aGlzLiR0d2VlbkNoYW5nZS54LFxuICAgICAgICAgICAgICAgIHk6IHRoaXMuJHR3ZWVuU3RhcnQueSArIHRoaXMuJHR3ZWVuQ2hhbmdlLnlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGV0IGV2dCA9IG5ldyBjcmVhdGVqcy5FdmVudChcIl9fc2Nyb2xsXCIgLyogU0NST0xMICovLCB0cnVlLCBmYWxzZSk7XG4gICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZXZ0LCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiR0d2VlbmluZyA9IDA7XG4gICAgICAgIEdUaW1lci5pbnN0LnJlbW92ZSh0aGlzLnR3ZWVuVXBkYXRlLCB0aGlzKTtcbiAgICAgICAgbGV0IGV2dCA9IG5ldyBjcmVhdGVqcy5FdmVudChcIl9fc2Nyb2xsRW5kXCIgLyogU0NST0xMX0VORCAqLywgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZXZ0LCB0aGlzKTtcbiAgICB9XG4gICAgY2hlY2tSZWZyZXNoQmFyKCkge1xuICAgICAgICBpZiAodGhpcy4kaGVhZGVyID09IG51bGwgJiYgdGhpcy4kZm9vdGVyID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IHBvcyA9IHRoaXMuJGNvbnRhaW5lclt0aGlzLiRyZWZyZXNoQmFyQXhpc107XG4gICAgICAgIGlmICh0aGlzLiRoZWFkZXIgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKHBvcyA+IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kaGVhZGVyLmRpc3BsYXlPYmplY3QucGFyZW50ID09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJG1hc2tDb250YWluZXIuYWRkQ2hpbGRBdCh0aGlzLiRoZWFkZXIuZGlzcGxheU9iamVjdCwgMCk7XG4gICAgICAgICAgICAgICAgY29uc3QgcHQgPSBTY3JvbGxQYW5lLnNIZWxwZXJQb2ludDtcbiAgICAgICAgICAgICAgICBwdC5zZXRWYWx1ZXModGhpcy4kaGVhZGVyLndpZHRoLCB0aGlzLiRoZWFkZXIuaGVpZ2h0KTtcbiAgICAgICAgICAgICAgICBwdFt0aGlzLiRyZWZyZXNoQmFyQXhpc10gPSBwb3M7XG4gICAgICAgICAgICAgICAgdGhpcy4kaGVhZGVyLnNldFNpemUocHQueCwgcHQueSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kaGVhZGVyLmRpc3BsYXlPYmplY3QucGFyZW50ICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJG1hc2tDb250YWluZXIucmVtb3ZlQ2hpbGQodGhpcy4kaGVhZGVyLmRpc3BsYXlPYmplY3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLiRmb290ZXIgIT0gbnVsbCkge1xuICAgICAgICAgICAgdmFyIG1heCA9IHRoaXMuJG92ZXJsYXBTaXplW3RoaXMuJHJlZnJlc2hCYXJBeGlzXTtcbiAgICAgICAgICAgIGlmIChwb3MgPCAtbWF4IHx8IChtYXggPT0gMCAmJiB0aGlzLiRmb290ZXJMb2NrZWRTaXplID4gMCkpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kZm9vdGVyLmRpc3BsYXlPYmplY3QucGFyZW50ID09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJG1hc2tDb250YWluZXIuYWRkQ2hpbGRBdCh0aGlzLiRmb290ZXIuZGlzcGxheU9iamVjdCwgMCk7XG4gICAgICAgICAgICAgICAgY29uc3QgcHQgPSBTY3JvbGxQYW5lLnNIZWxwZXJQb2ludDtcbiAgICAgICAgICAgICAgICBwdC5zZXRWYWx1ZXModGhpcy4kZm9vdGVyLngsIHRoaXMuJGZvb3Rlci55KTtcbiAgICAgICAgICAgICAgICBpZiAobWF4ID4gMClcbiAgICAgICAgICAgICAgICAgICAgcHRbdGhpcy4kcmVmcmVzaEJhckF4aXNdID1cbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcyArIHRoaXMuJGNvbnRlbnRTaXplW3RoaXMuJHJlZnJlc2hCYXJBeGlzXTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHB0W3RoaXMuJHJlZnJlc2hCYXJBeGlzXSA9IE1hdGgubWF4KE1hdGgubWluKHBvcyArIHRoaXMuJHZpZXdTaXplW3RoaXMuJHJlZnJlc2hCYXJBeGlzXSwgdGhpcy4kdmlld1NpemVbdGhpcy4kcmVmcmVzaEJhckF4aXNdIC0gdGhpcy4kZm9vdGVyTG9ja2VkU2l6ZSksIHRoaXMuJHZpZXdTaXplW3RoaXMuJHJlZnJlc2hCYXJBeGlzXSAtXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRjb250ZW50U2l6ZVt0aGlzLiRyZWZyZXNoQmFyQXhpc10pO1xuICAgICAgICAgICAgICAgIHRoaXMuJGZvb3Rlci5zZXRYWShwdC54LCBwdC55KTtcbiAgICAgICAgICAgICAgICBwdC5zZXRWYWx1ZXModGhpcy4kZm9vdGVyLndpZHRoLCB0aGlzLiRmb290ZXIuaGVpZ2h0KTtcbiAgICAgICAgICAgICAgICBpZiAobWF4ID4gMClcbiAgICAgICAgICAgICAgICAgICAgcHRbdGhpcy4kcmVmcmVzaEJhckF4aXNdID0gLW1heCAtIHBvcztcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHB0W3RoaXMuJHJlZnJlc2hCYXJBeGlzXSA9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiR2aWV3U2l6ZVt0aGlzLiRyZWZyZXNoQmFyQXhpc10gLVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGZvb3Rlclt0aGlzLiRyZWZyZXNoQmFyQXhpc107XG4gICAgICAgICAgICAgICAgdGhpcy4kZm9vdGVyLnNldFNpemUocHQueCwgcHQueSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kZm9vdGVyLmRpc3BsYXlPYmplY3QucGFyZW50ICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJG1hc2tDb250YWluZXIucmVtb3ZlQ2hpbGQodGhpcy4kZm9vdGVyLmRpc3BsYXlPYmplY3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHR3ZWVuVXBkYXRlKCkge1xuICAgICAgICB2YXIgbnggPSB0aGlzLnJ1blR3ZWVuKCd4Jyk7XG4gICAgICAgIHZhciBueSA9IHRoaXMucnVuVHdlZW4oJ3knKTtcbiAgICAgICAgdGhpcy4kY29udGFpbmVyLnNldCh7IHg6IG54LCB5OiBueSB9KTtcbiAgICAgICAgaWYgKHRoaXMuJHR3ZWVuaW5nID09IDIpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRvdmVybGFwU2l6ZS54ID4gMClcbiAgICAgICAgICAgICAgICB0aGlzLiR4UG9zID0gTnVtYmVyVXRpbC5jbGFtcCgtbngsIDAsIHRoaXMuJG92ZXJsYXBTaXplLngpO1xuICAgICAgICAgICAgaWYgKHRoaXMuJG92ZXJsYXBTaXplLnkgPiAwKVxuICAgICAgICAgICAgICAgIHRoaXMuJHlQb3MgPSBOdW1iZXJVdGlsLmNsYW1wKC1ueSwgMCwgdGhpcy4kb3ZlcmxhcFNpemUueSk7XG4gICAgICAgICAgICBpZiAodGhpcy4kcGFnZU1vZGUpXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQYWdlQ29udHJvbGxlcigpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLiR0d2VlbkNoYW5nZS54ID09IDAgJiYgdGhpcy4kdHdlZW5DaGFuZ2UueSA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLiR0d2VlbmluZyA9IDA7XG4gICAgICAgICAgICBHVGltZXIuaW5zdC5yZW1vdmUodGhpcy50d2VlblVwZGF0ZSwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLmxvb3BDaGVja2luZ0N1cnJlbnQoKTtcbiAgICAgICAgICAgIHRoaXMuc3luY1Njcm9sbEJhcih0cnVlKTtcbiAgICAgICAgICAgIHRoaXMuY2hlY2tSZWZyZXNoQmFyKCk7XG4gICAgICAgICAgICBsZXQgc2Nyb2xsRXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoXCJfX3Njcm9sbFwiIC8qIFNDUk9MTCAqLywgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHNjcm9sbEV2ZW50LCB0aGlzKTtcbiAgICAgICAgICAgIGxldCBzY3JvbGxFbmRFdmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudChcIl9fc2Nyb2xsRW5kXCIgLyogU0NST0xMX0VORCAqLywgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHNjcm9sbEVuZEV2ZW50LCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3luY1Njcm9sbEJhcihmYWxzZSk7XG4gICAgICAgICAgICB0aGlzLmNoZWNrUmVmcmVzaEJhcigpO1xuICAgICAgICAgICAgbGV0IHNjcm9sbEV2ZW50ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KFwiX19zY3JvbGxcIiAvKiBTQ1JPTEwgKi8sIHRydWUsIGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChzY3JvbGxFdmVudCwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcnVuVHdlZW4oYXhpcykge1xuICAgICAgICBjb25zdCBkZWx0YSA9IGNyZWF0ZWpzLlRpY2tlci5pbnRlcnZhbDtcbiAgICAgICAgbGV0IG5ld1ZhbHVlO1xuICAgICAgICBpZiAodGhpcy4kdHdlZW5DaGFuZ2VbYXhpc10gIT0gMCkge1xuICAgICAgICAgICAgdGhpcy4kdHdlZW5UaW1lW2F4aXNdICs9IGRlbHRhICogY3JlYXRlanMuVGlja2VyLmZyYW1lcmF0ZTtcbiAgICAgICAgICAgIGlmICh0aGlzLiR0d2VlblRpbWVbYXhpc10gPj0gdGhpcy4kdHdlZW5EdXJhdGlvbltheGlzXSkge1xuICAgICAgICAgICAgICAgIG5ld1ZhbHVlID1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5TdGFydFtheGlzXSArIHRoaXMuJHR3ZWVuQ2hhbmdlW2F4aXNdO1xuICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuQ2hhbmdlW2F4aXNdID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJhdGlvID0gU2Nyb2xsUGFuZS4kZWFzZVR5cGVGdW5jKHRoaXMuJHR3ZWVuVGltZVtheGlzXSwgdGhpcy4kdHdlZW5EdXJhdGlvbltheGlzXSk7XG4gICAgICAgICAgICAgICAgbmV3VmFsdWUgPVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiR0d2VlblN0YXJ0W2F4aXNdICtcbiAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguZmxvb3IodGhpcy4kdHdlZW5DaGFuZ2VbYXhpc10gKiByYXRpbyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdGhyZXNob2xkMSA9IDA7XG4gICAgICAgICAgICB2YXIgdGhyZXNob2xkMiA9IC10aGlzLiRvdmVybGFwU2l6ZVtheGlzXTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRoZWFkZXJMb2NrZWRTaXplID4gMCAmJiB0aGlzLiRyZWZyZXNoQmFyQXhpcyA9PSBheGlzKVxuICAgICAgICAgICAgICAgIHRocmVzaG9sZDEgPSB0aGlzLiRoZWFkZXJMb2NrZWRTaXplO1xuICAgICAgICAgICAgaWYgKHRoaXMuJGZvb3RlckxvY2tlZFNpemUgPiAwICYmIHRoaXMuJHJlZnJlc2hCYXJBeGlzID09IGF4aXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgbWF4ID0gdGhpcy4kb3ZlcmxhcFNpemVbdGhpcy4kcmVmcmVzaEJhckF4aXNdO1xuICAgICAgICAgICAgICAgIGlmIChtYXggPT0gMClcbiAgICAgICAgICAgICAgICAgICAgbWF4ID0gTWF0aC5tYXgodGhpcy4kY29udGVudFNpemVbdGhpcy4kcmVmcmVzaEJhckF4aXNdICtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGZvb3RlckxvY2tlZFNpemUgLVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kdmlld1NpemVbdGhpcy4kcmVmcmVzaEJhckF4aXNdLCAwKTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIG1heCArPSB0aGlzLiRmb290ZXJMb2NrZWRTaXplO1xuICAgICAgICAgICAgICAgIHRocmVzaG9sZDIgPSAtbWF4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuJHR3ZWVuaW5nID09IDIgJiYgdGhpcy4kYm91bmNlYmFja0VmZmVjdCkge1xuICAgICAgICAgICAgICAgIGlmICgobmV3VmFsdWUgPiAyMCArIHRocmVzaG9sZDEgJiYgdGhpcy4kdHdlZW5DaGFuZ2VbYXhpc10gPiAwKSB8fFxuICAgICAgICAgICAgICAgICAgICAobmV3VmFsdWUgPiB0aHJlc2hvbGQxICYmIHRoaXMuJHR3ZWVuQ2hhbmdlW2F4aXNdID09IDApKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuVGltZVtheGlzXSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuRHVyYXRpb25bYXhpc10gPSBTY3JvbGxQYW5lLlRXRUVOX0RFRkFVTFRfRFVSQVRJT047XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuQ2hhbmdlW2F4aXNdID0gLW5ld1ZhbHVlICsgdGhyZXNob2xkMTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5TdGFydFtheGlzXSA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICgobmV3VmFsdWUgPCB0aHJlc2hvbGQyIC0gMjAgJiYgdGhpcy4kdHdlZW5DaGFuZ2VbYXhpc10gPCAwKSB8fFxuICAgICAgICAgICAgICAgICAgICAobmV3VmFsdWUgPCB0aHJlc2hvbGQyICYmIHRoaXMuJHR3ZWVuQ2hhbmdlW2F4aXNdID09IDApKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuVGltZVtheGlzXSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuRHVyYXRpb25bYXhpc10gPSBTY3JvbGxQYW5lLlRXRUVOX0RFRkFVTFRfRFVSQVRJT047XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuQ2hhbmdlW2F4aXNdID0gdGhyZXNob2xkMiAtIG5ld1ZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiR0d2VlblN0YXJ0W2F4aXNdID0gbmV3VmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlID4gdGhyZXNob2xkMSkge1xuICAgICAgICAgICAgICAgICAgICBuZXdWYWx1ZSA9IHRocmVzaG9sZDE7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuQ2hhbmdlW2F4aXNdID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAobmV3VmFsdWUgPCB0aHJlc2hvbGQyKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlID0gdGhyZXNob2xkMjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5DaGFuZ2VbYXhpc10gPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBuZXdWYWx1ZSA9IHRoaXMuJGNvbnRhaW5lcltheGlzXTtcbiAgICAgICAgcmV0dXJuIG5ld1ZhbHVlO1xuICAgIH1cbn1cblNjcm9sbFBhbmUuJGVhc2VUeXBlRnVuYyA9ICh0LCBkKSA9PiB7XG4gICAgcmV0dXJuICh0ID0gdCAvIGQgLSAxKSAqIHQgKiB0ICsgMTtcbn07IC8vY3ViaWMgb3V0XG5TY3JvbGxQYW5lLiRnZXN0dXJlRmxhZyA9IDA7XG5TY3JvbGxQYW5lLnNIZWxwZXJQb2ludCA9IG5ldyBjcmVhdGVqcy5Qb2ludCgpO1xuU2Nyb2xsUGFuZS5zSGVscGVyUmVjdCA9IG5ldyBjcmVhdGVqcy5SZWN0YW5nbGUoKTtcblNjcm9sbFBhbmUuc0VuZFBvcyA9IG5ldyBjcmVhdGVqcy5Qb2ludCgpO1xuU2Nyb2xsUGFuZS5zT2xkQ2hhbmdlID0gbmV3IGNyZWF0ZWpzLlBvaW50KCk7XG5TY3JvbGxQYW5lLlRXRUVOX0RFRkFVTFRfRFVSQVRJT04gPSAwLjQ7XG5TY3JvbGxQYW5lLlRXRUVOX01BTlVBTExZX1NFVF9EVVJBVElPTiA9IDAuNTsgLy90d2VlbiBkdXJhdGlvbiB1c2VkIHdoZW4gY2FsbCBzZXRQb3ModXNlQW5pPXRydWUpXG5TY3JvbGxQYW5lLlBVTExfRElTVF9SQVRJTyA9IDAuNTsgLy9wdWxsZG93biAvIHB1bGx1cCBkaXN0YW5jZSByYXRpbyBvZiB0aGUgd2hvbGUgdmlld3BvcnRcblxuY2xhc3MgQmluZGVyIHtcbiAgICBzdGF0aWMgY3JlYXRlKGZ1bmMsIGNvbnRleHQsIC4uLmFyZ3MpIHtcbiAgICAgICAgaWYgKCFjb250ZXh0KVxuICAgICAgICAgICAgcmV0dXJuIGZ1bmM7XG4gICAgICAgIHJldHVybiAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbGV0IGZ1bGxhcmdzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgPyBbXS5jb25jYXQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSkuY29uY2F0KGFyZ3MpIDogW10uY29uY2F0KGFyZ3MpO1xuICAgICAgICAgICAgZnVuYy5hcHBseShjb250ZXh0LCBmdWxsYXJncyk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuY2xhc3MgVHJhbnNpdGlvbiB7XG4gICAgY29uc3RydWN0b3Iob3duZXIpIHtcbiAgICAgICAgdGhpcy5hdXRvUGxheVJlcGVhdCA9IDE7XG4gICAgICAgIHRoaXMuYXV0b1BsYXlEZWxheSA9IDA7XG4gICAgICAgIHRoaXMuJG93bmVyQmFzZVggPSAwO1xuICAgICAgICB0aGlzLiRvd25lckJhc2VZID0gMDtcbiAgICAgICAgdGhpcy4kdG90YWxUaW1lcyA9IDA7XG4gICAgICAgIHRoaXMuJHN0YXJ0VGltZSA9IDA7XG4gICAgICAgIHRoaXMuJHRvdGFsVGFza3MgPSAwO1xuICAgICAgICB0aGlzLiRwbGF5aW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuJG9wdGlvbnMgPSAwO1xuICAgICAgICB0aGlzLiRtYXhUaW1lID0gMDtcbiAgICAgICAgdGhpcy4kb3duZXIgPSBvd25lcjtcbiAgICAgICAgdGhpcy4kaXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy4kb3duZXIub24oXCJfX3Zpc2libGVDaGFuZ2VkXCIgLyogVklTSUJMRV9DSEFOR0VEICovLCB0aGlzLiRvd25lclZpc2libGVDaGFuZ2VkLCB0aGlzKTtcbiAgICB9XG4gICAgLy8gcHJpdmF0ZSAkb3duZXJWaXNpYmxlQ2hhbmdlZCh2aXM6IGJvb2xlYW4sIG93bmVyOiBHQ29tcG9uZW50KTogdm9pZCB7XG4gICAgJG93bmVyVmlzaWJsZUNoYW5nZWQoZXZlbnQpIHtcbiAgICAgICAgbGV0IHZpcyA9IGV2ZW50LmRhdGE7XG4gICAgICAgIGlmICgodGhpcy4kb3B0aW9ucyAmIFRyYW5zaXRpb24uT1BUSU9OX0FVVE9fU1RPUF9ESVNBQkxFRCkgPT0gMCAmJiB2aXMgPT09IGZhbHNlKVxuICAgICAgICAgICAgdGhpcy5zdG9wKCh0aGlzLiRvcHRpb25zICYgVHJhbnNpdGlvbi5PUFRJT05fQVVUT19TVE9QX0FUX0VORCkgIT0gMCA/IHRydWUgOiBmYWxzZSwgZmFsc2UpO1xuICAgIH1cbiAgICBnZXQgYXV0b1BsYXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRhdXRvUGxheTtcbiAgICB9XG4gICAgc2V0IGF1dG9QbGF5KHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiRhdXRvUGxheSAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kYXV0b1BsYXkgPSB2YWx1ZTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRhdXRvUGxheSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRvd25lci5vblN0YWdlKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXkoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGltZXM6IHRoaXMuYXV0b1BsYXlSZXBlYXQsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogdGhpcy5hdXRvUGxheURlbGF5XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLiRvd25lci5vblN0YWdlKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3AoZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNoYW5nZVJlcGVhdCh2YWx1ZSkge1xuICAgICAgICB0aGlzLiR0b3RhbFRpbWVzID0gdmFsdWUgfCAwO1xuICAgIH1cbiAgICAvKipcbiAgICAgICAqIFBsYXkgdHJhbnNpdGlvbiBieSBzcGVjaWZpZWQgc2V0dGluZ3M6XG4gICAgICAgKiAxKSBwYXNzIHdob2xlIHBhcmFtZXRlcnM6XG4gICAgICAgICAgICAgIG9uQ29tcGxldGU/OiAoLi4uYXJnczphbnlbXSkgPT4gdm9pZCxcbiAgICAgICAgICAgICAgb25Db21wbGV0ZU9iaj86IGFueSxcbiAgICAgICAgICAgICAgb25Db21wbGV0ZVBhcmFtPzogYW55LFxuICAgICAgICAgICAgICB0aW1lczogbnVtYmVyLFxuICAgICAgICAgICAgICBkZWxheTogbnVtYmVyXG4gICAgICAgKiAyKSBqdXN0IHBhc3MgMSBvYmplY3Qgd2hpY2ggaW1wbGVtZW50cyBUcmFuc2l0aW9uUGxheVNldHRpbmcgKHJlY29tbWVuZGVkKVxuICAgICAgICovXG4gICAgcGxheSguLi5hcmdzKSB7XG4gICAgICAgIGlmIChhcmdzLmxlbmd0aCAmJiB0eXBlb2YgYXJnc1swXSA9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgbGV0IG9iaiA9IGFyZ3NbMF07XG4gICAgICAgICAgICB0aGlzLiRwbGF5KG9iai5vbkNvbXBsZXRlLCBvYmoub25Db21wbGV0ZU9iaiwgb2JqLm9uQ29tcGxldGVQYXJhbSwgb2JqLnRpbWVzIHx8IDEsIG9iai5kZWxheSB8fCAwLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kcGxheShhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdIHx8IDEsIGFyZ3NbNF0gfHwgMCwgZmFsc2UpO1xuICAgIH1cbiAgICAvKipcbiAgICAgICAqIFBsYXkgdHJhbnNpdGlvbiBieSBzcGVjaWZpZWQgc2V0dGluZ3M6XG4gICAgICAgKiAxKSBwYXNzIHdob2xlIHBhcmFtZXRlcnM6XG4gICAgICAgICAgICAgIG9uQ29tcGxldGU/OiAoLi4uYXJnczphbnlbXSkgPT4gdm9pZCxcbiAgICAgICAgICAgICAgb25Db21wbGV0ZU9iaj86IGFueSxcbiAgICAgICAgICAgICAgb25Db21wbGV0ZVBhcmFtPzogYW55LFxuICAgICAgICAgICAgICB0aW1lczogbnVtYmVyLFxuICAgICAgICAgICAgICBkZWxheTogbnVtYmVyXG4gICAgICAgKiAyKSBqdXN0IHBhc3MgMSBvYmplY3Qgd2hpY2ggaW1wbGVtZW50cyBUcmFuc2l0aW9uUGxheVNldHRpbmcgKHJlY29tbWVuZGVkKVxuICAgICAgICovXG4gICAgcGxheVJldmVyc2UoLi4uYXJncykge1xuICAgICAgICBpZiAoYXJncy5sZW5ndGggJiYgdHlwZW9mIGFyZ3NbMF0gPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIGxldCBvYmogPSBhcmdzWzBdO1xuICAgICAgICAgICAgdGhpcy4kcGxheShvYmoub25Db21wbGV0ZSwgb2JqLm9uQ29tcGxldGVPYmosIG9iai5vbkNvbXBsZXRlUGFyYW0sIG9iai50aW1lcyB8fCAxLCBvYmouZGVsYXkgfHwgMCwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kcGxheShhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdIHx8IDEsIGFyZ3NbNF0gfHwgMCwgdHJ1ZSk7XG4gICAgfVxuICAgICRwbGF5KG9uQ29tcGxldGUsIG9uQ29tcGxldGVPYmosIG9uQ29tcGxldGVQYXJhbSwgdGltZXMsIGRlbGF5LCByZXZlcnNlZCA9IGZhbHNlKSB7XG4gICAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgICBpZiAodGltZXMgPT0gMClcbiAgICAgICAgICAgIHRpbWVzID0gMTtcbiAgICAgICAgZWxzZSBpZiAodGltZXMgPT0gLTEpXG4gICAgICAgICAgICB0aW1lcyA9IE51bWJlci5NQVhfVkFMVUU7XG4gICAgICAgIHRoaXMuJHRvdGFsVGltZXMgPSB0aW1lcztcbiAgICAgICAgdGhpcy4kc3RhcnRUaW1lID0gMDtcbiAgICAgICAgdGhpcy4kcmV2ZXJzZWQgPSByZXZlcnNlZDtcbiAgICAgICAgdGhpcy5pbnRlcm5hbFBsYXkoZGVsYXkpO1xuICAgICAgICB0aGlzLiRwbGF5aW5nID0gdGhpcy4kdG90YWxUYXNrcyA+IDA7XG4gICAgICAgIGlmICh0aGlzLiRwbGF5aW5nKSB7XG4gICAgICAgICAgICB0aGlzLiRvbkNvbXBsZXRlID0gb25Db21wbGV0ZTtcbiAgICAgICAgICAgIHRoaXMuJG9uQ29tcGxldGVQYXJhbSA9IG9uQ29tcGxldGVQYXJhbTtcbiAgICAgICAgICAgIHRoaXMuJG9uQ29tcGxldGVPYmogPSBvbkNvbXBsZXRlT2JqO1xuICAgICAgICAgICAgaWYgKCh0aGlzLiRvcHRpb25zICYgVHJhbnNpdGlvbi5PUFRJT05fSUdOT1JFX0RJU1BMQVlfQ09OVFJPTExFUikgIT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuJGl0ZW1zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnRhcmdldCAhPSBudWxsICYmIGl0ZW0udGFyZ2V0ICE9IHRoaXMuJG93bmVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5sb2NrVG9rZW4gPSBpdGVtLnRhcmdldC5sb2NrR2VhckRpc3BsYXkoKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChvbkNvbXBsZXRlICE9IG51bGwpIHtcbiAgICAgICAgICAgIG9uQ29tcGxldGVQYXJhbSAmJiBvbkNvbXBsZXRlUGFyYW0ubGVuZ3RoXG4gICAgICAgICAgICAgICAgPyBvbkNvbXBsZXRlLmFwcGx5KG9uQ29tcGxldGVPYmosIG9uQ29tcGxldGVQYXJhbSlcbiAgICAgICAgICAgICAgICA6IG9uQ29tcGxldGUuY2FsbChvbkNvbXBsZXRlT2JqLCBvbkNvbXBsZXRlUGFyYW0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHN0b3Aoc2V0VG9Db21wbGV0ZSA9IHRydWUsIHByb2Nlc3NDYWxsYmFjayA9IGZhbHNlKSB7XG4gICAgICAgIGlmICh0aGlzLiRwbGF5aW5nKSB7XG4gICAgICAgICAgICB0aGlzLiRwbGF5aW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLiR0b3RhbFRhc2tzID0gMDtcbiAgICAgICAgICAgIHRoaXMuJHRvdGFsVGltZXMgPSAwO1xuICAgICAgICAgICAgbGV0IGZ1bmMgPSB0aGlzLiRvbkNvbXBsZXRlO1xuICAgICAgICAgICAgbGV0IHBhcmFtID0gdGhpcy4kb25Db21wbGV0ZVBhcmFtO1xuICAgICAgICAgICAgbGV0IHRoaXNPYmogPSB0aGlzLiRvbkNvbXBsZXRlT2JqO1xuICAgICAgICAgICAgdGhpcy4kb25Db21wbGV0ZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLiRvbkNvbXBsZXRlUGFyYW0gPSBudWxsO1xuICAgICAgICAgICAgdGhpcy4kb25Db21wbGV0ZU9iaiA9IG51bGw7XG4gICAgICAgICAgICBsZXQgY250ID0gdGhpcy4kaXRlbXMubGVuZ3RoO1xuICAgICAgICAgICAgbGV0IGl0ZW07XG4gICAgICAgICAgICBpZiAodGhpcy4kcmV2ZXJzZWQpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gY250IC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IHRoaXMuJGl0ZW1zW2ldO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS50YXJnZXQgPT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3BJdGVtKGl0ZW0sIHNldFRvQ29tcGxldGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY250OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IHRoaXMuJGl0ZW1zW2ldO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS50YXJnZXQgPT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3BJdGVtKGl0ZW0sIHNldFRvQ29tcGxldGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwcm9jZXNzQ2FsbGJhY2sgJiYgZnVuYyAhPSBudWxsKVxuICAgICAgICAgICAgICAgIHBhcmFtICYmIHBhcmFtLmxlbmd0aCA+IDAgPyBmdW5jLmFwcGx5KHRoaXNPYmosIHBhcmFtKSA6IGZ1bmMuY2FsbCh0aGlzT2JqLCBwYXJhbSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3RvcEl0ZW0oaXRlbSwgc2V0VG9Db21wbGV0ZSkge1xuICAgICAgICBpZiAoaXRlbS5sb2NrVG9rZW4gIT0gMCkge1xuICAgICAgICAgICAgaXRlbS50YXJnZXQucmVsZWFzZUdlYXJEaXNwbGF5KGl0ZW0ubG9ja1Rva2VuKTtcbiAgICAgICAgICAgIGl0ZW0ubG9ja1Rva2VuID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXRlbS50eXBlID09IDEyIC8qIENvbG9yRmlsdGVyICovICYmIGl0ZW0uZmlsdGVyQ3JlYXRlZClcbiAgICAgICAgICAgIGl0ZW0udGFyZ2V0LmZpbHRlcnMgPSBudWxsO1xuICAgICAgICBpZiAoaXRlbS5jb21wbGV0ZWQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuZGlzcG9zZVR3ZWVuKGl0ZW0pO1xuICAgICAgICBpZiAoaXRlbS50eXBlID09IDEwIC8qIFRyYW5zaXRpb24gKi8pIHtcbiAgICAgICAgICAgIGxldCB0cmFucyA9IGl0ZW0udGFyZ2V0LmdldFRyYW5zaXRpb24oaXRlbS52YWx1ZS5zKTtcbiAgICAgICAgICAgIGlmICh0cmFucyAhPSBudWxsKVxuICAgICAgICAgICAgICAgIHRyYW5zLnN0b3Aoc2V0VG9Db21wbGV0ZSwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGl0ZW0udHlwZSA9PSAxMSAvKiBTaGFrZSAqLykge1xuICAgICAgICAgICAgR1RpbWVyLmluc3QucmVtb3ZlKGl0ZW0uJHNoYWtlLCBpdGVtKTtcbiAgICAgICAgICAgIGl0ZW0udGFyZ2V0LiRnZWFyTG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIGl0ZW0udGFyZ2V0LnNldFhZKGl0ZW0udGFyZ2V0LnggLSBpdGVtLnN0YXJ0VmFsdWUuZjEsIGl0ZW0udGFyZ2V0LnkgLSBpdGVtLnN0YXJ0VmFsdWUuZjIpO1xuICAgICAgICAgICAgaXRlbS50YXJnZXQuJGdlYXJMb2NrZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChzZXRUb0NvbXBsZXRlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0udHdlZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpdGVtLnlveW8gfHwgaXRlbS5yZXBlYXQgJSAyID09IDApXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5VmFsdWUoaXRlbSwgdGhpcy4kcmV2ZXJzZWQgPyBpdGVtLnN0YXJ0VmFsdWUgOiBpdGVtLmVuZFZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBseVZhbHVlKGl0ZW0sIHRoaXMuJHJldmVyc2VkID8gaXRlbS5lbmRWYWx1ZSA6IGl0ZW0uc3RhcnRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGl0ZW0udHlwZSAhPSA5IC8qIFNvdW5kICovKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5VmFsdWUoaXRlbSwgaXRlbS52YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZGlzcG9zZSgpIHtcbiAgICAgICAgR1RpbWVyLmluc3QucmVtb3ZlKHRoaXMuaW50ZXJuYWxQbGF5LCB0aGlzKTtcbiAgICAgICAgdGhpcy4kb3duZXIub2ZmKFwiX192aXNpYmxlQ2hhbmdlZFwiIC8qIFZJU0lCTEVfQ0hBTkdFRCAqLywgdGhpcy4kb3duZXJWaXNpYmxlQ2hhbmdlZCk7XG4gICAgICAgIHRoaXMuJHBsYXlpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy4kaXRlbXMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgIGlmIChpdGVtLnRhcmdldCA9PSBudWxsIHx8IGl0ZW0uY29tcGxldGVkKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIHRoaXMuZGlzcG9zZVR3ZWVuKGl0ZW0pO1xuICAgICAgICAgICAgaWYgKGl0ZW0udHlwZSA9PSAxMCAvKiBUcmFuc2l0aW9uICovKSB7XG4gICAgICAgICAgICAgICAgbGV0IHRyYW5zID0gaXRlbS50YXJnZXQuZ2V0VHJhbnNpdGlvbihpdGVtLnZhbHVlLnMpO1xuICAgICAgICAgICAgICAgIGlmICh0cmFucyAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICB0cmFucy5kaXNwb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChpdGVtLnR5cGUgPT0gMTEgLyogU2hha2UgKi8pXG4gICAgICAgICAgICAgICAgR1RpbWVyLmluc3QucmVtb3ZlKGl0ZW0uJHNoYWtlLCBpdGVtKTtcbiAgICAgICAgfSwgdGhpcyk7XG4gICAgfVxuICAgIGdldCBwbGF5aW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kcGxheWluZztcbiAgICB9XG4gICAgc2V0VmFsdWUobGFiZWwsIC4uLmFyZ3MpIHtcbiAgICAgICAgdGhpcy4kaXRlbXMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgIGlmIChpdGVtLmxhYmVsID09IG51bGwgJiYgaXRlbS5sYWJlbDIgPT0gbnVsbClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBsZXQgdmFsdWU7XG4gICAgICAgICAgICBpZiAoaXRlbS5sYWJlbCA9PSBsYWJlbCkge1xuICAgICAgICAgICAgICAgIGlmIChpdGVtLnR3ZWVuKVxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGl0ZW0uc3RhcnRWYWx1ZTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gaXRlbS52YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGl0ZW0ubGFiZWwyID09IGxhYmVsKVxuICAgICAgICAgICAgICAgIHZhbHVlID0gaXRlbS5lbmRWYWx1ZTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBzd2l0Y2ggKGl0ZW0udHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMCAvKiBYWSAqLzpcbiAgICAgICAgICAgICAgICBjYXNlIDEgLyogU2l6ZSAqLzpcbiAgICAgICAgICAgICAgICBjYXNlIDMgLyogUGl2b3QgKi86XG4gICAgICAgICAgICAgICAgY2FzZSAyIC8qIFNjYWxlICovOlxuICAgICAgICAgICAgICAgIGNhc2UgMTMgLyogU2tldyAqLzpcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUuYjEgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZS5iMiA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLmYxID0gcGFyc2VGbG9hdChhcmdzWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUuZjIgPSBwYXJzZUZsb2F0KGFyZ3NbMV0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDQgLyogQWxwaGEgKi86XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLmYxID0gcGFyc2VGbG9hdChhcmdzWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA1IC8qIFJvdGF0aW9uICovOlxuICAgICAgICAgICAgICAgICAgICB2YWx1ZS5pID0gcGFyc2VJbnQoYXJnc1swXSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNiAvKiBDb2xvciAqLzpcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUuYyA9IGFyZ3NbMF07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNyAvKiBBbmltYXRpb24gKi86XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLmkgPSBwYXJzZUludChhcmdzWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID4gMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLmIgPSBhcmdzWzFdO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDggLyogVmlzaWJsZSAqLzpcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUuYiA9IGFyZ3NbMF07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgOSAvKiBTb3VuZCAqLzpcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUucyA9IGFyZ3NbMF07XG4gICAgICAgICAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IDEpXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS5mMSA9IHBhcnNlRmxvYXQoYXJnc1sxXSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTAgLyogVHJhbnNpdGlvbiAqLzpcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUucyA9IGFyZ3NbMF07XG4gICAgICAgICAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IDEpXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS5pID0gcGFyc2VJbnQoYXJnc1sxXSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTEgLyogU2hha2UgKi86XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLmYxID0gcGFyc2VGbG9hdChhcmdzWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID4gMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLmYyID0gcGFyc2VGbG9hdChhcmdzWzFdKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxMiAvKiBDb2xvckZpbHRlciAqLzpcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUuZjEgPSBwYXJzZUZsb2F0KGFyZ3NbMF0pO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZS5mMiA9IHBhcnNlRmxvYXQoYXJnc1sxXSk7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLmYzID0gcGFyc2VGbG9hdChhcmdzWzJdKTtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUuZjQgPSBwYXJzZUZsb2F0KGFyZ3NbM10pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcyk7XG4gICAgfVxuICAgIHNldEhvb2sobGFiZWwsIGNhbGxiYWNrLCB0aGlzT2JqKSB7XG4gICAgICAgIGxldCBjbnQgPSB0aGlzLiRpdGVtcy5sZW5ndGg7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY250OyBpKyspIHtcbiAgICAgICAgICAgIGxldCBpdGVtID0gdGhpcy4kaXRlbXNbaV07XG4gICAgICAgICAgICBpZiAoaXRlbS5sYWJlbCA9PSBsYWJlbCkge1xuICAgICAgICAgICAgICAgIGl0ZW0uaG9vayA9IGNhbGxiYWNrO1xuICAgICAgICAgICAgICAgIGl0ZW0uaG9va09iaiA9IHRoaXNPYmo7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChpdGVtLmxhYmVsMiA9PSBsYWJlbCkge1xuICAgICAgICAgICAgICAgIGl0ZW0uaG9vazIgPSBjYWxsYmFjaztcbiAgICAgICAgICAgICAgICBpdGVtLmhvb2syT2JqID0gdGhpc09iajtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBjbGVhckhvb2tzKCkge1xuICAgICAgICB0aGlzLiRpdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgICAgaXRlbS5ob29rID0gbnVsbDtcbiAgICAgICAgICAgIGl0ZW0uaG9va09iaiA9IG51bGw7XG4gICAgICAgICAgICBpdGVtLmhvb2syID0gbnVsbDtcbiAgICAgICAgICAgIGl0ZW0uaG9vazJPYmogPSBudWxsO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICB9XG4gICAgc2V0VGFyZ2V0KGxhYmVsLCBuZXdUYXJnZXQpIHtcbiAgICAgICAgdGhpcy4kaXRlbXMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgIGlmIChpdGVtLmxhYmVsID09IGxhYmVsKVxuICAgICAgICAgICAgICAgIGl0ZW0udGFyZ2V0SWQgPSBuZXdUYXJnZXQuaWQ7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgIH1cbiAgICBzZXREdXJhdGlvbihsYWJlbCwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy4kaXRlbXMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgIGlmIChpdGVtLnR3ZWVuICYmIGl0ZW0ubGFiZWwgPT0gbGFiZWwpXG4gICAgICAgICAgICAgICAgaXRlbS5kdXJhdGlvbiA9IHZhbHVlO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICB9XG4gICAgdXBkYXRlRnJvbVJlbGF0aW9ucyh0YXJnZXRJZCwgZHgsIGR5KSB7XG4gICAgICAgIHRoaXMuJGl0ZW1zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICBpZiAoaXRlbS50eXBlID09IDAgLyogWFkgKi8gJiYgaXRlbS50YXJnZXRJZCA9PSB0YXJnZXRJZCkge1xuICAgICAgICAgICAgICAgIGlmIChpdGVtLnR3ZWVuKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uc3RhcnRWYWx1ZS5mMSArPSBkeDtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5zdGFydFZhbHVlLmYyICs9IGR5O1xuICAgICAgICAgICAgICAgICAgICBpdGVtLmVuZFZhbHVlLmYxICs9IGR4O1xuICAgICAgICAgICAgICAgICAgICBpdGVtLmVuZFZhbHVlLmYyICs9IGR5O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS52YWx1ZS5mMSArPSBkeDtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS52YWx1ZS5mMiArPSBkeTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpO1xuICAgIH1cbiAgICBpbnRlcm5hbFBsYXkoZGVsYXkgPSAwKSB7XG4gICAgICAgIHRoaXMuJG93bmVyQmFzZVggPSB0aGlzLiRvd25lci54O1xuICAgICAgICB0aGlzLiRvd25lckJhc2VZID0gdGhpcy4kb3duZXIueTtcbiAgICAgICAgdGhpcy4kdG90YWxUYXNrcyA9IDA7XG4gICAgICAgIHRoaXMuJGl0ZW1zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICBpZiAoaXRlbS50YXJnZXRJZClcbiAgICAgICAgICAgICAgICBpdGVtLnRhcmdldCA9IHRoaXMuJG93bmVyLmdldENoaWxkQnlJZChpdGVtLnRhcmdldElkKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBpdGVtLnRhcmdldCA9IHRoaXMuJG93bmVyO1xuICAgICAgICAgICAgaWYgKGl0ZW0udGFyZ2V0ID09IG51bGwpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgbGV0IHN0YXJ0VGltZTtcbiAgICAgICAgICAgIHRoaXMuZGlzcG9zZVR3ZWVuKGl0ZW0pO1xuICAgICAgICAgICAgaWYgKGl0ZW0udHdlZW4pIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kcmV2ZXJzZWQpXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZSA9IGRlbGF5ICsgdGhpcy4kbWF4VGltZSAtIGl0ZW0udGltZSAtIGl0ZW0uZHVyYXRpb247XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBzdGFydFRpbWUgPSBkZWxheSArIGl0ZW0udGltZTtcbiAgICAgICAgICAgICAgICBpZiAoc3RhcnRUaW1lID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiR0b3RhbFRhc2tzKys7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uY29tcGxldGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0udHdlZW5lciA9IGNyZWF0ZWpzLlR3ZWVuLmdldChpdGVtLnZhbHVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndhaXQoc3RhcnRUaW1lICogMTAwMClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKHRoaXMuJGRlbGF5Q2FsbCwgW2l0ZW1dLCB0aGlzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0VHdlZW4oaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kcmV2ZXJzZWQpXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZSA9IGRlbGF5ICsgdGhpcy4kbWF4VGltZSAtIGl0ZW0udGltZTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZSA9IGRlbGF5ICsgaXRlbS50aW1lO1xuICAgICAgICAgICAgICAgIGlmIChzdGFydFRpbWUgPD0gMClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBseVZhbHVlKGl0ZW0sIGl0ZW0udmFsdWUpO1xuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiR0b3RhbFRhc2tzKys7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uY29tcGxldGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0udHdlZW5lciA9IGNyZWF0ZWpzLlR3ZWVuLmdldChpdGVtLnZhbHVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgLndhaXQoc3RhcnRUaW1lICogMTAwMClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYWxsKHRoaXMuJGRlbGF5Q2FsbDIsIFtpdGVtXSwgdGhpcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKTtcbiAgICB9XG4gICAgcHJlcGFyZVZhbHVlKGl0ZW0sIHRvUHJvcHMsIHJldmVyc2VkID0gZmFsc2UpIHtcbiAgICAgICAgbGV0IHN0YXJ0VmFsdWU7XG4gICAgICAgIGxldCBlbmRWYWx1ZTtcbiAgICAgICAgaWYgKHJldmVyc2VkKSB7XG4gICAgICAgICAgICBzdGFydFZhbHVlID0gaXRlbS5lbmRWYWx1ZTtcbiAgICAgICAgICAgIGVuZFZhbHVlID0gaXRlbS5zdGFydFZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3RhcnRWYWx1ZSA9IGl0ZW0uc3RhcnRWYWx1ZTtcbiAgICAgICAgICAgIGVuZFZhbHVlID0gaXRlbS5lbmRWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgICBzd2l0Y2ggKGl0ZW0udHlwZSkge1xuICAgICAgICAgICAgY2FzZSAwIC8qIFhZICovOlxuICAgICAgICAgICAgY2FzZSAxIC8qIFNpemUgKi86XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0udHlwZSA9PSAwIC8qIFhZICovKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnRhcmdldCA9PSB0aGlzLiRvd25lcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGFydFZhbHVlLmIxKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0VmFsdWUuZjEgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGFydFZhbHVlLmIyKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0VmFsdWUuZjIgPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGFydFZhbHVlLmIxKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0VmFsdWUuZjEgPSBpdGVtLnRhcmdldC54O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGFydFZhbHVlLmIyKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0VmFsdWUuZjIgPSBpdGVtLnRhcmdldC55O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXN0YXJ0VmFsdWUuYjEpXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydFZhbHVlLmYxID0gaXRlbS50YXJnZXQud2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIGlmICghc3RhcnRWYWx1ZS5iMilcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0VmFsdWUuZjIgPSBpdGVtLnRhcmdldC5oZWlnaHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUuZjEgPSBzdGFydFZhbHVlLmYxO1xuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUuZjIgPSBzdGFydFZhbHVlLmYyO1xuICAgICAgICAgICAgICAgIGlmICghZW5kVmFsdWUuYjEpXG4gICAgICAgICAgICAgICAgICAgIGVuZFZhbHVlLmYxID0gaXRlbS52YWx1ZS5mMTtcbiAgICAgICAgICAgICAgICBpZiAoIWVuZFZhbHVlLmIyKVxuICAgICAgICAgICAgICAgICAgICBlbmRWYWx1ZS5mMiA9IGl0ZW0udmFsdWUuZjI7XG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS5iMSA9IHN0YXJ0VmFsdWUuYjEgfHwgZW5kVmFsdWUuYjE7XG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS5iMiA9IHN0YXJ0VmFsdWUuYjIgfHwgZW5kVmFsdWUuYjI7XG4gICAgICAgICAgICAgICAgdG9Qcm9wcy5mMSA9IGVuZFZhbHVlLmYxO1xuICAgICAgICAgICAgICAgIHRvUHJvcHMuZjIgPSBlbmRWYWx1ZS5mMjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMiAvKiBTY2FsZSAqLzpcbiAgICAgICAgICAgIGNhc2UgMTMgLyogU2tldyAqLzpcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLmYxID0gc3RhcnRWYWx1ZS5mMTtcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLmYyID0gc3RhcnRWYWx1ZS5mMjtcbiAgICAgICAgICAgICAgICB0b1Byb3BzLmYxID0gZW5kVmFsdWUuZjE7XG4gICAgICAgICAgICAgICAgdG9Qcm9wcy5mMiA9IGVuZFZhbHVlLmYyO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA0IC8qIEFscGhhICovOlxuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUuZjEgPSBzdGFydFZhbHVlLmYxO1xuICAgICAgICAgICAgICAgIHRvUHJvcHMuZjEgPSBlbmRWYWx1ZS5mMTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNSAvKiBSb3RhdGlvbiAqLzpcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlLmkgPSBzdGFydFZhbHVlLmk7XG4gICAgICAgICAgICAgICAgdG9Qcm9wcy5pID0gZW5kVmFsdWUuaTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMTIgLyogQ29sb3JGaWx0ZXIgKi86XG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS5mMSA9IHN0YXJ0VmFsdWUuZjE7XG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS5mMiA9IHN0YXJ0VmFsdWUuZjI7XG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS5mMyA9IHN0YXJ0VmFsdWUuZjM7XG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZS5mNCA9IHN0YXJ0VmFsdWUuZjQ7XG4gICAgICAgICAgICAgICAgdG9Qcm9wcy5mMSA9IGVuZFZhbHVlLmYxO1xuICAgICAgICAgICAgICAgIHRvUHJvcHMuZjIgPSBlbmRWYWx1ZS5mMjtcbiAgICAgICAgICAgICAgICB0b1Byb3BzLmYzID0gZW5kVmFsdWUuZjM7XG4gICAgICAgICAgICAgICAgdG9Qcm9wcy5mNCA9IGVuZFZhbHVlLmY0O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIHN0YXJ0VHdlZW4oaXRlbSkge1xuICAgICAgICBsZXQgdG9Qcm9wcyA9IG5ldyBUcmFuc2l0aW9uVmFsdWUoKTtcbiAgICAgICAgdGhpcy5wcmVwYXJlVmFsdWUoaXRlbSwgdG9Qcm9wcywgdGhpcy4kcmV2ZXJzZWQpO1xuICAgICAgICB0aGlzLmFwcGx5VmFsdWUoaXRlbSwgaXRlbS52YWx1ZSk7XG4gICAgICAgIGxldCBjb21wbGV0ZUhhbmRsZXI7XG4gICAgICAgIGlmIChpdGVtLnJlcGVhdCAhPSAwKSB7XG4gICAgICAgICAgICBpdGVtLnR3ZWVuVGltZXMgPSAwO1xuICAgICAgICAgICAgY29tcGxldGVIYW5kbGVyID0gQmluZGVyLmNyZWF0ZSh0aGlzLiR0d2VlblJlcGVhdENvbXBsZXRlLCB0aGlzLCBpdGVtKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBjb21wbGV0ZUhhbmRsZXIgPSBCaW5kZXIuY3JlYXRlKHRoaXMuJHR3ZWVuQ29tcGxldGUsIHRoaXMsIGl0ZW0pO1xuICAgICAgICB0aGlzLiR0b3RhbFRhc2tzKys7XG4gICAgICAgIGl0ZW0uY29tcGxldGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMucHJlcGFyZVZhbHVlKGl0ZW0sIHRvUHJvcHMsIHRoaXMuJHJldmVyc2VkKTtcbiAgICAgICAgaXRlbS50d2VlbmVyID0gY3JlYXRlanMuVHdlZW4uZ2V0KGl0ZW0udmFsdWUsIHtcbiAgICAgICAgICAgIG9uQ2hhbmdlOiBCaW5kZXIuY3JlYXRlKHRoaXMuJHR3ZWVuVXBkYXRlLCB0aGlzLCBpdGVtKVxuICAgICAgICB9KVxuICAgICAgICAgICAgLnRvKHRvUHJvcHMsIGl0ZW0uZHVyYXRpb24gKiAxMDAwLCBpdGVtLmVhc2VUeXBlKVxuICAgICAgICAgICAgLmNhbGwoY29tcGxldGVIYW5kbGVyKTtcbiAgICAgICAgaWYgKGl0ZW0uaG9vayAhPSBudWxsKVxuICAgICAgICAgICAgaXRlbS5ob29rLmNhbGwoaXRlbS5ob29rT2JqKTtcbiAgICB9XG4gICAgJGRlbGF5Q2FsbChpdGVtKSB7XG4gICAgICAgIHRoaXMuZGlzcG9zZVR3ZWVuKGl0ZW0pO1xuICAgICAgICB0aGlzLiR0b3RhbFRhc2tzLS07XG4gICAgICAgIHRoaXMuc3RhcnRUd2VlbihpdGVtKTtcbiAgICB9XG4gICAgJGRlbGF5Q2FsbDIoaXRlbSkge1xuICAgICAgICB0aGlzLmRpc3Bvc2VUd2VlbihpdGVtKTtcbiAgICAgICAgdGhpcy4kdG90YWxUYXNrcy0tO1xuICAgICAgICBpdGVtLmNvbXBsZXRlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuYXBwbHlWYWx1ZShpdGVtLCBpdGVtLnZhbHVlKTtcbiAgICAgICAgaWYgKGl0ZW0uaG9vayAhPSBudWxsKVxuICAgICAgICAgICAgaXRlbS5ob29rLmNhbGwoaXRlbS5ob29rT2JqKTtcbiAgICAgICAgdGhpcy5jaGVja0FsbENvbXBsZXRlKCk7XG4gICAgfVxuICAgICR0d2VlblVwZGF0ZShldmVudCwgaXRlbSkge1xuICAgICAgICB0aGlzLmFwcGx5VmFsdWUoaXRlbSwgaXRlbS52YWx1ZSk7XG4gICAgfVxuICAgICR0d2VlbkNvbXBsZXRlKGV2ZW50LCBpdGVtKSB7XG4gICAgICAgIHRoaXMuZGlzcG9zZVR3ZWVuKGl0ZW0pO1xuICAgICAgICB0aGlzLiR0b3RhbFRhc2tzLS07XG4gICAgICAgIGl0ZW0uY29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgaWYgKGl0ZW0uaG9vazIgIT0gbnVsbClcbiAgICAgICAgICAgIGl0ZW0uaG9vazIuY2FsbChpdGVtLmhvb2syT2JqKTtcbiAgICAgICAgdGhpcy5jaGVja0FsbENvbXBsZXRlKCk7XG4gICAgfVxuICAgICR0d2VlblJlcGVhdENvbXBsZXRlKGV2ZW50LCBpdGVtKSB7XG4gICAgICAgIGl0ZW0udHdlZW5UaW1lcysrO1xuICAgICAgICBpZiAoaXRlbS5yZXBlYXQgPT0gLTEgfHwgaXRlbS50d2VlblRpbWVzIDwgaXRlbS5yZXBlYXQgKyAxKSB7XG4gICAgICAgICAgICBsZXQgdG9Qcm9wcyA9IG5ldyBUcmFuc2l0aW9uVmFsdWUoKTtcbiAgICAgICAgICAgIGxldCByZXZlcnNlZDtcbiAgICAgICAgICAgIGlmIChpdGVtLnlveW8pIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kcmV2ZXJzZWQpXG4gICAgICAgICAgICAgICAgICAgIHJldmVyc2VkID0gaXRlbS50d2VlblRpbWVzICUgMiA9PSAwO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgcmV2ZXJzZWQgPSBpdGVtLnR3ZWVuVGltZXMgJSAyID09IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgcmV2ZXJzZWQgPSB0aGlzLiRyZXZlcnNlZDtcbiAgICAgICAgICAgIHRoaXMucHJlcGFyZVZhbHVlKGl0ZW0sIHRvUHJvcHMsIHJldmVyc2VkKTtcbiAgICAgICAgICAgIHRoaXMuZGlzcG9zZVR3ZWVuKGl0ZW0pO1xuICAgICAgICAgICAgaXRlbS50d2VlbmVyID0gY3JlYXRlanMuVHdlZW4uZ2V0KGl0ZW0udmFsdWUsIHtcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogQmluZGVyLmNyZWF0ZSh0aGlzLiR0d2VlblVwZGF0ZSwgdGhpcywgaXRlbSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnRvKHRvUHJvcHMsIGl0ZW0uZHVyYXRpb24gKiAxMDAwLCBpdGVtLmVhc2VUeXBlKVxuICAgICAgICAgICAgICAgIC5jYWxsKHRoaXMuJHR3ZWVuUmVwZWF0Q29tcGxldGUsIFtudWxsLCBpdGVtXSwgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kdHdlZW5Db21wbGV0ZShudWxsLCBpdGVtKTtcbiAgICB9XG4gICAgZGlzcG9zZVR3ZWVuKGl0ZW0pIHtcbiAgICAgICAgaWYgKCFpdGVtKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAoaXRlbS50d2VlbmVyKSB7XG4gICAgICAgICAgICBpdGVtLnR3ZWVuZXIucGF1c2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIGl0ZW0udHdlZW5lci5yZW1vdmVBbGxFdmVudExpc3RlbmVycygpO1xuICAgICAgICAgICAgY3JlYXRlanMuVHdlZW4ucmVtb3ZlVHdlZW5zKGl0ZW0udmFsdWUpO1xuICAgICAgICAgICAgaXRlbS50d2VlbmVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICAkcGxheVRyYW5zQ29tcGxldGUoaXRlbSkge1xuICAgICAgICB0aGlzLmRpc3Bvc2VUd2VlbihpdGVtKTtcbiAgICAgICAgdGhpcy4kdG90YWxUYXNrcy0tO1xuICAgICAgICBpdGVtLmNvbXBsZXRlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuY2hlY2tBbGxDb21wbGV0ZSgpO1xuICAgIH1cbiAgICBjaGVja0FsbENvbXBsZXRlKCkge1xuICAgICAgICBpZiAodGhpcy4kcGxheWluZyAmJiB0aGlzLiR0b3RhbFRhc2tzID09IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiR0b3RhbFRpbWVzIDwgMCkge1xuICAgICAgICAgICAgICAgIC8vdGhlIHJlYXNvbiB3ZSBkb24ndCBjYWxsICdpbnRlcm5hbFBsYXknIGltbWVkaWF0ZWx5IGhlcmUgaXMgYmVjYXVzZSBvZiB0aGUgb25DaGFuZ2UgaGFuZGxlciBpc3N1ZSwgdGhlIGhhbmRsZXIncyBiZWVuIGNhbGxpbmcgYWxsIHRoZSB0aW1lIGV2ZW4gdGhlIHR3ZWVuIGlzIGluIHdhaXRpbmcvY29tcGxldGUgc3RhdHVzLlxuICAgICAgICAgICAgICAgIEdUaW1lci5pbnN0LmNhbGxMYXRlcih0aGlzLmludGVybmFsUGxheSwgdGhpcywgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLiR0b3RhbFRpbWVzLS07XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJHRvdGFsVGltZXMgPiAwKVxuICAgICAgICAgICAgICAgICAgICBHVGltZXIuaW5zdC5jYWxsTGF0ZXIodGhpcy5pbnRlcm5hbFBsYXksIHRoaXMsIDApO1xuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRwbGF5aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGl0ZW1zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS50YXJnZXQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmxvY2tUb2tlbiAhPSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0udGFyZ2V0LnJlbGVhc2VHZWFyRGlzcGxheShpdGVtLmxvY2tUb2tlbik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ubG9ja1Rva2VuID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uZmlsdGVyQ3JlYXRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmZpbHRlckNyZWF0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS50YXJnZXQuZmlsdGVycyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcG9zZVR3ZWVuKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJG9uQ29tcGxldGUgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZ1bmMgPSB0aGlzLiRvbkNvbXBsZXRlO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHBhcmFtID0gdGhpcy4kb25Db21wbGV0ZVBhcmFtO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRoaXNPYmogPSB0aGlzLiRvbkNvbXBsZXRlT2JqO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kb25Db21wbGV0ZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRvbkNvbXBsZXRlUGFyYW0gPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kb25Db21wbGV0ZU9iaiA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbSAmJiBwYXJhbS5sZW5ndGggPyBmdW5jLmFwcGx5KHRoaXNPYmosIHBhcmFtKSA6IGZ1bmMuY2FsbCh0aGlzT2JqLCBwYXJhbSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXBwbHlWYWx1ZShpdGVtLCB2YWx1ZSkge1xuICAgICAgICBpdGVtLnRhcmdldC4kZ2VhckxvY2tlZCA9IHRydWU7XG4gICAgICAgIHN3aXRjaCAoaXRlbS50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIDAgLyogWFkgKi86XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0udGFyZ2V0ID09IHRoaXMuJG93bmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBmMSA9IDAsIGYyID0gMDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF2YWx1ZS5iMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGYxID0gaXRlbS50YXJnZXQueDtcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgZjEgPSB2YWx1ZS5mMSArIHRoaXMuJG93bmVyQmFzZVg7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdmFsdWUuYjIpXG4gICAgICAgICAgICAgICAgICAgICAgICBmMiA9IGl0ZW0udGFyZ2V0Lnk7XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIGYyID0gdmFsdWUuZjIgKyB0aGlzLiRvd25lckJhc2VZO1xuICAgICAgICAgICAgICAgICAgICBpdGVtLnRhcmdldC5zZXRYWShmMSwgZjIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF2YWx1ZS5iMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLmYxID0gaXRlbS50YXJnZXQueDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF2YWx1ZS5iMilcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLmYyID0gaXRlbS50YXJnZXQueTtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS50YXJnZXQuc2V0WFkodmFsdWUuZjEsIHZhbHVlLmYyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDEgLyogU2l6ZSAqLzpcbiAgICAgICAgICAgICAgICBpZiAoIXZhbHVlLmIxKVxuICAgICAgICAgICAgICAgICAgICB2YWx1ZS5mMSA9IGl0ZW0udGFyZ2V0LndpZHRoO1xuICAgICAgICAgICAgICAgIGlmICghdmFsdWUuYjIpXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLmYyID0gaXRlbS50YXJnZXQuaGVpZ2h0O1xuICAgICAgICAgICAgICAgIGl0ZW0udGFyZ2V0LnNldFNpemUodmFsdWUuZjEsIHZhbHVlLmYyKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMyAvKiBQaXZvdCAqLzpcbiAgICAgICAgICAgICAgICBpdGVtLnRhcmdldC5zZXRQaXZvdCh2YWx1ZS5mMSwgdmFsdWUuZjIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA0IC8qIEFscGhhICovOlxuICAgICAgICAgICAgICAgIGl0ZW0udGFyZ2V0LmFscGhhID0gdmFsdWUuZjE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDUgLyogUm90YXRpb24gKi86XG4gICAgICAgICAgICAgICAgaXRlbS50YXJnZXQucm90YXRpb24gPSB2YWx1ZS5pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAyIC8qIFNjYWxlICovOlxuICAgICAgICAgICAgICAgIGl0ZW0udGFyZ2V0LnNldFNjYWxlKHZhbHVlLmYxLCB2YWx1ZS5mMik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDEzIC8qIFNrZXcgKi86XG4gICAgICAgICAgICAgICAgaXRlbS50YXJnZXQuc2V0U2tldyh2YWx1ZS5mMSwgdmFsdWUuZjIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA2IC8qIENvbG9yICovOlxuICAgICAgICAgICAgICAgIGlmIChpc0NvbG9yR2VhcihpdGVtLnRhcmdldCkpXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0udGFyZ2V0LmNvbG9yID0gdmFsdWUuYztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNyAvKiBBbmltYXRpb24gKi86XG4gICAgICAgICAgICAgICAgaWYgKGlzQW5pbWF0aW9uR2VhcihpdGVtLnRhcmdldCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF2YWx1ZS5iMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLmkgPSBpdGVtLnRhcmdldC5mcmFtZTtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS50YXJnZXQuZnJhbWUgPSB2YWx1ZS5pO1xuICAgICAgICAgICAgICAgICAgICBpdGVtLnRhcmdldC5wbGF5aW5nID0gdmFsdWUuYjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDggLyogVmlzaWJsZSAqLzpcbiAgICAgICAgICAgICAgICBpdGVtLnRhcmdldC52aXNpYmxlID0gdmFsdWUuYjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMTAgLyogVHJhbnNpdGlvbiAqLzpcbiAgICAgICAgICAgICAgICBsZXQgdHJhbnMgPSBpdGVtLnRhcmdldC5nZXRUcmFuc2l0aW9uKHZhbHVlLnMpO1xuICAgICAgICAgICAgICAgIGlmICh0cmFucyAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5pID09IDApXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFucy5zdG9wKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHJhbnMucGxheWluZylcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zLiR0b3RhbFRpbWVzID0gdmFsdWUuaSA9PSAtMSA/IE51bWJlci5NQVhfVkFMVUUgOiB2YWx1ZS5pO1xuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY29tcGxldGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiR0b3RhbFRhc2tzKys7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kcmV2ZXJzZWQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnMucGxheVJldmVyc2UodGhpcy4kcGxheVRyYW5zQ29tcGxldGUsIHRoaXMsIGl0ZW0sIGl0ZW0udmFsdWUuaSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnMucGxheSh0aGlzLiRwbGF5VHJhbnNDb21wbGV0ZSwgdGhpcywgaXRlbSwgaXRlbS52YWx1ZS5pKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgOSAvKiBTb3VuZCAqLzpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kcGxheWluZyAmJiBpdGVtLnRpbWUgPj0gdGhpcy4kc3RhcnRUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdmFsdWUuYXVkaW9DbGlwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGkgPSBVSVBhY2thZ2UuZ2V0SXRlbUJ5VVJMKHZhbHVlLnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLmF1ZGlvQ2xpcCA9IHBpLm93bmVyLmdldEl0ZW1Bc3NldChwaSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmF1ZGlvQ2xpcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgRGVjbHMkMS5HUm9vdC5pbnN0LnBsYXlPbmVTaG90U291bmQodmFsdWUuYXVkaW9DbGlwLCB2YWx1ZS5mMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDExIC8qIFNoYWtlICovOlxuICAgICAgICAgICAgICAgIGl0ZW0uc3RhcnRWYWx1ZS5mMSA9IDA7IC8vb2Zmc2V0WFxuICAgICAgICAgICAgICAgIGl0ZW0uc3RhcnRWYWx1ZS5mMiA9IDA7IC8vb2Zmc2V0WVxuICAgICAgICAgICAgICAgIGl0ZW0uc3RhcnRWYWx1ZS5mMyA9IGl0ZW0udmFsdWUuZjI7IC8vc2hha2VQZXJpb2RcbiAgICAgICAgICAgICAgICBHVGltZXIuaW5zdC5hZGQoMSwgMCwgaXRlbS4kc2hha2UsIGl0ZW0sIFt0aGlzXSk7XG4gICAgICAgICAgICAgICAgdGhpcy4kdG90YWxUYXNrcysrO1xuICAgICAgICAgICAgICAgIGl0ZW0uY29tcGxldGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDEyIC8qIENvbG9yRmlsdGVyICovOlxuICAgICAgICAgICAgICAgIGl0ZW0udGFyZ2V0LnVwZGF0ZUNvbG9yQ29tcG9uZW50cyh2YWx1ZS5mMSwgdmFsdWUuZjIsIHZhbHVlLmYzLCB2YWx1ZS5mNCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaXRlbS50YXJnZXQuJGdlYXJMb2NrZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgLyoqQGludGVybmFsICovXG4gICAgJHNoYWtlSXRlbShpdGVtLCBlbGFwc2VkTVMpIHtcbiAgICAgICAgbGV0IHIgPSBNYXRoLmNlaWwoKGl0ZW0udmFsdWUuZjEgKiBpdGVtLnN0YXJ0VmFsdWUuZjMpIC8gaXRlbS52YWx1ZS5mMik7XG4gICAgICAgIGxldCByeCA9IChNYXRoLnJhbmRvbSgpICogMiAtIDEpICogcjtcbiAgICAgICAgbGV0IHJ5ID0gKE1hdGgucmFuZG9tKCkgKiAyIC0gMSkgKiByO1xuICAgICAgICByeCA9IHJ4ID4gMCA/IE1hdGguY2VpbChyeCkgOiBNYXRoLmZsb29yKHJ4KTtcbiAgICAgICAgcnkgPSByeSA+IDAgPyBNYXRoLmNlaWwocnkpIDogTWF0aC5mbG9vcihyeSk7XG4gICAgICAgIGl0ZW0udGFyZ2V0LiRnZWFyTG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgaXRlbS50YXJnZXQuc2V0WFkoaXRlbS50YXJnZXQueCAtIGl0ZW0uc3RhcnRWYWx1ZS5mMSArIHJ4LCBpdGVtLnRhcmdldC55IC0gaXRlbS5zdGFydFZhbHVlLmYyICsgcnkpO1xuICAgICAgICBpdGVtLnRhcmdldC4kZ2VhckxvY2tlZCA9IGZhbHNlO1xuICAgICAgICBpdGVtLnN0YXJ0VmFsdWUuZjEgPSByeDtcbiAgICAgICAgaXRlbS5zdGFydFZhbHVlLmYyID0gcnk7XG4gICAgICAgIGl0ZW0uc3RhcnRWYWx1ZS5mMyAtPSBlbGFwc2VkTVMgLyAxMDAwO1xuICAgICAgICBpZiAoaXRlbS5zdGFydFZhbHVlLmYzIDw9IDApIHtcbiAgICAgICAgICAgIGl0ZW0udGFyZ2V0LiRnZWFyTG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIGl0ZW0udGFyZ2V0LnNldFhZKGl0ZW0udGFyZ2V0LnggLSBpdGVtLnN0YXJ0VmFsdWUuZjEsIGl0ZW0udGFyZ2V0LnkgLSBpdGVtLnN0YXJ0VmFsdWUuZjIpO1xuICAgICAgICAgICAgaXRlbS50YXJnZXQuJGdlYXJMb2NrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGl0ZW0uY29tcGxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuJHRvdGFsVGFza3MtLTtcbiAgICAgICAgICAgIEdUaW1lci5pbnN0LnJlbW92ZShpdGVtLiRzaGFrZSwgaXRlbSk7XG4gICAgICAgICAgICB0aGlzLmNoZWNrQWxsQ29tcGxldGUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXR1cCh4bWwpIHtcbiAgICAgICAgdGhpcy5uYW1lID0geG1sLmF0dHJpYnV0ZXMubmFtZTtcbiAgICAgICAgbGV0IHN0ciA9IHhtbC5hdHRyaWJ1dGVzLm9wdGlvbnM7XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICB0aGlzLiRvcHRpb25zID0gcGFyc2VJbnQoc3RyKTtcbiAgICAgICAgdGhpcy4kYXV0b1BsYXkgPSB4bWwuYXR0cmlidXRlcy5hdXRvUGxheSA9PSAndHJ1ZSc7XG4gICAgICAgIGlmICh0aGlzLiRhdXRvUGxheSkge1xuICAgICAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMuYXV0b1BsYXlSZXBlYXQ7XG4gICAgICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgICAgIHRoaXMuYXV0b1BsYXlSZXBlYXQgPSBwYXJzZUludChzdHIpO1xuICAgICAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMuYXV0b1BsYXlEZWxheTtcbiAgICAgICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICAgICAgdGhpcy5hdXRvUGxheURlbGF5ID0gcGFyc2VGbG9hdChzdHIpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBjb2wgPSB4bWwuY2hpbGRyZW47XG4gICAgICAgIGNvbC5mb3JFYWNoKGN4bWwgPT4ge1xuICAgICAgICAgICAgaWYgKGN4bWwubm9kZU5hbWUgIT0gJ2l0ZW0nKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGxldCBpdGVtID0gbmV3IFRyYW5zaXRpb25JdGVtKCk7XG4gICAgICAgICAgICB0aGlzLiRpdGVtcy5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgaXRlbS50aW1lID0gcGFyc2VJbnQoY3htbC5hdHRyaWJ1dGVzLnRpbWUpIC8gVHJhbnNpdGlvbi5GUkFNRV9SQVRFO1xuICAgICAgICAgICAgaXRlbS50YXJnZXRJZCA9IGN4bWwuYXR0cmlidXRlcy50YXJnZXQ7XG4gICAgICAgICAgICBzdHIgPSBjeG1sLmF0dHJpYnV0ZXMudHlwZTtcbiAgICAgICAgICAgIHN3aXRjaCAoc3RyKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnWFknOlxuICAgICAgICAgICAgICAgICAgICBpdGVtLnR5cGUgPSAwIC8qIFhZICovO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdTaXplJzpcbiAgICAgICAgICAgICAgICAgICAgaXRlbS50eXBlID0gMSAvKiBTaXplICovO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdTY2FsZSc6XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0udHlwZSA9IDIgLyogU2NhbGUgKi87XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ1Bpdm90JzpcbiAgICAgICAgICAgICAgICAgICAgaXRlbS50eXBlID0gMyAvKiBQaXZvdCAqLztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnQWxwaGEnOlxuICAgICAgICAgICAgICAgICAgICBpdGVtLnR5cGUgPSA0IC8qIEFscGhhICovO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdSb3RhdGlvbic6XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0udHlwZSA9IDUgLyogUm90YXRpb24gKi87XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ0NvbG9yJzpcbiAgICAgICAgICAgICAgICAgICAgaXRlbS50eXBlID0gNiAvKiBDb2xvciAqLztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnQW5pbWF0aW9uJzpcbiAgICAgICAgICAgICAgICAgICAgaXRlbS50eXBlID0gNyAvKiBBbmltYXRpb24gKi87XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ1Zpc2libGUnOlxuICAgICAgICAgICAgICAgICAgICBpdGVtLnR5cGUgPSA4IC8qIFZpc2libGUgKi87XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ1NvdW5kJzpcbiAgICAgICAgICAgICAgICAgICAgaXRlbS50eXBlID0gOSAvKiBTb3VuZCAqLztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnVHJhbnNpdGlvbic6XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0udHlwZSA9IDEwIC8qIFRyYW5zaXRpb24gKi87XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ1NoYWtlJzpcbiAgICAgICAgICAgICAgICAgICAgaXRlbS50eXBlID0gMTEgLyogU2hha2UgKi87XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ0NvbG9yRmlsdGVyJzpcbiAgICAgICAgICAgICAgICAgICAgaXRlbS50eXBlID0gMTIgLyogQ29sb3JGaWx0ZXIgKi87XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ1NrZXcnOlxuICAgICAgICAgICAgICAgICAgICBpdGVtLnR5cGUgPSAxMyAvKiBTa2V3ICovO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBpdGVtLnR5cGUgPSAxNCAvKiBVbmtub3duICovO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGl0ZW0udHdlZW4gPSBjeG1sLmF0dHJpYnV0ZXMudHdlZW4gPT0gJ3RydWUnO1xuICAgICAgICAgICAgaXRlbS5sYWJlbCA9IGN4bWwuYXR0cmlidXRlcy5sYWJlbDtcbiAgICAgICAgICAgIGlmIChpdGVtLnR3ZWVuKSB7XG4gICAgICAgICAgICAgICAgaXRlbS5kdXJhdGlvbiA9IHBhcnNlSW50KGN4bWwuYXR0cmlidXRlcy5kdXJhdGlvbikgLyBUcmFuc2l0aW9uLkZSQU1FX1JBVEU7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0udGltZSArIGl0ZW0uZHVyYXRpb24gPiB0aGlzLiRtYXhUaW1lKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRtYXhUaW1lID0gaXRlbS50aW1lICsgaXRlbS5kdXJhdGlvbjtcbiAgICAgICAgICAgICAgICBzdHIgPSBjeG1sLmF0dHJpYnV0ZXMuZWFzZTtcbiAgICAgICAgICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgICAgICAgICBpdGVtLmVhc2VUeXBlID0gUGFyc2VFYXNlVHlwZShzdHIpO1xuICAgICAgICAgICAgICAgIHN0ciA9IGN4bWwuYXR0cmlidXRlcy5yZXBlYXQ7XG4gICAgICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5yZXBlYXQgPSBwYXJzZUludChzdHIpO1xuICAgICAgICAgICAgICAgIGl0ZW0ueW95byA9IGN4bWwuYXR0cmlidXRlcy55b3lvID09ICd0cnVlJztcbiAgICAgICAgICAgICAgICBpdGVtLmxhYmVsMiA9IGN4bWwuYXR0cmlidXRlcy5sYWJlbDI7XG4gICAgICAgICAgICAgICAgbGV0IHYgPSBjeG1sLmF0dHJpYnV0ZXMuZW5kVmFsdWU7XG4gICAgICAgICAgICAgICAgaWYgKHYpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWNvZGVWYWx1ZShpdGVtLnR5cGUsIGN4bWwuYXR0cmlidXRlcy5zdGFydFZhbHVlLCBpdGVtLnN0YXJ0VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRlY29kZVZhbHVlKGl0ZW0udHlwZSwgdiwgaXRlbS5lbmRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpdGVtLnR3ZWVuID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVjb2RlVmFsdWUoaXRlbS50eXBlLCBjeG1sLmF0dHJpYnV0ZXMuc3RhcnRWYWx1ZSwgaXRlbS52YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0udGltZSA+IHRoaXMuJG1heFRpbWUpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJG1heFRpbWUgPSBpdGVtLnRpbWU7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWNvZGVWYWx1ZShpdGVtLnR5cGUsIGN4bWwuYXR0cmlidXRlcy52YWx1ZSwgaXRlbS52YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpO1xuICAgIH1cbiAgICBkZWNvZGVWYWx1ZSh0eXBlLCBzdHIsIHZhbHVlKSB7XG4gICAgICAgIGxldCBhcnI7XG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICAgICAgY2FzZSAwIC8qIFhZICovOlxuICAgICAgICAgICAgY2FzZSAxIC8qIFNpemUgKi86XG4gICAgICAgICAgICBjYXNlIDMgLyogUGl2b3QgKi86XG4gICAgICAgICAgICBjYXNlIDEzIC8qIFNrZXcgKi86XG4gICAgICAgICAgICAgICAgYXJyID0gc3RyLnNwbGl0KCcsJyk7XG4gICAgICAgICAgICAgICAgaWYgKGFyclswXSA9PSAnLScpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUuYjEgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLmYxID0gcGFyc2VGbG9hdChhcnJbMF0pO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZS5iMSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChhcnJbMV0gPT0gJy0nKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLmIyID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZS5mMiA9IHBhcnNlRmxvYXQoYXJyWzFdKTtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUuYjIgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNCAvKiBBbHBoYSAqLzpcbiAgICAgICAgICAgICAgICB2YWx1ZS5mMSA9IHBhcnNlRmxvYXQoc3RyKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNSAvKiBSb3RhdGlvbiAqLzpcbiAgICAgICAgICAgICAgICB2YWx1ZS5pID0gcGFyc2VJbnQoc3RyKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMiAvKiBTY2FsZSAqLzpcbiAgICAgICAgICAgICAgICBhcnIgPSBzdHIuc3BsaXQoJywnKTtcbiAgICAgICAgICAgICAgICB2YWx1ZS5mMSA9IHBhcnNlRmxvYXQoYXJyWzBdKTtcbiAgICAgICAgICAgICAgICB2YWx1ZS5mMiA9IHBhcnNlRmxvYXQoYXJyWzFdKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNiAvKiBDb2xvciAqLzpcbiAgICAgICAgICAgICAgICB2YWx1ZS5jID0gU3RyaW5nVXRpbC5IRVgyUkdCKHN0cik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDcgLyogQW5pbWF0aW9uICovOlxuICAgICAgICAgICAgICAgIGFyciA9IHN0ci5zcGxpdCgnLCcpO1xuICAgICAgICAgICAgICAgIGlmIChhcnJbMF0gPT0gJy0nKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLmIxID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZS5pID0gcGFyc2VJbnQoYXJyWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUuYjEgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YWx1ZS5iID0gYXJyWzFdID09ICdwJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgOCAvKiBWaXNpYmxlICovOlxuICAgICAgICAgICAgICAgIHZhbHVlLmIgPSBzdHIgPT0gJ3RydWUnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA5IC8qIFNvdW5kICovOlxuICAgICAgICAgICAgICAgIGFyciA9IHN0ci5zcGxpdCgnLCcpO1xuICAgICAgICAgICAgICAgIHZhbHVlLnMgPSBhcnJbMF07XG4gICAgICAgICAgICAgICAgaWYgKGFyci5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBpbnR2ID0gcGFyc2VJbnQoYXJyWzFdKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGludHYgPT0gMCB8fCBpbnR2ID09IDEwMClcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLmYxID0gMTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUuZjEgPSBpbnR2IC8gMTAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLmYxID0gMTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMTAgLyogVHJhbnNpdGlvbiAqLzpcbiAgICAgICAgICAgICAgICBhcnIgPSBzdHIuc3BsaXQoJywnKTtcbiAgICAgICAgICAgICAgICB2YWx1ZS5zID0gYXJyWzBdO1xuICAgICAgICAgICAgICAgIGlmIChhcnIubGVuZ3RoID4gMSlcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUuaSA9IHBhcnNlSW50KGFyclsxXSk7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB2YWx1ZS5pID0gMTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMTEgLyogU2hha2UgKi86XG4gICAgICAgICAgICAgICAgYXJyID0gc3RyLnNwbGl0KCcsJyk7XG4gICAgICAgICAgICAgICAgdmFsdWUuZjEgPSBwYXJzZUZsb2F0KGFyclswXSk7XG4gICAgICAgICAgICAgICAgdmFsdWUuZjIgPSBwYXJzZUZsb2F0KGFyclsxXSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDEyIC8qIENvbG9yRmlsdGVyICovOlxuICAgICAgICAgICAgICAgIGFyciA9IHN0ci5zcGxpdCgnLCcpO1xuICAgICAgICAgICAgICAgIHZhbHVlLmYxID0gcGFyc2VGbG9hdChhcnJbMF0pO1xuICAgICAgICAgICAgICAgIHZhbHVlLmYyID0gcGFyc2VGbG9hdChhcnJbMV0pO1xuICAgICAgICAgICAgICAgIHZhbHVlLmYzID0gcGFyc2VGbG9hdChhcnJbMl0pO1xuICAgICAgICAgICAgICAgIHZhbHVlLmY0ID0gcGFyc2VGbG9hdChhcnJbM10pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxufVxuVHJhbnNpdGlvbi5PUFRJT05fSUdOT1JFX0RJU1BMQVlfQ09OVFJPTExFUiA9IDE7XG5UcmFuc2l0aW9uLk9QVElPTl9BVVRPX1NUT1BfRElTQUJMRUQgPSAxID4+IDE7XG5UcmFuc2l0aW9uLk9QVElPTl9BVVRPX1NUT1BfQVRfRU5EID0gMSA+PiAyO1xuVHJhbnNpdGlvbi5GUkFNRV9SQVRFID0gMjQ7XG5jbGFzcyBUcmFuc2l0aW9uSXRlbSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgICAgIHRoaXMudHlwZSA9IDA7XG4gICAgICAgIHRoaXMuZHVyYXRpb24gPSAwO1xuICAgICAgICB0aGlzLnJlcGVhdCA9IDA7XG4gICAgICAgIHRoaXMueW95byA9IGZhbHNlO1xuICAgICAgICB0aGlzLnR3ZWVuID0gZmFsc2U7XG4gICAgICAgIHRoaXMudHdlZW5UaW1lcyA9IDA7XG4gICAgICAgIHRoaXMuY29tcGxldGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMubG9ja1Rva2VuID0gMDtcbiAgICAgICAgdGhpcy5lYXNlVHlwZSA9IFBhcnNlRWFzZVR5cGUoJ1F1YWQuT3V0Jyk7XG4gICAgICAgIHRoaXMudmFsdWUgPSBuZXcgVHJhbnNpdGlvblZhbHVlKCk7XG4gICAgICAgIHRoaXMuc3RhcnRWYWx1ZSA9IG5ldyBUcmFuc2l0aW9uVmFsdWUoKTtcbiAgICAgICAgdGhpcy5lbmRWYWx1ZSA9IG5ldyBUcmFuc2l0aW9uVmFsdWUoKTtcbiAgICB9XG4gICAgLyoqQGludGVybmFsICovXG4gICAgJHNoYWtlKHRyYW5zLCBlbGFwc2VkTVMpIHtcbiAgICAgICAgdHJhbnMuJHNoYWtlSXRlbSh0aGlzLCBlbGFwc2VkTVMpO1xuICAgIH1cbn1cbmNsYXNzIFRyYW5zaXRpb25WYWx1ZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuZjEgPSAwO1xuICAgICAgICB0aGlzLmYyID0gMDtcbiAgICAgICAgdGhpcy5mMyA9IDA7XG4gICAgICAgIHRoaXMuZjQgPSAwO1xuICAgICAgICB0aGlzLmkgPSAwO1xuICAgICAgICB0aGlzLmIgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5iMSA9IHRydWU7XG4gICAgICAgIHRoaXMuYjIgPSB0cnVlO1xuICAgIH1cbn1cblxuY2xhc3MgTWFyZ2luIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5sZWZ0ID0gMDtcbiAgICAgICAgdGhpcy5yaWdodCA9IDA7XG4gICAgICAgIHRoaXMudG9wID0gMDtcbiAgICAgICAgdGhpcy5ib3R0b20gPSAwO1xuICAgIH1cbiAgICBwYXJzZShzdHIpIHtcbiAgICAgICAgaWYgKCFzdHIpIHtcbiAgICAgICAgICAgIHRoaXMubGVmdCA9IHRoaXMucmlnaHQgPSB0aGlzLnRvcCA9IHRoaXMuYm90dG9tID0gMDtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgYXJyID0gc3RyLnNwbGl0KFwiLFwiKTtcbiAgICAgICAgaWYgKGFyci5sZW5ndGggPT0gMSkge1xuICAgICAgICAgICAgbGV0IGsgPSBwYXJzZUludChhcnJbMF0pO1xuICAgICAgICAgICAgdGhpcy5sZWZ0ID0gdGhpcy5yaWdodCA9IHRoaXMudG9wID0gdGhpcy5ib3R0b20gPSBrO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50b3AgPSBwYXJzZUludChhcnJbMF0pO1xuICAgICAgICAgICAgdGhpcy5ib3R0b20gPSBwYXJzZUludChhcnJbMV0pO1xuICAgICAgICAgICAgdGhpcy5sZWZ0ID0gcGFyc2VJbnQoYXJyWzJdKTtcbiAgICAgICAgICAgIHRoaXMucmlnaHQgPSBwYXJzZUludChhcnJbM10pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvcHkoc291cmNlKSB7XG4gICAgICAgIHRoaXMudG9wID0gc291cmNlLnRvcDtcbiAgICAgICAgdGhpcy5ib3R0b20gPSBzb3VyY2UuYm90dG9tO1xuICAgICAgICB0aGlzLmxlZnQgPSBzb3VyY2UubGVmdDtcbiAgICAgICAgdGhpcy5yaWdodCA9IHNvdXJjZS5yaWdodDtcbiAgICB9XG59XG5cbmNsYXNzIEdDb21wb25lbnQgZXh0ZW5kcyBHT2JqZWN0IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy4kc29ydGluZ0NoaWxkQ291bnQgPSAwO1xuICAgICAgICB0aGlzLiRjaGlsZHJlbiA9IFtdO1xuICAgICAgICB0aGlzLiRjb250cm9sbGVycyA9IFtdO1xuICAgICAgICB0aGlzLiR0cmFuc2l0aW9ucyA9IFtdO1xuICAgICAgICB0aGlzLiRtYXJnaW4gPSBuZXcgTWFyZ2luKCk7XG4gICAgICAgIHRoaXMuJGFsaWduT2Zmc2V0ID0gbmV3IGNyZWF0ZWpzLlBvaW50KCk7XG4gICAgfVxuICAgIGNyZWF0ZURpc3BsYXlPYmplY3QoKSB7XG4gICAgICAgIHRoaXMuJHJvb3RDb250YWluZXIgPSBuZXcgVUlDb250YWluZXIodGhpcyk7XG4gICAgICAgIHRoaXMuc2V0RGlzcGxheU9iamVjdCh0aGlzLiRyb290Q29udGFpbmVyKTtcbiAgICAgICAgdGhpcy4kY29udGFpbmVyID0gdGhpcy4kcm9vdENvbnRhaW5lcjtcbiAgICB9XG4gICAgZGlzcG9zZSgpIHtcbiAgICAgICAgR1RpbWVyLmluc3QucmVtb3ZlKHRoaXMuJHZhbGlkYXRlLCB0aGlzKTtcbiAgICAgICAgdGhpcy5vZmYoJ2FkZGVkJywgdGhpcy4kYWRkZWQpO1xuICAgICAgICB0aGlzLm9mZigncmVtb3ZlZCcsIHRoaXMuJHJlbW92ZWQpO1xuICAgICAgICB0aGlzLiR0cmFuc2l0aW9ucy5mb3JFYWNoKCh0cmFucykgPT4ge1xuICAgICAgICAgICAgdHJhbnMuZGlzcG9zZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgbGV0IG51bUNoaWxkcmVuID0gdGhpcy4kY2hpbGRyZW4ubGVuZ3RoO1xuICAgICAgICBmb3IgKGxldCBpID0gbnVtQ2hpbGRyZW4gLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgbGV0IG9iaiA9IHRoaXMuJGNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgb2JqLnBhcmVudCA9IG51bGw7IC8vYXZvaWQgcmVtb3ZlRnJvbVBhcmVudCBjYWxsXG4gICAgICAgICAgICBvYmouZGlzcG9zZSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuJGJvdW5kc0NoYW5nZWQgPSBmYWxzZTtcbiAgICAgICAgaWYgKHRoaXMuJHNjcm9sbFBhbmUpXG4gICAgICAgICAgICB0aGlzLiRzY3JvbGxQYW5lLmRpc3Bvc2UoKTtcbiAgICAgICAgc3VwZXIuZGlzcG9zZSgpO1xuICAgIH1cbiAgICBnZXQgZGlzcGxheUxpc3RDb250YWluZXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRjb250YWluZXI7XG4gICAgfVxuICAgIGFkZENoaWxkKGNoaWxkKSB7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGRBdChjaGlsZCwgdGhpcy4kY2hpbGRyZW4ubGVuZ3RoKTtcbiAgICAgICAgcmV0dXJuIGNoaWxkO1xuICAgIH1cbiAgICBhZGRDaGlsZEF0KGNoaWxkLCBpbmRleCA9IDApIHtcbiAgICAgICAgaWYgKCFjaGlsZClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBjaGlsZCcpO1xuICAgICAgICBsZXQgbnVtQ2hpbGRyZW4gPSB0aGlzLiRjaGlsZHJlbi5sZW5ndGg7XG4gICAgICAgIGlmIChpbmRleCA+PSAwICYmIGluZGV4IDw9IG51bUNoaWxkcmVuKSB7XG4gICAgICAgICAgICBpZiAoY2hpbGQucGFyZW50ID09IHRoaXMpXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDaGlsZEluZGV4KGNoaWxkLCBpbmRleCk7XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjaGlsZC5yZW1vdmVGcm9tUGFyZW50KCk7XG4gICAgICAgICAgICAgICAgY2hpbGQucGFyZW50ID0gdGhpcztcbiAgICAgICAgICAgICAgICBsZXQgY250ID0gdGhpcy4kY2hpbGRyZW4ubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmIChjaGlsZC5zb3J0aW5nT3JkZXIgIT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRzb3J0aW5nQ2hpbGRDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICBpbmRleCA9IHRoaXMuZ2V0SW5zZXJ0UG9zRm9yU29ydGluZ0NoaWxkKGNoaWxkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy4kc29ydGluZ0NoaWxkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+IGNudCAtIHRoaXMuJHNvcnRpbmdDaGlsZENvdW50KVxuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBjbnQgLSB0aGlzLiRzb3J0aW5nQ2hpbGRDb3VudDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID09IGNudClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kY2hpbGRyZW4ucHVzaChjaGlsZCk7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDAsIGNoaWxkKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNoaWxkU3RhdGVDaGFuZ2VkKGNoaWxkKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEJvdW5kc0NoYW5nZWRGbGFnKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY2hpbGQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGNoaWxkIGluZGV4Jyk7XG4gICAgfVxuICAgIGdldEluc2VydFBvc0ZvclNvcnRpbmdDaGlsZCh0YXJnZXQpIHtcbiAgICAgICAgbGV0IGNudCA9IHRoaXMuJGNoaWxkcmVuLmxlbmd0aDtcbiAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY250OyBpKyspIHtcbiAgICAgICAgICAgIGxldCBjaGlsZCA9IHRoaXMuJGNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgaWYgKGNoaWxkID09IHRhcmdldClcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIGlmICh0YXJnZXQuc29ydGluZ09yZGVyIDwgY2hpbGQuc29ydGluZ09yZGVyKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpO1xuICAgIH1cbiAgICByZW1vdmVDaGlsZChjaGlsZCwgZGlzcG9zZSA9IGZhbHNlKSB7XG4gICAgICAgIGxldCBjaGlsZEluZGV4ID0gdGhpcy4kY2hpbGRyZW4uaW5kZXhPZihjaGlsZCk7XG4gICAgICAgIGlmIChjaGlsZEluZGV4ICE9IC0xKVxuICAgICAgICAgICAgdGhpcy5yZW1vdmVDaGlsZEF0KGNoaWxkSW5kZXgsIGRpc3Bvc2UpO1xuICAgICAgICByZXR1cm4gY2hpbGQ7XG4gICAgfVxuICAgIHJlbW92ZUNoaWxkQXQoaW5kZXgsIGRpc3Bvc2UgPSBmYWxzZSkge1xuICAgICAgICBpZiAoaW5kZXggPj0gMCAmJiBpbmRleCA8IHRoaXMubnVtQ2hpbGRyZW4pIHtcbiAgICAgICAgICAgIGxldCBjaGlsZCA9IHRoaXMuJGNoaWxkcmVuW2luZGV4XTtcbiAgICAgICAgICAgIGNoaWxkLnBhcmVudCA9IG51bGw7XG4gICAgICAgICAgICBpZiAoY2hpbGQuc29ydGluZ09yZGVyICE9IDApXG4gICAgICAgICAgICAgICAgdGhpcy4kc29ydGluZ0NoaWxkQ291bnQtLTtcbiAgICAgICAgICAgIHRoaXMuJGNoaWxkcmVuLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICBpZiAoY2hpbGQuaW5Db250YWluZXIpXG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnJlbW92ZUNoaWxkKGNoaWxkLmRpc3BsYXlPYmplY3QpO1xuICAgICAgICAgICAgaWYgKGRpc3Bvc2UgPT09IHRydWUpXG4gICAgICAgICAgICAgICAgY2hpbGQuZGlzcG9zZSgpO1xuICAgICAgICAgICAgdGhpcy5zZXRCb3VuZHNDaGFuZ2VkRmxhZygpO1xuICAgICAgICAgICAgcmV0dXJuIGNoaWxkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBjaGlsZCBpbmRleCcpO1xuICAgIH1cbiAgICByZW1vdmVDaGlsZHJlbihiZWdpbkluZGV4ID0gMCwgZW5kSW5kZXggPSAtMSwgZGlzcG9zZSA9IGZhbHNlKSB7XG4gICAgICAgIGlmIChlbmRJbmRleCA8IDAgfHwgZW5kSW5kZXggPj0gdGhpcy5udW1DaGlsZHJlbilcbiAgICAgICAgICAgIGVuZEluZGV4ID0gdGhpcy5udW1DaGlsZHJlbiAtIDE7XG4gICAgICAgIGZvciAobGV0IGkgPSBiZWdpbkluZGV4OyBpIDw9IGVuZEluZGV4OyArK2kpXG4gICAgICAgICAgICB0aGlzLnJlbW92ZUNoaWxkQXQoYmVnaW5JbmRleCwgZGlzcG9zZSk7XG4gICAgfVxuICAgIGdldENoaWxkQXQoaW5kZXggPSAwKSB7XG4gICAgICAgIGlmIChpbmRleCA+PSAwICYmIGluZGV4IDwgdGhpcy5udW1DaGlsZHJlbilcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiRjaGlsZHJlbltpbmRleF07XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBjaGlsZCBpbmRleCcpO1xuICAgIH1cbiAgICBnZXRDaGlsZChuYW1lKSB7XG4gICAgICAgIGxldCBjbnQgPSB0aGlzLiRjaGlsZHJlbi5sZW5ndGg7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY250OyArK2kpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRjaGlsZHJlbltpXS5uYW1lID09IG5hbWUpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGNoaWxkcmVuW2ldO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBnZXRDaGlsZEluR3JvdXAobmFtZSwgZ3JvdXApIHtcbiAgICAgICAgbGV0IGNudCA9IHRoaXMuJGNoaWxkcmVuLmxlbmd0aDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjbnQ7ICsraSkge1xuICAgICAgICAgICAgbGV0IGNoaWxkID0gdGhpcy4kY2hpbGRyZW5baV07XG4gICAgICAgICAgICBpZiAoY2hpbGQuZ3JvdXAgPT0gZ3JvdXAgJiYgY2hpbGQubmFtZSA9PSBuYW1lKVxuICAgICAgICAgICAgICAgIHJldHVybiBjaGlsZDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgZ2V0Q2hpbGRCeUlkKGlkKSB7XG4gICAgICAgIGxldCBjbnQgPSB0aGlzLiRjaGlsZHJlbi5sZW5ndGg7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY250OyArK2kpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRjaGlsZHJlbltpXS5pZCA9PSBpZClcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kY2hpbGRyZW5baV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGdldENoaWxkSW5kZXgoY2hpbGQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGNoaWxkcmVuLmluZGV4T2YoY2hpbGQpO1xuICAgIH1cbiAgICBzZXRDaGlsZEluZGV4KGNoaWxkLCBpbmRleCA9IDApIHtcbiAgICAgICAgbGV0IG9sZEluZGV4ID0gdGhpcy4kY2hpbGRyZW4uaW5kZXhPZihjaGlsZCk7XG4gICAgICAgIGlmIChvbGRJbmRleCA9PSAtMSlcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignbm8gc3VjaCBjaGlsZCBmb3VuZCcpO1xuICAgICAgICBpZiAoY2hpbGQuc29ydGluZ09yZGVyICE9IDApXG4gICAgICAgICAgICAvL25vIGVmZmVjdFxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBsZXQgY250ID0gdGhpcy4kY2hpbGRyZW4ubGVuZ3RoO1xuICAgICAgICBpZiAodGhpcy4kc29ydGluZ0NoaWxkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICBpZiAoaW5kZXggPiBjbnQgLSB0aGlzLiRzb3J0aW5nQ2hpbGRDb3VudCAtIDEpXG4gICAgICAgICAgICAgICAgaW5kZXggPSBjbnQgLSB0aGlzLiRzb3J0aW5nQ2hpbGRDb3VudCAtIDE7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kc2V0Q2hpbGRJbmRleChjaGlsZCwgb2xkSW5kZXgsIGluZGV4KTtcbiAgICB9XG4gICAgc2V0Q2hpbGRJbmRleEJlZm9yZShjaGlsZCwgaW5kZXgpIHtcbiAgICAgICAgbGV0IG9sZEluZGV4ID0gdGhpcy4kY2hpbGRyZW4uaW5kZXhPZihjaGlsZCk7XG4gICAgICAgIGlmIChvbGRJbmRleCA9PSAtMSlcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignbm8gc3VjaCBjaGlsZCBmb3VuZCcpO1xuICAgICAgICBpZiAoY2hpbGQuc29ydGluZ09yZGVyICE9IDApXG4gICAgICAgICAgICAvL25vIGVmZmVjdFxuICAgICAgICAgICAgcmV0dXJuIG9sZEluZGV4O1xuICAgICAgICBsZXQgY250ID0gdGhpcy4kY2hpbGRyZW4ubGVuZ3RoO1xuICAgICAgICBpZiAodGhpcy4kc29ydGluZ0NoaWxkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICBpZiAoaW5kZXggPiBjbnQgLSB0aGlzLiRzb3J0aW5nQ2hpbGRDb3VudCAtIDEpXG4gICAgICAgICAgICAgICAgaW5kZXggPSBjbnQgLSB0aGlzLiRzb3J0aW5nQ2hpbGRDb3VudCAtIDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9sZEluZGV4IDwgaW5kZXgpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kc2V0Q2hpbGRJbmRleChjaGlsZCwgb2xkSW5kZXgsIGluZGV4IC0gMSk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiRzZXRDaGlsZEluZGV4KGNoaWxkLCBvbGRJbmRleCwgaW5kZXgpO1xuICAgIH1cbiAgICAkc2V0Q2hpbGRJbmRleChjaGlsZCwgb2xkSW5kZXgsIGluZGV4ID0gMCkge1xuICAgICAgICBsZXQgY250ID0gdGhpcy4kY2hpbGRyZW4ubGVuZ3RoO1xuICAgICAgICBpZiAoaW5kZXggPiBjbnQpXG4gICAgICAgICAgICBpbmRleCA9IGNudDtcbiAgICAgICAgaWYgKG9sZEluZGV4ID09IGluZGV4KVxuICAgICAgICAgICAgcmV0dXJuIG9sZEluZGV4O1xuICAgICAgICB0aGlzLiRjaGlsZHJlbi5zcGxpY2Uob2xkSW5kZXgsIDEpO1xuICAgICAgICB0aGlzLiRjaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDAsIGNoaWxkKTtcbiAgICAgICAgaWYgKGNoaWxkLmluQ29udGFpbmVyKSB7XG4gICAgICAgICAgICBsZXQgZGlzcGxheUluZGV4ID0gMDtcbiAgICAgICAgICAgIGxldCBjaGlsZENvdW50ID0gdGhpcy4kY29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5kZXg7IGkrKykge1xuICAgICAgICAgICAgICAgIGxldCBnID0gdGhpcy4kY2hpbGRyZW5baV07XG4gICAgICAgICAgICAgICAgaWYgKGcuaW5Db250YWluZXIpXG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlJbmRleCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRpc3BsYXlJbmRleCA9PSBjaGlsZENvdW50KVxuICAgICAgICAgICAgICAgIGRpc3BsYXlJbmRleC0tO1xuICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnNldENoaWxkSW5kZXgoY2hpbGQuZGlzcGxheU9iamVjdCwgZGlzcGxheUluZGV4KTtcbiAgICAgICAgICAgIHRoaXMuc2V0Qm91bmRzQ2hhbmdlZEZsYWcoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaW5kZXg7XG4gICAgfVxuICAgIHN3YXBDaGlsZHJlbihjaGlsZDEsIGNoaWxkMikge1xuICAgICAgICBsZXQgaW5kZXgxID0gdGhpcy4kY2hpbGRyZW4uaW5kZXhPZihjaGlsZDEpO1xuICAgICAgICBsZXQgaW5kZXgyID0gdGhpcy4kY2hpbGRyZW4uaW5kZXhPZihjaGlsZDIpO1xuICAgICAgICBpZiAoaW5kZXgxID09IC0xIHx8IGluZGV4MiA9PSAtMSlcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignbm8gc3VjaCBjaGlsZCBmb3VuZCcpO1xuICAgICAgICB0aGlzLnN3YXBDaGlsZHJlbkF0KGluZGV4MSwgaW5kZXgyKTtcbiAgICB9XG4gICAgc3dhcENoaWxkcmVuQXQoaW5kZXgxLCBpbmRleDIgPSAwKSB7XG4gICAgICAgIGxldCBjaGlsZDEgPSB0aGlzLiRjaGlsZHJlbltpbmRleDFdO1xuICAgICAgICBsZXQgY2hpbGQyID0gdGhpcy4kY2hpbGRyZW5baW5kZXgyXTtcbiAgICAgICAgdGhpcy5zZXRDaGlsZEluZGV4KGNoaWxkMSwgaW5kZXgyKTtcbiAgICAgICAgdGhpcy5zZXRDaGlsZEluZGV4KGNoaWxkMiwgaW5kZXgxKTtcbiAgICB9XG4gICAgZ2V0IG51bUNoaWxkcmVuKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kY2hpbGRyZW4ubGVuZ3RoO1xuICAgIH1cbiAgICBpc0FuY2VzdG9yT2YoY2hpbGQpIHtcbiAgICAgICAgaWYgKGNoaWxkID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGxldCBwID0gY2hpbGQucGFyZW50O1xuICAgICAgICB3aGlsZSAocCkge1xuICAgICAgICAgICAgaWYgKHAgPT0gdGhpcylcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIHAgPSBwLnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGFkZENvbnRyb2xsZXIoY29udHJvbGxlcikge1xuICAgICAgICB0aGlzLiRjb250cm9sbGVycy5wdXNoKGNvbnRyb2xsZXIpO1xuICAgICAgICBjb250cm9sbGVyLiRwYXJlbnQgPSB0aGlzO1xuICAgICAgICB0aGlzLmFwcGx5Q29udHJvbGxlcihjb250cm9sbGVyKTtcbiAgICB9XG4gICAgZ2V0Q29udHJvbGxlckF0KGluZGV4KSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRjb250cm9sbGVyc1tpbmRleF07XG4gICAgfVxuICAgIGdldENvbnRyb2xsZXIobmFtZSkge1xuICAgICAgICBsZXQgY250ID0gdGhpcy4kY29udHJvbGxlcnMubGVuZ3RoO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNudDsgKytpKSB7XG4gICAgICAgICAgICBsZXQgYyA9IHRoaXMuJGNvbnRyb2xsZXJzW2ldO1xuICAgICAgICAgICAgaWYgKGMubmFtZSA9PSBuYW1lKVxuICAgICAgICAgICAgICAgIHJldHVybiBjO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZW1vdmVDb250cm9sbGVyKGMpIHtcbiAgICAgICAgbGV0IGluZGV4ID0gdGhpcy4kY29udHJvbGxlcnMuaW5kZXhPZihjKTtcbiAgICAgICAgaWYgKGluZGV4ID09IC0xKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb250cm9sbGVyIG5vdCBleGlzdHMnKTtcbiAgICAgICAgYy4kcGFyZW50ID0gbnVsbDtcbiAgICAgICAgdGhpcy4kY29udHJvbGxlcnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgdGhpcy4kY2hpbGRyZW4uZm9yRWFjaChjaGlsZCA9PiB7XG4gICAgICAgICAgICBjaGlsZC5oYW5kbGVDb250cm9sbGVyQ2hhbmdlZChjKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldCBjb250cm9sbGVycygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGNvbnRyb2xsZXJzO1xuICAgIH1cbiAgICBjaGlsZFN0YXRlQ2hhbmdlZChjaGlsZCkge1xuICAgICAgICBpZiAodGhpcy4kYnVpbGRpbmdEaXNwbGF5TGlzdClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKGNoaWxkIGluc3RhbmNlb2YgR0dyb3VwKSB7XG4gICAgICAgICAgICB0aGlzLiRjaGlsZHJlbi5mb3JFYWNoKGcgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChnLmdyb3VwID09IGNoaWxkKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoaWxkU3RhdGVDaGFuZ2VkKGcpO1xuICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjaGlsZC5kaXNwbGF5T2JqZWN0KVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAoY2hpbGQuZmluYWxWaXNpYmxlKSB7XG4gICAgICAgICAgICBpZiAoIWNoaWxkLmRpc3BsYXlPYmplY3QucGFyZW50KSB7XG4gICAgICAgICAgICAgICAgbGV0IGluZGV4ID0gMDtcbiAgICAgICAgICAgICAgICBsZXQgbGVuID0gdGhpcy4kY2hpbGRyZW4ubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkxID0gMDsgaTEgPCBsZW47IGkxKyspIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGcgPSB0aGlzLiRjaGlsZHJlbltpMV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChnID09IGNoaWxkKVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGlmIChnLmRpc3BsYXlPYmplY3QgJiYgZy5kaXNwbGF5T2JqZWN0LnBhcmVudClcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci5hZGRDaGlsZEF0KGNoaWxkLmRpc3BsYXlPYmplY3QsIGluZGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChjaGlsZC5kaXNwbGF5T2JqZWN0LnBhcmVudClcbiAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXIucmVtb3ZlQ2hpbGQoY2hpbGQuZGlzcGxheU9iamVjdCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXBwbHlDb250cm9sbGVyKGMpIHtcbiAgICAgICAgdGhpcy4kYXBwbHlpbmdDb250cm9sbGVyID0gYztcbiAgICAgICAgdGhpcy4kY2hpbGRyZW4uZm9yRWFjaChjaGlsZCA9PiB7XG4gICAgICAgICAgICBjaGlsZC5oYW5kbGVDb250cm9sbGVyQ2hhbmdlZChjKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuJGFwcGx5aW5nQ29udHJvbGxlciA9IG51bGw7XG4gICAgICAgIGMuZXhlY3V0ZUFjdGlvbnMoKTtcbiAgICB9XG4gICAgYXBwbHlBbGxDb250cm9sbGVycygpIHtcbiAgICAgICAgdGhpcy4kY29udHJvbGxlcnMuZm9yRWFjaChjID0+IHtcbiAgICAgICAgICAgIHRoaXMuYXBwbHlDb250cm9sbGVyKGMpO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICB9XG4gICAgYWRqdXN0UmFkaW9Hcm91cERlcHRoKG9iaiwgYykge1xuICAgICAgICBsZXQgbXlJbmRleCA9IC0xLCBtYXhJbmRleCA9IC0xO1xuICAgICAgICB0aGlzLiRjaGlsZHJlbi5mb3JFYWNoKChjaGlsZCwgaSkgPT4ge1xuICAgICAgICAgICAgaWYgKGNoaWxkID09IG9iaikge1xuICAgICAgICAgICAgICAgIG15SW5kZXggPSBpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoKFwicmVsYXRlZENvbnRyb2xsZXJcIiBpbiBjaGlsZCkgJiYgY2hpbGQucmVsYXRlZENvbnRyb2xsZXIgPT0gYykge1xuICAgICAgICAgICAgICAgIGlmIChpID4gbWF4SW5kZXgpXG4gICAgICAgICAgICAgICAgICAgIG1heEluZGV4ID0gaTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChteUluZGV4IDwgbWF4SW5kZXgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRhcHBseWluZ0NvbnRyb2xsZXIgIT0gbnVsbClcbiAgICAgICAgICAgICAgICB0aGlzLiRjaGlsZHJlblttYXhJbmRleF0uaGFuZGxlQ29udHJvbGxlckNoYW5nZWQodGhpcy4kYXBwbHlpbmdDb250cm9sbGVyKTsgLy9UT0RPOiB0d2ljZVxuICAgICAgICAgICAgdGhpcy5zd2FwQ2hpbGRyZW5BdChteUluZGV4LCBtYXhJbmRleCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0VHJhbnNpdGlvbkF0KGluZGV4KSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR0cmFuc2l0aW9uc1tpbmRleF07XG4gICAgfVxuICAgIGdldFRyYW5zaXRpb24odHJhbnNOYW1lKSB7XG4gICAgICAgIGxldCBjbnQgPSB0aGlzLiR0cmFuc2l0aW9ucy5sZW5ndGg7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY250OyArK2kpIHtcbiAgICAgICAgICAgIGxldCB0cmFucyA9IHRoaXMuJHRyYW5zaXRpb25zW2ldO1xuICAgICAgICAgICAgaWYgKHRyYW5zLm5hbWUgPT0gdHJhbnNOYW1lKVxuICAgICAgICAgICAgICAgIHJldHVybiB0cmFucztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgaXNDaGlsZEluVmlldyhjaGlsZCkge1xuICAgICAgICBpZiAodGhpcy4kcm9vdENvbnRhaW5lci5zY3JvbGxSZWN0ICE9IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiAoY2hpbGQueCArIGNoaWxkLndpZHRoID49IDAgJiZcbiAgICAgICAgICAgICAgICBjaGlsZC54IDw9IHRoaXMud2lkdGggJiZcbiAgICAgICAgICAgICAgICBjaGlsZC55ICsgY2hpbGQuaGVpZ2h0ID49IDAgJiZcbiAgICAgICAgICAgICAgICBjaGlsZC55IDw9IHRoaXMuaGVpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLiRzY3JvbGxQYW5lICE9IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiRzY3JvbGxQYW5lLmlzQ2hpbGRJblZpZXcoY2hpbGQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBnZXRGaXJzdENoaWxkSW5WaWV3KCkge1xuICAgICAgICBsZXQgY250ID0gdGhpcy4kY2hpbGRyZW4ubGVuZ3RoO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNudDsgKytpKSB7XG4gICAgICAgICAgICBsZXQgY2hpbGQgPSB0aGlzLiRjaGlsZHJlbltpXTtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2hpbGRJblZpZXcoY2hpbGQpKVxuICAgICAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgZ2V0IHNjcm9sbFBhbmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRzY3JvbGxQYW5lO1xuICAgIH1cbiAgICBnZXQgb3BhcXVlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kb3BhcXVlO1xuICAgIH1cbiAgICBzZXQgb3BhcXVlKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiRvcGFxdWUgIT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuJG9wYXF1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgaWYgKHRoaXMuJG9wYXF1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlT3BhcXVlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kcm9vdENvbnRhaW5lci5oaXRBcmVhICYmXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHJvb3RDb250YWluZXIuaGl0QXJlYSBpbnN0YW5jZW9mIGNyZWF0ZWpzLkRpc3BsYXlPYmplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm9vdENvbnRhaW5lci5oaXRBcmVhID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IG1hcmdpbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJG1hcmdpbjtcbiAgICB9XG4gICAgc2V0IG1hcmdpbih2YWx1ZSkge1xuICAgICAgICB0aGlzLiRtYXJnaW4uY29weSh2YWx1ZSk7XG4gICAgICAgIGlmICh0aGlzLiRyb290Q29udGFpbmVyLnNjcm9sbFJlY3QgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnggPSB0aGlzLiRtYXJnaW4ubGVmdCArIHRoaXMuJGFsaWduT2Zmc2V0Lng7XG4gICAgICAgICAgICB0aGlzLiRjb250YWluZXIueSA9IHRoaXMuJG1hcmdpbi50b3AgKyB0aGlzLiRhbGlnbk9mZnNldC55O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaGFuZGxlU2l6ZUNoYW5nZWQoKTtcbiAgICB9XG4gICAgZ2V0IG1hc2soKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRyb290Q29udGFpbmVyLm1hc2s7XG4gICAgfVxuICAgIHNldCBtYXNrKG9iaikge1xuICAgICAgICBpZiAoIW9iailcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIGNyZWF0ZWpzLlNoYXBlKVxuICAgICAgICAgICAgdGhpcy4kcm9vdENvbnRhaW5lci5tYXNrID0gb2JqO1xuICAgIH1cbiAgICB1cGRhdGVPcGFxdWUoKSB7XG4gICAgICAgIC8vIHRvZG9cbiAgICAgICAgLy8gSWYgaGl0QXJlYSBzZXQgb24gYSBDb250YWluZXIsIGNoaWxkcmVuIG9mIHRoZSBDb250YWluZXIgd2lsbCBub3QgcmVjZWl2ZSBtb3VzZSBldmVudHMuICBcbiAgICAgICAgLy8gaWYgKCF0aGlzLiRoaXRBcmVhKSB7XG4gICAgICAgIC8vICAgICB0aGlzLiRoaXRBcmVhID0gbmV3IGNyZWF0ZWpzLlNoYXBlKCk7XG4gICAgICAgIC8vIH1cbiAgICAgICAgLy8gdGhpcy4kaGl0QXJlYS5ncmFwaGljcy5iZWdpbkZpbGwoJyMwMDAnKS5kcmF3UmVjdCgwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7IFxuICAgICAgICAvLyAoPGNyZWF0ZWpzLlNoYXBlPnRoaXMuJHJvb3RDb250YWluZXIuaGl0QXJlYSkgPSB0aGlzLiRoaXRBcmVhO1xuICAgIH1cbiAgICB1cGRhdGVTY3JvbGxSZWN0KCkge1xuICAgICAgICBsZXQgcmVjdCA9IHRoaXMuJHJvb3RDb250YWluZXIuc2Nyb2xsUmVjdDtcbiAgICAgICAgaWYgKHJlY3QgPT0gbnVsbClcbiAgICAgICAgICAgIHJlY3QgPSBuZXcgY3JlYXRlanMuUmVjdGFuZ2xlKCk7XG4gICAgICAgIGxldCB3ID0gdGhpcy53aWR0aCAtIHRoaXMuJG1hcmdpbi5yaWdodDtcbiAgICAgICAgbGV0IGggPSB0aGlzLmhlaWdodCAtIHRoaXMuJG1hcmdpbi5ib3R0b207XG4gICAgICAgIHJlY3QueCA9IHJlY3QueSA9IDA7XG4gICAgICAgIHJlY3Qud2lkdGggPSB3O1xuICAgICAgICByZWN0LmhlaWdodCA9IGg7XG4gICAgICAgIHRoaXMuJHJvb3RDb250YWluZXIuc2Nyb2xsUmVjdCA9IHJlY3Q7XG4gICAgfVxuICAgIHNldHVwU2Nyb2xsKHNjcm9sbEJhck1hcmdpbiwgc2Nyb2xsLCBzY3JvbGxCYXJEaXNwbGF5LCBmbGFncywgdnRTY3JvbGxCYXJSZXMsIGh6U2Nyb2xsQmFyUmVzLCBoZWFkZXJSZXMsIGZvb3RlclJlcykge1xuICAgICAgICBpZiAodGhpcy4kcm9vdENvbnRhaW5lciA9PSB0aGlzLiRjb250YWluZXIpIHtcbiAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lciA9IG5ldyBjcmVhdGVqcy5Db250YWluZXIoKTtcbiAgICAgICAgICAgIHRoaXMuJHJvb3RDb250YWluZXIuYWRkQ2hpbGQodGhpcy4kY29udGFpbmVyKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiRzY3JvbGxQYW5lID0gbmV3IFNjcm9sbFBhbmUodGhpcywgc2Nyb2xsLCBzY3JvbGxCYXJNYXJnaW4sIHNjcm9sbEJhckRpc3BsYXksIGZsYWdzLCB2dFNjcm9sbEJhclJlcywgaHpTY3JvbGxCYXJSZXMsIGhlYWRlclJlcywgZm9vdGVyUmVzKTtcbiAgICB9XG4gICAgc2V0dXBPdmVyZmxvdyhvdmVyZmxvdykge1xuICAgICAgICBpZiAob3ZlcmZsb3cgPT0gMSAvKiBIaWRkZW4gKi8pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRyb290Q29udGFpbmVyID09IHRoaXMuJGNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lciA9IG5ldyBjcmVhdGVqcy5Db250YWluZXIoKTtcbiAgICAgICAgICAgICAgICB0aGlzLiRyb290Q29udGFpbmVyLmFkZENoaWxkKHRoaXMuJGNvbnRhaW5lcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVNjcm9sbFJlY3QoKTtcbiAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci54ID0gdGhpcy4kbWFyZ2luLmxlZnQ7XG4gICAgICAgICAgICB0aGlzLiRjb250YWluZXIueSA9IHRoaXMuJG1hcmdpbi50b3A7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy4kbWFyZ2luLmxlZnQgIT0gMCB8fCB0aGlzLiRtYXJnaW4udG9wICE9IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRyb290Q29udGFpbmVyID09IHRoaXMuJGNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lciA9IG5ldyBjcmVhdGVqcy5Db250YWluZXIoKTtcbiAgICAgICAgICAgICAgICB0aGlzLiRyb290Q29udGFpbmVyLmFkZENoaWxkKHRoaXMuJGNvbnRhaW5lcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLiRjb250YWluZXIueCA9IHRoaXMuJG1hcmdpbi5sZWZ0O1xuICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnkgPSB0aGlzLiRtYXJnaW4udG9wO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0Qm91bmRzQ2hhbmdlZEZsYWcoKTtcbiAgICB9XG4gICAgaGFuZGxlU2l6ZUNoYW5nZWQoKSB7XG4gICAgICAgIGlmICh0aGlzLiRzY3JvbGxQYW5lKVxuICAgICAgICAgICAgdGhpcy4kc2Nyb2xsUGFuZS5vbk93bmVyU2l6ZUNoYW5nZWQoKTtcbiAgICAgICAgZWxzZSBpZiAodGhpcy4kcm9vdENvbnRhaW5lci5zY3JvbGxSZWN0ICE9IG51bGwpXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVNjcm9sbFJlY3QoKTtcbiAgICAgICAgaWYgKHRoaXMuJGhpdEFyZWEpXG4gICAgICAgICAgICB0aGlzLiRoaXRBcmVhLmdyYXBoaWNzLmRyYXdSZWN0KHRoaXMueCwgdGhpcy55LCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gICAgICAgIGlmICh0aGlzLnBhcmVudCAmJiB0aGlzLnBhcmVudC4kaGl0QXJlYSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coMSk7XG4gICAgICAgICAgICB0aGlzLnBhcmVudC4kZGlzcGxheU9iamVjdC5oaXRBcmVhID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy4kb3BhcXVlKVxuICAgICAgICAgICAgdGhpcy51cGRhdGVPcGFxdWUoKTtcbiAgICB9XG4gICAgaGFuZGxlR3JheWVkQ2hhbmdlZCgpIHtcbiAgICAgICAgbGV0IGMgPSB0aGlzLmdldENvbnRyb2xsZXIoJ2dyYXllZCcpO1xuICAgICAgICBpZiAoYyAhPSBudWxsKVxuICAgICAgICAgICAgYy5zZWxlY3RlZEluZGV4ID0gdGhpcy5ncmF5ZWQgPyAxIDogMDtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgc3VwZXIuaGFuZGxlR3JheWVkQ2hhbmdlZCgpO1xuICAgIH1cbiAgICBzZXRCb3VuZHNDaGFuZ2VkRmxhZygpIHtcbiAgICAgICAgaWYgKCF0aGlzLiRzY3JvbGxQYW5lICYmICF0aGlzLiR0cmFja0JvdW5kcylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKCF0aGlzLiRib3VuZHNDaGFuZ2VkKSB7XG4gICAgICAgICAgICB0aGlzLiRib3VuZHNDaGFuZ2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIEdUaW1lci5pbnN0LmNhbGxMYXRlcih0aGlzLiR2YWxpZGF0ZSwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgJHZhbGlkYXRlKGR0KSB7XG4gICAgICAgIGlmICh0aGlzLiRib3VuZHNDaGFuZ2VkKVxuICAgICAgICAgICAgdGhpcy51cGRhdGVCb3VuZHMoKTtcbiAgICB9XG4gICAgZW5zdXJlQm91bmRzQ29ycmVjdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuJGJvdW5kc0NoYW5nZWQpXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUJvdW5kcygpO1xuICAgIH1cbiAgICB1cGRhdGVCb3VuZHMoKSB7XG4gICAgICAgIGxldCBheCA9IDAsIGF5ID0gMCwgYXcgPSAwLCBhaCA9IDA7XG4gICAgICAgIGxldCBsZW4gPSB0aGlzLiRjaGlsZHJlbi5sZW5ndGg7XG4gICAgICAgIGlmIChsZW4gPiAwKSB7XG4gICAgICAgICAgICAoYXggPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpLCAoYXkgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpO1xuICAgICAgICAgICAgbGV0IGFyID0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLCBhYiA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWTtcbiAgICAgICAgICAgIGxldCB0bXAgPSAwO1xuICAgICAgICAgICAgdGhpcy4kY2hpbGRyZW4uZm9yRWFjaChjaGlsZCA9PiB7XG4gICAgICAgICAgICAgICAgY2hpbGQuZW5zdXJlU2l6ZUNvcnJlY3QoKTtcbiAgICAgICAgICAgICAgICB0bXAgPSBjaGlsZC54O1xuICAgICAgICAgICAgICAgIGlmICh0bXAgPCBheClcbiAgICAgICAgICAgICAgICAgICAgYXggPSB0bXA7XG4gICAgICAgICAgICAgICAgdG1wID0gY2hpbGQueTtcbiAgICAgICAgICAgICAgICBpZiAodG1wIDwgYXkpXG4gICAgICAgICAgICAgICAgICAgIGF5ID0gdG1wO1xuICAgICAgICAgICAgICAgIHRtcCA9IGNoaWxkLnggKyBjaGlsZC5hY3R1YWxXaWR0aDtcbiAgICAgICAgICAgICAgICBpZiAodG1wID4gYXIpXG4gICAgICAgICAgICAgICAgICAgIGFyID0gdG1wO1xuICAgICAgICAgICAgICAgIHRtcCA9IGNoaWxkLnkgKyBjaGlsZC5hY3R1YWxIZWlnaHQ7XG4gICAgICAgICAgICAgICAgaWYgKHRtcCA+IGFiKVxuICAgICAgICAgICAgICAgICAgICBhYiA9IHRtcDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYXcgPSBhciAtIGF4O1xuICAgICAgICAgICAgYWggPSBhYiAtIGF5O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0Qm91bmRzKGF4LCBheSwgYXcsIGFoKTtcbiAgICB9XG4gICAgc2V0Qm91bmRzKGF4LCBheSwgYXcsIGFoID0gMCkge1xuICAgICAgICB0aGlzLiRib3VuZHNDaGFuZ2VkID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLiRzY3JvbGxQYW5lKVxuICAgICAgICAgICAgdGhpcy4kc2Nyb2xsUGFuZS5zZXRDb250ZW50U2l6ZShNYXRoLnJvdW5kKGF4ICsgYXcpLCBNYXRoLnJvdW5kKGF5ICsgYWgpKTtcbiAgICB9XG4gICAgZ2V0IHZpZXdXaWR0aCgpIHtcbiAgICAgICAgaWYgKHRoaXMuJHNjcm9sbFBhbmUgIT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiRzY3JvbGxQYW5lLnZpZXdXaWR0aDtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMud2lkdGggLSB0aGlzLiRtYXJnaW4ubGVmdCAtIHRoaXMuJG1hcmdpbi5yaWdodDtcbiAgICB9XG4gICAgc2V0IHZpZXdXaWR0aCh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kc2Nyb2xsUGFuZSAhPSBudWxsKVxuICAgICAgICAgICAgdGhpcy4kc2Nyb2xsUGFuZS52aWV3V2lkdGggPSB2YWx1ZTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy53aWR0aCA9IHZhbHVlICsgdGhpcy4kbWFyZ2luLmxlZnQgKyB0aGlzLiRtYXJnaW4ucmlnaHQ7XG4gICAgfVxuICAgIGdldCB2aWV3SGVpZ2h0KCkge1xuICAgICAgICBpZiAodGhpcy4kc2Nyb2xsUGFuZSAhPSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHNjcm9sbFBhbmUudmlld0hlaWdodDtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGVpZ2h0IC0gdGhpcy4kbWFyZ2luLnRvcCAtIHRoaXMuJG1hcmdpbi5ib3R0b207XG4gICAgfVxuICAgIHNldCB2aWV3SGVpZ2h0KHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiRzY3JvbGxQYW5lICE9IG51bGwpXG4gICAgICAgICAgICB0aGlzLiRzY3JvbGxQYW5lLnZpZXdIZWlnaHQgPSB2YWx1ZTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSB2YWx1ZSArIHRoaXMuJG1hcmdpbi50b3AgKyB0aGlzLiRtYXJnaW4uYm90dG9tO1xuICAgIH1cbiAgICBnZXRTbmFwcGluZ1Bvc2l0aW9uKHhWYWx1ZSwgeVZhbHVlLCByZXN1bHRQb2ludCkge1xuICAgICAgICBpZiAoIXJlc3VsdFBvaW50KVxuICAgICAgICAgICAgcmVzdWx0UG9pbnQgPSBuZXcgY3JlYXRlanMuUG9pbnQoKTtcbiAgICAgICAgbGV0IGNudCA9IHRoaXMuJGNoaWxkcmVuLmxlbmd0aDtcbiAgICAgICAgaWYgKGNudCA8PSAwKSB7XG4gICAgICAgICAgICByZXN1bHRQb2ludC54ID0gMDtcbiAgICAgICAgICAgIHJlc3VsdFBvaW50LnkgPSAwO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFBvaW50O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZW5zdXJlQm91bmRzQ29ycmVjdCgpO1xuICAgICAgICBsZXQgb2JqID0gbnVsbDtcbiAgICAgICAgbGV0IHByZXYgPSBudWxsO1xuICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgIGlmICh5VmFsdWUgIT0gMCkge1xuICAgICAgICAgICAgZm9yICg7IGkgPCBjbnQ7IGkrKykge1xuICAgICAgICAgICAgICAgIG9iaiA9IHRoaXMuJGNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgICAgIGlmICh5VmFsdWUgPCBvYmoueSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB5VmFsdWUgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmV2ID0gdGhpcy4kY2hpbGRyZW5baSAtIDFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHlWYWx1ZSA8IHByZXYueSArIHByZXYuYWN0dWFsSGVpZ2h0IC8gMilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RvcCBoYWxmIHBhcnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5VmFsdWUgPSBwcmV2Lnk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2JvdHRvbSBoYWxmIHBhcnRcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5VmFsdWUgPSBvYmoueTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGkgPT0gY250KVxuICAgICAgICAgICAgICAgIHlWYWx1ZSA9IG9iai55O1xuICAgICAgICB9XG4gICAgICAgIGlmICh4VmFsdWUgIT0gMCkge1xuICAgICAgICAgICAgaWYgKGkgPiAwKVxuICAgICAgICAgICAgICAgIGktLTtcbiAgICAgICAgICAgIGZvciAoOyBpIDwgY250OyBpKyspIHtcbiAgICAgICAgICAgICAgICBvYmogPSB0aGlzLiRjaGlsZHJlbltpXTtcbiAgICAgICAgICAgICAgICBpZiAoeFZhbHVlIDwgb2JqLngpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgeFZhbHVlID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJldiA9IHRoaXMuJGNoaWxkcmVuW2kgLSAxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh4VmFsdWUgPCBwcmV2LnggKyBwcmV2LmFjdHVhbFdpZHRoIC8gMilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RvcCBoYWxmIHBhcnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4VmFsdWUgPSBwcmV2Lng7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2JvdHRvbSBoYWxmIHBhcnRcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4VmFsdWUgPSBvYmoueDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGkgPT0gY250KVxuICAgICAgICAgICAgICAgIHhWYWx1ZSA9IG9iai54O1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdFBvaW50LnggPSB4VmFsdWU7XG4gICAgICAgIHJlc3VsdFBvaW50LnkgPSB5VmFsdWU7XG4gICAgICAgIHJldHVybiByZXN1bHRQb2ludDtcbiAgICB9XG4gICAgY2hpbGRTb3J0aW5nT3JkZXJDaGFuZ2VkKGNoaWxkLCBvbGRWYWx1ZSwgbmV3VmFsdWUgPSAwKSB7XG4gICAgICAgIGlmIChuZXdWYWx1ZSA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLiRzb3J0aW5nQ2hpbGRDb3VudC0tO1xuICAgICAgICAgICAgdGhpcy5zZXRDaGlsZEluZGV4KGNoaWxkLCB0aGlzLiRjaGlsZHJlbi5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKG9sZFZhbHVlID09IDApXG4gICAgICAgICAgICAgICAgdGhpcy4kc29ydGluZ0NoaWxkQ291bnQrKztcbiAgICAgICAgICAgIGxldCBvbGRJbmRleCA9IHRoaXMuJGNoaWxkcmVuLmluZGV4T2YoY2hpbGQpO1xuICAgICAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5nZXRJbnNlcnRQb3NGb3JTb3J0aW5nQ2hpbGQoY2hpbGQpO1xuICAgICAgICAgICAgaWYgKG9sZEluZGV4IDwgaW5kZXgpXG4gICAgICAgICAgICAgICAgdGhpcy4kc2V0Q2hpbGRJbmRleChjaGlsZCwgb2xkSW5kZXgsIGluZGV4IC0gMSk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGhpcy4kc2V0Q2hpbGRJbmRleChjaGlsZCwgb2xkSW5kZXgsIGluZGV4KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3RGcm9tUmVzb3VyY2UoKSB7XG4gICAgICAgIHRoaXMuY29uc3RydWN0SW50ZXJuYWwobnVsbCwgMCk7XG4gICAgfVxuICAgIGNvbnN0cnVjdEludGVybmFsKG9iamVjdFBvb2wsIHBvb2xJbmRleCkge1xuICAgICAgICBsZXQgeG1sID0gdGhpcy5wYWNrYWdlSXRlbS5vd25lci5nZXRJdGVtQXNzZXQodGhpcy5wYWNrYWdlSXRlbSk7XG4gICAgICAgIHRoaXMuJGluUHJvZ3Jlc3NCdWlsZGluZyA9IHRydWU7XG4gICAgICAgIGxldCBzdHI7XG4gICAgICAgIGxldCBhcnI7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnNpemU7XG4gICAgICAgIGFyciA9IHN0ci5zcGxpdCgnLCcpO1xuICAgICAgICB0aGlzLiRzb3VyY2VXaWR0aCA9IHBhcnNlSW50KGFyclswXSk7XG4gICAgICAgIHRoaXMuJHNvdXJjZUhlaWdodCA9IHBhcnNlSW50KGFyclsxXSk7XG4gICAgICAgIHRoaXMuJGluaXRXaWR0aCA9IHRoaXMuJHNvdXJjZVdpZHRoO1xuICAgICAgICB0aGlzLiRpbml0SGVpZ2h0ID0gdGhpcy4kc291cmNlSGVpZ2h0O1xuICAgICAgICB0aGlzLnNldFNpemUodGhpcy4kc291cmNlV2lkdGgsIHRoaXMuJHNvdXJjZUhlaWdodCk7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnBpdm90O1xuICAgICAgICBpZiAoc3RyKSB7XG4gICAgICAgICAgICBhcnIgPSBzdHIuc3BsaXQoJywnKTtcbiAgICAgICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmFuY2hvcjtcbiAgICAgICAgICAgIHRoaXMuaW50ZXJuYWxTZXRQaXZvdChwYXJzZUZsb2F0KGFyclswXSksIHBhcnNlRmxvYXQoYXJyWzFdKSwgc3RyID09ICd0cnVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMub3BhcXVlOyAvLyBkZWZhdWx0IGZhbHNlXG4gICAgICAgIHRoaXMub3BhcXVlID0gc3RyICE9ICdmYWxzZSc7XG4gICAgICAgIGxldCBvdmVyZmxvdztcbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMub3ZlcmZsb3c7XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICBvdmVyZmxvdyA9IFBhcnNlT3ZlcmZsb3dUeXBlKHN0cik7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIG92ZXJmbG93ID0gMCAvKiBWaXNpYmxlICovO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5tYXJnaW47XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICB0aGlzLiRtYXJnaW4ucGFyc2Uoc3RyKTtcbiAgICAgICAgaWYgKG92ZXJmbG93ID09IDIgLyogU2Nyb2xsICovKSB7XG4gICAgICAgICAgICBsZXQgc2Nyb2xsO1xuICAgICAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMuc2Nyb2xsO1xuICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICBzY3JvbGwgPSBQYXJzZVNjcm9sbFR5cGUoc3RyKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBzY3JvbGwgPSAxIC8qIFZlcnRpY2FsICovO1xuICAgICAgICAgICAgbGV0IHNjcm9sbEJhckRpc3BsYXk7XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5zY3JvbGxCYXI7XG4gICAgICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgICAgIHNjcm9sbEJhckRpc3BsYXkgPSBQYXJzZVNjcm9sbEJhckRpc3BsYXlUeXBlKHN0cik7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgc2Nyb2xsQmFyRGlzcGxheSA9IDAgLyogRGVmYXVsdCAqLztcbiAgICAgICAgICAgIGxldCBzY3JvbGxCYXJGbGFncztcbiAgICAgICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnNjcm9sbEJhckZsYWdzO1xuICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICBzY3JvbGxCYXJGbGFncyA9IHBhcnNlSW50KHN0cik7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgc2Nyb2xsQmFyRmxhZ3MgPSAwO1xuICAgICAgICAgICAgbGV0IHNjcm9sbEJhck1hcmdpbiA9IG5ldyBNYXJnaW4oKTtcbiAgICAgICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnNjcm9sbEJhck1hcmdpbjtcbiAgICAgICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICAgICAgc2Nyb2xsQmFyTWFyZ2luLnBhcnNlKHN0cik7XG4gICAgICAgICAgICBsZXQgdnRTY3JvbGxCYXJSZXM7XG4gICAgICAgICAgICBsZXQgaHpTY3JvbGxCYXJSZXM7XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5zY3JvbGxCYXJSZXM7XG4gICAgICAgICAgICBpZiAoc3RyKSB7XG4gICAgICAgICAgICAgICAgYXJyID0gc3RyLnNwbGl0KCcsJyk7XG4gICAgICAgICAgICAgICAgdnRTY3JvbGxCYXJSZXMgPSBhcnJbMF07XG4gICAgICAgICAgICAgICAgaHpTY3JvbGxCYXJSZXMgPSBhcnJbMV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgaGVhZGVyUmVzLCBmb290ZXJSZXM7XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5wdHJSZXM7XG4gICAgICAgICAgICBpZiAoc3RyKSB7XG4gICAgICAgICAgICAgICAgYXJyID0gc3RyLnNwbGl0KCcsJyk7XG4gICAgICAgICAgICAgICAgaGVhZGVyUmVzID0gYXJyWzBdO1xuICAgICAgICAgICAgICAgIGZvb3RlclJlcyA9IGFyclsxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2V0dXBTY3JvbGwoc2Nyb2xsQmFyTWFyZ2luLCBzY3JvbGwsIHNjcm9sbEJhckRpc3BsYXksIHNjcm9sbEJhckZsYWdzLCB2dFNjcm9sbEJhclJlcywgaHpTY3JvbGxCYXJSZXMsIGhlYWRlclJlcywgZm9vdGVyUmVzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLnNldHVwT3ZlcmZsb3cob3ZlcmZsb3cpO1xuICAgICAgICB0aGlzLiRidWlsZGluZ0Rpc3BsYXlMaXN0ID0gdHJ1ZTtcbiAgICAgICAgbGV0IGNvbCA9IHhtbC5jaGlsZHJlbjtcbiAgICAgICAgY29sLmZvckVhY2goY3htbCA9PiB7XG4gICAgICAgICAgICBpZiAoY3htbC5ub2RlTmFtZSA9PSAnY29udHJvbGxlcicpIHtcbiAgICAgICAgICAgICAgICBsZXQgYyA9IG5ldyBDb250cm9sbGVyKCk7XG4gICAgICAgICAgICAgICAgdGhpcy4kY29udHJvbGxlcnMucHVzaChjKTtcbiAgICAgICAgICAgICAgICBjLiRwYXJlbnQgPSB0aGlzO1xuICAgICAgICAgICAgICAgIGMuc2V0dXAoY3htbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBsZXQgZGlzcGxheUxpc3QgPSB0aGlzLnBhY2thZ2VJdGVtLmRpc3BsYXlMaXN0O1xuICAgICAgICBkaXNwbGF5TGlzdC5mb3JFYWNoKChkaSwgaSkgPT4ge1xuICAgICAgICAgICAgbGV0IGNoaWxkO1xuICAgICAgICAgICAgaWYgKG9iamVjdFBvb2wgIT0gbnVsbClcbiAgICAgICAgICAgICAgICBjaGlsZCA9IG9iamVjdFBvb2xbcG9vbEluZGV4ICsgaV07XG4gICAgICAgICAgICBlbHNlIGlmIChkaS5wYWNrYWdlSXRlbSkge1xuICAgICAgICAgICAgICAgIGNoaWxkID0gRGVjbHMuVUlPYmplY3RGYWN0b3J5Lm5ld09iamVjdChkaS5wYWNrYWdlSXRlbSk7XG4gICAgICAgICAgICAgICAgY2hpbGQucGFja2FnZUl0ZW0gPSBkaS5wYWNrYWdlSXRlbTtcbiAgICAgICAgICAgICAgICBjaGlsZC5jb25zdHJ1Y3RGcm9tUmVzb3VyY2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBjaGlsZCA9IERlY2xzLlVJT2JqZWN0RmFjdG9yeS5uZXdPYmplY3REaXJlY3RseShkaS50eXBlKTtcbiAgICAgICAgICAgIGNoaWxkLiRpblByb2dyZXNzQnVpbGRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgY2hpbGQuc2V0dXBCZWZvcmVBZGQoZGkuZGVzYyk7XG4gICAgICAgICAgICBjaGlsZC5wYXJlbnQgPSB0aGlzO1xuICAgICAgICAgICAgdGhpcy4kY2hpbGRyZW4ucHVzaChjaGlsZCk7XG4gICAgICAgICAgICBpZiAoY2hpbGQgaW5zdGFuY2VvZiBHQ29tcG9uZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkLm1hc2spIHtcbiAgICAgICAgICAgICAgICAgICAgY2hpbGQubWFzay5zZXQoeyB4OiBjaGlsZC5tYXNrLnggKyBjaGlsZC54LCB5OiBjaGlsZC5tYXNrLnkgKyBjaGlsZC55IH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIHRoaXMucmVsYXRpb25zLnNldHVwKHhtbCk7XG4gICAgICAgIHRoaXMuJGNoaWxkcmVuLmZvckVhY2goKGNoaWxkLCBpKSA9PiB7XG4gICAgICAgICAgICBjaGlsZC5yZWxhdGlvbnMuc2V0dXAoZGlzcGxheUxpc3RbaV0uZGVzYyk7XG4gICAgICAgICAgICBjaGlsZC5zZXR1cEFmdGVyQWRkKGRpc3BsYXlMaXN0W2ldLmRlc2MpO1xuICAgICAgICAgICAgY2hpbGQuJGluUHJvZ3Jlc3NCdWlsZGluZyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMubWFzaztcbiAgICAgICAgaWYgKHN0cikge1xuICAgICAgICAgICAgbGV0IG9iaiA9IHRoaXMuZ2V0Q2hpbGRCeUlkKHN0cik7XG4gICAgICAgICAgICBsZXQgbWFza09iaiA9IG9iai5kaXNwbGF5T2JqZWN0O1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVDaGlsZChvYmopO1xuICAgICAgICAgICAgaWYgKG1hc2tPYmogaW5zdGFuY2VvZiBjcmVhdGVqcy5TaGFwZSkge1xuICAgICAgICAgICAgICAgIHRoaXMubWFzayA9IG1hc2tPYmo7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChtYXNrT2JqWyckZGlzcCddIGluc3RhbmNlb2YgU3ByaXRlKSA7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdvbmx5IFNwcml0ZSBvciBHcmFwaGljcyBjYW4gYmUgYXBwbGllZCBhcyBtYXNrIG9iamVjdCcpO1xuICAgICAgICB9XG4gICAgICAgIGNvbC5mb3JFYWNoKGN4bWwgPT4ge1xuICAgICAgICAgICAgaWYgKGN4bWwubm9kZU5hbWUgPT0gJ3RyYW5zaXRpb24nKSB7XG4gICAgICAgICAgICAgICAgbGV0IHRyYW5zID0gbmV3IFRyYW5zaXRpb24odGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy4kdHJhbnNpdGlvbnMucHVzaCh0cmFucyk7XG4gICAgICAgICAgICAgICAgdHJhbnMuc2V0dXAoY3htbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpO1xuICAgICAgICBpZiAodGhpcy4kdHJhbnNpdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGhpcy5vbignYWRkZWQnLCB0aGlzLiRhZGRlZCwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLm9uKCdyZW1vdmVkJywgdGhpcy4kcmVtb3ZlZCwgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hcHBseUFsbENvbnRyb2xsZXJzKCk7XG4gICAgICAgIHRoaXMuJGJ1aWxkaW5nRGlzcGxheUxpc3QgPSBmYWxzZTtcbiAgICAgICAgdGhpcy4kaW5Qcm9ncmVzc0J1aWxkaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYXBwZW5kQ2hpbGRyZW5MaXN0KCk7XG4gICAgICAgIHRoaXMuc2V0Qm91bmRzQ2hhbmdlZEZsYWcoKTtcbiAgICAgICAgdGhpcy5jb25zdHJ1Y3RGcm9tWE1MKHhtbCk7XG4gICAgfVxuICAgIGFwcGVuZENoaWxkcmVuTGlzdCgpIHtcbiAgICAgICAgdGhpcy4kY2hpbGRyZW4uZm9yRWFjaChjaGlsZCA9PiB7XG4gICAgICAgICAgICBpZiAoY2hpbGQuZGlzcGxheU9iamVjdCAhPSBudWxsICYmIGNoaWxkLmZpbmFsVmlzaWJsZSlcbiAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXIuYWRkQ2hpbGQoY2hpbGQuZGlzcGxheU9iamVjdCk7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgIH1cbiAgICBjb25zdHJ1Y3RGcm9tWE1MKHhtbCkgeyB9XG4gICAgJGFkZGVkKGQpIHtcbiAgICAgICAgdGhpcy4kdHJhbnNpdGlvbnMuZm9yRWFjaCh0cmFucyA9PiB7XG4gICAgICAgICAgICBpZiAodHJhbnMuYXV0b1BsYXkpXG4gICAgICAgICAgICAgICAgdHJhbnMucGxheSh7IHRpbWVzOiB0cmFucy5hdXRvUGxheVJlcGVhdCwgZGVsYXk6IHRyYW5zLmF1dG9QbGF5RGVsYXkgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAkcmVtb3ZlZChkKSB7XG4gICAgICAgIHRoaXMuJHRyYW5zaXRpb25zLmZvckVhY2godHJhbnMgPT4ge1xuICAgICAgICAgICAgdHJhbnMuc3RvcChmYWxzZSwgZmFsc2UpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cbmNsYXNzIFdpbmRvdyBleHRlbmRzIEdDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLiRyZXF1ZXN0aW5nQ21kID0gMDtcbiAgICAgICAgdGhpcy5mb2N1c2FibGUgPSB0cnVlO1xuICAgICAgICB0aGlzLiR1aVNvdXJjZXMgPSBbXTtcbiAgICAgICAgdGhpcy5icmluZ1RvRnJvbnRPbkNsaWNrID0gVUlDb25maWcuYnJpbmdXaW5kb3dUb0Zyb250T25DbGljaztcbiAgICAgICAgdGhpcy5vbignYWRkZWQnLCB0aGlzLiRvblNob3duLCB0aGlzKTtcbiAgICAgICAgdGhpcy5vbigncmVtb3ZlZCcsIHRoaXMuJG9uSGlkZGVuLCB0aGlzKTtcbiAgICAgICAgdGhpcy5vbihJbnRlcmFjdGl2ZUV2ZW50cy5Eb3duLCB0aGlzLiRtb3VzZURvd24sIHRoaXMpO1xuICAgIH1cbiAgICBhZGRVSVNvdXJjZShzb3VyY2UpIHtcbiAgICAgICAgdGhpcy4kdWlTb3VyY2VzLnB1c2goc291cmNlKTtcbiAgICB9XG4gICAgc2V0IGNvbnRlbnRQYW5lKHZhbCkge1xuICAgICAgICBpZiAodGhpcy4kY29udGVudFBhbmUgIT0gdmFsKSB7XG4gICAgICAgICAgICBpZiAodGhpcy4kY29udGVudFBhbmUgIT0gbnVsbClcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUNoaWxkKHRoaXMuJGNvbnRlbnRQYW5lKTtcbiAgICAgICAgICAgIHRoaXMuJGNvbnRlbnRQYW5lID0gdmFsO1xuICAgICAgICAgICAgaWYgKHRoaXMuJGNvbnRlbnRQYW5lICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMuJGNvbnRlbnRQYW5lKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFNpemUodGhpcy4kY29udGVudFBhbmUud2lkdGgsIHRoaXMuJGNvbnRlbnRQYW5lLmhlaWdodCk7XG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGVudFBhbmUuYWRkUmVsYXRpb24odGhpcywgMjQgLyogU2l6ZSAqLyk7XG4gICAgICAgICAgICAgICAgdGhpcy4kZnJhbWUgPSB0aGlzLiRjb250ZW50UGFuZS5nZXRDaGlsZCgnZnJhbWUnKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kZnJhbWUgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlQnV0dG9uID0gdGhpcy4kZnJhbWUuZ2V0Q2hpbGQoJ2Nsb3NlQnV0dG9uJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhZ0FyZWEgPSB0aGlzLiRmcmFtZS5nZXRDaGlsZCgnZHJhZ0FyZWEnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250ZW50QXJlYSA9IHRoaXMuJGZyYW1lLmdldENoaWxkKCdjb250ZW50QXJlYScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgY29udGVudFBhbmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRjb250ZW50UGFuZTtcbiAgICB9XG4gICAgZ2V0IGZyYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kZnJhbWU7XG4gICAgfVxuICAgIGdldCBjbG9zZUJ1dHRvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGNsb3NlQnV0dG9uO1xuICAgIH1cbiAgICBzZXQgY2xvc2VCdXR0b24odmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJGNsb3NlQnV0dG9uICE9IG51bGwpXG4gICAgICAgICAgICB0aGlzLiRjbG9zZUJ1dHRvbi5yZW1vdmVDbGljayh0aGlzLmNsb3NlRXZlbnRIYW5kbGVyKTtcbiAgICAgICAgdGhpcy4kY2xvc2VCdXR0b24gPSB2YWx1ZTtcbiAgICAgICAgaWYgKHRoaXMuJGNsb3NlQnV0dG9uICE9IG51bGwpXG4gICAgICAgICAgICB0aGlzLiRjbG9zZUJ1dHRvbi5jbGljayh0aGlzLmNsb3NlRXZlbnRIYW5kbGVyLCB0aGlzKTtcbiAgICB9XG4gICAgZ2V0IGRyYWdBcmVhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kZHJhZ0FyZWE7XG4gICAgfVxuICAgIHNldCBkcmFnQXJlYSh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kZHJhZ0FyZWEgIT0gdmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRkcmFnQXJlYSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kZHJhZ0FyZWEuZHJhZ2dhYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy4kZHJhZ0FyZWEub2ZmKFwiX19kcmFnU3RhcnRcIiAvKiBTVEFSVCAqLywgdGhpcy4kZHJhZ1N0YXJ0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuJGRyYWdBcmVhID0gdmFsdWU7XG4gICAgICAgICAgICBpZiAodGhpcy4kZHJhZ0FyZWEgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRkcmFnQXJlYSBpbnN0YW5jZW9mIEdHcmFwaClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZHJhZ0FyZWEuZHJhd1JlY3QoMCwgJyMwMDAnLCAnIzAwMCcpO1xuICAgICAgICAgICAgICAgIHRoaXMuJGRyYWdBcmVhLmRyYWdnYWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy4kZHJhZ0FyZWEub24oXCJfX2RyYWdTdGFydFwiIC8qIFNUQVJUICovLCB0aGlzLiRkcmFnU3RhcnQsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBjb250ZW50QXJlYSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGNvbnRlbnRBcmVhO1xuICAgIH1cbiAgICBzZXQgY29udGVudEFyZWEodmFsdWUpIHtcbiAgICAgICAgdGhpcy4kY29udGVudEFyZWEgPSB2YWx1ZTtcbiAgICB9XG4gICAgc2hvdygpIHtcbiAgICAgICAgRGVjbHMkMS5HUm9vdC5pbnN0LnNob3dXaW5kb3codGhpcyk7XG4gICAgfVxuICAgIHNob3dPbihyb290KSB7XG4gICAgICAgIHJvb3Quc2hvd1dpbmRvdyh0aGlzKTtcbiAgICB9XG4gICAgaGlkZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNTaG93aW5nKVxuICAgICAgICAgICAgdGhpcy5kb0hpZGVBbmltYXRpb24oKTtcbiAgICB9XG4gICAgaGlkZUltbWVkaWF0ZWx5KCkge1xuICAgICAgICBEZWNscyQxLkdSb290Lmluc3QuaGlkZVdpbmRvd0ltbWVkaWF0ZWx5KHRoaXMpO1xuICAgIH1cbiAgICBjZW50ZXJPbihyLCBhdXRvVXBkYXRlID0gZmFsc2UpIHtcbiAgICAgICAgdGhpcy5zZXRYWShNYXRoLnJvdW5kKChyLndpZHRoIC0gdGhpcy53aWR0aCkgKiAwLjUpLCBNYXRoLnJvdW5kKChyLmhlaWdodCAtIHRoaXMuaGVpZ2h0KSAqIDAuNSkpO1xuICAgICAgICBpZiAoYXV0b1VwZGF0ZSkge1xuICAgICAgICAgICAgdGhpcy5hZGRSZWxhdGlvbihyLCAzIC8qIENlbnRlcl9DZW50ZXIgKi8pO1xuICAgICAgICAgICAgdGhpcy5hZGRSZWxhdGlvbihyLCAxMCAvKiBNaWRkbGVfTWlkZGxlICovKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB0b2dnbGVWaXNpYmxlKCkge1xuICAgICAgICBpZiAodGhpcy5pc1RvcClcbiAgICAgICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLnNob3coKTtcbiAgICB9XG4gICAgZ2V0IGlzU2hvd2luZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50ICE9IG51bGw7XG4gICAgfVxuICAgIGdldCBpc1RvcCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50ICE9IG51bGwgJiYgdGhpcy5wYXJlbnQuZ2V0Q2hpbGRJbmRleCh0aGlzKSA9PSB0aGlzLnBhcmVudC5udW1DaGlsZHJlbiAtIDE7XG4gICAgfVxuICAgIGdldCBtb2RhbCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJG1vZGFsO1xuICAgIH1cbiAgICBzZXQgbW9kYWwodmFsKSB7XG4gICAgICAgIHRoaXMuJG1vZGFsID0gdmFsO1xuICAgIH1cbiAgICBicmluZ1RvRnJvbnQoKSB7XG4gICAgICAgIERlY2xzJDEuR1Jvb3QuaW5zdC5icmluZ1RvRnJvbnQodGhpcyk7XG4gICAgfVxuICAgIHNob3dNb2RhbFdhaXQobXNnLCBjbWQgPSAwKSB7XG4gICAgICAgIGlmIChjbWQgIT0gMClcbiAgICAgICAgICAgIHRoaXMuJHJlcXVlc3RpbmdDbWQgPSBjbWQ7XG4gICAgICAgIGlmIChVSUNvbmZpZy53aW5kb3dNb2RhbFdhaXRpbmcpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy4kbW9kYWxXYWl0UGFuZSlcbiAgICAgICAgICAgICAgICB0aGlzLiRtb2RhbFdhaXRQYW5lID0gVUlQYWNrYWdlLmNyZWF0ZU9iamVjdEZyb21VUkwoVUlDb25maWcud2luZG93TW9kYWxXYWl0aW5nKTtcbiAgICAgICAgICAgIHRoaXMubGF5b3V0TW9kYWxXYWl0UGFuZShtc2cpO1xuICAgICAgICAgICAgdGhpcy5hZGRDaGlsZCh0aGlzLiRtb2RhbFdhaXRQYW5lKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBsYXlvdXRNb2RhbFdhaXRQYW5lKG1zZykge1xuICAgICAgICBpZiAodGhpcy4kY29udGVudEFyZWEgIT0gbnVsbCkge1xuICAgICAgICAgICAgbGV0IHB0ID0gdGhpcy4kZnJhbWUubG9jYWxUb0dsb2JhbCgpO1xuICAgICAgICAgICAgcHQgPSB0aGlzLmdsb2JhbFRvTG9jYWwocHQueCwgcHQueSwgcHQpO1xuICAgICAgICAgICAgdGhpcy4kbW9kYWxXYWl0UGFuZS5zZXRYWShwdC54ICsgdGhpcy4kY29udGVudEFyZWEueCwgcHQueSArIHRoaXMuJGNvbnRlbnRBcmVhLnkpO1xuICAgICAgICAgICAgdGhpcy4kbW9kYWxXYWl0UGFuZS5zZXRTaXplKHRoaXMuJGNvbnRlbnRBcmVhLndpZHRoLCB0aGlzLiRjb250ZW50QXJlYS5oZWlnaHQpO1xuICAgICAgICAgICAgaWYgKG1zZyAmJiBtc2cubGVuZ3RoKVxuICAgICAgICAgICAgICAgIHRoaXMuJG1vZGFsV2FpdFBhbmUudGV4dCA9IG1zZztcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLiRtb2RhbFdhaXRQYW5lLnNldFNpemUodGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgIH1cbiAgICBjbG9zZU1vZGFsV2FpdChjbWQgPSAwKSB7XG4gICAgICAgIGlmIChjbWQgIT0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuJHJlcXVlc3RpbmdDbWQgIT0gY21kKVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiRyZXF1ZXN0aW5nQ21kID0gMDtcbiAgICAgICAgaWYgKHRoaXMuJG1vZGFsV2FpdFBhbmUgJiYgdGhpcy4kbW9kYWxXYWl0UGFuZS5wYXJlbnQgIT0gbnVsbClcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2hpbGQodGhpcy4kbW9kYWxXYWl0UGFuZSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBnZXQgbW9kYWxXYWl0aW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kbW9kYWxXYWl0UGFuZSAmJiB0aGlzLiRtb2RhbFdhaXRQYW5lLnBhcmVudCAhPSBudWxsO1xuICAgIH1cbiAgICBpbml0KCkge1xuICAgICAgICBpZiAodGhpcy4kaW5pdGVkIHx8IHRoaXMuJGxvYWRpbmcpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmICh0aGlzLiR1aVNvdXJjZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGhpcy4kbG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy4kdWlTb3VyY2VzLmZvckVhY2gobyA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFvLmxvYWRlZCkge1xuICAgICAgICAgICAgICAgICAgICBvLmxvYWQodGhpcy4kdWlMb2FkQ29tcGxldGUsIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgIGlmICghdGhpcy4kbG9hZGluZylcbiAgICAgICAgICAgICAgICB0aGlzLiRpbml0KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kaW5pdCgpO1xuICAgIH1cbiAgICBvbkluaXQoKSB7IH1cbiAgICBvblNob3duKCkgeyB9XG4gICAgb25IaWRlKCkgeyB9XG4gICAgZG9TaG93QW5pbWF0aW9uKCkge1xuICAgICAgICB0aGlzLm9uU2hvd24oKTtcbiAgICB9XG4gICAgZG9IaWRlQW5pbWF0aW9uKCkge1xuICAgICAgICB0aGlzLmhpZGVJbW1lZGlhdGVseSgpO1xuICAgIH1cbiAgICAkdWlMb2FkQ29tcGxldGUoKSB7XG4gICAgICAgIGxldCBjbnQgPSB0aGlzLiR1aVNvdXJjZXMubGVuZ3RoO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNudDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuJHVpU291cmNlc1tpXS5sb2FkZWQpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuJGxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy4kaW5pdCgpO1xuICAgIH1cbiAgICAkaW5pdCgpIHtcbiAgICAgICAgdGhpcy4kaW5pdGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5vbkluaXQoKTtcbiAgICAgICAgaWYgKHRoaXMuaXNTaG93aW5nKVxuICAgICAgICAgICAgdGhpcy5kb1Nob3dBbmltYXRpb24oKTtcbiAgICB9XG4gICAgZGlzcG9zZSgpIHtcbiAgICAgICAgdGhpcy5vZmYoJ2FkZGVkJywgdGhpcy4kb25TaG93bik7XG4gICAgICAgIHRoaXMub2ZmKCdyZW1vdmVkJywgdGhpcy4kb25IaWRkZW4pO1xuICAgICAgICB0aGlzLm9mZihJbnRlcmFjdGl2ZUV2ZW50cy5Eb3duLCB0aGlzLiRtb3VzZURvd24pO1xuICAgICAgICBpZiAodGhpcy4kZHJhZ0FyZWEpXG4gICAgICAgICAgICB0aGlzLiRkcmFnQXJlYS5vZmYoXCJfX2RyYWdTdGFydFwiIC8qIFNUQVJUICovLCB0aGlzLiRkcmFnU3RhcnQpO1xuICAgICAgICBpZiAodGhpcy5wYXJlbnQgIT0gbnVsbClcbiAgICAgICAgICAgIHRoaXMuaGlkZUltbWVkaWF0ZWx5KCk7XG4gICAgICAgIGlmICh0aGlzLiRtb2RhbFdhaXRQYW5lKVxuICAgICAgICAgICAgdGhpcy4kbW9kYWxXYWl0UGFuZS5kaXNwb3NlKCk7XG4gICAgICAgIGlmICh0aGlzLiRjb250ZW50UGFuZSlcbiAgICAgICAgICAgIHRoaXMuJGNvbnRlbnRQYW5lLmRpc3Bvc2UoKTtcbiAgICAgICAgc3VwZXIuZGlzcG9zZSgpO1xuICAgIH1cbiAgICBjbG9zZUV2ZW50SGFuZGxlcihldnQpIHtcbiAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgfVxuICAgICRvblNob3duKHRhcmdldCkge1xuICAgICAgICBpZiAoIXRoaXMuJGluaXRlZClcbiAgICAgICAgICAgIHRoaXMuaW5pdCgpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLmRvU2hvd0FuaW1hdGlvbigpO1xuICAgIH1cbiAgICAkb25IaWRkZW4odGFyZ2V0KSB7XG4gICAgICAgIHRoaXMuY2xvc2VNb2RhbFdhaXQoKTtcbiAgICAgICAgdGhpcy5vbkhpZGUoKTtcbiAgICB9XG4gICAgJG1vdXNlRG93bihldnQpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNTaG93aW5nICYmIHRoaXMuYnJpbmdUb0Zyb250T25DbGljaylcbiAgICAgICAgICAgIHRoaXMuYnJpbmdUb0Zyb250KCk7XG4gICAgfVxuICAgICRkcmFnU3RhcnQoZXZ0KSB7XG4gICAgICAgIGxldCBjdXJyZW50VGFyZ2V0ID0gZXZ0LmRhdGEuY3VycmVudFRhcmdldDtcbiAgICAgICAgR09iamVjdC5jYXN0RnJvbU5hdGl2ZU9iamVjdChjdXJyZW50VGFyZ2V0KS5zdG9wRHJhZygpO1xuICAgICAgICB0aGlzLnN0YXJ0RHJhZyhldnQuZGF0YS5wb2ludGVySUQpO1xuICAgIH1cbn1cblxubGV0IF9pbnN0O1xuY2xhc3MgR1Jvb3RNb3VzZVN0YXR1cyB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMudG91Y2hEb3duID0gZmFsc2U7XG4gICAgICAgIHRoaXMubW91c2VYID0gMDtcbiAgICAgICAgdGhpcy5tb3VzZVkgPSAwO1xuICAgIH1cbn1cbmNsYXNzIEdSb290IGV4dGVuZHMgR0NvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuJHZvbHVtZVNjYWxlID0gMTtcbiAgICAgICAgaWYgKF9pbnN0ID09IG51bGwpXG4gICAgICAgICAgICBfaW5zdCA9IHRoaXM7XG4gICAgICAgIHRoaXMub3BhcXVlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuJHBvcHVwU3RhY2sgPSBbXTtcbiAgICAgICAgdGhpcy4kanVzdENsb3NlZFBvcHVwcyA9IFtdO1xuICAgICAgICB0aGlzLiR1aWQgPSBHUm9vdC51bmlxdWVJRCsrO1xuICAgICAgICBET01FdmVudE1hbmFnZXIuaW5zdC5vbihcIl9fbW91c2VXaGVlbFwiIC8qIE1PVVNFX1dIRUVMICovLCB0aGlzLmRpc3BhdGNoTW91c2VXaGVlbCwgdGhpcyk7XG4gICAgfVxuICAgIHN0YXRpYyBmaW5kRm9yKG9iaikge1xuICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgR1Jvb3QpXG4gICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICBpZiAoIW9iailcbiAgICAgICAgICAgIHJldHVybiBfaW5zdDtcbiAgICAgICAgdmFyIHAgPSBvYmoucGFyZW50O1xuICAgICAgICB3aGlsZSAocCkge1xuICAgICAgICAgICAgaWYgKHAgaW5zdGFuY2VvZiBHUm9vdClcbiAgICAgICAgICAgICAgICByZXR1cm4gcDtcbiAgICAgICAgICAgIHAgPSBwLnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gX2luc3Q7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHRoZSBzaW5nbGV0b24gaW5zdGFuY2Ugb2YgdGhlIEdSb290IG9iamVjdFxuICAgICAqL1xuICAgIHN0YXRpYyBnZXQgaW5zdCgpIHtcbiAgICAgICAgaWYgKF9pbnN0ID09IG51bGwpXG4gICAgICAgICAgICBfaW5zdCA9IG5ldyBHUm9vdCgpO1xuICAgICAgICByZXR1cm4gX2luc3Q7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHRoZSBjdXJyZW50IG1vdXNlL3BvaW50ZXIgZGF0YVxuICAgICAqL1xuICAgIHN0YXRpYyBnZXQgZ2xvYmFsTW91c2VTdGF0dXMoKSB7XG4gICAgICAgIHJldHVybiBHUm9vdC4kZ21TdGF0dXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIHRoZSBtYWluIGVudHJ5IHRvIGxhdWNoIHRoZSBVSSByb290LCBlLmcuOiBHUm9vdC5pbnN0LmF0dGFjaFRvKGFwcCwgb3B0aW9ucylcbiAgICAgKiBAcGFyYW0gYXBwIHlvdXIgY3JlYXRlanMuU3RhZ2UgaW5zdGFuY2UgdG8gYmUgdXNlZCBpbiB0aGlzIEdSb290IGluc3RhbmNlXG4gICAgICogQHBhcmFtIHN0YWdlT3B0aW9ucyBzdGFnZSByb3RhdGlvbiAvIHJlc2l6ZSBvcHRpb25zXG4gICAgICovXG4gICAgYXR0YWNoVG8oc3RhZ2UsIHN0YWdlT3B0aW9ucykge1xuICAgICAgICBjcmVhdGVqcy5Ub3VjaC5lbmFibGUoc3RhZ2UpO1xuICAgICAgICBzdGFnZS5tb3VzZUVuYWJsZWQgPSB0cnVlO1xuICAgICAgICBzdGFnZS5tb3VzZUNoaWxkcmVuID0gdHJ1ZTtcbiAgICAgICAgc3RhZ2UuZW5hYmxlTW91c2VPdmVyKDUwKTtcbiAgICAgICAgLy8gaWYgKHRoaXMuJHVpU3RhZ2UpIHtcbiAgICAgICAgLy8gICAgIHRoaXMuJHVpU3RhZ2Uub2ZmKERpc3BsYXlPYmplY3RFdmVudC5TSVpFX0NIQU5HRUQsIHRoaXMuJHdpblJlc2l6ZSk7XG4gICAgICAgIC8vICAgICB0aGlzLiR1aVN0YWdlLm5hdGl2ZVN0YWdlLm9mZihJbnRlcmFjdGl2ZUV2ZW50cy5Eb3duLCB0aGlzLiRzdGFnZURvd24pO1xuICAgICAgICAvLyAgICAgdGhpcy4kdWlTdGFnZS5uYXRpdmVTdGFnZS5vZmYoSW50ZXJhY3RpdmVFdmVudHMuVXAsIHRoaXMuJHN0YWdlVXApO1xuICAgICAgICAvLyAgICAgdGhpcy4kdWlTdGFnZS5uYXRpdmVTdGFnZS5vZmYoSW50ZXJhY3RpdmVFdmVudHMuTW92ZSwgdGhpcy4kc3RhZ2VNb3ZlKTtcbiAgICAgICAgLy8gICAgIHRoaXMuJHVpU3RhZ2UubmF0aXZlU3RhZ2Uub2ZmKHRoaXMuJGRpc3BsYXlPYmplY3QpO1xuICAgICAgICAvLyAgICAgdGhpcy4kdWlTdGFnZS5kaXNwb3NlKCk7XG4gICAgICAgIC8vIH1cbiAgICAgICAgdGhpcy4kdWlTdGFnZSA9IG5ldyBVSVN0YWdlKHN0YWdlLCBzdGFnZU9wdGlvbnMpO1xuICAgICAgICB0aGlzLiR1aVN0YWdlLm9uKFwiX19zaXplQ2hhbmdlZFwiIC8qIFNJWkVfQ0hBTkdFRCAqLywgdGhpcy4kd2luUmVzaXplLCB0aGlzKTtcbiAgICAgICAgdGhpcy4kdWlTdGFnZS5uYXRpdmVTdGFnZS5vbihJbnRlcmFjdGl2ZUV2ZW50cy5Eb3duLCB0aGlzLiRzdGFnZURvd24sIHRoaXMpO1xuICAgICAgICB0aGlzLiR1aVN0YWdlLm5hdGl2ZVN0YWdlLm9uKEludGVyYWN0aXZlRXZlbnRzLlVwLCB0aGlzLiRzdGFnZVVwLCB0aGlzKTtcbiAgICAgICAgdGhpcy4kdWlTdGFnZS5uYXRpdmVTdGFnZS5vbihJbnRlcmFjdGl2ZUV2ZW50cy5Nb3ZlLCB0aGlzLiRzdGFnZU1vdmUsIHRoaXMpO1xuICAgICAgICB0aGlzLiR1aVN0YWdlLm5hdGl2ZVN0YWdlLm9uKEludGVyYWN0aXZlRXZlbnRzLkNsaWNrLCB0aGlzLiRjbGljaywgdGhpcyk7XG4gICAgICAgIHRoaXMuJHVpU3RhZ2UubmF0aXZlU3RhZ2UuYWRkQ2hpbGQodGhpcy4kZGlzcGxheU9iamVjdCk7XG4gICAgICAgIHRoaXMuJHdpblJlc2l6ZSh0aGlzLiR1aVN0YWdlKTtcbiAgICAgICAgaWYgKCF0aGlzLiRtb2RhbExheWVyKSB7XG4gICAgICAgICAgICB0aGlzLiRtb2RhbExheWVyID0gbmV3IEdHcmFwaCgpO1xuICAgICAgICAgICAgdGhpcy4kbW9kYWxMYXllci5zZXRTaXplKHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICAgICAgICAgIHRoaXMuJG1vZGFsTGF5ZXIuZHJhd1JlY3QoMCwgJycsIFVJQ29uZmlnLm1vZGFsTGF5ZXJDb2xvcik7XG4gICAgICAgICAgICB0aGlzLiRtb2RhbExheWVyLmFkZFJlbGF0aW9uKHRoaXMsIDI0IC8qIFNpemUgKi8pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCB1bmlxdWVJRCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHVpZDtcbiAgICB9XG4gICAgZ2V0IHN0YWdlV2lkdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR1aVN0YWdlLnN0YWdlV2lkdGg7XG4gICAgfVxuICAgIGdldCBzdGFnZUhlaWdodCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHVpU3RhZ2Uuc3RhZ2VIZWlnaHQ7XG4gICAgfVxuICAgIGdldCBjb250ZW50U2NhbGVGYWN0b3IoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR1aVN0YWdlLnJlc29sdXRpb247XG4gICAgfVxuICAgIGdldCBhcHBsaWNhdGlvbkNvbnRleHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR1aVN0YWdlLmFwcGxpY2F0aW9uQ29udGV4dDtcbiAgICB9XG4gICAgZ2V0IG5hdGl2ZVN0YWdlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kdWlTdGFnZS5uYXRpdmVTdGFnZTtcbiAgICB9XG4gICAgZ2V0IG9yaWVudGF0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kdWlTdGFnZS5vcmllbnRhdGlvbjtcbiAgICB9XG4gICAgZ2V0IHN0YWdlV3JhcHBlcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHVpU3RhZ2U7XG4gICAgfVxuICAgIGRpc3BhdGNoTW91c2VXaGVlbChldnQpIHtcbiAgICAgICAgbGV0IGV2ZW50ID0gZXZ0LmRhdGEuZXZlbnQ7XG4gICAgICAgIGxldCBjaGlsZFVuZGVyTW91c2UgPSB0aGlzLmdldE9iamVjdFVuZGVyUG9pbnQoR1Jvb3QuZ2xvYmFsTW91c2VTdGF0dXMubW91c2VYLCBHUm9vdC5nbG9iYWxNb3VzZVN0YXR1cy5tb3VzZVkpO1xuICAgICAgICBpZiAoY2hpbGRVbmRlck1vdXNlICE9IG51bGwpIHtcbiAgICAgICAgICAgIC8vYnViYmxlXG4gICAgICAgICAgICB3aGlsZSAoY2hpbGRVbmRlck1vdXNlLnBhcmVudCAmJiBjaGlsZFVuZGVyTW91c2UucGFyZW50ICE9IHRoaXMpIHtcbiAgICAgICAgICAgICAgICBsZXQgbW91c2VXaGVlbEV2ZW50ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KFwiX19tb3VzZVdoZWVsXCIgLyogTU9VU0VfV0hFRUwgKi8sIHRydWUsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICBtb3VzZVdoZWVsRXZlbnQuZGF0YSA9IHsgZXZlbnQgfTtcbiAgICAgICAgICAgICAgICBjaGlsZFVuZGVyTW91c2UuZGlzcGF0Y2hFdmVudChtb3VzZVdoZWVsRXZlbnQpO1xuICAgICAgICAgICAgICAgIGNoaWxkVW5kZXJNb3VzZSA9IGNoaWxkVW5kZXJNb3VzZS5wYXJlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogZ2V0IHRoZSBvYmplY3RzIHdoaWNoIGFyZSBwbGFjZWQgdW5kZXJuZWF0aCB0aGUgZ2l2ZW4gc3RhZ2UgY29vcmRpbmF0ZVxuICAgICAqIEBwYXJhbSBnbG9iYWxYIHRoZSBzdGFnZSBYXG4gICAgICogQHBhcmFtIGdsb2JhbFkgdGhlIHN0YWdlIFlcbiAgICAgKi9cbiAgICBnZXRPYmplY3RVbmRlclBvaW50KGdsb2JhbFgsIGdsb2JhbFkpIHtcbiAgICAgICAgR1Jvb3Quc0hlbHBlclBvaW50LnNldFZhbHVlcyhnbG9iYWxYLCBnbG9iYWxZKTtcbiAgICAgICAgd2luZG93Wyd0ZXN0J10gPSB0cnVlO1xuICAgICAgICBsZXQgcmV0ID0gdGhpcy4kdWlTdGFnZS5hcHBsaWNhdGlvbkNvbnRleHQuZ2V0T2JqZWN0VW5kZXJQb2ludChHUm9vdC5zSGVscGVyUG9pbnQueCwgR1Jvb3Quc0hlbHBlclBvaW50LnksIDApO1xuICAgICAgICByZXR1cm4gR09iamVjdC5jYXN0RnJvbU5hdGl2ZU9iamVjdChyZXQpO1xuICAgIH1cbiAgICBzaG93V2luZG93KHdpbikge1xuICAgICAgICB0aGlzLmFkZENoaWxkKHdpbik7XG4gICAgICAgIHdpbi5yZXF1ZXN0Rm9jdXMoKTtcbiAgICAgICAgaWYgKHdpbi54ID4gdGhpcy53aWR0aClcbiAgICAgICAgICAgIHdpbi54ID0gdGhpcy53aWR0aCAtIHdpbi53aWR0aDtcbiAgICAgICAgZWxzZSBpZiAod2luLnggKyB3aW4ud2lkdGggPCAwKVxuICAgICAgICAgICAgd2luLnggPSAwO1xuICAgICAgICBpZiAod2luLnkgPiB0aGlzLmhlaWdodClcbiAgICAgICAgICAgIHdpbi55ID0gdGhpcy5oZWlnaHQgLSB3aW4uaGVpZ2h0O1xuICAgICAgICBlbHNlIGlmICh3aW4ueSArIHdpbi5oZWlnaHQgPCAwKVxuICAgICAgICAgICAgd2luLnkgPSAwO1xuICAgICAgICB0aGlzLmFkanVzdE1vZGFsTGF5ZXIoKTtcbiAgICB9XG4gICAgaGlkZVdpbmRvdyh3aW4pIHtcbiAgICAgICAgd2luLmhpZGUoKTtcbiAgICB9XG4gICAgaGlkZVdpbmRvd0ltbWVkaWF0ZWx5KHdpbikge1xuICAgICAgICBpZiAod2luLnBhcmVudCA9PSB0aGlzKVxuICAgICAgICAgICAgdGhpcy5yZW1vdmVDaGlsZCh3aW4pO1xuICAgICAgICB0aGlzLmFkanVzdE1vZGFsTGF5ZXIoKTtcbiAgICB9XG4gICAgYnJpbmdUb0Zyb250KHdpbikge1xuICAgICAgICBsZXQgaTtcbiAgICAgICAgaWYgKHRoaXMuJG1vZGFsTGF5ZXIucGFyZW50ICE9IG51bGwgJiYgIXdpbi5tb2RhbClcbiAgICAgICAgICAgIGkgPSB0aGlzLmdldENoaWxkSW5kZXgodGhpcy4kbW9kYWxMYXllcikgLSAxO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBpID0gdGhpcy5udW1DaGlsZHJlbiAtIDE7XG4gICAgICAgIGZvciAoOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgbGV0IGcgPSB0aGlzLmdldENoaWxkQXQoaSk7XG4gICAgICAgICAgICBpZiAoZyA9PSB3aW4pXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKGcgaW5zdGFuY2VvZiBXaW5kb3cpXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGkgPj0gMClcbiAgICAgICAgICAgIHRoaXMuc2V0Q2hpbGRJbmRleCh3aW4sIGkpO1xuICAgIH1cbiAgICBzaG93TW9kYWxXYWl0KG1zZyA9IG51bGwpIHtcbiAgICAgICAgaWYgKFVJQ29uZmlnLmdsb2JhbE1vZGFsV2FpdGluZyAhPSBudWxsKSB7XG4gICAgICAgICAgICBpZiAodGhpcy4kbW9kYWxXYWl0UGFuZSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kbW9kYWxXYWl0UGFuZSA9IFVJUGFja2FnZS5jcmVhdGVPYmplY3RGcm9tVVJMKFVJQ29uZmlnLmdsb2JhbE1vZGFsV2FpdGluZyk7XG4gICAgICAgICAgICAgICAgdGhpcy4kbW9kYWxXYWl0UGFuZS5hZGRSZWxhdGlvbih0aGlzLCAyNCAvKiBTaXplICovKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuJG1vZGFsV2FpdFBhbmUuc2V0U2l6ZSh0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gICAgICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMuJG1vZGFsV2FpdFBhbmUpO1xuICAgICAgICAgICAgdGhpcy4kbW9kYWxXYWl0UGFuZS50ZXh0ID0gbXNnO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNsb3NlTW9kYWxXYWl0KCkge1xuICAgICAgICBpZiAodGhpcy4kbW9kYWxXYWl0UGFuZSAhPSBudWxsICYmIHRoaXMuJG1vZGFsV2FpdFBhbmUucGFyZW50ICE9IG51bGwpXG4gICAgICAgICAgICB0aGlzLnJlbW92ZUNoaWxkKHRoaXMuJG1vZGFsV2FpdFBhbmUpO1xuICAgIH1cbiAgICBjbG9zZUFsbEV4Y2VwdE1vZGFscygpIHtcbiAgICAgICAgbGV0IGFyciA9IHRoaXMuJGNoaWxkcmVuLnNsaWNlKCk7XG4gICAgICAgIGFyci5mb3JFYWNoKGcgPT4ge1xuICAgICAgICAgICAgaWYgKGcgaW5zdGFuY2VvZiBXaW5kb3cgJiYgIWcubW9kYWwpXG4gICAgICAgICAgICAgICAgZy5oaWRlKCk7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgIH1cbiAgICBjbG9zZUFsbFdpbmRvd3MoKSB7XG4gICAgICAgIGxldCBhcnIgPSB0aGlzLiRjaGlsZHJlbi5zbGljZSgpO1xuICAgICAgICBhcnIuZm9yRWFjaChnID0+IHtcbiAgICAgICAgICAgIGlmIChnIGluc3RhbmNlb2YgV2luZG93KVxuICAgICAgICAgICAgICAgIGcuaGlkZSgpO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICB9XG4gICAgZ2V0VG9wV2luZG93KCkge1xuICAgICAgICBsZXQgY250ID0gdGhpcy5udW1DaGlsZHJlbjtcbiAgICAgICAgZm9yIChsZXQgaSA9IGNudCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICBsZXQgZyA9IHRoaXMuZ2V0Q2hpbGRBdChpKTtcbiAgICAgICAgICAgIGlmIChnIGluc3RhbmNlb2YgV2luZG93KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGdldCBoYXNNb2RhbFdpbmRvdygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJG1vZGFsTGF5ZXIucGFyZW50ICE9IG51bGw7XG4gICAgfVxuICAgIGdldCBtb2RhbFdhaXRpbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRtb2RhbFdhaXRQYW5lICYmIHRoaXMuJG1vZGFsV2FpdFBhbmUuaW5Db250YWluZXI7XG4gICAgfVxuICAgIHNob3dQb3B1cChwb3B1cCwgdGFyZ2V0ID0gbnVsbCwgZGlyID0gMCAvKiBBdXRvICovKSB7XG4gICAgICAgIGlmICh0aGlzLiRwb3B1cFN0YWNrLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGxldCBrID0gdGhpcy4kcG9wdXBTdGFjay5pbmRleE9mKHBvcHVwKTtcbiAgICAgICAgICAgIGlmIChrICE9IC0xKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMuJHBvcHVwU3RhY2subGVuZ3RoIC0gMTsgaSA+PSBrOyBpLS0pXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2hpbGQodGhpcy4kcG9wdXBTdGFjay5wb3AoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kcG9wdXBTdGFjay5wdXNoKHBvcHVwKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZChwb3B1cCk7XG4gICAgICAgIHRoaXMuYWRqdXN0TW9kYWxMYXllcigpO1xuICAgICAgICBsZXQgcG9zO1xuICAgICAgICBsZXQgc2l6ZVcgPSAwLCBzaXplSCA9IDA7XG4gICAgICAgIGlmICh0YXJnZXQpIHtcbiAgICAgICAgICAgIHBvcyA9IHRhcmdldC5sb2NhbFRvUm9vdCgpO1xuICAgICAgICAgICAgc2l6ZVcgPSB0YXJnZXQud2lkdGg7XG4gICAgICAgICAgICBzaXplSCA9IHRhcmdldC5oZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcG9zID0gdGhpcy5nbG9iYWxUb0xvY2FsKEdSb290LiRnbVN0YXR1cy5tb3VzZVgsIEdSb290LiRnbVN0YXR1cy5tb3VzZVkpO1xuICAgICAgICBsZXQgeHgsIHl5O1xuICAgICAgICB4eCA9IHBvcy54O1xuICAgICAgICBpZiAoeHggKyBwb3B1cC53aWR0aCA+IHRoaXMud2lkdGgpXG4gICAgICAgICAgICB4eCA9IHh4ICsgc2l6ZVcgLSBwb3B1cC53aWR0aDtcbiAgICAgICAgeXkgPSBwb3MueSArIHNpemVIO1xuICAgICAgICBpZiAoKGRpciA9PSAwIC8qIEF1dG8gKi8gJiYgeXkgKyBwb3B1cC5oZWlnaHQgPiB0aGlzLmhlaWdodCkgfHxcbiAgICAgICAgICAgIGRpciA9PSAyIC8qIFVwICovKSB7XG4gICAgICAgICAgICB5eSA9IHBvcy55IC0gcG9wdXAuaGVpZ2h0IC0gMTtcbiAgICAgICAgICAgIGlmICh5eSA8IDApIHtcbiAgICAgICAgICAgICAgICB5eSA9IDA7XG4gICAgICAgICAgICAgICAgeHggKz0gc2l6ZVcgKiAwLjU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcG9wdXAueCA9IHh4O1xuICAgICAgICBwb3B1cC55ID0geXk7XG4gICAgfVxuICAgIHRvZ2dsZVBvcHVwKHBvcHVwLCB0YXJnZXQgPSBudWxsLCBkaXIpIHtcbiAgICAgICAgaWYgKHRoaXMuJGp1c3RDbG9zZWRQb3B1cHMuaW5kZXhPZihwb3B1cCkgIT0gLTEpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuc2hvd1BvcHVwKHBvcHVwLCB0YXJnZXQsIGRpcik7XG4gICAgfVxuICAgIGhpZGVQb3B1cChwb3B1cCA9IG51bGwpIHtcbiAgICAgICAgbGV0IGk7XG4gICAgICAgIGlmIChwb3B1cCAhPSBudWxsKSB7XG4gICAgICAgICAgICBsZXQgayA9IHRoaXMuJHBvcHVwU3RhY2suaW5kZXhPZihwb3B1cCk7XG4gICAgICAgICAgICBpZiAoayAhPSAtMSkge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IHRoaXMuJHBvcHVwU3RhY2subGVuZ3RoIC0gMTsgaSA+PSBrOyBpLS0pXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VQb3B1cCh0aGlzLiRwb3B1cFN0YWNrLnBvcCgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGxldCBjbnQgPSB0aGlzLiRwb3B1cFN0YWNrLmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAoaSA9IGNudCAtIDE7IGkgPj0gMDsgaS0tKVxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VQb3B1cCh0aGlzLiRwb3B1cFN0YWNrW2ldKTtcbiAgICAgICAgICAgIHRoaXMuJHBvcHVwU3RhY2subGVuZ3RoID0gMDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgaGFzQW55UG9wdXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRwb3B1cFN0YWNrLmxlbmd0aCAhPSAwO1xuICAgIH1cbiAgICBjbG9zZVBvcHVwKHRhcmdldCkge1xuICAgICAgICBpZiAodGFyZ2V0LnBhcmVudCAhPSBudWxsKSB7XG4gICAgICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgV2luZG93KVxuICAgICAgICAgICAgICAgIHRhcmdldC5oaWRlKCk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVDaGlsZCh0YXJnZXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNob3dUb29sdGlwcyhtc2cpIHtcbiAgICAgICAgaWYgKHRoaXMuJGRlZmF1bHRUb29sdGlwV2luID09IG51bGwpIHtcbiAgICAgICAgICAgIGxldCByZXNvdXJjZVVSTCA9IFVJQ29uZmlnLnRvb2x0aXBzV2luO1xuICAgICAgICAgICAgaWYgKCFyZXNvdXJjZVVSTCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1VJQ29uZmlnLnRvb2x0aXBzV2luIG5vdCBkZWZpbmVkJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy4kZGVmYXVsdFRvb2x0aXBXaW4gPSBVSVBhY2thZ2UuY3JlYXRlT2JqZWN0RnJvbVVSTChyZXNvdXJjZVVSTCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kZGVmYXVsdFRvb2x0aXBXaW4udGV4dCA9IG1zZztcbiAgICAgICAgdGhpcy5zaG93VG9vbHRpcHNXaW4odGhpcy4kZGVmYXVsdFRvb2x0aXBXaW4pO1xuICAgIH1cbiAgICBzaG93VG9vbHRpcHNXaW4odG9vbHRpcFdpbiwgcG9zaXRpb24gPSBudWxsKSB7XG4gICAgICAgIHRoaXMuaGlkZVRvb2x0aXBzKCk7XG4gICAgICAgIHRoaXMuJHRvb2x0aXBXaW4gPSB0b29sdGlwV2luO1xuICAgICAgICBsZXQgeHggPSAwO1xuICAgICAgICBsZXQgeXkgPSAwO1xuICAgICAgICBpZiAocG9zaXRpb24gPT0gbnVsbCkge1xuICAgICAgICAgICAgeHggPSBHUm9vdC4kZ21TdGF0dXMubW91c2VYICsgMTA7XG4gICAgICAgICAgICB5eSA9IEdSb290LiRnbVN0YXR1cy5tb3VzZVkgKyAyMDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHh4ID0gcG9zaXRpb24ueDtcbiAgICAgICAgICAgIHl5ID0gcG9zaXRpb24ueTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgcHQgPSB0aGlzLmdsb2JhbFRvTG9jYWwoeHgsIHl5KTtcbiAgICAgICAgeHggPSBwdC54O1xuICAgICAgICB5eSA9IHB0Lnk7XG4gICAgICAgIGlmICh4eCArIHRoaXMuJHRvb2x0aXBXaW4ud2lkdGggPiB0aGlzLndpZHRoKSB7XG4gICAgICAgICAgICB4eCA9IHh4IC0gdGhpcy4kdG9vbHRpcFdpbi53aWR0aCAtIDE7XG4gICAgICAgICAgICBpZiAoeHggPCAwKVxuICAgICAgICAgICAgICAgIHh4ID0gMTA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHl5ICsgdGhpcy4kdG9vbHRpcFdpbi5oZWlnaHQgPiB0aGlzLmhlaWdodCkge1xuICAgICAgICAgICAgeXkgPSB5eSAtIHRoaXMuJHRvb2x0aXBXaW4uaGVpZ2h0IC0gMTtcbiAgICAgICAgICAgIGlmICh4eCAtIHRoaXMuJHRvb2x0aXBXaW4ud2lkdGggLSAxID4gMClcbiAgICAgICAgICAgICAgICB4eCA9IHh4IC0gdGhpcy4kdG9vbHRpcFdpbi53aWR0aCAtIDE7XG4gICAgICAgICAgICBpZiAoeXkgPCAwKVxuICAgICAgICAgICAgICAgIHl5ID0gMTA7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kdG9vbHRpcFdpbi54ID0geHg7XG4gICAgICAgIHRoaXMuJHRvb2x0aXBXaW4ueSA9IHl5O1xuICAgICAgICB0aGlzLmFkZENoaWxkKHRoaXMuJHRvb2x0aXBXaW4pO1xuICAgIH1cbiAgICBoaWRlVG9vbHRpcHMoKSB7XG4gICAgICAgIGlmICh0aGlzLiR0b29sdGlwV2luICE9IG51bGwpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiR0b29sdGlwV2luLnBhcmVudClcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUNoaWxkKHRoaXMuJHRvb2x0aXBXaW4pO1xuICAgICAgICAgICAgdGhpcy4kdG9vbHRpcFdpbiA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGZvY3VzKCkge1xuICAgICAgICBpZiAodGhpcy4kZm9jdXNlZE9iamVjdCAmJiAhdGhpcy4kZm9jdXNlZE9iamVjdC5vblN0YWdlKVxuICAgICAgICAgICAgdGhpcy4kZm9jdXNlZE9iamVjdCA9IG51bGw7XG4gICAgICAgIHJldHVybiB0aGlzLiRmb2N1c2VkT2JqZWN0O1xuICAgIH1cbiAgICBzZXQgZm9jdXModmFsdWUpIHtcbiAgICAgICAgaWYgKHZhbHVlICYmICghdmFsdWUuZm9jdXNhYmxlIHx8ICF2YWx1ZS5vblN0YWdlKSlcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCB0YXJnZXQgdG8gZm9jdXMnKTtcbiAgICAgICAgdGhpcy5zZXRGb2N1cyh2YWx1ZSk7XG4gICAgfVxuICAgIHNldEZvY3VzKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiRmb2N1c2VkT2JqZWN0ICE9IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiRmb2N1c2VkT2JqZWN0ID0gdmFsdWU7XG4gICAgICAgICAgICBsZXQgZXZ0ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KFwiX19mb2N1c0NoYW5nZWRcIiAvKiBDSEFOR0VEICovLCB0cnVlLCBmYWxzZSk7XG4gICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZXZ0LCB0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgdm9sdW1lU2NhbGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR2b2x1bWVTY2FsZTtcbiAgICB9XG4gICAgc2V0IHZvbHVtZVNjYWxlKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuJHZvbHVtZVNjYWxlID0gdmFsdWU7XG4gICAgfVxuICAgIHBsYXlPbmVTaG90U291bmQoc291bmQsIHZvbHVtZVNjYWxlID0gMSkge1xuICAgICAgICB2YXIgdnMgPSB0aGlzLiR2b2x1bWVTY2FsZSAqIHZvbHVtZVNjYWxlO1xuICAgICAgICBzb3VuZC5wbGF5KHsgdm9sdW1lOiB2cyB9KTtcbiAgICB9XG4gICAgYWRqdXN0TW9kYWxMYXllcigpIHtcbiAgICAgICAgbGV0IGNudCA9IHRoaXMubnVtQ2hpbGRyZW47XG4gICAgICAgIGlmICh0aGlzLiRtb2RhbFdhaXRQYW5lICE9IG51bGwgJiYgdGhpcy4kbW9kYWxXYWl0UGFuZS5wYXJlbnQgIT0gbnVsbClcbiAgICAgICAgICAgIHRoaXMuc2V0Q2hpbGRJbmRleCh0aGlzLiRtb2RhbFdhaXRQYW5lLCBjbnQgLSAxKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IGNudCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICBsZXQgZyA9IHRoaXMuZ2V0Q2hpbGRBdChpKTtcbiAgICAgICAgICAgIGlmIChnIGluc3RhbmNlb2YgV2luZG93ICYmIGcubW9kYWwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kbW9kYWxMYXllci5wYXJlbnQgPT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRDaGlsZEF0KHRoaXMuJG1vZGFsTGF5ZXIsIGkpO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRDaGlsZEluZGV4QmVmb3JlKHRoaXMuJG1vZGFsTGF5ZXIsIGkpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy4kbW9kYWxMYXllci5wYXJlbnQgIT0gbnVsbClcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2hpbGQodGhpcy4kbW9kYWxMYXllcik7XG4gICAgfVxuICAgICRzdGFnZURvd24oZXZ0KSB7XG4gICAgICAgIC8vIHNlZSBEcmFnICYgRHJvcFxuICAgICAgICBHUm9vdC4kZ21TdGF0dXMubW91c2VYID0gZXZ0LnN0YWdlWDtcbiAgICAgICAgR1Jvb3QuJGdtU3RhdHVzLm1vdXNlWSA9IGV2dC5zdGFnZVk7XG4gICAgICAgIEdSb290LiRnbVN0YXR1cy50b3VjaERvd24gPSB0cnVlO1xuICAgICAgICAvL2NoZWNrIGZvY3VzXG4gICAgICAgIGxldCBtYyA9IGV2dC50YXJnZXQ7XG4gICAgICAgIHdoaWxlIChtYyAmJiBtYyAhPSB0aGlzLm5hdGl2ZVN0YWdlKSB7XG4gICAgICAgICAgICBpZiAoaXNVSU9iamVjdChtYykpIHtcbiAgICAgICAgICAgICAgICBsZXQgZyA9IG1jLlVJT3duZXI7XG4gICAgICAgICAgICAgICAgaWYgKGcudG91Y2hhYmxlICYmIGcuZm9jdXNhYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0Rm9jdXMoZyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1jID0gbWMucGFyZW50O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLiR0b29sdGlwV2luICE9IG51bGwpXG4gICAgICAgICAgICB0aGlzLmhpZGVUb29sdGlwcygpO1xuICAgICAgICB0aGlzLmNoZWNrUG9wdXBzKGV2dC50YXJnZXQpO1xuICAgIH1cbiAgICBjaGVja1BvcHVwcyh0YXJnZXQpIHtcbiAgICAgICAgaWYgKHRoaXMuJGNoZWNraW5nUG9wdXBzKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLiRjaGVja2luZ1BvcHVwcyA9IHRydWU7XG4gICAgICAgIHRoaXMuJGp1c3RDbG9zZWRQb3B1cHMubGVuZ3RoID0gMDtcbiAgICAgICAgaWYgKHRoaXMuJHBvcHVwU3RhY2subGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgbGV0IG1jID0gdGFyZ2V0O1xuICAgICAgICAgICAgd2hpbGUgKG1jICYmIG1jICE9IHRoaXMubmF0aXZlU3RhZ2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNVSU9iamVjdChtYykpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHBpbmRleCA9IHRoaXMuJHBvcHVwU3RhY2suaW5kZXhPZihtYy5VSU93bmVyKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBpbmRleCAhPSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHBvcHVwO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMuJHBvcHVwU3RhY2subGVuZ3RoIC0gMTsgaSA+IHBpbmRleDsgaS0tKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9wdXAgPSB0aGlzLiRwb3B1cFN0YWNrLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VQb3B1cChwb3B1cCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kanVzdENsb3NlZFBvcHVwcy5wdXNoKHBvcHVwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBtYyA9IG1jLnBhcmVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBjbnQgPSB0aGlzLiRwb3B1cFN0YWNrLmxlbmd0aDtcbiAgICAgICAgICAgIGxldCBwb3B1cDtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSBjbnQgLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgIHBvcHVwID0gdGhpcy4kcG9wdXBTdGFja1tpXTtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlUG9wdXAocG9wdXApO1xuICAgICAgICAgICAgICAgIHRoaXMuJGp1c3RDbG9zZWRQb3B1cHMucHVzaChwb3B1cCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLiRwb3B1cFN0YWNrLmxlbmd0aCA9IDA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgJHN0YWdlTW92ZShldnQpIHtcbiAgICAgICAgR1Jvb3QuJGdtU3RhdHVzLm1vdXNlWCA9IGV2dC5zdGFnZVg7XG4gICAgICAgIEdSb290LiRnbVN0YXR1cy5tb3VzZVkgPSBldnQuc3RhZ2VZO1xuICAgIH1cbiAgICAkc3RhZ2VVcChldnQpIHtcbiAgICAgICAgR1Jvb3QuJGdtU3RhdHVzLnRvdWNoRG93biA9IGZhbHNlO1xuICAgICAgICB0aGlzLiRjaGVja2luZ1BvcHVwcyA9IGZhbHNlO1xuICAgIH1cbiAgICAkY2xpY2soZXZ0KSB7IH1cbiAgICAkd2luUmVzaXplKHN0YWdlKSB7XG4gICAgICAgIHRoaXMuc2V0U2l6ZShzdGFnZS5zdGFnZVdpZHRoLCBzdGFnZS5zdGFnZUhlaWdodCk7XG4gICAgfVxufVxuR1Jvb3QudW5pcXVlSUQgPSAwO1xuR1Jvb3QuJGdtU3RhdHVzID0gbmV3IEdSb290TW91c2VTdGF0dXMoKTtcbkRlY2xzJDEuR1Jvb3QgPSBHUm9vdDtcblxudmFyIFRFWFRfR1JBRElFTlQ7XG4oZnVuY3Rpb24gKFRFWFRfR1JBRElFTlQpIHtcbiAgICBURVhUX0dSQURJRU5UW1RFWFRfR1JBRElFTlRbXCJMSU5FQVJfVkVSVElDQUxcIl0gPSAwXSA9IFwiTElORUFSX1ZFUlRJQ0FMXCI7XG4gICAgVEVYVF9HUkFESUVOVFtURVhUX0dSQURJRU5UW1wiTElORUFSX0hPUklaT05UQUxcIl0gPSAxXSA9IFwiTElORUFSX0hPUklaT05UQUxcIjtcbn0pKFRFWFRfR1JBRElFTlQgfHwgKFRFWFRfR1JBRElFTlQgPSB7fSkpO1xuY29uc3QgZGVmYXVsdFN0eWxlID0ge1xuICAgIGFsaWduOiAnbGVmdCcsXG4gICAgYnJlYWtXb3JkczogZmFsc2UsXG4gICAgZHJvcFNoYWRvdzogZmFsc2UsXG4gICAgZHJvcFNoYWRvd0FscGhhOiAxLFxuICAgIGRyb3BTaGFkb3dBbmdsZTogTWF0aC5QSSAvIDYsXG4gICAgZHJvcFNoYWRvd0JsdXI6IDAsXG4gICAgZHJvcFNoYWRvd0NvbG9yOiAnYmxhY2snLFxuICAgIGRyb3BTaGFkb3dEaXN0YW5jZTogNSxcbiAgICBkcm9wU2hhZG93T2Zmc2V0WDogMCxcbiAgICBkcm9wU2hhZG93T2Zmc2V0WTogMCxcbiAgICBmaWxsOiAnYmxhY2snLFxuICAgIGZpbGxHcmFkaWVudFR5cGU6IFRFWFRfR1JBRElFTlQuTElORUFSX1ZFUlRJQ0FMLFxuICAgIGZpbGxHcmFkaWVudFN0b3BzOiBbXSxcbiAgICBmb250RmFtaWx5OiAnQXJpYWwnLFxuICAgIGZvbnRTaXplOiAyNixcbiAgICBmb250U3R5bGU6ICdub3JtYWwnLFxuICAgIGZvbnRWYXJpYW50OiAnbm9ybWFsJyxcbiAgICBmb250V2VpZ2h0OiAnbm9ybWFsJyxcbiAgICBsZXR0ZXJTcGFjaW5nOiAwLFxuICAgIGxpbmVIZWlnaHQ6IDAsXG4gICAgbGluZUpvaW46ICdtaXRlcicsXG4gICAgbWl0ZXJMaW1pdDogMTAsXG4gICAgcGFkZGluZzogMCxcbiAgICBzdHJva2U6ICdibGFjaycsXG4gICAgc3Ryb2tlVGhpY2tuZXNzOiAwLFxuICAgIHRleHRCYXNlbGluZTogJ2FscGhhYmV0aWMnLFxuICAgIHRyaW06IGZhbHNlLFxuICAgIHdoaXRlU3BhY2U6ICdwcmUnLFxuICAgIHdvcmRXcmFwOiBmYWxzZSxcbiAgICB3b3JkV3JhcFdpZHRoOiAxMDAsXG4gICAgbGVhZGluZzogMFxufTtcbmNvbnN0IGdlbmVyaWNGb250RmFtaWxpZXMgPSBbJ3NlcmlmJywgJ3NhbnMtc2VyaWYnLCAnbW9ub3NwYWNlJywgJ2N1cnNpdmUnLCAnZmFudGFzeScsICdzeXN0ZW0tdWknXTtcbmNsYXNzIFRleHRTdHlsZSB7XG4gICAgY29uc3RydWN0b3Ioc3R5bGUpIHtcbiAgICAgICAgdGhpcy5zdHlsZUlEID0gMDtcbiAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICBVdGlscy5kZWVwQ29weVByb3BlcnRpZXModGhpcywgc3R5bGUsIHN0eWxlKTtcbiAgICB9XG4gICAgY2xvbmUoKSB7XG4gICAgICAgIGNvbnN0IGNsb25lZFByb3BlcnRpZXMgPSB7fTtcbiAgICAgICAgVXRpbHMuZGVlcENvcHlQcm9wZXJ0aWVzKGNsb25lZFByb3BlcnRpZXMsIHRoaXMsIGRlZmF1bHRTdHlsZSk7XG4gICAgICAgIHJldHVybiBuZXcgVGV4dFN0eWxlKGNsb25lZFByb3BlcnRpZXMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXNldHMgYWxsIHByb3BlcnRpZXMgdG8gdGhlIGRlZmF1bHRzIHNwZWNpZmllZCBpbiBUZXh0U3R5bGUucHJvdG90eXBlLl9kZWZhdWx0XG4gICAgICovXG4gICAgcmVzZXQoKSB7XG4gICAgICAgIFV0aWxzLmRlZXBDb3B5UHJvcGVydGllcyh0aGlzLCBkZWZhdWx0U3R5bGUsIGRlZmF1bHRTdHlsZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFsaWdubWVudCBmb3IgbXVsdGlsaW5lIHRleHQgKCdsZWZ0JywgJ2NlbnRlcicgb3IgJ3JpZ2h0JyksIGRvZXMgbm90IGFmZmVjdCBzaW5nbGUgbGluZSB0ZXh0XG4gICAgICpcbiAgICAgKiBAbWVtYmVyIHtzdHJpbmd9XG4gICAgICovXG4gICAgZ2V0IGFsaWduKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYWxpZ247XG4gICAgfVxuICAgIHNldCBhbGlnbihhbGlnbikge1xuICAgICAgICBpZiAodGhpcy5fYWxpZ24gIT09IGFsaWduKSB7XG4gICAgICAgICAgICB0aGlzLl9hbGlnbiA9IGFsaWduO1xuICAgICAgICAgICAgdGhpcy5zdHlsZUlEKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogSW5kaWNhdGVzIGlmIGxpbmVzIGNhbiBiZSB3cmFwcGVkIHdpdGhpbiB3b3JkcywgaXQgbmVlZHMgd29yZFdyYXAgdG8gYmUgc2V0IHRvIHRydWVcbiAgICAgKlxuICAgICAqIEBtZW1iZXIge2Jvb2xlYW59XG4gICAgICovXG4gICAgZ2V0IGJyZWFrV29yZHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9icmVha1dvcmRzO1xuICAgIH1cbiAgICBzZXQgYnJlYWtXb3JkcyhicmVha1dvcmRzKSB7XG4gICAgICAgIGlmICh0aGlzLl9icmVha1dvcmRzICE9PSBicmVha1dvcmRzKSB7XG4gICAgICAgICAgICB0aGlzLl9icmVha1dvcmRzID0gYnJlYWtXb3JkcztcbiAgICAgICAgICAgIHRoaXMuc3R5bGVJRCsrO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCBhIGRyb3Agc2hhZG93IGZvciB0aGUgdGV4dFxuICAgICAqXG4gICAgICogQG1lbWJlciB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBnZXQgZHJvcFNoYWRvdygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Ryb3BTaGFkb3c7XG4gICAgfVxuICAgIHNldCBkcm9wU2hhZG93KGRyb3BTaGFkb3cpIHtcbiAgICAgICAgaWYgKHRoaXMuX2Ryb3BTaGFkb3cgIT09IGRyb3BTaGFkb3cpIHtcbiAgICAgICAgICAgIHRoaXMuX2Ryb3BTaGFkb3cgPSBkcm9wU2hhZG93O1xuICAgICAgICAgICAgdGhpcy5zdHlsZUlEKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0IGFscGhhIGZvciB0aGUgZHJvcCBzaGFkb3dcbiAgICAgKlxuICAgICAqIEBtZW1iZXIge251bWJlcn1cbiAgICAgKi9cbiAgICBnZXQgZHJvcFNoYWRvd0FscGhhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZHJvcFNoYWRvd0FscGhhO1xuICAgIH1cbiAgICBzZXQgZHJvcFNoYWRvd0FscGhhKGRyb3BTaGFkb3dBbHBoYSkge1xuICAgICAgICBpZiAodGhpcy5fZHJvcFNoYWRvd0FscGhhICE9PSBkcm9wU2hhZG93QWxwaGEpIHtcbiAgICAgICAgICAgIHRoaXMuX2Ryb3BTaGFkb3dBbHBoYSA9IGRyb3BTaGFkb3dBbHBoYTtcbiAgICAgICAgICAgIHRoaXMuc3R5bGVJRCsrO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCBhIGFuZ2xlIG9mIHRoZSBkcm9wIHNoYWRvd1xuICAgICAqXG4gICAgICogQG1lbWJlciB7bnVtYmVyfVxuICAgICAqL1xuICAgIGdldCBkcm9wU2hhZG93QW5nbGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kcm9wU2hhZG93QW5nbGU7XG4gICAgfVxuICAgIHNldCBkcm9wU2hhZG93QW5nbGUoZHJvcFNoYWRvd0FuZ2xlKSB7XG4gICAgICAgIGlmICh0aGlzLl9kcm9wU2hhZG93QW5nbGUgIT09IGRyb3BTaGFkb3dBbmdsZSkge1xuICAgICAgICAgICAgdGhpcy5fZHJvcFNoYWRvd0FuZ2xlID0gZHJvcFNoYWRvd0FuZ2xlO1xuICAgICAgICAgICAgdGhpcy5zdHlsZUlEKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0IGEgc2hhZG93IGJsdXIgcmFkaXVzXG4gICAgICpcbiAgICAgKiBAbWVtYmVyIHtudW1iZXJ9XG4gICAgICovXG4gICAgZ2V0IGRyb3BTaGFkb3dCbHVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZHJvcFNoYWRvd0JsdXI7XG4gICAgfVxuICAgIHNldCBkcm9wU2hhZG93Qmx1cihkcm9wU2hhZG93Qmx1cikge1xuICAgICAgICBpZiAodGhpcy5fZHJvcFNoYWRvd0JsdXIgIT09IGRyb3BTaGFkb3dCbHVyKSB7XG4gICAgICAgICAgICB0aGlzLl9kcm9wU2hhZG93Qmx1ciA9IGRyb3BTaGFkb3dCbHVyO1xuICAgICAgICAgICAgdGhpcy5zdHlsZUlEKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQSBmaWxsIHN0eWxlIHRvIGJlIHVzZWQgb24gdGhlIGRyb3BzaGFkb3cgZS5nICdyZWQnLCAnIzAwRkYwMCdcbiAgICAgKlxuICAgICAqIEBtZW1iZXIge3N0cmluZ3xudW1iZXJ9XG4gICAgICovXG4gICAgZ2V0IGRyb3BTaGFkb3dDb2xvcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Ryb3BTaGFkb3dDb2xvcjtcbiAgICB9XG4gICAgc2V0IGRyb3BTaGFkb3dDb2xvcihkcm9wU2hhZG93Q29sb3IpIHtcbiAgICAgICAgY29uc3Qgb3V0cHV0Q29sb3IgPSBnZXRDb2xvcihkcm9wU2hhZG93Q29sb3IpO1xuICAgICAgICBpZiAodGhpcy5fZHJvcFNoYWRvd0NvbG9yICE9PSBvdXRwdXRDb2xvcikge1xuICAgICAgICAgICAgdGhpcy5fZHJvcFNoYWRvd0NvbG9yID0gb3V0cHV0Q29sb3I7XG4gICAgICAgICAgICB0aGlzLnN0eWxlSUQrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXQgYSBkaXN0YW5jZSBvZiB0aGUgZHJvcCBzaGFkb3dcbiAgICAgKlxuICAgICAqIEBtZW1iZXIge251bWJlcn1cbiAgICAgKi9cbiAgICBnZXQgZHJvcFNoYWRvd0Rpc3RhbmNlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZHJvcFNoYWRvd0Rpc3RhbmNlO1xuICAgIH1cbiAgICBzZXQgZHJvcFNoYWRvd0Rpc3RhbmNlKGRyb3BTaGFkb3dEaXN0YW5jZSkge1xuICAgICAgICBpZiAodGhpcy5fZHJvcFNoYWRvd0Rpc3RhbmNlICE9PSBkcm9wU2hhZG93RGlzdGFuY2UpIHtcbiAgICAgICAgICAgIHRoaXMuX2Ryb3BTaGFkb3dEaXN0YW5jZSA9IGRyb3BTaGFkb3dEaXN0YW5jZTtcbiAgICAgICAgICAgIHRoaXMuc3R5bGVJRCsrO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldCBhIG9mZnNldFggb2YgdGhlIGRyb3Agc2hhZG93XG4gICAgICpcbiAgICAgKiBAbWVtYmVyIHtudW1iZXJ9XG4gICAgICovXG4gICAgZ2V0IGRyb3BTaGFkb3dPZmZzZXRYKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZHJvcFNoYWRvd09mZnNldFg7XG4gICAgfVxuICAgIHNldCBkcm9wU2hhZG93T2Zmc2V0WChkcm9wU2hhZG93T2Zmc2V0WCkge1xuICAgICAgICBpZiAodGhpcy5fZHJvcFNoYWRvd09mZnNldFggIT09IGRyb3BTaGFkb3dPZmZzZXRYKSB7XG4gICAgICAgICAgICB0aGlzLl9kcm9wU2hhZG93T2Zmc2V0WCA9IGRyb3BTaGFkb3dPZmZzZXRYO1xuICAgICAgICAgICAgdGhpcy5zdHlsZUlEKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0IGEgb2Zmc2V0WSBvZiB0aGUgZHJvcCBzaGFkb3dcbiAgICAgKlxuICAgICAqIEBtZW1iZXIge251bWJlcn1cbiAgICAgKi9cbiAgICBnZXQgZHJvcFNoYWRvd09mZnNldFkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kcm9wU2hhZG93T2Zmc2V0WTtcbiAgICB9XG4gICAgc2V0IGRyb3BTaGFkb3dPZmZzZXRZKGRyb3BTaGFkb3dPZmZzZXRZKSB7XG4gICAgICAgIGlmICh0aGlzLl9kcm9wU2hhZG93T2Zmc2V0WSAhPT0gZHJvcFNoYWRvd09mZnNldFkpIHtcbiAgICAgICAgICAgIHRoaXMuX2Ryb3BTaGFkb3dPZmZzZXRZID0gZHJvcFNoYWRvd09mZnNldFk7XG4gICAgICAgICAgICB0aGlzLnN0eWxlSUQrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBBIGNhbnZhcyBmaWxsc3R5bGUgdGhhdCB3aWxsIGJlIHVzZWQgb24gdGhlIHRleHQgZS5nICdyZWQnLCAnIzAwRkYwMCcuXG4gICAgICogQ2FuIGJlIGFuIGFycmF5IHRvIGNyZWF0ZSBhIGdyYWRpZW50IGVnIFsnIzAwMDAwMCcsJyNGRkZGRkYnXVxuICAgICAqIHtAbGluayBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEL2ZpbGxTdHlsZXxNRE59XG4gICAgICpcbiAgICAgKiBAbWVtYmVyIHtzdHJpbmd8c3RyaW5nW118bnVtYmVyfG51bWJlcltdfENhbnZhc0dyYWRpZW50fENhbnZhc1BhdHRlcm59XG4gICAgICovXG4gICAgZ2V0IGZpbGwoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9maWxsO1xuICAgIH1cbiAgICBzZXQgZmlsbChmaWxsKSB7XG4gICAgICAgIGNvbnN0IG91dHB1dENvbG9yID0gZ2V0Q29sb3IoZmlsbCk7XG4gICAgICAgIGlmICh0aGlzLl9maWxsICE9PSBvdXRwdXRDb2xvcikge1xuICAgICAgICAgICAgdGhpcy5fZmlsbCA9IG91dHB1dENvbG9yO1xuICAgICAgICAgICAgdGhpcy5zdHlsZUlEKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGZpbGxHcmFkaWVudFR5cGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9maWxsR3JhZGllbnRUeXBlO1xuICAgIH1cbiAgICBzZXQgZmlsbEdyYWRpZW50VHlwZShmaWxsR3JhZGllbnRUeXBlKSB7XG4gICAgICAgIGlmICh0aGlzLl9maWxsR3JhZGllbnRUeXBlICE9PSBmaWxsR3JhZGllbnRUeXBlKSB7XG4gICAgICAgICAgICB0aGlzLl9maWxsR3JhZGllbnRUeXBlID0gZmlsbEdyYWRpZW50VHlwZTtcbiAgICAgICAgICAgIHRoaXMuc3R5bGVJRCsrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBmaWxsR3JhZGllbnRTdG9wcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGxHcmFkaWVudFN0b3BzO1xuICAgIH1cbiAgICBzZXQgZmlsbEdyYWRpZW50U3RvcHMoZmlsbEdyYWRpZW50U3RvcHMpIHtcbiAgICAgICAgaWYgKCFhcmVBcnJheXNFcXVhbCh0aGlzLl9maWxsR3JhZGllbnRTdG9wcywgZmlsbEdyYWRpZW50U3RvcHMpKSB7XG4gICAgICAgICAgICB0aGlzLl9maWxsR3JhZGllbnRTdG9wcyA9IGZpbGxHcmFkaWVudFN0b3BzO1xuICAgICAgICAgICAgdGhpcy5zdHlsZUlEKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGZvbnRGYW1pbHkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9mb250RmFtaWx5O1xuICAgIH1cbiAgICBzZXQgZm9udEZhbWlseShmb250RmFtaWx5KSB7XG4gICAgICAgIGlmICh0aGlzLmZvbnRGYW1pbHkgIT09IGZvbnRGYW1pbHkpIHtcbiAgICAgICAgICAgIHRoaXMuX2ZvbnRGYW1pbHkgPSBmb250RmFtaWx5O1xuICAgICAgICAgICAgdGhpcy5zdHlsZUlEKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGZvbnRTaXplKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZm9udFNpemU7XG4gICAgfVxuICAgIHNldCBmb250U2l6ZShmb250U2l6ZSkge1xuICAgICAgICBpZiAodGhpcy5fZm9udFNpemUgIT09IGZvbnRTaXplKSB7XG4gICAgICAgICAgICB0aGlzLl9mb250U2l6ZSA9IGZvbnRTaXplO1xuICAgICAgICAgICAgdGhpcy5zdHlsZUlEKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGZvbnRTdHlsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ZvbnRTdHlsZTtcbiAgICB9XG4gICAgc2V0IGZvbnRTdHlsZShmb250U3R5bGUpIHtcbiAgICAgICAgaWYgKHRoaXMuX2ZvbnRTdHlsZSAhPT0gZm9udFN0eWxlKSB7XG4gICAgICAgICAgICB0aGlzLl9mb250U3R5bGUgPSBmb250U3R5bGU7XG4gICAgICAgICAgICB0aGlzLnN0eWxlSUQrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgZm9udCB2YXJpYW50XG4gICAgICogKCdub3JtYWwnIG9yICdzbWFsbC1jYXBzJylcbiAgICAgKlxuICAgICAqIEBtZW1iZXIge3N0cmluZ31cbiAgICAgKi9cbiAgICBnZXQgZm9udFZhcmlhbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9mb250VmFyaWFudDtcbiAgICB9XG4gICAgc2V0IGZvbnRWYXJpYW50KGZvbnRWYXJpYW50KSB7XG4gICAgICAgIGlmICh0aGlzLl9mb250VmFyaWFudCAhPT0gZm9udFZhcmlhbnQpIHtcbiAgICAgICAgICAgIHRoaXMuX2ZvbnRWYXJpYW50ID0gZm9udFZhcmlhbnQ7XG4gICAgICAgICAgICB0aGlzLnN0eWxlSUQrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgZm9udCB3ZWlnaHRcbiAgICAgKiAoJ25vcm1hbCcsICdib2xkJywgJ2JvbGRlcicsICdsaWdodGVyJyBhbmQgJzEwMCcsICcyMDAnLCAnMzAwJywgJzQwMCcsICc1MDAnLCAnNjAwJywgJzcwMCcsIDgwMCcgb3IgJzkwMCcpXG4gICAgICpcbiAgICAgKiBAbWVtYmVyIHtzdHJpbmd9XG4gICAgICovXG4gICAgZ2V0IGZvbnRXZWlnaHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9mb250V2VpZ2h0O1xuICAgIH1cbiAgICBzZXQgZm9udFdlaWdodChmb250V2VpZ2h0KSB7XG4gICAgICAgIGlmICh0aGlzLl9mb250V2VpZ2h0ICE9PSBmb250V2VpZ2h0KSB7XG4gICAgICAgICAgICB0aGlzLl9mb250V2VpZ2h0ID0gZm9udFdlaWdodDtcbiAgICAgICAgICAgIHRoaXMuc3R5bGVJRCsrO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBhbW91bnQgb2Ygc3BhY2luZyBiZXR3ZWVuIGxldHRlcnMsIGRlZmF1bHQgaXMgMFxuICAgICAqXG4gICAgICogQG1lbWJlciB7bnVtYmVyfVxuICAgICAqL1xuICAgIGdldCBsZXR0ZXJTcGFjaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbGV0dGVyU3BhY2luZztcbiAgICB9XG4gICAgc2V0IGxldHRlclNwYWNpbmcobGV0dGVyU3BhY2luZykge1xuICAgICAgICBpZiAodGhpcy5fbGV0dGVyU3BhY2luZyAhPT0gbGV0dGVyU3BhY2luZykge1xuICAgICAgICAgICAgdGhpcy5fbGV0dGVyU3BhY2luZyA9IGxldHRlclNwYWNpbmc7XG4gICAgICAgICAgICB0aGlzLnN0eWxlSUQrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgbGluZSBoZWlnaHQsIGEgbnVtYmVyIHRoYXQgcmVwcmVzZW50cyB0aGUgdmVydGljYWwgc3BhY2UgdGhhdCBhIGxldHRlciB1c2VzXG4gICAgICpcbiAgICAgKiBAbWVtYmVyIHtudW1iZXJ9XG4gICAgICovXG4gICAgZ2V0IGxpbmVIZWlnaHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9saW5lSGVpZ2h0O1xuICAgIH1cbiAgICBzZXQgbGluZUhlaWdodChsaW5lSGVpZ2h0KSB7XG4gICAgICAgIGlmICh0aGlzLl9saW5lSGVpZ2h0ICE9PSBsaW5lSGVpZ2h0KSB7XG4gICAgICAgICAgICB0aGlzLl9saW5lSGVpZ2h0ID0gbGluZUhlaWdodDtcbiAgICAgICAgICAgIHRoaXMuc3R5bGVJRCsrO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBzcGFjZSBiZXR3ZWVuIGxpbmVzXG4gICAgICpcbiAgICAgKiBAbWVtYmVyIHtudW1iZXJ9XG4gICAgICovXG4gICAgZ2V0IGxlYWRpbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9sZWFkaW5nO1xuICAgIH1cbiAgICBzZXQgbGVhZGluZyhsZWFkaW5nKSB7XG4gICAgICAgIGlmICh0aGlzLl9sZWFkaW5nICE9PSBsZWFkaW5nKSB7XG4gICAgICAgICAgICB0aGlzLl9sZWFkaW5nID0gbGVhZGluZztcbiAgICAgICAgICAgIHRoaXMuc3R5bGVJRCsrO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBsaW5lSm9pbiBwcm9wZXJ0eSBzZXRzIHRoZSB0eXBlIG9mIGNvcm5lciBjcmVhdGVkLCBpdCBjYW4gcmVzb2x2ZSBzcGlrZWQgdGV4dCBpc3N1ZXMuXG4gICAgICogRGVmYXVsdCBpcyAnbWl0ZXInIChjcmVhdGVzIGEgc2hhcnAgY29ybmVyKS5cbiAgICAgKlxuICAgICAqIEBtZW1iZXIge3N0cmluZ31cbiAgICAgKi9cbiAgICBnZXQgbGluZUpvaW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9saW5lSm9pbjtcbiAgICB9XG4gICAgc2V0IGxpbmVKb2luKGxpbmVKb2luKSB7XG4gICAgICAgIGlmICh0aGlzLl9saW5lSm9pbiAhPT0gbGluZUpvaW4pIHtcbiAgICAgICAgICAgIHRoaXMuX2xpbmVKb2luID0gbGluZUpvaW47XG4gICAgICAgICAgICB0aGlzLnN0eWxlSUQrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgbWl0ZXIgbGltaXQgdG8gdXNlIHdoZW4gdXNpbmcgdGhlICdtaXRlcicgbGluZUpvaW4gbW9kZVxuICAgICAqIFRoaXMgY2FuIHJlZHVjZSBvciBpbmNyZWFzZSB0aGUgc3Bpa2luZXNzIG9mIHJlbmRlcmVkIHRleHQuXG4gICAgICpcbiAgICAgKiBAbWVtYmVyIHtudW1iZXJ9XG4gICAgICovXG4gICAgZ2V0IG1pdGVyTGltaXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9taXRlckxpbWl0O1xuICAgIH1cbiAgICBzZXQgbWl0ZXJMaW1pdChtaXRlckxpbWl0KSB7XG4gICAgICAgIGlmICh0aGlzLl9taXRlckxpbWl0ICE9PSBtaXRlckxpbWl0KSB7XG4gICAgICAgICAgICB0aGlzLl9taXRlckxpbWl0ID0gbWl0ZXJMaW1pdDtcbiAgICAgICAgICAgIHRoaXMuc3R5bGVJRCsrO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE9jY2FzaW9uYWxseSBzb21lIGZvbnRzIGFyZSBjcm9wcGVkLiBBZGRpbmcgc29tZSBwYWRkaW5nIHdpbGwgcHJldmVudCB0aGlzIGZyb20gaGFwcGVuaW5nXG4gICAgICogYnkgYWRkaW5nIHBhZGRpbmcgdG8gYWxsIHNpZGVzIG9mIHRoZSB0ZXh0LlxuICAgICAqXG4gICAgICogQG1lbWJlciB7bnVtYmVyfVxuICAgICAqL1xuICAgIGdldCBwYWRkaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcGFkZGluZztcbiAgICB9XG4gICAgc2V0IHBhZGRpbmcocGFkZGluZykge1xuICAgICAgICBpZiAodGhpcy5fcGFkZGluZyAhPT0gcGFkZGluZykge1xuICAgICAgICAgICAgdGhpcy5fcGFkZGluZyA9IHBhZGRpbmc7XG4gICAgICAgICAgICB0aGlzLnN0eWxlSUQrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBBIGNhbnZhcyBmaWxsc3R5bGUgdGhhdCB3aWxsIGJlIHVzZWQgb24gdGhlIHRleHQgc3Ryb2tlXG4gICAgICogZS5nICdibHVlJywgJyNGQ0ZGMDAnXG4gICAgICpcbiAgICAgKiBAbWVtYmVyIHtzdHJpbmd9XG4gICAgICovXG4gICAgZ2V0IHN0cm9rZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0cm9rZTtcbiAgICB9XG4gICAgc2V0IHN0cm9rZShzdHJva2UpIHtcbiAgICAgICAgLy8gVE9ETzogQ2FuJ3QgaGF2ZSBkaWZmZXJlbnQgdHlwZXMgZm9yIGdldHRlciBhbmQgc2V0dGVyLiBUaGUgZ2V0dGVyIHNob3VsZG4ndCBoYXZlIHRoZSBudW1iZXIgdHlwZSBhc1xuICAgICAgICAvLyAgICAgICB0aGUgc2V0dGVyIGNvbnZlcnRzIHRvIHN0cmluZy4gU2VlIHRoaXMgdGhyZWFkIGZvciBtb3JlIGRldGFpbHM6XG4gICAgICAgIC8vICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvMjUyMVxuICAgICAgICBjb25zdCBvdXRwdXRDb2xvciA9IGdldENvbG9yKHN0cm9rZSk7XG4gICAgICAgIGlmICh0aGlzLl9zdHJva2UgIT09IG91dHB1dENvbG9yKSB7XG4gICAgICAgICAgICB0aGlzLl9zdHJva2UgPSBvdXRwdXRDb2xvcjtcbiAgICAgICAgICAgIHRoaXMuc3R5bGVJRCsrO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEEgbnVtYmVyIHRoYXQgcmVwcmVzZW50cyB0aGUgdGhpY2tuZXNzIG9mIHRoZSBzdHJva2UuXG4gICAgICogRGVmYXVsdCBpcyAwIChubyBzdHJva2UpXG4gICAgICpcbiAgICAgKiBAbWVtYmVyIHtudW1iZXJ9XG4gICAgICovXG4gICAgZ2V0IHN0cm9rZVRoaWNrbmVzcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0cm9rZVRoaWNrbmVzcztcbiAgICB9XG4gICAgc2V0IHN0cm9rZVRoaWNrbmVzcyhzdHJva2VUaGlja25lc3MpIHtcbiAgICAgICAgaWYgKHRoaXMuX3N0cm9rZVRoaWNrbmVzcyAhPT0gc3Ryb2tlVGhpY2tuZXNzKSB7XG4gICAgICAgICAgICB0aGlzLl9zdHJva2VUaGlja25lc3MgPSBzdHJva2VUaGlja25lc3M7XG4gICAgICAgICAgICB0aGlzLnN0eWxlSUQrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgYmFzZWxpbmUgb2YgdGhlIHRleHQgdGhhdCBpcyByZW5kZXJlZC5cbiAgICAgKlxuICAgICAqIEBtZW1iZXIge3N0cmluZ31cbiAgICAgKi9cbiAgICBnZXQgdGV4dEJhc2VsaW5lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGV4dEJhc2VsaW5lO1xuICAgIH1cbiAgICBzZXQgdGV4dEJhc2VsaW5lKHRleHRCYXNlbGluZSkge1xuICAgICAgICBpZiAodGhpcy5fdGV4dEJhc2VsaW5lICE9PSB0ZXh0QmFzZWxpbmUpIHtcbiAgICAgICAgICAgIHRoaXMuX3RleHRCYXNlbGluZSA9IHRleHRCYXNlbGluZTtcbiAgICAgICAgICAgIHRoaXMuc3R5bGVJRCsrO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRyaW0gdHJhbnNwYXJlbnQgYm9yZGVyc1xuICAgICAqXG4gICAgICogQG1lbWJlciB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBnZXQgdHJpbSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RyaW07XG4gICAgfVxuICAgIHNldCB0cmltKHRyaW0pIHtcbiAgICAgICAgaWYgKHRoaXMuX3RyaW0gIT09IHRyaW0pIHtcbiAgICAgICAgICAgIHRoaXMuX3RyaW0gPSB0cmltO1xuICAgICAgICAgICAgdGhpcy5zdHlsZUlEKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogSG93IG5ld2xpbmVzIGFuZCBzcGFjZXMgc2hvdWxkIGJlIGhhbmRsZWQuXG4gICAgICogRGVmYXVsdCBpcyAncHJlJyAocHJlc2VydmUsIHByZXNlcnZlKS5cbiAgICAgKlxuICAgICAqICB2YWx1ZSAgICAgICB8IE5ldyBsaW5lcyAgICAgfCAgIFNwYWNlc1xuICAgICAqICAtLS0gICAgICAgICB8IC0tLSAgICAgICAgICAgfCAgIC0tLVxuICAgICAqICdub3JtYWwnICAgICB8IENvbGxhcHNlICAgICAgfCAgIENvbGxhcHNlXG4gICAgICogJ3ByZScgICAgICAgIHwgUHJlc2VydmUgICAgICB8ICAgUHJlc2VydmVcbiAgICAgKiAncHJlLWxpbmUnICAgfCBQcmVzZXJ2ZSAgICAgIHwgICBDb2xsYXBzZVxuICAgICAqXG4gICAgICogQG1lbWJlciB7c3RyaW5nfVxuICAgICAqL1xuICAgIGdldCB3aGl0ZVNwYWNlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fd2hpdGVTcGFjZTtcbiAgICB9XG4gICAgc2V0IHdoaXRlU3BhY2Uod2hpdGVTcGFjZSkge1xuICAgICAgICBpZiAodGhpcy5fd2hpdGVTcGFjZSAhPT0gd2hpdGVTcGFjZSkge1xuICAgICAgICAgICAgdGhpcy5fd2hpdGVTcGFjZSA9IHdoaXRlU3BhY2U7XG4gICAgICAgICAgICB0aGlzLnN0eWxlSUQrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbmRpY2F0ZXMgaWYgd29yZCB3cmFwIHNob3VsZCBiZSB1c2VkXG4gICAgICpcbiAgICAgKiBAbWVtYmVyIHtib29sZWFufVxuICAgICAqL1xuICAgIGdldCB3b3JkV3JhcCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3dvcmRXcmFwO1xuICAgIH1cbiAgICBzZXQgd29yZFdyYXAod29yZFdyYXApIHtcbiAgICAgICAgaWYgKHRoaXMuX3dvcmRXcmFwICE9PSB3b3JkV3JhcCkge1xuICAgICAgICAgICAgdGhpcy5fd29yZFdyYXAgPSB3b3JkV3JhcDtcbiAgICAgICAgICAgIHRoaXMuc3R5bGVJRCsrO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSB3aWR0aCBhdCB3aGljaCB0ZXh0IHdpbGwgd3JhcCwgaXQgbmVlZHMgd29yZFdyYXAgdG8gYmUgc2V0IHRvIHRydWVcbiAgICAgKlxuICAgICAqIEBtZW1iZXIge251bWJlcn1cbiAgICAgKi9cbiAgICBnZXQgd29yZFdyYXBXaWR0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3dvcmRXcmFwV2lkdGg7XG4gICAgfVxuICAgIHNldCB3b3JkV3JhcFdpZHRoKHdvcmRXcmFwV2lkdGgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3dvcmRXcmFwV2lkdGggIT09IHdvcmRXcmFwV2lkdGgpIHtcbiAgICAgICAgICAgIHRoaXMuX3dvcmRXcmFwV2lkdGggPSB3b3JkV3JhcFdpZHRoO1xuICAgICAgICAgICAgdGhpcy5zdHlsZUlEKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogR2VuZXJhdGVzIGEgZm9udCBzdHlsZSBzdHJpbmcgdG8gdXNlIGZvciBgVGV4dE1ldHJpY3MubWVhc3VyZUZvbnQoKWAuXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IEZvbnQgc3R5bGUgc3RyaW5nLCBmb3IgcGFzc2luZyB0byBgVGV4dE1ldHJpY3MubWVhc3VyZUZvbnQoKWBcbiAgICAgKi9cbiAgICB0b0ZvbnRTdHJpbmcoKSB7XG4gICAgICAgIC8vIGJ1aWxkIGNhbnZhcyBhcGkgZm9udCBzZXR0aW5nIGZyb20gaW5kaXZpZHVhbCBjb21wb25lbnRzLiBDb252ZXJ0IGEgbnVtZXJpYyB0aGlzLmZvbnRTaXplIHRvIHB4XG4gICAgICAgIGNvbnN0IGZvbnRTaXplU3RyaW5nID0gdHlwZW9mIHRoaXMuZm9udFNpemUgPT09ICdudW1iZXInID8gYCR7dGhpcy5mb250U2l6ZX1weGAgOiB0aGlzLmZvbnRTaXplO1xuICAgICAgICAvLyBDbGVhbi11cCBmb250RmFtaWx5IHByb3BlcnR5IGJ5IHF1b3RpbmcgZWFjaCBmb250IG5hbWVcbiAgICAgICAgLy8gdGhpcyB3aWxsIHN1cHBvcnQgZm9udCBuYW1lcyB3aXRoIHNwYWNlc1xuICAgICAgICBsZXQgZm9udEZhbWlsaWVzID0gdGhpcy5mb250RmFtaWx5O1xuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodGhpcy5mb250RmFtaWx5KSkge1xuICAgICAgICAgICAgZm9udEZhbWlsaWVzID0gdGhpcy5mb250RmFtaWx5LnNwbGl0KCcsJyk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IGZvbnRGYW1pbGllcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgLy8gVHJpbSBhbnkgZXh0cmEgd2hpdGUtc3BhY2VcbiAgICAgICAgICAgIGxldCBmb250RmFtaWx5ID0gZm9udEZhbWlsaWVzW2ldLnRyaW0oKTtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGZvbnQgYWxyZWFkeSBjb250YWlucyBzdHJpbmdzXG4gICAgICAgICAgICBpZiAoIS8oW1xcXCJcXCddKVteXFwnXFxcIl0rXFwxLy50ZXN0KGZvbnRGYW1pbHkpICYmIGdlbmVyaWNGb250RmFtaWxpZXMuaW5kZXhPZihmb250RmFtaWx5KSA8IDApIHtcbiAgICAgICAgICAgICAgICBmb250RmFtaWx5ID0gYFwiJHtmb250RmFtaWx5fVwiYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvbnRGYW1pbGllc1tpXSA9IGZvbnRGYW1pbHk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGAke3RoaXMuZm9udFN0eWxlfSAke3RoaXMuZm9udFZhcmlhbnR9ICR7dGhpcy5mb250V2VpZ2h0fSAke2ZvbnRTaXplU3RyaW5nfSAke2ZvbnRGYW1pbGllcy5qb2luKCcsJyl9YDtcbiAgICB9XG59XG5mdW5jdGlvbiBnZXRTaW5nbGVDb2xvcihjb2xvcikge1xuICAgIGlmICh0eXBlb2YgY29sb3IgPT09ICdudW1iZXInKSB7XG4gICAgICAgIHJldHVybiBTdHJpbmdVdGlsLmNvbnZlcnRUb0h0bWxDb2xvcihjb2xvcik7XG4gICAgICAgIC8vIC8vIHRvZG9cbiAgICAgICAgLy8gcmV0dXJuIGNvbG9yXG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGVvZiBjb2xvciA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgaWYgKGNvbG9yLmluZGV4T2YoJzB4JykgPT09IDApIHtcbiAgICAgICAgICAgIGNvbG9yID0gY29sb3IucmVwbGFjZSgnMHgnLCAnIycpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjb2xvcjtcbn1cbmZ1bmN0aW9uIGdldENvbG9yKGNvbG9yKSB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGNvbG9yKSkge1xuICAgICAgICByZXR1cm4gZ2V0U2luZ2xlQ29sb3IoY29sb3IpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2xvci5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgY29sb3JbaV0gPSBnZXRTaW5nbGVDb2xvcihjb2xvcltpXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbG9yO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGFyZUFycmF5c0VxdWFsKGFycmF5MSwgYXJyYXkyKSB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGFycmF5MSkgfHwgIUFycmF5LmlzQXJyYXkoYXJyYXkyKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChhcnJheTEubGVuZ3RoICE9PSBhcnJheTIubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnJheTEubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgaWYgKGFycmF5MVtpXSAhPT0gYXJyYXkyW2ldKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5cbmNsYXNzIFVJVGV4dEZpZWxkIGV4dGVuZHMgY3JlYXRlanMuVGV4dCB7XG4gICAgY29uc3RydWN0b3Iob3duZXIpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy4kbWluSGVpZ2h0SUQgPSAtMTtcbiAgICAgICAgdGhpcy5VSU93bmVyID0gb3duZXI7XG4gICAgICAgIHRoaXMuc3R5bGUgPSBuZXcgVGV4dFN0eWxlKHt9KTtcbiAgICAgICAgLy8gdGhpcy5tb3VzZUVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgLy8gdGhpcy5pbnRlcmFjdGl2ZSA9IHRoaXMuaW50ZXJhY3RpdmVDaGlsZHJlbiA9IGZhbHNlO1xuICAgICAgICAvLyB0aGlzLl90ZXh0dXJlLm5vRnJhbWUgPSBmYWxzZTtcbiAgICAgICAgLy8gdGhpcy5fd2lkdGggPSB0aGlzLl90ZXh0dXJlLmZyYW1lLndpZHRoO1xuICAgICAgICAvLyB0aGlzLl9oZWlnaHQgPSB0aGlzLl90ZXh0dXJlLmZyYW1lLmhlaWdodDtcbiAgICAgICAgLy8gdGhpcy4kbWluSGVpZ2h0ID0gLTE7XG4gICAgICAgIC8vIHRoaXMuX3RleHR1cmUub24oXCJ1cGRhdGVcIiwgdGhpcy51cGRhdGVGcmFtZSwgdGhpcyk7XG4gICAgfVxuICAgIGdldCBtaW5IZWlnaHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRtaW5IZWlnaHQ7XG4gICAgfVxuICAgIGFwcGx5U3R5bGUoKSB7XG4gICAgICAgIGxldCBjYW52YXMgPSBEZWNscyQxLkdSb290Lmluc3QuYXBwbGljYXRpb25Db250ZXh0LmNhbnZhcztcbiAgICAgICAgdGhpcy5mb250ID0gdGhpcy5zdHlsZS50b0ZvbnRTdHJpbmcoKTtcbiAgICAgICAgdGhpcy5jb2xvciA9IHRoaXMuc3R5bGUuZmlsbDtcbiAgICAgICAgbGV0IGxldHRlclNwYWNpbmcgPSB0aGlzLnN0eWxlLmxldHRlclNwYWNpbmc7XG4gICAgICAgIGlmIChsZXR0ZXJTcGFjaW5nKSB7XG4gICAgICAgICAgICBjYW52YXMuc3R5bGUubGV0dGVyU3BhY2luZyA9IGAke2xldHRlclNwYWNpbmd9cHhgO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY2FudmFzLnN0eWxlLmxldHRlclNwYWNpbmcgPSBgMHB4YDtcbiAgICAgICAgfVxuICAgICAgICBsZXQgbGVhZGluZyA9IHRoaXMuc3R5bGUubGVhZGluZztcbiAgICAgICAgaWYgKGxlYWRpbmcpIHtcbiAgICAgICAgICAgIHRoaXMubGluZUhlaWdodCA9IHRoaXMuZ2V0TWVhc3VyZWRMaW5lSGVpZ2h0KCkgKyBsZWFkaW5nO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5saW5lSGVpZ2h0ID0gdGhpcy5nZXRNZWFzdXJlZExpbmVIZWlnaHQoKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgc3Ryb2tlVGhpY2tuZXNzID0gdGhpcy5zdHlsZS5zdHJva2VUaGlja25lc3M7XG4gICAgICAgIGlmIChzdHJva2VUaGlja25lc3MpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5tdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMubXVsdGlwbGUgPSBuZXcgY3JlYXRlanMuVGV4dCh0aGlzLnRleHQsIHRoaXMuZm9udCwgdGhpcy5jb2xvcik7XG4gICAgICAgICAgICAgICAgdGhpcy5VSU93bmVyLnBhcmVudC5kaXNwbGF5T2JqZWN0LmFkZENoaWxkKHRoaXMubXVsdGlwbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5tdWx0aXBsZS5vdXRsaW5lID0gc3Ryb2tlVGhpY2tuZXNzO1xuICAgICAgICAgICAgaWYgKHRoaXMuc3R5bGUuc3Ryb2tlICE9IHRoaXMuY29sb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm11bHRpcGxlLmNvbG9yID0gdGhpcy5zdHlsZS5zdHJva2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm11bHRpcGxlLmxpbmVIZWlnaHQgPSB0aGlzLmxpbmVIZWlnaHQ7XG4gICAgICAgICAgICB0aGlzLm11bHRpcGxlLmxpbmVXaWR0aCA9IHRoaXMubGluZVdpZHRoO1xuICAgICAgICB9XG4gICAgICAgIGxldCBzaGFkb3cgPSBuZXcgY3JlYXRlanMuU2hhZG93KHRoaXMuc3R5bGUuZHJvcFNoYWRvd0NvbG9yLCB0aGlzLnN0eWxlLmRyb3BTaGFkb3dPZmZzZXRYLCB0aGlzLnN0eWxlLmRyb3BTaGFkb3dPZmZzZXRZLCB0aGlzLnN0eWxlLmRyb3BTaGFkb3dCbHVyKTtcbiAgICAgICAgdGhpcy5zaGFkb3cgPSBzaGFkb3c7XG4gICAgICAgIGxldCB7IHgsIHksIHdpZHRoLCBoZWlnaHQgfSA9IHRoaXM7XG4gICAgICAgIHRoaXMuc2V0Qm91bmRzKHgsIHksIHdpZHRoLCBoZWlnaHQpO1xuICAgIH1cbiAgICAvKipAaW50ZXJuYWwgKi9cbiAgICAkdXBkYXRlTWluSGVpZ2h0KCkge1xuICAgICAgICB0aGlzLiRtaW5IZWlnaHQgPSB0aGlzLmdldE1lYXN1cmVkTGluZUhlaWdodCgpO1xuICAgIH1cbiAgICAvLyBwcm90ZWN0ZWQgdXBkYXRlRnJhbWUoKTogdm9pZCB7XG4gICAgLy8gICAgIEdUaW1lci5pbnN0LmNhbGxMYXRlcih0aGlzLmludGVybmFsVXBkYXRlRnJhbWUsIHRoaXMpO1xuICAgIC8vIH1cbiAgICAvLyBwcml2YXRlIGludGVybmFsVXBkYXRlRnJhbWUoKTogdm9pZCB7XG4gICAgLy8gaWYodGhpcy5fdGV4dHVyZSkge1xuICAgIC8vICAgICBsZXQgZnJtID0gdGhpcy5fdGV4dHVyZS5mcmFtZTtcbiAgICAvLyAgICAgdGhpcy5faGVpZ2h0ID0gTWF0aC5tYXgodGhpcy5faGVpZ2h0LCB0aGlzLiRtaW5IZWlnaHQpO1xuICAgIC8vICAgICBsZXQgdyA9IGZybS54ICsgdGhpcy5fd2lkdGgsIGggPSBmcm0ueSArIHRoaXMuX2hlaWdodDtcbiAgICAvLyAgICAgaWYodyA+IHRoaXMuX3RleHR1cmUuYmFzZVRleHR1cmUud2lkdGgpXG4gICAgLy8gICAgICAgICB3ID0gdGhpcy5fdGV4dHVyZS5iYXNlVGV4dHVyZS53aWR0aCAtIGZybS54O1xuICAgIC8vICAgICBpZihoID4gdGhpcy5fdGV4dHVyZS5iYXNlVGV4dHVyZS5oZWlnaHQpXG4gICAgLy8gICAgICAgICBoID0gdGhpcy5fdGV4dHVyZS5iYXNlVGV4dHVyZS5oZWlnaHQgLSBmcm0ueTtcbiAgICAvLyAgICAgZnJtLndpZHRoID0gdyAvIHRoaXMucmVzb2x1dGlvbjtcbiAgICAvLyAgICAgZnJtLmhlaWdodCA9IGggLyB0aGlzLnJlc29sdXRpb247XG4gICAgLy8gICAgIHRoaXMuX3RleHR1cmUudHJpbS53aWR0aCA9IGZybS53aWR0aDtcbiAgICAvLyAgICAgdGhpcy5fdGV4dHVyZS50cmltLmhlaWdodCA9IGZybS5oZWlnaHQ7XG4gICAgLy8gICAgIGxldCBwYWRkaW5nID0gdGhpcy5fc3R5bGUudHJpbSA/IDAgOiB0aGlzLl9zdHlsZS5wYWRkaW5nO1xuICAgIC8vICAgICB0aGlzLl90ZXh0dXJlLnRyaW0ueCA9IC1wYWRkaW5nO1xuICAgIC8vICAgICB0aGlzLl90ZXh0dXJlLnRyaW0ueSA9IC1wYWRkaW5nO1xuICAgIC8vICAgICB0aGlzLl90ZXh0dXJlLmZyYW1lID0gZnJtO1xuICAgIC8vIH1cbiAgICAvLyB9XG4gICAgLy9jYW5jZWwgc2NhbGluZyB1cGRhdGVcbiAgICAvLyBwcm90ZWN0ZWQgX29uVGV4dHVyZVVwZGF0ZSgpOiB2b2lkIHtcbiAgICAvLyB0aGlzLl90ZXh0dXJlSUQgPSAtMTtcbiAgICAvLyB0aGlzLl90ZXh0dXJlVHJpbW1lZElEID0gLTE7XG4gICAgLy8gfVxuICAgIGdldCB3aWR0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TWV0cmljcygpWyd3aWR0aCddO1xuICAgIH1cbiAgICBzZXQgd2lkdGgodikge1xuICAgICAgICB0aGlzLmxpbmVXaWR0aCA9IHY7XG4gICAgICAgIGlmICh0aGlzLm11bHRpcGxlKSB7XG4gICAgICAgICAgICB0aGlzLm11bHRpcGxlLmxpbmVXaWR0aCA9IHY7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGhlaWdodCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGluZUhlaWdodDtcbiAgICB9XG4gICAgc2V0IGhlaWdodCh2KSB7XG4gICAgICAgIHRoaXMubGluZUhlaWdodCA9IHY7XG4gICAgICAgIGlmICh0aGlzLm11bHRpcGxlKSB7XG4gICAgICAgICAgICB0aGlzLm11bHRpcGxlLmxpbmVIZWlnaHQgPSB2O1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCB0ZXh0SGVpZ2h0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRNZWFzdXJlZEhlaWdodCgpO1xuICAgIH1cbiAgICBzZXQgdGV4dEhlaWdodCh2KSB7IH1cbiAgICBnZXQgdGV4dFdpZHRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRNZWFzdXJlZFdpZHRoKCk7XG4gICAgfVxuICAgIHNldCBjb250ZW50KHYpIHtcbiAgICAgICAgdGhpcy50ZXh0ID0gdjtcbiAgICAgICAgaWYgKHRoaXMubXVsdGlwbGUpIHtcbiAgICAgICAgICAgIHRoaXMubXVsdGlwbGUudGV4dCA9IHY7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGNvbnRlbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRleHQ7XG4gICAgfVxuICAgIHVwZGF0ZU11bHRpcGxlUG9zaXRpb24oeCwgeSkge1xuICAgICAgICBpZiAodGhpcy5tdWx0aXBsZSkge1xuICAgICAgICAgICAgdGhpcy5tdWx0aXBsZS54ID0geDtcbiAgICAgICAgICAgIHRoaXMubXVsdGlwbGUueSA9IHk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmNsYXNzIFRleHRNZXRyaWNzIHtcbiAgICBjb25zdHJ1Y3Rvcih0ZXh0LCBzdHlsZSwgd2lkdGgsIGhlaWdodCwgbGluZXMsIGxpbmVXaWR0aHMsIGxpbmVIZWlnaHQsIG1heExpbmVXaWR0aCwgZm9udFByb3BlcnRpZXMpIHtcbiAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDtcbiAgICAgICAgdGhpcy5zdHlsZSA9IHN0eWxlO1xuICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7XG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICB0aGlzLmxpbmVzID0gbGluZXM7XG4gICAgICAgIHRoaXMubGluZVdpZHRocyA9IGxpbmVXaWR0aHM7XG4gICAgICAgIHRoaXMubGluZUhlaWdodCA9IGxpbmVIZWlnaHQ7XG4gICAgICAgIHRoaXMubWF4TGluZVdpZHRoID0gbWF4TGluZVdpZHRoO1xuICAgICAgICB0aGlzLmZvbnRQcm9wZXJ0aWVzID0gZm9udFByb3BlcnRpZXM7XG4gICAgfVxuICAgIHN0YXRpYyBtZWFzdXJlVGV4dCh0ZXh0LCBzdHlsZSwgd29yZFdyYXAsIGNhbnZhcyA9IFRleHRNZXRyaWNzLl9jYW52YXMpIHtcbiAgICAgICAgd29yZFdyYXAgPSB3b3JkV3JhcCA9PT0gdW5kZWZpbmVkIHx8IHdvcmRXcmFwID09PSBudWxsID8gc3R5bGUud29yZFdyYXAgOiB3b3JkV3JhcDtcbiAgICAgICAgY29uc3QgZm9udCA9IHN0eWxlLnRvRm9udFN0cmluZygpO1xuICAgICAgICBjb25zdCBmb250UHJvcGVydGllcyA9IFRleHRNZXRyaWNzLm1lYXN1cmVGb250KGZvbnQpO1xuICAgICAgICAvLyBmYWxsYmFjayBpbiBjYXNlIFVBIGRpc2FsbG93IGNhbnZhcyBkYXRhIGV4dHJhY3Rpb25cbiAgICAgICAgLy8gKHRvRGF0YVVSSSwgZ2V0SW1hZ2VEYXRhIGZ1bmN0aW9ucylcbiAgICAgICAgaWYgKGZvbnRQcm9wZXJ0aWVzLmZvbnRTaXplID09PSAwKSB7XG4gICAgICAgICAgICBmb250UHJvcGVydGllcy5mb250U2l6ZSA9IHN0eWxlLmZvbnRTaXplO1xuICAgICAgICAgICAgZm9udFByb3BlcnRpZXMuYXNjZW50ID0gc3R5bGUuZm9udFNpemU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICBjb250ZXh0LmZvbnQgPSBmb250O1xuICAgICAgICBjb25zdCBvdXRwdXRUZXh0ID0gd29yZFdyYXAgPyBUZXh0TWV0cmljcy53b3JkV3JhcCh0ZXh0LCBzdHlsZSwgY2FudmFzKSA6IHRleHQ7XG4gICAgICAgIGNvbnN0IGxpbmVzID0gb3V0cHV0VGV4dC5zcGxpdCgvKD86XFxyXFxufFxccnxcXG4pLyk7XG4gICAgICAgIGNvbnN0IGxpbmVXaWR0aHMgPSBuZXcgQXJyYXkobGluZXMubGVuZ3RoKTtcbiAgICAgICAgbGV0IG1heExpbmVXaWR0aCA9IDA7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGxpbmVXaWR0aCA9IGNvbnRleHQubWVhc3VyZVRleHQobGluZXNbaV0pLndpZHRoICsgKGxpbmVzW2ldLmxlbmd0aCAtIDEpICogc3R5bGUubGV0dGVyU3BhY2luZztcbiAgICAgICAgICAgIGxpbmVXaWR0aHNbaV0gPSBsaW5lV2lkdGg7XG4gICAgICAgICAgICBtYXhMaW5lV2lkdGggPSBNYXRoLm1heChtYXhMaW5lV2lkdGgsIGxpbmVXaWR0aCk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHdpZHRoID0gbWF4TGluZVdpZHRoICsgc3R5bGUuc3Ryb2tlVGhpY2tuZXNzO1xuICAgICAgICBpZiAoc3R5bGUuZHJvcFNoYWRvdykge1xuICAgICAgICAgICAgd2lkdGggKz0gc3R5bGUuZHJvcFNoYWRvd0Rpc3RhbmNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGxpbmVIZWlnaHQgPSBzdHlsZS5saW5lSGVpZ2h0IHx8IGZvbnRQcm9wZXJ0aWVzLmZvbnRTaXplICsgc3R5bGUuc3Ryb2tlVGhpY2tuZXNzO1xuICAgICAgICBsZXQgaGVpZ2h0ID0gTWF0aC5tYXgobGluZUhlaWdodCwgZm9udFByb3BlcnRpZXMuZm9udFNpemUgKyBzdHlsZS5zdHJva2VUaGlja25lc3MpICtcbiAgICAgICAgICAgIChsaW5lcy5sZW5ndGggLSAxKSAqIChsaW5lSGVpZ2h0ICsgc3R5bGUubGVhZGluZyk7XG4gICAgICAgIGlmIChzdHlsZS5kcm9wU2hhZG93KSB7XG4gICAgICAgICAgICBoZWlnaHQgKz0gc3R5bGUuZHJvcFNoYWRvd0Rpc3RhbmNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgVGV4dE1ldHJpY3ModGV4dCwgc3R5bGUsIHdpZHRoLCBoZWlnaHQsIGxpbmVzLCBsaW5lV2lkdGhzLCBsaW5lSGVpZ2h0ICsgc3R5bGUubGVhZGluZywgbWF4TGluZVdpZHRoLCBmb250UHJvcGVydGllcyk7XG4gICAgfVxuICAgIHN0YXRpYyB3b3JkV3JhcCh0ZXh0LCBzdHlsZSwgY2FudmFzID0gVGV4dE1ldHJpY3MuX2NhbnZhcykge1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgIGxldCB3aWR0aCA9IDA7XG4gICAgICAgIGxldCBsaW5lID0gJyc7XG4gICAgICAgIGxldCBsaW5lcyA9ICcnO1xuICAgICAgICBjb25zdCBjYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgIGNvbnN0IHsgbGV0dGVyU3BhY2luZywgd2hpdGVTcGFjZSB9ID0gc3R5bGU7XG4gICAgICAgIC8vIEhvdyB0byBoYW5kbGUgd2hpdGVzcGFjZXNcbiAgICAgICAgY29uc3QgY29sbGFwc2VTcGFjZXMgPSBUZXh0TWV0cmljcy5jb2xsYXBzZVNwYWNlcyh3aGl0ZVNwYWNlKTtcbiAgICAgICAgY29uc3QgY29sbGFwc2VOZXdsaW5lcyA9IFRleHRNZXRyaWNzLmNvbGxhcHNlTmV3bGluZXMod2hpdGVTcGFjZSk7XG4gICAgICAgIC8vIHdoZXRoZXIgb3Igbm90IHNwYWNlcyBtYXkgYmUgYWRkZWQgdG8gdGhlIGJlZ2lubmluZyBvZiBsaW5lc1xuICAgICAgICBsZXQgY2FuUHJlcGVuZFNwYWNlcyA9ICFjb2xsYXBzZVNwYWNlcztcbiAgICAgICAgY29uc3Qgd29yZFdyYXBXaWR0aCA9IHN0eWxlLndvcmRXcmFwV2lkdGggKyBsZXR0ZXJTcGFjaW5nO1xuICAgICAgICAvLyBicmVhayB0ZXh0IGludG8gd29yZHMsIHNwYWNlcyBhbmQgbmV3bGluZSBjaGFyc1xuICAgICAgICBjb25zdCB0b2tlbnMgPSBUZXh0TWV0cmljcy50b2tlbml6ZSh0ZXh0KTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIC8vIGdldCB0aGUgd29yZCwgc3BhY2Ugb3IgbmV3bGluZUNoYXJcbiAgICAgICAgICAgIGxldCB0b2tlbiA9IHRva2Vuc1tpXTtcbiAgICAgICAgICAgIC8vIGlmIHdvcmQgaXMgYSBuZXcgbGluZVxuICAgICAgICAgICAgaWYgKFRleHRNZXRyaWNzLmlzTmV3bGluZSh0b2tlbikpIHtcbiAgICAgICAgICAgICAgICAvLyBrZWVwIHRoZSBuZXcgbGluZVxuICAgICAgICAgICAgICAgIGlmICghY29sbGFwc2VOZXdsaW5lcykge1xuICAgICAgICAgICAgICAgICAgICBsaW5lcyArPSBUZXh0TWV0cmljcy5hZGRMaW5lKGxpbmUpO1xuICAgICAgICAgICAgICAgICAgICBjYW5QcmVwZW5kU3BhY2VzID0gIWNvbGxhcHNlU3BhY2VzO1xuICAgICAgICAgICAgICAgICAgICBsaW5lID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoID0gMDtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGlmIHdlIHNob3VsZCBjb2xsYXBzZSBuZXcgbGluZXNcbiAgICAgICAgICAgICAgICAvLyB3ZSBzaW1wbHkgY29udmVydCBpdCBpbnRvIGEgc3BhY2VcbiAgICAgICAgICAgICAgICB0b2tlbiA9ICcgJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGlmIHdlIHNob3VsZCBjb2xsYXBzZSByZXBlYXRlZCB3aGl0ZXNwYWNlc1xuICAgICAgICAgICAgaWYgKGNvbGxhcHNlU3BhY2VzKSB7XG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgYm90aCB0aGlzIGFuZCB0aGUgbGFzdCB0b2tlbnMgZm9yIHNwYWNlc1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJJc0JyZWFraW5nU3BhY2UgPSBUZXh0TWV0cmljcy5pc0JyZWFraW5nU3BhY2UodG9rZW4pO1xuICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RJc0JyZWFraW5nU3BhY2UgPSBUZXh0TWV0cmljcy5pc0JyZWFraW5nU3BhY2UobGluZVtsaW5lLmxlbmd0aCAtIDFdKTtcbiAgICAgICAgICAgICAgICBpZiAoY3VycklzQnJlYWtpbmdTcGFjZSAmJiBsYXN0SXNCcmVha2luZ1NwYWNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGdldCB3b3JkIHdpZHRoIGZyb20gY2FjaGUgaWYgcG9zc2libGVcbiAgICAgICAgICAgIGNvbnN0IHRva2VuV2lkdGggPSBUZXh0TWV0cmljcy5nZXRGcm9tQ2FjaGUodG9rZW4sIGxldHRlclNwYWNpbmcsIGNhY2hlLCBjb250ZXh0KTtcbiAgICAgICAgICAgIC8vIHdvcmQgaXMgbG9uZ2VyIHRoYW4gZGVzaXJlZCBib3VuZHNcbiAgICAgICAgICAgIGlmICh0b2tlbldpZHRoID4gd29yZFdyYXBXaWR0aCkge1xuICAgICAgICAgICAgICAgIC8vIGlmIHdlIGFyZSBub3QgYWxyZWFkeSBhdCB0aGUgYmVnaW5uaW5nIG9mIGEgbGluZVxuICAgICAgICAgICAgICAgIGlmIChsaW5lICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBzdGFydCBuZXdsaW5lcyBmb3Igb3ZlcmZsb3cgd29yZHNcbiAgICAgICAgICAgICAgICAgICAgbGluZXMgKz0gVGV4dE1ldHJpY3MuYWRkTGluZShsaW5lKTtcbiAgICAgICAgICAgICAgICAgICAgbGluZSA9ICcnO1xuICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGJyZWFrIGxhcmdlIHdvcmQgb3ZlciBtdWx0aXBsZSBsaW5lc1xuICAgICAgICAgICAgICAgIGlmIChUZXh0TWV0cmljcy5jYW5CcmVha1dvcmRzKHRva2VuLCBzdHlsZS5icmVha1dvcmRzKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBicmVhayB3b3JkIGludG8gY2hhcmFjdGVyc1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyYWN0ZXJzID0gVGV4dE1ldHJpY3Mud29yZFdyYXBTcGxpdCh0b2tlbik7XG4gICAgICAgICAgICAgICAgICAgIC8vIGxvb3AgdGhlIGNoYXJhY3RlcnNcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjaGFyYWN0ZXJzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2hhciA9IGNoYXJhY3RlcnNbal07XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgayA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBhcmUgbm90IGF0IHRoZSBlbmQgb2YgdGhlIHRva2VuXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoY2hhcmFjdGVyc1tqICsga10pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0Q2hhciA9IGNoYXJhY3RlcnNbaiArIGtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RDaGFyID0gY2hhcltjaGFyLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNob3VsZCBub3Qgc3BsaXQgY2hhcnNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIVRleHRNZXRyaWNzLmNhbkJyZWFrQ2hhcnMobGFzdENoYXIsIG5leHRDaGFyLCB0b2tlbiwgaiwgc3R5bGUuYnJlYWtXb3JkcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29tYmluZSBjaGFycyAmIG1vdmUgZm9yd2FyZCBvbmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhciArPSBuZXh0Q2hhcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrKys7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBqICs9IGNoYXIubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXJhY3RlcldpZHRoID0gVGV4dE1ldHJpY3MuZ2V0RnJvbUNhY2hlKGNoYXIsIGxldHRlclNwYWNpbmcsIGNhY2hlLCBjb250ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGFyYWN0ZXJXaWR0aCArIHdpZHRoID4gd29yZFdyYXBXaWR0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVzICs9IFRleHRNZXRyaWNzLmFkZExpbmUobGluZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuUHJlcGVuZFNwYWNlcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lICs9IGNoYXI7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCArPSBjaGFyYWN0ZXJXaWR0aDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBydW4gd29yZCBvdXQgb2YgdGhlIGJvdW5kc1xuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBhcmUgd29yZHMgaW4gdGhpcyBsaW5lIGFscmVhZHlcbiAgICAgICAgICAgICAgICAgICAgLy8gZmluaXNoIHRoYXQgbGluZSBhbmQgc3RhcnQgYSBuZXcgb25lXG4gICAgICAgICAgICAgICAgICAgIGlmIChsaW5lLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVzICs9IFRleHRNZXRyaWNzLmFkZExpbmUobGluZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lID0gJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNMYXN0VG9rZW4gPSBpID09PSB0b2tlbnMubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICAgICAgICAgLy8gZ2l2ZSBpdCBpdHMgb3duIGxpbmUgaWYgaXQncyBub3QgdGhlIGVuZFxuICAgICAgICAgICAgICAgICAgICBsaW5lcyArPSBUZXh0TWV0cmljcy5hZGRMaW5lKHRva2VuLCAhaXNMYXN0VG9rZW4pO1xuICAgICAgICAgICAgICAgICAgICBjYW5QcmVwZW5kU3BhY2VzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGxpbmUgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgd2lkdGggPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHdvcmQgY291bGQgZml0XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyB3b3JkIHdvbid0IGZpdCBiZWNhdXNlIG9mIGV4aXN0aW5nIHdvcmRzXG4gICAgICAgICAgICAgICAgLy8gc3RhcnQgYSBuZXcgbGluZVxuICAgICAgICAgICAgICAgIGlmICh0b2tlbldpZHRoICsgd2lkdGggPiB3b3JkV3JhcFdpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIGl0cyBhIHNwYWNlIHdlIGRvbid0IHdhbnQgaXRcbiAgICAgICAgICAgICAgICAgICAgY2FuUHJlcGVuZFNwYWNlcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAvLyBhZGQgYSBuZXcgbGluZVxuICAgICAgICAgICAgICAgICAgICBsaW5lcyArPSBUZXh0TWV0cmljcy5hZGRMaW5lKGxpbmUpO1xuICAgICAgICAgICAgICAgICAgICAvLyBzdGFydCBhIG5ldyBsaW5lXG4gICAgICAgICAgICAgICAgICAgIGxpbmUgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgd2lkdGggPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBkb24ndCBhZGQgc3BhY2VzIHRvIHRoZSBiZWdpbm5pbmcgb2YgbGluZXNcbiAgICAgICAgICAgICAgICBpZiAobGluZS5sZW5ndGggPiAwIHx8ICFUZXh0TWV0cmljcy5pc0JyZWFraW5nU3BhY2UodG9rZW4pIHx8IGNhblByZXBlbmRTcGFjZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHRoZSB3b3JkIHRvIHRoZSBjdXJyZW50IGxpbmVcbiAgICAgICAgICAgICAgICAgICAgbGluZSArPSB0b2tlbjtcbiAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIHdpZHRoIGNvdW50ZXJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGggKz0gdG9rZW5XaWR0aDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGluZXMgKz0gVGV4dE1ldHJpY3MuYWRkTGluZShsaW5lLCBmYWxzZSk7XG4gICAgICAgIHJldHVybiBsaW5lcztcbiAgICB9XG4gICAgc3RhdGljIGFkZExpbmUobGluZSwgbmV3TGluZSA9IHRydWUpIHtcbiAgICAgICAgbGluZSA9IFRleHRNZXRyaWNzLnRyaW1SaWdodChsaW5lKTtcbiAgICAgICAgbGluZSA9IG5ld0xpbmUgPyBgJHtsaW5lfVxcbmAgOiBsaW5lO1xuICAgICAgICByZXR1cm4gbGluZTtcbiAgICB9XG4gICAgc3RhdGljIGdldEZyb21DYWNoZShrZXksIGxldHRlclNwYWNpbmcsIGNhY2hlLCBjb250ZXh0KSB7XG4gICAgICAgIGxldCB3aWR0aCA9IGNhY2hlW2tleV07XG4gICAgICAgIGlmICh0eXBlb2Ygd2lkdGggIT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBjb25zdCBzcGFjaW5nID0ga2V5Lmxlbmd0aCAqIGxldHRlclNwYWNpbmc7XG4gICAgICAgICAgICB3aWR0aCA9IGNvbnRleHQubWVhc3VyZVRleHQoa2V5KS53aWR0aCArIHNwYWNpbmc7XG4gICAgICAgICAgICBjYWNoZVtrZXldID0gd2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHdpZHRoO1xuICAgIH1cbiAgICBzdGF0aWMgY29sbGFwc2VTcGFjZXMod2hpdGVTcGFjZSkge1xuICAgICAgICByZXR1cm4gd2hpdGVTcGFjZSA9PT0gJ25vcm1hbCcgfHwgd2hpdGVTcGFjZSA9PT0gJ3ByZS1saW5lJztcbiAgICB9XG4gICAgc3RhdGljIGNvbGxhcHNlTmV3bGluZXMod2hpdGVTcGFjZSkge1xuICAgICAgICByZXR1cm4gd2hpdGVTcGFjZSA9PT0gJ25vcm1hbCc7XG4gICAgfVxuICAgIHN0YXRpYyB0cmltUmlnaHQodGV4dCkge1xuICAgICAgICBpZiAodHlwZW9mIHRleHQgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IHRleHQubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGNvbnN0IGNoYXIgPSB0ZXh0W2ldO1xuICAgICAgICAgICAgaWYgKCFUZXh0TWV0cmljcy5pc0JyZWFraW5nU3BhY2UoY2hhcikpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRleHQgPSB0ZXh0LnNsaWNlKDAsIC0xKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGV4dDtcbiAgICB9XG4gICAgc3RhdGljIGlzTmV3bGluZShjaGFyKSB7XG4gICAgICAgIGlmICh0eXBlb2YgY2hhciAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gVGV4dE1ldHJpY3MuX25ld2xpbmVzLmluZGV4T2YoY2hhci5jaGFyQ29kZUF0KDApKSA+PSAwO1xuICAgIH1cbiAgICBzdGF0aWMgaXNCcmVha2luZ1NwYWNlKGNoYXIsIF9uZXh0Q2hhcikge1xuICAgICAgICBpZiAodHlwZW9mIGNoYXIgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFRleHRNZXRyaWNzLl9icmVha2luZ1NwYWNlcy5pbmRleE9mKGNoYXIuY2hhckNvZGVBdCgwKSkgPj0gMDtcbiAgICB9XG4gICAgc3RhdGljIHRva2VuaXplKHRleHQpIHtcbiAgICAgICAgY29uc3QgdG9rZW5zID0gW107XG4gICAgICAgIGxldCB0b2tlbiA9ICcnO1xuICAgICAgICBpZiAodHlwZW9mIHRleHQgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gdG9rZW5zO1xuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGV4dC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgY2hhciA9IHRleHRbaV07XG4gICAgICAgICAgICBjb25zdCBuZXh0Q2hhciA9IHRleHRbaSArIDFdO1xuICAgICAgICAgICAgaWYgKFRleHRNZXRyaWNzLmlzQnJlYWtpbmdTcGFjZShjaGFyLCBuZXh0Q2hhcikgfHwgVGV4dE1ldHJpY3MuaXNOZXdsaW5lKGNoYXIpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRva2VuICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICB0b2tlbnMucHVzaCh0b2tlbik7XG4gICAgICAgICAgICAgICAgICAgIHRva2VuID0gJyc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRva2Vucy5wdXNoKGNoYXIpO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdG9rZW4gKz0gY2hhcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodG9rZW4gIT09ICcnKSB7XG4gICAgICAgICAgICB0b2tlbnMucHVzaCh0b2tlbik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRva2VucztcbiAgICB9XG4gICAgc3RhdGljIGNhbkJyZWFrV29yZHMoX3Rva2VuLCBicmVha1dvcmRzKSB7XG4gICAgICAgIHJldHVybiBicmVha1dvcmRzO1xuICAgIH1cbiAgICBzdGF0aWMgY2FuQnJlYWtDaGFycyhfY2hhciwgX25leHRDaGFyLCBfdG9rZW4sIF9pbmRleCwgX2JyZWFrV29yZHMpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHN0YXRpYyB3b3JkV3JhcFNwbGl0KHRva2VuKSB7XG4gICAgICAgIHJldHVybiB0b2tlbi5zcGxpdCgnJyk7XG4gICAgfVxuICAgIHN0YXRpYyBtZWFzdXJlRm9udChmb250KSB7XG4gICAgICAgIC8vIGFzIHRoaXMgbWV0aG9kIGlzIHVzZWQgZm9yIHByZXBhcmluZyBhc3NldHMsIGRvbid0IHJlY2FsY3VsYXRlIHRoaW5ncyBpZiB3ZSBkb24ndCBuZWVkIHRvXG4gICAgICAgIGlmIChUZXh0TWV0cmljcy5fZm9udHNbZm9udF0pIHtcbiAgICAgICAgICAgIHJldHVybiBUZXh0TWV0cmljcy5fZm9udHNbZm9udF07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcHJvcGVydGllcyA9IHtcbiAgICAgICAgICAgIGFzY2VudDogMCxcbiAgICAgICAgICAgIGRlc2NlbnQ6IDAsXG4gICAgICAgICAgICBmb250U2l6ZTogMFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjYW52YXMgPSBUZXh0TWV0cmljcy5fY2FudmFzO1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gVGV4dE1ldHJpY3MuX2NvbnRleHQ7XG4gICAgICAgIGNvbnRleHQuZm9udCA9IGZvbnQ7XG4gICAgICAgIGNvbnN0IG1ldHJpY3NTdHJpbmcgPSBUZXh0TWV0cmljcy5NRVRSSUNTX1NUUklORyArIFRleHRNZXRyaWNzLkJBU0VMSU5FX1NZTUJPTDtcbiAgICAgICAgY29uc3Qgd2lkdGggPSBNYXRoLmNlaWwoY29udGV4dC5tZWFzdXJlVGV4dChtZXRyaWNzU3RyaW5nKS53aWR0aCk7XG4gICAgICAgIGxldCBiYXNlbGluZSA9IE1hdGguY2VpbChjb250ZXh0Lm1lYXN1cmVUZXh0KFRleHRNZXRyaWNzLkJBU0VMSU5FX1NZTUJPTCkud2lkdGgpO1xuICAgICAgICBjb25zdCBoZWlnaHQgPSAyICogYmFzZWxpbmU7XG4gICAgICAgIGJhc2VsaW5lID0gKGJhc2VsaW5lICogVGV4dE1ldHJpY3MuQkFTRUxJTkVfTVVMVElQTElFUikgfCAwO1xuICAgICAgICBjYW52YXMud2lkdGggPSB3aWR0aDtcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgY29udGV4dC5maWxsU3R5bGUgPSAnI2YwMCc7XG4gICAgICAgIGNvbnRleHQuZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7XG4gICAgICAgIGNvbnRleHQuZm9udCA9IGZvbnQ7XG4gICAgICAgIGNvbnRleHQudGV4dEJhc2VsaW5lID0gJ2FscGhhYmV0aWMnO1xuICAgICAgICBjb250ZXh0LmZpbGxTdHlsZSA9ICcjMDAwJztcbiAgICAgICAgY29udGV4dC5maWxsVGV4dChtZXRyaWNzU3RyaW5nLCAwLCBiYXNlbGluZSk7XG4gICAgICAgIGNvbnN0IGltYWdlZGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIHdpZHRoLCBoZWlnaHQpLmRhdGE7XG4gICAgICAgIGNvbnN0IHBpeGVscyA9IGltYWdlZGF0YS5sZW5ndGg7XG4gICAgICAgIGNvbnN0IGxpbmUgPSB3aWR0aCAqIDQ7XG4gICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgbGV0IGlkeCA9IDA7XG4gICAgICAgIGxldCBzdG9wID0gZmFsc2U7XG4gICAgICAgIC8vIGFzY2VudC4gc2NhbiBmcm9tIHRvcCB0byBib3R0b20gdW50aWwgd2UgZmluZCBhIG5vbiByZWQgcGl4ZWxcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGJhc2VsaW5lOyArK2kpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbGluZTsgaiArPSA0KSB7XG4gICAgICAgICAgICAgICAgaWYgKGltYWdlZGF0YVtpZHggKyBqXSAhPT0gMjU1KSB7XG4gICAgICAgICAgICAgICAgICAgIHN0b3AgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXN0b3ApIHtcbiAgICAgICAgICAgICAgICBpZHggKz0gbGluZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHByb3BlcnRpZXMuYXNjZW50ID0gYmFzZWxpbmUgLSBpO1xuICAgICAgICBpZHggPSBwaXhlbHMgLSBsaW5lO1xuICAgICAgICBzdG9wID0gZmFsc2U7XG4gICAgICAgIC8vIGRlc2NlbnQuIHNjYW4gZnJvbSBib3R0b20gdG8gdG9wIHVudGlsIHdlIGZpbmQgYSBub24gcmVkIHBpeGVsXG4gICAgICAgIGZvciAoaSA9IGhlaWdodDsgaSA+IGJhc2VsaW5lOyAtLWkpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbGluZTsgaiArPSA0KSB7XG4gICAgICAgICAgICAgICAgaWYgKGltYWdlZGF0YVtpZHggKyBqXSAhPT0gMjU1KSB7XG4gICAgICAgICAgICAgICAgICAgIHN0b3AgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXN0b3ApIHtcbiAgICAgICAgICAgICAgICBpZHggLT0gbGluZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHByb3BlcnRpZXMuZGVzY2VudCA9IGkgLSBiYXNlbGluZTtcbiAgICAgICAgcHJvcGVydGllcy5mb250U2l6ZSA9IHByb3BlcnRpZXMuYXNjZW50ICsgcHJvcGVydGllcy5kZXNjZW50O1xuICAgICAgICBUZXh0TWV0cmljcy5fZm9udHNbZm9udF0gPSBwcm9wZXJ0aWVzO1xuICAgICAgICByZXR1cm4gcHJvcGVydGllcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2xlYXIgZm9udCBtZXRyaWNzIGluIG1ldHJpY3MgY2FjaGUuXG4gICAgICpcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtmb250XSAtIGZvbnQgbmFtZS4gSWYgZm9udCBuYW1lIG5vdCBzZXQgdGhlbiBjbGVhciBjYWNoZSBmb3IgYWxsIGZvbnRzLlxuICAgICAqL1xuICAgIHN0YXRpYyBjbGVhck1ldHJpY3MoZm9udCA9ICcnKSB7XG4gICAgICAgIGlmIChmb250KSB7XG4gICAgICAgICAgICBkZWxldGUgVGV4dE1ldHJpY3MuX2ZvbnRzW2ZvbnRdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgVGV4dE1ldHJpY3MuX2ZvbnRzID0ge307XG4gICAgICAgIH1cbiAgICB9XG59XG5jb25zdCBjYW52YXMgPSAoKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICAgIC8vIE9mZnNjcmVlbkNhbnZhczJEIG1lYXN1cmVUZXh0IGNhbiBiZSB1cCB0byA0MCUgZmFzdGVyLlxuICAgICAgICBjb25zdCBjID0gbmV3IE9mZnNjcmVlbkNhbnZhcygwLCAwKTtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IGMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgaWYgKGNvbnRleHQgJiYgY29udGV4dC5tZWFzdXJlVGV4dCkge1xuICAgICAgICAgICAgcmV0dXJuIGM7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgIH1cbiAgICBjYXRjaCAoZXgpIHtcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgIH1cbn0pKCk7XG5jYW52YXMud2lkdGggPSBjYW52YXMuaGVpZ2h0ID0gMTA7XG5UZXh0TWV0cmljcy5fY2FudmFzID0gY2FudmFzO1xuVGV4dE1ldHJpY3MuX2NvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblRleHRNZXRyaWNzLl9mb250cyA9IHt9O1xuVGV4dE1ldHJpY3MuTUVUUklDU19TVFJJTkcgPSAnfMOJccOFJztcblRleHRNZXRyaWNzLkJBU0VMSU5FX1NZTUJPTCA9ICdNJztcblRleHRNZXRyaWNzLkJBU0VMSU5FX01VTFRJUExJRVIgPSAxLjQ7XG5UZXh0TWV0cmljcy5fbmV3bGluZXMgPSBbXG4gICAgMHgwMDBhLFxuICAgIDB4MDAwZCAvLyBjYXJyaWFnZSByZXR1cm5cbl07XG5UZXh0TWV0cmljcy5fYnJlYWtpbmdTcGFjZXMgPSBbXG4gICAgMHgwMDA5LFxuICAgIDB4MDAyMCxcbiAgICAweDIwMDAsXG4gICAgMHgyMDAxLFxuICAgIDB4MjAwMixcbiAgICAweDIwMDMsXG4gICAgMHgyMDA0LFxuICAgIDB4MjAwNSxcbiAgICAweDIwMDYsXG4gICAgMHgyMDA4LFxuICAgIDB4MjAwOSxcbiAgICAweDIwMGEsXG4gICAgMHgyMDVmLFxuICAgIDB4MzAwMCAvLyBpZGVvZ3JhcGhpYyBzcGFjZVxuXTtcblxuY2xhc3MgTGluZUluZm8ge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLndpZHRoID0gMDtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSAwO1xuICAgICAgICB0aGlzLnRleHRIZWlnaHQgPSAwO1xuICAgICAgICB0aGlzLnkgPSAwO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0KCkge1xuICAgICAgICBpZiAoTGluZUluZm8ucG9vbC5sZW5ndGgpIHtcbiAgICAgICAgICAgIGxldCByZXQgPSBMaW5lSW5mby5wb29sLnBvcCgpO1xuICAgICAgICAgICAgcmV0LndpZHRoID0gMDtcbiAgICAgICAgICAgIHJldC5oZWlnaHQgPSAwO1xuICAgICAgICAgICAgcmV0LnRleHRIZWlnaHQgPSAwO1xuICAgICAgICAgICAgcmV0LnRleHQgPSBudWxsO1xuICAgICAgICAgICAgcmV0LnkgPSAwO1xuICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gbmV3IExpbmVJbmZvKCk7XG4gICAgfVxuICAgIHN0YXRpYyByZWN5Y2xlKHZhbHVlKSB7XG4gICAgICAgIExpbmVJbmZvLnBvb2wucHVzaCh2YWx1ZSk7XG4gICAgfVxuICAgIHN0YXRpYyByZWN5Y2xlTWFueSh2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWUubGVuZ3RoKSB7XG4gICAgICAgICAgICB2YWx1ZS5mb3JFYWNoKHYgPT4ge1xuICAgICAgICAgICAgICAgIExpbmVJbmZvLnBvb2wucHVzaCh2KTtcbiAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHZhbHVlLmxlbmd0aCA9IDA7XG4gICAgfVxufVxuTGluZUluZm8ucG9vbCA9IFtdO1xuY2xhc3MgR1RleHRGaWVsZCBleHRlbmRzIEdPYmplY3Qge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLiR2ZXJ0aWNhbEFsaWduID0gMCAvKiBUb3AgKi87XG4gICAgICAgIHRoaXMuJG9mZnNldCA9IG5ldyBjcmVhdGVqcy5Qb2ludCgpO1xuICAgICAgICB0aGlzLiRzaW5nbGVMaW5lID0gdHJ1ZTtcbiAgICAgICAgdGhpcy4kdGV4dCA9ICcnO1xuICAgICAgICB0aGlzLiR0ZXh0V2lkdGggPSAwO1xuICAgICAgICB0aGlzLiR0ZXh0SGVpZ2h0ID0gMDtcbiAgICAgICAgdGhpcy4kc3R5bGUgPSBuZXcgVGV4dFN0eWxlKHtcbiAgICAgICAgICAgIGZvbnRTaXplOiAxMixcbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFVJQ29uZmlnLmRlZmF1bHRGb250LFxuICAgICAgICAgICAgYWxpZ246IFwibGVmdFwiIC8qIExlZnQgKi8sXG4gICAgICAgICAgICBsZWFkaW5nOiAzLFxuICAgICAgICAgICAgZmlsbDogMFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy4kdmVydGljYWxBbGlnbiA9IDAgLyogVG9wICovO1xuICAgICAgICB0aGlzLiR0ZXh0ID0gJyc7XG4gICAgICAgIHRoaXMuJGF1dG9TaXplID0gMSAvKiBCb3RoICovO1xuICAgICAgICB0aGlzLiR3aWR0aEF1dG9TaXplID0gdHJ1ZTtcbiAgICAgICAgdGhpcy4kaGVpZ2h0QXV0b1NpemUgPSB0cnVlO1xuICAgICAgICB0aGlzLiRiaXRtYXBQb29sID0gW107XG4gICAgICAgIHRoaXMudG91Y2hhYmxlID0gZmFsc2U7IC8vYmFzZSBHVGV4dEZpZWxkIGhhcyBubyBpbnRlcmFjdGlvblxuICAgIH1cbiAgICBjcmVhdGVEaXNwbGF5T2JqZWN0KCkge1xuICAgICAgICB0aGlzLiR0ZXh0RmllbGQgPSBuZXcgVUlUZXh0RmllbGQodGhpcyk7XG4gICAgICAgIHRoaXMuc2V0RGlzcGxheU9iamVjdCh0aGlzLiR0ZXh0RmllbGQpO1xuICAgIH1cbiAgICBzd2l0Y2hCaXRtYXBNb2RlKHZhbCkge1xuICAgICAgICBpZiAodmFsICYmIHRoaXMuZGlzcGxheU9iamVjdCA9PSB0aGlzLiR0ZXh0RmllbGQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRidENvbnRhaW5lciA9PSBudWxsKVxuICAgICAgICAgICAgICAgIHRoaXMuJGJ0Q29udGFpbmVyID0gbmV3IFVJQ29udGFpbmVyKHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5zd2l0Y2hEaXNwbGF5T2JqZWN0KHRoaXMuJGJ0Q29udGFpbmVyKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICghdmFsICYmIHRoaXMuZGlzcGxheU9iamVjdCA9PSB0aGlzLiRidENvbnRhaW5lcilcbiAgICAgICAgICAgIHRoaXMuc3dpdGNoRGlzcGxheU9iamVjdCh0aGlzLiR0ZXh0RmllbGQpO1xuICAgIH1cbiAgICBkaXNwb3NlKCkge1xuICAgICAgICBHVGltZXIuaW5zdC5yZW1vdmUodGhpcy4kcmVuZGVyLCB0aGlzKTtcbiAgICAgICAgdGhpcy4kYml0bWFwRm9udCA9IG51bGw7XG4gICAgICAgIHRoaXMuJGJpdG1hcFBvb2wubGVuZ3RoID0gMDtcbiAgICAgICAgdGhpcy4kYml0bWFwUG9vbCA9IG51bGw7XG4gICAgICAgIHRoaXMuJHN0eWxlID0gbnVsbDtcbiAgICAgICAgc3VwZXIuZGlzcG9zZSgpO1xuICAgIH1cbiAgICBzZXQgdGV4dCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldFRleHQodmFsdWUpO1xuICAgIH1cbiAgICBzZXRUZXh0KHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKVxuICAgICAgICAgICAgdmFsdWUgPSAnJztcbiAgICAgICAgaWYgKHRoaXMuJHRleHQgPT0gdmFsdWUpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuJHRleHQgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy51cGRhdGVHZWFyKDYgLyogVGV4dCAqLyk7XG4gICAgICAgIGlmICh0aGlzLnBhcmVudCAmJiB0aGlzLnBhcmVudC4kaW5Qcm9ncmVzc0J1aWxkaW5nKVxuICAgICAgICAgICAgdGhpcy5yZW5kZXJOb3coKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICB9XG4gICAgZ2V0IHRleHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFRleHQoKTtcbiAgICB9XG4gICAgZ2V0VGV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHRleHQ7XG4gICAgfVxuICAgIGdldCBjb2xvcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29sb3IoKTtcbiAgICB9XG4gICAgZ2V0Q29sb3IoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRjb2xvcjtcbiAgICB9XG4gICAgc2V0Q29sb3IodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJGNvbG9yICE9IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiRjb2xvciA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVHZWFyKDQgLyogQ29sb3IgKi8pO1xuICAgICAgICAgICAgdGhpcy4kc3R5bGUuZmlsbCA9IHRoaXMuJGNvbG9yO1xuICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXQgY29sb3IodmFsdWUpIHtcbiAgICAgICAgdGhpcy5zZXRDb2xvcih2YWx1ZSk7XG4gICAgfVxuICAgIGdldCB0aXRsZUNvbG9yKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb2xvcjtcbiAgICB9XG4gICAgc2V0IHRpdGxlQ29sb3IodmFsdWUpIHtcbiAgICAgICAgdGhpcy5jb2xvciA9IHZhbHVlO1xuICAgIH1cbiAgICBnZXQgbGluZUhlaWdodCgpIHtcbiAgICAgICAgaWYgKHRoaXMuJHN0eWxlLmxpbmVIZWlnaHQgPiAwKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHN0eWxlLmxpbmVIZWlnaHQ7XG4gICAgICAgIGlmICghdGhpcy4kZm9udFByb3BlcnRpZXMpXG4gICAgICAgICAgICByZXR1cm4gK3RoaXMuJHN0eWxlLmZvbnRTaXplICsgdGhpcy4kc3R5bGUuc3Ryb2tlVGhpY2tuZXNzOyAvL3JvdWdoIHZhbHVlXG4gICAgICAgIHJldHVybiB0aGlzLiRmb250UHJvcGVydGllcy5mb250U2l6ZSArIHRoaXMuJHN0eWxlLnN0cm9rZVRoaWNrbmVzcyArIHRoaXMuJHN0eWxlLmxlYWRpbmc7XG4gICAgfVxuICAgIHNldCBsaW5lSGVpZ2h0KGxoKSB7XG4gICAgICAgIHRoaXMuJHN0eWxlLmxpbmVIZWlnaHQgPSBsaDtcbiAgICB9XG4gICAgZ2V0IGZvbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRmb250IHx8IFVJQ29uZmlnLmRlZmF1bHRGb250O1xuICAgIH1cbiAgICBzZXQgZm9udCh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kZm9udCAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kZm9udCA9IHZhbHVlO1xuICAgICAgICAgICAgaWYgKHRoaXMuJGZvbnQgJiYgU3RyaW5nVXRpbC5zdGFydHNXaXRoKHRoaXMuJGZvbnQsICd1aTovLycpKVxuICAgICAgICAgICAgICAgIHRoaXMuJGJpdG1hcEZvbnQgPSBVSVBhY2thZ2UuZ2V0Qml0bWFwRm9udEJ5VVJMKHRoaXMuJGZvbnQpO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHRoaXMuJHN0eWxlLmZvbnRGYW1pbHkgPSB0aGlzLiRmb250IHx8IFVJQ29uZmlnLmRlZmF1bHRGb250O1xuICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgZm9udFNpemUoKSB7XG4gICAgICAgIHJldHVybiArdGhpcy4kc3R5bGUuZm9udFNpemU7XG4gICAgfVxuICAgIHNldCBmb250U2l6ZSh2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgPD0gMClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKHRoaXMuJHN0eWxlLmZvbnRTaXplICE9IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiRzdHlsZS5mb250U2l6ZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgYWxpZ24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRzdHlsZS5hbGlnbjtcbiAgICB9XG4gICAgc2V0IGFsaWduKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiRzdHlsZS5hbGlnbiAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kc3R5bGUuYWxpZ24gPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHZlcnRpY2FsQWxpZ24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR2ZXJ0aWNhbEFsaWduO1xuICAgIH1cbiAgICBzZXQgdmVydGljYWxBbGlnbih2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kdmVydGljYWxBbGlnbiAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kdmVydGljYWxBbGlnbiA9IHZhbHVlO1xuICAgICAgICAgICAgaWYgKCF0aGlzLiRpblByb2dyZXNzQnVpbGRpbmcpXG4gICAgICAgICAgICAgICAgdGhpcy5sYXlvdXRBbGlnbigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBsZWFkaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kc3R5bGUubGVhZGluZztcbiAgICB9XG4gICAgc2V0IGxlYWRpbmcodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJHN0eWxlLmxlYWRpbmcgIT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuJHN0eWxlLmxlYWRpbmcgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGxldHRlclNwYWNpbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRzdHlsZS5sZXR0ZXJTcGFjaW5nO1xuICAgIH1cbiAgICBzZXQgbGV0dGVyU3BhY2luZyh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kc3R5bGUubGV0dGVyU3BhY2luZyAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kc3R5bGUubGV0dGVyU3BhY2luZyA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgdW5kZXJsaW5lKCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7IC8vVE9ETzogbm90IHN1cHBvcnRlZCB5ZXRcbiAgICB9XG4gICAgc2V0IHVuZGVybGluZSh2YWx1ZSkge1xuICAgICAgICAvL1RPRE86IG5vdCBzdXBwb3J0ZWQgeWV0XG4gICAgfVxuICAgIGdldCBib2xkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kc3R5bGUuZm9udFdlaWdodCA9PSAnYm9sZCc7XG4gICAgfVxuICAgIHNldCBib2xkKHZhbHVlKSB7XG4gICAgICAgIGxldCB2ID0gdmFsdWUgPT09IHRydWUgPyAnYm9sZCcgOiAnbm9ybWFsJztcbiAgICAgICAgaWYgKHRoaXMuJHN0eWxlLmZvbnRXZWlnaHQgIT0gdikge1xuICAgICAgICAgICAgdGhpcy4kc3R5bGUuZm9udFdlaWdodCA9IHY7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCB3ZWlnaHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRzdHlsZS5mb250V2VpZ2h0O1xuICAgIH1cbiAgICBzZXQgd2VpZ2h0KHYpIHtcbiAgICAgICAgaWYgKHRoaXMuJHN0eWxlLmZvbnRXZWlnaHQgIT0gdikge1xuICAgICAgICAgICAgdGhpcy4kc3R5bGUuZm9udFdlaWdodCA9IHY7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCB2YXJpYW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kc3R5bGUuZm9udFZhcmlhbnQ7XG4gICAgfVxuICAgIHNldCB2YXJpYW50KHYpIHtcbiAgICAgICAgaWYgKHRoaXMuJHN0eWxlLmZvbnRWYXJpYW50ICE9IHYpIHtcbiAgICAgICAgICAgIHRoaXMuJHN0eWxlLmZvbnRWYXJpYW50ID0gdjtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGl0YWxpYygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHN0eWxlLmZvbnRTdHlsZSA9PSAnaXRhbGljJztcbiAgICB9XG4gICAgc2V0IGl0YWxpYyh2YWx1ZSkge1xuICAgICAgICBsZXQgdiA9IHZhbHVlID09PSB0cnVlID8gJ2l0YWxpYycgOiAnbm9ybWFsJztcbiAgICAgICAgaWYgKHRoaXMuJHN0eWxlLmZvbnRTdHlsZSAhPSB2KSB7XG4gICAgICAgICAgICB0aGlzLiRzdHlsZS5mb250U3R5bGUgPSB2O1xuICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgbXVsdGlwbGVMaW5lKCkge1xuICAgICAgICByZXR1cm4gIXRoaXMuJHNpbmdsZUxpbmU7XG4gICAgfVxuICAgIHNldCBtdWx0aXBsZUxpbmUodmFsdWUpIHtcbiAgICAgICAgdmFsdWUgPSAhdmFsdWU7XG4gICAgICAgIGlmICh0aGlzLiRzaW5nbGVMaW5lICE9IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiRzaW5nbGVMaW5lID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBzdHJva2UoKSB7XG4gICAgICAgIHJldHVybiArdGhpcy4kc3R5bGUuc3Ryb2tlVGhpY2tuZXNzO1xuICAgIH1cbiAgICBzZXQgc3Ryb2tlKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiRzdHlsZS5zdHJva2VUaGlja25lc3MgIT0gdmFsdWUpXG4gICAgICAgICAgICB0aGlzLiRzdHlsZS5zdHJva2VUaGlja25lc3MgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IHN0cm9rZUNvbG9yKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kc3R5bGUuc3Ryb2tlO1xuICAgIH1cbiAgICBzZXQgc3Ryb2tlQ29sb3IodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJHN0eWxlLnN0cm9rZSAhPSB2YWx1ZSlcbiAgICAgICAgICAgIHRoaXMuJHN0eWxlLnN0cm9rZSA9IHZhbHVlO1xuICAgIH1cbiAgICBzZXQgYXV0b1NpemUodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJGF1dG9TaXplICE9IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiRhdXRvU2l6ZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy4kd2lkdGhBdXRvU2l6ZSA9IHZhbHVlID09IDEgLyogQm90aCAqLyB8fCB2YWx1ZSA9PSAzIC8qIFNocmluayAqLztcbiAgICAgICAgICAgIHRoaXMuJGhlaWdodEF1dG9TaXplID0gdmFsdWUgPT0gMSAvKiBCb3RoICovIHx8IHZhbHVlID09IDIgLyogSGVpZ2h0ICovO1xuICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgYXV0b1NpemUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRhdXRvU2l6ZTtcbiAgICB9XG4gICAgZ2V0IHRleHRXaWR0aCgpIHtcbiAgICAgICAgaWYgKHRoaXMuJHJlcXVpcmVSZW5kZXIpXG4gICAgICAgICAgICB0aGlzLnJlbmRlck5vdygpO1xuICAgICAgICByZXR1cm4gdGhpcy4kdGV4dFdpZHRoO1xuICAgIH1cbiAgICBnZXQgdGV4dEhlaWdodCgpIHtcbiAgICAgICAgaWYgKHRoaXMuJHJlcXVpcmVSZW5kZXIpXG4gICAgICAgICAgICB0aGlzLnJlbmRlck5vdygpO1xuICAgICAgICByZXR1cm4gdGhpcy4kdGV4dEhlaWdodDtcbiAgICB9XG4gICAgZW5zdXJlU2l6ZUNvcnJlY3QoKSB7XG4gICAgICAgIGlmICh0aGlzLiRzaXplRGlydHkgJiYgdGhpcy4kcmVxdWlyZVJlbmRlcilcbiAgICAgICAgICAgIHRoaXMucmVuZGVyTm93KCk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgaWYgKCF0aGlzLiRyZXF1aXJlUmVuZGVyKSB7XG4gICAgICAgICAgICB0aGlzLiRyZXF1aXJlUmVuZGVyID0gdHJ1ZTtcbiAgICAgICAgICAgIEdUaW1lci5pbnN0LmNhbGxMYXRlcih0aGlzLiRyZW5kZXIsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy4kc2l6ZURpcnR5ICYmICh0aGlzLiR3aWR0aEF1dG9TaXplIHx8IHRoaXMuJGhlaWdodEF1dG9TaXplKSkge1xuICAgICAgICAgICAgdGhpcy4kc2l6ZURpcnR5ID0gdHJ1ZTtcbiAgICAgICAgICAgIGxldCBldnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoXCJfX3NpemVEZWxheUNoYW5nZVwiIC8qIFNJWkVfREVMQVlfQ0hBTkdFICovLCB0cnVlLCBmYWxzZSk7XG4gICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZXZ0LCB0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhcHBseVN0eWxlKCkge1xuICAgICAgICB0aGlzLiR0ZXh0RmllbGQuc3R5bGUuc3Ryb2tlID0gdGhpcy4kc3R5bGUuc3Ryb2tlO1xuICAgICAgICB0aGlzLiR0ZXh0RmllbGQuc3R5bGUuc3Ryb2tlVGhpY2tuZXNzID0gdGhpcy4kc3R5bGUuc3Ryb2tlVGhpY2tuZXNzO1xuICAgICAgICB0aGlzLiR0ZXh0RmllbGQuc3R5bGUuZm9udFN0eWxlID0gdGhpcy4kc3R5bGUuZm9udFN0eWxlO1xuICAgICAgICB0aGlzLiR0ZXh0RmllbGQuc3R5bGUuZm9udFZhcmlhbnQgPSB0aGlzLiRzdHlsZS5mb250VmFyaWFudDtcbiAgICAgICAgdGhpcy4kdGV4dEZpZWxkLnN0eWxlLmZvbnRXZWlnaHQgPSB0aGlzLiRzdHlsZS5mb250V2VpZ2h0O1xuICAgICAgICB0aGlzLiR0ZXh0RmllbGQuc3R5bGUubGV0dGVyU3BhY2luZyA9IHRoaXMuJHN0eWxlLmxldHRlclNwYWNpbmc7XG4gICAgICAgIHRoaXMuJHRleHRGaWVsZC5zdHlsZS5hbGlnbiA9IHRoaXMuJHN0eWxlLmFsaWduO1xuICAgICAgICB0aGlzLiR0ZXh0RmllbGQuc3R5bGUuZm9udFNpemUgPSB0aGlzLiRzdHlsZS5mb250U2l6ZTtcbiAgICAgICAgdGhpcy4kdGV4dEZpZWxkLnN0eWxlLmZvbnRGYW1pbHkgPSB0aGlzLiRzdHlsZS5mb250RmFtaWx5O1xuICAgICAgICB0aGlzLiR0ZXh0RmllbGQuc3R5bGUuZmlsbCA9IHRoaXMuJHN0eWxlLmZpbGw7XG4gICAgICAgIHRoaXMuJHRleHRGaWVsZC5zdHlsZS5kcm9wU2hhZG93Q29sb3IgPSB0aGlzLiRzdHlsZS5kcm9wU2hhZG93Q29sb3I7XG4gICAgICAgIHRoaXMuJHRleHRGaWVsZC5zdHlsZS5kcm9wU2hhZG93T2Zmc2V0WCA9IHRoaXMuJHN0eWxlLmRyb3BTaGFkb3dPZmZzZXRYO1xuICAgICAgICB0aGlzLiR0ZXh0RmllbGQuc3R5bGUuZHJvcFNoYWRvd09mZnNldFkgPSB0aGlzLiRzdHlsZS5kcm9wU2hhZG93T2Zmc2V0WTtcbiAgICAgICAgdGhpcy4kdGV4dEZpZWxkLnN0eWxlLmxlYWRpbmcgPSB0aGlzLiRzdHlsZS5sZWFkaW5nO1xuICAgICAgICB0aGlzLiR0ZXh0RmllbGQuYXBwbHlTdHlsZSgpO1xuICAgIH1cbiAgICAkcmVuZGVyKCkge1xuICAgICAgICBpZiAodGhpcy4kcmVxdWlyZVJlbmRlcilcbiAgICAgICAgICAgIHRoaXMucmVuZGVyTm93KCk7XG4gICAgfVxuICAgIHJlbmRlck5vdyh1cGRhdGVCb3VuZHMgPSB0cnVlKSB7XG4gICAgICAgIHRoaXMuJHJlcXVpcmVSZW5kZXIgPSBmYWxzZTtcbiAgICAgICAgdGhpcy4kc2l6ZURpcnR5ID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLiRiaXRtYXBGb250ICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyV2l0aEJpdG1hcEZvbnQodXBkYXRlQm91bmRzKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN3aXRjaEJpdG1hcE1vZGUoZmFsc2UpO1xuICAgICAgICB0aGlzLmFwcGx5U3R5bGUoKTtcbiAgICAgICAgdGhpcy4kdGV4dEZpZWxkLiR1cGRhdGVNaW5IZWlnaHQoKTtcbiAgICAgICAgbGV0IHdvcmRXcmFwID0gIXRoaXMuJHdpZHRoQXV0b1NpemUgJiYgdGhpcy5tdWx0aXBsZUxpbmU7XG4gICAgICAgIHRoaXMuJHRleHRGaWVsZC53aWR0aCA9IHRoaXMuJHRleHRGaWVsZC5zdHlsZS53b3JkV3JhcFdpZHRoID1cbiAgICAgICAgICAgIHdvcmRXcmFwIHx8IHRoaXMuYXV0b1NpemUgPT0gMCAvKiBOb25lICovID8gTWF0aC5jZWlsKHRoaXMud2lkdGgpIDogMTAwMDA7XG4gICAgICAgIHRoaXMuJHRleHRGaWVsZC5zdHlsZS53b3JkV3JhcCA9IHdvcmRXcmFwO1xuICAgICAgICB0aGlzLiR0ZXh0RmllbGQuc3R5bGUuYnJlYWtXb3JkcyA9IHdvcmRXcmFwO1xuICAgICAgICB0aGlzLiR0ZXh0RmllbGQuY29udGVudCA9IHRoaXMuJHRleHQ7IC8vdHJpZ2dlciB0LmRpcnR5ID0gdHJ1ZVxuICAgICAgICB0aGlzLiRmb250UHJvcGVydGllcyA9IFRleHRNZXRyaWNzLm1lYXN1cmVGb250KHRoaXMuJHN0eWxlLnRvRm9udFN0cmluZygpKTtcbiAgICAgICAgdGhpcy4kdGV4dFdpZHRoID0gTWF0aC5jZWlsKHRoaXMuJHRleHRGaWVsZC50ZXh0V2lkdGgpO1xuICAgICAgICBpZiAodGhpcy4kdGV4dFdpZHRoID4gMClcbiAgICAgICAgICAgIHRoaXMuJHRleHRXaWR0aCArPSBHVGV4dEZpZWxkLkdVVFRFUl9YICogMjsgLy9tYXJnaW4gZ2FwXG4gICAgICAgIHRoaXMuJHRleHRIZWlnaHQgPSBNYXRoLmNlaWwodGhpcy4kdGV4dEZpZWxkLnRleHRIZWlnaHQpO1xuICAgICAgICBpZiAodGhpcy4kdGV4dEhlaWdodCA+IDApXG4gICAgICAgICAgICB0aGlzLiR0ZXh0SGVpZ2h0ICs9IEdUZXh0RmllbGQuR1VUVEVSX1kgKiAyOyAvL21hcmdpbiBnYXBcbiAgICAgICAgbGV0IHcgPSB0aGlzLndpZHRoLCBoID0gdGhpcy5oZWlnaHQ7XG4gICAgICAgIGlmICh0aGlzLmF1dG9TaXplID09IDMgLyogU2hyaW5rICovKSB7XG4gICAgICAgICAgICB0aGlzLnNocmlua1RleHRGaWVsZCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy4kdGV4dEZpZWxkLnNldCh7IHNjYWxlWDogMSwgc2NhbGVZOiAxIH0pO1xuICAgICAgICAgICAgaWYgKHRoaXMuJHdpZHRoQXV0b1NpemUpIHtcbiAgICAgICAgICAgICAgICB3ID0gdGhpcy4kdGV4dFdpZHRoO1xuICAgICAgICAgICAgICAgIHRoaXMuJHRleHRGaWVsZC53aWR0aCA9IHc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy4kaGVpZ2h0QXV0b1NpemUpIHtcbiAgICAgICAgICAgICAgICBoID0gdGhpcy4kdGV4dEhlaWdodDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kdGV4dEZpZWxkLmhlaWdodCAhPSB0aGlzLiR0ZXh0SGVpZ2h0KVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiR0ZXh0RmllbGQuaGVpZ2h0ID0gdGhpcy4kdGV4dEhlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGggPSB0aGlzLmhlaWdodDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kdGV4dEhlaWdodCA+IGgpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHRleHRIZWlnaHQgPSBoO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh1cGRhdGVCb3VuZHMpIHtcbiAgICAgICAgICAgIHRoaXMuJHVwZGF0aW5nU2l6ZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnNldFNpemUodywgaCk7XG4gICAgICAgICAgICB0aGlzLiR1cGRhdGluZ1NpemUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxheW91dEFsaWduKCk7XG4gICAgfVxuICAgIHJlbmRlcldpdGhCaXRtYXBGb250KHVwZGF0ZUJvdW5kcykge1xuICAgICAgICB0aGlzLnN3aXRjaEJpdG1hcE1vZGUodHJ1ZSk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiB0b2RvXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLiRidENvbnRhaW5lci5jaGlsZHJlbi5mb3JFYWNoKChjLCBpKSA9PiB7XG4gICAgICAgICAgICB0aGlzLiRiaXRtYXBQb29sLnB1c2godGhpcy4kYnRDb250YWluZXIuZ2V0Q2hpbGRBdChpKSk7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgICAgICB0aGlzLiRidENvbnRhaW5lci5yZW1vdmVBbGxDaGlsZHJlbigpO1xuICAgICAgICBpZiAoIXRoaXMuJGxpbmVzKVxuICAgICAgICAgICAgdGhpcy4kbGluZXMgPSBbXTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgTGluZUluZm8ucmVjeWNsZU1hbnkodGhpcy4kbGluZXMpO1xuICAgICAgICBsZXQgbGV0dGVyU3BhY2luZyA9IHRoaXMubGV0dGVyU3BhY2luZztcbiAgICAgICAgbGV0IGxpbmVTcGFjaW5nID0gdGhpcy5sZWFkaW5nIC0gMTtcbiAgICAgICAgbGV0IHJlY3RXaWR0aCA9IHRoaXMud2lkdGggLSBHVGV4dEZpZWxkLkdVVFRFUl9YICogMjtcbiAgICAgICAgbGV0IGxpbmVXaWR0aCA9IDAsIGxpbmVIZWlnaHQgPSAwLCBsaW5lVGV4dEhlaWdodCA9IDA7XG4gICAgICAgIGxldCBnbHlwaFdpZHRoID0gMCwgZ2x5cGhIZWlnaHQgPSAwO1xuICAgICAgICBsZXQgd29yZENoYXJzID0gMCwgd29yZFN0YXJ0ID0gMCwgd29yZEVuZCA9IDA7XG4gICAgICAgIGxldCBsYXN0TGluZUhlaWdodCA9IDA7XG4gICAgICAgIGxldCBsaW5lQnVmZmVyID0gJyc7XG4gICAgICAgIGxldCBsaW5lWSA9IEdUZXh0RmllbGQuR1VUVEVSX1k7XG4gICAgICAgIGxldCBsaW5lO1xuICAgICAgICBsZXQgd29yZFdyYXAgPSAhdGhpcy4kd2lkdGhBdXRvU2l6ZSAmJiB0aGlzLm11bHRpcGxlTGluZTtcbiAgICAgICAgbGV0IGZvbnRTY2FsZSA9IHRoaXMuJGJpdG1hcEZvbnQucmVzaXphYmxlID8gdGhpcy5mb250U2l6ZSAvIHRoaXMuJGJpdG1hcEZvbnQuc2l6ZSA6IDE7XG4gICAgICAgIGxldCBnbHlwaDtcbiAgICAgICAgdGhpcy4kdGV4dFdpZHRoID0gMDtcbiAgICAgICAgdGhpcy4kdGV4dEhlaWdodCA9IDA7XG4gICAgICAgIGxldCB0ZXh0TGVuZ3RoID0gdGhpcy50ZXh0Lmxlbmd0aDtcbiAgICAgICAgZm9yIChsZXQgb2Zmc2V0ID0gMDsgb2Zmc2V0IDwgdGV4dExlbmd0aDsgKytvZmZzZXQpIHtcbiAgICAgICAgICAgIGxldCBjaCA9IHRoaXMuJHRleHQuY2hhckF0KG9mZnNldCk7XG4gICAgICAgICAgICBsZXQgY2MgPSBjaC5jaGFyQ29kZUF0KG9mZnNldCk7XG4gICAgICAgICAgICBpZiAoY2ggPT0gJ1xcbicpIHtcbiAgICAgICAgICAgICAgICBsaW5lQnVmZmVyICs9IGNoO1xuICAgICAgICAgICAgICAgIGxpbmUgPSBMaW5lSW5mby5nZXQoKTtcbiAgICAgICAgICAgICAgICBsaW5lLndpZHRoID0gbGluZVdpZHRoO1xuICAgICAgICAgICAgICAgIGlmIChsaW5lVGV4dEhlaWdodCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsYXN0TGluZUhlaWdodCA9PSAwKVxuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdExpbmVIZWlnaHQgPSBNYXRoLmNlaWwodGhpcy5mb250U2l6ZSAqIGZvbnRTY2FsZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsaW5lSGVpZ2h0ID09IDApXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0ID0gbGFzdExpbmVIZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIGxpbmVUZXh0SGVpZ2h0ID0gbGluZUhlaWdodDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGluZS5oZWlnaHQgPSBsaW5lSGVpZ2h0O1xuICAgICAgICAgICAgICAgIGxhc3RMaW5lSGVpZ2h0ID0gbGluZUhlaWdodDtcbiAgICAgICAgICAgICAgICBsaW5lLnRleHRIZWlnaHQgPSBsaW5lVGV4dEhlaWdodDtcbiAgICAgICAgICAgICAgICBsaW5lLnRleHQgPSBsaW5lQnVmZmVyO1xuICAgICAgICAgICAgICAgIGxpbmUueSA9IGxpbmVZO1xuICAgICAgICAgICAgICAgIGxpbmVZICs9IGxpbmUuaGVpZ2h0ICsgbGluZVNwYWNpbmc7XG4gICAgICAgICAgICAgICAgaWYgKGxpbmUud2lkdGggPiB0aGlzLiR0ZXh0V2lkdGgpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHRleHRXaWR0aCA9IGxpbmUud2lkdGg7XG4gICAgICAgICAgICAgICAgdGhpcy4kbGluZXMucHVzaChsaW5lKTtcbiAgICAgICAgICAgICAgICBsaW5lQnVmZmVyID0gJyc7XG4gICAgICAgICAgICAgICAgbGluZVdpZHRoID0gMDtcbiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0ID0gMDtcbiAgICAgICAgICAgICAgICBsaW5lVGV4dEhlaWdodCA9IDA7XG4gICAgICAgICAgICAgICAgd29yZENoYXJzID0gMDtcbiAgICAgICAgICAgICAgICB3b3JkU3RhcnQgPSAwO1xuICAgICAgICAgICAgICAgIHdvcmRFbmQgPSAwO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNjID4gMjU2IHx8IGNjIDw9IDMyKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdvcmRDaGFycyA+IDApXG4gICAgICAgICAgICAgICAgICAgIHdvcmRFbmQgPSBsaW5lV2lkdGg7XG4gICAgICAgICAgICAgICAgd29yZENoYXJzID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh3b3JkQ2hhcnMgPT0gMClcbiAgICAgICAgICAgICAgICAgICAgd29yZFN0YXJ0ID0gbGluZVdpZHRoO1xuICAgICAgICAgICAgICAgIHdvcmRDaGFycysrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNoID09ICcgJykge1xuICAgICAgICAgICAgICAgIGdseXBoV2lkdGggPSBNYXRoLmNlaWwodGhpcy5mb250U2l6ZSAvIDIpO1xuICAgICAgICAgICAgICAgIGdseXBoSGVpZ2h0ID0gTWF0aC5jZWlsKHRoaXMuZm9udFNpemUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZ2x5cGggPSB0aGlzLiRiaXRtYXBGb250LmdseXBoc1tjaF07XG4gICAgICAgICAgICAgICAgaWYgKGdseXBoKSB7XG4gICAgICAgICAgICAgICAgICAgIGdseXBoV2lkdGggPSBNYXRoLmNlaWwoZ2x5cGguYWR2YW5jZSAqIGZvbnRTY2FsZSk7XG4gICAgICAgICAgICAgICAgICAgIGdseXBoSGVpZ2h0ID0gTWF0aC5jZWlsKGdseXBoLmxpbmVIZWlnaHQgKiBmb250U2NhbGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjaCA9PSAnICcpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2x5cGhXaWR0aCA9IE1hdGguY2VpbCgodGhpcy4kYml0bWFwRm9udC5zaXplICogZm9udFNjYWxlKSAvIDIpO1xuICAgICAgICAgICAgICAgICAgICBnbHlwaEhlaWdodCA9IE1hdGguY2VpbCh0aGlzLiRiaXRtYXBGb250LnNpemUgKiBmb250U2NhbGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZ2x5cGhXaWR0aCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGdseXBoSGVpZ2h0ID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ2x5cGhIZWlnaHQgPiBsaW5lVGV4dEhlaWdodClcbiAgICAgICAgICAgICAgICBsaW5lVGV4dEhlaWdodCA9IGdseXBoSGVpZ2h0O1xuICAgICAgICAgICAgaWYgKGdseXBoSGVpZ2h0ID4gbGluZUhlaWdodClcbiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0ID0gZ2x5cGhIZWlnaHQ7XG4gICAgICAgICAgICBpZiAobGluZVdpZHRoICE9IDApXG4gICAgICAgICAgICAgICAgbGluZVdpZHRoICs9IGxldHRlclNwYWNpbmc7XG4gICAgICAgICAgICBsaW5lV2lkdGggKz0gZ2x5cGhXaWR0aDtcbiAgICAgICAgICAgIGlmICghd29yZFdyYXAgfHwgbGluZVdpZHRoIDw9IHJlY3RXaWR0aCkge1xuICAgICAgICAgICAgICAgIGxpbmVCdWZmZXIgKz0gY2g7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsaW5lID0gTGluZUluZm8uZ2V0KCk7XG4gICAgICAgICAgICAgICAgbGluZS5oZWlnaHQgPSBsaW5lSGVpZ2h0O1xuICAgICAgICAgICAgICAgIGxpbmUudGV4dEhlaWdodCA9IGxpbmVUZXh0SGVpZ2h0O1xuICAgICAgICAgICAgICAgIGlmIChsaW5lQnVmZmVyLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vdGhlIGxpbmUgY2FubnQgZml0IGV2ZW4gYSBjaGFyXG4gICAgICAgICAgICAgICAgICAgIGxpbmUudGV4dCA9IGNoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh3b3JkQ2hhcnMgPiAwICYmIHdvcmRFbmQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vaWYgd29yZCBoYWQgYnJva2VuLCBtb3ZlIGl0IHRvIG5ldyBsaW5lXG4gICAgICAgICAgICAgICAgICAgIGxpbmVCdWZmZXIgKz0gY2g7XG4gICAgICAgICAgICAgICAgICAgIGxldCBsZW4gPSBsaW5lQnVmZmVyLmxlbmd0aCAtIHdvcmRDaGFycztcbiAgICAgICAgICAgICAgICAgICAgbGluZS50ZXh0ID0gU3RyaW5nVXRpbC50cmltUmlnaHQobGluZUJ1ZmZlci5zdWJzdHIoMCwgbGVuKSk7XG4gICAgICAgICAgICAgICAgICAgIGxpbmUud2lkdGggPSB3b3JkRW5kO1xuICAgICAgICAgICAgICAgICAgICBsaW5lQnVmZmVyID0gbGluZUJ1ZmZlci5zdWJzdHIobGVuICsgMSk7XG4gICAgICAgICAgICAgICAgICAgIGxpbmVXaWR0aCAtPSB3b3JkU3RhcnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsaW5lLnRleHQgPSBsaW5lQnVmZmVyO1xuICAgICAgICAgICAgICAgICAgICBsaW5lLndpZHRoID0gbGluZVdpZHRoIC0gKGdseXBoV2lkdGggKyBsZXR0ZXJTcGFjaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgbGluZUJ1ZmZlciA9IGNoO1xuICAgICAgICAgICAgICAgICAgICBsaW5lV2lkdGggPSBnbHlwaFdpZHRoO1xuICAgICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0ID0gZ2x5cGhIZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIGxpbmVUZXh0SGVpZ2h0ID0gZ2x5cGhIZWlnaHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxpbmUueSA9IGxpbmVZO1xuICAgICAgICAgICAgICAgIGxpbmVZICs9IGxpbmUuaGVpZ2h0ICsgbGluZVNwYWNpbmc7XG4gICAgICAgICAgICAgICAgaWYgKGxpbmUud2lkdGggPiB0aGlzLiR0ZXh0V2lkdGgpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHRleHRXaWR0aCA9IGxpbmUud2lkdGg7XG4gICAgICAgICAgICAgICAgd29yZENoYXJzID0gMDtcbiAgICAgICAgICAgICAgICB3b3JkU3RhcnQgPSAwO1xuICAgICAgICAgICAgICAgIHdvcmRFbmQgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMuJGxpbmVzLnB1c2gobGluZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxpbmVCdWZmZXIubGVuZ3RoID4gMCB8fFxuICAgICAgICAgICAgKHRoaXMuJGxpbmVzLmxlbmd0aCA+IDAgJiZcbiAgICAgICAgICAgICAgICBTdHJpbmdVdGlsLmVuZHNXaXRoKHRoaXMuJGxpbmVzW3RoaXMuJGxpbmVzLmxlbmd0aCAtIDFdLnRleHQsICdcXG4nKSkpIHtcbiAgICAgICAgICAgIGxpbmUgPSBMaW5lSW5mby5nZXQoKTtcbiAgICAgICAgICAgIGxpbmUud2lkdGggPSBsaW5lV2lkdGg7XG4gICAgICAgICAgICBpZiAobGluZUhlaWdodCA9PSAwKVxuICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQgPSBsYXN0TGluZUhlaWdodDtcbiAgICAgICAgICAgIGlmIChsaW5lVGV4dEhlaWdodCA9PSAwKVxuICAgICAgICAgICAgICAgIGxpbmVUZXh0SGVpZ2h0ID0gbGluZUhlaWdodDtcbiAgICAgICAgICAgIGxpbmUuaGVpZ2h0ID0gbGluZUhlaWdodDtcbiAgICAgICAgICAgIGxpbmUudGV4dEhlaWdodCA9IGxpbmVUZXh0SGVpZ2h0O1xuICAgICAgICAgICAgbGluZS50ZXh0ID0gbGluZUJ1ZmZlcjtcbiAgICAgICAgICAgIGxpbmUueSA9IGxpbmVZO1xuICAgICAgICAgICAgaWYgKGxpbmUud2lkdGggPiB0aGlzLiR0ZXh0V2lkdGgpXG4gICAgICAgICAgICAgICAgdGhpcy4kdGV4dFdpZHRoID0gbGluZS53aWR0aDtcbiAgICAgICAgICAgIHRoaXMuJGxpbmVzLnB1c2gobGluZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuJHRleHRXaWR0aCA+IDApXG4gICAgICAgICAgICB0aGlzLiR0ZXh0V2lkdGggKz0gR1RleHRGaWVsZC5HVVRURVJfWCAqIDI7XG4gICAgICAgIGxldCBjb3VudCA9IHRoaXMuJGxpbmVzLmxlbmd0aDtcbiAgICAgICAgaWYgKGNvdW50ID09IDApIHtcbiAgICAgICAgICAgIHRoaXMuJHRleHRIZWlnaHQgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbGluZSA9IHRoaXMuJGxpbmVzW3RoaXMuJGxpbmVzLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgdGhpcy4kdGV4dEhlaWdodCA9IGxpbmUueSArIGxpbmUuaGVpZ2h0ICsgR1RleHRGaWVsZC5HVVRURVJfWTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdywgaCA9IDA7XG4gICAgICAgIGlmICh0aGlzLiR3aWR0aEF1dG9TaXplKSB7XG4gICAgICAgICAgICBpZiAodGhpcy4kdGV4dFdpZHRoID09IDApXG4gICAgICAgICAgICAgICAgdyA9IDA7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdyA9IHRoaXMuJHRleHRXaWR0aDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICB3ID0gdGhpcy53aWR0aDtcbiAgICAgICAgaWYgKHRoaXMuJGhlaWdodEF1dG9TaXplKSB7XG4gICAgICAgICAgICBpZiAodGhpcy4kdGV4dEhlaWdodCA9PSAwKVxuICAgICAgICAgICAgICAgIGggPSAwO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGggPSB0aGlzLiR0ZXh0SGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGggPSB0aGlzLmhlaWdodDtcbiAgICAgICAgaWYgKHVwZGF0ZUJvdW5kcykge1xuICAgICAgICAgICAgdGhpcy4kdXBkYXRpbmdTaXplID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuc2V0U2l6ZSh3LCBoKTtcbiAgICAgICAgICAgIHRoaXMuJHVwZGF0aW5nU2l6ZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh3ID09IDAgfHwgaCA9PSAwKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICByZWN0V2lkdGggPSB0aGlzLndpZHRoIC0gR1RleHRGaWVsZC5HVVRURVJfWCAqIDI7XG4gICAgICAgIHRoaXMuJGxpbmVzLmZvckVhY2gobGluZSA9PiB7XG4gICAgICAgICAgICBsZXQgY2hhclggPSBHVGV4dEZpZWxkLkdVVFRFUl9YO1xuICAgICAgICAgICAgbGV0IGxpbmVJbmRlbnQgPSAwO1xuICAgICAgICAgICAgbGV0IGNoYXJJbmRlbnQgPSAwO1xuICAgICAgICAgICAgaWYgKHRoaXMuYWxpZ24gPT0gXCJjZW50ZXJcIiAvKiBDZW50ZXIgKi8pXG4gICAgICAgICAgICAgICAgbGluZUluZGVudCA9IChyZWN0V2lkdGggLSBsaW5lLndpZHRoKSAvIDI7XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLmFsaWduID09IFwicmlnaHRcIiAvKiBSaWdodCAqLylcbiAgICAgICAgICAgICAgICBsaW5lSW5kZW50ID0gcmVjdFdpZHRoIC0gbGluZS53aWR0aDtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBsaW5lSW5kZW50ID0gMDtcbiAgICAgICAgICAgIHRleHRMZW5ndGggPSBsaW5lLnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0ZXh0TGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgY2ggPSBsaW5lLnRleHQuY2hhckF0KGopO1xuICAgICAgICAgICAgICAgIGdseXBoID0gdGhpcy4kYml0bWFwRm9udC5nbHlwaHNbY2hdO1xuICAgICAgICAgICAgICAgIGlmIChnbHlwaCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoYXJJbmRlbnQgPSAobGluZS5oZWlnaHQgKyBsaW5lLnRleHRIZWlnaHQpIC8gMiAtIE1hdGguY2VpbChnbHlwaC5saW5lSGVpZ2h0ICogZm9udFNjYWxlKTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGJtO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kYml0bWFwUG9vbC5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgICAgICBibSA9IHRoaXMuJGJpdG1hcFBvb2wucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIGJtID0gbmV3IEJpdG1hcCgpO1xuICAgICAgICAgICAgICAgICAgICBibS54ID0gY2hhclggKyBsaW5lSW5kZW50ICsgTWF0aC5jZWlsKGdseXBoLm9mZnNldFggKiBmb250U2NhbGUpO1xuICAgICAgICAgICAgICAgICAgICBibS55ID0gbGluZS55ICsgY2hhckluZGVudCArIE1hdGguY2VpbChnbHlwaC5vZmZzZXRZICogZm9udFNjYWxlKTtcbiAgICAgICAgICAgICAgICAgICAgYm0udGV4dHVyZSA9IGdseXBoLnRleHR1cmUuaW1hZ2U7XG4gICAgICAgICAgICAgICAgICAgIGJtLnRleHR1cmVSZWN0ID0gZ2x5cGgudGV4dHVyZS5yZWN0O1xuICAgICAgICAgICAgICAgICAgICBsZXQgeyB4LCB5LCB3aWR0aCwgaGVpZ2h0IH0gPSBnbHlwaDtcbiAgICAgICAgICAgICAgICAgICAgYm0uc291cmNlUmVjdCA9IG5ldyBjcmVhdGVqcy5SZWN0YW5nbGUoeCwgeSwgd2lkdGgsIGhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIGJtLnNldCh7IHNjYWxlWDogZm9udFNjYWxlLCBzY2FsZVk6IGZvbnRTY2FsZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgYm0udGludCA9IHRoaXMuJGJpdG1hcEZvbnQuY29sb3JhYmxlID09PSB0cnVlID8gdGhpcy4kY29sb3IgOiAnMHhGRkZGRkYnO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRidENvbnRhaW5lci5hZGRDaGlsZChibSk7XG4gICAgICAgICAgICAgICAgICAgIGNoYXJYICs9IGxldHRlclNwYWNpbmcgKyBNYXRoLmNlaWwoZ2x5cGguYWR2YW5jZSAqIGZvbnRTY2FsZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNoID09ICcgJykge1xuICAgICAgICAgICAgICAgICAgICBjaGFyWCArPSBsZXR0ZXJTcGFjaW5nICsgTWF0aC5jZWlsKCh0aGlzLiRiaXRtYXBGb250LnNpemUgKiBmb250U2NhbGUpIC8gMik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjaGFyWCArPSBsZXR0ZXJTcGFjaW5nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGxvY2FsVG9HbG9iYWwoYXggPSAwLCBheSA9IDAsIHJlc3VsdFBvaW50KSB7XG4gICAgICAgIGF4IC09IHRoaXMuJG9mZnNldC54O1xuICAgICAgICBheSAtPSB0aGlzLiRvZmZzZXQueTtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmxvY2FsVG9HbG9iYWwoYXgsIGF5LCByZXN1bHRQb2ludCk7XG4gICAgfVxuICAgIGdsb2JhbFRvTG9jYWwoYXggPSAwLCBheSA9IDAsIHJlc3VsdFBvaW50KSB7XG4gICAgICAgIGxldCByID0gc3VwZXIuZ2xvYmFsVG9Mb2NhbChheCwgYXksIHJlc3VsdFBvaW50KTtcbiAgICAgICAgci54IC09IHRoaXMuJG9mZnNldC54O1xuICAgICAgICByLnkgLT0gdGhpcy4kb2Zmc2V0Lnk7XG4gICAgICAgIHJldHVybiByO1xuICAgIH1cbiAgICBoYW5kbGVTaXplQ2hhbmdlZCgpIHtcbiAgICAgICAgaWYgKHRoaXMuJHVwZGF0aW5nU2l6ZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKHRoaXMuJGJpdG1hcEZvbnQgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLiR3aWR0aEF1dG9TaXplKVxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy4kaW5Qcm9ncmVzc0J1aWxkaW5nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kdGV4dEZpZWxkLndpZHRoID0gdGhpcy53aWR0aDtcbiAgICAgICAgICAgICAgICB0aGlzLiR0ZXh0RmllbGQuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kYXV0b1NpemUgPT0gMyAvKiBTaHJpbmsgKi8pXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hyaW5rVGV4dEZpZWxkKCk7XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy4kd2lkdGhBdXRvU2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLiRoZWlnaHRBdXRvU2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHRleHRGaWVsZC53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kdGV4dEZpZWxkLmhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHRleHRGaWVsZC53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sYXlvdXRBbGlnbigpO1xuICAgIH1cbiAgICBzaHJpbmtUZXh0RmllbGQoKSB7XG4gICAgICAgIGxldCBmaXRTY2FsZSA9IE1hdGgubWluKDEsIHRoaXMud2lkdGggLyB0aGlzLiR0ZXh0V2lkdGgpO1xuICAgICAgICB0aGlzLiR0ZXh0RmllbGQuc2V0KHsgc2NhbGVYOiBmaXRTY2FsZSwgc2NhbGVZOiBmaXRTY2FsZSB9KTtcbiAgICB9XG4gICAgbGF5b3V0QWxpZ24oKSB7XG4gICAgICAgIGxldCB0dyA9IHRoaXMuJHRleHRXaWR0aCwgdGggPSB0aGlzLiR0ZXh0SGVpZ2h0O1xuICAgICAgICBpZiAodGhpcy5hdXRvU2l6ZSA9PSAzIC8qIFNocmluayAqLykge1xuICAgICAgICAgICAgdHcgKj0gdGhpcy5kaXNwbGF5T2JqZWN0LnNjYWxlWDtcbiAgICAgICAgICAgIHRoICo9IHRoaXMuZGlzcGxheU9iamVjdC5zY2FsZVk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuJHZlcnRpY2FsQWxpZ24gPT0gMCAvKiBUb3AgKi8gfHwgdGggPT0gMClcbiAgICAgICAgICAgIHRoaXMuJG9mZnNldC55ID0gR1RleHRGaWVsZC5HVVRURVJfWTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBsZXQgZGggPSBNYXRoLm1heCgwLCB0aGlzLmhlaWdodCAtIHRoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLiR2ZXJ0aWNhbEFsaWduID09IDEgLyogTWlkZGxlICovKVxuICAgICAgICAgICAgICAgIHRoaXMuJG9mZnNldC55ID0gZGggKiAwLjU7XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLiR2ZXJ0aWNhbEFsaWduID09IDIgLyogQm90dG9tICovKVxuICAgICAgICAgICAgICAgIHRoaXMuJG9mZnNldC55ID0gZGg7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHhQb3MgPSAwO1xuICAgICAgICBzd2l0Y2ggKHRoaXMuJHN0eWxlLmFsaWduKSB7XG4gICAgICAgICAgICBjYXNlICdjZW50ZXInOlxuICAgICAgICAgICAgICAgIHhQb3MgPSAodGhpcy53aWR0aCAtIHR3KSAqIDAuNTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgICAgICAgICB4UG9zID0gdGhpcy53aWR0aCAtIHR3O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuJG9mZnNldC54ID0geFBvcztcbiAgICAgICAgdGhpcy51cGRhdGVQb3NpdGlvbigpO1xuICAgIH1cbiAgICB1cGRhdGVQb3NpdGlvbigpIHtcbiAgICAgICAgbGV0IHggPSBNYXRoLmZsb29yKHRoaXMueCArIHRoaXMuJG9mZnNldC54KTtcbiAgICAgICAgbGV0IHkgPSBNYXRoLmZsb29yKHRoaXMueSArIHRoaXMuJG9mZnNldC55KTtcbiAgICAgICAgdGhpcy5kaXNwbGF5T2JqZWN0LnNldCh7IHgsIHkgfSk7XG4gICAgICAgIHRoaXMuJHRleHRGaWVsZC51cGRhdGVNdWx0aXBsZVBvc2l0aW9uKHgsIHkpO1xuICAgIH1cbiAgICBoYW5kbGVYWUNoYW5nZWQoKSB7XG4gICAgICAgIHN1cGVyLmhhbmRsZVhZQ2hhbmdlZCgpO1xuICAgICAgICBpZiAodGhpcy4kZGlzcGxheU9iamVjdClcbiAgICAgICAgICAgIHRoaXMudXBkYXRlUG9zaXRpb24oKTtcbiAgICB9XG4gICAgc2V0dXBCZWZvcmVBZGQoeG1sKSB7XG4gICAgICAgIHN1cGVyLnNldHVwQmVmb3JlQWRkKHhtbCk7XG4gICAgICAgIGxldCBzdHIgPSB4bWwuYXR0cmlidXRlcy5mb250O1xuICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgdGhpcy5mb250ID0gc3RyO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy52QWxpZ247XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICB0aGlzLnZlcnRpY2FsQWxpZ24gPSBQYXJzZVZlcnRBbGlnblR5cGUoc3RyKTtcbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMubGVhZGluZztcbiAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgIHRoaXMuJHN0eWxlLmxlYWRpbmcgPSBwYXJzZUludChzdHIpO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5sZXR0ZXJTcGFjaW5nO1xuICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgdGhpcy4kc3R5bGUubGV0dGVyU3BhY2luZyA9IHBhcnNlSW50KHN0cik7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmZvbnRTaXplO1xuICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgdGhpcy4kc3R5bGUuZm9udFNpemUgPSBwYXJzZUludChzdHIpO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5jb2xvcjtcbiAgICAgICAgaWYgKHN0cikge1xuICAgICAgICAgICAgdGhpcy5jb2xvciA9IHN0cjtcbiAgICAgICAgfVxuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5zaGFkb3dDb2xvcjtcbiAgICAgICAgaWYgKHN0cikge1xuICAgICAgICAgICAgdGhpcy4kc3R5bGUuZHJvcFNoYWRvd0NvbG9yID0gc3RyO1xuICAgICAgICB9XG4gICAgICAgIGxldCBhcnI7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnNoYWRvd09mZnNldDtcbiAgICAgICAgaWYgKHN0cikge1xuICAgICAgICAgICAgYXJyID0gc3RyLnNwbGl0KCcsJyk7XG4gICAgICAgICAgICBpZiAoYXJyLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRzdHlsZS5kcm9wU2hhZG93T2Zmc2V0WCA9IHBhcnNlSW50KGFyclswXSk7XG4gICAgICAgICAgICAgICAgdGhpcy4kc3R5bGUuZHJvcFNoYWRvd09mZnNldFkgPSBwYXJzZUludChhcnJbMV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmFsaWduO1xuICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgdGhpcy5hbGlnbiA9IFBhcnNlQWxpZ25UeXBlKHN0cik7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmF1dG9TaXplO1xuICAgICAgICBpZiAoc3RyKSB7XG4gICAgICAgICAgICB0aGlzLmF1dG9TaXplID0gUGFyc2VBdXRvU2l6ZVR5cGUoc3RyKTtcbiAgICAgICAgICAgIHRoaXMuJHdpZHRoQXV0b1NpemUgPVxuICAgICAgICAgICAgICAgIHRoaXMuJGF1dG9TaXplID09IDEgLyogQm90aCAqLyB8fCB0aGlzLiRhdXRvU2l6ZSA9PSAzIC8qIFNocmluayAqLztcbiAgICAgICAgICAgIHRoaXMuJGhlaWdodEF1dG9TaXplID1cbiAgICAgICAgICAgICAgICB0aGlzLiRhdXRvU2l6ZSA9PSAxIC8qIEJvdGggKi8gfHwgdGhpcy4kYXV0b1NpemUgPT0gMiAvKiBIZWlnaHQgKi87XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51bmRlcmxpbmUgPSB4bWwuYXR0cmlidXRlcy51bmRlcmxpbmUgPT0gJ3RydWUnO1xuICAgICAgICB0aGlzLml0YWxpYyA9IHhtbC5hdHRyaWJ1dGVzLml0YWxpYyA9PSAndHJ1ZSc7XG4gICAgICAgIHRoaXMuYm9sZCA9IHhtbC5hdHRyaWJ1dGVzLmJvbGQgPT0gJ3RydWUnO1xuICAgICAgICB0aGlzLm11bHRpcGxlTGluZSA9IHhtbC5hdHRyaWJ1dGVzLnNpbmdsZUxpbmUgIT0gJ3RydWUnO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5zdHJva2VDb2xvcjtcbiAgICAgICAgaWYgKHN0cikge1xuICAgICAgICAgICAgdGhpcy5zdHJva2VDb2xvciA9IHN0cjtcbiAgICAgICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnN0cm9rZVNpemU7XG4gICAgICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgICAgIHRoaXMuc3Ryb2tlID0gcGFyc2VJbnQoc3RyKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB0aGlzLnN0cm9rZSA9IDE7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0dXBBZnRlckFkZCh4bWwpIHtcbiAgICAgICAgc3VwZXIuc2V0dXBBZnRlckFkZCh4bWwpO1xuICAgICAgICBsZXQgc3RyID0geG1sLmF0dHJpYnV0ZXMudGV4dDtcbiAgICAgICAgaWYgKHN0ciAhPSBudWxsICYmIHN0ci5sZW5ndGggPiAwKVxuICAgICAgICAgICAgdGhpcy50ZXh0ID0gc3RyO1xuICAgICAgICB0aGlzLiRzaXplRGlydHkgPSBmYWxzZTtcbiAgICB9XG59XG5HVGV4dEZpZWxkLkdVVFRFUl9YID0gMjtcbkdUZXh0RmllbGQuR1VUVEVSX1kgPSAyO1xuXG4vL1RPT0Q6IGltcGxcbmNsYXNzIEdSaWNoVGV4dEZpZWxkIGV4dGVuZHMgR1RleHRGaWVsZCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIC8vIHRoaXMuJHRleHRGaWVsZC5pbnRlcmFjdGl2ZSA9IHRydWU7XG4gICAgICAgIC8vIHRoaXMuJHRleHRGaWVsZC5pbnRlcmFjdGl2ZUNoaWxkcmVuID0gZmFsc2U7XG4gICAgICAgIHRoaXMub24oXCJfX2xpbmtDbGlja1wiIC8qIExpbmtDbGljayAqLywgdGhpcy4kY2xpY2tMaW5rLCB0aGlzKTtcbiAgICB9XG4gICAgc2V0IHViYkVuYWJsZWQodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJHViYkVuYWJsZWQgIT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuJHViYkVuYWJsZWQgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHViYkVuYWJsZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR1YmJFbmFibGVkO1xuICAgIH1cbiAgICBzZXR1cEJlZm9yZUFkZCh4bWwpIHtcbiAgICAgICAgc3VwZXIuc2V0dXBCZWZvcmVBZGQoeG1sKTtcbiAgICAgICAgdGhpcy4kdWJiRW5hYmxlZCA9IHhtbC5hdHRyaWJ1dGVzLnViYiA9PSAndHJ1ZSc7XG4gICAgfVxuICAgIHNldCB0ZXh0RmxvdyhmbG93KSB7XG4gICAgICAgIHRoaXMuJHRleHRGbG93ID0gZmxvdztcbiAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICB9XG4gICAgc2V0IHRleHQodmFsdWUpIHtcbiAgICAgICAgdGhpcy4kdGV4dCA9IHZhbHVlO1xuICAgICAgICBpZiAodGhpcy4kdGV4dCA9PSBudWxsKVxuICAgICAgICAgICAgdGhpcy4kdGV4dCA9ICcnO1xuICAgICAgICB0aGlzLiR0ZXh0RmllbGQud2lkdGggPSB0aGlzLndpZHRoO1xuICAgICAgICAvLyBpZih0aGlzLiR1YmJFbmFibGVkKVxuICAgICAgICAvLyB0aGlzLnRleHRGbG93ID0gU3RyaW5nVXRpbC5wYXJzZVVCQih0aGlzLiR0ZXh0KTsgICAvL1RPRE86IHBhcnNlciBpbXBsXG4gICAgICAgIHRoaXMudXBkYXRlR2Vhcig2IC8qIFRleHQgKi8pO1xuICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgIH1cbiAgICAkY2xpY2tMaW5rKGJsb2NrKSB7XG4gICAgICAgIGxldCBldmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudChcIl9fbGlua0NsaWNrXCIgLyogTGlua0NsaWNrICovLCB0cnVlLCBmYWxzZSk7XG4gICAgICAgIGV2ZW50LmRhdGEgPSBibG9jay50ZXh0O1xuICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZXZlbnQsIHRoaXMpO1xuICAgIH1cbiAgICBkaXNwb3NlKCkge1xuICAgICAgICB0aGlzLm9mZihcIl9fbGlua0NsaWNrXCIgLyogTGlua0NsaWNrICovLCB0aGlzLiRjbGlja0xpbmspO1xuICAgICAgICBzdXBlci5kaXNwb3NlKCk7XG4gICAgfVxufVxuXG5jbGFzcyBJbnB1dEVsZW1lbnQgZXh0ZW5kcyBjcmVhdGVqcy5FdmVudERpc3BhdGNoZXIge1xuICAgIGNvbnN0cnVjdG9yKHRmKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuJHJlcXVlc3RUb1Nob3cgPSBmYWxzZTtcbiAgICAgICAgLy9wcml2YXRlICRyZXF1ZXN0VG9IaWRlOmJvb2xlYW4gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQgPSBudWxsO1xuICAgICAgICB0aGlzLmlucHV0RGl2ID0gbnVsbDtcbiAgICAgICAgdGhpcy4kc2NhbGVYID0gMDtcbiAgICAgICAgdGhpcy4kc2NhbGVZID0gMDtcbiAgICAgICAgdGhpcy50ZXh0VmFsdWUgPSAnJztcbiAgICAgICAgdGhpcy5jb2xvclZhbHVlID0gJzB4ZmZmZmZmJztcbiAgICAgICAgdGhpcy4kYXR0cnNDYWNoZSA9IHt9O1xuICAgICAgICB0aGlzLiR0ZXh0ZmllbGQgPSB0ZjtcbiAgICB9XG4gICAgLyoqQGludGVybmFsICovXG4gICAgJGFkZFRvU3RhZ2UoKSB7XG4gICAgICAgIHRoaXMuaHRtbElucHV0ID0gSFRNTElucHV0Lmluc3Q7IC8vdGFrZSBtdWx0aXBsZSBjYW52YXMgb24gd2VicGFnZSBpbnRvIGFjY291bnQ/XG4gICAgfVxuICAgIGluaXRFbGVtZW50KCkge1xuICAgICAgICBsZXQgcG9pbnQgPSB0aGlzLiR0ZXh0ZmllbGQubG9jYWxUb0dsb2JhbCgwLCAwKTtcbiAgICAgICAgbGV0IHggPSBwb2ludC54O1xuICAgICAgICBsZXQgeSA9IHBvaW50Lnk7XG4gICAgICAgIGxldCBzY2FsZVggPSB0aGlzLmh0bWxJbnB1dC4kc2NhbGVYO1xuICAgICAgICBsZXQgc2NhbGVZID0gdGhpcy5odG1sSW5wdXQuJHNjYWxlWTtcbiAgICAgICAgaWYgKCF0aGlzLiR0ZXh0ZmllbGQubXVsdGlwbGVMaW5lKVxuICAgICAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQuc3R5bGUudG9wID0gLXRoaXMuJHRleHRmaWVsZC5sZWFkaW5nICogc2NhbGVZICsgJ3B4JztcbiAgICAgICAgdGhpcy5pbnB1dERpdi5zdHlsZS50b3AgPSAoeSArIDEpICogc2NhbGVZICsgJ3B4JztcbiAgICAgICAgdGhpcy5pbnB1dERpdi5zdHlsZS5sZWZ0ID0geCAqIHNjYWxlWCArICdweCc7XG4gICAgICAgIGxldCBub2RlID0gdGhpcy4kdGV4dGZpZWxkO1xuICAgICAgICBsZXQgY1ggPSAxO1xuICAgICAgICBsZXQgY1kgPSAxO1xuICAgICAgICBsZXQgcm90YXRpb24gPSAwO1xuICAgICAgICB3aGlsZSAobm9kZS5wYXJlbnQpIHtcbiAgICAgICAgICAgIGNYICo9IG5vZGUuc2NhbGVYO1xuICAgICAgICAgICAgY1kgKj0gbm9kZS5zY2FsZVk7XG4gICAgICAgICAgICByb3RhdGlvbiArPSBub2RlLnJvdGF0aW9uO1xuICAgICAgICAgICAgbm9kZSA9IG5vZGUucGFyZW50O1xuICAgICAgICB9XG4gICAgICAgIGxldCBzdHlsZSA9IHRoaXMuaW5wdXREaXYuc3R5bGU7XG4gICAgICAgIHN0eWxlLnRyYW5zZm9ybSA9IHN0eWxlLndlYmtpdFRyYW5zZm9ybSA9IHN0eWxlLm1zVHJhbnNmb3JtID0gc3R5bGUubW96VHJhbnNmb3JtID0gc3R5bGUub1RyYW5zZm9ybSA9XG4gICAgICAgICAgICAncm90YXRlKCcgKyByb3RhdGlvbiArICdkZWcpJztcbiAgICAgICAgdGhpcy4kc2NhbGVYID0gc2NhbGVYICogY1g7XG4gICAgICAgIHRoaXMuJHNjYWxlWSA9IHNjYWxlWSAqIGNZO1xuICAgIH1cbiAgICBnZXQgdGV4dEZpZWxkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kdGV4dGZpZWxkO1xuICAgIH1cbiAgICAvKipAaW50ZXJuYWwgKi9cbiAgICAkc2hvdygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmh0bWxJbnB1dC5pc0N1cnJlbnRJbnB1dCh0aGlzKSkge1xuICAgICAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQgPSB0aGlzLmh0bWxJbnB1dC5yZXF1ZXN0SW5wdXQodGhpcyk7XG4gICAgICAgICAgICBpZiAoIXRoaXMuJHRleHRmaWVsZC5tdWx0aXBsZUxpbmUpXG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQudHlwZSA9IHRoaXMuJHRleHRmaWVsZC50eXBlO1xuICAgICAgICAgICAgZm9yIChsZXQga2V5IGluIHRoaXMuJGF0dHJzQ2FjaGUpXG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQuc2V0QXR0cmlidXRlKGtleSwgdGhpcy4kYXR0cnNDYWNoZVtrZXldKTtcbiAgICAgICAgICAgIHRoaXMuaW5wdXREaXYgPSB0aGlzLmh0bWxJbnB1dC4kd3JhcHBlcjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLmlucHV0RWxlbWVudC5vbmJsdXIgPSBudWxsO1xuICAgICAgICB0aGlzLmh0bWxJbnB1dC4kcmVxdWVzdFRvU2hvdyA9IHRydWU7XG4gICAgICAgIHRoaXMuJHJlcXVlc3RUb1Nob3cgPSB0cnVlO1xuICAgICAgICB0aGlzLmluaXRFbGVtZW50KCk7XG4gICAgfVxuICAgICRoaWRlKCkgeyB9XG4gICAgb25CbHVySGFuZGxlcigpIHtcbiAgICAgICAgdGhpcy5odG1sSW5wdXQuY2xlYXJJbnB1dEVsZW1lbnQoKTtcbiAgICAgICAgdGhpcy5odG1sSW5wdXQuY2xlYXJBdHRyaWJ1dGVzKHRoaXMuJGF0dHJzQ2FjaGUpO1xuICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgMCk7XG4gICAgfVxuICAgIGdldCB0ZXh0KCkge1xuICAgICAgICBpZiAoIXRoaXMudGV4dFZhbHVlKVxuICAgICAgICAgICAgdGhpcy50ZXh0VmFsdWUgPSAnJztcbiAgICAgICAgcmV0dXJuIHRoaXMudGV4dFZhbHVlO1xuICAgIH1cbiAgICBzZXQgdGV4dCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnRleHRWYWx1ZSA9IHZhbHVlO1xuICAgICAgICBpZiAodGhpcy5pbnB1dEVsZW1lbnQpXG4gICAgICAgICAgICB0aGlzLmlucHV0RWxlbWVudC52YWx1ZSA9IHRoaXMudGV4dFZhbHVlO1xuICAgIH1cbiAgICBzZXRDb2xvcih2YWx1ZSkge1xuICAgICAgICB0aGlzLmNvbG9yVmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgaWYgKHRoaXMuaW5wdXRFbGVtZW50KVxuICAgICAgICAgICAgdGhpcy5zZXRFbGVtZW50U3R5bGUoJ2NvbG9yJywgU3RyaW5nVXRpbC5IRVgyUkdCKHRoaXMuY29sb3JWYWx1ZSkpO1xuICAgIH1cbiAgICAvKipAaW50ZXJuYWwgKi9cbiAgICAkb25CbHVyKCkge1xuICAgICAgICAvLyB0aGlzLmRpc3BhdGNoRXZlbnQoXCJ1cGRhdGVUZXh0XCIpO1xuICAgIH1cbiAgICBvbklucHV0SGFuZGxlcigpIHtcbiAgICAgICAgd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuaW5wdXRFbGVtZW50ICYmIHRoaXMuaW5wdXRFbGVtZW50LnNlbGVjdGlvblN0YXJ0ID09IHRoaXMuaW5wdXRFbGVtZW50LnNlbGVjdGlvbkVuZCkge1xuICAgICAgICAgICAgICAgIHRoaXMudGV4dFZhbHVlID0gdGhpcy5pbnB1dEVsZW1lbnQudmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KCd1cGRhdGVUZXh0Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIDApO1xuICAgIH1cbiAgICBzZXRBcmVhSGVpZ2h0KCkge1xuICAgICAgICBsZXQgdGYgPSB0aGlzLiR0ZXh0ZmllbGQ7XG4gICAgICAgIGlmICh0Zi5tdWx0aXBsZUxpbmUpIHtcbiAgICAgICAgICAgIGxldCB0ZXh0aGVpZ2h0ID0gdGYudGV4dEhlaWdodDtcbiAgICAgICAgICAgIGlmICh0Zi5oZWlnaHQgPD0gdGYuZm9udFNpemUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEVsZW1lbnRTdHlsZSgnaGVpZ2h0JywgdGYuZm9udFNpemUgKiB0aGlzLiRzY2FsZVkgKyAncHgnKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEVsZW1lbnRTdHlsZSgncGFkZGluZycsICcwcHgnKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEVsZW1lbnRTdHlsZSgnbGluZUhlaWdodCcsIHRmLmxpbmVIZWlnaHQgKiB0aGlzLiRzY2FsZVkgKyAncHgnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRmLmhlaWdodCA8IHRleHRoZWlnaHQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEVsZW1lbnRTdHlsZSgnaGVpZ2h0JywgdGYuaGVpZ2h0ICogdGhpcy4kc2NhbGVZICsgJ3B4Jyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRFbGVtZW50U3R5bGUoJ3BhZGRpbmcnLCAnMHB4Jyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRFbGVtZW50U3R5bGUoJ2xpbmVIZWlnaHQnLCB0Zi5saW5lSGVpZ2h0ICogdGhpcy4kc2NhbGVZICsgJ3B4Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEVsZW1lbnRTdHlsZSgnaGVpZ2h0JywgKHRleHRoZWlnaHQgKyB0Zi5sZWFkaW5nKSAqIHRoaXMuJHNjYWxlWSArICdweCcpO1xuICAgICAgICAgICAgICAgIGxldCByYXAgPSAodGYuaGVpZ2h0IC0gdGV4dGhlaWdodCkgKiB0aGlzLiRzY2FsZVk7XG4gICAgICAgICAgICAgICAgbGV0IHZhbGlnbiA9IHRoaXMuZ2V0VkFsaWduRmFjdG9yKHRmKTtcbiAgICAgICAgICAgICAgICBsZXQgdG9wID0gcmFwICogdmFsaWduO1xuICAgICAgICAgICAgICAgIGxldCBib3R0b20gPSByYXAgLSB0b3A7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRFbGVtZW50U3R5bGUoJ3BhZGRpbmcnLCB0b3AgKyAncHggMHB4ICcgKyBib3R0b20gKyAncHggMHB4Jyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRFbGVtZW50U3R5bGUoJ2xpbmVIZWlnaHQnLCB0Zi5saW5lSGVpZ2h0ICogdGhpcy4kc2NhbGVZICsgJ3B4Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0VkFsaWduRmFjdG9yKHRleHRmaWVsZCkge1xuICAgICAgICBsZXQgdmFvID0gMDtcbiAgICAgICAgc3dpdGNoICh0ZXh0ZmllbGQudmVydGljYWxBbGlnbikge1xuICAgICAgICAgICAgY2FzZSAwIC8qIFRvcCAqLzpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMSAvKiBNaWRkbGUgKi86XG4gICAgICAgICAgICAgICAgdmFvID0gMC41O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAyIC8qIEJvdHRvbSAqLzpcbiAgICAgICAgICAgICAgICB2YW8gPSAxO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YW87XG4gICAgfVxuICAgIG9uQ2xpY2tIYW5kbGVyKGUpIHtcbiAgICAgICAgaWYgKHRoaXMuJHJlcXVlc3RUb1Nob3cpIHtcbiAgICAgICAgICAgIC8vZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHRoaXMuJHJlcXVlc3RUb1Nob3cgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRFbGVtZW50LnZhbHVlID0gdGhpcy50ZXh0O1xuICAgICAgICAgICAgaWYgKHRoaXMuaW5wdXRFbGVtZW50Lm9uYmx1ciA9PSBudWxsKVxuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRFbGVtZW50Lm9uYmx1ciA9IEJpbmRlci5jcmVhdGUodGhpcy5vbkJsdXJIYW5kbGVyLCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMucmVzZXRJbnB1dCgpO1xuICAgICAgICAgICAgaWYgKHRoaXMuJHRleHRmaWVsZC5tYXhMZW5ndGggPiAwKVxuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRFbGVtZW50LnNldEF0dHJpYnV0ZSgnbWF4bGVuZ3RoJywgU3RyaW5nKHRoaXMuJHRleHRmaWVsZC5tYXhMZW5ndGgpKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0RWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ21heGxlbmd0aCcpO1xuICAgICAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQuc2VsZWN0aW9uU3RhcnQgPSB0aGlzLmlucHV0RWxlbWVudC52YWx1ZS5sZW5ndGg7XG4gICAgICAgICAgICB0aGlzLmlucHV0RWxlbWVudC5zZWxlY3Rpb25FbmQgPSB0aGlzLmlucHV0RWxlbWVudC52YWx1ZS5sZW5ndGg7XG4gICAgICAgICAgICB0aGlzLmlucHV0RWxlbWVudC5mb2N1cygpO1xuICAgICAgICAgICAgbGV0IGV2dCA9IG5ldyBjcmVhdGVqcy5FdmVudChcIl9fZm9jdXNDaGFuZ2VkXCIgLyogQ0hBTkdFRCAqLywgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICAgICAgZXZ0LmRhdGEgPSAnZm9jdXMnO1xuICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGV2dCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgb25EaXNjb25uZWN0KCkge1xuICAgICAgICB0aGlzLmlucHV0RWxlbWVudCA9IG51bGw7XG4gICAgICAgIGxldCBldnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoXCJfX2ZvY3VzQ2hhbmdlZFwiIC8qIENIQU5HRUQgKi8sIHRydWUsIGZhbHNlKTtcbiAgICAgICAgZXZ0LmRhdGEgPSAnYmx1cic7XG4gICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChldnQpO1xuICAgIH1cbiAgICBzZXRFbGVtZW50U3R5bGUoc3R5bGUsIHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAodGhpcy5pbnB1dEVsZW1lbnQpIHtcbiAgICAgICAgICAgIGxldCBzcyA9IHRoaXMuaW5wdXRFbGVtZW50LnN0eWxlO1xuICAgICAgICAgICAgc3Nbc3R5bGVdID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgIGlmIChuYW1lID09IG51bGwgfHwgdmFsdWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy4kYXR0cnNDYWNoZVtuYW1lXSA9IHZhbHVlO1xuICAgIH1cbiAgICBnZXRBdHRyaWJ1dGUobmFtZSkge1xuICAgICAgICByZXR1cm4gdGhpcy4kYXR0cnNDYWNoZVtuYW1lXTtcbiAgICB9XG4gICAgLyoqQGludGVybmFsICovXG4gICAgJHJlbW92ZUZyb21TdGFnZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuaW5wdXRFbGVtZW50KVxuICAgICAgICAgICAgdGhpcy5odG1sSW5wdXQuZGlzY29ubmVjdCh0aGlzKTtcbiAgICB9XG4gICAgcmVzZXRJbnB1dCgpIHtcbiAgICAgICAgaWYgKHRoaXMuaW5wdXRFbGVtZW50KSB7XG4gICAgICAgICAgICBsZXQgdGV4dGZpZWxkID0gdGhpcy4kdGV4dGZpZWxkO1xuICAgICAgICAgICAgdGhpcy5zZXRFbGVtZW50U3R5bGUoJ2ZvbnRGYW1pbHknLCB0ZXh0ZmllbGQuZm9udCk7XG4gICAgICAgICAgICB0aGlzLnNldEVsZW1lbnRTdHlsZSgnZm9udFN0eWxlJywgdGV4dGZpZWxkLml0YWxpYyA/ICdpdGFsaWMnIDogJ25vcm1hbCcpO1xuICAgICAgICAgICAgdGhpcy5zZXRFbGVtZW50U3R5bGUoJ2ZvbnRXZWlnaHQnLCB0ZXh0ZmllbGQuYm9sZCA/ICdib2xkJyA6ICdub3JtYWwnKTtcbiAgICAgICAgICAgIHRoaXMuc2V0RWxlbWVudFN0eWxlKCd0ZXh0QWxpZ24nLCB0ZXh0ZmllbGQuYWxpZ24pO1xuICAgICAgICAgICAgdGhpcy5zZXRFbGVtZW50U3R5bGUoJ2ZvbnRTaXplJywgdGV4dGZpZWxkLmZvbnRTaXplICogdGhpcy4kc2NhbGVZICsgJ3B4Jyk7XG4gICAgICAgICAgICB0aGlzLnNldEVsZW1lbnRTdHlsZSgnY29sb3InLCBTdHJpbmdVdGlsLmNvbnZlcnRUb0h0bWxDb2xvcigrdGV4dGZpZWxkLmNvbG9yKSk7XG4gICAgICAgICAgICB0aGlzLnNldEVsZW1lbnRTdHlsZSgnd2lkdGgnLCB0ZXh0ZmllbGQud2lkdGggKiB0aGlzLiRzY2FsZVggKyAncHgnKTsgLy90YWtlICdtYXhXaWR0aCcgaW50byBhY2NvdW50XG4gICAgICAgICAgICBsZXQgdmEgPSAnbWlkZGxlJywgdmFvID0gMDtcbiAgICAgICAgICAgIHN3aXRjaCAodGV4dGZpZWxkLnZlcnRpY2FsQWxpZ24pIHtcbiAgICAgICAgICAgICAgICBjYXNlIDAgLyogVG9wICovOlxuICAgICAgICAgICAgICAgICAgICB2YSA9ICd0b3AnO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDEgLyogTWlkZGxlICovOlxuICAgICAgICAgICAgICAgICAgICB2YSA9ICdtaWRkbGUnO1xuICAgICAgICAgICAgICAgICAgICB2YW8gPSAwLjU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMiAvKiBCb3R0b20gKi86XG4gICAgICAgICAgICAgICAgICAgIHZhID0gJ2JvdHRvbSc7XG4gICAgICAgICAgICAgICAgICAgIHZhbyA9IDE7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zZXRFbGVtZW50U3R5bGUoJ3ZlcnRpY2FsQWxpZ24nLCB2YSk7XG4gICAgICAgICAgICBpZiAodGV4dGZpZWxkLm11bHRpcGxlTGluZSlcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFyZWFIZWlnaHQoKTtcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0RWxlbWVudFN0eWxlKCdsaW5lSGVpZ2h0JywgdGV4dGZpZWxkLmxpbmVIZWlnaHQgKiB0aGlzLiRzY2FsZVkgKyAncHgnKTtcbiAgICAgICAgICAgICAgICBpZiAodGV4dGZpZWxkLmhlaWdodCA8IHRleHRmaWVsZC5mb250U2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEVsZW1lbnRTdHlsZSgnaGVpZ2h0JywgdGV4dGZpZWxkLmZvbnRTaXplICogdGhpcy4kc2NhbGVZICsgJ3B4Jyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RWxlbWVudFN0eWxlKCdwYWRkaW5nJywgJzBweCAwcHggJyArIHRleHRmaWVsZC5mb250U2l6ZSAqIDAuNSAqIHRoaXMuJHNjYWxlWCArICdweCAwcHgnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RWxlbWVudFN0eWxlKCdoZWlnaHQnLCB0ZXh0ZmllbGQuZm9udFNpemUgKiB0aGlzLiRzY2FsZVkgKyAncHgnKTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJhcCA9ICh0ZXh0ZmllbGQuaGVpZ2h0IC0gdGV4dGZpZWxkLmZvbnRTaXplKSAqIHRoaXMuJHNjYWxlWTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHRvcCA9IHJhcCAqIHZhbztcbiAgICAgICAgICAgICAgICAgICAgbGV0IGJvdHRvbSA9IHJhcCAtIHRvcCwgZnN5ID0gdGV4dGZpZWxkLmZvbnRTaXplICogMC41ICogdGhpcy4kc2NhbGVZO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYm90dG9tIDwgZnN5KVxuICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tID0gZnN5O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEVsZW1lbnRTdHlsZSgncGFkZGluZycsIHRvcCArICdweCAwcHggJyArIGJvdHRvbSArICdweCAwcHgnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmlucHV0RGl2LnN0eWxlLmNsaXAgPVxuICAgICAgICAgICAgICAgICdyZWN0KDBweCAnICtcbiAgICAgICAgICAgICAgICAgICAgdGV4dGZpZWxkLndpZHRoICogdGhpcy4kc2NhbGVYICtcbiAgICAgICAgICAgICAgICAgICAgJ3B4ICcgK1xuICAgICAgICAgICAgICAgICAgICB0ZXh0ZmllbGQuaGVpZ2h0ICogdGhpcy4kc2NhbGVZICtcbiAgICAgICAgICAgICAgICAgICAgJ3B4IDBweCknO1xuICAgICAgICAgICAgdGhpcy5pbnB1dERpdi5zdHlsZS5oZWlnaHQgPSB0ZXh0ZmllbGQuaGVpZ2h0ICogdGhpcy4kc2NhbGVZICsgJ3B4JztcbiAgICAgICAgICAgIHRoaXMuaW5wdXREaXYuc3R5bGUud2lkdGggPSB0ZXh0ZmllbGQud2lkdGggKiB0aGlzLiRzY2FsZVggKyAncHgnOyAvL3Rha2UgJ21heFdpZHRoJyBpbnRvIGFjY291bnRcbiAgICAgICAgfVxuICAgIH1cbn1cblxuY2xhc3MgSW5wdXREZWxlZ2F0ZSB7XG4gICAgY29uc3RydWN0b3IodGYpIHtcbiAgICAgICAgdGhpcy4kaW5pdGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuJHJlc3RyaWN0U3RyaW5nID0gbnVsbDtcbiAgICAgICAgdGhpcy4kcmVzdHJpY3RSZWdleCA9IG51bGw7XG4gICAgICAgIHRoaXMuJGZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy4kdGV4dEZpZWxkID0gdGY7XG4gICAgICAgIHRoaXMuJGlucHV0ID0gbmV3IElucHV0RWxlbWVudCh0Zik7XG4gICAgfVxuICAgIGluaXRpYWxpemUoKSB7XG4gICAgICAgIGlmICh0aGlzLiRpbml0ZWQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuJGlucHV0LiRhZGRUb1N0YWdlKCk7XG4gICAgICAgIHRoaXMuJGlucHV0Lm9uKCd1cGRhdGVUZXh0JywgdGhpcy51cGRhdGVUZXh0LCB0aGlzKTtcbiAgICAgICAgdGhpcy4kaW5wdXQub24oXCJfX2ZvY3VzQ2hhbmdlZFwiIC8qIENIQU5HRUQgKi8sIHRoaXMuZm9jdXNIYW5kbGVyLCB0aGlzKTtcbiAgICAgICAgdGhpcy4kdGV4dEZpZWxkLm9uKEludGVyYWN0aXZlRXZlbnRzLkRvd24sIHRoaXMudGV4dEZpZWxkRG93bkhhbmRsZXIsIHRoaXMpO1xuICAgICAgICB0aGlzLiRpbml0ZWQgPSB0cnVlO1xuICAgIH1cbiAgICB0ZXh0RmllbGREb3duSGFuZGxlcigpIHtcbiAgICAgICAgdGhpcy4kb25Gb2N1cygpO1xuICAgIH1cbiAgICBkZXN0cm95KCkge1xuICAgICAgICBpZiAoIXRoaXMuJGluaXRlZClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy4kaW5wdXQuJHJlbW92ZUZyb21TdGFnZSgpO1xuICAgICAgICB0aGlzLiR0ZXh0RmllbGQub2ZmKEludGVyYWN0aXZlRXZlbnRzLkRvd24sIHRoaXMudGV4dEZpZWxkRG93bkhhbmRsZXIpO1xuICAgICAgICBHUm9vdC5pbnN0Lm9mZihJbnRlcmFjdGl2ZUV2ZW50cy5Eb3duLCB0aGlzLm9uU3RhZ2VEb3duKTtcbiAgICAgICAgdGhpcy4kaW5wdXQub2ZmKCd1cGRhdGVUZXh0JywgdGhpcy51cGRhdGVUZXh0KTtcbiAgICAgICAgdGhpcy4kaW5wdXQub2ZmKFwiX19mb2N1c0NoYW5nZWRcIiAvKiBDSEFOR0VEICovLCB0aGlzLmZvY3VzSGFuZGxlcik7XG4gICAgICAgIHRoaXMuJGluaXRlZCA9IGZhbHNlO1xuICAgIH1cbiAgICBnZXQgdGV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGlucHV0LnRleHQ7XG4gICAgfVxuICAgIHNldCB0ZXh0KHYpIHtcbiAgICAgICAgdGhpcy4kaW5wdXQudGV4dCA9IHY7XG4gICAgfVxuICAgIHNldENvbG9yKHYpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGlucHV0LnNldENvbG9yKHYpO1xuICAgIH1cbiAgICB1cGRhdGVUZXh0KCkge1xuICAgICAgICBsZXQgdGV4dFZhbHVlID0gdGhpcy4kaW5wdXQudGV4dDtcbiAgICAgICAgbGV0IGlzQ2hhbmdlZCA9IGZhbHNlO1xuICAgICAgICBpZiAodGhpcy4kcmVzdHJpY3RSZWdleCAhPSBudWxsKSB7XG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gdGV4dFZhbHVlLm1hdGNoKHRoaXMuJHJlc3RyaWN0UmVnZXgpO1xuICAgICAgICAgICAgaWYgKHJlc3VsdClcbiAgICAgICAgICAgICAgICB0ZXh0VmFsdWUgPSByZXN1bHQuam9pbignJyk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGV4dFZhbHVlID0gJyc7XG4gICAgICAgICAgICBpc0NoYW5nZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc0NoYW5nZWQgJiYgdGhpcy4kaW5wdXQudGV4dCAhPSB0ZXh0VmFsdWUpXG4gICAgICAgICAgICB0aGlzLiRpbnB1dC50ZXh0ID0gdGV4dFZhbHVlO1xuICAgICAgICB0aGlzLiR0ZXh0RmllbGQudGV4dCA9IHRoaXMuJGlucHV0LnRleHQ7XG4gICAgICAgIGxldCBldnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoXCJfX3RleHRDaGFuZ2VcIiAvKiBDaGFuZ2UgKi8sIHRydWUsIGZhbHNlKTtcbiAgICAgICAgZXZ0LmRhdGEgPSB7IHRleHRGaWVsZDogdGhpcy4kdGV4dEZpZWxkIH07XG4gICAgICAgIHRoaXMuJHRleHRGaWVsZC5kaXNwYXRjaEV2ZW50KGV2dCwgdGhpcyk7XG4gICAgfVxuICAgIG9uU3RhZ2VEb3duKGUpIHtcbiAgICAgICAgbGV0IHRhcmdldCA9IEdPYmplY3QuY2FzdEZyb21OYXRpdmVPYmplY3QoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICAgICAgaWYgKHRhcmdldCAhPSB0aGlzLiR0ZXh0RmllbGQpXG4gICAgICAgICAgICB0aGlzLiRpbnB1dC4kaGlkZSgpO1xuICAgIH1cbiAgICBmb2N1c0hhbmRsZXIoZXZ0KSB7XG4gICAgICAgIGxldCB7IGRhdGEgfSA9IGV2dDtcbiAgICAgICAgaWYgKGRhdGEgPT0gJ2ZvY3VzJykge1xuICAgICAgICAgICAgaWYgKCF0aGlzLiRmb2N1c2VkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kZm9jdXNlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy4kdGV4dEZpZWxkLiRpc1R5cGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy4kdGV4dEZpZWxkLmFscGhhID0gMC4wMTtcbiAgICAgICAgICAgICAgICB0aGlzLiR0ZXh0RmllbGQuZGlzcGF0Y2hFdmVudChcIl9fZm9jdXNDaGFuZ2VkXCIgLyogQ0hBTkdFRCAqLywgJ2ZvY3VzJyk7XG4gICAgICAgICAgICAgICAgdGhpcy4kdGV4dEZpZWxkLmRpc3BhdGNoRXZlbnQoXCJfX3RleHRGb2N1c0luXCIgLyogRm9jdXNJbiAqLywgdGhpcy4kdGV4dEZpZWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChkYXRhID09ICdibHVyJykge1xuICAgICAgICAgICAgaWYgKHRoaXMuJGZvY3VzZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRmb2N1c2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgR1Jvb3QuaW5zdC5vZmYoSW50ZXJhY3RpdmVFdmVudHMuRG93biwgdGhpcy5vblN0YWdlRG93bik7XG4gICAgICAgICAgICAgICAgdGhpcy4kdGV4dEZpZWxkLiRpc1R5cGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuJHRleHRGaWVsZC5hbHBoYSA9IDE7XG4gICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQuJG9uQmx1cigpO1xuICAgICAgICAgICAgICAgIHRoaXMuJHRleHRGaWVsZC5kaXNwYXRjaEV2ZW50KFwiX19mb2N1c0NoYW5nZWRcIiAvKiBDSEFOR0VEICovLCAnYmx1cicpO1xuICAgICAgICAgICAgICAgIHRoaXMuJHRleHRGaWVsZC5kaXNwYXRjaEV2ZW50KFwiX190ZXh0Rm9jdXNPdXRcIiAvKiBGb2N1c091dCAqLywgdGhpcy4kdGV4dEZpZWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgaXNGb2N1c2VkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kZm9jdXNlZDtcbiAgICB9XG4gICAgLyoqQGludGVybmFsICovXG4gICAgJGdldFByb3BlcnR5KG5hbWUpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLiRpbml0ZWQgJiYgdGhpcy4kaW5wdXQuZ2V0QXR0cmlidXRlKG5hbWUpKSB8fCBudWxsO1xuICAgIH1cbiAgICAvKipAaW50ZXJuYWwgKi9cbiAgICAkc2V0UHJvcGVydHkobmFtZSwgdmFsdWUpIHtcbiAgICAgICAgaWYgKCF0aGlzLiRpbml0ZWQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuJGlucHV0LnNldEF0dHJpYnV0ZShuYW1lLCB2YWx1ZSk7XG4gICAgfVxuICAgIGdldCAkcmVzdHJpY3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRyZXN0cmljdFN0cmluZztcbiAgICB9XG4gICAgc2V0ICRyZXN0cmljdCh2KSB7XG4gICAgICAgIHRoaXMuJHJlc3RyaWN0U3RyaW5nID0gdjtcbiAgICAgICAgaWYgKHRoaXMuJHJlc3RyaWN0U3RyaW5nICE9IG51bGwgJiYgdGhpcy4kcmVzdHJpY3RTdHJpbmcubGVuZ3RoID4gMClcbiAgICAgICAgICAgIHRoaXMuJHJlc3RyaWN0UmVnZXggPSBuZXcgUmVnRXhwKHRoaXMuJHJlc3RyaWN0U3RyaW5nKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kcmVzdHJpY3RSZWdleCA9IG51bGw7XG4gICAgfVxuICAgIGdldCB0eXBlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kdHlwZTtcbiAgICB9XG4gICAgc2V0IHR5cGUodikge1xuICAgICAgICBpZiAodiAhPSB0aGlzLiR0eXBlKVxuICAgICAgICAgICAgdGhpcy4kdHlwZSA9IHY7XG4gICAgfVxuICAgIHRyeUhpZGVJbnB1dCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLiR0ZXh0RmllbGQudmlzaWJsZSAmJiB0aGlzLiRpbnB1dClcbiAgICAgICAgICAgIHRoaXMuJGlucHV0LiRyZW1vdmVGcm9tU3RhZ2UoKTtcbiAgICB9XG4gICAgLyoqQGludGVybmFsICovXG4gICAgJHVwZGF0ZVByb3BlcnRpZXMoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRm9jdXNlZCkge1xuICAgICAgICAgICAgdGhpcy4kaW5wdXQucmVzZXRJbnB1dCgpO1xuICAgICAgICAgICAgdGhpcy50cnlIaWRlSW5wdXQoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiRpbnB1dC50ZXh0ID0gdGhpcy4kdGV4dEZpZWxkLnRleHQ7XG4gICAgICAgIHRoaXMuJGlucHV0LnJlc2V0SW5wdXQoKTtcbiAgICAgICAgdGhpcy50cnlIaWRlSW5wdXQoKTtcbiAgICB9XG4gICAgLyoqQGludGVybmFsICovXG4gICAgJG9uRm9jdXMoKSB7XG4gICAgICAgIGlmICghdGhpcy4kdGV4dEZpZWxkLnZpc2libGUgfHwgdGhpcy4kZm9jdXNlZClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgR1Jvb3QuaW5zdC5vZmYoSW50ZXJhY3RpdmVFdmVudHMuRG93biwgdGhpcy5vblN0YWdlRG93bik7XG4gICAgICAgIEdUaW1lci5pbnN0LmNhbGxMYXRlcigoKSA9PiB7XG4gICAgICAgICAgICBHUm9vdC5pbnN0Lm9uKEludGVyYWN0aXZlRXZlbnRzLkRvd24sIHRoaXMub25TdGFnZURvd24sIHRoaXMpO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgdGhpcy4kaW5wdXQuJHNob3coKTtcbiAgICB9XG59XG5cbmNsYXNzIEdUZXh0SW5wdXQgZXh0ZW5kcyBHVGV4dEZpZWxkIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy4kdXRpbCA9IG51bGw7XG4gICAgICAgIC8qKkBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLiRpc1R5cGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZvY3VzYWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMuZWRpdGFibGUgPSB0cnVlOyAvL2luaXRcbiAgICAgICAgdGhpcy50eXBlID0gXCJ0ZXh0XCIgLyogVEVYVCAqLztcbiAgICAgICAgdGhpcy5vbigncmVtb3ZlZCcsIHRoaXMucmVtb3ZlZCwgdGhpcyk7XG4gICAgICAgIHRoaXMub24oJ2FkZGVkJywgdGhpcy5hZGRlZCwgdGhpcyk7XG4gICAgICAgIHRoaXMuJHV0aWwuaW5pdGlhbGl6ZSgpO1xuICAgIH1cbiAgICBjcmVhdGVEaXNwbGF5T2JqZWN0KCkge1xuICAgICAgICBzdXBlci5jcmVhdGVEaXNwbGF5T2JqZWN0KCk7XG4gICAgICAgIHRoaXMuJGhpdEFyZWEgPSBuZXcgY3JlYXRlanMuU2hhcGUoKTtcbiAgICAgICAgdGhpcy4kaGl0QXJlYS5ncmFwaGljcy5iZWdpbkZpbGwoJyMwMDAnKS5kcmF3UmVjdCgwLCAwLCB0aGlzLiR3aWR0aCwgdGhpcy4kaGVpZ2h0KTtcbiAgICAgICAgdGhpcy4kZGlzcGxheU9iamVjdC5oaXRBcmVhID0gdGhpcy4kaGl0QXJlYTtcbiAgICB9XG4gICAgaGFuZGxlU2l6ZUNoYW5nZWQoKSB7XG4gICAgICAgIHN1cGVyLmhhbmRsZVNpemVDaGFuZ2VkKCk7XG4gICAgICAgIHRoaXMuJGhpdEFyZWEuZ3JhcGhpY3MuZHJhd1JlY3QoMCwgMCwgdGhpcy4kd2lkdGgsIHRoaXMuJGhlaWdodCk7XG4gICAgICAgIHRoaXMuJGRpc3BsYXlPYmplY3QuaGl0QXJlYSA9IHRoaXMuJGhpdEFyZWE7XG4gICAgfVxuICAgIHJlbW92ZWQoZGlzcCkge1xuICAgICAgICBpZiAodGhpcy4kdXRpbClcbiAgICAgICAgICAgIHRoaXMuJHV0aWwuZGVzdHJveSgpO1xuICAgIH1cbiAgICBhZGRlZChkaXNwKSB7XG4gICAgICAgIGlmICh0aGlzLiR1dGlsKVxuICAgICAgICAgICAgdGhpcy4kdXRpbC5pbml0aWFsaXplKCk7XG4gICAgfVxuICAgIHJlcXVlc3RGb2N1cygpIHtcbiAgICAgICAgLy90YWIgb3IgY2FsbCBhY3RpdmVseVxuICAgICAgICBEZWNscyQxLkdSb290Lmluc3QuZm9jdXMgPSB0aGlzO1xuICAgICAgICB0aGlzLiR1dGlsLiRvbkZvY3VzKCk7XG4gICAgfVxuICAgIGdldCBlZGl0YWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGVkaXRhYmxlO1xuICAgIH1cbiAgICBzZXQgZWRpdGFibGUodikge1xuICAgICAgICBpZiAodiAhPSB0aGlzLiRlZGl0YWJsZSkge1xuICAgICAgICAgICAgdGhpcy4kZWRpdGFibGUgPSB2O1xuICAgICAgICAgICAgaWYgKHRoaXMuJGVkaXRhYmxlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLiR1dGlsKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiR1dGlsID0gbmV3IElucHV0RGVsZWdhdGUodGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy4kdXRpbC5pbml0aWFsaXplKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kdXRpbClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kdXRpbC5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnRvdWNoYWJsZSA9IHRoaXMuJGVkaXRhYmxlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNoYW5nZVRvUGFzc1RleHQodGV4dCkge1xuICAgICAgICBsZXQgcGFzc1RleHQgPSAnJztcbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIG51bSA9IHRleHQubGVuZ3RoOyBpIDwgbnVtOyBpKyspIHtcbiAgICAgICAgICAgIHN3aXRjaCAodGV4dC5jaGFyQXQoaSkpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdcXG4nOlxuICAgICAgICAgICAgICAgICAgICBwYXNzVGV4dCArPSAnXFxuJztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnXFxyJzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgcGFzc1RleHQgKz0gJyonO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXNzVGV4dDtcbiAgICB9XG4gICAgZ2V0VGV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHV0aWwudGV4dDtcbiAgICB9XG4gICAgc2V0VGV4dCh2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgPT0gbnVsbClcbiAgICAgICAgICAgIHZhbHVlID0gJyc7XG4gICAgICAgIGlmICh0aGlzLiR0ZXh0ID09IHZhbHVlKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLiR1dGlsLnRleHQgPSB2YWx1ZTtcbiAgICAgICAgc3VwZXIuc2V0VGV4dCh2YWx1ZSk7XG4gICAgfVxuICAgIHNldENvbG9yKHZhbHVlKSB7XG4gICAgICAgIHN1cGVyLnNldENvbG9yKHZhbHVlKTtcbiAgICAgICAgdGhpcy4kdXRpbC5zZXRDb2xvcih2YWx1ZSk7XG4gICAgfVxuICAgIGdldCBwcm9tcHRUZXh0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kdXRpbC4kZ2V0UHJvcGVydHkoJ3BsYWNlaG9sZGVyJyk7XG4gICAgfVxuICAgIHNldCBwcm9tcHRUZXh0KHYpIHtcbiAgICAgICAgaWYgKHYgPT0gbnVsbClcbiAgICAgICAgICAgIHYgPSAnJztcbiAgICAgICAgdGhpcy4kdXRpbC4kc2V0UHJvcGVydHkoJ3BsYWNlaG9sZGVyJywgdik7XG4gICAgfVxuICAgIGdldCBtYXhMZW5ndGgoKSB7XG4gICAgICAgIHJldHVybiBwYXJzZUludCh0aGlzLiR1dGlsLiRnZXRQcm9wZXJ0eSgnbWF4bGVuZ3RoJykpIHx8IDA7XG4gICAgfVxuICAgIHNldCBtYXhMZW5ndGgodikge1xuICAgICAgICB0aGlzLiR1dGlsLiRzZXRQcm9wZXJ0eSgnbWF4bGVuZ3RoJywgU3RyaW5nKHYpKTtcbiAgICB9XG4gICAgZ2V0IHJlc3RyaWN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kdXRpbC4kcmVzdHJpY3Q7XG4gICAgfVxuICAgIHNldCByZXN0cmljdCh2KSB7XG4gICAgICAgIHRoaXMuJHV0aWwuJHJlc3RyaWN0ID0gdjtcbiAgICB9XG4gICAgZ2V0IHBhc3N3b3JkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50eXBlID09IFwicGFzc3dvcmRcIiAvKiBQQVNTV09SRCAqLztcbiAgICB9XG4gICAgc2V0IHBhc3N3b3JkKHYpIHtcbiAgICAgICAgdGhpcy50eXBlID0gXCJwYXNzd29yZFwiIC8qIFBBU1NXT1JEICovO1xuICAgIH1cbiAgICBnZXQgdHlwZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHV0aWwudHlwZTtcbiAgICB9XG4gICAgc2V0IHR5cGUodCkge1xuICAgICAgICB0aGlzLiR1dGlsLnR5cGUgPSB0O1xuICAgIH1cbiAgICBkaXNwb3NlKCkge1xuICAgICAgICBzdXBlci5kaXNwb3NlKCk7XG4gICAgICAgIHRoaXMub2ZmKCdyZW1vdmVkJywgdGhpcy5yZW1vdmVkKTtcbiAgICAgICAgdGhpcy5vZmYoJ2FkZGVkJywgdGhpcy5hZGRlZCk7XG4gICAgICAgIHRoaXMuJHV0aWwuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLiR1dGlsID0gbnVsbDtcbiAgICB9XG4gICAgcmVuZGVyTm93KHVwZGF0ZUJvdW5kcyA9IHRydWUpIHtcbiAgICAgICAgdGhpcy4kcmVxdWlyZVJlbmRlciA9IGZhbHNlO1xuICAgICAgICB0aGlzLiRzaXplRGlydHkgPSBmYWxzZTtcbiAgICAgICAgdGhpcy4kdXRpbC4kdXBkYXRlUHJvcGVydGllcygpO1xuICAgICAgICBpZiAodGhpcy4kaXNUeXBpbmcpXG4gICAgICAgICAgICB0aGlzLmRlY29yYXRlSW5wdXRib3goKTtcbiAgICAgICAgbGV0IG9yaWdUZXh0ID0gdGhpcy4kdGV4dDtcbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PSBcInBhc3N3b3JkXCIgLyogUEFTU1dPUkQgKi8pXG4gICAgICAgICAgICB0aGlzLiR0ZXh0ID0gdGhpcy5jaGFuZ2VUb1Bhc3NUZXh0KHRoaXMuJHRleHQpO1xuICAgICAgICBzdXBlci5yZW5kZXJOb3codXBkYXRlQm91bmRzKTtcbiAgICAgICAgdGhpcy4kdGV4dCA9IG9yaWdUZXh0O1xuICAgIH1cbiAgICBkZWNvcmF0ZUlucHV0Ym94KCkge1xuICAgICAgICAvL2RyYXcgdW5kZXJsaW5lcz9cbiAgICB9XG4gICAgc2V0dXBCZWZvcmVBZGQoeG1sKSB7XG4gICAgICAgIHN1cGVyLnNldHVwQmVmb3JlQWRkKHhtbCk7XG4gICAgICAgIC8vdGhpcy5wcm9tcHRUZXh0ID0geG1sLmF0dHJpYnV0ZXMucHJvbXB0OyAgLy90aGlzIHdpbGwgYmUgYXZhaWxhYmxlIG9uY2UgVUJCIGhhcyBpbXBsZW1lbnRlZC5cbiAgICAgICAgdmFyIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLm1heExlbmd0aDtcbiAgICAgICAgaWYgKHN0ciAhPSBudWxsKVxuICAgICAgICAgICAgdGhpcy5tYXhMZW5ndGggPSBwYXJzZUludChzdHIpO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5yZXN0cmljdDtcbiAgICAgICAgaWYgKHN0ciAhPSBudWxsKVxuICAgICAgICAgICAgdGhpcy5yZXN0cmljdCA9IHN0cjtcbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMucGFzc3dvcmQ7XG4gICAgICAgIGlmIChzdHIgPT0gJ3RydWUnKVxuICAgICAgICAgICAgdGhpcy5wYXNzd29yZCA9IHRydWU7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMua2V5Ym9hcmRUeXBlO1xuICAgICAgICAgICAgaWYgKHN0ciA9PSAnNCcpXG4gICAgICAgICAgICAgICAgdGhpcy50eXBlID0gXCJudW1iZXJcIiAvKiBOVU1CRVIgKi87XG4gICAgICAgICAgICBlbHNlIGlmIChzdHIgPT0gJzMnKVxuICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9IFwidXJsXCIgLyogVVJMICovO1xuICAgICAgICAgICAgZWxzZSBpZiAoc3RyID09ICc1JylcbiAgICAgICAgICAgICAgICB0aGlzLnR5cGUgPSBcInRlbFwiIC8qIFRFTCAqLztcbiAgICAgICAgICAgIGVsc2UgaWYgKHN0ciA9PSAnNicpXG4gICAgICAgICAgICAgICAgdGhpcy50eXBlID0gXCJlbWFpbFwiIC8qIEVNQUlMICovO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5jbGFzcyBSZWN5Y2xlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuJGNvdW50ID0gMDtcbiAgICAgICAgdGhpcy4kcG9vbCA9IHt9O1xuICAgIH1cbiAgICBnZXQgY291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRjb3VudDtcbiAgICB9XG4gICAgY2xlYXIoKSB7XG4gICAgICAgIGZvciAobGV0IGtleSBpbiB0aGlzLiRwb29sKSB7XG4gICAgICAgICAgICBsZXQgYXJyID0gdGhpcy4kcG9vbFtrZXldO1xuICAgICAgICAgICAgaWYgKGFycikge1xuICAgICAgICAgICAgICAgIGFyci5sZW5ndGggPSAwO1xuICAgICAgICAgICAgICAgIGFyciA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kcG9vbCA9IHt9O1xuICAgICAgICB0aGlzLiRjb3VudCA9IDA7XG4gICAgfVxuICAgIGdldChpZCkge1xuICAgICAgICBsZXQgYXJyID0gdGhpcy4kcG9vbFtpZF07XG4gICAgICAgIGlmIChhcnIgPT0gbnVsbCkge1xuICAgICAgICAgICAgYXJyID0gW107XG4gICAgICAgICAgICB0aGlzLiRwb29sW2lkXSA9IGFycjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYXJyLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy4kY291bnQtLTtcbiAgICAgICAgICAgIHJldHVybiBhcnIuc2hpZnQoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVPYmplY3QoaWQpO1xuICAgIH1cbiAgICByZWN5Y2xlKGlkLCBvYmopIHtcbiAgICAgICAgaWYgKCFpZClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbGV0IGFyciA9IHRoaXMuJHBvb2xbaWRdO1xuICAgICAgICBpZiAoYXJyID09IG51bGwpIHtcbiAgICAgICAgICAgIGFyciA9IFtdO1xuICAgICAgICAgICAgdGhpcy4kcG9vbFtpZF0gPSBhcnI7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kY291bnQrKztcbiAgICAgICAgYXJyLnB1c2gob2JqKTtcbiAgICB9XG59XG5cbmNsYXNzIEdPYmplY3RSZWN5Y2xlciBleHRlbmRzIFJlY3ljbGVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICB9XG4gICAgY2xlYXIoKSB7XG4gICAgICAgIGZvciAobGV0IGtleSBpbiB0aGlzLiRwb29sKSB7XG4gICAgICAgICAgICBsZXQgYXJyID0gdGhpcy4kcG9vbFtrZXldO1xuICAgICAgICAgICAgaWYgKGFycikge1xuICAgICAgICAgICAgICAgIGFyci5mb3JFYWNoKCh2KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHYuZGlzcG9zZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHN1cGVyLmNsZWFyKCk7XG4gICAgfVxuICAgIGNyZWF0ZU9iamVjdChpZCkge1xuICAgICAgICByZXR1cm4gVUlQYWNrYWdlLmNyZWF0ZU9iamVjdEZyb21VUkwoaWQpOyAvL2lkID0gdXJsXG4gICAgfVxufVxuXG5jbGFzcyBHTG9hZGVyIGV4dGVuZHMgR09iamVjdCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuJGZyYW1lID0gMDtcbiAgICAgICAgdGhpcy4kY29sb3IgPSAnI2ZmZic7XG4gICAgICAgIHRoaXMuJGNvbnRlbnRTb3VyY2VXaWR0aCA9IDA7XG4gICAgICAgIHRoaXMuJGNvbnRlbnRTb3VyY2VIZWlnaHQgPSAwO1xuICAgICAgICB0aGlzLiRjb250ZW50V2lkdGggPSAwO1xuICAgICAgICB0aGlzLiRjb250ZW50SGVpZ2h0ID0gMDtcbiAgICAgICAgdGhpcy4kbG9hZGluZ1RleHR1cmUgPSBudWxsO1xuICAgICAgICB0aGlzLiRwbGF5aW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy4kdXJsID0gJyc7XG4gICAgICAgIHRoaXMuJGZpbGwgPSAwIC8qIE5vbmUgKi87XG4gICAgICAgIHRoaXMuJGFsaWduID0gXCJsZWZ0XCIgLyogTGVmdCAqLztcbiAgICAgICAgdGhpcy4kdmVydGljYWxBbGlnbiA9IDAgLyogVG9wICovO1xuICAgICAgICB0aGlzLiRzaG93RXJyb3JTaWduID0gdHJ1ZTtcbiAgICAgICAgdGhpcy4kY29sb3IgPSAnI2ZmZic7XG4gICAgfVxuICAgIGNyZWF0ZURpc3BsYXlPYmplY3QoKSB7XG4gICAgICAgIHRoaXMuJGNvbnRhaW5lciA9IG5ldyBVSUNvbnRhaW5lcih0aGlzKTtcbiAgICAgICAgdGhpcy4kaGl0QXJlYSA9IG5ldyBjcmVhdGVqcy5TaGFwZSgpO1xuICAgICAgICB0aGlzLiRoaXRBcmVhLmdyYXBoaWNzLmJlZ2luRmlsbCgnIzAwMCcpLmRyYXdSZWN0KDAsIDAsIDAsIDApO1xuICAgICAgICB0aGlzLiRjb250YWluZXIuaGl0QXJlYSA9IHRoaXMuJGhpdEFyZWE7XG4gICAgICAgIHRoaXMuc2V0RGlzcGxheU9iamVjdCh0aGlzLiRjb250YWluZXIpO1xuICAgICAgICAvLyB0aGlzLiRjb250YWluZXIubW91c2VDaGlsZHJlbiA9IGZhbHNlXG4gICAgfVxuICAgIGRpc3Bvc2UoKSB7XG4gICAgICAgIHRoaXMuY2xlYXJDb250ZW50KCk7XG4gICAgICAgIHN1cGVyLmRpc3Bvc2UoKTtcbiAgICB9XG4gICAgZ2V0IHVybCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHVybDtcbiAgICB9XG4gICAgc2V0IHVybCh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kdXJsID09IHZhbHVlKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLiR1cmwgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5sb2FkQ29udGVudCgpO1xuICAgICAgICB0aGlzLnVwZGF0ZUdlYXIoNyAvKiBJY29uICovKTtcbiAgICB9XG4gICAgZ2V0IGljb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR1cmw7XG4gICAgfVxuICAgIHNldCBpY29uKHZhbHVlKSB7XG4gICAgICAgIHRoaXMudXJsID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCBhbGlnbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGFsaWduO1xuICAgIH1cbiAgICBzZXQgYWxpZ24odmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJGFsaWduICE9IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiRhbGlnbiA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVMYXlvdXQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgdmVydGljYWxBbGlnbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHZlcnRpY2FsQWxpZ247XG4gICAgfVxuICAgIHNldCB2ZXJ0aWNhbEFsaWduKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiR2ZXJ0aWNhbEFsaWduICE9IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiR2ZXJ0aWNhbEFsaWduID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUxheW91dCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBmaWxsKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kZmlsbDtcbiAgICB9XG4gICAgc2V0IGZpbGwodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJGZpbGwgIT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuJGZpbGwgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlTGF5b3V0KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGF1dG9TaXplKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kYXV0b1NpemU7XG4gICAgfVxuICAgIHNldCBhdXRvU2l6ZSh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kYXV0b1NpemUgIT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuJGF1dG9TaXplID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUxheW91dCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBwbGF5aW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kcGxheWluZztcbiAgICB9XG4gICAgc2V0IHBsYXlpbmcodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJHBsYXlpbmcgIT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuJHBsYXlpbmcgPSB2YWx1ZTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRjb250ZW50IGluc3RhbmNlb2YgTW92aWVDbGlwKVxuICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRlbnQucGxheWluZyA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVHZWFyKDUgLyogQW5pbWF0aW9uICovKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgZnJhbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRmcmFtZTtcbiAgICB9XG4gICAgc2V0IGZyYW1lKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiRmcmFtZSAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kZnJhbWUgPSB2YWx1ZTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRjb250ZW50IGluc3RhbmNlb2YgTW92aWVDbGlwKVxuICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRlbnQuY3VycmVudEZyYW1lID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUdlYXIoNSAvKiBBbmltYXRpb24gKi8pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBjb2xvcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGNvbG9yO1xuICAgIH1cbiAgICBzZXQgY29sb3IodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJGNvbG9yICE9IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiRjb2xvciA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVHZWFyKDQgLyogQ29sb3IgKi8pO1xuICAgICAgICAgICAgdGhpcy5hcHBseUNvbG9yKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXBwbHlDb2xvcigpIHtcbiAgICAgICAgaWYgKHRoaXMuJGNvbnRlbnQpXG4gICAgICAgICAgICB0aGlzLiRjb250ZW50LnRpbnQgPSB0aGlzLiRjb2xvcjtcbiAgICB9XG4gICAgZ2V0IHNob3dFcnJvclNpZ24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRzaG93RXJyb3JTaWduO1xuICAgIH1cbiAgICBzZXQgc2hvd0Vycm9yU2lnbih2YWx1ZSkge1xuICAgICAgICB0aGlzLiRzaG93RXJyb3JTaWduID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCBjb250ZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kY29udGVudDtcbiAgICB9XG4gICAgZ2V0IHRleHR1cmUoKSB7XG4gICAgICAgIGlmICh0aGlzLiRjb250ZW50IGluc3RhbmNlb2YgVUlJbWFnZSlcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiRjb250ZW50LnRleHR1cmU7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBzZXQgdGV4dHVyZSh2YWx1ZSkge1xuICAgICAgICB0aGlzLnVybCA9IG51bGw7XG4gICAgICAgIHRoaXMuc3dpdGNoVG9Nb3ZpZU1vZGUoZmFsc2UpO1xuICAgICAgICBpZiAodGhpcy4kY29udGVudCBpbnN0YW5jZW9mIFVJSW1hZ2UpXG4gICAgICAgICAgICB0aGlzLiRjb250ZW50LnRleHR1cmUgPSB2YWx1ZTtcbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiRjb250ZW50U291cmNlV2lkdGggPSB2YWx1ZS53aWR0aDtcbiAgICAgICAgICAgIHRoaXMuJGNvbnRlbnRTb3VyY2VIZWlnaHQgPSB2YWx1ZS5oZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kY29udGVudFNvdXJjZVdpZHRoID0gdGhpcy4kY29udGVudEhlaWdodCA9IDA7XG4gICAgICAgIHRoaXMudXBkYXRlTGF5b3V0KCk7XG4gICAgfVxuICAgIGxvYWRDb250ZW50KCkge1xuICAgICAgICB0aGlzLmNsZWFyQ29udGVudCgpO1xuICAgICAgICBpZiAoIXRoaXMuJHVybClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKFN0cmluZ1V0aWwuc3RhcnRzV2l0aCh0aGlzLiR1cmwsICd1aTovLycpKVxuICAgICAgICAgICAgdGhpcy5sb2FkRnJvbVBhY2thZ2UodGhpcy4kdXJsKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy5sb2FkRXh0ZXJuYWwoKTtcbiAgICB9XG4gICAgbG9hZEZyb21QYWNrYWdlKGl0ZW1VUkwpIHtcbiAgICAgICAgdGhpcy4kY29udGVudEl0ZW0gPSBVSVBhY2thZ2UuZ2V0SXRlbUJ5VVJMKGl0ZW1VUkwpO1xuICAgICAgICBpZiAodGhpcy4kY29udGVudEl0ZW0pIHtcbiAgICAgICAgICAgIHRoaXMuJGNvbnRlbnRJdGVtLmxvYWQoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRjb250ZW50SXRlbS50eXBlID09IDAgLyogSW1hZ2UgKi8pIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kY29udGVudEl0ZW0udGV4dHVyZSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RXJyb3JTdGF0ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zd2l0Y2hUb01vdmllTW9kZShmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRlbnQuJGluaXREaXNwKHRoaXMuJGNvbnRlbnRJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kY29udGVudFNvdXJjZVdpZHRoID0gdGhpcy4kY29udGVudEl0ZW0ud2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRlbnRTb3VyY2VIZWlnaHQgPSB0aGlzLiRjb250ZW50SXRlbS5oZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTGF5b3V0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy4kY29udGVudEl0ZW0udHlwZSA9PSAyIC8qIE1vdmllQ2xpcCAqLykge1xuICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoVG9Nb3ZpZU1vZGUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGVudFNvdXJjZVdpZHRoID0gdGhpcy4kY29udGVudEl0ZW0ud2lkdGg7XG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGVudFNvdXJjZUhlaWdodCA9IHRoaXMuJGNvbnRlbnRJdGVtLmhlaWdodDtcbiAgICAgICAgICAgICAgICBsZXQgbWMgPSB0aGlzLiRjb250ZW50O1xuICAgICAgICAgICAgICAgIG1jLmludGVydmFsID0gdGhpcy4kY29udGVudEl0ZW0uaW50ZXJ2YWw7XG4gICAgICAgICAgICAgICAgbWMuc3dpbmcgPSB0aGlzLiRjb250ZW50SXRlbS5zd2luZztcbiAgICAgICAgICAgICAgICBtYy5yZXBlYXREZWxheSA9IHRoaXMuJGNvbnRlbnRJdGVtLnJlcGVhdERlbGF5O1xuICAgICAgICAgICAgICAgIG1jLmZyYW1lcyA9IHRoaXMuJGNvbnRlbnRJdGVtLmZyYW1lcztcbiAgICAgICAgICAgICAgICBtYy5ib3VuZHNSZWN0ID0gbmV3IGNyZWF0ZWpzLlJlY3RhbmdsZSgwLCAwLCB0aGlzLiRjb250ZW50U291cmNlV2lkdGgsIHRoaXMuJGNvbnRlbnRTb3VyY2VIZWlnaHQpO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTGF5b3V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRFcnJvclN0YXRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy5zZXRFcnJvclN0YXRlKCk7XG4gICAgfVxuICAgIHN3aXRjaFRvTW92aWVNb2RlKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuJGNvbnRhaW5lci5yZW1vdmVBbGxDaGlsZHJlbigpO1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghKHRoaXMuJGNvbnRlbnQgaW5zdGFuY2VvZiBNb3ZpZUNsaXApKVxuICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRlbnQgPSBuZXcgTW92aWVDbGlwKHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKCEodGhpcy4kY29udGVudCBpbnN0YW5jZW9mIFVJSW1hZ2UpKVxuICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRlbnQgPSBuZXcgVUlJbWFnZShudWxsKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiRjb250YWluZXIuYWRkQ2hpbGQodGhpcy4kY29udGVudCk7XG4gICAgfVxuICAgIC8qKm92ZXJ3cml0ZSB0aGlzIG1ldGhvZCBpZiB5b3UgbmVlZCB0byBsb2FkIHJlc291cmNlcyBieSB5b3VyIG93biB3YXkqL1xuICAgIGxvYWRFeHRlcm5hbCgpIHtcbiAgICAgICAgLy8gbGV0IHRleHR1cmUgPSBCaXRtYXAuZnJvbUltYWdlKHRoaXMuJHVybCwgdHJ1ZSk7XG4gICAgICAgIGxldCB0ZXh0dXJlID0gbmV3IEJpdG1hcCgpO1xuICAgICAgICB0aGlzLiRsb2FkaW5nVGV4dHVyZSA9IHRleHR1cmU7XG4gICAgICAgIC8vVE9ETzogVGV4dHVyZSBkb2VzIG5vdCBoYXZlIGVycm9yIGV2ZW50Li4uIG1vbml0b3IgZXJyb3IgZXZlbnQgb24gYmFzZVRleHR1cmUgd2lsbCBjYXN1ZSBjcm9zcy1lcnJvci1ldmVudCBwcm9ibGVtLlxuICAgICAgICAvLyB0ZXh0dXJlLm9uY2UoXCJ1cGRhdGVcIiwgKCkgPT4ge1xuICAgICAgICAvLyAgICAgaWYgKCF0ZXh0dXJlLndpZHRoIHx8ICF0ZXh0dXJlLmhlaWdodClcbiAgICAgICAgLy8gICAgICAgICB0aGlzLiRsb2FkUmVzQ29tcGxldGVkKG51bGwpO1xuICAgICAgICAvLyAgICAgZWxzZVxuICAgICAgICAvLyAgICAgICAgIHRoaXMuJGxvYWRSZXNDb21wbGV0ZWQodGV4dHVyZSk7XG4gICAgICAgIC8vIH0pO1xuICAgIH1cbiAgICAvKipmcmVlIHRoZSByZXNvdXJjZSB5b3UgbG9hZGVkICovXG4gICAgZnJlZUV4dGVybmFsKHRleHR1cmUpIHtcbiAgICAgICAgLy8gQml0bWFwLnJlbW92ZUZyb21DYWNoZSh0ZXh0dXJlKTtcbiAgICAgICAgLy8gdGV4dHVyZS5kZXN0cm95KHRleHR1cmUuYmFzZVRleHR1cmUgIT0gbnVsbCk7XG4gICAgfVxuICAgICRsb2FkUmVzQ29tcGxldGVkKHJlcykge1xuICAgICAgICBpZiAocmVzKVxuICAgICAgICAgICAgdGhpcy5vbkV4dGVybmFsTG9hZFN1Y2Nlc3MocmVzKTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm9uRXh0ZXJuYWxMb2FkRmFpbGVkKCk7XG4gICAgICAgICAgICAvLyB0aGlzLiRsb2FkaW5nVGV4dHVyZS5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcbiAgICAgICAgICAgIHRoaXMuZnJlZUV4dGVybmFsKHRoaXMuJGxvYWRpbmdUZXh0dXJlKTtcbiAgICAgICAgICAgIHRoaXMuJGxvYWRpbmdUZXh0dXJlID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiRsb2FkaW5nVGV4dHVyZSA9IG51bGw7XG4gICAgfVxuICAgIC8qKmNvbnRlbnQgbG9hZGVkICovXG4gICAgb25FeHRlcm5hbExvYWRTdWNjZXNzKHRleHR1cmUpIHtcbiAgICAgICAgdGhpcy4kY29udGFpbmVyLnJlbW92ZUFsbENoaWxkcmVuKCk7XG4gICAgICAgIGlmICghdGhpcy4kY29udGVudCB8fCAhKHRoaXMuJGNvbnRlbnQgaW5zdGFuY2VvZiBVSUltYWdlKSkge1xuICAgICAgICAgICAgdGhpcy4kY29udGVudCA9IG5ldyBVSUltYWdlKG51bGwpO1xuICAgICAgICAgICAgdGhpcy4kY29udGVudC4kaW5pdERpc3AoKTtcbiAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci5hZGRDaGlsZCh0aGlzLiRjb250ZW50KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLiRjb250YWluZXIuYWRkQ2hpbGQodGhpcy4kY29udGVudCk7XG4gICAgICAgIC8vYmFzZVRleHR1cmUgbG9hZGVkLCBzbyB1cGRhdGUgZnJhbWUgaW5mbyAgLy8gdG9kb1xuICAgICAgICB0aGlzLiRjb250ZW50LnRleHR1cmUgPSB0ZXh0dXJlLnRleHR1cmU7XG4gICAgICAgIHRoaXMuJGNvbnRlbnRTb3VyY2VXaWR0aCA9IHRleHR1cmUuc291cmNlUmVjdC53aWR0aDtcbiAgICAgICAgdGhpcy4kY29udGVudFNvdXJjZUhlaWdodCA9IHRleHR1cmUuc291cmNlUmVjdC5oZWlnaHQ7XG4gICAgICAgIHRoaXMudXBkYXRlTGF5b3V0KCk7XG4gICAgfVxuICAgIG9uRXh0ZXJuYWxMb2FkRmFpbGVkKCkge1xuICAgICAgICB0aGlzLnNldEVycm9yU3RhdGUoKTtcbiAgICB9XG4gICAgc2V0RXJyb3JTdGF0ZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLiRzaG93RXJyb3JTaWduKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAodGhpcy4kZXJyb3JTaWduID09IG51bGwpIHtcbiAgICAgICAgICAgIGlmIChVSUNvbmZpZy5sb2FkZXJFcnJvclNpZ24pIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRlcnJvclNpZ24gPSBHTG9hZGVyLiRlcnJvclNpZ25Qb29sLmdldChVSUNvbmZpZy5sb2FkZXJFcnJvclNpZ24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLiRlcnJvclNpZ24pIHtcbiAgICAgICAgICAgIHRoaXMuJGVycm9yU2lnbi53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgICAgICAgICB0aGlzLiRlcnJvclNpZ24uaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gICAgICAgICAgICB0aGlzLiRjb250YWluZXIuYWRkQ2hpbGQodGhpcy4kZXJyb3JTaWduLmRpc3BsYXlPYmplY3QpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNsZWFyRXJyb3JTdGF0ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuJGVycm9yU2lnbikge1xuICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnJlbW92ZUNoaWxkKHRoaXMuJGVycm9yU2lnbi5kaXNwbGF5T2JqZWN0KTtcbiAgICAgICAgICAgIEdMb2FkZXIuJGVycm9yU2lnblBvb2wucmVjeWNsZSh0aGlzLiRlcnJvclNpZ24ucmVzb3VyY2VVUkwsIHRoaXMuJGVycm9yU2lnbik7XG4gICAgICAgICAgICB0aGlzLiRlcnJvclNpZ24gPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZUxheW91dCgpIHtcbiAgICAgICAgaWYgKHRoaXMuJGNvbnRlbnQgPT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuJGF1dG9TaXplKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kdXBkYXRpbmdMYXlvdXQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U2l6ZSg1MCwgMzApO1xuICAgICAgICAgICAgICAgIHRoaXMuJHVwZGF0aW5nTGF5b3V0ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kY29udGVudC5zZXQoeyB4OiAwLCB5OiAwIH0pO1xuICAgICAgICB0aGlzLiRjb250ZW50LnNldCh7IHNjYWxlWDogMSwgc2NhbGVZOiAxIH0pO1xuICAgICAgICB0aGlzLiRjb250ZW50V2lkdGggPSB0aGlzLiRjb250ZW50U291cmNlV2lkdGg7XG4gICAgICAgIHRoaXMuJGNvbnRlbnRIZWlnaHQgPSB0aGlzLiRjb250ZW50U291cmNlSGVpZ2h0O1xuICAgICAgICBpZiAodGhpcy4kYXV0b1NpemUpIHtcbiAgICAgICAgICAgIHRoaXMuJHVwZGF0aW5nTGF5b3V0ID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRjb250ZW50V2lkdGggPT0gMClcbiAgICAgICAgICAgICAgICB0aGlzLiRjb250ZW50V2lkdGggPSA1MDtcbiAgICAgICAgICAgIGlmICh0aGlzLiRjb250ZW50SGVpZ2h0ID09IDApXG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGVudEhlaWdodCA9IDMwO1xuICAgICAgICAgICAgdGhpcy5zZXRTaXplKHRoaXMuJGNvbnRlbnRXaWR0aCwgdGhpcy4kY29udGVudEhlaWdodCk7XG4gICAgICAgICAgICB0aGlzLiR1cGRhdGluZ0xheW91dCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbGV0IHN4ID0gMSwgc3kgPSAxO1xuICAgICAgICAgICAgaWYgKHRoaXMuJGZpbGwgIT0gMCAvKiBOb25lICovKSB7XG4gICAgICAgICAgICAgICAgc3ggPSB0aGlzLndpZHRoIC8gdGhpcy4kY29udGVudFNvdXJjZVdpZHRoO1xuICAgICAgICAgICAgICAgIHN5ID0gdGhpcy5oZWlnaHQgLyB0aGlzLiRjb250ZW50U291cmNlSGVpZ2h0O1xuICAgICAgICAgICAgICAgIGlmIChzeCAhPSAxIHx8IHN5ICE9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJGZpbGwgPT0gMiAvKiBTY2FsZU1hdGNoSGVpZ2h0ICovKVxuICAgICAgICAgICAgICAgICAgICAgICAgc3ggPSBzeTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy4kZmlsbCA9PSAzIC8qIFNjYWxlTWF0Y2hXaWR0aCAqLylcbiAgICAgICAgICAgICAgICAgICAgICAgIHN5ID0gc3g7XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuJGZpbGwgPT0gMSAvKiBTY2FsZSAqLykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN4ID4gc3kpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ggPSBzeTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeSA9IHN4O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuJGZpbGwgPT0gNSAvKiBTY2FsZU5vQm9yZGVyICovKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3ggPiBzeSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeSA9IHN4O1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN4ID0gc3k7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kY29udGVudFdpZHRoID0gdGhpcy4kY29udGVudFNvdXJjZVdpZHRoICogc3g7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRlbnRIZWlnaHQgPSB0aGlzLiRjb250ZW50U291cmNlSGVpZ2h0ICogc3k7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuJGNvbnRlbnQgaW5zdGFuY2VvZiBVSUltYWdlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGVudC53aWR0aCA9IHRoaXMuJGNvbnRlbnRXaWR0aDtcbiAgICAgICAgICAgICAgICB0aGlzLiRjb250ZW50LmhlaWdodCA9IHRoaXMuJGNvbnRlbnRIZWlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGVudC5zZXQoeyBzY2FsZVg6IHN4LCBzY2FsZVk6IHN5IH0pO1xuICAgICAgICAgICAgaWYgKHRoaXMuJGFsaWduID09IFwiY2VudGVyXCIgLyogQ2VudGVyICovKVxuICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRlbnQueCA9IE1hdGguZmxvb3IoKHRoaXMud2lkdGggLSB0aGlzLiRjb250ZW50V2lkdGgpIC8gMik7XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLiRhbGlnbiA9PSBcInJpZ2h0XCIgLyogUmlnaHQgKi8pXG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGVudC54ID0gdGhpcy53aWR0aCAtIHRoaXMuJGNvbnRlbnRXaWR0aDtcbiAgICAgICAgICAgIGlmICh0aGlzLiR2ZXJ0aWNhbEFsaWduID09IDEgLyogTWlkZGxlICovKVxuICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRlbnQueSA9IE1hdGguZmxvb3IoKHRoaXMuaGVpZ2h0IC0gdGhpcy4kY29udGVudEhlaWdodCkgLyAyKTtcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuJHZlcnRpY2FsQWxpZ24gPT0gMiAvKiBCb3R0b20gKi8pXG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGVudC55ID0gdGhpcy5oZWlnaHQgLSB0aGlzLiRjb250ZW50SGVpZ2h0O1xuICAgICAgICB9XG4gICAgfVxuICAgIGNsZWFyQ29udGVudCgpIHtcbiAgICAgICAgdGhpcy5jbGVhckVycm9yU3RhdGUoKTtcbiAgICAgICAgaWYgKHRoaXMuJGNvbnRlbnQgJiYgdGhpcy4kY29udGVudC5wYXJlbnQpXG4gICAgICAgICAgICB0aGlzLiRjb250YWluZXIucmVtb3ZlQ2hpbGQodGhpcy4kY29udGVudCk7XG4gICAgICAgIGlmICh0aGlzLiRsb2FkaW5nVGV4dHVyZSkge1xuICAgICAgICAgICAgLy8gdGhpcy4kbG9hZGluZ1RleHR1cmUucmVtb3ZlQWxsTGlzdGVuZXJzKCk7Ly8gdG9kb1xuICAgICAgICAgICAgdGhpcy5mcmVlRXh0ZXJuYWwodGhpcy4kbG9hZGluZ1RleHR1cmUpO1xuICAgICAgICAgICAgdGhpcy4kbG9hZGluZ1RleHR1cmUgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIC8vIGlmICh0aGlzLiRjb250ZW50SXRlbSA9PSBudWxsICYmIHRoaXMuJGNvbnRlbnQgaW5zdGFuY2VvZiBVSUltYWdlKVxuICAgICAgICAvLyAgICAgdGhpcy5mcmVlRXh0ZXJuYWwodGhpcy4kY29udGVudC50ZXh0dXJlKTsgLy8gdG9kb1xuICAgICAgICB0aGlzLiRjb250ZW50ICYmIHRoaXMuJGNvbnRlbnQuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLiRjb250ZW50ID0gbnVsbDtcbiAgICAgICAgdGhpcy4kY29udGVudEl0ZW0gPSBudWxsO1xuICAgIH1cbiAgICBoYW5kbGVTaXplQ2hhbmdlZCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLiR1cGRhdGluZ0xheW91dClcbiAgICAgICAgICAgIHRoaXMudXBkYXRlTGF5b3V0KCk7XG4gICAgICAgIHRoaXMuJGhpdEFyZWEuZ3JhcGhpY3MuZHJhd1JlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgIH1cbiAgICBzZXR1cEJlZm9yZUFkZCh4bWwpIHtcbiAgICAgICAgc3VwZXIuc2V0dXBCZWZvcmVBZGQoeG1sKTtcbiAgICAgICAgbGV0IHN0cjtcbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMudXJsO1xuICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgdGhpcy4kdXJsID0gc3RyO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5hbGlnbjtcbiAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgIHRoaXMuJGFsaWduID0gUGFyc2VBbGlnblR5cGUoc3RyKTtcbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMudkFsaWduO1xuICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgdGhpcy4kdmVydGljYWxBbGlnbiA9IFBhcnNlVmVydEFsaWduVHlwZShzdHIpO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5maWxsO1xuICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgdGhpcy4kZmlsbCA9IFBhcnNlTG9hZGVyRmlsbFR5cGUoc3RyKTtcbiAgICAgICAgdGhpcy4kYXV0b1NpemUgPSB4bWwuYXR0cmlidXRlcy5hdXRvU2l6ZSA9PSAndHJ1ZSc7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmVycm9yU2lnbjtcbiAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgIHRoaXMuJHNob3dFcnJvclNpZ24gPSBzdHIgPT0gJ3RydWUnO1xuICAgICAgICB0aGlzLiRwbGF5aW5nID0geG1sLmF0dHJpYnV0ZXMucGxheWluZyAhPSAnZmFsc2UnO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5jb2xvcjtcbiAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgIHRoaXMuY29sb3IgPSBzdHI7XG4gICAgICAgIGlmICh0aGlzLiR1cmwpXG4gICAgICAgICAgICB0aGlzLmxvYWRDb250ZW50KCk7XG4gICAgfVxufVxuR0xvYWRlci4kZXJyb3JTaWduUG9vbCA9IG5ldyBHT2JqZWN0UmVjeWNsZXIoKTtcblxubGV0IGlzQ29sb3JhYmxlVGl0bGUgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgcmV0dXJuIG9iaiAmJiBcInRpdGxlQ29sb3JcIiBpbiBvYmogJiYgXCJmb250U2l6ZVwiIGluIG9iajtcbn07XG5cbmNsYXNzIEdMYWJlbCBleHRlbmRzIEdDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuICAgIH1cbiAgICBnZXQgaWNvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuJGljb25PYmplY3QgIT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiRpY29uT2JqZWN0Lmljb247XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBzZXQgaWNvbih2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kaWNvbk9iamVjdCAhPSBudWxsKVxuICAgICAgICAgICAgdGhpcy4kaWNvbk9iamVjdC5pY29uID0gdmFsdWU7XG4gICAgICAgIHRoaXMudXBkYXRlR2Vhcig3IC8qIEljb24gKi8pO1xuICAgIH1cbiAgICBnZXQgdGl0bGUoKSB7XG4gICAgICAgIGlmICh0aGlzLiR0aXRsZU9iamVjdClcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiR0aXRsZU9iamVjdC50ZXh0O1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgc2V0IHRpdGxlKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiR0aXRsZU9iamVjdClcbiAgICAgICAgICAgIHRoaXMuJHRpdGxlT2JqZWN0LnRleHQgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy51cGRhdGVHZWFyKDYgLyogVGV4dCAqLyk7XG4gICAgfVxuICAgIGdldCB0ZXh0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy50aXRsZTtcbiAgICB9XG4gICAgc2V0IHRleHQodmFsdWUpIHtcbiAgICAgICAgdGhpcy50aXRsZSA9IHZhbHVlO1xuICAgIH1cbiAgICBnZXQgdGl0bGVDb2xvcigpIHtcbiAgICAgICAgaWYgKGlzQ29sb3JhYmxlVGl0bGUodGhpcy4kdGl0bGVPYmplY3QpKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHRpdGxlT2JqZWN0LnRpdGxlQ29sb3I7XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9XG4gICAgc2V0IHRpdGxlQ29sb3IodmFsdWUpIHtcbiAgICAgICAgaWYgKGlzQ29sb3JhYmxlVGl0bGUodGhpcy4kdGl0bGVPYmplY3QpKVxuICAgICAgICAgICAgdGhpcy4kdGl0bGVPYmplY3QudGl0bGVDb2xvciA9IHZhbHVlO1xuICAgIH1cbiAgICBnZXQgZm9udFNpemUoKSB7XG4gICAgICAgIGlmIChpc0NvbG9yYWJsZVRpdGxlKHRoaXMuJHRpdGxlT2JqZWN0KSlcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiR0aXRsZU9iamVjdC5mb250U2l6ZTtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIHNldCBmb250U2l6ZSh2YWx1ZSkge1xuICAgICAgICBpZiAoaXNDb2xvcmFibGVUaXRsZSh0aGlzLiR0aXRsZU9iamVjdCkpXG4gICAgICAgICAgICB0aGlzLiR0aXRsZU9iamVjdC5mb250U2l6ZSA9IHZhbHVlO1xuICAgIH1cbiAgICBzZXQgZWRpdGFibGUodmFsKSB7XG4gICAgICAgIGlmICh0aGlzLiR0aXRsZU9iamVjdClcbiAgICAgICAgICAgIHRoaXMuJHRpdGxlT2JqZWN0LmVkaXRhYmxlID0gdmFsO1xuICAgIH1cbiAgICBnZXQgZWRpdGFibGUoKSB7XG4gICAgICAgIGlmICh0aGlzLiR0aXRsZU9iamVjdCAmJiB0aGlzLiR0aXRsZU9iamVjdCBpbnN0YW5jZW9mIEdUZXh0SW5wdXQpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kdGl0bGVPYmplY3QuZWRpdGFibGU7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3RydWN0RnJvbVhNTCh4bWwpIHtcbiAgICAgICAgc3VwZXIuY29uc3RydWN0RnJvbVhNTCh4bWwpO1xuICAgICAgICB0aGlzLiR0aXRsZU9iamVjdCA9IHRoaXMuZ2V0Q2hpbGQoJ3RpdGxlJyk7XG4gICAgICAgIHRoaXMuJGljb25PYmplY3QgPSB0aGlzLmdldENoaWxkKCdpY29uJyk7XG4gICAgfVxuICAgIHNldHVwQWZ0ZXJBZGQoeG1sKSB7XG4gICAgICAgIHN1cGVyLnNldHVwQWZ0ZXJBZGQoeG1sKTtcbiAgICAgICAgbGV0IGNzID0gWG1sUGFyc2VyLmdldENoaWxkTm9kZXMoeG1sLCAnTGFiZWwnKTtcbiAgICAgICAgaWYgKGNzICYmIGNzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHhtbCA9IGNzWzBdO1xuICAgICAgICAgICAgbGV0IHN0cjtcbiAgICAgICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnRpdGxlO1xuICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICB0aGlzLnRleHQgPSBzdHI7XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5pY29uO1xuICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICB0aGlzLmljb24gPSBzdHI7XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy50aXRsZUNvbG9yO1xuICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICB0aGlzLnRpdGxlQ29sb3IgPSBzdHI7XG4gICAgICAgICAgICBpZiAodGhpcy4kdGl0bGVPYmplY3QgaW5zdGFuY2VvZiBHVGV4dElucHV0KSB7XG4gICAgICAgICAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMucHJvbXB0O1xuICAgICAgICAgICAgICAgIGxldCB0aSA9IHRoaXMuJHRpdGxlT2JqZWN0O1xuICAgICAgICAgICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICAgICAgICAgIHRpLnByb21wdFRleHQgPSBzdHI7XG4gICAgICAgICAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMubWF4TGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICAgICAgICAgIHRpLm1heExlbmd0aCA9IHBhcnNlSW50KHN0cik7XG4gICAgICAgICAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMucmVzdHJpY3Q7XG4gICAgICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICAgICAgdGkucmVzdHJpY3QgPSBzdHI7XG4gICAgICAgICAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMucGFzc3dvcmQ7XG4gICAgICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICAgICAgdGkucGFzc3dvcmQgPSBzdHIgPT0gJ3RydWUnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5jbGFzcyBQYWdlT3B0aW9uIHtcbiAgICBzZXQgY29udHJvbGxlcih2YWwpIHtcbiAgICAgICAgdGhpcy4kY29udHJvbGxlciA9IHZhbDtcbiAgICB9XG4gICAgc2V0IG5hbWUocGFnZU5hbWUpIHtcbiAgICAgICAgdGhpcy4kaWQgPSB0aGlzLiRjb250cm9sbGVyLmdldFBhZ2VJZEJ5TmFtZShwYWdlTmFtZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICBpZiAodGhpcy4kaWQpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kY29udHJvbGxlci5nZXRQYWdlTmFtZUJ5SWQodGhpcy4kaWQpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgc2V0IGluZGV4KHBhZ2VJbmRleCkge1xuICAgICAgICB0aGlzLiRpZCA9IHRoaXMuJGNvbnRyb2xsZXIuZ2V0UGFnZUlkKHBhZ2VJbmRleCk7XG4gICAgfVxuICAgIGdldCBpbmRleCgpIHtcbiAgICAgICAgaWYgKHRoaXMuJGlkKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGNvbnRyb2xsZXIuZ2V0UGFnZUluZGV4QnlJZCh0aGlzLiRpZCk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgY2xlYXIoKSB7XG4gICAgICAgIHRoaXMuJGlkID0gbnVsbDtcbiAgICB9XG4gICAgc2V0IGlkKGlkKSB7XG4gICAgICAgIHRoaXMuJGlkID0gaWQ7XG4gICAgfVxuICAgIGdldCBpZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGlkO1xuICAgIH1cbn1cblxuY2xhc3MgR0J1dHRvbiBleHRlbmRzIEdDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLiRtb2RlID0gMCAvKiBDb21tb24gKi87XG4gICAgICAgIHRoaXMuJHRpdGxlID0gJyc7XG4gICAgICAgIHRoaXMuJGljb24gPSAnJztcbiAgICAgICAgdGhpcy4kc291bmQgPSBVSUNvbmZpZy5idXR0b25Tb3VuZDtcbiAgICAgICAgdGhpcy4kc291bmRWb2x1bWVTY2FsZSA9IFVJQ29uZmlnLmJ1dHRvblNvdW5kVm9sdW1lU2NhbGU7XG4gICAgICAgIHRoaXMuJHBhZ2VPcHRpb24gPSBuZXcgUGFnZU9wdGlvbigpO1xuICAgICAgICB0aGlzLiRjaGFuZ2VTdGF0ZU9uQ2xpY2sgPSB0cnVlO1xuICAgICAgICB0aGlzLiRkb3duRWZmZWN0ID0gMDtcbiAgICAgICAgdGhpcy4kZG93bkVmZmVjdFZhbHVlID0gMC44O1xuICAgICAgICB0aGlzLiRjb250YWluZXIuY3Vyc29yID0gJ3BvaW50ZXInO1xuICAgIH1cbiAgICBzZXREaXNwbGF5T2JqZWN0KHZhbHVlKSB7XG4gICAgICAgIHN1cGVyLnNldERpc3BsYXlPYmplY3QodmFsdWUpO1xuICAgICAgICAvLyB0aGlzLiRkaXNwbGF5T2JqZWN0LmJ1dHRvbk1vZGUgPSB0cnVlOyAvL3RvZG9cbiAgICB9XG4gICAgZ2V0IGljb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRpY29uO1xuICAgIH1cbiAgICBzZXQgaWNvbih2YWx1ZSkge1xuICAgICAgICB0aGlzLiRpY29uID0gdmFsdWU7XG4gICAgICAgIHZhbHVlID0gdGhpcy4kc2VsZWN0ZWQgJiYgdGhpcy4kc2VsZWN0ZWRJY29uID8gdGhpcy4kc2VsZWN0ZWRJY29uIDogdGhpcy4kaWNvbjtcbiAgICAgICAgaWYgKHRoaXMuJGljb25PYmplY3QgIT0gbnVsbClcbiAgICAgICAgICAgIHRoaXMuJGljb25PYmplY3QuaWNvbiA9IHZhbHVlO1xuICAgICAgICB0aGlzLnVwZGF0ZUdlYXIoNyAvKiBJY29uICovKTtcbiAgICB9XG4gICAgZ2V0IHNlbGVjdGVkSWNvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHNlbGVjdGVkSWNvbjtcbiAgICB9XG4gICAgc2V0IHNlbGVjdGVkSWNvbih2YWx1ZSkge1xuICAgICAgICB0aGlzLiRzZWxlY3RlZEljb24gPSB2YWx1ZTtcbiAgICAgICAgdmFsdWUgPSB0aGlzLiRzZWxlY3RlZCAmJiB0aGlzLiRzZWxlY3RlZEljb24gPyB0aGlzLiRzZWxlY3RlZEljb24gOiB0aGlzLiRpY29uO1xuICAgICAgICBpZiAodGhpcy4kaWNvbk9iamVjdCAhPSBudWxsKVxuICAgICAgICAgICAgdGhpcy4kaWNvbk9iamVjdC5pY29uID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCB0aXRsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHRpdGxlO1xuICAgIH1cbiAgICBzZXQgdGl0bGUodmFsdWUpIHtcbiAgICAgICAgdGhpcy4kdGl0bGUgPSB2YWx1ZTtcbiAgICAgICAgaWYgKHRoaXMuJHRpdGxlT2JqZWN0KVxuICAgICAgICAgICAgdGhpcy4kdGl0bGVPYmplY3QudGV4dCA9XG4gICAgICAgICAgICAgICAgdGhpcy4kc2VsZWN0ZWQgJiYgdGhpcy4kc2VsZWN0ZWRUaXRsZSA/IHRoaXMuJHNlbGVjdGVkVGl0bGUgOiB0aGlzLiR0aXRsZTtcbiAgICAgICAgdGhpcy51cGRhdGVHZWFyKDYgLyogVGV4dCAqLyk7XG4gICAgfVxuICAgIGdldCB0ZXh0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy50aXRsZTtcbiAgICB9XG4gICAgc2V0IHRleHQodmFsdWUpIHtcbiAgICAgICAgdGhpcy50aXRsZSA9IHZhbHVlO1xuICAgIH1cbiAgICBnZXQgc2VsZWN0ZWRUaXRsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHNlbGVjdGVkVGl0bGU7XG4gICAgfVxuICAgIHNldCBzZWxlY3RlZFRpdGxlKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuJHNlbGVjdGVkVGl0bGUgPSB2YWx1ZTtcbiAgICAgICAgaWYgKHRoaXMuJHRpdGxlT2JqZWN0KVxuICAgICAgICAgICAgdGhpcy4kdGl0bGVPYmplY3QudGV4dCA9XG4gICAgICAgICAgICAgICAgdGhpcy4kc2VsZWN0ZWQgJiYgdGhpcy4kc2VsZWN0ZWRUaXRsZSA/IHRoaXMuJHNlbGVjdGVkVGl0bGUgOiB0aGlzLiR0aXRsZTtcbiAgICB9XG4gICAgZ2V0IHRpdGxlQ29sb3IoKSB7XG4gICAgICAgIGlmIChpc0NvbG9yYWJsZVRpdGxlKHRoaXMuJHRpdGxlT2JqZWN0KSlcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiR0aXRsZU9iamVjdC50aXRsZUNvbG9yO1xuICAgIH1cbiAgICBzZXQgdGl0bGVDb2xvcih2YWx1ZSkge1xuICAgICAgICBpZiAoaXNDb2xvcmFibGVUaXRsZSh0aGlzLiR0aXRsZU9iamVjdCkpXG4gICAgICAgICAgICB0aGlzLiR0aXRsZU9iamVjdC50aXRsZUNvbG9yID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCBmb250U2l6ZSgpIHtcbiAgICAgICAgaWYgKGlzQ29sb3JhYmxlVGl0bGUodGhpcy4kdGl0bGVPYmplY3QpKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHRpdGxlT2JqZWN0LmZvbnRTaXplO1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgc2V0IGZvbnRTaXplKHZhbHVlKSB7XG4gICAgICAgIGlmIChpc0NvbG9yYWJsZVRpdGxlKHRoaXMuJHRpdGxlT2JqZWN0KSlcbiAgICAgICAgICAgIHRoaXMuJHRpdGxlT2JqZWN0LmZvbnRTaXplID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCBzb3VuZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHNvdW5kO1xuICAgIH1cbiAgICBzZXQgc291bmQodmFsKSB7XG4gICAgICAgIHRoaXMuJHNvdW5kID0gdmFsO1xuICAgIH1cbiAgICBnZXQgc291bmRWb2x1bWVTY2FsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHNvdW5kVm9sdW1lU2NhbGU7XG4gICAgfVxuICAgIHNldCBzb3VuZFZvbHVtZVNjYWxlKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuJHNvdW5kVm9sdW1lU2NhbGUgPSB2YWx1ZTtcbiAgICB9XG4gICAgc2V0IHNlbGVjdGVkKHZhbCkge1xuICAgICAgICBpZiAodGhpcy4kbW9kZSA9PSAwIC8qIENvbW1vbiAqLylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKHRoaXMuJHNlbGVjdGVkICE9IHZhbCkge1xuICAgICAgICAgICAgdGhpcy4kc2VsZWN0ZWQgPSB2YWw7XG4gICAgICAgICAgICBpZiAodGhpcy5ncmF5ZWQgJiZcbiAgICAgICAgICAgICAgICB0aGlzLiRidXR0b25Db250cm9sbGVyICYmXG4gICAgICAgICAgICAgICAgdGhpcy4kYnV0dG9uQ29udHJvbGxlci5oYXNQYWdlKEdCdXR0b24uRElTQUJMRUQpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJHNlbGVjdGVkKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKEdCdXR0b24uU0VMRUNURURfRElTQUJMRUQpO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZShHQnV0dG9uLkRJU0FCTEVEKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRzZWxlY3RlZClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh0aGlzLiRvdmVyID8gR0J1dHRvbi5TRUxFQ1RFRF9PVkVSIDogR0J1dHRvbi5ET1dOKTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUodGhpcy4kb3ZlciA/IEdCdXR0b24uT1ZFUiA6IEdCdXR0b24uVVApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuJHNlbGVjdGVkVGl0bGUgJiYgdGhpcy4kdGl0bGVPYmplY3QpXG4gICAgICAgICAgICAgICAgdGhpcy4kdGl0bGVPYmplY3QudGV4dCA9IHRoaXMuJHNlbGVjdGVkID8gdGhpcy4kc2VsZWN0ZWRUaXRsZSA6IHRoaXMuJHRpdGxlO1xuICAgICAgICAgICAgaWYgKHRoaXMuJHNlbGVjdGVkSWNvbikge1xuICAgICAgICAgICAgICAgIGxldCBzdHIgPSB0aGlzLiRzZWxlY3RlZCA/IHRoaXMuJHNlbGVjdGVkSWNvbiA6IHRoaXMuJGljb247XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJGljb25PYmplY3QgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kaWNvbk9iamVjdC5pY29uID0gc3RyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuJHJlbGF0ZWRDb250cm9sbGVyICYmIHRoaXMuJHBhcmVudCAmJiAhdGhpcy4kcGFyZW50LiRidWlsZGluZ0Rpc3BsYXlMaXN0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJHNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHJlbGF0ZWRDb250cm9sbGVyLnNlbGVjdGVkUGFnZUlkID0gdGhpcy4kcGFnZU9wdGlvbi5pZDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJlbGF0ZWRDb250cm9sbGVyLiRhdXRvUmFkaW9Hcm91cERlcHRoKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kcGFyZW50LmFkanVzdFJhZGlvR3JvdXBEZXB0aCh0aGlzLCB0aGlzLiRyZWxhdGVkQ29udHJvbGxlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuJG1vZGUgPT0gMSAvKiBDaGVjayAqLyAmJlxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRyZWxhdGVkQ29udHJvbGxlci5zZWxlY3RlZFBhZ2VJZCA9PSB0aGlzLiRwYWdlT3B0aW9uLmlkKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRyZWxhdGVkQ29udHJvbGxlci5vcHBvc2l0ZVBhZ2VJZCA9IHRoaXMuJHBhZ2VPcHRpb24uaWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHNlbGVjdGVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kc2VsZWN0ZWQ7XG4gICAgfVxuICAgIGdldCBtb2RlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kbW9kZTtcbiAgICB9XG4gICAgc2V0IG1vZGUodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJG1vZGUgIT0gdmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PSAwIC8qIENvbW1vbiAqLylcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLiRtb2RlID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHJlbGF0ZWRDb250cm9sbGVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kcmVsYXRlZENvbnRyb2xsZXI7XG4gICAgfVxuICAgIHNldCByZWxhdGVkQ29udHJvbGxlcih2YWwpIHtcbiAgICAgICAgaWYgKHZhbCAhPSB0aGlzLiRyZWxhdGVkQ29udHJvbGxlcikge1xuICAgICAgICAgICAgdGhpcy4kcmVsYXRlZENvbnRyb2xsZXIgPSB2YWw7XG4gICAgICAgICAgICB0aGlzLiRwYWdlT3B0aW9uLmNvbnRyb2xsZXIgPSB2YWw7XG4gICAgICAgICAgICB0aGlzLiRwYWdlT3B0aW9uLmNsZWFyKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHBhZ2VPcHRpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRwYWdlT3B0aW9uO1xuICAgIH1cbiAgICBnZXQgY2hhbmdlU3RhdGVPbkNsaWNrKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kY2hhbmdlU3RhdGVPbkNsaWNrO1xuICAgIH1cbiAgICBzZXQgY2hhbmdlU3RhdGVPbkNsaWNrKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuJGNoYW5nZVN0YXRlT25DbGljayA9IHZhbHVlO1xuICAgIH1cbiAgICBnZXQgbGlua2VkUG9wdXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRsaW5rZWRQb3B1cDtcbiAgICB9XG4gICAgc2V0IGxpbmtlZFBvcHVwKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuJGxpbmtlZFBvcHVwID0gdmFsdWU7XG4gICAgfVxuICAgIGFkZFN0YXRlTGlzdGVuZXIobGlzdGVuZXIsIHRoaXNPYmopIHtcbiAgICAgICAgdGhpcy5vbihcIl9fc3RhdGVDaGFuZ2VkXCIgLyogQ0hBTkdFRCAqLywgbGlzdGVuZXIsIHRoaXNPYmopO1xuICAgIH1cbiAgICByZW1vdmVTdGF0ZUxpc3RlbmVyKGxpc3RlbmVyKSB7XG4gICAgICAgIHRoaXMub2ZmKFwiX19zdGF0ZUNoYW5nZWRcIiAvKiBDSEFOR0VEICovLCBsaXN0ZW5lcik7XG4gICAgfVxuICAgIGZpcmVDbGljayhkb3duRWZmZWN0ID0gdHJ1ZSkge1xuICAgICAgICBpZiAoZG93bkVmZmVjdCAmJiB0aGlzLiRtb2RlID09IDAgLyogQ29tbW9uICovKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKEdCdXR0b24uT1ZFUik7XG4gICAgICAgICAgICBHVGltZXIuaW5zdC5hZGQoMTAwLCAxLCB0aGlzLnNldFN0YXRlLCB0aGlzLCBHQnV0dG9uLkRPV04pO1xuICAgICAgICAgICAgR1RpbWVyLmluc3QuYWRkKDIwMCwgMSwgdGhpcy5zZXRTdGF0ZSwgdGhpcywgR0J1dHRvbi5VUCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kY2xpY2sobnVsbCk7XG4gICAgfVxuICAgIHNldFN0YXRlKHZhbCkge1xuICAgICAgICBpZiAodGhpcy4kYnV0dG9uQ29udHJvbGxlcilcbiAgICAgICAgICAgIHRoaXMuJGJ1dHRvbkNvbnRyb2xsZXIuc2VsZWN0ZWRQYWdlID0gdmFsO1xuICAgICAgICBpZiAodGhpcy4kZG93bkVmZmVjdCA9PSAxKSB7XG4gICAgICAgICAgICBpZiAodmFsID09IEdCdXR0b24uRE9XTiB8fCB2YWwgPT0gR0J1dHRvbi5TRUxFQ1RFRF9PVkVSIHx8IHZhbCA9PSBHQnV0dG9uLlNFTEVDVEVEX0RJU0FCTEVEKSB7XG4gICAgICAgICAgICAgICAgbGV0IHIgPSB0aGlzLiRkb3duRWZmZWN0VmFsdWUgKiAyNTU7XG4gICAgICAgICAgICAgICAgbGV0IGNvbG9yID0gKHIgPDwgMTYpICsgKHIgPDwgOCkgKyByO1xuICAgICAgICAgICAgICAgIHRoaXMuJGNoaWxkcmVuLmZvckVhY2gob2JqID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ29sb3JHZWFyKG9iaikpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouY29sb3IgPSBjb2xvcjtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuJGNoaWxkcmVuLmZvckVhY2gob2JqID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ29sb3JHZWFyKG9iaikpXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouY29sb3IgPSAweGZmZmZmZjtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLiRkb3duRWZmZWN0ID09IDIpIHtcbiAgICAgICAgICAgIGlmICh2YWwgPT0gR0J1dHRvbi5ET1dOIHx8IHZhbCA9PSBHQnV0dG9uLlNFTEVDVEVEX09WRVIgfHwgdmFsID09IEdCdXR0b24uU0VMRUNURURfRElTQUJMRUQpXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTY2FsZSh0aGlzLiRkb3duRWZmZWN0VmFsdWUsIHRoaXMuJGRvd25FZmZlY3RWYWx1ZSk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTY2FsZSgxLCAxKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBoYW5kbGVDb250cm9sbGVyQ2hhbmdlZChjKSB7XG4gICAgICAgIHN1cGVyLmhhbmRsZUNvbnRyb2xsZXJDaGFuZ2VkKGMpO1xuICAgICAgICBpZiAodGhpcy4kcmVsYXRlZENvbnRyb2xsZXIgPT0gYylcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSB0aGlzLiRwYWdlT3B0aW9uLmlkID09IGMuc2VsZWN0ZWRQYWdlSWQ7XG4gICAgfVxuICAgIGhhbmRsZUdyYXllZENoYW5nZWQoKSB7XG4gICAgICAgIGlmICh0aGlzLiRidXR0b25Db250cm9sbGVyICYmIHRoaXMuJGJ1dHRvbkNvbnRyb2xsZXIuaGFzUGFnZShHQnV0dG9uLkRJU0FCTEVEKSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZ3JheWVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJHNlbGVjdGVkICYmIHRoaXMuJGJ1dHRvbkNvbnRyb2xsZXIuaGFzUGFnZShHQnV0dG9uLlNFTEVDVEVEX0RJU0FCTEVEKSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZShHQnV0dG9uLlNFTEVDVEVEX0RJU0FCTEVEKTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoR0J1dHRvbi5ESVNBQkxFRCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLiRzZWxlY3RlZClcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKEdCdXR0b24uRE9XTik7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZShHQnV0dG9uLlVQKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBzdXBlci5oYW5kbGVHcmF5ZWRDaGFuZ2VkKCk7XG4gICAgfVxuICAgIGNvbnN0cnVjdEZyb21YTUwoeG1sKSB7XG4gICAgICAgIHN1cGVyLmNvbnN0cnVjdEZyb21YTUwoeG1sKTtcbiAgICAgICAgeG1sID0gWG1sUGFyc2VyLmdldENoaWxkTm9kZXMoeG1sLCAnQnV0dG9uJylbMF07XG4gICAgICAgIGxldCBzdHI7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLm1vZGU7XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICB0aGlzLiRtb2RlID0gUGFyc2VCdXR0b25Nb2RlKHN0cik7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnNvdW5kO1xuICAgICAgICBpZiAoc3RyICE9IG51bGwpXG4gICAgICAgICAgICB0aGlzLiRzb3VuZCA9IHN0cjtcbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMudm9sdW1lO1xuICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgdGhpcy4kc291bmRWb2x1bWVTY2FsZSA9IHBhcnNlSW50KHN0cikgLyAxMDA7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmRvd25FZmZlY3Q7XG4gICAgICAgIGlmIChzdHIpIHtcbiAgICAgICAgICAgIHRoaXMuJGRvd25FZmZlY3QgPSBzdHIgPT0gJ2RhcmsnID8gMSA6IHN0ciA9PSAnc2NhbGUnID8gMiA6IDA7XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5kb3duRWZmZWN0VmFsdWU7XG4gICAgICAgICAgICB0aGlzLiRkb3duRWZmZWN0VmFsdWUgPSBwYXJzZUZsb2F0KHN0cik7XG4gICAgICAgICAgICBpZiAodGhpcy4kZG93bkVmZmVjdCA9PSAyKVxuICAgICAgICAgICAgICAgIHRoaXMuc2V0UGl2b3QoMC41LCAwLjUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuJGJ1dHRvbkNvbnRyb2xsZXIgPSB0aGlzLmdldENvbnRyb2xsZXIoJ2J1dHRvbicpO1xuICAgICAgICB0aGlzLiR0aXRsZU9iamVjdCA9IHRoaXMuZ2V0Q2hpbGQoJ3RpdGxlJyk7XG4gICAgICAgIHRoaXMuJGljb25PYmplY3QgPSB0aGlzLmdldENoaWxkKCdpY29uJyk7XG4gICAgICAgIGlmICh0aGlzLiR0aXRsZU9iamVjdCAhPSBudWxsKVxuICAgICAgICAgICAgdGhpcy4kdGl0bGUgPSB0aGlzLiR0aXRsZU9iamVjdC50ZXh0O1xuICAgICAgICBpZiAodGhpcy4kaWNvbk9iamVjdCAhPSBudWxsKVxuICAgICAgICAgICAgdGhpcy4kaWNvbiA9IHRoaXMuJGljb25PYmplY3QuaWNvbjtcbiAgICAgICAgaWYgKHRoaXMuJG1vZGUgPT0gMCAvKiBDb21tb24gKi8pXG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKEdCdXR0b24uVVApO1xuICAgICAgICB0aGlzLm9uKEludGVyYWN0aXZlRXZlbnRzLk92ZXIsIHRoaXMuJHJvbGxvdmVyLCB0aGlzKTtcbiAgICAgICAgdGhpcy5vbihJbnRlcmFjdGl2ZUV2ZW50cy5PdXQsIHRoaXMuJHJvbGxvdXQsIHRoaXMpO1xuICAgICAgICB0aGlzLm9uKEludGVyYWN0aXZlRXZlbnRzLkRvd24sIHRoaXMuJG1vdXNlZG93biwgdGhpcyk7XG4gICAgICAgIHRoaXMub24oSW50ZXJhY3RpdmVFdmVudHMuQ2xpY2ssIHRoaXMuJGNsaWNrLCB0aGlzKTtcbiAgICAgICAgdGhpcy4kaGl0QXJlYSA9IG5ldyBjcmVhdGVqcy5TaGFwZSgpO1xuICAgICAgICB0aGlzLiRoaXRBcmVhLmdyYXBoaWNzLmJlZ2luRmlsbChcIiNmZmZcIikuZHJhd1JlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICB0aGlzLiRkaXNwbGF5T2JqZWN0LmhpdEFyZWEgPSB0aGlzLiRoaXRBcmVhO1xuICAgIH1cbiAgICBzZXR1cEFmdGVyQWRkKHhtbCkge1xuICAgICAgICBzdXBlci5zZXR1cEFmdGVyQWRkKHhtbCk7XG4gICAgICAgIHhtbCA9IFhtbFBhcnNlci5nZXRDaGlsZE5vZGVzKHhtbCwgJ0J1dHRvbicpWzBdO1xuICAgICAgICBpZiAoeG1sKSB7XG4gICAgICAgICAgICBsZXQgc3RyO1xuICAgICAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMudGl0bGU7XG4gICAgICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgICAgIHRoaXMudGl0bGUgPSBzdHI7XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5pY29uO1xuICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICB0aGlzLmljb24gPSBzdHI7XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5zZWxlY3RlZFRpdGxlO1xuICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkVGl0bGUgPSBzdHI7XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5zZWxlY3RlZEljb247XG4gICAgICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJY29uID0gc3RyO1xuICAgICAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMudGl0bGVDb2xvcjtcbiAgICAgICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICAgICAgdGhpcy50aXRsZUNvbG9yID0gU3RyaW5nVXRpbC5IRVgyUkdCKHN0cik7XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5zb3VuZDtcbiAgICAgICAgICAgIGlmIChzdHIgIT0gbnVsbClcbiAgICAgICAgICAgICAgICB0aGlzLiRzb3VuZCA9IHN0cjtcbiAgICAgICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnZvbHVtZTtcbiAgICAgICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICAgICAgdGhpcy4kc291bmRWb2x1bWVTY2FsZSA9IHBhcnNlSW50KHN0cikgLyAxMDA7XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy50aXRsZUZvbnRTaXplO1xuICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICB0aGlzLmZvbnRTaXplID0gcGFyc2VJbnQoc3RyKTtcbiAgICAgICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmNvbnRyb2xsZXI7XG4gICAgICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgICAgIHRoaXMuJHJlbGF0ZWRDb250cm9sbGVyID0gdGhpcy4kcGFyZW50LmdldENvbnRyb2xsZXIoc3RyKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB0aGlzLiRyZWxhdGVkQ29udHJvbGxlciA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLiRwYWdlT3B0aW9uLmlkID0geG1sLmF0dHJpYnV0ZXMucGFnZTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSB4bWwuYXR0cmlidXRlcy5jaGVja2VkID09ICd0cnVlJztcbiAgICAgICAgfVxuICAgIH1cbiAgICAkcm9sbG92ZXIoZXZ0KSB7XG4gICAgICAgIGlmICghdGhpcy4kYnV0dG9uQ29udHJvbGxlciB8fCAhdGhpcy4kYnV0dG9uQ29udHJvbGxlci5oYXNQYWdlKEdCdXR0b24uT1ZFUikpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuJG92ZXIgPSB0cnVlO1xuICAgICAgICBpZiAodGhpcy4kZG93bilcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh0aGlzLiRzZWxlY3RlZCA/IEdCdXR0b24uU0VMRUNURURfT1ZFUiA6IEdCdXR0b24uT1ZFUik7XG4gICAgfVxuICAgICRyb2xsb3V0KGV2dCkge1xuICAgICAgICBpZiAoIXRoaXMuJGJ1dHRvbkNvbnRyb2xsZXIgfHwgIXRoaXMuJGJ1dHRvbkNvbnRyb2xsZXIuaGFzUGFnZShHQnV0dG9uLk9WRVIpKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLiRvdmVyID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLiRkb3duKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHRoaXMuJHNlbGVjdGVkID8gR0J1dHRvbi5ET1dOIDogR0J1dHRvbi5VUCk7XG4gICAgfVxuICAgICRtb3VzZWRvd24oZXZ0KSB7XG4gICAgICAgIHRoaXMuJGRvd24gPSB0cnVlO1xuICAgICAgICB0aGlzLiRtb3VzZVVwRXZlbnQgPSBEZWNscyQxLkdSb290Lmluc3QubmF0aXZlU3RhZ2Uub24oSW50ZXJhY3RpdmVFdmVudHMuVXAsIHRoaXMuJG1vdXNldXAsIHRoaXMpO1xuICAgICAgICBpZiAodGhpcy4kbW9kZSA9PSAwIC8qIENvbW1vbiAqLykge1xuICAgICAgICAgICAgaWYgKHRoaXMuZ3JheWVkICYmIHRoaXMuJGJ1dHRvbkNvbnRyb2xsZXIgJiYgdGhpcy4kYnV0dG9uQ29udHJvbGxlci5oYXNQYWdlKEdCdXR0b24uRElTQUJMRUQpKVxuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoR0J1dHRvbi5TRUxFQ1RFRF9ESVNBQkxFRCk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZShHQnV0dG9uLkRPV04pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLiRsaW5rZWRQb3B1cCAhPSBudWxsKSB7XG4gICAgICAgICAgICBpZiAodGhpcy4kbGlua2VkUG9wdXAgaW5zdGFuY2VvZiBXaW5kb3cpXG4gICAgICAgICAgICAgICAgdGhpcy4kbGlua2VkUG9wdXAudG9nZ2xlVmlzaWJsZSgpO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIERlY2xzJDEuR1Jvb3QuaW5zdC50b2dnbGVQb3B1cCh0aGlzLiRsaW5rZWRQb3B1cCwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgJG1vdXNldXAoZXZ0KSB7XG4gICAgICAgIGlmICh0aGlzLiRkb3duKSB7XG4gICAgICAgICAgICBEZWNscyQxLkdSb290Lmluc3QubmF0aXZlU3RhZ2Uub2ZmKEludGVyYWN0aXZlRXZlbnRzLlVwLCB0aGlzLiRtb3VzZVVwRXZlbnQpO1xuICAgICAgICAgICAgdGhpcy4kZG93biA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHRoaXMuJG1vZGUgPT0gMCAvKiBDb21tb24gKi8pIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ncmF5ZWQgJiZcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kYnV0dG9uQ29udHJvbGxlciAmJlxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRidXR0b25Db250cm9sbGVyLmhhc1BhZ2UoR0J1dHRvbi5ESVNBQkxFRCkpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoR0J1dHRvbi5ESVNBQkxFRCk7XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy4kb3ZlcilcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZShHQnV0dG9uLk9WRVIpO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZShHQnV0dG9uLlVQKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAkY2xpY2soZXZ0KSB7XG4gICAgICAgIGlmICh0aGlzLiRzb3VuZCkge1xuICAgICAgICAgICAgdmFyIHBpID0gVUlQYWNrYWdlLmdldEl0ZW1CeVVSTCh0aGlzLiRzb3VuZCk7XG4gICAgICAgICAgICBpZiAocGkpIHtcbiAgICAgICAgICAgICAgICB2YXIgc291bmQgPSBwaS5vd25lci5nZXRJdGVtQXNzZXQocGkpO1xuICAgICAgICAgICAgICAgIGlmIChzb3VuZClcbiAgICAgICAgICAgICAgICAgICAgRGVjbHMkMS5HUm9vdC5pbnN0LnBsYXlPbmVTaG90U291bmQoc291bmQsIHRoaXMuJHNvdW5kVm9sdW1lU2NhbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy4kY2hhbmdlU3RhdGVPbkNsaWNrKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAodGhpcy4kbW9kZSA9PSAxIC8qIENoZWNrICovKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gIXRoaXMuJHNlbGVjdGVkO1xuICAgICAgICAgICAgbGV0IGV2dCA9IG5ldyBjcmVhdGVqcy5FdmVudChcIl9fc3RhdGVDaGFuZ2VkXCIgLyogQ0hBTkdFRCAqLywgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICAgICAgZXZ0LmRhdGEgPSB7IHNlbGVjdGVkOiB0aGlzLnNlbGVjdGVkIH07XG4gICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZXZ0LCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLiRtb2RlID09IDIgLyogUmFkaW8gKi8pIHtcbiAgICAgICAgICAgIGlmICghdGhpcy4kc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBsZXQgZXZ0ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KFwiX19zdGF0ZUNoYW5nZWRcIiAvKiBDSEFOR0VEICovLCB0cnVlLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgZXZ0LmRhdGEgPSB7IHNlbGVjdGVkOiB0aGlzLnNlbGVjdGVkIH07XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGV2dCwgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZGlzcG9zZSgpIHtcbiAgICAgICAgR1RpbWVyLmluc3QucmVtb3ZlKHRoaXMuc2V0U3RhdGUsIHRoaXMpO1xuICAgICAgICBHVGltZXIuaW5zdC5yZW1vdmUodGhpcy5zZXRTdGF0ZSwgdGhpcyk7XG4gICAgICAgIERlY2xzJDEuR1Jvb3QuaW5zdC5vZmYoSW50ZXJhY3RpdmVFdmVudHMuVXAsIHRoaXMuJG1vdXNldXApO1xuICAgICAgICBzdXBlci5kaXNwb3NlKCk7XG4gICAgfVxufVxuR0J1dHRvbi5VUCA9ICd1cCc7XG5HQnV0dG9uLkRPV04gPSAnZG93bic7XG5HQnV0dG9uLk9WRVIgPSAnb3Zlcic7XG5HQnV0dG9uLlNFTEVDVEVEX09WRVIgPSAnc2VsZWN0ZWRPdmVyJztcbkdCdXR0b24uRElTQUJMRUQgPSAnZGlzYWJsZWQnO1xuR0J1dHRvbi5TRUxFQ1RFRF9ESVNBQkxFRCA9ICdzZWxlY3RlZERpc2FibGVkJztcblxuY2xhc3MgR0NvbWJvQm94IGV4dGVuZHMgR0NvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuJHZpc2libGVJdGVtQ291bnQgPSAwO1xuICAgICAgICB0aGlzLiRzZWxlY3RlZEluZGV4ID0gMDtcbiAgICAgICAgdGhpcy4kcG9wdXBEaXIgPSAxIC8qIERvd24gKi87XG4gICAgICAgIHRoaXMuJHZpc2libGVJdGVtQ291bnQgPSBVSUNvbmZpZy5kZWZhdWx0Q29tYm9Cb3hWaXNpYmxlSXRlbUNvdW50O1xuICAgICAgICB0aGlzLiRpdGVtc1VwZGF0ZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLiRzZWxlY3RlZEluZGV4ID0gLTE7XG4gICAgICAgIHRoaXMuJGl0ZW1zID0gW107XG4gICAgICAgIHRoaXMuJHZhbHVlcyA9IFtdO1xuICAgIH1cbiAgICBnZXQgdGV4dCgpIHtcbiAgICAgICAgaWYgKHRoaXMuJHRpdGxlT2JqZWN0KVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHRpdGxlT2JqZWN0LnRleHQ7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBzZXQgdGV4dCh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kdGl0bGVPYmplY3QpXG4gICAgICAgICAgICB0aGlzLiR0aXRsZU9iamVjdC50ZXh0ID0gdmFsdWU7XG4gICAgICAgIHRoaXMudXBkYXRlR2Vhcig2IC8qIFRleHQgKi8pO1xuICAgIH1cbiAgICBnZXQgaWNvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuJGljb25PYmplY3QpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kaWNvbk9iamVjdC5pY29uO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgc2V0IGljb24odmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJGljb25PYmplY3QpXG4gICAgICAgICAgICB0aGlzLiRpY29uT2JqZWN0Lmljb24gPSB2YWx1ZTtcbiAgICAgICAgdGhpcy51cGRhdGVHZWFyKDcgLyogSWNvbiAqLyk7XG4gICAgfVxuICAgIGdldCB0aXRsZUNvbG9yKCkge1xuICAgICAgICBpZiAoaXNDb2xvcmFibGVUaXRsZSh0aGlzLiR0aXRsZU9iamVjdCkpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kdGl0bGVPYmplY3QudGl0bGVDb2xvcjtcbiAgICAgICAgLy8gcmV0dXJuIDA7XG4gICAgfVxuICAgIHNldCB0aXRsZUNvbG9yKHZhbHVlKSB7XG4gICAgICAgIGlmIChpc0NvbG9yYWJsZVRpdGxlKHRoaXMuJHRpdGxlT2JqZWN0KSlcbiAgICAgICAgICAgIHRoaXMuJHRpdGxlT2JqZWN0LnRpdGxlQ29sb3IgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IHZpc2libGVJdGVtQ291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR2aXNpYmxlSXRlbUNvdW50O1xuICAgIH1cbiAgICBzZXQgdmlzaWJsZUl0ZW1Db3VudCh2YWx1ZSkge1xuICAgICAgICB0aGlzLiR2aXNpYmxlSXRlbUNvdW50ID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCBwb3B1cERpcmVjdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHBvcHVwRGlyO1xuICAgIH1cbiAgICBzZXQgcG9wdXBEaXJlY3Rpb24odmFsdWUpIHtcbiAgICAgICAgdGhpcy4kcG9wdXBEaXIgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IGl0ZW1zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kaXRlbXM7XG4gICAgfVxuICAgIHNldCBpdGVtcyh2YWx1ZSkge1xuICAgICAgICBpZiAoIXZhbHVlKVxuICAgICAgICAgICAgdGhpcy4kaXRlbXMubGVuZ3RoID0gMDtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kaXRlbXMgPSB2YWx1ZS5jb25jYXQoKTtcbiAgICAgICAgaWYgKHRoaXMuJGl0ZW1zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRzZWxlY3RlZEluZGV4ID49IHRoaXMuJGl0ZW1zLmxlbmd0aClcbiAgICAgICAgICAgICAgICB0aGlzLiRzZWxlY3RlZEluZGV4ID0gdGhpcy4kaXRlbXMubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuJHNlbGVjdGVkSW5kZXggPT0gLTEpXG4gICAgICAgICAgICAgICAgdGhpcy4kc2VsZWN0ZWRJbmRleCA9IDA7XG4gICAgICAgICAgICB0aGlzLnRleHQgPSB0aGlzLiRpdGVtc1t0aGlzLiRzZWxlY3RlZEluZGV4XTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRpY29ucyAhPSBudWxsICYmIHRoaXMuJHNlbGVjdGVkSW5kZXggPCB0aGlzLiRpY29ucy5sZW5ndGgpXG4gICAgICAgICAgICAgICAgdGhpcy5pY29uID0gdGhpcy4kaWNvbnNbdGhpcy4kc2VsZWN0ZWRJbmRleF07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRleHQgPSAnJztcbiAgICAgICAgICAgIGlmICh0aGlzLiRpY29ucyAhPSBudWxsKVxuICAgICAgICAgICAgICAgIHRoaXMuaWNvbiA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLiRzZWxlY3RlZEluZGV4ID0gLTE7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kaXRlbXNVcGRhdGVkID0gdHJ1ZTtcbiAgICB9XG4gICAgZ2V0IGljb25zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kaWNvbnM7XG4gICAgfVxuICAgIHNldCBpY29ucyh2YWx1ZSkge1xuICAgICAgICB0aGlzLiRpY29ucyA9IHZhbHVlO1xuICAgICAgICBpZiAodGhpcy4kaWNvbnMgIT0gbnVsbCAmJlxuICAgICAgICAgICAgdGhpcy4kc2VsZWN0ZWRJbmRleCAhPSAtMSAmJlxuICAgICAgICAgICAgdGhpcy4kc2VsZWN0ZWRJbmRleCA8IHRoaXMuJGljb25zLmxlbmd0aClcbiAgICAgICAgICAgIHRoaXMuaWNvbiA9IHRoaXMuJGljb25zW3RoaXMuJHNlbGVjdGVkSW5kZXhdO1xuICAgIH1cbiAgICBnZXQgdmFsdWVzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kdmFsdWVzO1xuICAgIH1cbiAgICBzZXQgdmFsdWVzKHZhbHVlKSB7XG4gICAgICAgIGlmICghdmFsdWUpXG4gICAgICAgICAgICB0aGlzLiR2YWx1ZXMubGVuZ3RoID0gMDtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kdmFsdWVzID0gdmFsdWUuY29uY2F0KCk7XG4gICAgfVxuICAgIGdldCBzZWxlY3RlZEluZGV4KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kc2VsZWN0ZWRJbmRleDtcbiAgICB9XG4gICAgc2V0IHNlbGVjdGVkSW5kZXgodmFsKSB7XG4gICAgICAgIGlmICh0aGlzLiRzZWxlY3RlZEluZGV4ID09IHZhbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy4kc2VsZWN0ZWRJbmRleCA9IHZhbDtcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRJbmRleCA+PSAwICYmIHRoaXMuc2VsZWN0ZWRJbmRleCA8IHRoaXMuJGl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy50ZXh0ID0gdGhpcy4kaXRlbXNbdGhpcy4kc2VsZWN0ZWRJbmRleF07XG4gICAgICAgICAgICBpZiAodGhpcy4kaWNvbnMgIT0gbnVsbCAmJiB0aGlzLiRzZWxlY3RlZEluZGV4IDwgdGhpcy4kaWNvbnMubGVuZ3RoKVxuICAgICAgICAgICAgICAgIHRoaXMuaWNvbiA9IHRoaXMuJGljb25zW3RoaXMuJHNlbGVjdGVkSW5kZXhdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50ZXh0ID0gJyc7XG4gICAgICAgICAgICBpZiAodGhpcy4kaWNvbnMgIT0gbnVsbClcbiAgICAgICAgICAgICAgICB0aGlzLmljb24gPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCB2YWx1ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHZhbHVlc1t0aGlzLiRzZWxlY3RlZEluZGV4XTtcbiAgICB9XG4gICAgc2V0IHZhbHVlKHZhbCkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSB0aGlzLiR2YWx1ZXMuaW5kZXhPZih2YWwpO1xuICAgIH1cbiAgICBzZXRTdGF0ZSh2YWwpIHtcbiAgICAgICAgaWYgKHRoaXMuJGJ1dHRvbkNvbnRyb2xsZXIpXG4gICAgICAgICAgICB0aGlzLiRidXR0b25Db250cm9sbGVyLnNlbGVjdGVkUGFnZSA9IHZhbDtcbiAgICB9XG4gICAgY29uc3RydWN0RnJvbVhNTCh4bWwpIHtcbiAgICAgICAgc3VwZXIuY29uc3RydWN0RnJvbVhNTCh4bWwpO1xuICAgICAgICB4bWwgPSBYbWxQYXJzZXIuZ2V0Q2hpbGROb2Rlcyh4bWwsICdDb21ib0JveCcpWzBdO1xuICAgICAgICBsZXQgc3RyO1xuICAgICAgICB0aGlzLiRidXR0b25Db250cm9sbGVyID0gdGhpcy5nZXRDb250cm9sbGVyKCdidXR0b24nKTtcbiAgICAgICAgdGhpcy4kdGl0bGVPYmplY3QgPSB0aGlzLmdldENoaWxkKCd0aXRsZScpO1xuICAgICAgICB0aGlzLiRpY29uT2JqZWN0ID0gdGhpcy5nZXRDaGlsZCgnaWNvbicpO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5kcm9wZG93bjtcbiAgICAgICAgaWYgKHN0cikge1xuICAgICAgICAgICAgdGhpcy4kZHJvcGRvd24gPSBVSVBhY2thZ2UuY3JlYXRlT2JqZWN0RnJvbVVSTChzdHIpO1xuICAgICAgICAgICAgaWYgKCF0aGlzLiRkcm9wZG93bilcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ0aGUgJ2Ryb3Bkb3duJyBpcyBub3Qgc3BlY2lmaWVkLCBpdCBtdXN0IGJlIGEgY29tcG9uZW50IGRlZmluaWVkIGluIHRoZSBwYWNrYWdlIHBvb2xcIik7XG4gICAgICAgICAgICB0aGlzLiRkcm9wZG93bi5uYW1lID0gJ3RoaXMuZHJvcGRvd24nO1xuICAgICAgICAgICAgdGhpcy4kbGlzdCA9IHRoaXMuJGRyb3Bkb3duLmdldENoaWxkKCdsaXN0Jyk7XG4gICAgICAgICAgICBpZiAodGhpcy4kbGlzdCA9PSBudWxsKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgJHt0aGlzLnJlc291cmNlVVJMfTogdGhlIGRyb3Bkb3duIGNvbXBvbmVudCBtdXN0IGhhdmUgYSBHTGlzdCBjaGlsZCBhbmQgbmFtZWQgJ2xpc3QnLmApO1xuICAgICAgICAgICAgdGhpcy4kbGlzdC5vbihcIl9faXRlbUNsaWNrXCIgLyogSXRlbUNsaWNrICovLCB0aGlzLiRjbGlja0l0ZW0sIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy4kbGlzdC5hZGRSZWxhdGlvbih0aGlzLiRkcm9wZG93biwgMTQgLyogV2lkdGggKi8pO1xuICAgICAgICAgICAgdGhpcy4kbGlzdC5yZW1vdmVSZWxhdGlvbih0aGlzLiRkcm9wZG93biwgMTUgLyogSGVpZ2h0ICovKTtcbiAgICAgICAgICAgIHRoaXMuJGRyb3Bkb3duLmFkZFJlbGF0aW9uKHRoaXMuJGxpc3QsIDE1IC8qIEhlaWdodCAqLyk7XG4gICAgICAgICAgICB0aGlzLiRkcm9wZG93bi5yZW1vdmVSZWxhdGlvbih0aGlzLiRsaXN0LCAxNCAvKiBXaWR0aCAqLyk7XG4gICAgICAgICAgICB0aGlzLiRkcm9wZG93bi5vbigncmVtb3ZlZCcsIHRoaXMuJHBvcHVwV2luQ2xvc2VkLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzTW9iaWxlLmFueSkge1xuICAgICAgICAgICAgdGhpcy5vbihJbnRlcmFjdGl2ZUV2ZW50cy5PdmVyLCB0aGlzLiRyb2xsb3ZlciwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLm9uKEludGVyYWN0aXZlRXZlbnRzLk91dCwgdGhpcy4kcm9sbG91dCwgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vbihJbnRlcmFjdGl2ZUV2ZW50cy5Eb3duLCB0aGlzLiRtb3VzZWRvd24sIHRoaXMpO1xuICAgIH1cbiAgICBkaXNwb3NlKCkge1xuICAgICAgICBHVGltZXIuaW5zdC5yZW1vdmUodGhpcy5kZWxheWVkQ2xpY2tJdGVtLCB0aGlzKTtcbiAgICAgICAgdGhpcy4kbGlzdC5vZmYoXCJfX2l0ZW1DbGlja1wiIC8qIEl0ZW1DbGljayAqLywgdGhpcy4kY2xpY2tJdGVtKTtcbiAgICAgICAgdGhpcy4kZHJvcGRvd24ub2ZmKCdyZW1vdmVkJywgdGhpcy4kcG9wdXBXaW5DbG9zZWQpO1xuICAgICAgICBHUm9vdC5pbnN0Lm5hdGl2ZVN0YWdlLm9mZihJbnRlcmFjdGl2ZUV2ZW50cy5VcCwgdGhpcy4kbW91c2VVcEV2ZW50KTtcbiAgICAgICAgdGhpcy4kcG9wdXBXaW5DbG9zZWQobnVsbCk7XG4gICAgICAgIGlmICh0aGlzLiRkcm9wZG93bikge1xuICAgICAgICAgICAgdGhpcy4kZHJvcGRvd24uZGlzcG9zZSgpO1xuICAgICAgICAgICAgdGhpcy4kZHJvcGRvd24gPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHN1cGVyLmRpc3Bvc2UoKTtcbiAgICB9XG4gICAgc2V0dXBBZnRlckFkZCh4bWwpIHtcbiAgICAgICAgc3VwZXIuc2V0dXBBZnRlckFkZCh4bWwpO1xuICAgICAgICB4bWwgPSBYbWxQYXJzZXIuZ2V0Q2hpbGROb2Rlcyh4bWwsICdDb21ib0JveCcpWzBdO1xuICAgICAgICBpZiAoeG1sKSB7XG4gICAgICAgICAgICBsZXQgc3RyO1xuICAgICAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMudGl0bGVDb2xvcjtcbiAgICAgICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICAgICAgdGhpcy50aXRsZUNvbG9yID0gc3RyO1xuICAgICAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMudmlzaWJsZUl0ZW1Db3VudDtcbiAgICAgICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICAgICAgdGhpcy4kdmlzaWJsZUl0ZW1Db3VudCA9IHBhcnNlSW50KHN0cik7XG4gICAgICAgICAgICBsZXQgY29sID0geG1sLmNoaWxkcmVuO1xuICAgICAgICAgICAgaWYgKGNvbCkge1xuICAgICAgICAgICAgICAgIGNvbC5mb3JFYWNoKCh4LCBpKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh4Lm5vZGVOYW1lID09ICdpdGVtJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kaXRlbXMucHVzaCh4LmF0dHJpYnV0ZXMudGl0bGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kdmFsdWVzLnB1c2goeC5hdHRyaWJ1dGVzLnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ciA9IHguYXR0cmlidXRlcy5pY29uO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0cikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy4kaWNvbnMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGljb25zID0gbmV3IEFycmF5KGxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kaWNvbnNbaV0gPSBzdHI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnRpdGxlO1xuICAgICAgICAgICAgaWYgKHN0cikge1xuICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9IHN0cjtcbiAgICAgICAgICAgICAgICB0aGlzLiRzZWxlY3RlZEluZGV4ID0gdGhpcy4kaXRlbXMuaW5kZXhPZihzdHIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy4kaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuJHNlbGVjdGVkSW5kZXggPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9IHRoaXMuJGl0ZW1zWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHRoaXMuJHNlbGVjdGVkSW5kZXggPSAtMTtcbiAgICAgICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmljb247XG4gICAgICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgICAgIHRoaXMuaWNvbiA9IHN0cjtcbiAgICAgICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmRpcmVjdGlvbjtcbiAgICAgICAgICAgIGlmIChzdHIpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RyID09ICd1cCcpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHBvcHVwRGlyID0gMiAvKiBVcCAqLztcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChzdHIgPT0gJ2F1dG8nKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRwb3B1cERpciA9IDAgLyogQXV0byAqLztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBzaG93RHJvcGRvd24oKSB7XG4gICAgICAgIGlmICh0aGlzLiRpdGVtc1VwZGF0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuJGl0ZW1zVXBkYXRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy4kbGlzdC5yZW1vdmVDaGlsZHJlblRvUG9vbCgpO1xuICAgICAgICAgICAgdGhpcy4kaXRlbXMuZm9yRWFjaCgobywgaSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBpdGVtID0gdGhpcy4kbGlzdC5hZGRJdGVtRnJvbVBvb2woKTtcbiAgICAgICAgICAgICAgICBpdGVtLm5hbWUgPSBpIDwgdGhpcy4kdmFsdWVzLmxlbmd0aCA/IHRoaXMuJHZhbHVlc1tpXSA6ICcnO1xuICAgICAgICAgICAgICAgIGl0ZW0udGV4dCA9IHRoaXMuJGl0ZW1zW2ldO1xuICAgICAgICAgICAgICAgIGl0ZW0uaWNvbiA9IHRoaXMuJGljb25zICE9IG51bGwgJiYgaSA8IHRoaXMuJGljb25zLmxlbmd0aCA/IHRoaXMuJGljb25zW2ldIDogbnVsbDtcbiAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy4kbGlzdC5yZXNpemVUb0ZpdCh0aGlzLiR2aXNpYmxlSXRlbUNvdW50KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiRsaXN0LnNlbGVjdGVkSW5kZXggPSAtMTtcbiAgICAgICAgdGhpcy4kZHJvcGRvd24ud2lkdGggPSB0aGlzLndpZHRoO1xuICAgICAgICBHUm9vdC5maW5kRm9yKHRoaXMpLnRvZ2dsZVBvcHVwKHRoaXMuJGRyb3Bkb3duLCB0aGlzLCB0aGlzLiRwb3B1cERpcik7XG4gICAgICAgIGlmICh0aGlzLiRkcm9wZG93bi5wYXJlbnQpXG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKEdCdXR0b24uRE9XTik7XG4gICAgfVxuICAgICRwb3B1cFdpbkNsb3NlZChldnQpIHtcbiAgICAgICAgaWYgKHRoaXMuJG92ZXIpXG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKEdCdXR0b24uT1ZFUik7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoR0J1dHRvbi5VUCk7XG4gICAgfVxuICAgICRjbGlja0l0ZW0oZXZ0KSB7XG4gICAgICAgIGxldCBpdGVtID0gZXZ0LmRhdGEuaXRlbTtcbiAgICAgICAgbGV0IGluZGV4ID0gdGhpcy4kbGlzdC5nZXRDaGlsZEluZGV4KGl0ZW0pO1xuICAgICAgICBHVGltZXIuaW5zdC5hZGQoMTAwLCAxLCB0aGlzLmRlbGF5ZWRDbGlja0l0ZW0sIHRoaXMsIGluZGV4KTtcbiAgICB9XG4gICAgZGVsYXllZENsaWNrSXRlbShpbmRleCkge1xuICAgICAgICBpZiAodGhpcy4kZHJvcGRvd24ucGFyZW50IGluc3RhbmNlb2YgR1Jvb3QpXG4gICAgICAgICAgICB0aGlzLiRkcm9wZG93bi5wYXJlbnQuaGlkZVBvcHVwKCk7XG4gICAgICAgIHRoaXMuJHNlbGVjdGVkSW5kZXggPSBpbmRleDtcbiAgICAgICAgaWYgKHRoaXMuJHNlbGVjdGVkSW5kZXggPj0gMClcbiAgICAgICAgICAgIHRoaXMudGV4dCA9IHRoaXMuJGl0ZW1zW3RoaXMuJHNlbGVjdGVkSW5kZXhdO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLnRleHQgPSAnJztcbiAgICAgICAgbGV0IGV2dCA9IG5ldyBjcmVhdGVqcy5FdmVudChcIl9fc3RhdGVDaGFuZ2VkXCIgLyogQ0hBTkdFRCAqLywgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICBldnQuZGF0YSA9IHsgc2VsZWN0ZWRJbmRleDogdGhpcy4kc2VsZWN0ZWRJbmRleCB9O1xuICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZXZ0LCB0aGlzKTtcbiAgICB9XG4gICAgJHJvbGxvdmVyKGV2dCkge1xuICAgICAgICB0aGlzLiRvdmVyID0gdHJ1ZTtcbiAgICAgICAgaWYgKHRoaXMuJGRvd24gfHwgKHRoaXMuJGRyb3Bkb3duICYmIHRoaXMuJGRyb3Bkb3duLnBhcmVudCkpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoR0J1dHRvbi5PVkVSKTtcbiAgICB9XG4gICAgJHJvbGxvdXQoZXZ0KSB7XG4gICAgICAgIHRoaXMuJG92ZXIgPSBmYWxzZTtcbiAgICAgICAgaWYgKHRoaXMuJGRvd24gfHwgKHRoaXMuJGRyb3Bkb3duICYmIHRoaXMuJGRyb3Bkb3duLnBhcmVudCkpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoR0J1dHRvbi5VUCk7XG4gICAgfVxuICAgICRtb3VzZWRvd24oZXZ0KSB7XG4gICAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgR1Jvb3QuaW5zdC5jaGVja1BvcHVwcyhldnQudGFyZ2V0KTtcbiAgICAgICAgdGhpcy4kZG93biA9IHRydWU7XG4gICAgICAgIHRoaXMuJG1vdXNlVXBFdmVudCA9IEdSb290Lmluc3QubmF0aXZlU3RhZ2Uub24oSW50ZXJhY3RpdmVFdmVudHMuVXAsIHRoaXMuJG1vdXNldXAsIHRoaXMpO1xuICAgICAgICBpZiAodGhpcy4kZHJvcGRvd24pXG4gICAgICAgICAgICB0aGlzLnNob3dEcm9wZG93bigpO1xuICAgIH1cbiAgICAkbW91c2V1cChldnQpIHtcbiAgICAgICAgaWYgKHRoaXMuJGRvd24pIHtcbiAgICAgICAgICAgIHRoaXMuJGRvd24gPSBmYWxzZTtcbiAgICAgICAgICAgIEdSb290Lmluc3QubmF0aXZlU3RhZ2Uub2ZmKEludGVyYWN0aXZlRXZlbnRzLlVwLCB0aGlzLiRtb3VzZVVwRXZlbnQpO1xuICAgICAgICAgICAgaWYgKHRoaXMuJGRyb3Bkb3duICYmICF0aGlzLiRkcm9wZG93bi5wYXJlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kb3ZlcilcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZShHQnV0dG9uLk9WRVIpO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZShHQnV0dG9uLlVQKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuY2xhc3MgR1NsaWRlciBleHRlbmRzIEdDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLiRtYXggPSAwO1xuICAgICAgICB0aGlzLiR2YWx1ZSA9IDA7XG4gICAgICAgIHRoaXMuJGJhck1heFdpZHRoID0gMDtcbiAgICAgICAgdGhpcy4kYmFyTWF4SGVpZ2h0ID0gMDtcbiAgICAgICAgdGhpcy4kYmFyTWF4V2lkdGhEZWx0YSA9IDA7XG4gICAgICAgIHRoaXMuJGJhck1heEhlaWdodERlbHRhID0gMDtcbiAgICAgICAgdGhpcy4kdGl0bGVUeXBlID0gMCAvKiBQZXJjZW50ICovO1xuICAgICAgICB0aGlzLiR2YWx1ZSA9IDUwO1xuICAgICAgICB0aGlzLiRtYXggPSAxMDA7XG4gICAgICAgIHRoaXMuJGNsaWNrUG9zID0gbmV3IGNyZWF0ZWpzLlBvaW50KCk7XG4gICAgfVxuICAgIGdldCB0aXRsZVR5cGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR0aXRsZVR5cGU7XG4gICAgfVxuICAgIHNldCB0aXRsZVR5cGUodmFsdWUpIHtcbiAgICAgICAgdGhpcy4kdGl0bGVUeXBlID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCBtYXgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRtYXg7XG4gICAgfVxuICAgIHNldCBtYXgodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJG1heCAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kbWF4ID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCB2YWx1ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHZhbHVlO1xuICAgIH1cbiAgICBzZXQgdmFsdWUodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJHZhbHVlICE9IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiR2YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB1cGRhdGUoKSB7XG4gICAgICAgIGxldCBwZXJjZW50ID0gTWF0aC5taW4odGhpcy4kdmFsdWUgLyB0aGlzLiRtYXgsIDEpO1xuICAgICAgICB0aGlzLnVwZGF0ZVdpZHRoUGVyY2VudChwZXJjZW50KTtcbiAgICB9XG4gICAgdXBkYXRlV2lkdGhQZXJjZW50KHBlcmNlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuJHRpdGxlT2JqZWN0KSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuJHRpdGxlVHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMCAvKiBQZXJjZW50ICovOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLiR0aXRsZU9iamVjdC50ZXh0ID0gYCR7TWF0aC5yb3VuZChwZXJjZW50ICogMTAwKX0lYDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxIC8qIFZhbHVlQW5kTWF4ICovOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLiR0aXRsZU9iamVjdC50ZXh0ID0gYCR7dGhpcy4kdmFsdWV9LyR7dGhpcy4kbWF4fWA7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMiAvKiBWYWx1ZSAqLzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kdGl0bGVPYmplY3QudGV4dCA9IGAke3RoaXMuJHZhbHVlfWA7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMyAvKiBNYXggKi86XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHRpdGxlT2JqZWN0LnRleHQgPSBgJHt0aGlzLiRtYXh9YDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuJGJhck9iamVjdEgpXG4gICAgICAgICAgICB0aGlzLiRiYXJPYmplY3RILndpZHRoID0gKHRoaXMud2lkdGggLSB0aGlzLiRiYXJNYXhXaWR0aERlbHRhKSAqIHBlcmNlbnQ7XG4gICAgICAgIGlmICh0aGlzLiRiYXJPYmplY3RWKVxuICAgICAgICAgICAgdGhpcy4kYmFyT2JqZWN0Vi5oZWlnaHQgPSAodGhpcy5oZWlnaHQgLSB0aGlzLiRiYXJNYXhIZWlnaHREZWx0YSkgKiBwZXJjZW50O1xuICAgICAgICBpZiAodGhpcy4kYW5pT2JqZWN0IGluc3RhbmNlb2YgR01vdmllQ2xpcClcbiAgICAgICAgICAgIHRoaXMuJGFuaU9iamVjdC5mcmFtZSA9IE1hdGgucm91bmQocGVyY2VudCAqIDEwMCk7XG4gICAgfVxuICAgIGhhbmRsZVNpemVDaGFuZ2VkKCkge1xuICAgICAgICBzdXBlci5oYW5kbGVTaXplQ2hhbmdlZCgpO1xuICAgICAgICBpZiAodGhpcy4kYmFyT2JqZWN0SClcbiAgICAgICAgICAgIHRoaXMuJGJhck1heFdpZHRoID0gdGhpcy53aWR0aCAtIHRoaXMuJGJhck1heFdpZHRoRGVsdGE7XG4gICAgICAgIGlmICh0aGlzLiRiYXJPYmplY3RWKVxuICAgICAgICAgICAgdGhpcy4kYmFyTWF4SGVpZ2h0ID0gdGhpcy5oZWlnaHQgLSB0aGlzLiRiYXJNYXhIZWlnaHREZWx0YTtcbiAgICAgICAgaWYgKCF0aGlzLiRpblByb2dyZXNzQnVpbGRpbmcpXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgIH1cbiAgICBzZXR1cEFmdGVyQWRkKHhtbCkge1xuICAgICAgICBzdXBlci5zZXR1cEFmdGVyQWRkKHhtbCk7XG4gICAgICAgIHhtbCA9IFhtbFBhcnNlci5nZXRDaGlsZE5vZGVzKHhtbCwgJ1NsaWRlcicpWzBdO1xuICAgICAgICBpZiAoeG1sKSB7XG4gICAgICAgICAgICB0aGlzLiR2YWx1ZSA9IHBhcnNlSW50KHhtbC5hdHRyaWJ1dGVzLnZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMuJG1heCA9IHBhcnNlSW50KHhtbC5hdHRyaWJ1dGVzLm1heCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICB9XG4gICAgY29uc3RydWN0RnJvbVhNTCh4bWwpIHtcbiAgICAgICAgc3VwZXIuY29uc3RydWN0RnJvbVhNTCh4bWwpO1xuICAgICAgICB4bWwgPSBYbWxQYXJzZXIuZ2V0Q2hpbGROb2Rlcyh4bWwsICdTbGlkZXInKVswXTtcbiAgICAgICAgbGV0IHN0cjtcbiAgICAgICAgaWYgKHhtbCkge1xuICAgICAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMudGl0bGVUeXBlO1xuICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICB0aGlzLiR0aXRsZVR5cGUgPSBQYXJzZVByb2dyZXNzVGl0bGVUeXBlKHN0cik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kdGl0bGVPYmplY3QgPSB0aGlzLmdldENoaWxkKCd0aXRsZScpO1xuICAgICAgICB0aGlzLiRiYXJPYmplY3RIID0gdGhpcy5nZXRDaGlsZCgnYmFyJyk7XG4gICAgICAgIHRoaXMuJGJhck9iamVjdFYgPSB0aGlzLmdldENoaWxkKCdiYXJfdicpO1xuICAgICAgICB0aGlzLiRhbmlPYmplY3QgPSB0aGlzLmdldENoaWxkKCdhbmknKTtcbiAgICAgICAgdGhpcy4kZ3JpcE9iamVjdCA9IHRoaXMuZ2V0Q2hpbGQoJ2dyaXAnKTtcbiAgICAgICAgaWYgKHRoaXMuJGJhck9iamVjdEgpIHtcbiAgICAgICAgICAgIHRoaXMuJGJhck1heFdpZHRoID0gdGhpcy4kYmFyT2JqZWN0SC53aWR0aDtcbiAgICAgICAgICAgIHRoaXMuJGJhck1heFdpZHRoRGVsdGEgPSB0aGlzLndpZHRoIC0gdGhpcy4kYmFyTWF4V2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuJGJhck9iamVjdFYpIHtcbiAgICAgICAgICAgIHRoaXMuJGJhck1heEhlaWdodCA9IHRoaXMuJGJhck9iamVjdFYuaGVpZ2h0O1xuICAgICAgICAgICAgdGhpcy4kYmFyTWF4SGVpZ2h0RGVsdGEgPSB0aGlzLmhlaWdodCAtIHRoaXMuJGJhck1heEhlaWdodDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy4kZ3JpcE9iamVjdClcbiAgICAgICAgICAgIHRoaXMuJGdyaXBPYmplY3Qub24oSW50ZXJhY3RpdmVFdmVudHMuRG93biwgdGhpcy4kZ3JpcE1vdXNlRG93biwgdGhpcyk7XG4gICAgfVxuICAgICRncmlwTW91c2VEb3duKGV2dCkge1xuICAgICAgICB0aGlzLiRjbGlja1BvcyA9IHRoaXMuZ2xvYmFsVG9Mb2NhbChldnQuc3RhZ2VYLCBldnQuc3RhZ2VZKTtcbiAgICAgICAgdGhpcy4kY2xpY2tQZXJjZW50ID0gdGhpcy4kdmFsdWUgLyB0aGlzLiRtYXg7XG4gICAgICAgIHRoaXMuJG1vdXNlTW92ZUV2ZW50ID0gR1Jvb3QuaW5zdC5uYXRpdmVTdGFnZS5vbihJbnRlcmFjdGl2ZUV2ZW50cy5Nb3ZlLCB0aGlzLiRncmlwTW91c2VNb3ZlLCB0aGlzKTtcbiAgICAgICAgdGhpcy4kbW91c2VVcEV2ZW50ID0gR1Jvb3QuaW5zdC5uYXRpdmVTdGFnZS5vbihJbnRlcmFjdGl2ZUV2ZW50cy5VcCwgdGhpcy4kZ3JpcE1vdXNlVXAsIHRoaXMpO1xuICAgIH1cbiAgICAkZ3JpcE1vdXNlTW92ZShldnQpIHtcbiAgICAgICAgbGV0IHB0ID0gdGhpcy5nbG9iYWxUb0xvY2FsKGV2dC5zdGFnZVgsIGV2dC5zdGFnZVksIEdTbGlkZXIuc1NpbGRlckhlbHBlclBvaW50KTtcbiAgICAgICAgbGV0IGRlbHRhWCA9IHB0LnggLSB0aGlzLiRjbGlja1Bvcy54O1xuICAgICAgICBsZXQgZGVsdGFZID0gcHQueSAtIHRoaXMuJGNsaWNrUG9zLnk7XG4gICAgICAgIGxldCBwZXJjZW50O1xuICAgICAgICBpZiAodGhpcy4kYmFyT2JqZWN0SClcbiAgICAgICAgICAgIHBlcmNlbnQgPSB0aGlzLiRjbGlja1BlcmNlbnQgKyBkZWx0YVggLyB0aGlzLiRiYXJNYXhXaWR0aDtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcGVyY2VudCA9IHRoaXMuJGNsaWNrUGVyY2VudCArIGRlbHRhWSAvIHRoaXMuJGJhck1heEhlaWdodDtcbiAgICAgICAgaWYgKHBlcmNlbnQgPiAxKVxuICAgICAgICAgICAgcGVyY2VudCA9IDE7XG4gICAgICAgIGVsc2UgaWYgKHBlcmNlbnQgPCAwKVxuICAgICAgICAgICAgcGVyY2VudCA9IDA7XG4gICAgICAgIGxldCBuZXdWYWx1ZSA9IE1hdGgucm91bmQodGhpcy4kbWF4ICogcGVyY2VudCk7XG4gICAgICAgIGlmIChuZXdWYWx1ZSAhPSB0aGlzLiR2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kdmFsdWUgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgIGxldCBldnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoXCJfX3N0YXRlQ2hhbmdlZFwiIC8qIENIQU5HRUQgKi8sIHRydWUsIGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChldnQsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudXBkYXRlV2lkdGhQZXJjZW50KHBlcmNlbnQpO1xuICAgIH1cbiAgICAkZ3JpcE1vdXNlVXAoZXZ0KSB7XG4gICAgICAgIGxldCBwZXJjZW50ID0gdGhpcy4kdmFsdWUgLyB0aGlzLiRtYXg7XG4gICAgICAgIHRoaXMudXBkYXRlV2lkdGhQZXJjZW50KHBlcmNlbnQpO1xuICAgICAgICBHUm9vdC5pbnN0Lm5hdGl2ZVN0YWdlLm9mZihJbnRlcmFjdGl2ZUV2ZW50cy5Nb3ZlLCB0aGlzLiRtb3VzZU1vdmVFdmVudCk7XG4gICAgICAgIEdSb290Lmluc3QubmF0aXZlU3RhZ2Uub2ZmKEludGVyYWN0aXZlRXZlbnRzLlVwLCB0aGlzLiRtb3VzZVVwRXZlbnQpO1xuICAgIH1cbiAgICBkaXNwb3NlKCkge1xuICAgICAgICBpZiAodGhpcy4kZ3JpcE9iamVjdClcbiAgICAgICAgICAgIHRoaXMuJGdyaXBPYmplY3Qub2ZmKEludGVyYWN0aXZlRXZlbnRzLkRvd24sIHRoaXMuJGdyaXBNb3VzZURvd24pO1xuICAgICAgICBHUm9vdC5pbnN0Lm5hdGl2ZVN0YWdlLm9mZihJbnRlcmFjdGl2ZUV2ZW50cy5Nb3ZlLCB0aGlzLiRtb3VzZU1vdmVFdmVudCk7XG4gICAgICAgIEdSb290Lmluc3QubmF0aXZlU3RhZ2Uub2ZmKEludGVyYWN0aXZlRXZlbnRzLlVwLCB0aGlzLiRtb3VzZVVwRXZlbnQpO1xuICAgICAgICBzdXBlci5kaXNwb3NlKCk7XG4gICAgfVxufVxuR1NsaWRlci5zU2lsZGVySGVscGVyUG9pbnQgPSBuZXcgY3JlYXRlanMuUG9pbnQoKTtcblxuY2xhc3MgR1Byb2dyZXNzQmFyIGV4dGVuZHMgR0NvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuJG1heCA9IDA7XG4gICAgICAgIHRoaXMuJHZhbHVlID0gMDtcbiAgICAgICAgdGhpcy4kYmFyTWF4V2lkdGggPSAwO1xuICAgICAgICB0aGlzLiRiYXJNYXhIZWlnaHQgPSAwO1xuICAgICAgICB0aGlzLiRiYXJNYXhXaWR0aERlbHRhID0gMDtcbiAgICAgICAgdGhpcy4kYmFyTWF4SGVpZ2h0RGVsdGEgPSAwO1xuICAgICAgICB0aGlzLiRiYXJTdGFydFggPSAwO1xuICAgICAgICB0aGlzLiRiYXJTdGFydFkgPSAwO1xuICAgICAgICB0aGlzLiR0d2VlblZhbHVlID0gMDtcbiAgICAgICAgdGhpcy4kdGl0bGVUeXBlID0gMCAvKiBQZXJjZW50ICovO1xuICAgICAgICB0aGlzLiR2YWx1ZSA9IDUwO1xuICAgICAgICB0aGlzLiRtYXggPSAxMDA7XG4gICAgfVxuICAgIGdldCB0aXRsZVR5cGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR0aXRsZVR5cGU7XG4gICAgfVxuICAgIHNldCB0aXRsZVR5cGUodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJHRpdGxlVHlwZSAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kdGl0bGVUeXBlID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSh0aGlzLiR2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IG1heCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJG1heDtcbiAgICB9XG4gICAgc2V0IG1heCh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kbWF4ICE9IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiRtYXggPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKHRoaXMuJHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgdmFsdWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR2YWx1ZTtcbiAgICB9XG4gICAgc2V0IHZhbHVlKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiR0d2VlbmVyICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuJHR3ZWVuZXIucGF1c2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuJHR3ZWVuZXIgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLiR2YWx1ZSAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kdmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKHRoaXMuJHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB0d2VlblZhbHVlKHZhbHVlLCBkdXJhdGlvbikge1xuICAgICAgICBpZiAodGhpcy4kdmFsdWUgIT0gdmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiR0d2VlbmVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kdHdlZW5lci5wYXVzZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuJHR3ZWVuZXIucmVtb3ZlQWxsRXZlbnRMaXN0ZW5lcnMoKTtcbiAgICAgICAgICAgICAgICBjcmVhdGVqcy5Ud2Vlbi5yZW1vdmVUd2VlbnModGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLiR0d2VlblZhbHVlID0gdGhpcy4kdmFsdWU7XG4gICAgICAgICAgICB0aGlzLiR2YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy4kdHdlZW5lciA9IGNyZWF0ZWpzLlR3ZWVuLmdldCh0aGlzLCB7XG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IEJpbmRlci5jcmVhdGUodGhpcy5vblVwZGF0ZVR3ZWVuLCB0aGlzKVxuICAgICAgICAgICAgfSkudG8oeyAkdHdlZW5WYWx1ZTogdmFsdWUgfSwgZHVyYXRpb24gKiAxMDAwLCBHUHJvZ3Jlc3NCYXIuZWFzZUxpbmVhcik7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kdHdlZW5lcjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgb25VcGRhdGVUd2VlbigpIHtcbiAgICAgICAgdGhpcy51cGRhdGUodGhpcy4kdHdlZW5WYWx1ZSk7XG4gICAgfVxuICAgIHVwZGF0ZSh2YWwpIHtcbiAgICAgICAgbGV0IHBlcmNlbnQgPSB0aGlzLiRtYXggIT0gMCA/IE1hdGgubWluKHZhbCAvIHRoaXMuJG1heCwgMSkgOiAwO1xuICAgICAgICBpZiAodGhpcy4kdGl0bGVPYmplY3QpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy4kdGl0bGVUeXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAwIC8qIFBlcmNlbnQgKi86XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHRpdGxlT2JqZWN0LnRleHQgPSBgJHtNYXRoLnJvdW5kKHBlcmNlbnQgKiAxMDApfSVgO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDEgLyogVmFsdWVBbmRNYXggKi86XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHRpdGxlT2JqZWN0LnRleHQgPSBgJHtNYXRoLnJvdW5kKHZhbCl9LyR7TWF0aC5yb3VuZCh0aGlzLiRtYXgpfWA7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMiAvKiBWYWx1ZSAqLzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kdGl0bGVPYmplY3QudGV4dCA9IGAke01hdGgucm91bmQodmFsKX1gO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDMgLyogTWF4ICovOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLiR0aXRsZU9iamVjdC50ZXh0ID0gYCR7TWF0aC5yb3VuZCh0aGlzLiRtYXgpfWA7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGxldCBmdWxsV2lkdGggPSB0aGlzLndpZHRoIC0gdGhpcy4kYmFyTWF4V2lkdGhEZWx0YTtcbiAgICAgICAgbGV0IGZ1bGxIZWlnaHQgPSB0aGlzLmhlaWdodCAtIHRoaXMuJGJhck1heEhlaWdodERlbHRhO1xuICAgICAgICBpZiAoIXRoaXMuJHJldmVyc2UpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRiYXJPYmplY3RIKVxuICAgICAgICAgICAgICAgIHRoaXMuJGJhck9iamVjdEgud2lkdGggPSBmdWxsV2lkdGggKiBwZXJjZW50O1xuICAgICAgICAgICAgaWYgKHRoaXMuJGJhck9iamVjdFYpXG4gICAgICAgICAgICAgICAgdGhpcy4kYmFyT2JqZWN0Vi5oZWlnaHQgPSBmdWxsSGVpZ2h0ICogcGVyY2VudDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRiYXJPYmplY3RIKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kYmFyT2JqZWN0SC53aWR0aCA9IGZ1bGxXaWR0aCAqIHBlcmNlbnQ7XG4gICAgICAgICAgICAgICAgdGhpcy4kYmFyT2JqZWN0SC54ID0gdGhpcy4kYmFyU3RhcnRYICsgKGZ1bGxXaWR0aCAtIHRoaXMuJGJhck9iamVjdEgud2lkdGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuJGJhck9iamVjdFYpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRiYXJPYmplY3RWLmhlaWdodCA9IGZ1bGxIZWlnaHQgKiBwZXJjZW50O1xuICAgICAgICAgICAgICAgIHRoaXMuJGJhck9iamVjdFYueSA9IHRoaXMuJGJhclN0YXJ0WSArIChmdWxsSGVpZ2h0IC0gdGhpcy4kYmFyT2JqZWN0Vi5oZWlnaHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLiRhbmlPYmplY3QgaW5zdGFuY2VvZiBHTW92aWVDbGlwKVxuICAgICAgICAgICAgdGhpcy4kYW5pT2JqZWN0LmZyYW1lID0gTWF0aC5yb3VuZChwZXJjZW50ICogMTAwKTtcbiAgICB9XG4gICAgY29uc3RydWN0RnJvbVhNTCh4bWwpIHtcbiAgICAgICAgc3VwZXIuY29uc3RydWN0RnJvbVhNTCh4bWwpO1xuICAgICAgICB4bWwgPSBYbWxQYXJzZXIuZ2V0Q2hpbGROb2Rlcyh4bWwsICdQcm9ncmVzc0JhcicpWzBdO1xuICAgICAgICBsZXQgc3RyO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy50aXRsZVR5cGU7XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICB0aGlzLiR0aXRsZVR5cGUgPSBQYXJzZVByb2dyZXNzVGl0bGVUeXBlKHN0cik7XG4gICAgICAgIHRoaXMuJHJldmVyc2UgPSB4bWwuYXR0cmlidXRlcy5yZXZlcnNlID09ICd0cnVlJztcbiAgICAgICAgdGhpcy4kdGl0bGVPYmplY3QgPSB0aGlzLmdldENoaWxkKCd0aXRsZScpO1xuICAgICAgICB0aGlzLiRiYXJPYmplY3RIID0gdGhpcy5nZXRDaGlsZCgnYmFyJyk7XG4gICAgICAgIHRoaXMuJGJhck9iamVjdFYgPSB0aGlzLmdldENoaWxkKCdiYXJfdicpO1xuICAgICAgICB0aGlzLiRhbmlPYmplY3QgPSB0aGlzLmdldENoaWxkKCdhbmknKTtcbiAgICAgICAgaWYgKHRoaXMuJGJhck9iamVjdEgpIHtcbiAgICAgICAgICAgIHRoaXMuJGJhck1heFdpZHRoID0gdGhpcy4kYmFyT2JqZWN0SC53aWR0aDtcbiAgICAgICAgICAgIHRoaXMuJGJhck1heFdpZHRoRGVsdGEgPSB0aGlzLndpZHRoIC0gdGhpcy4kYmFyTWF4V2lkdGg7XG4gICAgICAgICAgICB0aGlzLiRiYXJTdGFydFggPSB0aGlzLiRiYXJPYmplY3RILng7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuJGJhck9iamVjdFYpIHtcbiAgICAgICAgICAgIHRoaXMuJGJhck1heEhlaWdodCA9IHRoaXMuJGJhck9iamVjdFYuaGVpZ2h0O1xuICAgICAgICAgICAgdGhpcy4kYmFyTWF4SGVpZ2h0RGVsdGEgPSB0aGlzLmhlaWdodCAtIHRoaXMuJGJhck1heEhlaWdodDtcbiAgICAgICAgICAgIHRoaXMuJGJhclN0YXJ0WSA9IHRoaXMuJGJhck9iamVjdFYueTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBoYW5kbGVTaXplQ2hhbmdlZCgpIHtcbiAgICAgICAgc3VwZXIuaGFuZGxlU2l6ZUNoYW5nZWQoKTtcbiAgICAgICAgaWYgKHRoaXMuJGJhck9iamVjdEgpXG4gICAgICAgICAgICB0aGlzLiRiYXJNYXhXaWR0aCA9IHRoaXMud2lkdGggLSB0aGlzLiRiYXJNYXhXaWR0aERlbHRhO1xuICAgICAgICBpZiAodGhpcy4kYmFyT2JqZWN0VilcbiAgICAgICAgICAgIHRoaXMuJGJhck1heEhlaWdodCA9IHRoaXMuaGVpZ2h0IC0gdGhpcy4kYmFyTWF4SGVpZ2h0RGVsdGE7XG4gICAgICAgIGlmICghdGhpcy4kaW5Qcm9ncmVzc0J1aWxkaW5nKVxuICAgICAgICAgICAgdGhpcy51cGRhdGUodGhpcy4kdmFsdWUpO1xuICAgIH1cbiAgICBzZXR1cEFmdGVyQWRkKHhtbCkge1xuICAgICAgICBzdXBlci5zZXR1cEFmdGVyQWRkKHhtbCk7XG4gICAgICAgIHhtbCA9IFhtbFBhcnNlci5nZXRDaGlsZE5vZGVzKHhtbCwgJ1Byb2dyZXNzQmFyJylbMF07XG4gICAgICAgIGlmICh4bWwpIHtcbiAgICAgICAgICAgIHRoaXMuJHZhbHVlID0gcGFyc2VJbnQoeG1sLmF0dHJpYnV0ZXMudmFsdWUpIHx8IDA7XG4gICAgICAgICAgICB0aGlzLiRtYXggPSBwYXJzZUludCh4bWwuYXR0cmlidXRlcy5tYXgpIHx8IDA7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cGRhdGUodGhpcy4kdmFsdWUpO1xuICAgIH1cbiAgICBkaXNwb3NlKCkge1xuICAgICAgICBpZiAodGhpcy4kdHdlZW5lcikge1xuICAgICAgICAgICAgdGhpcy4kdHdlZW5lci5wYXVzZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy4kdHdlZW5lci5yZW1vdmVBbGxFdmVudExpc3RlbmVycygpO1xuICAgICAgICB9XG4gICAgICAgIGNyZWF0ZWpzLlR3ZWVuLnJlbW92ZVR3ZWVucyh0aGlzKTtcbiAgICAgICAgdGhpcy4kdHdlZW5lciA9IG51bGw7XG4gICAgICAgIHN1cGVyLmRpc3Bvc2UoKTtcbiAgICB9XG59XG5HUHJvZ3Jlc3NCYXIuZWFzZUxpbmVhciA9IFBhcnNlRWFzZVR5cGUoJ2xpbmVhcicpOyAvLyBjcmVhdGVqcy5FYXNlLmdldFBvd0luKDEpO1xuXG5jbGFzcyBHU2Nyb2xsQmFyIGV4dGVuZHMgR0NvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuJGRyYWdPZmZzZXQgPSBuZXcgY3JlYXRlanMuUG9pbnQoKTtcbiAgICAgICAgdGhpcy4kc2Nyb2xsUGVyYyA9IDA7XG4gICAgfVxuICAgIHNldFNjcm9sbFBhbmUodGFyZ2V0LCB2ZXJ0aWNhbCkge1xuICAgICAgICB0aGlzLiR0YXJnZXQgPSB0YXJnZXQ7XG4gICAgICAgIHRoaXMuJHZlcnRpY2FsID0gdmVydGljYWw7XG4gICAgfVxuICAgIHNldCBkaXNwbGF5UGVyYyh2YWwpIHtcbiAgICAgICAgaWYgKHRoaXMuJHZlcnRpY2FsKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuJGZpeGVkR3JpcFNpemUpXG4gICAgICAgICAgICAgICAgdGhpcy4kZ3JpcC5oZWlnaHQgPSB2YWwgKiB0aGlzLiRiYXIuaGVpZ2h0O1xuICAgICAgICAgICAgdGhpcy4kZ3JpcC55ID0gdGhpcy4kYmFyLnkgKyAodGhpcy4kYmFyLmhlaWdodCAtIHRoaXMuJGdyaXAuaGVpZ2h0KSAqIHRoaXMuJHNjcm9sbFBlcmM7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuJGZpeGVkR3JpcFNpemUpXG4gICAgICAgICAgICAgICAgdGhpcy4kZ3JpcC53aWR0aCA9IHZhbCAqIHRoaXMuJGJhci53aWR0aDtcbiAgICAgICAgICAgIHRoaXMuJGdyaXAueCA9IHRoaXMuJGJhci54ICsgKHRoaXMuJGJhci53aWR0aCAtIHRoaXMuJGdyaXAud2lkdGgpICogdGhpcy4kc2Nyb2xsUGVyYztcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgc2Nyb2xsUGVyYygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHNjcm9sbFBlcmM7XG4gICAgfVxuICAgIHNldCBzY3JvbGxQZXJjKHZhbCkge1xuICAgICAgICB0aGlzLiRzY3JvbGxQZXJjID0gdmFsO1xuICAgICAgICBpZiAodGhpcy4kdmVydGljYWwpXG4gICAgICAgICAgICB0aGlzLiRncmlwLnkgPSB0aGlzLiRiYXIueSArICh0aGlzLiRiYXIuaGVpZ2h0IC0gdGhpcy4kZ3JpcC5oZWlnaHQpICogdGhpcy4kc2Nyb2xsUGVyYztcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kZ3JpcC54ID0gdGhpcy4kYmFyLnggKyAodGhpcy4kYmFyLndpZHRoIC0gdGhpcy4kZ3JpcC53aWR0aCkgKiB0aGlzLiRzY3JvbGxQZXJjO1xuICAgIH1cbiAgICBnZXQgbWluU2l6ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuJHZlcnRpY2FsKVxuICAgICAgICAgICAgcmV0dXJuICgodGhpcy4kYXJyb3dCdXR0b24xICE9IG51bGwgPyB0aGlzLiRhcnJvd0J1dHRvbjEuaGVpZ2h0IDogMCkgK1xuICAgICAgICAgICAgICAgICh0aGlzLiRhcnJvd0J1dHRvbjIgIT0gbnVsbCA/IHRoaXMuJGFycm93QnV0dG9uMi5oZWlnaHQgOiAwKSk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiAoKHRoaXMuJGFycm93QnV0dG9uMSAhPSBudWxsID8gdGhpcy4kYXJyb3dCdXR0b24xLndpZHRoIDogMCkgK1xuICAgICAgICAgICAgICAgICh0aGlzLiRhcnJvd0J1dHRvbjIgIT0gbnVsbCA/IHRoaXMuJGFycm93QnV0dG9uMi53aWR0aCA6IDApKTtcbiAgICB9XG4gICAgY29uc3RydWN0RnJvbVhNTCh4bWwpIHtcbiAgICAgICAgc3VwZXIuY29uc3RydWN0RnJvbVhNTCh4bWwpO1xuICAgICAgICB4bWwgPSBYbWxQYXJzZXIuZ2V0Q2hpbGROb2Rlcyh4bWwsICdTY3JvbGxCYXInKVswXTtcbiAgICAgICAgaWYgKHhtbCAhPSBudWxsKVxuICAgICAgICAgICAgdGhpcy4kZml4ZWRHcmlwU2l6ZSA9IHhtbC5hdHRyaWJ1dGVzLmZpeGVkR3JpcFNpemUgPT0gJ3RydWUnO1xuICAgICAgICB0aGlzLiRncmlwID0gdGhpcy5nZXRDaGlsZCgnZ3JpcCcpO1xuICAgICAgICBpZiAoIXRoaXMuJGdyaXApIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJwbGVhc2UgY3JlYXRlIGFuZCBkZWZpbmUgJ2dyaXAnIGluIHRoZSBFZGl0b3IgZm9yIHRoZSBzY3JvbGxiYXJcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kYmFyID0gdGhpcy5nZXRDaGlsZCgnYmFyJyk7XG4gICAgICAgIGlmICghdGhpcy4kYmFyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwicGxlYXNlIGNyZWF0ZSBhbmQgZGVmaW5lICdiYXInIGluIHRoZSBFZGl0b3IgZm9yIHRoZSBzY3JvbGxiYXJcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kYXJyb3dCdXR0b24xID0gdGhpcy5nZXRDaGlsZCgnYXJyb3cxJyk7XG4gICAgICAgIHRoaXMuJGFycm93QnV0dG9uMiA9IHRoaXMuZ2V0Q2hpbGQoJ2Fycm93MicpO1xuICAgICAgICB0aGlzLiRncmlwLm9uKEludGVyYWN0aXZlRXZlbnRzLkRvd24sIHRoaXMuJGdyaXBNb3VzZURvd24sIHRoaXMpO1xuICAgICAgICBpZiAodGhpcy4kYXJyb3dCdXR0b24xKVxuICAgICAgICAgICAgdGhpcy4kYXJyb3dCdXR0b24xLm9uKEludGVyYWN0aXZlRXZlbnRzLkRvd24sIHRoaXMuJGFycm93QnV0dG9uMUNsaWNrLCB0aGlzKTtcbiAgICAgICAgaWYgKHRoaXMuJGFycm93QnV0dG9uMilcbiAgICAgICAgICAgIHRoaXMuJGFycm93QnV0dG9uMi5vbihJbnRlcmFjdGl2ZUV2ZW50cy5Eb3duLCB0aGlzLiRhcnJvd0J1dHRvbjJDbGljaywgdGhpcyk7XG4gICAgICAgIHRoaXMub24oSW50ZXJhY3RpdmVFdmVudHMuRG93biwgdGhpcy4kYmFyTW91c2VEb3duLCB0aGlzKTtcbiAgICB9XG4gICAgJGdyaXBNb3VzZURvd24oZXZ0KSB7XG4gICAgICAgIGlmICghdGhpcy4kYmFyKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIC8vIHRoaXMuJGRyYWdPZmZzZXQgPSBldnQuZGF0YS5nZXRMb2NhbFBvc2l0aW9uKHRoaXMuZGlzcGxheU9iamVjdCwgdGhpcy4kZHJhZ09mZnNldCk7XG4gICAgICAgIHRoaXMuJGRyYWdPZmZzZXQgPSBuZXcgY3JlYXRlanMuUG9pbnQoZXZ0LmxvY2FsWCwgZXZ0LmxvY2FsWSk7XG4gICAgICAgIHRoaXMuJGRyYWdPZmZzZXQueCAtPSB0aGlzLiRncmlwLng7XG4gICAgICAgIHRoaXMuJGRyYWdPZmZzZXQueSAtPSB0aGlzLiRncmlwLnk7XG4gICAgICAgIHRoaXMuJG1vdXNlTW92ZUV2ZW50ID0gR1Jvb3QuaW5zdC5uYXRpdmVTdGFnZS5vbihJbnRlcmFjdGl2ZUV2ZW50cy5Nb3ZlLCB0aGlzLiRncmlwRHJhZ2dpbmcsIHRoaXMpO1xuICAgICAgICB0aGlzLiRtb3VzZVVwRXZlbnQgPSBHUm9vdC5pbnN0Lm5hdGl2ZVN0YWdlLm9uKEludGVyYWN0aXZlRXZlbnRzLlVwLCB0aGlzLiRncmlwRHJhZ2dpbmdFbmQsIHRoaXMpO1xuICAgIH1cbiAgICAkZ3JpcERyYWdnaW5nKGV2dCkge1xuICAgICAgICBsZXQgcHQgPSBldnQudGFyZ2V0LmxvY2FsVG9Mb2NhbChldnQubG9jYWxYLCBldnQubG9jYWxZLCB0aGlzLiRkaXNwbGF5T2JqZWN0KTsgLy8gdG9kb1xuICAgICAgICBpZiAoR1Njcm9sbEJhci5zU2Nyb2xsYmFySGVscGVyUG9pbnQueCA9PSAwICYmIEdTY3JvbGxCYXIuc1Njcm9sbGJhckhlbHBlclBvaW50LnkgPT0gMCkge1xuICAgICAgICAgICAgR1Njcm9sbEJhci5zU2Nyb2xsYmFySGVscGVyUG9pbnQueCA9IHRoaXMuJHRhcmdldFsnJHhQb3MnXTtcbiAgICAgICAgICAgIEdTY3JvbGxCYXIuc1Njcm9sbGJhckhlbHBlclBvaW50LnkgPSB0aGlzLiR0YXJnZXRbJyR5UG9zJ107XG4gICAgICAgIH1cbiAgICAgICAgcHQueCAtPSBHU2Nyb2xsQmFyLnNTY3JvbGxiYXJIZWxwZXJQb2ludC54O1xuICAgICAgICBwdC55IC09IEdTY3JvbGxCYXIuc1Njcm9sbGJhckhlbHBlclBvaW50Lnk7XG4gICAgICAgIGlmICh0aGlzLiR2ZXJ0aWNhbCkge1xuICAgICAgICAgICAgbGV0IGN1clkgPSBwdC55IC0gdGhpcy4kZHJhZ09mZnNldC55O1xuICAgICAgICAgICAgdGhpcy4kdGFyZ2V0LnNldFBlcmNZKChjdXJZIC0gdGhpcy4kYmFyLnkpIC8gKHRoaXMuJGJhci5oZWlnaHQgLSB0aGlzLiRncmlwLmhlaWdodCksIGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGxldCBjdXJYID0gcHQueCAtIHRoaXMuJGRyYWdPZmZzZXQueDtcbiAgICAgICAgICAgIHRoaXMuJHRhcmdldC5zZXRQZXJjWCgoY3VyWCAtIHRoaXMuJGJhci54KSAvICh0aGlzLiRiYXIud2lkdGggLSB0aGlzLiRncmlwLndpZHRoKSwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgfVxuICAgICRncmlwRHJhZ2dpbmdFbmQoZXZ0KSB7XG4gICAgICAgIEdTY3JvbGxCYXIuc1Njcm9sbGJhckhlbHBlclBvaW50ID0gbmV3IGNyZWF0ZWpzLlBvaW50KCk7XG4gICAgICAgIEdSb290Lmluc3QubmF0aXZlU3RhZ2Uub2ZmKEludGVyYWN0aXZlRXZlbnRzLk1vdmUsIHRoaXMuJG1vdXNlTW92ZUV2ZW50KTtcbiAgICAgICAgR1Jvb3QuaW5zdC5uYXRpdmVTdGFnZS5vZmYoSW50ZXJhY3RpdmVFdmVudHMuVXAsIHRoaXMuJG1vdXNlVXBFdmVudCk7XG4gICAgfVxuICAgICRhcnJvd0J1dHRvbjFDbGljayhldnQpIHtcbiAgICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBpZiAodGhpcy4kdmVydGljYWwpXG4gICAgICAgICAgICB0aGlzLiR0YXJnZXQuc2Nyb2xsVXAoKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kdGFyZ2V0LnNjcm9sbExlZnQoKTtcbiAgICB9XG4gICAgJGFycm93QnV0dG9uMkNsaWNrKGV2dCkge1xuICAgICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGlmICh0aGlzLiR2ZXJ0aWNhbClcbiAgICAgICAgICAgIHRoaXMuJHRhcmdldC5zY3JvbGxEb3duKCk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRoaXMuJHRhcmdldC5zY3JvbGxSaWdodCgpO1xuICAgIH1cbiAgICAkYmFyTW91c2VEb3duKGV2dCkge1xuICAgICAgICBsZXQgcHQgPSBuZXcgY3JlYXRlanMuUG9pbnQoZXZ0LmxvY2FsWCwgZXZ0LmxvY2FsWSk7XG4gICAgICAgIC8vIGxldCBwdDogY3JlYXRlanMuUG9pbnQgPSBldnQuZGF0YS5nZXRMb2NhbFBvc2l0aW9uKHRoaXMuJGdyaXAuZGlzcGxheU9iamVjdCwgR1Njcm9sbEJhci5zU2Nyb2xsYmFySGVscGVyUG9pbnQpO1xuICAgICAgICBpZiAodGhpcy4kdmVydGljYWwpIHtcbiAgICAgICAgICAgIGlmIChwdC55IDwgMClcbiAgICAgICAgICAgICAgICB0aGlzLiR0YXJnZXQuc2Nyb2xsVXAoNCk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGhpcy4kdGFyZ2V0LnNjcm9sbERvd24oNCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAocHQueCA8IDApXG4gICAgICAgICAgICAgICAgdGhpcy4kdGFyZ2V0LnNjcm9sbExlZnQoNCk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGhpcy4kdGFyZ2V0LnNjcm9sbFJpZ2h0KDQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGRpc3Bvc2UoKSB7XG4gICAgICAgIHRoaXMub2ZmKEludGVyYWN0aXZlRXZlbnRzLkRvd24sIHRoaXMuJGJhck1vdXNlRG93bik7XG4gICAgICAgIEdTY3JvbGxCYXIuc1Njcm9sbGJhckhlbHBlclBvaW50ID0gbmV3IGNyZWF0ZWpzLlBvaW50KCk7XG4gICAgICAgIGlmICh0aGlzLiRhcnJvd0J1dHRvbjEpXG4gICAgICAgICAgICB0aGlzLiRhcnJvd0J1dHRvbjEub2ZmKEludGVyYWN0aXZlRXZlbnRzLkRvd24sIHRoaXMuJGFycm93QnV0dG9uMUNsaWNrKTtcbiAgICAgICAgaWYgKHRoaXMuJGFycm93QnV0dG9uMilcbiAgICAgICAgICAgIHRoaXMuJGFycm93QnV0dG9uMi5vZmYoSW50ZXJhY3RpdmVFdmVudHMuRG93biwgdGhpcy4kYXJyb3dCdXR0b24yQ2xpY2spO1xuICAgICAgICB0aGlzLiRncmlwLm9mZihJbnRlcmFjdGl2ZUV2ZW50cy5Eb3duLCB0aGlzLiRncmlwTW91c2VEb3duKTtcbiAgICAgICAgdGhpcy4kZ3JpcERyYWdnaW5nRW5kKG51bGwpO1xuICAgICAgICBzdXBlci5kaXNwb3NlKCk7XG4gICAgfVxufVxuR1Njcm9sbEJhci5zU2Nyb2xsYmFySGVscGVyUG9pbnQgPSBuZXcgY3JlYXRlanMuUG9pbnQoKTtcblxuY2xhc3MgSXRlbUluZm8ge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLndpZHRoID0gMDtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSAwO1xuICAgICAgICB0aGlzLnVwZGF0ZUZsYWcgPSAwO1xuICAgICAgICB0aGlzLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgfVxufVxuY2xhc3MgR0xpc3QgZXh0ZW5kcyBHQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy4kbGluZUNvdW50ID0gMDtcbiAgICAgICAgdGhpcy4kY29sdW1uQ291bnQgPSAwO1xuICAgICAgICB0aGlzLiRsaW5lR2FwID0gMDtcbiAgICAgICAgdGhpcy4kY29sdW1uR2FwID0gMDtcbiAgICAgICAgdGhpcy4kbGFzdFNlbGVjdGVkSW5kZXggPSAwO1xuICAgICAgICB0aGlzLiRudW1JdGVtcyA9IDA7XG4gICAgICAgIHRoaXMuJGZpcnN0SW5kZXggPSAwOyAvL3RvcCBsZWZ0IGluZGV4XG4gICAgICAgIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQgPSAwOyAvL2l0ZW0gY291bnQgaW4gb25lIGxpbmVcbiAgICAgICAgdGhpcy4kdmlydHVhbExpc3RDaGFuZ2VkID0gMCAvKiBOb25lICovO1xuICAgICAgICAvL3JlbmRlciBzb3J0aW5nIHR5cGVcbiAgICAgICAgdGhpcy4kYXBleEluZGV4ID0gMDtcbiAgICAgICAgdGhpcy4kY2hpbGRyZW5SZW5kZXJPcmRlciA9IDAgLyogQXNjZW50ICovO1xuICAgICAgICB0aGlzLiRpdGVtSW5mb1ZlciA9IDA7IC8vaXMgdGhlIGl0ZW0gdXNlZCBpbiB0aGUgY3VycmVudCBoYW5kbGluZyBvciBub3RcbiAgICAgICAgdGhpcy4kZW50ZXJDb3VudGVyID0gMDsgLy9iZWNhdXNlIHRoZSBoYW5kbGVTY3JvbGwgZnVuY3Rpb24gY2FuIGJlIHJlLWVudGVyZWQsIHNvIHRoaXMgdmFyaWFibGUgaXMgdXNlZCB0byBhdm9pZCBkZWFkLWxvY2tcbiAgICAgICAgdGhpcy4kdHJhY2tCb3VuZHMgPSB0cnVlO1xuICAgICAgICB0aGlzLiRwb29sID0gbmV3IEdPYmplY3RSZWN5Y2xlcigpO1xuICAgICAgICB0aGlzLiRsYXlvdXQgPSAwIC8qIFNpbmdsZUNvbHVtbiAqLztcbiAgICAgICAgdGhpcy4kYXV0b1Jlc2l6ZUl0ZW0gPSB0cnVlO1xuICAgICAgICB0aGlzLiRsYXN0U2VsZWN0ZWRJbmRleCA9IC0xO1xuICAgICAgICB0aGlzLiRzZWxlY3Rpb25Nb2RlID0gMCAvKiBTaW5nbGUgKi87XG4gICAgICAgIHRoaXMub3BhcXVlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zY3JvbGxJdGVtVG9WaWV3T25DbGljayA9IHRydWU7XG4gICAgICAgIHRoaXMuJGFsaWduID0gXCJsZWZ0XCIgLyogTGVmdCAqLztcbiAgICAgICAgdGhpcy4kdmVydGljYWxBbGlnbiA9IDAgLyogVG9wICovO1xuICAgICAgICB0aGlzLiRjb250YWluZXIgPSBuZXcgY3JlYXRlanMuQ29udGFpbmVyKCk7XG4gICAgICAgIHRoaXMuJHJvb3RDb250YWluZXIuYWRkQ2hpbGQodGhpcy4kY29udGFpbmVyKTtcbiAgICAgICAgdGhpcy4kY29udGFpbmVyLmN1cnNvciA9ICdwb2ludGVyJztcbiAgICB9XG4gICAgZ2V0IGNoaWxkcmVuUmVuZGVyT3JkZXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRjaGlsZHJlblJlbmRlck9yZGVyO1xuICAgIH1cbiAgICBzZXQgY2hpbGRyZW5SZW5kZXJPcmRlcih2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kY2hpbGRyZW5SZW5kZXJPcmRlciAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kY2hpbGRyZW5SZW5kZXJPcmRlciA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5hcHBlbmRDaGlsZHJlbkxpc3QoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgYXBleEluZGV4KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kYXBleEluZGV4O1xuICAgIH1cbiAgICBzZXQgYXBleEluZGV4KHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiRhcGV4SW5kZXggIT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuJGFwZXhJbmRleCA9IHZhbHVlO1xuICAgICAgICAgICAgaWYgKHRoaXMuJGNoaWxkcmVuUmVuZGVyT3JkZXIgPT0gMiAvKiBBcmNoICovKVxuICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kQ2hpbGRyZW5MaXN0KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqQG92ZXJyaWRlICovXG4gICAgYXBwZW5kQ2hpbGRyZW5MaXN0KCkge1xuICAgICAgICBjb25zdCBjbnQgPSB0aGlzLiRjaGlsZHJlbi5sZW5ndGg7XG4gICAgICAgIGlmIChjbnQgPT0gMClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbGV0IGk7XG4gICAgICAgIGxldCBjaGlsZDtcbiAgICAgICAgc3dpdGNoICh0aGlzLiRjaGlsZHJlblJlbmRlck9yZGVyKSB7XG4gICAgICAgICAgICBjYXNlIDAgLyogQXNjZW50ICovOlxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IHRoaXMuJGNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLmRpc3BsYXlPYmplY3QgIT0gbnVsbCAmJiBjaGlsZC5maW5hbFZpc2libGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLmFkZENoaWxkKGNoaWxkLmRpc3BsYXlPYmplY3QpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAxIC8qIERlc2NlbnQgKi86XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSBjbnQgLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLiRjaGlsZHJlbltpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZC5kaXNwbGF5T2JqZWN0ICE9IG51bGwgJiYgY2hpbGQuZmluYWxWaXNpYmxlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci5hZGRDaGlsZChjaGlsZC5kaXNwbGF5T2JqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMiAvKiBBcmNoICovOlxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuJGFwZXhJbmRleDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IHRoaXMuJGNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLmRpc3BsYXlPYmplY3QgIT0gbnVsbCAmJiBjaGlsZC5maW5hbFZpc2libGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLmFkZENoaWxkKGNoaWxkLmRpc3BsYXlPYmplY3QpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IGNudCAtIDE7IGkgPj0gdGhpcy4kYXBleEluZGV4OyBpLS0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkID0gdGhpcy4kY2hpbGRyZW5baV07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQuZGlzcGxheU9iamVjdCAhPSBudWxsICYmIGNoaWxkLmZpbmFsVmlzaWJsZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXIuYWRkQ2hpbGQoY2hpbGQuZGlzcGxheU9iamVjdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqQG92ZXJyaWRlICovXG4gICAgc2V0WFkoeHYsIHl2KSB7XG4gICAgICAgIGlmICh0aGlzLiR4ICE9IHh2IHx8IHRoaXMuJHkgIT0geXYpIHtcbiAgICAgICAgICAgIHRoaXMuJHggPSB4djtcbiAgICAgICAgICAgIHRoaXMuJHkgPSB5djtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlWFlDaGFuZ2VkKCk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUdlYXIoMSAvKiBYWSAqLyk7XG4gICAgICAgICAgICBpZiAoR09iamVjdC5kcmFnZ2luZ09iamVjdCA9PSB0aGlzICYmICFHT2JqZWN0LnNVcGRhdGluZ1doaWxlRHJhZ2dpbmcpXG4gICAgICAgICAgICAgICAgdGhpcy5sb2NhbFRvR2xvYmFsUmVjdCgwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCwgR09iamVjdC5zR2xvYmFsUmVjdCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqQG92ZXJyaWRlICovXG4gICAgJHNldENoaWxkSW5kZXgoY2hpbGQsIG9sZEluZGV4LCBpbmRleCA9IDApIHtcbiAgICAgICAgbGV0IGNudCA9IHRoaXMuJGNoaWxkcmVuLmxlbmd0aDtcbiAgICAgICAgaWYgKGluZGV4ID4gY250KVxuICAgICAgICAgICAgaW5kZXggPSBjbnQ7XG4gICAgICAgIGlmIChvbGRJbmRleCA9PSBpbmRleClcbiAgICAgICAgICAgIHJldHVybiBvbGRJbmRleDtcbiAgICAgICAgdGhpcy4kY2hpbGRyZW4uc3BsaWNlKG9sZEluZGV4LCAxKTtcbiAgICAgICAgdGhpcy4kY2hpbGRyZW4uc3BsaWNlKGluZGV4LCAwLCBjaGlsZCk7XG4gICAgICAgIGlmIChjaGlsZC5pbkNvbnRhaW5lcikge1xuICAgICAgICAgICAgbGV0IGRpc3BsYXlJbmRleCA9IDA7XG4gICAgICAgICAgICBsZXQgZztcbiAgICAgICAgICAgIGxldCBpO1xuICAgICAgICAgICAgaWYgKHRoaXMuJGNoaWxkcmVuUmVuZGVyT3JkZXIgPT0gMCAvKiBBc2NlbnQgKi8pIHtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaW5kZXg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBnID0gdGhpcy4kY2hpbGRyZW5baV07XG4gICAgICAgICAgICAgICAgICAgIGlmIChnLmluQ29udGFpbmVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheUluZGV4Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChkaXNwbGF5SW5kZXggPT0gdGhpcy4kY29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheUluZGV4LS07XG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnNldENoaWxkSW5kZXgoY2hpbGQuZGlzcGxheU9iamVjdCwgZGlzcGxheUluZGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuJGNoaWxkcmVuUmVuZGVyT3JkZXIgPT0gMSAvKiBEZXNjZW50ICovKSB7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gY250IC0gMTsgaSA+IGluZGV4OyBpLS0pIHtcbiAgICAgICAgICAgICAgICAgICAgZyA9IHRoaXMuJGNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZy5pbkNvbnRhaW5lcilcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlJbmRleCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZGlzcGxheUluZGV4ID09IHRoaXMuJGNvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlJbmRleC0tO1xuICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci5zZXRDaGlsZEluZGV4KGNoaWxkLmRpc3BsYXlPYmplY3QsIGRpc3BsYXlJbmRleCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgR1RpbWVyLmluc3QuY2FsbExhdGVyKHRoaXMuYXBwZW5kQ2hpbGRyZW5MaXN0LCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuc2V0Qm91bmRzQ2hhbmdlZEZsYWcoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaW5kZXg7XG4gICAgfVxuICAgIC8qKkBvdmVycmlkZSAqL1xuICAgIGNoaWxkU3RhdGVDaGFuZ2VkKGNoaWxkKSB7XG4gICAgICAgIGlmICh0aGlzLiRidWlsZGluZ0Rpc3BsYXlMaXN0KVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpZiAoY2hpbGQgaW5zdGFuY2VvZiBHR3JvdXApIHtcbiAgICAgICAgICAgIHRoaXMuJGNoaWxkcmVuLmZvckVhY2goZyA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGcuZ3JvdXAgPT0gY2hpbGQpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hpbGRTdGF0ZUNoYW5nZWQoZyk7XG4gICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNoaWxkLmRpc3BsYXlPYmplY3QpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmIChjaGlsZC5maW5hbFZpc2libGUpIHtcbiAgICAgICAgICAgIGxldCBpLCBnO1xuICAgICAgICAgICAgbGV0IGNudCA9IHRoaXMuJGNoaWxkcmVuLmxlbmd0aDtcbiAgICAgICAgICAgIGlmICghY2hpbGQuZGlzcGxheU9iamVjdC5wYXJlbnQpIHtcbiAgICAgICAgICAgICAgICBsZXQgaW5kZXggPSAwO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRjaGlsZHJlblJlbmRlck9yZGVyID09IDAgLyogQXNjZW50ICovKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY250OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLiRjaGlsZHJlbltpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnID09IGNoaWxkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGcuZGlzcGxheU9iamVjdCAhPSBudWxsICYmIGcuZGlzcGxheU9iamVjdC5wYXJlbnQgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci5hZGRDaGlsZEF0KGNoaWxkLmRpc3BsYXlPYmplY3QsIGluZGV4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy4kY2hpbGRyZW5SZW5kZXJPcmRlciA9PSAxIC8qIERlc2NlbnQgKi8pIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gY250IC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLiRjaGlsZHJlbltpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnID09IGNoaWxkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGcuZGlzcGxheU9iamVjdCAhPSBudWxsICYmIGcuZGlzcGxheU9iamVjdC5wYXJlbnQgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci5hZGRDaGlsZEF0KGNoaWxkLmRpc3BsYXlPYmplY3QsIGluZGV4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci5hZGRDaGlsZChjaGlsZC5kaXNwbGF5T2JqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgR1RpbWVyLmluc3QuY2FsbExhdGVyKHRoaXMuYXBwZW5kQ2hpbGRyZW5MaXN0LCB0aGlzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoY2hpbGQuZGlzcGxheU9iamVjdC5wYXJlbnQpXG4gICAgICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnJlbW92ZUNoaWxkKGNoaWxkLmRpc3BsYXlPYmplY3QpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGRpc3Bvc2UoKSB7XG4gICAgICAgIEdUaW1lci5pbnN0LnJlbW92ZSh0aGlzLiRyZWZyZXNoVmlydHVhbExpc3QsIHRoaXMpO1xuICAgICAgICB0aGlzLiRwb29sLmNsZWFyKCk7XG4gICAgICAgIGlmICh0aGlzLiRzY3JvbGxQYW5lKVxuICAgICAgICAgICAgdGhpcy4kc2Nyb2xsUGFuZS5vZmYoXCJfX3Njcm9sbFwiIC8qIFNDUk9MTCAqLywgdGhpcy4kc2Nyb2xsZWQpO1xuICAgICAgICBzdXBlci5kaXNwb3NlKCk7XG4gICAgfVxuICAgIGdldCBsYXlvdXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRsYXlvdXQ7XG4gICAgfVxuICAgIHNldCBsYXlvdXQodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJGxheW91dCAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kbGF5b3V0ID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnNldEJvdW5kc0NoYW5nZWRGbGFnKCk7XG4gICAgICAgICAgICBpZiAodGhpcy4kdmlydHVhbClcbiAgICAgICAgICAgICAgICB0aGlzLnNldFZpcnR1YWxMaXN0Q2hhbmdlZEZsYWcodHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGxpbmVDb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGxpbmVDb3VudDtcbiAgICB9XG4gICAgc2V0IGxpbmVDb3VudCh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kbGluZUNvdW50ICE9IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLiRsaW5lQ291bnQgPSB2YWx1ZTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRsYXlvdXQgPT0gMyAvKiBGbG93VmVydGljYWwgKi8gfHxcbiAgICAgICAgICAgICAgICB0aGlzLiRsYXlvdXQgPT0gNCAvKiBQYWdpbmF0aW9uICovKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRCb3VuZHNDaGFuZ2VkRmxhZygpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiR2aXJ0dWFsKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFZpcnR1YWxMaXN0Q2hhbmdlZEZsYWcodHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGNvbHVtbkNvdW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kY29sdW1uQ291bnQ7XG4gICAgfVxuICAgIHNldCBjb2x1bW5Db3VudCh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kY29sdW1uQ291bnQgIT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuJGNvbHVtbkNvdW50ID0gdmFsdWU7XG4gICAgICAgICAgICBpZiAodGhpcy4kbGF5b3V0ID09IDIgLyogRmxvd0hvcml6b250YWwgKi8gfHxcbiAgICAgICAgICAgICAgICB0aGlzLiRsYXlvdXQgPT0gNCAvKiBQYWdpbmF0aW9uICovKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRCb3VuZHNDaGFuZ2VkRmxhZygpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiR2aXJ0dWFsKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFZpcnR1YWxMaXN0Q2hhbmdlZEZsYWcodHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGxpbmVHYXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRsaW5lR2FwO1xuICAgIH1cbiAgICBzZXQgbGluZUdhcCh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kbGluZUdhcCAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kbGluZUdhcCA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5zZXRCb3VuZHNDaGFuZ2VkRmxhZygpO1xuICAgICAgICAgICAgaWYgKHRoaXMuJHZpcnR1YWwpXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRWaXJ0dWFsTGlzdENoYW5nZWRGbGFnKHRydWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBjb2x1bW5HYXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRjb2x1bW5HYXA7XG4gICAgfVxuICAgIHNldCBjb2x1bW5HYXAodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuJGNvbHVtbkdhcCAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kY29sdW1uR2FwID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnNldEJvdW5kc0NoYW5nZWRGbGFnKCk7XG4gICAgICAgICAgICBpZiAodGhpcy4kdmlydHVhbClcbiAgICAgICAgICAgICAgICB0aGlzLnNldFZpcnR1YWxMaXN0Q2hhbmdlZEZsYWcodHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGFsaWduKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kYWxpZ247XG4gICAgfVxuICAgIHNldCBhbGlnbih2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kYWxpZ24gIT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuJGFsaWduID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnNldEJvdW5kc0NoYW5nZWRGbGFnKCk7XG4gICAgICAgICAgICBpZiAodGhpcy4kdmlydHVhbClcbiAgICAgICAgICAgICAgICB0aGlzLnNldFZpcnR1YWxMaXN0Q2hhbmdlZEZsYWcodHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IHZlcnRpY2FsQWxpZ24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiR2ZXJ0aWNhbEFsaWduO1xuICAgIH1cbiAgICBzZXQgdmVydGljYWxBbGlnbih2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kdmVydGljYWxBbGlnbiAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kdmVydGljYWxBbGlnbiA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5zZXRCb3VuZHNDaGFuZ2VkRmxhZygpO1xuICAgICAgICAgICAgaWYgKHRoaXMuJHZpcnR1YWwpXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRWaXJ0dWFsTGlzdENoYW5nZWRGbGFnKHRydWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCB2aXJ0dWFsSXRlbVNpemUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRpdGVtU2l6ZTtcbiAgICB9XG4gICAgc2V0IHZpcnR1YWxJdGVtU2l6ZSh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy4kdmlydHVhbCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuJGl0ZW1TaXplID09IG51bGwpXG4gICAgICAgICAgICAgICAgdGhpcy4kaXRlbVNpemUgPSBuZXcgY3JlYXRlanMuUG9pbnQoKTtcbiAgICAgICAgICAgIHRoaXMuJGl0ZW1TaXplLmNvcHkodmFsdWUpO1xuICAgICAgICAgICAgdGhpcy5zZXRWaXJ0dWFsTGlzdENoYW5nZWRGbGFnKHRydWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBkZWZhdWx0SXRlbSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGRlZmF1bHRJdGVtO1xuICAgIH1cbiAgICBzZXQgZGVmYXVsdEl0ZW0odmFsKSB7XG4gICAgICAgIHRoaXMuJGRlZmF1bHRJdGVtID0gdmFsO1xuICAgIH1cbiAgICBnZXQgYXV0b1Jlc2l6ZUl0ZW0oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRhdXRvUmVzaXplSXRlbTtcbiAgICB9XG4gICAgc2V0IGF1dG9SZXNpemVJdGVtKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLiRhdXRvUmVzaXplSXRlbSAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy4kYXV0b1Jlc2l6ZUl0ZW0gPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMuc2V0Qm91bmRzQ2hhbmdlZEZsYWcoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLiR2aXJ0dWFsKVxuICAgICAgICAgICAgICAgIHRoaXMuc2V0VmlydHVhbExpc3RDaGFuZ2VkRmxhZyh0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgc2VsZWN0aW9uTW9kZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHNlbGVjdGlvbk1vZGU7XG4gICAgfVxuICAgIHNldCBzZWxlY3Rpb25Nb2RlKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuJHNlbGVjdGlvbk1vZGUgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IHNlbGVjdGlvbkNvbnRyb2xsZXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRzZWxlY3Rpb25Db250cm9sbGVyO1xuICAgIH1cbiAgICBzZXQgc2VsZWN0aW9uQ29udHJvbGxlcih2YWx1ZSkge1xuICAgICAgICB0aGlzLiRzZWxlY3Rpb25Db250cm9sbGVyID0gdmFsdWU7XG4gICAgfVxuICAgIGdldCBpdGVtUG9vbCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHBvb2w7XG4gICAgfVxuICAgIGdldEZyb21Qb29sKHVybCA9IG51bGwpIHtcbiAgICAgICAgaWYgKCF1cmwpXG4gICAgICAgICAgICB1cmwgPSB0aGlzLiRkZWZhdWx0SXRlbTtcbiAgICAgICAgbGV0IG9iaiA9IHRoaXMuJHBvb2wuZ2V0KHVybCk7XG4gICAgICAgIGlmIChvYmogIT0gbnVsbClcbiAgICAgICAgICAgIG9iai52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIG9iajtcbiAgICB9XG4gICAgcmV0dXJuVG9Qb29sKG9iaikge1xuICAgICAgICB0aGlzLiRwb29sLnJlY3ljbGUob2JqLnJlc291cmNlVVJMLCBvYmopO1xuICAgIH1cbiAgICBhZGRDaGlsZEF0KGNoaWxkLCBpbmRleCA9IDApIHtcbiAgICAgICAgc3VwZXIuYWRkQ2hpbGRBdChjaGlsZCwgaW5kZXgpO1xuICAgICAgICBpZiAoY2hpbGQgaW5zdGFuY2VvZiBHQnV0dG9uKSB7XG4gICAgICAgICAgICBjaGlsZC5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgY2hpbGQuY2hhbmdlU3RhdGVPbkNsaWNrID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY2hpbGQuY2xpY2sodGhpcy4kY2xpY2tJdGVtLCB0aGlzKTtcbiAgICAgICAgcmV0dXJuIGNoaWxkO1xuICAgIH1cbiAgICBhZGRJdGVtKHVybCA9IG51bGwpIHtcbiAgICAgICAgaWYgKCF1cmwpXG4gICAgICAgICAgICB1cmwgPSB0aGlzLiRkZWZhdWx0SXRlbTtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkQ2hpbGQoVUlQYWNrYWdlLmNyZWF0ZU9iamVjdEZyb21VUkwodXJsKSk7XG4gICAgfVxuICAgIGFkZEl0ZW1Gcm9tUG9vbCh1cmwgPSBudWxsKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFkZENoaWxkKHRoaXMuZ2V0RnJvbVBvb2wodXJsKSk7XG4gICAgfVxuICAgIHJlbW92ZUNoaWxkQXQoaW5kZXgsIGRpc3Bvc2UgPSBmYWxzZSkge1xuICAgICAgICBpZiAoaW5kZXggPj0gMCAmJiBpbmRleCA8IHRoaXMubnVtQ2hpbGRyZW4pIHtcbiAgICAgICAgICAgIGxldCBjaGlsZCA9IHRoaXMuJGNoaWxkcmVuW2luZGV4XTtcbiAgICAgICAgICAgIGNoaWxkLnBhcmVudCA9IG51bGw7XG4gICAgICAgICAgICBpZiAoY2hpbGQuc29ydGluZ09yZGVyICE9IDApXG4gICAgICAgICAgICAgICAgdGhpcy4kc29ydGluZ0NoaWxkQ291bnQtLTtcbiAgICAgICAgICAgIHRoaXMuJGNoaWxkcmVuLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICBpZiAoY2hpbGQuaW5Db250YWluZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXIucmVtb3ZlQ2hpbGQoY2hpbGQuZGlzcGxheU9iamVjdCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJGNoaWxkcmVuUmVuZGVyT3JkZXIgPT0gMiAvKiBBcmNoICovKVxuICAgICAgICAgICAgICAgICAgICBHVGltZXIuaW5zdC5jYWxsTGF0ZXIodGhpcy5hcHBlbmRDaGlsZHJlbkxpc3QsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRpc3Bvc2UgPT09IHRydWUpXG4gICAgICAgICAgICAgICAgY2hpbGQuZGlzcG9zZSgpO1xuICAgICAgICAgICAgdGhpcy5zZXRCb3VuZHNDaGFuZ2VkRmxhZygpO1xuICAgICAgICAgICAgY2hpbGQucmVtb3ZlQ2xpY2sodGhpcy4kY2xpY2tJdGVtKTtcbiAgICAgICAgICAgIHJldHVybiBjaGlsZDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgY2hpbGQgaW5kZXgnKTtcbiAgICB9XG4gICAgcmVtb3ZlQ2hpbGRUb1Bvb2xBdChpbmRleCkge1xuICAgICAgICBsZXQgY2hpbGQgPSB0aGlzLnJlbW92ZUNoaWxkQXQoaW5kZXgpO1xuICAgICAgICB0aGlzLnJldHVyblRvUG9vbChjaGlsZCk7XG4gICAgfVxuICAgIHJlbW92ZUNoaWxkVG9Qb29sKGNoaWxkKSB7XG4gICAgICAgIHN1cGVyLnJlbW92ZUNoaWxkKGNoaWxkKTtcbiAgICAgICAgdGhpcy5yZXR1cm5Ub1Bvb2woY2hpbGQpO1xuICAgIH1cbiAgICByZW1vdmVDaGlsZHJlblRvUG9vbChiZWdpbkluZGV4ID0gMCwgZW5kSW5kZXggPSAtMSkge1xuICAgICAgICBpZiAoZW5kSW5kZXggPCAwIHx8IGVuZEluZGV4ID49IHRoaXMuJGNoaWxkcmVuLmxlbmd0aClcbiAgICAgICAgICAgIGVuZEluZGV4ID0gdGhpcy4kY2hpbGRyZW4ubGVuZ3RoIC0gMTtcbiAgICAgICAgZm9yIChsZXQgaSA9IGJlZ2luSW5kZXg7IGkgPD0gZW5kSW5kZXg7ICsraSlcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2hpbGRUb1Bvb2xBdChiZWdpbkluZGV4KTtcbiAgICB9XG4gICAgZ2V0IHNlbGVjdGVkSW5kZXgoKSB7XG4gICAgICAgIGxldCBpO1xuICAgICAgICBpZiAodGhpcy4kdmlydHVhbCkge1xuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuJHJlYWxOdW1JdGVtczsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaWkgPSB0aGlzLiR2aXJ0dWFsSXRlbXNbaV07XG4gICAgICAgICAgICAgICAgaWYgKChpaS5vYmogaW5zdGFuY2VvZiBHQnV0dG9uICYmIGlpLm9iai5zZWxlY3RlZCkgfHwgKGlpLm9iaiA9PSBudWxsICYmIGlpLnNlbGVjdGVkKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kbG9vcClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpICUgdGhpcy4kbnVtSXRlbXM7XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGNudCA9IHRoaXMuJGNoaWxkcmVuLmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjbnQ7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IG9iaiA9IHRoaXMuJGNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgICAgIGlmIChvYmogIT0gbnVsbCAmJiBvYmouc2VsZWN0ZWQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgc2V0IHNlbGVjdGVkSW5kZXgodmFsdWUpIHtcbiAgICAgICAgaWYgKHZhbHVlID49IDAgJiYgdmFsdWUgPCB0aGlzLm51bUl0ZW1zKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25Nb2RlICE9IDAgLyogU2luZ2xlICovKVxuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgIHRoaXMuYWRkU2VsZWN0aW9uKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLmNsZWFyU2VsZWN0aW9uKCk7XG4gICAgfVxuICAgIGdldFNlbGVjdGlvbigpIHtcbiAgICAgICAgbGV0IHJldCA9IFtdO1xuICAgICAgICBsZXQgaTtcbiAgICAgICAgaWYgKHRoaXMuJHZpcnR1YWwpIHtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLiRyZWFsTnVtSXRlbXM7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGlpID0gdGhpcy4kdmlydHVhbEl0ZW1zW2ldO1xuICAgICAgICAgICAgICAgIGlmICgoaWkub2JqIGluc3RhbmNlb2YgR0J1dHRvbiAmJiBpaS5vYmouc2VsZWN0ZWQpIHx8IChpaS5vYmogPT0gbnVsbCAmJiBpaS5zZWxlY3RlZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGogPSBpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kbG9vcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaiA9IGkgJSB0aGlzLiRudW1JdGVtcztcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXQuaW5kZXhPZihqKSAhPSAtMSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXQucHVzaChqKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBjbnQgPSB0aGlzLiRjaGlsZHJlbi5sZW5ndGg7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY250OyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBvYmogPSB0aGlzLiRjaGlsZHJlbltpXTtcbiAgICAgICAgICAgICAgICBpZiAob2JqICE9IG51bGwgJiYgb2JqLnNlbGVjdGVkKVxuICAgICAgICAgICAgICAgICAgICByZXQucHVzaChpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH1cbiAgICBhZGRTZWxlY3Rpb24oaW5kZXgsIHNjcm9sbEludG9WaWV3ID0gZmFsc2UpIHtcbiAgICAgICAgaWYgKHRoaXMuJHNlbGVjdGlvbk1vZGUgPT0gMyAvKiBOb25lICovKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLmNoZWNrVmlydHVhbExpc3QoKTtcbiAgICAgICAgaWYgKHRoaXMuJHNlbGVjdGlvbk1vZGUgPT0gMCAvKiBTaW5nbGUgKi8pXG4gICAgICAgICAgICB0aGlzLmNsZWFyU2VsZWN0aW9uKCk7XG4gICAgICAgIGlmIChzY3JvbGxJbnRvVmlldylcbiAgICAgICAgICAgIHRoaXMuc2Nyb2xsVG9WaWV3KGluZGV4KTtcbiAgICAgICAgdGhpcy4kbGFzdFNlbGVjdGVkSW5kZXggPSBpbmRleDtcbiAgICAgICAgbGV0IG9iaiA9IG51bGw7XG4gICAgICAgIGlmICh0aGlzLiR2aXJ0dWFsKSB7XG4gICAgICAgICAgICBjb25zdCBpaSA9IHRoaXMuJHZpcnR1YWxJdGVtc1tpbmRleF07XG4gICAgICAgICAgICBpZiAoaWkub2JqICE9IG51bGwpXG4gICAgICAgICAgICAgICAgb2JqID0gaWkub2JqO1xuICAgICAgICAgICAgaWkuc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIG9iaiA9IHRoaXMuZ2V0Q2hpbGRBdChpbmRleCk7XG4gICAgICAgIGlmIChvYmogIT0gbnVsbCAmJiAhb2JqLnNlbGVjdGVkKSB7XG4gICAgICAgICAgICBvYmouc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVTZWxlY3Rpb25Db250cm9sbGVyKGluZGV4KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZW1vdmVTZWxlY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgaWYgKHRoaXMuJHNlbGVjdGlvbk1vZGUgPT0gMyAvKiBOb25lICovKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBsZXQgb2JqID0gbnVsbDtcbiAgICAgICAgaWYgKHRoaXMuJHZpcnR1YWwpIHtcbiAgICAgICAgICAgIGNvbnN0IGlpID0gdGhpcy4kdmlydHVhbEl0ZW1zW2luZGV4XTtcbiAgICAgICAgICAgIGlmIChpaS5vYmogIT0gbnVsbClcbiAgICAgICAgICAgICAgICBvYmogPSBpaS5vYmo7XG4gICAgICAgICAgICBpaS5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIG9iaiA9IHRoaXMuZ2V0Q2hpbGRBdChpbmRleCk7XG4gICAgICAgIGlmIChvYmogIT0gbnVsbClcbiAgICAgICAgICAgIG9iai5zZWxlY3RlZCA9IGZhbHNlO1xuICAgIH1cbiAgICBjbGVhclNlbGVjdGlvbigpIHtcbiAgICAgICAgbGV0IGk7XG4gICAgICAgIGlmICh0aGlzLiR2aXJ0dWFsKSB7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy4kcmVhbE51bUl0ZW1zOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpaSA9IHRoaXMuJHZpcnR1YWxJdGVtc1tpXTtcbiAgICAgICAgICAgICAgICBpZiAoaWkub2JqIGluc3RhbmNlb2YgR0J1dHRvbilcbiAgICAgICAgICAgICAgICAgICAgaWkub2JqLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWkuc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGNudCA9IHRoaXMuJGNoaWxkcmVuLmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjbnQ7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IG9iaiA9IHRoaXMuJGNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgICAgIGlmIChvYmogIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2xlYXJTZWxlY3Rpb25FeGNlcHQoZykge1xuICAgICAgICBsZXQgaTtcbiAgICAgICAgaWYgKHRoaXMuJHZpcnR1YWwpIHtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLiRyZWFsTnVtSXRlbXM7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGlpID0gdGhpcy4kdmlydHVhbEl0ZW1zW2ldO1xuICAgICAgICAgICAgICAgIGlmIChpaS5vYmogIT0gZykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaWkub2JqIGluc3RhbmNlb2YgR0J1dHRvbilcbiAgICAgICAgICAgICAgICAgICAgICAgIGlpLm9iai5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBpaS5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGNudCA9IHRoaXMuJGNoaWxkcmVuLmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjbnQ7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IG9iaiA9IHRoaXMuJGNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgICAgIGlmIChvYmogIT0gbnVsbCAmJiBvYmogIT0gZylcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2VsZWN0QWxsKCkge1xuICAgICAgICB0aGlzLmNoZWNrVmlydHVhbExpc3QoKTtcbiAgICAgICAgbGV0IGxhc3QgPSAtMTtcbiAgICAgICAgbGV0IGk7XG4gICAgICAgIGlmICh0aGlzLiR2aXJ0dWFsKSB7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy4kcmVhbE51bUl0ZW1zOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpaSA9IHRoaXMuJHZpcnR1YWxJdGVtc1tpXTtcbiAgICAgICAgICAgICAgICBpZiAoaWkub2JqIGluc3RhbmNlb2YgR0J1dHRvbiAmJiAhaWkub2JqLnNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlpLm9iai5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGxhc3QgPSBpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpaS5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBjbnQgPSB0aGlzLiRjaGlsZHJlbi5sZW5ndGg7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY250OyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBvYmogPSB0aGlzLiRjaGlsZHJlbltpXTtcbiAgICAgICAgICAgICAgICBpZiAob2JqICE9IG51bGwgJiYgIW9iai5zZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBsYXN0ID0gaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxhc3QgIT0gLTEpXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGlvbkNvbnRyb2xsZXIobGFzdCk7XG4gICAgfVxuICAgIHNlbGVjdE5vbmUoKSB7XG4gICAgICAgIHRoaXMuY2xlYXJTZWxlY3Rpb24oKTtcbiAgICB9XG4gICAgc2VsZWN0UmV2ZXJzZSgpIHtcbiAgICAgICAgdGhpcy5jaGVja1ZpcnR1YWxMaXN0KCk7XG4gICAgICAgIGxldCBsYXN0ID0gLTE7XG4gICAgICAgIGxldCBpO1xuICAgICAgICBpZiAodGhpcy4kdmlydHVhbCkge1xuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuJHJlYWxOdW1JdGVtczsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaWkgPSB0aGlzLiR2aXJ0dWFsSXRlbXNbaV07XG4gICAgICAgICAgICAgICAgaWYgKGlpLm9iaiBpbnN0YW5jZW9mIEdCdXR0b24pIHtcbiAgICAgICAgICAgICAgICAgICAgaWkub2JqLnNlbGVjdGVkID0gIWlpLm9iai5zZWxlY3RlZDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlpLm9iai5zZWxlY3RlZClcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QgPSBpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpaS5zZWxlY3RlZCA9ICFpaS5zZWxlY3RlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGNudCA9IHRoaXMuJGNoaWxkcmVuLmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjbnQ7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IG9iaiA9IHRoaXMuJGNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgICAgIGlmIChvYmogIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWQgPSAhb2JqLnNlbGVjdGVkO1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnNlbGVjdGVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdCA9IGk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChsYXN0ICE9IC0xKVxuICAgICAgICAgICAgdGhpcy51cGRhdGVTZWxlY3Rpb25Db250cm9sbGVyKGxhc3QpO1xuICAgIH1cbiAgICBoYW5kbGVBcnJvd0tleShrZXkpIHtcbiAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5zZWxlY3RlZEluZGV4O1xuICAgICAgICBpZiAoaW5kZXggPT0gLTEpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGxldCBjdXJyZW50O1xuICAgICAgICBsZXQgaywgaTtcbiAgICAgICAgbGV0IG9iajtcbiAgICAgICAgc3dpdGNoIChrZXkpIHtcbiAgICAgICAgICAgIGNhc2UgMzggLyogVXAgKi86XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJGxheW91dCA9PSAwIC8qIFNpbmdsZUNvbHVtbiAqLyB8fFxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRsYXlvdXQgPT0gMyAvKiBGbG93VmVydGljYWwgKi8pIHtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXgtLTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkU2VsZWN0aW9uKGluZGV4LCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLiRsYXlvdXQgPT0gMiAvKiBGbG93SG9yaXpvbnRhbCAqLyB8fFxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRsYXlvdXQgPT0gNCAvKiBQYWdpbmF0aW9uICovKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSB0aGlzLiRjaGlsZHJlbltpbmRleF07XG4gICAgICAgICAgICAgICAgICAgIGsgPSAwO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSBpbmRleCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmogPSB0aGlzLiRjaGlsZHJlbltpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoueSAhPSBjdXJyZW50LnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gb2JqO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaysrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZvciAoOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqID0gdGhpcy4kY2hpbGRyZW5baV07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnkgIT0gY3VycmVudC55KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhclNlbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkU2VsZWN0aW9uKGkgKyBrICsgMSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDM5IC8qIFJpZ2h0ICovOlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRsYXlvdXQgPT0gMSAvKiBTaW5nbGVSb3cgKi8gfHxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbGF5b3V0ID09IDIgLyogRmxvd0hvcml6b250YWwgKi8gfHxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbGF5b3V0ID09IDQgLyogUGFnaW5hdGlvbiAqLykge1xuICAgICAgICAgICAgICAgICAgICBpbmRleCsrO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCB0aGlzLiRjaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkU2VsZWN0aW9uKGluZGV4LCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLiRsYXlvdXQgPT0gMyAvKiBGbG93VmVydGljYWwgKi8pIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudCA9IHRoaXMuJGNoaWxkcmVuW2luZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgayA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNudCA9IHRoaXMuJGNoaWxkcmVuLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gaW5kZXggKyAxOyBpIDwgY250OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iaiA9IHRoaXMuJGNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai54ICE9IGN1cnJlbnQueCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBvYmo7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBrKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZm9yICg7IGkgPCBjbnQ7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqID0gdGhpcy4kY2hpbGRyZW5baV07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnggIT0gY3VycmVudC54KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhclNlbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkU2VsZWN0aW9uKGkgLSBrIC0gMSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDQwIC8qIERvd24gKi86XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJGxheW91dCA9PSAwIC8qIFNpbmdsZUNvbHVtbiAqLyB8fFxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRsYXlvdXQgPT0gMyAvKiBGbG93VmVydGljYWwgKi8pIHtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgdGhpcy4kY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyU2VsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZFNlbGVjdGlvbihpbmRleCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy4kbGF5b3V0ID09IDIgLyogRmxvd0hvcml6b250YWwgKi8gfHxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbGF5b3V0ID09IDQgLyogUGFnaW5hdGlvbiAqLykge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gdGhpcy4kY2hpbGRyZW5baW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICBrID0gMDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY250ID0gdGhpcy4kY2hpbGRyZW4ubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSBpbmRleCArIDE7IGkgPCBjbnQ7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqID0gdGhpcy4kY2hpbGRyZW5baV07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnkgIT0gY3VycmVudC55KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudCA9IG9iajtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGsrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBmb3IgKDsgaSA8IGNudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmogPSB0aGlzLiRjaGlsZHJlbltpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoueSAhPSBjdXJyZW50LnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyU2VsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRTZWxlY3Rpb24oaSAtIGsgLSAxLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMzcgLyogTGVmdCAqLzpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kbGF5b3V0ID09IDEgLyogU2luZ2xlUm93ICovIHx8XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGxheW91dCA9PSAyIC8qIEZsb3dIb3Jpem9udGFsICovIHx8XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGxheW91dCA9PSA0IC8qIFBhZ2luYXRpb24gKi8pIHtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXgtLTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkU2VsZWN0aW9uKGluZGV4LCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLiRsYXlvdXQgPT0gMyAvKiBGbG93VmVydGljYWwgKi8pIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudCA9IHRoaXMuJGNoaWxkcmVuW2luZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgayA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IGluZGV4IC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iaiA9IHRoaXMuJGNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai54ICE9IGN1cnJlbnQueCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBvYmo7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBrKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZm9yICg7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmogPSB0aGlzLiRjaGlsZHJlbltpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoueCAhPSBjdXJyZW50LngpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyU2VsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRTZWxlY3Rpb24oaSArIGsgKyAxLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICAkY2xpY2tJdGVtKGV2dCkge1xuICAgICAgICBpZiAodGhpcy4kc2Nyb2xsUGFuZSAhPSBudWxsICYmIHRoaXMuJHNjcm9sbFBhbmUuaXNEcmFnZ2luZylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgaXRlbSA9IEdPYmplY3QuY2FzdEZyb21OYXRpdmVPYmplY3QoZXZ0LmN1cnJlbnRUYXJnZXQpO1xuICAgICAgICBpZiAoIWl0ZW0pXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uT25FdmVudChpdGVtKTtcbiAgICAgICAgaWYgKHRoaXMuJHNjcm9sbFBhbmUgJiYgdGhpcy5zY3JvbGxJdGVtVG9WaWV3T25DbGljaylcbiAgICAgICAgICAgIHRoaXMuJHNjcm9sbFBhbmUuc2Nyb2xsVG9WaWV3KGl0ZW0sIHRydWUpO1xuICAgICAgICBsZXQgZXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoXCJfX2l0ZW1DbGlja1wiIC8qIEl0ZW1DbGljayAqLywgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICBldmVudC5kYXRhID0geyBpdGVtIH07XG4gICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChldmVudCwgdGhpcyk7XG4gICAgfVxuICAgIHNldFNlbGVjdGlvbk9uRXZlbnQoYnV0dG9uKSB7XG4gICAgICAgIGlmICghKGJ1dHRvbiBpbnN0YW5jZW9mIEdCdXR0b24pIHx8IHRoaXMuJHNlbGVjdGlvbk1vZGUgPT0gMyAvKiBOb25lICovKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBsZXQgZG9udENoYW5nZUxhc3RJbmRleCA9IGZhbHNlO1xuICAgICAgICBsZXQgaW5kZXggPSB0aGlzLmNoaWxkSW5kZXhUb0l0ZW1JbmRleCh0aGlzLmdldENoaWxkSW5kZXgoYnV0dG9uKSk7XG4gICAgICAgIGlmICh0aGlzLiRzZWxlY3Rpb25Nb2RlID09IDAgLyogU2luZ2xlICovKSB7XG4gICAgICAgICAgICBpZiAoIWJ1dHRvbi5zZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJTZWxlY3Rpb25FeGNlcHQoYnV0dG9uKTtcbiAgICAgICAgICAgICAgICBidXR0b24uc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKERPTUV2ZW50TWFuYWdlci5pbnN0LmlzS2V5UHJlc3NlZCgxNiAvKiBTaGlmdCAqLykpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWJ1dHRvbi5zZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kbGFzdFNlbGVjdGVkSW5kZXggIT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pbiA9IE1hdGgubWluKHRoaXMuJGxhc3RTZWxlY3RlZEluZGV4LCBpbmRleCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXggPSBNYXRoLm1pbihNYXRoLm1heCh0aGlzLiRsYXN0U2VsZWN0ZWRJbmRleCwgaW5kZXgpLCB0aGlzLm51bUl0ZW1zIC0gMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgaTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiR2aXJ0dWFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gbWluOyBpIDw9IG1heDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlpID0gdGhpcy4kdmlydHVhbEl0ZW1zW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWkub2JqIGluc3RhbmNlb2YgR0J1dHRvbilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlpLm9iai5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlpLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSBtaW47IGkgPD0gbWF4OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqID0gdGhpcy5nZXRDaGlsZEF0KGkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbnRDaGFuZ2VMYXN0SW5kZXggPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoRE9NRXZlbnRNYW5hZ2VyLmluc3QuaXNLZXlQcmVzc2VkKDE3IC8qIEN0cmwgKi8pIHx8XG4gICAgICAgICAgICAgICAgdGhpcy4kc2VsZWN0aW9uTW9kZSA9PSAyIC8qIE11bHRpcGxlX1NpbmdsZUNsaWNrICovKVxuICAgICAgICAgICAgICAgIGJ1dHRvbi5zZWxlY3RlZCA9ICFidXR0b24uc2VsZWN0ZWQ7XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoIWJ1dHRvbi5zZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyU2VsZWN0aW9uRXhjZXB0KGJ1dHRvbik7XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhclNlbGVjdGlvbkV4Y2VwdChidXR0b24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghZG9udENoYW5nZUxhc3RJbmRleClcbiAgICAgICAgICAgIHRoaXMuJGxhc3RTZWxlY3RlZEluZGV4ID0gaW5kZXg7XG4gICAgICAgIGlmIChidXR0b24uc2VsZWN0ZWQpXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGlvbkNvbnRyb2xsZXIoaW5kZXgpO1xuICAgIH1cbiAgICByZXNpemVUb0ZpdChpdGVtQ291bnQgPSAxMDAwMDAwLCBtaW5TaXplID0gMCkge1xuICAgICAgICB0aGlzLmVuc3VyZUJvdW5kc0NvcnJlY3QoKTtcbiAgICAgICAgY29uc3QgY3VyQ291bnQgPSB0aGlzLm51bUl0ZW1zO1xuICAgICAgICBpZiAoaXRlbUNvdW50ID4gY3VyQ291bnQpXG4gICAgICAgICAgICBpdGVtQ291bnQgPSBjdXJDb3VudDtcbiAgICAgICAgaWYgKHRoaXMuJHZpcnR1YWwpIHtcbiAgICAgICAgICAgIGNvbnN0IGxpbmVDb3VudCA9IE1hdGguY2VpbChpdGVtQ291bnQgLyB0aGlzLiRjdXJMaW5lSXRlbUNvdW50KTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRsYXlvdXQgPT0gMCAvKiBTaW5nbGVDb2x1bW4gKi8gfHxcbiAgICAgICAgICAgICAgICB0aGlzLiRsYXlvdXQgPT0gMiAvKiBGbG93SG9yaXpvbnRhbCAqLylcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXdIZWlnaHQgPSBsaW5lQ291bnQgKiB0aGlzLiRpdGVtU2l6ZS55ICsgTWF0aC5tYXgoMCwgbGluZUNvdW50IC0gMSkgKiB0aGlzLiRsaW5lR2FwO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHRoaXMudmlld1dpZHRoID0gbGluZUNvdW50ICogdGhpcy4kaXRlbVNpemUueCArIE1hdGgubWF4KDAsIGxpbmVDb3VudCAtIDEpICogdGhpcy4kY29sdW1uR2FwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGl0ZW1Db3VudCA9PSAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy4kbGF5b3V0ID09IDAgLyogU2luZ2xlQ29sdW1uICovIHx8XG4gICAgICAgICAgICAgICAgdGhpcy4kbGF5b3V0ID09IDIgLyogRmxvd0hvcml6b250YWwgKi8pXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3SGVpZ2h0ID0gbWluU2l6ZTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXdXaWR0aCA9IG1pblNpemU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBsZXQgaSA9IGl0ZW1Db3VudCAtIDE7XG4gICAgICAgICAgICBsZXQgb2JqO1xuICAgICAgICAgICAgd2hpbGUgKGkgPj0gMCkge1xuICAgICAgICAgICAgICAgIG9iaiA9IHRoaXMuZ2V0Q2hpbGRBdChpKTtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZm9sZEludmlzaWJsZUl0ZW1zIHx8IG9iai52aXNpYmxlKVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBpLS07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaSA8IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kbGF5b3V0ID09IDAgLyogU2luZ2xlQ29sdW1uICovIHx8XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGxheW91dCA9PSAyIC8qIEZsb3dIb3Jpem9udGFsICovKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnZpZXdIZWlnaHQgPSBtaW5TaXplO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3V2lkdGggPSBtaW5TaXplO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbGV0IHNpemUgPSAwO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRsYXlvdXQgPT0gMCAvKiBTaW5nbGVDb2x1bW4gKi8gfHxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbGF5b3V0ID09IDIgLyogRmxvd0hvcml6b250YWwgKi8pIHtcbiAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IG9iai55ICsgb2JqLmhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNpemUgPCBtaW5TaXplKVxuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IG1pblNpemU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmlld0hlaWdodCA9IHNpemU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzaXplID0gb2JqLnggKyBvYmoud2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzaXplIDwgbWluU2l6ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemUgPSBtaW5TaXplO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZpZXdXaWR0aCA9IHNpemU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGdldE1heEl0ZW1XaWR0aCgpIHtcbiAgICAgICAgY29uc3QgY250ID0gdGhpcy4kY2hpbGRyZW4ubGVuZ3RoO1xuICAgICAgICBsZXQgbWF4ID0gMDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjbnQ7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgY2hpbGQgPSB0aGlzLmdldENoaWxkQXQoaSk7XG4gICAgICAgICAgICBpZiAoY2hpbGQud2lkdGggPiBtYXgpXG4gICAgICAgICAgICAgICAgbWF4ID0gY2hpbGQud2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG1heDtcbiAgICB9XG4gICAgaGFuZGxlU2l6ZUNoYW5nZWQoKSB7XG4gICAgICAgIHN1cGVyLmhhbmRsZVNpemVDaGFuZ2VkKCk7XG4gICAgICAgIHRoaXMuc2V0Qm91bmRzQ2hhbmdlZEZsYWcoKTtcbiAgICAgICAgaWYgKHRoaXMuJHZpcnR1YWwpXG4gICAgICAgICAgICB0aGlzLnNldFZpcnR1YWxMaXN0Q2hhbmdlZEZsYWcodHJ1ZSk7XG4gICAgfVxuICAgIGhhbmRsZUNvbnRyb2xsZXJDaGFuZ2VkKGMpIHtcbiAgICAgICAgc3VwZXIuaGFuZGxlQ29udHJvbGxlckNoYW5nZWQoYyk7XG4gICAgICAgIGlmICh0aGlzLiRzZWxlY3Rpb25Db250cm9sbGVyID09IGMpXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSBjLnNlbGVjdGVkSW5kZXg7XG4gICAgfVxuICAgIHVwZGF0ZVNlbGVjdGlvbkNvbnRyb2xsZXIoaW5kZXgpIHtcbiAgICAgICAgaWYgKHRoaXMuJHNlbGVjdGlvbkNvbnRyb2xsZXIgIT0gbnVsbCAmJlxuICAgICAgICAgICAgIXRoaXMuJHNlbGVjdGlvbkNvbnRyb2xsZXIuJHVwZGF0aW5nICYmXG4gICAgICAgICAgICBpbmRleCA8IHRoaXMuc2VsZWN0aW9uQ29udHJvbGxlci5wYWdlQ291bnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGMgPSB0aGlzLiRzZWxlY3Rpb25Db250cm9sbGVyO1xuICAgICAgICAgICAgdGhpcy4kc2VsZWN0aW9uQ29udHJvbGxlciA9IG51bGw7XG4gICAgICAgICAgICBjLnNlbGVjdGVkSW5kZXggPSBpbmRleDtcbiAgICAgICAgICAgIHRoaXMuJHNlbGVjdGlvbkNvbnRyb2xsZXIgPSBjO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldFNuYXBwaW5nUG9zaXRpb24oeFZhbHVlLCB5VmFsdWUsIHJlc3VsdFBvaW50ID0gbnVsbCkge1xuICAgICAgICBpZiAodGhpcy4kdmlydHVhbCkge1xuICAgICAgICAgICAgaWYgKCFyZXN1bHRQb2ludClcbiAgICAgICAgICAgICAgICByZXN1bHRQb2ludCA9IG5ldyBjcmVhdGVqcy5Qb2ludCgpO1xuICAgICAgICAgICAgbGV0IHNhdmVkO1xuICAgICAgICAgICAgbGV0IGluZGV4O1xuICAgICAgICAgICAgaWYgKHRoaXMuJGxheW91dCA9PSAwIC8qIFNpbmdsZUNvbHVtbiAqLyB8fFxuICAgICAgICAgICAgICAgIHRoaXMuJGxheW91dCA9PSAyIC8qIEZsb3dIb3Jpem9udGFsICovKSB7XG4gICAgICAgICAgICAgICAgc2F2ZWQgPSB5VmFsdWU7XG4gICAgICAgICAgICAgICAgR0xpc3QuJGxhc3RQb3NIZWxwZXIgPSB5VmFsdWU7XG4gICAgICAgICAgICAgICAgaW5kZXggPSB0aGlzLmdldEluZGV4T25Qb3MxKGZhbHNlKTtcbiAgICAgICAgICAgICAgICB5VmFsdWUgPSBHTGlzdC4kbGFzdFBvc0hlbHBlcjtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCB0aGlzLiR2aXJ0dWFsSXRlbXMubGVuZ3RoICYmXG4gICAgICAgICAgICAgICAgICAgIHNhdmVkIC0geVZhbHVlID4gdGhpcy4kdmlydHVhbEl0ZW1zW2luZGV4XS5oZWlnaHQgLyAyICYmXG4gICAgICAgICAgICAgICAgICAgIGluZGV4IDwgdGhpcy4kcmVhbE51bUl0ZW1zKVxuICAgICAgICAgICAgICAgICAgICB5VmFsdWUgKz0gdGhpcy4kdmlydHVhbEl0ZW1zW2luZGV4XS5oZWlnaHQgKyB0aGlzLiRsaW5lR2FwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy4kbGF5b3V0ID09IDEgLyogU2luZ2xlUm93ICovIHx8XG4gICAgICAgICAgICAgICAgdGhpcy4kbGF5b3V0ID09IDMgLyogRmxvd1ZlcnRpY2FsICovKSB7XG4gICAgICAgICAgICAgICAgc2F2ZWQgPSB4VmFsdWU7XG4gICAgICAgICAgICAgICAgR0xpc3QuJGxhc3RQb3NIZWxwZXIgPSB4VmFsdWU7XG4gICAgICAgICAgICAgICAgaW5kZXggPSB0aGlzLmdldEluZGV4T25Qb3MyKGZhbHNlKTtcbiAgICAgICAgICAgICAgICB4VmFsdWUgPSBHTGlzdC4kbGFzdFBvc0hlbHBlcjtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCB0aGlzLiR2aXJ0dWFsSXRlbXMubGVuZ3RoICYmXG4gICAgICAgICAgICAgICAgICAgIHNhdmVkIC0geFZhbHVlID4gdGhpcy4kdmlydHVhbEl0ZW1zW2luZGV4XS53aWR0aCAvIDIgJiZcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggPCB0aGlzLiRyZWFsTnVtSXRlbXMpXG4gICAgICAgICAgICAgICAgICAgIHhWYWx1ZSArPSB0aGlzLiR2aXJ0dWFsSXRlbXNbaW5kZXhdLndpZHRoICsgdGhpcy4kY29sdW1uR2FwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc2F2ZWQgPSB4VmFsdWU7XG4gICAgICAgICAgICAgICAgR0xpc3QuJGxhc3RQb3NIZWxwZXIgPSB4VmFsdWU7XG4gICAgICAgICAgICAgICAgaW5kZXggPSB0aGlzLmdldEluZGV4T25Qb3MzKGZhbHNlKTtcbiAgICAgICAgICAgICAgICB4VmFsdWUgPSBHTGlzdC4kbGFzdFBvc0hlbHBlcjtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCB0aGlzLiR2aXJ0dWFsSXRlbXMubGVuZ3RoICYmXG4gICAgICAgICAgICAgICAgICAgIHNhdmVkIC0geFZhbHVlID4gdGhpcy4kdmlydHVhbEl0ZW1zW2luZGV4XS53aWR0aCAvIDIgJiZcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggPCB0aGlzLiRyZWFsTnVtSXRlbXMpXG4gICAgICAgICAgICAgICAgICAgIHhWYWx1ZSArPSB0aGlzLiR2aXJ0dWFsSXRlbXNbaW5kZXhdLndpZHRoICsgdGhpcy4kY29sdW1uR2FwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzdWx0UG9pbnQueCA9IHhWYWx1ZTtcbiAgICAgICAgICAgIHJlc3VsdFBvaW50LnkgPSB5VmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0UG9pbnQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldFNuYXBwaW5nUG9zaXRpb24oeFZhbHVlLCB5VmFsdWUsIHJlc3VsdFBvaW50KTtcbiAgICB9XG4gICAgc2Nyb2xsVG9WaWV3KGluZGV4LCBhbmkgPSBmYWxzZSwgc25hcFRvRmlyc3QgPSBmYWxzZSkge1xuICAgICAgICBpZiAodGhpcy4kdmlydHVhbCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuJG51bUl0ZW1zID09IDApXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy5jaGVja1ZpcnR1YWxMaXN0KCk7XG4gICAgICAgICAgICBpZiAoaW5kZXggPj0gdGhpcy4kdmlydHVhbEl0ZW1zLmxlbmd0aClcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgY2hpbGQgaW5kZXg6ICR7aW5kZXh9IGlzIGxhcmdlciB0aGFuIG1heCBsZW5ndGg6ICR7dGhpcy4kdmlydHVhbEl0ZW1zLmxlbmd0aH1gKTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRsb29wKVxuICAgICAgICAgICAgICAgIGluZGV4ID0gTWF0aC5mbG9vcih0aGlzLiRmaXJzdEluZGV4IC8gdGhpcy4kbnVtSXRlbXMpICogdGhpcy4kbnVtSXRlbXMgKyBpbmRleDtcbiAgICAgICAgICAgIGxldCByZWN0O1xuICAgICAgICAgICAgY29uc3QgaWkgPSB0aGlzLiR2aXJ0dWFsSXRlbXNbaW5kZXhdO1xuICAgICAgICAgICAgbGV0IHBvcyA9IDA7XG4gICAgICAgICAgICBsZXQgaTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRsYXlvdXQgPT0gMCAvKiBTaW5nbGVDb2x1bW4gKi8gfHxcbiAgICAgICAgICAgICAgICB0aGlzLiRsYXlvdXQgPT0gMiAvKiBGbG93SG9yaXpvbnRhbCAqLykge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBpbmRleDsgaSArPSB0aGlzLiRjdXJMaW5lSXRlbUNvdW50KVxuICAgICAgICAgICAgICAgICAgICBwb3MgKz0gdGhpcy4kdmlydHVhbEl0ZW1zW2ldLmhlaWdodCArIHRoaXMuJGxpbmVHYXA7XG4gICAgICAgICAgICAgICAgcmVjdCA9IG5ldyBjcmVhdGVqcy5SZWN0YW5nbGUoMCwgcG9zLCB0aGlzLiRpdGVtU2l6ZS54LCBpaS5oZWlnaHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy4kbGF5b3V0ID09IDEgLyogU2luZ2xlUm93ICovIHx8XG4gICAgICAgICAgICAgICAgdGhpcy4kbGF5b3V0ID09IDMgLyogRmxvd1ZlcnRpY2FsICovKSB7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGluZGV4OyBpICs9IHRoaXMuJGN1ckxpbmVJdGVtQ291bnQpXG4gICAgICAgICAgICAgICAgICAgIHBvcyArPSB0aGlzLiR2aXJ0dWFsSXRlbXNbaV0ud2lkdGggKyB0aGlzLiRjb2x1bW5HYXA7XG4gICAgICAgICAgICAgICAgcmVjdCA9IG5ldyBjcmVhdGVqcy5SZWN0YW5nbGUocG9zLCAwLCBpaS53aWR0aCwgdGhpcy4kaXRlbVNpemUueSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwYWdlID0gaW5kZXggLyAodGhpcy4kY3VyTGluZUl0ZW1Db3VudCAqIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQyKTtcbiAgICAgICAgICAgICAgICByZWN0ID0gbmV3IGNyZWF0ZWpzLlJlY3RhbmdsZShwYWdlICogdGhpcy52aWV3V2lkdGggKyAoaW5kZXggJSB0aGlzLiRjdXJMaW5lSXRlbUNvdW50KSAqIChpaS53aWR0aCArIHRoaXMuJGNvbHVtbkdhcCksICgoaW5kZXggLyB0aGlzLiRjdXJMaW5lSXRlbUNvdW50KSAlIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQyKSAqXG4gICAgICAgICAgICAgICAgICAgIChpaS5oZWlnaHQgKyB0aGlzLiRsaW5lR2FwKSwgaWkud2lkdGgsIGlpLmhlaWdodCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL3RoZSBwb3NpdGlvbiB3aWxsIGJlIGFsc28gY2hhbmdlZCBpZiB0aGUgaGVpZ2h0IG9mIGl0cyBwYXJlbnQgKGlmIGNoYW5nZWFibGUpIGlzIGJlaW5nIGNoYW5nZWQsIHNvIGhlcmUgd2UgbmVlZCB0byBmb3JjZWx5IHNldCB0aGlzIHRvIHRydWVcbiAgICAgICAgICAgIHNuYXBUb0ZpcnN0ID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRzY3JvbGxQYW5lICE9IG51bGwpXG4gICAgICAgICAgICAgICAgdGhpcy4kc2Nyb2xsUGFuZS5zY3JvbGxUb1ZpZXcocmVjdCwgYW5pLCBzbmFwVG9GaXJzdCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSB0aGlzLmdldENoaWxkQXQoaW5kZXgpO1xuICAgICAgICAgICAgaWYgKHRoaXMuJHNjcm9sbFBhbmUgIT0gbnVsbClcbiAgICAgICAgICAgICAgICB0aGlzLiRzY3JvbGxQYW5lLnNjcm9sbFRvVmlldyhvYmosIGFuaSwgc25hcFRvRmlyc3QpO1xuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5wYXJlbnQgIT0gbnVsbCAmJiB0aGlzLnBhcmVudC5zY3JvbGxQYW5lICE9IG51bGwpXG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnQuc2Nyb2xsUGFuZS5zY3JvbGxUb1ZpZXcob2JqLCBhbmksIHNuYXBUb0ZpcnN0KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRGaXJzdENoaWxkSW5WaWV3KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jaGlsZEluZGV4VG9JdGVtSW5kZXgoc3VwZXIuZ2V0Rmlyc3RDaGlsZEluVmlldygpKTtcbiAgICB9XG4gICAgY2hpbGRJbmRleFRvSXRlbUluZGV4KGluZGV4KSB7XG4gICAgICAgIGlmICghdGhpcy4kdmlydHVhbClcbiAgICAgICAgICAgIHJldHVybiBpbmRleDtcbiAgICAgICAgaWYgKHRoaXMuJGxheW91dCA9PSA0IC8qIFBhZ2luYXRpb24gKi8pIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSB0aGlzLiRmaXJzdEluZGV4OyBpIDwgdGhpcy4kcmVhbE51bUl0ZW1zOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kdmlydHVhbEl0ZW1zW2ldLm9iaiAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGluZGV4LS07XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IDApXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaW5kZXg7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpbmRleCArPSB0aGlzLiRmaXJzdEluZGV4O1xuICAgICAgICAgICAgaWYgKHRoaXMuJGxvb3AgJiYgdGhpcy4kbnVtSXRlbXMgPiAwKVxuICAgICAgICAgICAgICAgIGluZGV4ID0gaW5kZXggJSB0aGlzLiRudW1JdGVtcztcbiAgICAgICAgICAgIHJldHVybiBpbmRleDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpdGVtSW5kZXhUb0NoaWxkSW5kZXgoaW5kZXgpIHtcbiAgICAgICAgaWYgKCF0aGlzLiR2aXJ0dWFsKVxuICAgICAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgICAgICBpZiAodGhpcy4kbGF5b3V0ID09IDQgLyogUGFnaW5hdGlvbiAqLylcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldENoaWxkSW5kZXgodGhpcy4kdmlydHVhbEl0ZW1zW2luZGV4XS5vYmopO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRsb29wICYmIHRoaXMuJG51bUl0ZW1zID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGogPSB0aGlzLiRmaXJzdEluZGV4ICUgdGhpcy4kbnVtSXRlbXM7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID49IGopXG4gICAgICAgICAgICAgICAgICAgIGluZGV4ID0gdGhpcy4kZmlyc3RJbmRleCArIChpbmRleCAtIGopO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSB0aGlzLiRmaXJzdEluZGV4ICsgdGhpcy4kbnVtSXRlbXMgKyAoaiAtIGluZGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBpbmRleCAtPSB0aGlzLiRmaXJzdEluZGV4O1xuICAgICAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgICAgICB9XG4gICAgfVxuICAgIHNldFZpcnR1YWwoKSB7XG4gICAgICAgIHRoaXMuJHNldFZpcnR1YWwoZmFsc2UpO1xuICAgIH1cbiAgICBzZXRWaXJ0dWFsQW5kTG9vcCgpIHtcbiAgICAgICAgdGhpcy4kc2V0VmlydHVhbCh0cnVlKTtcbiAgICB9XG4gICAgJHNldFZpcnR1YWwobG9vcCkge1xuICAgICAgICBpZiAoIXRoaXMuJHZpcnR1YWwpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRzY3JvbGxQYW5lID09IG51bGwpXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdWaXJ0dWFsIGxpc3QgbXVzdCBiZSBzY3JvbGxhYmxlJyk7XG4gICAgICAgICAgICBpZiAobG9vcCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRsYXlvdXQgPT0gMiAvKiBGbG93SG9yaXpvbnRhbCAqLyB8fFxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRsYXlvdXQgPT0gMyAvKiBGbG93VmVydGljYWwgKi8pXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVmlydHVhbCBsaXN0IHdpdGggbG9vcCBtb2RlIGlzIG5vdCBzdXBwb3J0ZWQgZm9yIGJvdGggRmxvd0hvcml6b250YWwgYW5kIEZsb3dWZXJ0aWNhbCBsYXlvdXQnKTtcbiAgICAgICAgICAgICAgICB0aGlzLiRzY3JvbGxQYW5lLmJvdW5jZWJhY2tFZmZlY3QgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuJHZpcnR1YWwgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy4kbG9vcCA9IGxvb3A7XG4gICAgICAgICAgICB0aGlzLiR2aXJ0dWFsSXRlbXMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2hpbGRyZW5Ub1Bvb2woKTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRpdGVtU2l6ZSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kaXRlbVNpemUgPSBuZXcgY3JlYXRlanMuUG9pbnQoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBvYmogPSB0aGlzLmdldEZyb21Qb29sKG51bGwpO1xuICAgICAgICAgICAgICAgIGlmIChvYmogPT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdWaXJ0dWFsIGxpc3QgbXVzdCBoYXZlIGEgZGVmYXVsdCBsaXN0IGl0ZW0gcmVzb3VyY2Ugc3BlY2lmaWVkIHRocm91Z2ggbGlzdC5kZWZhdWx0SXRlbSA9IHJlc1VybC4nKTtcbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kaXRlbVNpemUueCA9IG9iai53aWR0aDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kaXRlbVNpemUueSA9IG9iai5oZWlnaHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMucmV0dXJuVG9Qb29sKG9iaik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy4kbGF5b3V0ID09IDAgLyogU2luZ2xlQ29sdW1uICovIHx8XG4gICAgICAgICAgICAgICAgdGhpcy4kbGF5b3V0ID09IDIgLyogRmxvd0hvcml6b250YWwgKi8pIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRzY3JvbGxQYW5lLnNjcm9sbFNwZWVkID0gdGhpcy4kaXRlbVNpemUueTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kbG9vcClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc2Nyb2xsUGFuZS4kbG9vcCA9IDI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRzY3JvbGxQYW5lLnNjcm9sbFNwZWVkID0gdGhpcy4kaXRlbVNpemUueDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kbG9vcClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc2Nyb2xsUGFuZS4kbG9vcCA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLiRzY3JvbGxQYW5lLm9uKFwiX19zY3JvbGxcIiAvKiBTQ1JPTEwgKi8sIHRoaXMuJHNjcm9sbGVkLCB0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuc2V0VmlydHVhbExpc3RDaGFuZ2VkRmxhZyh0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgbnVtSXRlbXMoKSB7XG4gICAgICAgIGlmICh0aGlzLiR2aXJ0dWFsKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuJG51bUl0ZW1zO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kY2hpbGRyZW4ubGVuZ3RoO1xuICAgIH1cbiAgICBzZXQgbnVtSXRlbXModmFsdWUpIHtcbiAgICAgICAgbGV0IGk7XG4gICAgICAgIGlmICh0aGlzLiR2aXJ0dWFsKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pdGVtUmVuZGVyZXIgPT0gbnVsbClcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2xpc3QuaXRlbVJlbmRlcmVyIGlzIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICB0aGlzLiRudW1JdGVtcyA9IHZhbHVlO1xuICAgICAgICAgICAgaWYgKHRoaXMuJGxvb3ApXG4gICAgICAgICAgICAgICAgdGhpcy4kcmVhbE51bUl0ZW1zID0gdGhpcy4kbnVtSXRlbXMgKiA2O1xuICAgICAgICAgICAgLy9lbmxhcmdlIGZvciBsb29wXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGhpcy4kcmVhbE51bUl0ZW1zID0gdGhpcy4kbnVtSXRlbXM7XG4gICAgICAgICAgICAvL2luY3JlYXNlIG9ubHlcbiAgICAgICAgICAgIGNvbnN0IG9sZENvdW50ID0gdGhpcy4kdmlydHVhbEl0ZW1zLmxlbmd0aDtcbiAgICAgICAgICAgIGlmICh0aGlzLiRyZWFsTnVtSXRlbXMgPiBvbGRDb3VudCkge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IG9sZENvdW50OyBpIDwgdGhpcy4kcmVhbE51bUl0ZW1zOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGlpID0gbmV3IEl0ZW1JbmZvKCk7XG4gICAgICAgICAgICAgICAgICAgIGlpLndpZHRoID0gdGhpcy4kaXRlbVNpemUueDtcbiAgICAgICAgICAgICAgICAgICAgaWkuaGVpZ2h0ID0gdGhpcy4kaXRlbVNpemUueTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kdmlydHVhbEl0ZW1zLnB1c2goaWkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IHRoaXMuJHJlYWxOdW1JdGVtczsgaSA8IG9sZENvdW50OyBpKyspXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHZpcnR1YWxJdGVtc1tpXS5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuJHZpcnR1YWxMaXN0Q2hhbmdlZCAhPSAwIC8qIE5vbmUgKi8pXG4gICAgICAgICAgICAgICAgR1RpbWVyLmluc3QucmVtb3ZlKHRoaXMuJHJlZnJlc2hWaXJ0dWFsTGlzdCwgdGhpcyk7XG4gICAgICAgICAgICAvL3JlZnJlc2ggbm93XG4gICAgICAgICAgICB0aGlzLiRyZWZyZXNoVmlydHVhbExpc3QoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGNudCA9IHRoaXMuJGNoaWxkcmVuLmxlbmd0aDtcbiAgICAgICAgICAgIGlmICh2YWx1ZSA+IGNudCkge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IGNudDsgaSA8IHZhbHVlOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXRlbVByb3ZpZGVyID09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEl0ZW1Gcm9tUG9vbCgpO1xuICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEl0ZW1Gcm9tUG9vbCh0aGlzLml0ZW1Qcm92aWRlcihpKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2hpbGRyZW5Ub1Bvb2wodmFsdWUsIGNudCk7XG4gICAgICAgICAgICBpZiAodGhpcy5pdGVtUmVuZGVyZXIgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB2YWx1ZTsgaSsrKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1SZW5kZXJlcihpLCB0aGlzLmdldENoaWxkQXQoaSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJlZnJlc2hWaXJ0dWFsTGlzdCgpIHtcbiAgICAgICAgdGhpcy5zZXRWaXJ0dWFsTGlzdENoYW5nZWRGbGFnKGZhbHNlKTtcbiAgICB9XG4gICAgY2hlY2tWaXJ0dWFsTGlzdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuJHZpcnR1YWxMaXN0Q2hhbmdlZCAhPSAwIC8qIE5vbmUgKi8pIHtcbiAgICAgICAgICAgIHRoaXMuJHJlZnJlc2hWaXJ0dWFsTGlzdCgpO1xuICAgICAgICAgICAgR1RpbWVyLmluc3QucmVtb3ZlKHRoaXMuJHJlZnJlc2hWaXJ0dWFsTGlzdCwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0VmlydHVhbExpc3RDaGFuZ2VkRmxhZyhsYXlvdXRDaGFuZ2VkID0gZmFsc2UpIHtcbiAgICAgICAgaWYgKGxheW91dENoYW5nZWQpXG4gICAgICAgICAgICB0aGlzLiR2aXJ0dWFsTGlzdENoYW5nZWQgPSAyIC8qIFNpemVDaGFuZ2VkICovO1xuICAgICAgICBlbHNlIGlmICh0aGlzLiR2aXJ0dWFsTGlzdENoYW5nZWQgPT0gMCAvKiBOb25lICovKVxuICAgICAgICAgICAgdGhpcy4kdmlydHVhbExpc3RDaGFuZ2VkID0gMSAvKiBDb250ZW50Q2hhbmdlZCAqLztcbiAgICAgICAgR1RpbWVyLmluc3QuY2FsbExhdGVyKHRoaXMuJHJlZnJlc2hWaXJ0dWFsTGlzdCwgdGhpcyk7XG4gICAgfVxuICAgICRyZWZyZXNoVmlydHVhbExpc3QoKSB7XG4gICAgICAgIGNvbnN0IGxheW91dENoYW5nZWQgPSB0aGlzLiR2aXJ0dWFsTGlzdENoYW5nZWQgPT0gMiAvKiBTaXplQ2hhbmdlZCAqLztcbiAgICAgICAgdGhpcy4kdmlydHVhbExpc3RDaGFuZ2VkID0gMCAvKiBOb25lICovO1xuICAgICAgICB0aGlzLiRldmVudExvY2tlZCA9IHRydWU7XG4gICAgICAgIGlmIChsYXlvdXRDaGFuZ2VkKSB7XG4gICAgICAgICAgICBpZiAodGhpcy4kbGF5b3V0ID09IDAgLyogU2luZ2xlQ29sdW1uICovIHx8IHRoaXMuJGxheW91dCA9PSAxIC8qIFNpbmdsZVJvdyAqLylcbiAgICAgICAgICAgICAgICB0aGlzLiRjdXJMaW5lSXRlbUNvdW50ID0gMTtcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuJGxheW91dCA9PSAyIC8qIEZsb3dIb3Jpem9udGFsICovKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuJGNvbHVtbkNvdW50ID4gMClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kY3VyTGluZUl0ZW1Db3VudCA9IHRoaXMuJGNvbHVtbkNvdW50O1xuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjdXJMaW5lSXRlbUNvdW50ID0gTWF0aC5mbG9vcigodGhpcy4kc2Nyb2xsUGFuZS52aWV3V2lkdGggKyB0aGlzLiRjb2x1bW5HYXApIC8gKHRoaXMuJGl0ZW1TaXplLnggKyB0aGlzLiRjb2x1bW5HYXApKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJGN1ckxpbmVJdGVtQ291bnQgPD0gMClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQgPSAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuJGxheW91dCA9PSAzIC8qIEZsb3dWZXJ0aWNhbCAqLykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRsaW5lQ291bnQgPiAwKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjdXJMaW5lSXRlbUNvdW50ID0gdGhpcy4kbGluZUNvdW50O1xuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjdXJMaW5lSXRlbUNvdW50ID0gTWF0aC5mbG9vcigodGhpcy4kc2Nyb2xsUGFuZS52aWV3SGVpZ2h0ICsgdGhpcy4kbGluZUdhcCkgLyAodGhpcy4kaXRlbVNpemUueSArIHRoaXMuJGxpbmVHYXApKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJGN1ckxpbmVJdGVtQ291bnQgPD0gMClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQgPSAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gLy9wYWdpbmF0aW9uXG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kY29sdW1uQ291bnQgPiAwKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjdXJMaW5lSXRlbUNvdW50ID0gdGhpcy4kY29sdW1uQ291bnQ7XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQgPSBNYXRoLmZsb29yKCh0aGlzLiRzY3JvbGxQYW5lLnZpZXdXaWR0aCArIHRoaXMuJGNvbHVtbkdhcCkgLyAodGhpcy4kaXRlbVNpemUueCArIHRoaXMuJGNvbHVtbkdhcCkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kY3VyTGluZUl0ZW1Db3VudCA8PSAwKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kY3VyTGluZUl0ZW1Db3VudCA9IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRsaW5lQ291bnQgPiAwKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLiRjdXJMaW5lSXRlbUNvdW50MiA9IHRoaXMuJGxpbmVDb3VudDtcbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kY3VyTGluZUl0ZW1Db3VudDIgPSBNYXRoLmZsb29yKCh0aGlzLiRzY3JvbGxQYW5lLnZpZXdIZWlnaHQgKyB0aGlzLiRsaW5lR2FwKSAvICh0aGlzLiRpdGVtU2l6ZS55ICsgdGhpcy4kbGluZUdhcCkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kY3VyTGluZUl0ZW1Db3VudDIgPD0gMClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQyID0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGNoID0gMCwgY3cgPSAwO1xuICAgICAgICBpZiAodGhpcy4kcmVhbE51bUl0ZW1zID4gMCkge1xuICAgICAgICAgICAgbGV0IGk7XG4gICAgICAgICAgICBsZXQgbGVuID0gTWF0aC5jZWlsKHRoaXMuJHJlYWxOdW1JdGVtcyAvIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQpICogdGhpcy4kY3VyTGluZUl0ZW1Db3VudDtcbiAgICAgICAgICAgIGxldCBsZW4yID0gTWF0aC5taW4odGhpcy4kY3VyTGluZUl0ZW1Db3VudCwgdGhpcy4kcmVhbE51bUl0ZW1zKTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRsYXlvdXQgPT0gMCAvKiBTaW5nbGVDb2x1bW4gKi8gfHxcbiAgICAgICAgICAgICAgICB0aGlzLiRsYXlvdXQgPT0gMiAvKiBGbG93SG9yaXpvbnRhbCAqLykge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gdGhpcy4kY3VyTGluZUl0ZW1Db3VudClcbiAgICAgICAgICAgICAgICAgICAgY2ggKz0gdGhpcy4kdmlydHVhbEl0ZW1zW2ldLmhlaWdodCArIHRoaXMuJGxpbmVHYXA7XG4gICAgICAgICAgICAgICAgaWYgKGNoID4gMClcbiAgICAgICAgICAgICAgICAgICAgY2ggLT0gdGhpcy4kbGluZUdhcDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kYXV0b1Jlc2l6ZUl0ZW0pXG4gICAgICAgICAgICAgICAgICAgIGN3ID0gdGhpcy4kc2Nyb2xsUGFuZS52aWV3V2lkdGg7XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW4yOyBpKyspXG4gICAgICAgICAgICAgICAgICAgICAgICBjdyArPSB0aGlzLiR2aXJ0dWFsSXRlbXNbaV0ud2lkdGggKyB0aGlzLiRjb2x1bW5HYXA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdyA+IDApXG4gICAgICAgICAgICAgICAgICAgICAgICBjdyAtPSB0aGlzLiRjb2x1bW5HYXA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy4kbGF5b3V0ID09IDEgLyogU2luZ2xlUm93ICovIHx8XG4gICAgICAgICAgICAgICAgdGhpcy4kbGF5b3V0ID09IDMgLyogRmxvd1ZlcnRpY2FsICovKSB7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSArPSB0aGlzLiRjdXJMaW5lSXRlbUNvdW50KVxuICAgICAgICAgICAgICAgICAgICBjdyArPSB0aGlzLiR2aXJ0dWFsSXRlbXNbaV0ud2lkdGggKyB0aGlzLiRjb2x1bW5HYXA7XG4gICAgICAgICAgICAgICAgaWYgKGN3ID4gMClcbiAgICAgICAgICAgICAgICAgICAgY3cgLT0gdGhpcy4kY29sdW1uR2FwO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRhdXRvUmVzaXplSXRlbSlcbiAgICAgICAgICAgICAgICAgICAgY2ggPSB0aGlzLiRzY3JvbGxQYW5lLnZpZXdIZWlnaHQ7XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW4yOyBpKyspXG4gICAgICAgICAgICAgICAgICAgICAgICBjaCArPSB0aGlzLiR2aXJ0dWFsSXRlbXNbaV0uaGVpZ2h0ICsgdGhpcy4kbGluZUdhcDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoID4gMClcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoIC09IHRoaXMuJGxpbmVHYXA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGFnZUNvdW50ID0gTWF0aC5jZWlsKGxlbiAvICh0aGlzLiRjdXJMaW5lSXRlbUNvdW50ICogdGhpcy4kY3VyTGluZUl0ZW1Db3VudDIpKTtcbiAgICAgICAgICAgICAgICBjdyA9IHBhZ2VDb3VudCAqIHRoaXMudmlld1dpZHRoO1xuICAgICAgICAgICAgICAgIGNoID0gdGhpcy52aWV3SGVpZ2h0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuaGFuZGxlQWxpZ24oY3csIGNoKTtcbiAgICAgICAgdGhpcy4kc2Nyb2xsUGFuZS5zZXRDb250ZW50U2l6ZShjdywgY2gpO1xuICAgICAgICB0aGlzLiRldmVudExvY2tlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmhhbmRsZVNjcm9sbCh0cnVlKTtcbiAgICB9XG4gICAgJHNjcm9sbGVkKCkge1xuICAgICAgICB0aGlzLmhhbmRsZVNjcm9sbChmYWxzZSk7XG4gICAgfVxuICAgIGdldEluZGV4T25Qb3MxKGZvcmNlVXBkYXRlKSB7XG4gICAgICAgIGlmICh0aGlzLiRyZWFsTnVtSXRlbXMgPCB0aGlzLiRjdXJMaW5lSXRlbUNvdW50KSB7XG4gICAgICAgICAgICBHTGlzdC4kbGFzdFBvc0hlbHBlciA9IDA7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICBsZXQgaTtcbiAgICAgICAgbGV0IHBvczI7XG4gICAgICAgIGxldCBwb3MzO1xuICAgICAgICBpZiAodGhpcy5udW1DaGlsZHJlbiA+IDAgJiYgIWZvcmNlVXBkYXRlKSB7XG4gICAgICAgICAgICBwb3MyID0gdGhpcy5nZXRDaGlsZEF0KDApLnk7XG4gICAgICAgICAgICBpZiAocG9zMiA+IEdMaXN0LiRsYXN0UG9zSGVscGVyKSB7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gdGhpcy4kZmlyc3RJbmRleCAtIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQ7IGkgPj0gMDsgaSAtPSB0aGlzLiRjdXJMaW5lSXRlbUNvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHBvczIgLT0gdGhpcy4kdmlydHVhbEl0ZW1zW2ldLmhlaWdodCArIHRoaXMuJGxpbmVHYXA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwb3MyIDw9IEdMaXN0LiRsYXN0UG9zSGVscGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBHTGlzdC4kbGFzdFBvc0hlbHBlciA9IHBvczI7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBHTGlzdC4kbGFzdFBvc0hlbHBlciA9IDA7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSB0aGlzLiRmaXJzdEluZGV4OyBpIDwgdGhpcy4kcmVhbE51bUl0ZW1zOyBpICs9IHRoaXMuJGN1ckxpbmVJdGVtQ291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zMyA9IHBvczIgKyB0aGlzLiR2aXJ0dWFsSXRlbXNbaV0uaGVpZ2h0ICsgdGhpcy4kbGluZUdhcDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBvczMgPiBHTGlzdC4kbGFzdFBvc0hlbHBlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgR0xpc3QuJGxhc3RQb3NIZWxwZXIgPSBwb3MyO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcG9zMiA9IHBvczM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIEdMaXN0LiRsYXN0UG9zSGVscGVyID0gcG9zMjtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kcmVhbE51bUl0ZW1zIC0gdGhpcy4kY3VyTGluZUl0ZW1Db3VudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHBvczIgPSAwO1xuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuJHJlYWxOdW1JdGVtczsgaSArPSB0aGlzLiRjdXJMaW5lSXRlbUNvdW50KSB7XG4gICAgICAgICAgICAgICAgcG9zMyA9IHBvczIgKyB0aGlzLiR2aXJ0dWFsSXRlbXNbaV0uaGVpZ2h0ICsgdGhpcy4kbGluZUdhcDtcbiAgICAgICAgICAgICAgICBpZiAocG9zMyA+IEdMaXN0LiRsYXN0UG9zSGVscGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIEdMaXN0LiRsYXN0UG9zSGVscGVyID0gcG9zMjtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHBvczIgPSBwb3MzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgR0xpc3QuJGxhc3RQb3NIZWxwZXIgPSBwb3MyO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHJlYWxOdW1JdGVtcyAtIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0SW5kZXhPblBvczIoZm9yY2VVcGRhdGUpIHtcbiAgICAgICAgaWYgKHRoaXMuJHJlYWxOdW1JdGVtcyA8IHRoaXMuJGN1ckxpbmVJdGVtQ291bnQpIHtcbiAgICAgICAgICAgIEdMaXN0LiRsYXN0UG9zSGVscGVyID0gMDtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIGxldCBpO1xuICAgICAgICBsZXQgcG9zMjtcbiAgICAgICAgbGV0IHBvczM7XG4gICAgICAgIGlmICh0aGlzLm51bUNoaWxkcmVuID4gMCAmJiAhZm9yY2VVcGRhdGUpIHtcbiAgICAgICAgICAgIHBvczIgPSB0aGlzLmdldENoaWxkQXQoMCkueDtcbiAgICAgICAgICAgIGlmIChwb3MyID4gR0xpc3QuJGxhc3RQb3NIZWxwZXIpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSB0aGlzLiRmaXJzdEluZGV4IC0gdGhpcy4kY3VyTGluZUl0ZW1Db3VudDsgaSA+PSAwOyBpIC09IHRoaXMuJGN1ckxpbmVJdGVtQ291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zMiAtPSB0aGlzLiR2aXJ0dWFsSXRlbXNbaV0ud2lkdGggKyB0aGlzLiRjb2x1bW5HYXA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwb3MyIDw9IEdMaXN0LiRsYXN0UG9zSGVscGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBHTGlzdC4kbGFzdFBvc0hlbHBlciA9IHBvczI7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBHTGlzdC4kbGFzdFBvc0hlbHBlciA9IDA7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSB0aGlzLiRmaXJzdEluZGV4OyBpIDwgdGhpcy4kcmVhbE51bUl0ZW1zOyBpICs9IHRoaXMuJGN1ckxpbmVJdGVtQ291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zMyA9IHBvczIgKyB0aGlzLiR2aXJ0dWFsSXRlbXNbaV0ud2lkdGggKyB0aGlzLiRjb2x1bW5HYXA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwb3MzID4gR0xpc3QuJGxhc3RQb3NIZWxwZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEdMaXN0LiRsYXN0UG9zSGVscGVyID0gcG9zMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHBvczIgPSBwb3MzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBHTGlzdC4kbGFzdFBvc0hlbHBlciA9IHBvczI7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHJlYWxOdW1JdGVtcyAtIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBwb3MyID0gMDtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLiRyZWFsTnVtSXRlbXM7IGkgKz0gdGhpcy4kY3VyTGluZUl0ZW1Db3VudCkge1xuICAgICAgICAgICAgICAgIHBvczMgPSBwb3MyICsgdGhpcy4kdmlydHVhbEl0ZW1zW2ldLndpZHRoICsgdGhpcy4kY29sdW1uR2FwO1xuICAgICAgICAgICAgICAgIGlmIChwb3MzID4gR0xpc3QuJGxhc3RQb3NIZWxwZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgR0xpc3QuJGxhc3RQb3NIZWxwZXIgPSBwb3MyO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcG9zMiA9IHBvczM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBHTGlzdC4kbGFzdFBvc0hlbHBlciA9IHBvczI7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kcmVhbE51bUl0ZW1zIC0gdGhpcy4kY3VyTGluZUl0ZW1Db3VudDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRJbmRleE9uUG9zMyhmb3JjZVVwZGF0ZSkge1xuICAgICAgICBpZiAodGhpcy4kcmVhbE51bUl0ZW1zIDwgdGhpcy4kY3VyTGluZUl0ZW1Db3VudCkge1xuICAgICAgICAgICAgR0xpc3QuJGxhc3RQb3NIZWxwZXIgPSAwO1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgdmlld1dpZHRoID0gdGhpcy52aWV3V2lkdGg7XG4gICAgICAgIGNvbnN0IHBhZ2UgPSBNYXRoLmZsb29yKEdMaXN0LiRsYXN0UG9zSGVscGVyIC8gdmlld1dpZHRoKTtcbiAgICAgICAgY29uc3Qgc3RhcnRJbmRleCA9IHBhZ2UgKiAodGhpcy4kY3VyTGluZUl0ZW1Db3VudCAqIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQyKTtcbiAgICAgICAgbGV0IGk7XG4gICAgICAgIGxldCBwb3MzO1xuICAgICAgICBsZXQgcG9zMiA9IHBhZ2UgKiB2aWV3V2lkdGg7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLiRjdXJMaW5lSXRlbUNvdW50OyBpKyspIHtcbiAgICAgICAgICAgIHBvczMgPSBwb3MyICsgdGhpcy4kdmlydHVhbEl0ZW1zW3N0YXJ0SW5kZXggKyBpXS53aWR0aCArIHRoaXMuJGNvbHVtbkdhcDtcbiAgICAgICAgICAgIGlmIChwb3MzID4gR0xpc3QuJGxhc3RQb3NIZWxwZXIpIHtcbiAgICAgICAgICAgICAgICBHTGlzdC4kbGFzdFBvc0hlbHBlciA9IHBvczI7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXJ0SW5kZXggKyBpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcG9zMiA9IHBvczM7XG4gICAgICAgIH1cbiAgICAgICAgR0xpc3QuJGxhc3RQb3NIZWxwZXIgPSBwb3MyO1xuICAgICAgICByZXR1cm4gc3RhcnRJbmRleCArIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQgLSAxO1xuICAgIH1cbiAgICBoYW5kbGVTY3JvbGwoZm9yY2VVcGRhdGUpIHtcbiAgICAgICAgaWYgKHRoaXMuJGV2ZW50TG9ja2VkKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLiRlbnRlckNvdW50ZXIgPSAwO1xuICAgICAgICBpZiAodGhpcy4kbGF5b3V0ID09IDAgLyogU2luZ2xlQ29sdW1uICovIHx8XG4gICAgICAgICAgICB0aGlzLiRsYXlvdXQgPT0gMiAvKiBGbG93SG9yaXpvbnRhbCAqLykge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVTY3JvbGwxKGZvcmNlVXBkYXRlKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlQXJjaE9yZGVyMSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuJGxheW91dCA9PSAxIC8qIFNpbmdsZVJvdyAqLyB8fFxuICAgICAgICAgICAgdGhpcy4kbGF5b3V0ID09IDMgLyogRmxvd1ZlcnRpY2FsICovKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZVNjcm9sbDIoZm9yY2VVcGRhdGUpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVBcmNoT3JkZXIyKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy5oYW5kbGVTY3JvbGwzKGZvcmNlVXBkYXRlKTtcbiAgICAgICAgdGhpcy4kYm91bmRzQ2hhbmdlZCA9IGZhbHNlO1xuICAgIH1cbiAgICBoYW5kbGVTY3JvbGwxKGZvcmNlVXBkYXRlKSB7XG4gICAgICAgIHRoaXMuJGVudGVyQ291bnRlcisrO1xuICAgICAgICBpZiAodGhpcy4kZW50ZXJDb3VudGVyID4gMykge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCd0aGlzIGxpc3QgdmlldyBjYW5ub3QgYmUgZmlsbGVkIGZ1bGwgYXMgdGhlIGl0ZW1SZW5kZXJlciBmdW5jdGlvbiBhbHdheXMgcmV0dXJucyBhbiBpdGVtIHdpdGggZGlmZmVyZW50IHNpemUuJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHBvcyA9IHRoaXMuJHNjcm9sbFBhbmUuc2Nyb2xsaW5nUG9zWTtcbiAgICAgICAgbGV0IG1heCA9IHBvcyArIHRoaXMuJHNjcm9sbFBhbmUudmlld0hlaWdodDtcbiAgICAgICAgY29uc3QgZW5kID0gbWF4ID09IHRoaXMuJHNjcm9sbFBhbmUuY29udGVudEhlaWdodDsgLy9pbmRpY2F0ZXMgd2UgbmVlZCB0byBzY3JvbGwgdG8gZW5kIGluIHNwaXRlIG9mIGNvbnRlbnQgc2l6ZSBjaGFuZ2luZ1xuICAgICAgICAvL2ZpbmQgdGhlIGZpcnN0IGl0ZW0gZnJvbSBjdXJyZW50IHBvc1xuICAgICAgICBHTGlzdC4kbGFzdFBvc0hlbHBlciA9IHBvcztcbiAgICAgICAgY29uc3QgbmV3Rmlyc3RJbmRleCA9IHRoaXMuZ2V0SW5kZXhPblBvczEoZm9yY2VVcGRhdGUpO1xuICAgICAgICBpZiAobmV3Rmlyc3RJbmRleCA9PSB0aGlzLiRmaXJzdEluZGV4ICYmICFmb3JjZVVwZGF0ZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgcG9zID0gR0xpc3QuJGxhc3RQb3NIZWxwZXI7XG4gICAgICAgIGNvbnN0IG9sZEZpcnN0SW5kZXggPSB0aGlzLiRmaXJzdEluZGV4O1xuICAgICAgICB0aGlzLiRmaXJzdEluZGV4ID0gbmV3Rmlyc3RJbmRleDtcbiAgICAgICAgbGV0IGN1ckluZGV4ID0gbmV3Rmlyc3RJbmRleDtcbiAgICAgICAgY29uc3QgZm9yd2FyZCA9IG9sZEZpcnN0SW5kZXggPiBuZXdGaXJzdEluZGV4O1xuICAgICAgICBjb25zdCBvbGRDb3VudCA9IHRoaXMubnVtQ2hpbGRyZW47XG4gICAgICAgIGNvbnN0IGxhc3RJbmRleCA9IG9sZEZpcnN0SW5kZXggKyBvbGRDb3VudCAtIDE7XG4gICAgICAgIGxldCByZXVzZUluZGV4ID0gZm9yd2FyZCA/IGxhc3RJbmRleCA6IG9sZEZpcnN0SW5kZXg7XG4gICAgICAgIGxldCBjdXJYID0gMCwgY3VyWSA9IHBvcztcbiAgICAgICAgbGV0IG5lZWRSZW5kZXI7XG4gICAgICAgIGxldCBkZWx0YVNpemUgPSAwO1xuICAgICAgICBsZXQgZmlyc3RJdGVtRGVsdGFTaXplID0gMDtcbiAgICAgICAgbGV0IHVybCA9IHRoaXMuZGVmYXVsdEl0ZW07XG4gICAgICAgIGxldCBpaSwgaWkyO1xuICAgICAgICBsZXQgaSwgajtcbiAgICAgICAgY29uc3QgcGFydFNpemUgPSAodGhpcy4kc2Nyb2xsUGFuZS52aWV3V2lkdGggLSB0aGlzLiRjb2x1bW5HYXAgKiAodGhpcy4kY3VyTGluZUl0ZW1Db3VudCAtIDEpKSAvXG4gICAgICAgICAgICB0aGlzLiRjdXJMaW5lSXRlbUNvdW50O1xuICAgICAgICB0aGlzLiRpdGVtSW5mb1ZlcisrO1xuICAgICAgICB3aGlsZSAoY3VySW5kZXggPCB0aGlzLiRyZWFsTnVtSXRlbXMgJiYgKGVuZCB8fCBjdXJZIDwgbWF4KSkge1xuICAgICAgICAgICAgaWkgPSB0aGlzLiR2aXJ0dWFsSXRlbXNbY3VySW5kZXhdO1xuICAgICAgICAgICAgaWYgKGlpLm9iaiA9PSBudWxsIHx8IGZvcmNlVXBkYXRlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXRlbVByb3ZpZGVyICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsID0gdGhpcy5pdGVtUHJvdmlkZXIoY3VySW5kZXggJSB0aGlzLiRudW1JdGVtcyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh1cmwgPT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHRoaXMuJGRlZmF1bHRJdGVtO1xuICAgICAgICAgICAgICAgICAgICB1cmwgPSBVSVBhY2thZ2Uubm9ybWFsaXplVVJMKHVybCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpaS5vYmogIT0gbnVsbCAmJiBpaS5vYmoucmVzb3VyY2VVUkwgIT0gdXJsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpaS5vYmogaW5zdGFuY2VvZiBHQnV0dG9uKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWkuc2VsZWN0ZWQgPSBpaS5vYmouc2VsZWN0ZWQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2hpbGRUb1Bvb2woaWkub2JqKTtcbiAgICAgICAgICAgICAgICAgICAgaWkub2JqID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaWkub2JqID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAvL3NlYXJjaCBmb3IgYSBtb3N0IHN1aXRhYmxlIGl0ZW0gdG8gcmV1c2UgaW4gb3JkZXIgdG8gcmVuZGVyIG9yIGNyZWF0ZSBsZXNzIGl0ZW0gd2hlbiByZWZyZXNoXG4gICAgICAgICAgICAgICAgaWYgKGZvcndhcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gcmV1c2VJbmRleDsgaiA+PSBvbGRGaXJzdEluZGV4OyBqLS0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlpMiA9IHRoaXMuJHZpcnR1YWxJdGVtc1tqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpaTIub2JqICE9IG51bGwgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpaTIudXBkYXRlRmxhZyAhPSB0aGlzLiRpdGVtSW5mb1ZlciAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlpMi5vYmoucmVzb3VyY2VVUkwgPT0gdXJsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlpMi5vYmogaW5zdGFuY2VvZiBHQnV0dG9uKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpaTIuc2VsZWN0ZWQgPSBpaTIub2JqLnNlbGVjdGVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlpLm9iaiA9IGlpMi5vYmo7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWkyLm9iaiA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGogPT0gcmV1c2VJbmRleClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV1c2VJbmRleC0tO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSByZXVzZUluZGV4OyBqIDw9IGxhc3RJbmRleDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpaTIgPSB0aGlzLiR2aXJ0dWFsSXRlbXNbal07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWkyLm9iaiAhPSBudWxsICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWkyLnVwZGF0ZUZsYWcgIT0gdGhpcy4kaXRlbUluZm9WZXIgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpaTIub2JqLnJlc291cmNlVVJMID09IHVybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpaTIub2JqIGluc3RhbmNlb2YgR0J1dHRvbilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWkyLnNlbGVjdGVkID0gaWkyLm9iai5zZWxlY3RlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpaS5vYmogPSBpaTIub2JqO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlpMi5vYmogPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqID09IHJldXNlSW5kZXgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldXNlSW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaWkub2JqICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0Q2hpbGRJbmRleChpaS5vYmosIGZvcndhcmQgPyBjdXJJbmRleCAtIG5ld0ZpcnN0SW5kZXggOiB0aGlzLm51bUNoaWxkcmVuKTtcbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWkub2JqID0gdGhpcy4kcG9vbC5nZXQodXJsKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZvcndhcmQpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZENoaWxkQXQoaWkub2JqLCBjdXJJbmRleCAtIG5ld0ZpcnN0SW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZENoaWxkKGlpLm9iaik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpaS5vYmogaW5zdGFuY2VvZiBHQnV0dG9uKVxuICAgICAgICAgICAgICAgICAgICBpaS5vYmouc2VsZWN0ZWQgPSBpaS5zZWxlY3RlZDtcbiAgICAgICAgICAgICAgICBuZWVkUmVuZGVyID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBuZWVkUmVuZGVyID0gZm9yY2VVcGRhdGU7XG4gICAgICAgICAgICBpZiAobmVlZFJlbmRlcikge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRhdXRvUmVzaXplSXRlbSAmJlxuICAgICAgICAgICAgICAgICAgICAodGhpcy4kbGF5b3V0ID09IDAgLyogU2luZ2xlQ29sdW1uICovIHx8IHRoaXMuJGNvbHVtbkNvdW50ID4gMCkpXG4gICAgICAgICAgICAgICAgICAgIGlpLm9iai5zZXRTaXplKHBhcnRTaXplLCBpaS5vYmouaGVpZ2h0LCB0cnVlKTtcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW1SZW5kZXJlcihjdXJJbmRleCAlIHRoaXMuJG51bUl0ZW1zLCBpaS5vYmopO1xuICAgICAgICAgICAgICAgIGlmIChjdXJJbmRleCAlIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBkZWx0YVNpemUgKz0gTWF0aC5jZWlsKGlpLm9iai5oZWlnaHQpIC0gaWkuaGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VySW5kZXggPT0gbmV3Rmlyc3RJbmRleCAmJiBvbGRGaXJzdEluZGV4ID4gbmV3Rmlyc3RJbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy93aGVuIHNjcm9sbGluZyBkb3duLCB3ZSBuZWVkIHRvIG1ha2UgY29tcGVuc2F0aW9uIGZvciB0aGUgcG9zaXRpb24gdG8gYXZvaWQgZmxpY2tlcmluZyBpZiB0aGUgaXRlbSdzIHNpemUgY2hhbmdlc1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RJdGVtRGVsdGFTaXplID0gTWF0aC5jZWlsKGlpLm9iai5oZWlnaHQpIC0gaWkuaGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlpLndpZHRoID0gTWF0aC5jZWlsKGlpLm9iai53aWR0aCk7XG4gICAgICAgICAgICAgICAgaWkuaGVpZ2h0ID0gTWF0aC5jZWlsKGlpLm9iai5oZWlnaHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWkudXBkYXRlRmxhZyA9IHRoaXMuJGl0ZW1JbmZvVmVyO1xuICAgICAgICAgICAgaWkub2JqLnNldFhZKGN1clgsIGN1clkpO1xuICAgICAgICAgICAgaWYgKGN1ckluZGV4ID09IG5ld0ZpcnN0SW5kZXgpXG4gICAgICAgICAgICAgICAgLy9wYWQgb25lIG1vcmVcbiAgICAgICAgICAgICAgICBtYXggKz0gaWkuaGVpZ2h0O1xuICAgICAgICAgICAgY3VyWCArPSBpaS53aWR0aCArIHRoaXMuJGNvbHVtbkdhcDtcbiAgICAgICAgICAgIGlmIChjdXJJbmRleCAlIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQgPT0gdGhpcy4kY3VyTGluZUl0ZW1Db3VudCAtIDEpIHtcbiAgICAgICAgICAgICAgICBjdXJYID0gMDtcbiAgICAgICAgICAgICAgICBjdXJZICs9IGlpLmhlaWdodCArIHRoaXMuJGxpbmVHYXA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdXJJbmRleCsrO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBvbGRDb3VudDsgaSsrKSB7XG4gICAgICAgICAgICBpaSA9IHRoaXMuJHZpcnR1YWxJdGVtc1tvbGRGaXJzdEluZGV4ICsgaV07XG4gICAgICAgICAgICBpZiAoaWkudXBkYXRlRmxhZyAhPSB0aGlzLiRpdGVtSW5mb1ZlciAmJiBpaS5vYmogIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmIChpaS5vYmogaW5zdGFuY2VvZiBHQnV0dG9uKVxuICAgICAgICAgICAgICAgICAgICBpaS5zZWxlY3RlZCA9IGlpLm9iai5zZWxlY3RlZDtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUNoaWxkVG9Qb29sKGlpLm9iaik7XG4gICAgICAgICAgICAgICAgaWkub2JqID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZGVsdGFTaXplICE9IDAgfHwgZmlyc3RJdGVtRGVsdGFTaXplICE9IDApXG4gICAgICAgICAgICB0aGlzLiRzY3JvbGxQYW5lLmNoYW5nZUNvbnRlbnRTaXplT25TY3JvbGxpbmcoMCwgZGVsdGFTaXplLCAwLCBmaXJzdEl0ZW1EZWx0YVNpemUpO1xuICAgICAgICBpZiAoY3VySW5kZXggPiAwICYmXG4gICAgICAgICAgICB0aGlzLm51bUNoaWxkcmVuID4gMCAmJlxuICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLnkgPCAwICYmXG4gICAgICAgICAgICB0aGlzLmdldENoaWxkQXQoMCkueSA+IC10aGlzLiRjb250YWluZXIueSlcbiAgICAgICAgICAgIC8vbGFzdCBwYWdlIGlzIG5vdCBmdWxsXG4gICAgICAgICAgICB0aGlzLmhhbmRsZVNjcm9sbDEoZmFsc2UpOyAvL3JlY3Vyc2l2ZVxuICAgIH1cbiAgICBoYW5kbGVTY3JvbGwyKGZvcmNlVXBkYXRlKSB7XG4gICAgICAgIHRoaXMuJGVudGVyQ291bnRlcisrO1xuICAgICAgICBpZiAodGhpcy4kZW50ZXJDb3VudGVyID4gMykge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCd0aGlzIGxpc3QgdmlldyBjYW5ub3QgYmUgZmlsbGVkIGZ1bGwgYXMgdGhlIGl0ZW1SZW5kZXJlciBmdW5jdGlvbiBhbHdheXMgcmV0dXJucyBhbiBpdGVtIHdpdGggZGlmZmVyZW50IHNpemUuJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHBvcyA9IHRoaXMuJHNjcm9sbFBhbmUuc2Nyb2xsaW5nUG9zWDtcbiAgICAgICAgbGV0IG1heCA9IHBvcyArIHRoaXMuJHNjcm9sbFBhbmUudmlld1dpZHRoO1xuICAgICAgICBjb25zdCBlbmQgPSBwb3MgPT0gdGhpcy4kc2Nyb2xsUGFuZS5jb250ZW50V2lkdGg7XG4gICAgICAgIEdMaXN0LiRsYXN0UG9zSGVscGVyID0gcG9zO1xuICAgICAgICBjb25zdCBuZXdGaXJzdEluZGV4ID0gdGhpcy5nZXRJbmRleE9uUG9zMihmb3JjZVVwZGF0ZSk7XG4gICAgICAgIGlmIChuZXdGaXJzdEluZGV4ID09IHRoaXMuJGZpcnN0SW5kZXggJiYgIWZvcmNlVXBkYXRlKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBwb3MgPSBHTGlzdC4kbGFzdFBvc0hlbHBlcjtcbiAgICAgICAgY29uc3Qgb2xkRmlyc3RJbmRleCA9IHRoaXMuJGZpcnN0SW5kZXg7XG4gICAgICAgIHRoaXMuJGZpcnN0SW5kZXggPSBuZXdGaXJzdEluZGV4O1xuICAgICAgICBsZXQgY3VySW5kZXggPSBuZXdGaXJzdEluZGV4O1xuICAgICAgICBjb25zdCBmb3J3YXJkID0gb2xkRmlyc3RJbmRleCA+IG5ld0ZpcnN0SW5kZXg7XG4gICAgICAgIGNvbnN0IG9sZENvdW50ID0gdGhpcy5udW1DaGlsZHJlbjtcbiAgICAgICAgbGV0IGxhc3RJbmRleCA9IG9sZEZpcnN0SW5kZXggKyBvbGRDb3VudCAtIDE7XG4gICAgICAgIGxldCByZXVzZUluZGV4ID0gZm9yd2FyZCA/IGxhc3RJbmRleCA6IG9sZEZpcnN0SW5kZXg7XG4gICAgICAgIGxldCBjdXJYID0gcG9zLCBjdXJZID0gMDtcbiAgICAgICAgbGV0IG5lZWRSZW5kZXI7XG4gICAgICAgIGxldCBkZWx0YVNpemUgPSAwO1xuICAgICAgICBsZXQgZmlyc3RJdGVtRGVsdGFTaXplID0gMDtcbiAgICAgICAgbGV0IHVybCA9IHRoaXMuZGVmYXVsdEl0ZW07XG4gICAgICAgIGxldCBpaSwgaWkyO1xuICAgICAgICBsZXQgaSwgajtcbiAgICAgICAgY29uc3QgcGFydFNpemUgPSAodGhpcy4kc2Nyb2xsUGFuZS52aWV3SGVpZ2h0IC0gdGhpcy4kbGluZUdhcCAqICh0aGlzLiRjdXJMaW5lSXRlbUNvdW50IC0gMSkpIC9cbiAgICAgICAgICAgIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQ7XG4gICAgICAgIHRoaXMuJGl0ZW1JbmZvVmVyKys7XG4gICAgICAgIHdoaWxlIChjdXJJbmRleCA8IHRoaXMuJHJlYWxOdW1JdGVtcyAmJiAoZW5kIHx8IGN1clggPCBtYXgpKSB7XG4gICAgICAgICAgICBpaSA9IHRoaXMuJHZpcnR1YWxJdGVtc1tjdXJJbmRleF07XG4gICAgICAgICAgICBpZiAoaWkub2JqID09IG51bGwgfHwgZm9yY2VVcGRhdGUpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pdGVtUHJvdmlkZXIgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICB1cmwgPSB0aGlzLml0ZW1Qcm92aWRlcihjdXJJbmRleCAlIHRoaXMuJG51bUl0ZW1zKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVybCA9PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdGhpcy4kZGVmYXVsdEl0ZW07XG4gICAgICAgICAgICAgICAgICAgIHVybCA9IFVJUGFja2FnZS5ub3JtYWxpemVVUkwodXJsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGlpLm9iaiAhPSBudWxsICYmIGlpLm9iai5yZXNvdXJjZVVSTCAhPSB1cmwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlpLm9iaiBpbnN0YW5jZW9mIEdCdXR0b24pXG4gICAgICAgICAgICAgICAgICAgICAgICBpaS5zZWxlY3RlZCA9IGlpLm9iai5zZWxlY3RlZDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVDaGlsZFRvUG9vbChpaS5vYmopO1xuICAgICAgICAgICAgICAgICAgICBpaS5vYmogPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpaS5vYmogPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmIChmb3J3YXJkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoaiA9IHJldXNlSW5kZXg7IGogPj0gb2xkRmlyc3RJbmRleDsgai0tKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpaTIgPSB0aGlzLiR2aXJ0dWFsSXRlbXNbal07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWkyLm9iaiAhPSBudWxsICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWkyLnVwZGF0ZUZsYWcgIT0gdGhpcy4kaXRlbUluZm9WZXIgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpaTIub2JqLnJlc291cmNlVVJMID09IHVybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpaTIub2JqIGluc3RhbmNlb2YgR0J1dHRvbilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWkyLnNlbGVjdGVkID0gaWkyLm9iai5zZWxlY3RlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpaS5vYmogPSBpaTIub2JqO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlpMi5vYmogPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqID09IHJldXNlSW5kZXgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldXNlSW5kZXgtLTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gcmV1c2VJbmRleDsgaiA8PSBsYXN0SW5kZXg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWkyID0gdGhpcy4kdmlydHVhbEl0ZW1zW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlpMi5vYmogIT0gbnVsbCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlpMi51cGRhdGVGbGFnICE9IHRoaXMuJGl0ZW1JbmZvVmVyICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWkyLm9iai5yZXNvdXJjZVVSTCA9PSB1cmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWkyLm9iaiBpbnN0YW5jZW9mIEdCdXR0b24pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlpMi5zZWxlY3RlZCA9IGlpMi5vYmouc2VsZWN0ZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWkub2JqID0gaWkyLm9iajtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpaTIub2JqID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaiA9PSByZXVzZUluZGV4KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXVzZUluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGlpLm9iaiAhPSBudWxsKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldENoaWxkSW5kZXgoaWkub2JqLCBmb3J3YXJkID8gY3VySW5kZXggLSBuZXdGaXJzdEluZGV4IDogdGhpcy5udW1DaGlsZHJlbik7XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlpLm9iaiA9IHRoaXMuJHBvb2wuZ2V0KHVybCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmb3J3YXJkKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRDaGlsZEF0KGlpLm9iaiwgY3VySW5kZXggLSBuZXdGaXJzdEluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRDaGlsZChpaS5vYmopO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaWkub2JqIGluc3RhbmNlb2YgR0J1dHRvbilcbiAgICAgICAgICAgICAgICAgICAgaWkub2JqLnNlbGVjdGVkID0gaWkuc2VsZWN0ZWQ7XG4gICAgICAgICAgICAgICAgbmVlZFJlbmRlciA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgbmVlZFJlbmRlciA9IGZvcmNlVXBkYXRlO1xuICAgICAgICAgICAgaWYgKG5lZWRSZW5kZXIpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kYXV0b1Jlc2l6ZUl0ZW0gJiZcbiAgICAgICAgICAgICAgICAgICAgKHRoaXMuJGxheW91dCA9PSAxIC8qIFNpbmdsZVJvdyAqLyB8fCB0aGlzLiRsaW5lQ291bnQgPiAwKSlcbiAgICAgICAgICAgICAgICAgICAgaWkub2JqLnNldFNpemUoaWkub2JqLndpZHRoLCBwYXJ0U2l6ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5pdGVtUmVuZGVyZXIoY3VySW5kZXggJSB0aGlzLiRudW1JdGVtcywgaWkub2JqKTtcbiAgICAgICAgICAgICAgICBpZiAoY3VySW5kZXggJSB0aGlzLiRjdXJMaW5lSXRlbUNvdW50ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsdGFTaXplICs9IE1hdGguY2VpbChpaS5vYmoud2lkdGgpIC0gaWkud2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJJbmRleCA9PSBuZXdGaXJzdEluZGV4ICYmIG9sZEZpcnN0SW5kZXggPiBuZXdGaXJzdEluZGV4KVxuICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RJdGVtRGVsdGFTaXplID0gTWF0aC5jZWlsKGlpLm9iai53aWR0aCkgLSBpaS53aWR0aDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWkud2lkdGggPSBNYXRoLmNlaWwoaWkub2JqLndpZHRoKTtcbiAgICAgICAgICAgICAgICBpaS5oZWlnaHQgPSBNYXRoLmNlaWwoaWkub2JqLmhlaWdodCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpaS51cGRhdGVGbGFnID0gdGhpcy4kaXRlbUluZm9WZXI7XG4gICAgICAgICAgICBpaS5vYmouc2V0WFkoY3VyWCwgY3VyWSk7XG4gICAgICAgICAgICBpZiAoY3VySW5kZXggPT0gbmV3Rmlyc3RJbmRleClcbiAgICAgICAgICAgICAgICBtYXggKz0gaWkud2lkdGg7XG4gICAgICAgICAgICBjdXJZICs9IGlpLmhlaWdodCArIHRoaXMuJGxpbmVHYXA7XG4gICAgICAgICAgICBpZiAoY3VySW5kZXggJSB0aGlzLiRjdXJMaW5lSXRlbUNvdW50ID09IHRoaXMuJGN1ckxpbmVJdGVtQ291bnQgLSAxKSB7XG4gICAgICAgICAgICAgICAgY3VyWSA9IDA7XG4gICAgICAgICAgICAgICAgY3VyWCArPSBpaS53aWR0aCArIHRoaXMuJGNvbHVtbkdhcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1ckluZGV4Kys7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChpID0gMDsgaSA8IG9sZENvdW50OyBpKyspIHtcbiAgICAgICAgICAgIGlpID0gdGhpcy4kdmlydHVhbEl0ZW1zW29sZEZpcnN0SW5kZXggKyBpXTtcbiAgICAgICAgICAgIGlmIChpaS51cGRhdGVGbGFnICE9IHRoaXMuJGl0ZW1JbmZvVmVyICYmIGlpLm9iaiAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlpLm9iaiBpbnN0YW5jZW9mIEdCdXR0b24pXG4gICAgICAgICAgICAgICAgICAgIGlpLnNlbGVjdGVkID0gaWkub2JqLnNlbGVjdGVkO1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2hpbGRUb1Bvb2woaWkub2JqKTtcbiAgICAgICAgICAgICAgICBpaS5vYmogPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChkZWx0YVNpemUgIT0gMCB8fCBmaXJzdEl0ZW1EZWx0YVNpemUgIT0gMClcbiAgICAgICAgICAgIHRoaXMuJHNjcm9sbFBhbmUuY2hhbmdlQ29udGVudFNpemVPblNjcm9sbGluZyhkZWx0YVNpemUsIDAsIGZpcnN0SXRlbURlbHRhU2l6ZSwgMCk7XG4gICAgICAgIGlmIChjdXJJbmRleCA+IDAgJiZcbiAgICAgICAgICAgIHRoaXMubnVtQ2hpbGRyZW4gPiAwICYmXG4gICAgICAgICAgICB0aGlzLiRjb250YWluZXIueCA8IDAgJiZcbiAgICAgICAgICAgIHRoaXMuZ2V0Q2hpbGRBdCgwKS54ID4gLXRoaXMuJGNvbnRhaW5lci54KVxuICAgICAgICAgICAgdGhpcy5oYW5kbGVTY3JvbGwyKGZhbHNlKTtcbiAgICB9XG4gICAgaGFuZGxlU2Nyb2xsMyhmb3JjZVVwZGF0ZSkge1xuICAgICAgICBsZXQgcG9zID0gdGhpcy4kc2Nyb2xsUGFuZS5zY3JvbGxpbmdQb3NYO1xuICAgICAgICBHTGlzdC4kbGFzdFBvc0hlbHBlciA9IHBvcztcbiAgICAgICAgY29uc3QgbmV3Rmlyc3RJbmRleCA9IHRoaXMuZ2V0SW5kZXhPblBvczMoZm9yY2VVcGRhdGUpO1xuICAgICAgICBpZiAobmV3Rmlyc3RJbmRleCA9PSB0aGlzLiRmaXJzdEluZGV4ICYmICFmb3JjZVVwZGF0ZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgcG9zID0gR0xpc3QuJGxhc3RQb3NIZWxwZXI7XG4gICAgICAgIGNvbnN0IG9sZEZpcnN0SW5kZXggPSB0aGlzLiRmaXJzdEluZGV4O1xuICAgICAgICB0aGlzLiRmaXJzdEluZGV4ID0gbmV3Rmlyc3RJbmRleDtcbiAgICAgICAgLy9oZWlnaHQtc3luYyBpcyBub3Qgc3VwcG9ydGVkIGluIHBhZ25hdGlvbiBtb2RlLCBzbyBqdXN0IG9ubHkgcmVuZGVyIDEgcGFnZVxuICAgICAgICBsZXQgcmV1c2VJbmRleCA9IG9sZEZpcnN0SW5kZXg7XG4gICAgICAgIGNvbnN0IHZpcnR1YWxJdGVtQ291bnQgPSB0aGlzLiR2aXJ0dWFsSXRlbXMubGVuZ3RoO1xuICAgICAgICBjb25zdCBwYWdlU2l6ZSA9IHRoaXMuJGN1ckxpbmVJdGVtQ291bnQgKiB0aGlzLiRjdXJMaW5lSXRlbUNvdW50MjtcbiAgICAgICAgY29uc3Qgc3RhcnRDb2wgPSBuZXdGaXJzdEluZGV4ICUgdGhpcy4kY3VyTGluZUl0ZW1Db3VudDtcbiAgICAgICAgY29uc3Qgdmlld1dpZHRoID0gdGhpcy52aWV3V2lkdGg7XG4gICAgICAgIGNvbnN0IHBhZ2UgPSBNYXRoLmZsb29yKG5ld0ZpcnN0SW5kZXggLyBwYWdlU2l6ZSk7XG4gICAgICAgIGNvbnN0IHN0YXJ0SW5kZXggPSBwYWdlICogcGFnZVNpemU7XG4gICAgICAgIGNvbnN0IGxhc3RJbmRleCA9IHN0YXJ0SW5kZXggKyBwYWdlU2l6ZSAqIDI7XG4gICAgICAgIGxldCBuZWVkUmVuZGVyO1xuICAgICAgICBsZXQgaTtcbiAgICAgICAgbGV0IGlpLCBpaTI7XG4gICAgICAgIGxldCBjb2w7XG4gICAgICAgIGxldCB1cmwgPSB0aGlzLiRkZWZhdWx0SXRlbTtcbiAgICAgICAgY29uc3QgcGFydFdpZHRoID0gKHRoaXMuJHNjcm9sbFBhbmUudmlld1dpZHRoIC0gdGhpcy4kY29sdW1uR2FwICogKHRoaXMuJGN1ckxpbmVJdGVtQ291bnQgLSAxKSkgL1xuICAgICAgICAgICAgdGhpcy4kY3VyTGluZUl0ZW1Db3VudDtcbiAgICAgICAgY29uc3QgcGFydEhlaWdodCA9ICh0aGlzLiRzY3JvbGxQYW5lLnZpZXdIZWlnaHQgLSB0aGlzLiRsaW5lR2FwICogKHRoaXMuJGN1ckxpbmVJdGVtQ291bnQyIC0gMSkpIC9cbiAgICAgICAgICAgIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQyO1xuICAgICAgICB0aGlzLiRpdGVtSW5mb1ZlcisrO1xuICAgICAgICAvL2FkZCBtYXJrIGZvciBpdGVtcyB1c2VkIHRoaXMgdGltZVxuICAgICAgICBmb3IgKGkgPSBzdGFydEluZGV4OyBpIDwgbGFzdEluZGV4OyBpKyspIHtcbiAgICAgICAgICAgIGlmIChpID49IHRoaXMuJHJlYWxOdW1JdGVtcylcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIGNvbCA9IGkgJSB0aGlzLiRjdXJMaW5lSXRlbUNvdW50O1xuICAgICAgICAgICAgaWYgKGkgLSBzdGFydEluZGV4IDwgcGFnZVNpemUpIHtcbiAgICAgICAgICAgICAgICBpZiAoY29sIDwgc3RhcnRDb2wpXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbCA+IHN0YXJ0Q29sKVxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlpID0gdGhpcy4kdmlydHVhbEl0ZW1zW2ldO1xuICAgICAgICAgICAgaWkudXBkYXRlRmxhZyA9IHRoaXMuJGl0ZW1JbmZvVmVyO1xuICAgICAgICB9XG4gICAgICAgIGxldCBsYXN0T2JqID0gbnVsbDtcbiAgICAgICAgbGV0IGluc2VydEluZGV4ID0gMDtcbiAgICAgICAgZm9yIChpID0gc3RhcnRJbmRleDsgaSA8IGxhc3RJbmRleDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoaSA+PSB0aGlzLiRyZWFsTnVtSXRlbXMpXG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICBpaSA9IHRoaXMuJHZpcnR1YWxJdGVtc1tpXTtcbiAgICAgICAgICAgIGlmIChpaS51cGRhdGVGbGFnICE9IHRoaXMuJGl0ZW1JbmZvVmVyKVxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgaWYgKGlpLm9iaiA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgLy9maW5kIGlmIGFueSBmcmVlIGl0ZW0gY2FuIGJlIHVzZWRcbiAgICAgICAgICAgICAgICB3aGlsZSAocmV1c2VJbmRleCA8IHZpcnR1YWxJdGVtQ291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWkyID0gdGhpcy4kdmlydHVhbEl0ZW1zW3JldXNlSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaWkyLm9iaiAhPSBudWxsICYmIGlpMi51cGRhdGVGbGFnICE9IHRoaXMuJGl0ZW1JbmZvVmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWkyLm9iaiBpbnN0YW5jZW9mIEdCdXR0b24pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWkyLnNlbGVjdGVkID0gaWkyLm9iai5zZWxlY3RlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlpLm9iaiA9IGlpMi5vYmo7XG4gICAgICAgICAgICAgICAgICAgICAgICBpaTIub2JqID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldXNlSW5kZXgrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGluc2VydEluZGV4ID09IC0xKVxuICAgICAgICAgICAgICAgICAgICBpbnNlcnRJbmRleCA9IHRoaXMuZ2V0Q2hpbGRJbmRleChsYXN0T2JqKSArIDE7XG4gICAgICAgICAgICAgICAgaWYgKGlpLm9iaiA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLml0ZW1Qcm92aWRlciAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB0aGlzLml0ZW1Qcm92aWRlcihpICUgdGhpcy4kbnVtSXRlbXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVybCA9PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHRoaXMuJGRlZmF1bHRJdGVtO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gVUlQYWNrYWdlLm5vcm1hbGl6ZVVSTCh1cmwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlpLm9iaiA9IHRoaXMuJHBvb2wuZ2V0KHVybCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkQ2hpbGRBdChpaS5vYmosIGluc2VydEluZGV4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBpbnNlcnRJbmRleCA9IHRoaXMuc2V0Q2hpbGRJbmRleEJlZm9yZShpaS5vYmosIGluc2VydEluZGV4KTtcbiAgICAgICAgICAgICAgICBpbnNlcnRJbmRleCsrO1xuICAgICAgICAgICAgICAgIGlmIChpaS5vYmogaW5zdGFuY2VvZiBHQnV0dG9uKVxuICAgICAgICAgICAgICAgICAgICBpaS5vYmouc2VsZWN0ZWQgPSBpaS5zZWxlY3RlZDtcbiAgICAgICAgICAgICAgICBuZWVkUmVuZGVyID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG5lZWRSZW5kZXIgPSBmb3JjZVVwZGF0ZTtcbiAgICAgICAgICAgICAgICBpbnNlcnRJbmRleCA9IC0xO1xuICAgICAgICAgICAgICAgIGxhc3RPYmogPSBpaS5vYmo7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobmVlZFJlbmRlcikge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRhdXRvUmVzaXplSXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kY3VyTGluZUl0ZW1Db3VudCA9PSB0aGlzLiRjb2x1bW5Db3VudCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kY3VyTGluZUl0ZW1Db3VudDIgPT0gdGhpcy4kbGluZUNvdW50KVxuICAgICAgICAgICAgICAgICAgICAgICAgaWkub2JqLnNldFNpemUocGFydFdpZHRoLCBwYXJ0SGVpZ2h0LCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy4kY3VyTGluZUl0ZW1Db3VudCA9PSB0aGlzLiRjb2x1bW5Db3VudClcbiAgICAgICAgICAgICAgICAgICAgICAgIGlpLm9iai5zZXRTaXplKHBhcnRXaWR0aCwgaWkub2JqLmhlaWdodCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuJGN1ckxpbmVJdGVtQ291bnQyID09IHRoaXMuJGxpbmVDb3VudClcbiAgICAgICAgICAgICAgICAgICAgICAgIGlpLm9iai5zZXRTaXplKGlpLm9iai53aWR0aCwgcGFydEhlaWdodCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuaXRlbVJlbmRlcmVyKGkgJSB0aGlzLiRudW1JdGVtcywgaWkub2JqKTtcbiAgICAgICAgICAgICAgICBpaS53aWR0aCA9IE1hdGguY2VpbChpaS5vYmoud2lkdGgpO1xuICAgICAgICAgICAgICAgIGlpLmhlaWdodCA9IE1hdGguY2VpbChpaS5vYmouaGVpZ2h0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvL2xheW91dFxuICAgICAgICBsZXQgYm9yZGVyWCA9IChzdGFydEluZGV4IC8gcGFnZVNpemUpICogdmlld1dpZHRoO1xuICAgICAgICBsZXQgeHggPSBib3JkZXJYO1xuICAgICAgICBsZXQgeXkgPSAwO1xuICAgICAgICBsZXQgbGluZUhlaWdodCA9IDA7XG4gICAgICAgIGZvciAoaSA9IHN0YXJ0SW5kZXg7IGkgPCBsYXN0SW5kZXg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGkgPj0gdGhpcy4kcmVhbE51bUl0ZW1zKVxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgaWkgPSB0aGlzLiR2aXJ0dWFsSXRlbXNbaV07XG4gICAgICAgICAgICBpZiAoaWkudXBkYXRlRmxhZyA9PSB0aGlzLiRpdGVtSW5mb1ZlcilcbiAgICAgICAgICAgICAgICBpaS5vYmouc2V0WFkoeHgsIHl5KTtcbiAgICAgICAgICAgIGlmIChpaS5oZWlnaHQgPiBsaW5lSGVpZ2h0KVxuICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQgPSBpaS5oZWlnaHQ7XG4gICAgICAgICAgICBpZiAoaSAlIHRoaXMuJGN1ckxpbmVJdGVtQ291bnQgPT0gdGhpcy4kY3VyTGluZUl0ZW1Db3VudCAtIDEpIHtcbiAgICAgICAgICAgICAgICB4eCA9IGJvcmRlclg7XG4gICAgICAgICAgICAgICAgeXkgKz0gbGluZUhlaWdodCArIHRoaXMuJGxpbmVHYXA7XG4gICAgICAgICAgICAgICAgbGluZUhlaWdodCA9IDA7XG4gICAgICAgICAgICAgICAgaWYgKGkgPT0gc3RhcnRJbmRleCArIHBhZ2VTaXplIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICBib3JkZXJYICs9IHZpZXdXaWR0aDtcbiAgICAgICAgICAgICAgICAgICAgeHggPSBib3JkZXJYO1xuICAgICAgICAgICAgICAgICAgICB5eSA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHh4ICs9IGlpLndpZHRoICsgdGhpcy4kY29sdW1uR2FwO1xuICAgICAgICB9XG4gICAgICAgIC8vcmVsZWFzZSBpdGVtcyBub3QgdXNlZFxuICAgICAgICBmb3IgKGkgPSByZXVzZUluZGV4OyBpIDwgdmlydHVhbEl0ZW1Db3VudDsgaSsrKSB7XG4gICAgICAgICAgICBpaSA9IHRoaXMuJHZpcnR1YWxJdGVtc1tpXTtcbiAgICAgICAgICAgIGlmIChpaS51cGRhdGVGbGFnICE9IHRoaXMuJGl0ZW1JbmZvVmVyICYmIGlpLm9iaiAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlpLm9iaiBpbnN0YW5jZW9mIEdCdXR0b24pXG4gICAgICAgICAgICAgICAgICAgIGlpLnNlbGVjdGVkID0gaWkub2JqLnNlbGVjdGVkO1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2hpbGRUb1Bvb2woaWkub2JqKTtcbiAgICAgICAgICAgICAgICBpaS5vYmogPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZUFyY2hPcmRlcjEoKSB7XG4gICAgICAgIGlmICh0aGlzLiRjaGlsZHJlblJlbmRlck9yZGVyID09IDIgLyogQXJjaCAqLykge1xuICAgICAgICAgICAgY29uc3QgbWlkID0gdGhpcy4kc2Nyb2xsUGFuZS5wb3NZICsgdGhpcy52aWV3SGVpZ2h0IC8gMjtcbiAgICAgICAgICAgIGxldCBtaW5EaXN0ID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZO1xuICAgICAgICAgICAgbGV0IGRpc3QgPSAwO1xuICAgICAgICAgICAgbGV0IGFwZXhJbmRleCA9IDA7XG4gICAgICAgICAgICBjb25zdCBjbnQgPSB0aGlzLm51bUNoaWxkcmVuO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjbnQ7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IG9iaiA9IHRoaXMuZ2V0Q2hpbGRBdChpKTtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZm9sZEludmlzaWJsZUl0ZW1zIHx8IG9iai52aXNpYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3QgPSBNYXRoLmFicyhtaWQgLSBvYmoueSAtIG9iai5oZWlnaHQgLyAyKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3QgPCBtaW5EaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtaW5EaXN0ID0gZGlzdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwZXhJbmRleCA9IGk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmFwZXhJbmRleCA9IGFwZXhJbmRleDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBoYW5kbGVBcmNoT3JkZXIyKCkge1xuICAgICAgICBpZiAodGhpcy5jaGlsZHJlblJlbmRlck9yZGVyID09IDIgLyogQXJjaCAqLykge1xuICAgICAgICAgICAgY29uc3QgbWlkID0gdGhpcy4kc2Nyb2xsUGFuZS5wb3NYICsgdGhpcy52aWV3V2lkdGggLyAyO1xuICAgICAgICAgICAgbGV0IG1pbkRpc3QgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFk7XG4gICAgICAgICAgICBsZXQgZGlzdCA9IDA7XG4gICAgICAgICAgICBsZXQgYXBleEluZGV4ID0gMDtcbiAgICAgICAgICAgIGNvbnN0IGNudCA9IHRoaXMubnVtQ2hpbGRyZW47XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgb2JqID0gdGhpcy5nZXRDaGlsZEF0KGkpO1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5mb2xkSW52aXNpYmxlSXRlbXMgfHwgb2JqLnZpc2libGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzdCA9IE1hdGguYWJzKG1pZCAtIG9iai54IC0gb2JqLndpZHRoIC8gMik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkaXN0IDwgbWluRGlzdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWluRGlzdCA9IGRpc3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcGV4SW5kZXggPSBpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5hcGV4SW5kZXggPSBhcGV4SW5kZXg7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlQWxpZ24oY29udGVudFdpZHRoLCBjb250ZW50SGVpZ2h0KSB7XG4gICAgICAgIGxldCBuZXdPZmZzZXRYID0gMDtcbiAgICAgICAgbGV0IG5ld09mZnNldFkgPSAwO1xuICAgICAgICBpZiAoY29udGVudEhlaWdodCA8IHRoaXMudmlld0hlaWdodCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuJHZlcnRpY2FsQWxpZ24gPT0gMSAvKiBNaWRkbGUgKi8pXG4gICAgICAgICAgICAgICAgbmV3T2Zmc2V0WSA9IE1hdGguZmxvb3IoKHRoaXMudmlld0hlaWdodCAtIGNvbnRlbnRIZWlnaHQpIC8gMik7XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLiR2ZXJ0aWNhbEFsaWduID09IDIgLyogQm90dG9tICovKVxuICAgICAgICAgICAgICAgIG5ld09mZnNldFkgPSB0aGlzLnZpZXdIZWlnaHQgLSBjb250ZW50SGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb250ZW50V2lkdGggPCB0aGlzLnZpZXdXaWR0aCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuJGFsaWduID09IFwiY2VudGVyXCIgLyogQ2VudGVyICovKVxuICAgICAgICAgICAgICAgIG5ld09mZnNldFggPSBNYXRoLmZsb29yKCh0aGlzLnZpZXdXaWR0aCAtIGNvbnRlbnRXaWR0aCkgLyAyKTtcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuJGFsaWduID09IFwicmlnaHRcIiAvKiBSaWdodCAqLylcbiAgICAgICAgICAgICAgICBuZXdPZmZzZXRYID0gdGhpcy52aWV3V2lkdGggLSBjb250ZW50V2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5ld09mZnNldFggIT0gdGhpcy4kYWxpZ25PZmZzZXQueCB8fCBuZXdPZmZzZXRZICE9IHRoaXMuJGFsaWduT2Zmc2V0LnkpIHtcbiAgICAgICAgICAgIHRoaXMuJGFsaWduT2Zmc2V0LnNldFZhbHVlcyhuZXdPZmZzZXRYLCBuZXdPZmZzZXRZKTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRzY3JvbGxQYW5lICE9IG51bGwpXG4gICAgICAgICAgICAgICAgdGhpcy4kc2Nyb2xsUGFuZS5hZGp1c3RNYXNrQ29udGFpbmVyKCk7XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXIueCA9IHRoaXMuJG1hcmdpbi5sZWZ0ICsgdGhpcy4kYWxpZ25PZmZzZXQueDtcbiAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXIueSA9IHRoaXMuJG1hcmdpbi50b3AgKyB0aGlzLiRhbGlnbk9mZnNldC55O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKkBvdmVycmlkZSAqL1xuICAgIHVwZGF0ZUJvdW5kcygpIHtcbiAgICAgICAgaWYgKHRoaXMuJHZpcnR1YWwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGxldCBpO1xuICAgICAgICBsZXQgY2hpbGQ7XG4gICAgICAgIGxldCBjdXJYID0gMDtcbiAgICAgICAgbGV0IGN1clkgPSAwO1xuICAgICAgICBsZXQgbWF4V2lkdGggPSAwO1xuICAgICAgICBsZXQgbWF4SGVpZ2h0ID0gMDtcbiAgICAgICAgbGV0IGN3ID0gMCwgY2ggPSAwO1xuICAgICAgICBsZXQgaiA9IDA7XG4gICAgICAgIGxldCBwYWdlID0gMDtcbiAgICAgICAgbGV0IGsgPSAwO1xuICAgICAgICBjb25zdCBjbnQgPSB0aGlzLiRjaGlsZHJlbi5sZW5ndGg7XG4gICAgICAgIGNvbnN0IHZpZXdXaWR0aCA9IHRoaXMudmlld1dpZHRoO1xuICAgICAgICBjb25zdCB2aWV3SGVpZ2h0ID0gdGhpcy52aWV3SGVpZ2h0O1xuICAgICAgICBsZXQgbGluZVNpemUgPSAwO1xuICAgICAgICBsZXQgbGluZVN0YXJ0ID0gMDtcbiAgICAgICAgbGV0IHJhdGlvO1xuICAgICAgICBpZiAodGhpcy4kbGF5b3V0ID09IDAgLyogU2luZ2xlQ29sdW1uICovKSB7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY250OyBpKyspIHtcbiAgICAgICAgICAgICAgICBjaGlsZCA9IHRoaXMuZ2V0Q2hpbGRBdChpKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5mb2xkSW52aXNpYmxlSXRlbXMgJiYgIWNoaWxkLnZpc2libGUpXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGlmIChjdXJZICE9IDApXG4gICAgICAgICAgICAgICAgICAgIGN1clkgKz0gdGhpcy4kbGluZUdhcDtcbiAgICAgICAgICAgICAgICBjaGlsZC55ID0gY3VyWTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4kYXV0b1Jlc2l6ZUl0ZW0pXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkLnNldFNpemUodmlld1dpZHRoLCBjaGlsZC5oZWlnaHQsIHRydWUpO1xuICAgICAgICAgICAgICAgIGN1clkgKz0gTWF0aC5jZWlsKGNoaWxkLmhlaWdodCk7XG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkLndpZHRoID4gbWF4V2lkdGgpXG4gICAgICAgICAgICAgICAgICAgIG1heFdpZHRoID0gY2hpbGQud2lkdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdyA9IE1hdGguY2VpbChtYXhXaWR0aCk7XG4gICAgICAgICAgICBjaCA9IGN1clk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy4kbGF5b3V0ID09IDEgLyogU2luZ2xlUm93ICovKSB7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY250OyBpKyspIHtcbiAgICAgICAgICAgICAgICBjaGlsZCA9IHRoaXMuZ2V0Q2hpbGRBdChpKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5mb2xkSW52aXNpYmxlSXRlbXMgJiYgIWNoaWxkLnZpc2libGUpXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIGlmIChjdXJYICE9IDApXG4gICAgICAgICAgICAgICAgICAgIGN1clggKz0gdGhpcy4kY29sdW1uR2FwO1xuICAgICAgICAgICAgICAgIGNoaWxkLnggPSBjdXJYO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLiRhdXRvUmVzaXplSXRlbSlcbiAgICAgICAgICAgICAgICAgICAgY2hpbGQuc2V0U2l6ZShjaGlsZC53aWR0aCwgdmlld0hlaWdodCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgY3VyWCArPSBNYXRoLmNlaWwoY2hpbGQud2lkdGgpO1xuICAgICAgICAgICAgICAgIGlmIChjaGlsZC5oZWlnaHQgPiBtYXhIZWlnaHQpXG4gICAgICAgICAgICAgICAgICAgIG1heEhlaWdodCA9IGNoaWxkLmhlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN3ID0gY3VyWDtcbiAgICAgICAgICAgIGNoID0gTWF0aC5jZWlsKG1heEhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy4kbGF5b3V0ID09IDIgLyogRmxvd0hvcml6b250YWwgKi8pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRhdXRvUmVzaXplSXRlbSAmJiB0aGlzLiRjb2x1bW5Db3VudCA+IDApIHtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY250OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLmdldENoaWxkQXQoaSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvbGRJbnZpc2libGVJdGVtcyAmJiAhY2hpbGQudmlzaWJsZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICBsaW5lU2l6ZSArPSBjaGlsZC5zb3VyY2VXaWR0aDtcbiAgICAgICAgICAgICAgICAgICAgaisrO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaiA9PSB0aGlzLiRjb2x1bW5Db3VudCB8fCBpID09IGNudCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhdGlvID0gKHZpZXdXaWR0aCAtIGxpbmVTaXplIC0gKGogLSAxKSAqIHRoaXMuJGNvbHVtbkdhcCkgLyBsaW5lU2l6ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1clggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gbGluZVN0YXJ0OyBqIDw9IGk7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkID0gdGhpcy5nZXRDaGlsZEF0KGopO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvbGRJbnZpc2libGVJdGVtcyAmJiAhY2hpbGQudmlzaWJsZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQuc2V0WFkoY3VyWCwgY3VyWSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGogPCBpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLnNldFNpemUoY2hpbGQuc291cmNlV2lkdGggKyBNYXRoLnJvdW5kKGNoaWxkLnNvdXJjZVdpZHRoICogcmF0aW8pLCBjaGlsZC5oZWlnaHQsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJYICs9IE1hdGguY2VpbChjaGlsZC53aWR0aCkgKyB0aGlzLiRjb2x1bW5HYXA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQuc2V0U2l6ZSh2aWV3V2lkdGggLSBjdXJYLCBjaGlsZC5oZWlnaHQsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZC5oZWlnaHQgPiBtYXhIZWlnaHQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heEhlaWdodCA9IGNoaWxkLmhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vbmV3IGxpbmVcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1clkgKz0gTWF0aC5jZWlsKG1heEhlaWdodCkgKyB0aGlzLiRsaW5lR2FwO1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SGVpZ2h0ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGogPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGluZVN0YXJ0ID0gaSArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lU2l6ZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2ggPSBjdXJZICsgTWF0aC5jZWlsKG1heEhlaWdodCk7XG4gICAgICAgICAgICAgICAgY3cgPSB2aWV3V2lkdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY250OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLmdldENoaWxkQXQoaSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvbGRJbnZpc2libGVJdGVtcyAmJiAhY2hpbGQudmlzaWJsZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VyWCAhPSAwKVxuICAgICAgICAgICAgICAgICAgICAgICAgY3VyWCArPSB0aGlzLiRjb2x1bW5HYXA7XG4gICAgICAgICAgICAgICAgICAgIGlmICgodGhpcy4kY29sdW1uQ291bnQgIT0gMCAmJiBqID49IHRoaXMuJGNvbHVtbkNvdW50KSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuJGNvbHVtbkNvdW50ID09IDAgJiYgY3VyWCArIGNoaWxkLndpZHRoID4gdmlld1dpZHRoICYmIG1heEhlaWdodCAhPSAwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9uZXcgbGluZVxuICAgICAgICAgICAgICAgICAgICAgICAgY3VyWCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJZICs9IE1hdGguY2VpbChtYXhIZWlnaHQpICsgdGhpcy4kbGluZUdhcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEhlaWdodCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBqID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjaGlsZC5zZXRYWShjdXJYLCBjdXJZKTtcbiAgICAgICAgICAgICAgICAgICAgY3VyWCArPSBNYXRoLmNlaWwoY2hpbGQud2lkdGgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VyWCA+IG1heFdpZHRoKVxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4V2lkdGggPSBjdXJYO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQuaGVpZ2h0ID4gbWF4SGVpZ2h0KVxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SGVpZ2h0ID0gY2hpbGQuaGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICBqKys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNoID0gY3VyWSArIE1hdGguY2VpbChtYXhIZWlnaHQpO1xuICAgICAgICAgICAgICAgIGN3ID0gTWF0aC5jZWlsKG1heFdpZHRoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLiRsYXlvdXQgPT0gMyAvKiBGbG93VmVydGljYWwgKi8pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLiRhdXRvUmVzaXplSXRlbSAmJiB0aGlzLiRsaW5lQ291bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoaWxkID0gdGhpcy5nZXRDaGlsZEF0KGkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5mb2xkSW52aXNpYmxlSXRlbXMgJiYgIWNoaWxkLnZpc2libGUpXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgbGluZVNpemUgKz0gY2hpbGQuc291cmNlSGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICBqKys7XG4gICAgICAgICAgICAgICAgICAgIGlmIChqID09IHRoaXMuJGxpbmVDb3VudCB8fCBpID09IGNudCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhdGlvID0gKHZpZXdIZWlnaHQgLSBsaW5lU2l6ZSAtIChqIC0gMSkgKiB0aGlzLiRsaW5lR2FwKSAvIGxpbmVTaXplO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VyWSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSBsaW5lU3RhcnQ7IGogPD0gaTsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLmdldENoaWxkQXQoaik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZm9sZEludmlzaWJsZUl0ZW1zICYmICFjaGlsZC52aXNpYmxlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5zZXRYWShjdXJYLCBjdXJZKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaiA8IGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQuc2V0U2l6ZShjaGlsZC53aWR0aCwgY2hpbGQuc291cmNlSGVpZ2h0ICsgTWF0aC5yb3VuZChjaGlsZC5zb3VyY2VIZWlnaHQgKiByYXRpbyksIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJZICs9IE1hdGguY2VpbChjaGlsZC5oZWlnaHQpICsgdGhpcy4kbGluZUdhcDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5zZXRTaXplKGNoaWxkLndpZHRoLCB2aWV3SGVpZ2h0IC0gY3VyWSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLndpZHRoID4gbWF4V2lkdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heFdpZHRoID0gY2hpbGQud2lkdGg7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvL25ldyBsaW5lXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJYICs9IE1hdGguY2VpbChtYXhXaWR0aCkgKyB0aGlzLiRjb2x1bW5HYXA7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhXaWR0aCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBqID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVTdGFydCA9IGkgKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGluZVNpemUgPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGN3ID0gY3VyWCArIE1hdGguY2VpbChtYXhXaWR0aCk7XG4gICAgICAgICAgICAgICAgY2ggPSB2aWV3SGVpZ2h0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoaWxkID0gdGhpcy5nZXRDaGlsZEF0KGkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5mb2xkSW52aXNpYmxlSXRlbXMgJiYgIWNoaWxkLnZpc2libGUpXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1clkgIT0gMClcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1clkgKz0gdGhpcy4kbGluZUdhcDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCh0aGlzLiRsaW5lQ291bnQgIT0gMCAmJiBqID49IHRoaXMuJGxpbmVDb3VudCkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLiRsaW5lQ291bnQgPT0gMCAmJiBjdXJZICsgY2hpbGQuaGVpZ2h0ID4gdmlld0hlaWdodCAmJiBtYXhXaWR0aCAhPSAwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VyWSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJYICs9IE1hdGguY2VpbChtYXhXaWR0aCkgKyB0aGlzLiRjb2x1bW5HYXA7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhXaWR0aCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBqID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjaGlsZC5zZXRYWShjdXJYLCBjdXJZKTtcbiAgICAgICAgICAgICAgICAgICAgY3VyWSArPSBNYXRoLmNlaWwoY2hpbGQuaGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1clkgPiBtYXhIZWlnaHQpXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQgPSBjdXJZO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQud2lkdGggPiBtYXhXaWR0aClcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heFdpZHRoID0gY2hpbGQud2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIGorKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY3cgPSBjdXJYICsgTWF0aC5jZWlsKG1heFdpZHRoKTtcbiAgICAgICAgICAgICAgICBjaCA9IE1hdGguY2VpbChtYXhIZWlnaHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IC8vcGFnaW5hdGlvblxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGxldCBlYWNoSGVpZ2h0O1xuICAgICAgICAgICAgaWYgKHRoaXMuJGF1dG9SZXNpemVJdGVtICYmIHRoaXMuJGxpbmVDb3VudCA+IDApXG4gICAgICAgICAgICAgICAgZWFjaEhlaWdodCA9IE1hdGguZmxvb3IoKHZpZXdIZWlnaHQgLSAodGhpcy4kbGluZUNvdW50IC0gMSkgKiB0aGlzLiRsaW5lR2FwKSAvIHRoaXMuJGxpbmVDb3VudCk7XG4gICAgICAgICAgICBpZiAodGhpcy4kYXV0b1Jlc2l6ZUl0ZW0gJiYgdGhpcy4kY29sdW1uQ291bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoaWxkID0gdGhpcy5nZXRDaGlsZEF0KGkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5mb2xkSW52aXNpYmxlSXRlbXMgJiYgIWNoaWxkLnZpc2libGUpXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgbGluZVNpemUgKz0gY2hpbGQuc291cmNlV2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIGorKztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGogPT0gdGhpcy4kY29sdW1uQ291bnQgfHwgaSA9PSBjbnQgLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByYXRpbyA9ICh2aWV3V2lkdGggLSBsaW5lU2l6ZSAtIChqIC0gMSkgKiB0aGlzLiRjb2x1bW5HYXApIC8gbGluZVNpemU7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJYID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaiA9IGxpbmVTdGFydDsgaiA8PSBpOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IHRoaXMuZ2V0Q2hpbGRBdChqKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5mb2xkSW52aXNpYmxlSXRlbXMgJiYgIWNoaWxkLnZpc2libGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLnNldFhZKHBhZ2UgKiB2aWV3V2lkdGggKyBjdXJYLCBjdXJZKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaiA8IGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQuc2V0U2l6ZShjaGlsZC5zb3VyY2VXaWR0aCArIE1hdGgucm91bmQoY2hpbGQuc291cmNlV2lkdGggKiByYXRpbyksIHRoaXMuJGxpbmVDb3VudCA+IDAgPyBlYWNoSGVpZ2h0IDogY2hpbGQuaGVpZ2h0LCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyWCArPSBNYXRoLmNlaWwoY2hpbGQud2lkdGgpICsgdGhpcy4kY29sdW1uR2FwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLnNldFNpemUodmlld1dpZHRoIC0gY3VyWCwgdGhpcy4kbGluZUNvdW50ID4gMCA/IGVhY2hIZWlnaHQgOiBjaGlsZC5oZWlnaHQsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZC5oZWlnaHQgPiBtYXhIZWlnaHQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heEhlaWdodCA9IGNoaWxkLmhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vbmV3IGxpbmVcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1clkgKz0gTWF0aC5jZWlsKG1heEhlaWdodCkgKyB0aGlzLiRsaW5lR2FwO1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SGVpZ2h0ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGogPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGluZVN0YXJ0ID0gaSArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lU2l6ZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBrKys7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHRoaXMuJGxpbmVDb3VudCAhPSAwICYmIGsgPj0gdGhpcy4kbGluZUNvdW50KSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLiRsaW5lQ291bnQgPT0gMCAmJiBjdXJZICsgY2hpbGQuaGVpZ2h0ID4gdmlld0hlaWdodCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL25ldyBwYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZSsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1clkgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoaWxkID0gdGhpcy5nZXRDaGlsZEF0KGkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5mb2xkSW52aXNpYmxlSXRlbXMgJiYgIWNoaWxkLnZpc2libGUpXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1clggIT0gMClcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1clggKz0gdGhpcy4kY29sdW1uR2FwO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kYXV0b1Jlc2l6ZUl0ZW0gJiYgdGhpcy4kbGluZUNvdW50ID4gMClcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLnNldFNpemUoY2hpbGQud2lkdGgsIGVhY2hIZWlnaHQsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoKHRoaXMuJGNvbHVtbkNvdW50ICE9IDAgJiYgaiA+PSB0aGlzLiRjb2x1bW5Db3VudCkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLiRjb2x1bW5Db3VudCA9PSAwICYmIGN1clggKyBjaGlsZC53aWR0aCA+IHZpZXdXaWR0aCAmJiBtYXhIZWlnaHQgIT0gMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vbmV3IGxpbmVcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1clggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VyWSArPSBNYXRoLmNlaWwobWF4SGVpZ2h0KSArIHRoaXMuJGxpbmVHYXA7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgaiA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBrKys7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHRoaXMuJGxpbmVDb3VudCAhPSAwICYmIGsgPj0gdGhpcy4kbGluZUNvdW50KSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLiRsaW5lQ291bnQgPT0gMCAmJiBjdXJZICsgY2hpbGQuaGVpZ2h0ID4gdmlld0hlaWdodCAmJiBtYXhXaWR0aCAhPSAwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbmV3IHBhZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlKys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyWSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2hpbGQuc2V0WFkocGFnZSAqIHZpZXdXaWR0aCArIGN1clgsIGN1clkpO1xuICAgICAgICAgICAgICAgICAgICBjdXJYICs9IE1hdGguY2VpbChjaGlsZC53aWR0aCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJYID4gbWF4V2lkdGgpXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhXaWR0aCA9IGN1clg7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZC5oZWlnaHQgPiBtYXhIZWlnaHQpXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQgPSBjaGlsZC5oZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIGorKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjaCA9IHBhZ2UgPiAwID8gdmlld0hlaWdodCA6IGN1clkgKyBNYXRoLmNlaWwobWF4SGVpZ2h0KTtcbiAgICAgICAgICAgIGN3ID0gKHBhZ2UgKyAxKSAqIHZpZXdXaWR0aDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmhhbmRsZUFsaWduKGN3LCBjaCk7XG4gICAgICAgIHRoaXMuc2V0Qm91bmRzKDAsIDAsIGN3LCBjaCk7XG4gICAgfVxuICAgIHNldHVwQmVmb3JlQWRkKHhtbCkge1xuICAgICAgICBzdXBlci5zZXR1cEJlZm9yZUFkZCh4bWwpO1xuICAgICAgICBsZXQgc3RyO1xuICAgICAgICBsZXQgYXJyO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5sYXlvdXQ7XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICB0aGlzLiRsYXlvdXQgPSBQYXJzZUxpc3RMYXlvdXRUeXBlKHN0cik7XG4gICAgICAgIGxldCBvdmVyZmxvdztcbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMub3ZlcmZsb3c7XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICBvdmVyZmxvdyA9IFBhcnNlT3ZlcmZsb3dUeXBlKHN0cik7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIG92ZXJmbG93ID0gMCAvKiBWaXNpYmxlICovO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5tYXJnaW47XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICB0aGlzLiRtYXJnaW4ucGFyc2Uoc3RyKTtcbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMuYWxpZ247XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICB0aGlzLiRhbGlnbiA9IFBhcnNlQWxpZ25UeXBlKHN0cik7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnZBbGlnbjtcbiAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgIHRoaXMuJHZlcnRpY2FsQWxpZ24gPSBQYXJzZVZlcnRBbGlnblR5cGUoc3RyKTtcbiAgICAgICAgaWYgKG92ZXJmbG93ID09IDIgLyogU2Nyb2xsICovKSB7XG4gICAgICAgICAgICBsZXQgc2Nyb2xsO1xuICAgICAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMuc2Nyb2xsO1xuICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICBzY3JvbGwgPSBQYXJzZVNjcm9sbFR5cGUoc3RyKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBzY3JvbGwgPSAxIC8qIFZlcnRpY2FsICovO1xuICAgICAgICAgICAgbGV0IHNjcm9sbEJhckRpc3BsYXk7XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5zY3JvbGxCYXI7XG4gICAgICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgICAgIHNjcm9sbEJhckRpc3BsYXkgPSBQYXJzZVNjcm9sbEJhckRpc3BsYXlUeXBlKHN0cik7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgc2Nyb2xsQmFyRGlzcGxheSA9IDAgLyogRGVmYXVsdCAqLztcbiAgICAgICAgICAgIGxldCBzY3JvbGxCYXJGbGFncztcbiAgICAgICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnNjcm9sbEJhckZsYWdzO1xuICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICBzY3JvbGxCYXJGbGFncyA9IHBhcnNlSW50KHN0cik7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgc2Nyb2xsQmFyRmxhZ3MgPSAwO1xuICAgICAgICAgICAgbGV0IHNjcm9sbEJhck1hcmdpbiA9IG5ldyBNYXJnaW4oKTtcbiAgICAgICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnNjcm9sbEJhck1hcmdpbjtcbiAgICAgICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICAgICAgc2Nyb2xsQmFyTWFyZ2luLnBhcnNlKHN0cik7XG4gICAgICAgICAgICBsZXQgdnRTY3JvbGxCYXJSZXM7XG4gICAgICAgICAgICBsZXQgaHpTY3JvbGxCYXJSZXM7XG4gICAgICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5zY3JvbGxCYXJSZXM7XG4gICAgICAgICAgICBpZiAoc3RyKSB7XG4gICAgICAgICAgICAgICAgYXJyID0gc3RyLnNwbGl0KCcsJyk7XG4gICAgICAgICAgICAgICAgdnRTY3JvbGxCYXJSZXMgPSBhcnJbMF07XG4gICAgICAgICAgICAgICAgaHpTY3JvbGxCYXJSZXMgPSBhcnJbMV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgaGVhZGVyUmVzO1xuICAgICAgICAgICAgbGV0IGZvb3RlclJlcztcbiAgICAgICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnB0clJlcztcbiAgICAgICAgICAgIGlmIChzdHIpIHtcbiAgICAgICAgICAgICAgICBhcnIgPSBzdHIuc3BsaXQoJywnKTtcbiAgICAgICAgICAgICAgICBoZWFkZXJSZXMgPSBhcnJbMF07XG4gICAgICAgICAgICAgICAgZm9vdGVyUmVzID0gYXJyWzFdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zZXR1cFNjcm9sbChzY3JvbGxCYXJNYXJnaW4sIHNjcm9sbCwgc2Nyb2xsQmFyRGlzcGxheSwgc2Nyb2xsQmFyRmxhZ3MsIHZ0U2Nyb2xsQmFyUmVzLCBoelNjcm9sbEJhclJlcywgaGVhZGVyUmVzLCBmb290ZXJSZXMpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRoaXMuc2V0dXBPdmVyZmxvdyhvdmVyZmxvdyk7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmxpbmVHYXA7XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICB0aGlzLiRsaW5lR2FwID0gcGFyc2VJbnQoc3RyKTtcbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMuY29sR2FwO1xuICAgICAgICBpZiAoc3RyKVxuICAgICAgICAgICAgdGhpcy4kY29sdW1uR2FwID0gcGFyc2VJbnQoc3RyKTtcbiAgICAgICAgc3RyID0geG1sLmF0dHJpYnV0ZXMubGluZUl0ZW1Db3VudDtcbiAgICAgICAgaWYgKHN0cikge1xuICAgICAgICAgICAgaWYgKHRoaXMuJGxheW91dCA9PSAyIC8qIEZsb3dIb3Jpem9udGFsICovIHx8XG4gICAgICAgICAgICAgICAgdGhpcy4kbGF5b3V0ID09IDQgLyogUGFnaW5hdGlvbiAqLylcbiAgICAgICAgICAgICAgICB0aGlzLiRjb2x1bW5Db3VudCA9IHBhcnNlSW50KHN0cik7XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLiRsYXlvdXQgPT0gMyAvKiBGbG93VmVydGljYWwgKi8pXG4gICAgICAgICAgICAgICAgdGhpcy4kbGluZUNvdW50ID0gcGFyc2VJbnQoc3RyKTtcbiAgICAgICAgfVxuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5saW5lSXRlbUNvdW50MjtcbiAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgIHRoaXMuJGxpbmVDb3VudCA9IHBhcnNlSW50KHN0cik7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnNlbGVjdGlvbk1vZGU7XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICB0aGlzLiRzZWxlY3Rpb25Nb2RlID0gUGFyc2VMaXN0U2VsZWN0aW9uTW9kZShzdHIpO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5kZWZhdWx0SXRlbTtcbiAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgIHRoaXMuJGRlZmF1bHRJdGVtID0gc3RyO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5hdXRvSXRlbVNpemU7XG4gICAgICAgIGlmICh0aGlzLiRsYXlvdXQgPT0gMSAvKiBTaW5nbGVSb3cgKi8gfHwgdGhpcy4kbGF5b3V0ID09IDAgLyogU2luZ2xlQ29sdW1uICovKVxuICAgICAgICAgICAgdGhpcy4kYXV0b1Jlc2l6ZUl0ZW0gPSBzdHIgIT0gJ2ZhbHNlJztcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy4kYXV0b1Jlc2l6ZUl0ZW0gPSBzdHIgPT0gJ3RydWUnO1xuICAgICAgICBzdHIgPSB4bWwuYXR0cmlidXRlcy5yZW5kZXJPcmRlcjtcbiAgICAgICAgaWYgKHN0cikge1xuICAgICAgICAgICAgdGhpcy4kY2hpbGRyZW5SZW5kZXJPcmRlciA9IFBhcnNlTGlzdENoaWxkcmVuUmVuZGVyT3JkZXIoc3RyKTtcbiAgICAgICAgICAgIGlmICh0aGlzLiRjaGlsZHJlblJlbmRlck9yZGVyID09IDIgLyogQXJjaCAqLykge1xuICAgICAgICAgICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLmFwZXg7XG4gICAgICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kYXBleEluZGV4ID0gcGFyc2VJbnQoc3RyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBsZXQgY29sID0geG1sLmNoaWxkcmVuO1xuICAgICAgICBjb2wuZm9yRWFjaChjeG1sID0+IHtcbiAgICAgICAgICAgIGlmIChjeG1sLm5vZGVOYW1lICE9ICdpdGVtJylcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBsZXQgdXJsID0gY3htbC5hdHRyaWJ1dGVzLnVybDtcbiAgICAgICAgICAgIGlmICghdXJsKVxuICAgICAgICAgICAgICAgIHVybCA9IHRoaXMuJGRlZmF1bHRJdGVtO1xuICAgICAgICAgICAgaWYgKCF1cmwpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgbGV0IG9iaiA9IHRoaXMuZ2V0RnJvbVBvb2wodXJsKTtcbiAgICAgICAgICAgIGlmIChvYmogIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkQ2hpbGQob2JqKTtcbiAgICAgICAgICAgICAgICBzdHIgPSBjeG1sLmF0dHJpYnV0ZXMudGl0bGU7XG4gICAgICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICAgICAgb2JqLnRleHQgPSBzdHI7XG4gICAgICAgICAgICAgICAgc3RyID0gY3htbC5hdHRyaWJ1dGVzLmljb247XG4gICAgICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICAgICAgb2JqLmljb24gPSBzdHI7XG4gICAgICAgICAgICAgICAgc3RyID0gY3htbC5hdHRyaWJ1dGVzLm5hbWU7XG4gICAgICAgICAgICAgICAgaWYgKHN0cilcbiAgICAgICAgICAgICAgICAgICAgb2JqLm5hbWUgPSBzdHI7XG4gICAgICAgICAgICAgICAgc3RyID0gY3htbC5hdHRyaWJ1dGVzLnNlbGVjdGVkSWNvbjtcbiAgICAgICAgICAgICAgICBpZiAoc3RyICYmIG9iaiBpbnN0YW5jZW9mIEdCdXR0b24pXG4gICAgICAgICAgICAgICAgICAgIG9iai5zZWxlY3RlZEljb24gPSBzdHI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpO1xuICAgIH1cbiAgICBzZXR1cEFmdGVyQWRkKHhtbCkge1xuICAgICAgICBzdXBlci5zZXR1cEFmdGVyQWRkKHhtbCk7XG4gICAgICAgIGxldCBzdHI7XG4gICAgICAgIHN0ciA9IHhtbC5hdHRyaWJ1dGVzLnNlbGVjdGlvbkNvbnRyb2xsZXI7XG4gICAgICAgIGlmIChzdHIpXG4gICAgICAgICAgICB0aGlzLiRzZWxlY3Rpb25Db250cm9sbGVyID0gdGhpcy5wYXJlbnQuZ2V0Q29udHJvbGxlcihzdHIpO1xuICAgIH1cbn1cbkdMaXN0LiRsYXN0UG9zSGVscGVyID0gMDtcblxuY2xhc3MgUG9wdXBNZW51IHtcbiAgICBjb25zdHJ1Y3RvcihyZXNvdXJjZVVSTCA9IG51bGwpIHtcbiAgICAgICAgaWYgKCFyZXNvdXJjZVVSTCkge1xuICAgICAgICAgICAgcmVzb3VyY2VVUkwgPSBVSUNvbmZpZy5wb3B1cE1lbnU7XG4gICAgICAgICAgICBpZiAoIXJlc291cmNlVVJMKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVUlDb25maWcucG9wdXBNZW51IG5vdCBkZWZpbmVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kY29udGVudFBhbmUgPSBVSVBhY2thZ2UuY3JlYXRlT2JqZWN0RnJvbVVSTChyZXNvdXJjZVVSTCk7XG4gICAgICAgIHRoaXMuJGNvbnRlbnRQYW5lLm9uKCdhZGRlZCcsIHRoaXMuJGFkZGVkVG9TdGFnZSwgdGhpcyk7XG4gICAgICAgIHRoaXMuJGxpc3QgPSB0aGlzLiRjb250ZW50UGFuZS5nZXRDaGlsZCgnbGlzdCcpO1xuICAgICAgICB0aGlzLiRsaXN0LnJlbW92ZUNoaWxkcmVuVG9Qb29sKCk7XG4gICAgICAgIHRoaXMuJGxpc3QuYWRkUmVsYXRpb24odGhpcy4kY29udGVudFBhbmUsIDE0IC8qIFdpZHRoICovKTtcbiAgICAgICAgdGhpcy4kbGlzdC5yZW1vdmVSZWxhdGlvbih0aGlzLiRjb250ZW50UGFuZSwgMTUgLyogSGVpZ2h0ICovKTtcbiAgICAgICAgdGhpcy4kY29udGVudFBhbmUuYWRkUmVsYXRpb24odGhpcy4kbGlzdCwgMTUgLyogSGVpZ2h0ICovKTtcbiAgICAgICAgdGhpcy4kbGlzdC5vbihcIl9faXRlbUNsaWNrXCIgLyogSXRlbUNsaWNrICovLCB0aGlzLiRjbGlja0l0ZW0sIHRoaXMpO1xuICAgIH1cbiAgICBkaXNwb3NlKCkge1xuICAgICAgICBHVGltZXIuaW5zdC5yZW1vdmUodGhpcy4kZGVsYXlDbGlja0l0ZW0sIHRoaXMpO1xuICAgICAgICB0aGlzLiRsaXN0Lm9mZihcIl9faXRlbUNsaWNrXCIgLyogSXRlbUNsaWNrICovLCB0aGlzLiRjbGlja0l0ZW0pO1xuICAgICAgICB0aGlzLiRjb250ZW50UGFuZS5vZmYoJ2FkZGVkJywgdGhpcy4kYWRkZWRUb1N0YWdlKTtcbiAgICAgICAgdGhpcy4kY29udGVudFBhbmUuZGlzcG9zZSgpO1xuICAgIH1cbiAgICBhZGRJdGVtKGNhcHRpb24sIGhhbmRsZXIpIHtcbiAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLiRsaXN0LmFkZEl0ZW1Gcm9tUG9vbCgpO1xuICAgICAgICBpdGVtLnRpdGxlID0gY2FwdGlvbjtcbiAgICAgICAgaXRlbS5kYXRhID0gaGFuZGxlcjtcbiAgICAgICAgaXRlbS5ncmF5ZWQgPSBmYWxzZTtcbiAgICAgICAgbGV0IGMgPSBpdGVtLmdldENvbnRyb2xsZXIoJ2NoZWNrZWQnKTtcbiAgICAgICAgaWYgKGMgIT0gbnVsbClcbiAgICAgICAgICAgIGMuc2VsZWN0ZWRJbmRleCA9IDA7XG4gICAgICAgIHJldHVybiBpdGVtO1xuICAgIH1cbiAgICBhZGRJdGVtQXQoY2FwdGlvbiwgaW5kZXgsIGhhbmRsZXIpIHtcbiAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLiRsaXN0LmdldEZyb21Qb29sKCk7XG4gICAgICAgIHRoaXMuJGxpc3QuYWRkQ2hpbGRBdChpdGVtLCBpbmRleCk7XG4gICAgICAgIGl0ZW0udGl0bGUgPSBjYXB0aW9uO1xuICAgICAgICBpdGVtLmRhdGEgPSBoYW5kbGVyO1xuICAgICAgICBpdGVtLmdyYXllZCA9IGZhbHNlO1xuICAgICAgICBsZXQgYyA9IGl0ZW0uZ2V0Q29udHJvbGxlcignY2hlY2tlZCcpO1xuICAgICAgICBpZiAoYyAhPSBudWxsKVxuICAgICAgICAgICAgYy5zZWxlY3RlZEluZGV4ID0gMDtcbiAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgfVxuICAgIGFkZFNlcGVyYXRvcigpIHtcbiAgICAgICAgaWYgKFVJQ29uZmlnLnBvcHVwTWVudVNlcGVyYXRvciA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVSUNvbmZpZy5wb3B1cE1lbnVTZXBlcmF0b3Igbm90IGRlZmluZWQnKTtcbiAgICAgICAgdGhpcy4kbGlzdC5hZGRJdGVtRnJvbVBvb2woVUlDb25maWcucG9wdXBNZW51U2VwZXJhdG9yKTtcbiAgICB9XG4gICAgZ2V0SXRlbU5hbWUoaW5kZXgpIHtcbiAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLiRsaXN0LmdldENoaWxkQXQoaW5kZXgpO1xuICAgICAgICByZXR1cm4gaXRlbS5uYW1lO1xuICAgIH1cbiAgICBzZXRJdGVtVGV4dChuYW1lLCBjYXB0aW9uKSB7XG4gICAgICAgIGxldCBpdGVtID0gdGhpcy4kbGlzdC5nZXRDaGlsZChuYW1lKTtcbiAgICAgICAgaXRlbS50aXRsZSA9IGNhcHRpb247XG4gICAgfVxuICAgIHNldEl0ZW1WaXNpYmxlKG5hbWUsIHZpc2libGUpIHtcbiAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLiRsaXN0LmdldENoaWxkKG5hbWUpO1xuICAgICAgICBpZiAoaXRlbS52aXNpYmxlICE9IHZpc2libGUpIHtcbiAgICAgICAgICAgIGl0ZW0udmlzaWJsZSA9IHZpc2libGU7XG4gICAgICAgICAgICB0aGlzLiRsaXN0LnNldEJvdW5kc0NoYW5nZWRGbGFnKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0SXRlbUdyYXllZChuYW1lLCBncmF5ZWQpIHtcbiAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLiRsaXN0LmdldENoaWxkKG5hbWUpO1xuICAgICAgICBpdGVtLmdyYXllZCA9IGdyYXllZDtcbiAgICB9XG4gICAgc2V0SXRlbUNoZWNrYWJsZShuYW1lLCBjaGVja2FibGUpIHtcbiAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLiRsaXN0LmdldENoaWxkKG5hbWUpO1xuICAgICAgICBsZXQgYyA9IGl0ZW0uZ2V0Q29udHJvbGxlcignY2hlY2tlZCcpO1xuICAgICAgICBpZiAoYyAhPSBudWxsKSB7XG4gICAgICAgICAgICBpZiAoY2hlY2thYmxlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGMuc2VsZWN0ZWRJbmRleCA9PSAwKVxuICAgICAgICAgICAgICAgICAgICBjLnNlbGVjdGVkSW5kZXggPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGMuc2VsZWN0ZWRJbmRleCA9IDA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0SXRlbUNoZWNrZWQobmFtZSwgY2hlY2tlZCkge1xuICAgICAgICBsZXQgaXRlbSA9IHRoaXMuJGxpc3QuZ2V0Q2hpbGQobmFtZSk7XG4gICAgICAgIGxldCBjID0gaXRlbS5nZXRDb250cm9sbGVyKCdjaGVja2VkJyk7XG4gICAgICAgIGlmIChjICE9IG51bGwpXG4gICAgICAgICAgICBjLnNlbGVjdGVkSW5kZXggPSBjaGVja2VkID8gMiA6IDE7XG4gICAgfVxuICAgIGlzSXRlbUNoZWNrZWQobmFtZSkge1xuICAgICAgICBsZXQgaXRlbSA9IHRoaXMuJGxpc3QuZ2V0Q2hpbGQobmFtZSk7XG4gICAgICAgIGxldCBjID0gaXRlbS5nZXRDb250cm9sbGVyKCdjaGVja2VkJyk7XG4gICAgICAgIGlmIChjICE9IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gYy5zZWxlY3RlZEluZGV4ID09IDI7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmVtb3ZlSXRlbShuYW1lKSB7XG4gICAgICAgIGxldCBpdGVtID0gdGhpcy4kbGlzdC5nZXRDaGlsZChuYW1lKTtcbiAgICAgICAgaWYgKGl0ZW0gIT0gbnVsbCkge1xuICAgICAgICAgICAgbGV0IGluZGV4ID0gdGhpcy4kbGlzdC5nZXRDaGlsZEluZGV4KGl0ZW0pO1xuICAgICAgICAgICAgdGhpcy4kbGlzdC5yZW1vdmVDaGlsZFRvUG9vbEF0KGluZGV4KTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY2xlYXJJdGVtcygpIHtcbiAgICAgICAgdGhpcy4kbGlzdC5yZW1vdmVDaGlsZHJlblRvUG9vbCgpO1xuICAgIH1cbiAgICBnZXQgaXRlbUNvdW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kbGlzdC5udW1DaGlsZHJlbjtcbiAgICB9XG4gICAgZ2V0IGNvbnRlbnRQYW5lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kY29udGVudFBhbmU7XG4gICAgfVxuICAgIGdldCBsaXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kbGlzdDtcbiAgICB9XG4gICAgc2hvdyh0YXJnZXQgPSBudWxsLCBkaXIpIHtcbiAgICAgICAgbGV0IHIgPSB0YXJnZXQgIT0gbnVsbCA/IEdSb290LmZpbmRGb3IodGFyZ2V0KSA6IEdSb290Lmluc3Q7XG4gICAgICAgIHIuc2hvd1BvcHVwKHRoaXMuY29udGVudFBhbmUsIHRhcmdldCBpbnN0YW5jZW9mIEdSb290ID8gbnVsbCA6IHRhcmdldCwgZGlyKTtcbiAgICB9XG4gICAgJGNsaWNrSXRlbShldnQpIHtcbiAgICAgICAgbGV0IGl0ZW0gPSBldnQuZGF0YS5pdGVtO1xuICAgICAgICBHVGltZXIuaW5zdC5hZGQoMTAwLCAxLCB0aGlzLiRkZWxheUNsaWNrSXRlbSwgdGhpcywgaXRlbSk7XG4gICAgfVxuICAgICRkZWxheUNsaWNrSXRlbShpdGVtT2JqZWN0KSB7XG4gICAgICAgIGlmICghKGl0ZW1PYmplY3QgaW5zdGFuY2VvZiBHQnV0dG9uKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKGl0ZW1PYmplY3QuZ3JheWVkKSB7XG4gICAgICAgICAgICB0aGlzLiRsaXN0LnNlbGVjdGVkSW5kZXggPSAtMTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgYyA9IGl0ZW1PYmplY3QuZ2V0Q29udHJvbGxlcignY2hlY2tlZCcpO1xuICAgICAgICBpZiAoYyAhPSBudWxsICYmIGMuc2VsZWN0ZWRJbmRleCAhPSAwKSB7XG4gICAgICAgICAgICBpZiAoYy5zZWxlY3RlZEluZGV4ID09IDEpXG4gICAgICAgICAgICAgICAgYy5zZWxlY3RlZEluZGV4ID0gMjtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBjLnNlbGVjdGVkSW5kZXggPSAxO1xuICAgICAgICB9XG4gICAgICAgIGxldCByID0gdGhpcy4kY29udGVudFBhbmUucGFyZW50O1xuICAgICAgICBpZiAocilcbiAgICAgICAgICAgIHIuaGlkZVBvcHVwKHRoaXMuY29udGVudFBhbmUpO1xuICAgICAgICBpZiAoaXRlbU9iamVjdC5kYXRhICE9IG51bGwpXG4gICAgICAgICAgICBpdGVtT2JqZWN0LmRhdGEuY2FsbChudWxsKTtcbiAgICAgICAgR1RpbWVyLmluc3QucmVtb3ZlKHRoaXMuJGRlbGF5Q2xpY2tJdGVtLCB0aGlzKTtcbiAgICB9XG4gICAgJGFkZGVkVG9TdGFnZSgpIHtcbiAgICAgICAgdGhpcy4kbGlzdC5zZWxlY3RlZEluZGV4ID0gLTE7XG4gICAgICAgIHRoaXMuJGxpc3QucmVzaXplVG9GaXQoMTAwMDAwLCAxMCk7XG4gICAgfVxufVxuXG5jbGFzcyBVSU9iamVjdEZhY3Rvcnkge1xuICAgIHN0YXRpYyBzZXRQYWNrYWdlSXRlbUV4dGVuc2lvbih1cmwsIHR5cGUpIHtcbiAgICAgICAgVUlPYmplY3RGYWN0b3J5LnBhY2thZ2VJdGVtRXh0ZW5zaW9uc1t1cmwuc3Vic3RyaW5nKDUpXSA9IHR5cGU7XG4gICAgfVxuICAgIC8vIHB1YmxpYyBzdGF0aWMgc2V0TG9hZGVyRXh0ZW5zaW9uKHR5cGU6IHsgbmV3KCk6IEdMb2FkZXIgfSk6IHZvaWQge1xuICAgIC8vICAgICBVSU9iamVjdEZhY3RvcnkubG9hZGVyRXh0ZW5zaW9uID0gdHlwZTtcbiAgICAvLyB9XG4gICAgc3RhdGljIG5ld09iamVjdChwaSkge1xuICAgICAgICBzd2l0Y2ggKHBpLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgMCAvKiBJbWFnZSAqLzpcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEdJbWFnZSgpO1xuICAgICAgICAgICAgY2FzZSAyIC8qIE1vdmllQ2xpcCAqLzpcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEdNb3ZpZUNsaXAoKTtcbiAgICAgICAgICAgIGNhc2UgNCAvKiBDb21wb25lbnQgKi86XG4gICAgICAgICAgICAgICAgbGV0IGNscyA9IFVJT2JqZWN0RmFjdG9yeS5wYWNrYWdlSXRlbUV4dGVuc2lvbnNbcGkub3duZXIuaWQgKyBwaS5pZF07XG4gICAgICAgICAgICAgICAgaWYgKGNscylcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBjbHMoKTtcbiAgICAgICAgICAgICAgICBsZXQgeG1sID0gcGkub3duZXIuZ2V0SXRlbUFzc2V0KHBpKTtcbiAgICAgICAgICAgICAgICBsZXQgZXh0ZW50aW9uID0geG1sLmF0dHJpYnV0ZXMuZXh0ZW50aW9uO1xuICAgICAgICAgICAgICAgIGlmIChleHRlbnRpb24gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGV4dGVudGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnQnV0dG9uJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEdCdXR0b24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ1Byb2dyZXNzQmFyJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEdQcm9ncmVzc0JhcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnTGFiZWwnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgR0xhYmVsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdTbGlkZXInOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgR1NsaWRlcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnU2Nyb2xsQmFyJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEdTY3JvbGxCYXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ0NvbWJvQm94JzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEdDb21ib0JveCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEdDb21wb25lbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgR0NvbXBvbmVudCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBzdGF0aWMgbmV3T2JqZWN0RGlyZWN0bHkodHlwZSkge1xuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2ltYWdlJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEdJbWFnZSgpO1xuICAgICAgICAgICAgY2FzZSAnbW92aWVjbGlwJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEdNb3ZpZUNsaXAoKTtcbiAgICAgICAgICAgIGNhc2UgJ2NvbXBvbmVudCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBHQ29tcG9uZW50KCk7XG4gICAgICAgICAgICBjYXNlICd0ZXh0JzpcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEdUZXh0RmllbGQoKTtcbiAgICAgICAgICAgIGNhc2UgJ2xpc3QnOlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgR0xpc3QoKTtcbiAgICAgICAgICAgIGNhc2UgJ3JpY2h0ZXh0JzpcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEdSaWNoVGV4dEZpZWxkKCk7XG4gICAgICAgICAgICBjYXNlICdpbnB1dHRleHQnOlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgR1RleHRJbnB1dCgpO1xuICAgICAgICAgICAgY2FzZSAnZ3JvdXAnOlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgR0dyb3VwKCk7XG4gICAgICAgICAgICBjYXNlICdncmFwaCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBHR3JhcGgoKTtcbiAgICAgICAgICAgIGNhc2UgJ2xvYWRlcic6XG4gICAgICAgICAgICAgICAgaWYgKFVJT2JqZWN0RmFjdG9yeS5sb2FkZXJFeHRlbnNpb24gIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVSU9iamVjdEZhY3RvcnkubG9hZGVyRXh0ZW5zaW9uKCk7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEdMb2FkZXIoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG5VSU9iamVjdEZhY3RvcnkucGFja2FnZUl0ZW1FeHRlbnNpb25zID0ge307XG5EZWNscy5VSU9iamVjdEZhY3RvcnkgPSBVSU9iamVjdEZhY3Rvcnk7XG5cbmNsYXNzIERyYWdJbmRpY2F0b3Ige1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLiRhZ2VudCA9IG5ldyBHTG9hZGVyKCk7XG4gICAgICAgIHRoaXMuJGFnZW50LmRyYWdnYWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMuJGFnZW50LnRvdWNoYWJsZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLiRhZ2VudC5zZXRTaXplKDEwMCwgMTAwKTtcbiAgICAgICAgdGhpcy4kYWdlbnQuc2V0UGl2b3QoMC41LCAwLjUsIHRydWUpO1xuICAgICAgICB0aGlzLiRhZ2VudC5hbGlnbiA9IFwiY2VudGVyXCIgLyogQ2VudGVyICovO1xuICAgICAgICB0aGlzLiRhZ2VudC52ZXJ0aWNhbEFsaWduID0gMSAvKiBNaWRkbGUgKi87XG4gICAgICAgIHRoaXMuJGFnZW50LnNvcnRpbmdPcmRlciA9IDEwMDAwMDA7IC8vdG9wIG1vc3RcbiAgICAgICAgdGhpcy4kYWdlbnQub24oXCJfX2RyYWdFbmRcIiAvKiBFTkQgKi8sIHRoaXMuJGRyYWdFbmQsIHRoaXMpO1xuICAgIH1cbiAgICBnZXQgZHJhZ0FnZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kYWdlbnQ7XG4gICAgfVxuICAgIGdldCBpc0RyYWdnaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kYWdlbnQucGFyZW50ICE9IG51bGw7XG4gICAgfVxuICAgIGdldCBzb3VyY2VPYmplY3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRzb3VyY2VPYmplY3Q7XG4gICAgfVxuICAgIHN0YXJ0RHJhZyhzb3VyY2UsIGljb24sIHNvdXJjZURhdGEsIHRvdWNoUG9pbnRJRCA9IC0xKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRHJhZ2dpbmcpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuJHNvdXJjZU9iamVjdCA9IHNvdXJjZTtcbiAgICAgICAgdGhpcy4kc291cmNlRGF0YSA9IHNvdXJjZURhdGE7XG4gICAgICAgIHRoaXMuJGFnZW50LnVybCA9IGljb247XG4gICAgICAgIEdSb290Lmluc3QuYWRkQ2hpbGQodGhpcy4kYWdlbnQpO1xuICAgICAgICBjb25zdCBwdCA9IEdSb290Lmluc3QuZ2xvYmFsVG9Mb2NhbChHUm9vdC5nbG9iYWxNb3VzZVN0YXR1cy5tb3VzZVgsIEdSb290Lmdsb2JhbE1vdXNlU3RhdHVzLm1vdXNlWSk7XG4gICAgICAgIHRoaXMuJGFnZW50LnNldFhZKHB0LngsIHB0LnkpO1xuICAgICAgICB0aGlzLiRhZ2VudC5zdGFydERyYWcodG91Y2hQb2ludElEKTtcbiAgICB9XG4gICAgY2FuY2VsKCkge1xuICAgICAgICBpZiAodGhpcy4kYWdlbnQucGFyZW50ICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuJGFnZW50LnN0b3BEcmFnKCk7XG4gICAgICAgICAgICBHUm9vdC5pbnN0LnJlbW92ZUNoaWxkKHRoaXMuJGFnZW50KTtcbiAgICAgICAgICAgIHRoaXMuJHNvdXJjZURhdGEgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgICRkcmFnRW5kKGV2dCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNEcmFnZ2luZylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgR1Jvb3QuaW5zdC5yZW1vdmVDaGlsZCh0aGlzLiRhZ2VudCk7XG4gICAgICAgIGxldCBzb3VyY2VEYXRhID0gdGhpcy4kc291cmNlRGF0YTtcbiAgICAgICAgdGhpcy4kc291cmNlRGF0YSA9IG51bGw7XG4gICAgICAgIGxldCBvYmogPSBHUm9vdC5pbnN0LmdldE9iamVjdFVuZGVyUG9pbnQoZXZ0LnRhcmdldC54LCBldnQudGFyZ2V0LnkpO1xuICAgICAgICB3aGlsZSAob2JqICE9IG51bGwpIHtcbiAgICAgICAgICAgIGlmIChvYmouaGFzTGlzdGVuZXIoXCJfX2RyYWdEcm9wXCIgLyogRFJPUCAqLykpIHtcbiAgICAgICAgICAgICAgICBvYmoucmVxdWVzdEZvY3VzKCk7XG4gICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRUYXJnZXQgPSBvYmouZGlzcGxheU9iamVjdDtcbiAgICAgICAgICAgICAgICBsZXQgZXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoXCJfX2RyYWdEcm9wXCIgLyogRFJPUCAqLywgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIGV2ZW50LmRhdGEgPSB7IGN1cnJlbnRUYXJnZXQsIHNvdXJjZURhdGEgfTtcbiAgICAgICAgICAgICAgICBvYmouZGlzcGF0Y2hFdmVudChldmVudCwgdGhpcyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb2JqID0gb2JqLnBhcmVudDtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IHsgQXNzZXRMb2FkZXIsIEJpbmRlciwgQmxlbmRNb2RlTWFwLCBDb250cm9sbGVyLCBEZWZhdWx0VUlTdGFnZU9wdGlvbnMsIERyYWdJbmRpY2F0b3IsIEdCdXR0b24sIEdDb21ib0JveCwgR0NvbXBvbmVudCwgR0dyYXBoLCBHR3JvdXAsIEdJbWFnZSwgR0xhYmVsLCBHTGlzdCwgR0xvYWRlciwgR01vdmllQ2xpcCwgR09iamVjdCwgR1Byb2dyZXNzQmFyLCBHUmljaFRleHRGaWVsZCwgR1Jvb3QsIEdTY3JvbGxCYXIsIEdTbGlkZXIsIEdUZXh0RmllbGQsIEdUZXh0SW5wdXQsIEdUaW1lciwgR2VhclhNTE5vZGVOYW1lTWFwLCBJbnRlcmFjdGl2ZUV2ZW50cywgUGFja2FnZUl0ZW0sIFBhcnNlQWxpZ25UeXBlLCBQYXJzZUF1dG9TaXplVHlwZSwgUGFyc2VCdXR0b25Nb2RlLCBQYXJzZUVhc2VUeXBlLCBQYXJzZUZsaXBUeXBlLCBQYXJzZUxpc3RDaGlsZHJlblJlbmRlck9yZGVyLCBQYXJzZUxpc3RMYXlvdXRUeXBlLCBQYXJzZUxpc3RTZWxlY3Rpb25Nb2RlLCBQYXJzZUxvYWRlckZpbGxUeXBlLCBQYXJzZU92ZXJmbG93VHlwZSwgUGFyc2VQYWNrYWdlSXRlbVR5cGUsIFBhcnNlUHJvZ3Jlc3NUaXRsZVR5cGUsIFBhcnNlU2Nyb2xsQmFyRGlzcGxheVR5cGUsIFBhcnNlU2Nyb2xsVHlwZSwgUGFyc2VWZXJ0QWxpZ25UeXBlLCBQb3B1cE1lbnUsIFNjcm9sbFBhbmUsIFN0cmluZ1V0aWwsIFRyYW5zaXRpb24sIFVJQ29uZmlnLCBVSU9iamVjdEZhY3RvcnksIFVJUGFja2FnZSwgVUlTdGFnZSwgV2luZG93IH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/fairygui-createjs/dist/fairygui.module.js\n")},"./node_modules/ismobilejs/esm/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "default": () => (/* reexport safe */ _isMobile__WEBPACK_IMPORTED_MODULE_0__["default"])\n/* harmony export */ });\n/* harmony import */ var _isMobile__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./isMobile */ "./node_modules/ismobilejs/esm/isMobile.js");\n\n\n//# sourceMappingURL=index.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvaXNtb2JpbGVqcy9lc20vaW5kZXguanMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYWluLy4vbm9kZV9tb2R1bGVzL2lzbW9iaWxlanMvZXNtL2luZGV4LmpzPzAzNDciXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0ICogZnJvbSAnLi9pc01vYmlsZSc7XG5leHBvcnQgeyBkZWZhdWx0IH0gZnJvbSAnLi9pc01vYmlsZSc7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/ismobilejs/esm/index.js\n')},"./node_modules/ismobilejs/esm/isMobile.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ isMobile)\n/* harmony export */ });\nvar appleIphone = /iPhone/i;\nvar appleIpod = /iPod/i;\nvar appleTablet = /iPad/i;\nvar appleUniversal = /\\biOS-universal(?:.+)Mac\\b/i;\nvar androidPhone = /\\bAndroid(?:.+)Mobile\\b/i;\nvar androidTablet = /Android/i;\nvar amazonPhone = /(?:SD4930UR|\\bSilk(?:.+)Mobile\\b)/i;\nvar amazonTablet = /Silk/i;\nvar windowsPhone = /Windows Phone/i;\nvar windowsTablet = /\\bWindows(?:.+)ARM\\b/i;\nvar otherBlackBerry = /BlackBerry/i;\nvar otherBlackBerry10 = /BB10/i;\nvar otherOpera = /Opera Mini/i;\nvar otherChrome = /\\b(CriOS|Chrome)(?:.+)Mobile/i;\nvar otherFirefox = /Mobile(?:.+)Firefox\\b/i;\nvar isAppleTabletOnIos13 = function (navigator) {\n    return (typeof navigator !== 'undefined' &&\n        navigator.platform === 'MacIntel' &&\n        typeof navigator.maxTouchPoints === 'number' &&\n        navigator.maxTouchPoints > 1 &&\n        typeof MSStream === 'undefined');\n};\nfunction createMatch(userAgent) {\n    return function (regex) { return regex.test(userAgent); };\n}\nfunction isMobile(param) {\n    var nav = {\n        userAgent: '',\n        platform: '',\n        maxTouchPoints: 0\n    };\n    if (!param && typeof navigator !== 'undefined') {\n        nav = {\n            userAgent: navigator.userAgent,\n            platform: navigator.platform,\n            maxTouchPoints: navigator.maxTouchPoints || 0\n        };\n    }\n    else if (typeof param === 'string') {\n        nav.userAgent = param;\n    }\n    else if (param && param.userAgent) {\n        nav = {\n            userAgent: param.userAgent,\n            platform: param.platform,\n            maxTouchPoints: param.maxTouchPoints || 0\n        };\n    }\n    var userAgent = nav.userAgent;\n    var tmp = userAgent.split('[FBAN');\n    if (typeof tmp[1] !== 'undefined') {\n        userAgent = tmp[0];\n    }\n    tmp = userAgent.split('Twitter');\n    if (typeof tmp[1] !== 'undefined') {\n        userAgent = tmp[0];\n    }\n    var match = createMatch(userAgent);\n    var result = {\n        apple: {\n            phone: match(appleIphone) && !match(windowsPhone),\n            ipod: match(appleIpod),\n            tablet: !match(appleIphone) &&\n                (match(appleTablet) || isAppleTabletOnIos13(nav)) &&\n                !match(windowsPhone),\n            universal: match(appleUniversal),\n            device: (match(appleIphone) ||\n                match(appleIpod) ||\n                match(appleTablet) ||\n                match(appleUniversal) ||\n                isAppleTabletOnIos13(nav)) &&\n                !match(windowsPhone)\n        },\n        amazon: {\n            phone: match(amazonPhone),\n            tablet: !match(amazonPhone) && match(amazonTablet),\n            device: match(amazonPhone) || match(amazonTablet)\n        },\n        android: {\n            phone: (!match(windowsPhone) && match(amazonPhone)) ||\n                (!match(windowsPhone) && match(androidPhone)),\n            tablet: !match(windowsPhone) &&\n                !match(amazonPhone) &&\n                !match(androidPhone) &&\n                (match(amazonTablet) || match(androidTablet)),\n            device: (!match(windowsPhone) &&\n                (match(amazonPhone) ||\n                    match(amazonTablet) ||\n                    match(androidPhone) ||\n                    match(androidTablet))) ||\n                match(/\\bokhttp\\b/i)\n        },\n        windows: {\n            phone: match(windowsPhone),\n            tablet: match(windowsTablet),\n            device: match(windowsPhone) || match(windowsTablet)\n        },\n        other: {\n            blackberry: match(otherBlackBerry),\n            blackberry10: match(otherBlackBerry10),\n            opera: match(otherOpera),\n            firefox: match(otherFirefox),\n            chrome: match(otherChrome),\n            device: match(otherBlackBerry) ||\n                match(otherBlackBerry10) ||\n                match(otherOpera) ||\n                match(otherFirefox) ||\n                match(otherChrome)\n        },\n        any: false,\n        phone: false,\n        tablet: false\n    };\n    result.any =\n        result.apple.device ||\n            result.android.device ||\n            result.windows.device ||\n            result.other.device;\n    result.phone =\n        result.apple.phone || result.android.phone || result.windows.phone;\n    result.tablet =\n        result.apple.tablet || result.android.tablet || result.windows.tablet;\n    return result;\n}\n//# sourceMappingURL=isMobile.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvaXNtb2JpbGVqcy9lc20vaXNNb2JpbGUuanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYWluLy4vbm9kZV9tb2R1bGVzL2lzbW9iaWxlanMvZXNtL2lzTW9iaWxlLmpzPzljYmUiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcGxlSXBob25lID0gL2lQaG9uZS9pO1xudmFyIGFwcGxlSXBvZCA9IC9pUG9kL2k7XG52YXIgYXBwbGVUYWJsZXQgPSAvaVBhZC9pO1xudmFyIGFwcGxlVW5pdmVyc2FsID0gL1xcYmlPUy11bml2ZXJzYWwoPzouKylNYWNcXGIvaTtcbnZhciBhbmRyb2lkUGhvbmUgPSAvXFxiQW5kcm9pZCg/Oi4rKU1vYmlsZVxcYi9pO1xudmFyIGFuZHJvaWRUYWJsZXQgPSAvQW5kcm9pZC9pO1xudmFyIGFtYXpvblBob25lID0gLyg/OlNENDkzMFVSfFxcYlNpbGsoPzouKylNb2JpbGVcXGIpL2k7XG52YXIgYW1hem9uVGFibGV0ID0gL1NpbGsvaTtcbnZhciB3aW5kb3dzUGhvbmUgPSAvV2luZG93cyBQaG9uZS9pO1xudmFyIHdpbmRvd3NUYWJsZXQgPSAvXFxiV2luZG93cyg/Oi4rKUFSTVxcYi9pO1xudmFyIG90aGVyQmxhY2tCZXJyeSA9IC9CbGFja0JlcnJ5L2k7XG52YXIgb3RoZXJCbGFja0JlcnJ5MTAgPSAvQkIxMC9pO1xudmFyIG90aGVyT3BlcmEgPSAvT3BlcmEgTWluaS9pO1xudmFyIG90aGVyQ2hyb21lID0gL1xcYihDcmlPU3xDaHJvbWUpKD86LispTW9iaWxlL2k7XG52YXIgb3RoZXJGaXJlZm94ID0gL01vYmlsZSg/Oi4rKUZpcmVmb3hcXGIvaTtcbnZhciBpc0FwcGxlVGFibGV0T25Jb3MxMyA9IGZ1bmN0aW9uIChuYXZpZ2F0b3IpIHtcbiAgICByZXR1cm4gKHR5cGVvZiBuYXZpZ2F0b3IgIT09ICd1bmRlZmluZWQnICYmXG4gICAgICAgIG5hdmlnYXRvci5wbGF0Zm9ybSA9PT0gJ01hY0ludGVsJyAmJlxuICAgICAgICB0eXBlb2YgbmF2aWdhdG9yLm1heFRvdWNoUG9pbnRzID09PSAnbnVtYmVyJyAmJlxuICAgICAgICBuYXZpZ2F0b3IubWF4VG91Y2hQb2ludHMgPiAxICYmXG4gICAgICAgIHR5cGVvZiBNU1N0cmVhbSA9PT0gJ3VuZGVmaW5lZCcpO1xufTtcbmZ1bmN0aW9uIGNyZWF0ZU1hdGNoKHVzZXJBZ2VudCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAocmVnZXgpIHsgcmV0dXJuIHJlZ2V4LnRlc3QodXNlckFnZW50KTsgfTtcbn1cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGlzTW9iaWxlKHBhcmFtKSB7XG4gICAgdmFyIG5hdiA9IHtcbiAgICAgICAgdXNlckFnZW50OiAnJyxcbiAgICAgICAgcGxhdGZvcm06ICcnLFxuICAgICAgICBtYXhUb3VjaFBvaW50czogMFxuICAgIH07XG4gICAgaWYgKCFwYXJhbSAmJiB0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICBuYXYgPSB7XG4gICAgICAgICAgICB1c2VyQWdlbnQ6IG5hdmlnYXRvci51c2VyQWdlbnQsXG4gICAgICAgICAgICBwbGF0Zm9ybTogbmF2aWdhdG9yLnBsYXRmb3JtLFxuICAgICAgICAgICAgbWF4VG91Y2hQb2ludHM6IG5hdmlnYXRvci5tYXhUb3VjaFBvaW50cyB8fCAwXG4gICAgICAgIH07XG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGVvZiBwYXJhbSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgbmF2LnVzZXJBZ2VudCA9IHBhcmFtO1xuICAgIH1cbiAgICBlbHNlIGlmIChwYXJhbSAmJiBwYXJhbS51c2VyQWdlbnQpIHtcbiAgICAgICAgbmF2ID0ge1xuICAgICAgICAgICAgdXNlckFnZW50OiBwYXJhbS51c2VyQWdlbnQsXG4gICAgICAgICAgICBwbGF0Zm9ybTogcGFyYW0ucGxhdGZvcm0sXG4gICAgICAgICAgICBtYXhUb3VjaFBvaW50czogcGFyYW0ubWF4VG91Y2hQb2ludHMgfHwgMFxuICAgICAgICB9O1xuICAgIH1cbiAgICB2YXIgdXNlckFnZW50ID0gbmF2LnVzZXJBZ2VudDtcbiAgICB2YXIgdG1wID0gdXNlckFnZW50LnNwbGl0KCdbRkJBTicpO1xuICAgIGlmICh0eXBlb2YgdG1wWzFdICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICB1c2VyQWdlbnQgPSB0bXBbMF07XG4gICAgfVxuICAgIHRtcCA9IHVzZXJBZ2VudC5zcGxpdCgnVHdpdHRlcicpO1xuICAgIGlmICh0eXBlb2YgdG1wWzFdICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICB1c2VyQWdlbnQgPSB0bXBbMF07XG4gICAgfVxuICAgIHZhciBtYXRjaCA9IGNyZWF0ZU1hdGNoKHVzZXJBZ2VudCk7XG4gICAgdmFyIHJlc3VsdCA9IHtcbiAgICAgICAgYXBwbGU6IHtcbiAgICAgICAgICAgIHBob25lOiBtYXRjaChhcHBsZUlwaG9uZSkgJiYgIW1hdGNoKHdpbmRvd3NQaG9uZSksXG4gICAgICAgICAgICBpcG9kOiBtYXRjaChhcHBsZUlwb2QpLFxuICAgICAgICAgICAgdGFibGV0OiAhbWF0Y2goYXBwbGVJcGhvbmUpICYmXG4gICAgICAgICAgICAgICAgKG1hdGNoKGFwcGxlVGFibGV0KSB8fCBpc0FwcGxlVGFibGV0T25Jb3MxMyhuYXYpKSAmJlxuICAgICAgICAgICAgICAgICFtYXRjaCh3aW5kb3dzUGhvbmUpLFxuICAgICAgICAgICAgdW5pdmVyc2FsOiBtYXRjaChhcHBsZVVuaXZlcnNhbCksXG4gICAgICAgICAgICBkZXZpY2U6IChtYXRjaChhcHBsZUlwaG9uZSkgfHxcbiAgICAgICAgICAgICAgICBtYXRjaChhcHBsZUlwb2QpIHx8XG4gICAgICAgICAgICAgICAgbWF0Y2goYXBwbGVUYWJsZXQpIHx8XG4gICAgICAgICAgICAgICAgbWF0Y2goYXBwbGVVbml2ZXJzYWwpIHx8XG4gICAgICAgICAgICAgICAgaXNBcHBsZVRhYmxldE9uSW9zMTMobmF2KSkgJiZcbiAgICAgICAgICAgICAgICAhbWF0Y2god2luZG93c1Bob25lKVxuICAgICAgICB9LFxuICAgICAgICBhbWF6b246IHtcbiAgICAgICAgICAgIHBob25lOiBtYXRjaChhbWF6b25QaG9uZSksXG4gICAgICAgICAgICB0YWJsZXQ6ICFtYXRjaChhbWF6b25QaG9uZSkgJiYgbWF0Y2goYW1hem9uVGFibGV0KSxcbiAgICAgICAgICAgIGRldmljZTogbWF0Y2goYW1hem9uUGhvbmUpIHx8IG1hdGNoKGFtYXpvblRhYmxldClcbiAgICAgICAgfSxcbiAgICAgICAgYW5kcm9pZDoge1xuICAgICAgICAgICAgcGhvbmU6ICghbWF0Y2god2luZG93c1Bob25lKSAmJiBtYXRjaChhbWF6b25QaG9uZSkpIHx8XG4gICAgICAgICAgICAgICAgKCFtYXRjaCh3aW5kb3dzUGhvbmUpICYmIG1hdGNoKGFuZHJvaWRQaG9uZSkpLFxuICAgICAgICAgICAgdGFibGV0OiAhbWF0Y2god2luZG93c1Bob25lKSAmJlxuICAgICAgICAgICAgICAgICFtYXRjaChhbWF6b25QaG9uZSkgJiZcbiAgICAgICAgICAgICAgICAhbWF0Y2goYW5kcm9pZFBob25lKSAmJlxuICAgICAgICAgICAgICAgIChtYXRjaChhbWF6b25UYWJsZXQpIHx8IG1hdGNoKGFuZHJvaWRUYWJsZXQpKSxcbiAgICAgICAgICAgIGRldmljZTogKCFtYXRjaCh3aW5kb3dzUGhvbmUpICYmXG4gICAgICAgICAgICAgICAgKG1hdGNoKGFtYXpvblBob25lKSB8fFxuICAgICAgICAgICAgICAgICAgICBtYXRjaChhbWF6b25UYWJsZXQpIHx8XG4gICAgICAgICAgICAgICAgICAgIG1hdGNoKGFuZHJvaWRQaG9uZSkgfHxcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2goYW5kcm9pZFRhYmxldCkpKSB8fFxuICAgICAgICAgICAgICAgIG1hdGNoKC9cXGJva2h0dHBcXGIvaSlcbiAgICAgICAgfSxcbiAgICAgICAgd2luZG93czoge1xuICAgICAgICAgICAgcGhvbmU6IG1hdGNoKHdpbmRvd3NQaG9uZSksXG4gICAgICAgICAgICB0YWJsZXQ6IG1hdGNoKHdpbmRvd3NUYWJsZXQpLFxuICAgICAgICAgICAgZGV2aWNlOiBtYXRjaCh3aW5kb3dzUGhvbmUpIHx8IG1hdGNoKHdpbmRvd3NUYWJsZXQpXG4gICAgICAgIH0sXG4gICAgICAgIG90aGVyOiB7XG4gICAgICAgICAgICBibGFja2JlcnJ5OiBtYXRjaChvdGhlckJsYWNrQmVycnkpLFxuICAgICAgICAgICAgYmxhY2tiZXJyeTEwOiBtYXRjaChvdGhlckJsYWNrQmVycnkxMCksXG4gICAgICAgICAgICBvcGVyYTogbWF0Y2gob3RoZXJPcGVyYSksXG4gICAgICAgICAgICBmaXJlZm94OiBtYXRjaChvdGhlckZpcmVmb3gpLFxuICAgICAgICAgICAgY2hyb21lOiBtYXRjaChvdGhlckNocm9tZSksXG4gICAgICAgICAgICBkZXZpY2U6IG1hdGNoKG90aGVyQmxhY2tCZXJyeSkgfHxcbiAgICAgICAgICAgICAgICBtYXRjaChvdGhlckJsYWNrQmVycnkxMCkgfHxcbiAgICAgICAgICAgICAgICBtYXRjaChvdGhlck9wZXJhKSB8fFxuICAgICAgICAgICAgICAgIG1hdGNoKG90aGVyRmlyZWZveCkgfHxcbiAgICAgICAgICAgICAgICBtYXRjaChvdGhlckNocm9tZSlcbiAgICAgICAgfSxcbiAgICAgICAgYW55OiBmYWxzZSxcbiAgICAgICAgcGhvbmU6IGZhbHNlLFxuICAgICAgICB0YWJsZXQ6IGZhbHNlXG4gICAgfTtcbiAgICByZXN1bHQuYW55ID1cbiAgICAgICAgcmVzdWx0LmFwcGxlLmRldmljZSB8fFxuICAgICAgICAgICAgcmVzdWx0LmFuZHJvaWQuZGV2aWNlIHx8XG4gICAgICAgICAgICByZXN1bHQud2luZG93cy5kZXZpY2UgfHxcbiAgICAgICAgICAgIHJlc3VsdC5vdGhlci5kZXZpY2U7XG4gICAgcmVzdWx0LnBob25lID1cbiAgICAgICAgcmVzdWx0LmFwcGxlLnBob25lIHx8IHJlc3VsdC5hbmRyb2lkLnBob25lIHx8IHJlc3VsdC53aW5kb3dzLnBob25lO1xuICAgIHJlc3VsdC50YWJsZXQgPVxuICAgICAgICByZXN1bHQuYXBwbGUudGFibGV0IHx8IHJlc3VsdC5hbmRyb2lkLnRhYmxldCB8fCByZXN1bHQud2luZG93cy50YWJsZXQ7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWlzTW9iaWxlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./node_modules/ismobilejs/esm/isMobile.js\n")},"./node_modules/stats.js/build/stats.min.js":function(module){eval('// stats.js - http://github.com/mrdoob/stats.js\n(function(f,e){ true?module.exports=e():0})(this,function(){var f=function(){function e(a){c.appendChild(a.dom);return a}function u(a){for(var d=0;d<c.children.length;d++)c.children[d].style.display=d===a?"block":"none";l=a}var l=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000";c.addEventListener("click",function(a){a.preventDefault();\nu(++l%c.children.length)},!1);var k=(performance||Date).now(),g=k,a=0,r=e(new f.Panel("FPS","#0ff","#002")),h=e(new f.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var t=e(new f.Panel("MB","#f08","#201"));u(0);return{REVISION:16,dom:c,addPanel:e,showPanel:u,begin:function(){k=(performance||Date).now()},end:function(){a++;var c=(performance||Date).now();h.update(c-k,200);if(c>g+1E3&&(r.update(1E3*a/(c-g),100),g=c,a=0,t)){var d=performance.memory;t.update(d.usedJSHeapSize/\n1048576,d.jsHeapSizeLimit/1048576)}return c},update:function(){k=this.end()},domElement:c,setMode:u}};f.Panel=function(e,f,l){var c=Infinity,k=0,g=Math.round,a=g(window.devicePixelRatio||1),r=80*a,h=48*a,t=3*a,v=2*a,d=3*a,m=15*a,n=74*a,p=30*a,q=document.createElement("canvas");q.width=r;q.height=h;q.style.cssText="width:80px;height:48px";var b=q.getContext("2d");b.font="bold "+9*a+"px Helvetica,Arial,sans-serif";b.textBaseline="top";b.fillStyle=l;b.fillRect(0,0,r,h);b.fillStyle=f;b.fillText(e,t,v);\nb.fillRect(d,m,n,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d,m,n,p);return{dom:q,update:function(h,w){c=Math.min(c,h);k=Math.max(k,h);b.fillStyle=l;b.globalAlpha=1;b.fillRect(0,0,r,m);b.fillStyle=f;b.fillText(g(h)+" "+e+" ("+g(c)+"-"+g(k)+")",t,v);b.drawImage(q,d+a,m,n-a,p,d,m,n-a,p);b.fillRect(d+n-a,m,a,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d+n-a,m,a,g((1-h/w)*p))}}};return f});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvc3RhdHMuanMvYnVpbGQvc3RhdHMubWluLmpzIiwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYWluLy4vbm9kZV9tb2R1bGVzL3N0YXRzLmpzL2J1aWxkL3N0YXRzLm1pbi5qcz8zMTkxIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHN0YXRzLmpzIC0gaHR0cDovL2dpdGh1Yi5jb20vbXJkb29iL3N0YXRzLmpzXG4oZnVuY3Rpb24oZixlKXtcIm9iamVjdFwiPT09dHlwZW9mIGV4cG9ydHMmJlwidW5kZWZpbmVkXCIhPT10eXBlb2YgbW9kdWxlP21vZHVsZS5leHBvcnRzPWUoKTpcImZ1bmN0aW9uXCI9PT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZShlKTpmLlN0YXRzPWUoKX0pKHRoaXMsZnVuY3Rpb24oKXt2YXIgZj1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoYSl7Yy5hcHBlbmRDaGlsZChhLmRvbSk7cmV0dXJuIGF9ZnVuY3Rpb24gdShhKXtmb3IodmFyIGQ9MDtkPGMuY2hpbGRyZW4ubGVuZ3RoO2QrKyljLmNoaWxkcmVuW2RdLnN0eWxlLmRpc3BsYXk9ZD09PWE/XCJibG9ja1wiOlwibm9uZVwiO2w9YX12YXIgbD0wLGM9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtjLnN0eWxlLmNzc1RleHQ9XCJwb3NpdGlvbjpmaXhlZDt0b3A6MDtsZWZ0OjA7Y3Vyc29yOnBvaW50ZXI7b3BhY2l0eTowLjk7ei1pbmRleDoxMDAwMFwiO2MuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsZnVuY3Rpb24oYSl7YS5wcmV2ZW50RGVmYXVsdCgpO1xudSgrK2wlYy5jaGlsZHJlbi5sZW5ndGgpfSwhMSk7dmFyIGs9KHBlcmZvcm1hbmNlfHxEYXRlKS5ub3coKSxnPWssYT0wLHI9ZShuZXcgZi5QYW5lbChcIkZQU1wiLFwiIzBmZlwiLFwiIzAwMlwiKSksaD1lKG5ldyBmLlBhbmVsKFwiTVNcIixcIiMwZjBcIixcIiMwMjBcIikpO2lmKHNlbGYucGVyZm9ybWFuY2UmJnNlbGYucGVyZm9ybWFuY2UubWVtb3J5KXZhciB0PWUobmV3IGYuUGFuZWwoXCJNQlwiLFwiI2YwOFwiLFwiIzIwMVwiKSk7dSgwKTtyZXR1cm57UkVWSVNJT046MTYsZG9tOmMsYWRkUGFuZWw6ZSxzaG93UGFuZWw6dSxiZWdpbjpmdW5jdGlvbigpe2s9KHBlcmZvcm1hbmNlfHxEYXRlKS5ub3coKX0sZW5kOmZ1bmN0aW9uKCl7YSsrO3ZhciBjPShwZXJmb3JtYW5jZXx8RGF0ZSkubm93KCk7aC51cGRhdGUoYy1rLDIwMCk7aWYoYz5nKzFFMyYmKHIudXBkYXRlKDFFMyphLyhjLWcpLDEwMCksZz1jLGE9MCx0KSl7dmFyIGQ9cGVyZm9ybWFuY2UubWVtb3J5O3QudXBkYXRlKGQudXNlZEpTSGVhcFNpemUvXG4xMDQ4NTc2LGQuanNIZWFwU2l6ZUxpbWl0LzEwNDg1NzYpfXJldHVybiBjfSx1cGRhdGU6ZnVuY3Rpb24oKXtrPXRoaXMuZW5kKCl9LGRvbUVsZW1lbnQ6YyxzZXRNb2RlOnV9fTtmLlBhbmVsPWZ1bmN0aW9uKGUsZixsKXt2YXIgYz1JbmZpbml0eSxrPTAsZz1NYXRoLnJvdW5kLGE9Zyh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpb3x8MSkscj04MCphLGg9NDgqYSx0PTMqYSx2PTIqYSxkPTMqYSxtPTE1KmEsbj03NCphLHA9MzAqYSxxPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7cS53aWR0aD1yO3EuaGVpZ2h0PWg7cS5zdHlsZS5jc3NUZXh0PVwid2lkdGg6ODBweDtoZWlnaHQ6NDhweFwiO3ZhciBiPXEuZ2V0Q29udGV4dChcIjJkXCIpO2IuZm9udD1cImJvbGQgXCIrOSphK1wicHggSGVsdmV0aWNhLEFyaWFsLHNhbnMtc2VyaWZcIjtiLnRleHRCYXNlbGluZT1cInRvcFwiO2IuZmlsbFN0eWxlPWw7Yi5maWxsUmVjdCgwLDAscixoKTtiLmZpbGxTdHlsZT1mO2IuZmlsbFRleHQoZSx0LHYpO1xuYi5maWxsUmVjdChkLG0sbixwKTtiLmZpbGxTdHlsZT1sO2IuZ2xvYmFsQWxwaGE9Ljk7Yi5maWxsUmVjdChkLG0sbixwKTtyZXR1cm57ZG9tOnEsdXBkYXRlOmZ1bmN0aW9uKGgsdyl7Yz1NYXRoLm1pbihjLGgpO2s9TWF0aC5tYXgoayxoKTtiLmZpbGxTdHlsZT1sO2IuZ2xvYmFsQWxwaGE9MTtiLmZpbGxSZWN0KDAsMCxyLG0pO2IuZmlsbFN0eWxlPWY7Yi5maWxsVGV4dChnKGgpK1wiIFwiK2UrXCIgKFwiK2coYykrXCItXCIrZyhrKStcIilcIix0LHYpO2IuZHJhd0ltYWdlKHEsZCthLG0sbi1hLHAsZCxtLG4tYSxwKTtiLmZpbGxSZWN0KGQrbi1hLG0sYSxwKTtiLmZpbGxTdHlsZT1sO2IuZ2xvYmFsQWxwaGE9Ljk7Yi5maWxsUmVjdChkK24tYSxtLGEsZygoMS1oL3cpKnApKX19fTtyZXR1cm4gZn0pO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/stats.js/build/stats.min.js\n')},"./src/main.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var fairygui_createjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fairygui-createjs */ "./node_modules/fairygui-createjs/dist/fairygui.module.js");\n/* harmony import */ var stats_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! stats.js */ "./node_modules/stats.js/build/stats.min.js");\n/* harmony import */ var stats_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(stats_js__WEBPACK_IMPORTED_MODULE_1__);\n\n // JavaScript性能監視器\nclass Main {\n    // 建構\n    constructor(canvas, manifest) {\n        this.manifest = [];\n        this.canvas = canvas;\n        this.manifest = manifest;\n        this.stage = new createjs.Stage(canvas);\n        this.init();\n    }\n    // 公開成員函式 ====================\n    init() {\n        this.initStats();\n        this.createStage();\n        this.createLoader();\n    }\n    createStage() {\n        fairygui_createjs__WEBPACK_IMPORTED_MODULE_0__.GRoot.inst.attachTo(this.stage, {\n            designWidth: 800,\n            designHeight: 600,\n            scaleMode: "fixedWidth" /* fgui.StageScaleMode.FIXED_WIDTH */,\n            orientation: "landscape" /* fgui.StageOrientation.LANDSCAPE */,\n            alignV: 3 /* fgui.StageAlign.TOP */,\n            alignH: 0 /* fgui.StageAlign.LEFT */\n        });\n        createjs.Ticker.framerate = 60;\n        createjs.Ticker.timingMode = createjs.Ticker.RAF_SYNCHED;\n        createjs.Ticker.on(\'tick\', this.tick, this);\n    }\n    tick(e) {\n        if (e.paused !== 1) {\n            this.stage.update();\n        }\n        else {\n            console.log(\'pause!\');\n        }\n    }\n    createLoader() {\n        this.loader = new fairygui_createjs__WEBPACK_IMPORTED_MODULE_0__.AssetLoader(false, "", "Anonymous");\n        createjs.Sound.alternateExtensions = ["mp3"];\n        this.loader.installPlugin(createjs.Sound);\n        this.loader.loadManifest(this.manifest);\n        // this.loader.on("progress", this.loadProgress, this);\n        this.loader.on("complete", this.resLoaded, this);\n    }\n    initStats() {\n        this.stats = new stats_js__WEBPACK_IMPORTED_MODULE_1__();\n        this.stats.showPanel(0); // 0: fps, 1: ms, 2: mb, 3+: custom\n        document.body.appendChild(this.stats.dom);\n    }\n    loadProgress(e) {\n        let p = e.progress * 100;\n        this.loadingView.setProgress(p);\n        if (p >= 100) {\n            this.loader.off("progress", this.loadProgress);\n            this.loadingView.dispose();\n            this.loadingView = null;\n            this.contentlayer.dispose();\n            fairygui_createjs__WEBPACK_IMPORTED_MODULE_0__.GRoot.inst.removeChild(this.contentlayer);\n        }\n    }\n    resLoaded() {\n        this.loader.destroy();\n        fairygui_createjs__WEBPACK_IMPORTED_MODULE_0__.UIPackage.addPackage("uitest");\n        let ins = fairygui_createjs__WEBPACK_IMPORTED_MODULE_0__.UIPackage.createObject("uitest", "TestView");\n        // console.log(fgui.UIPackage.addPackage("uitest"));\n        ins.setSize(fairygui_createjs__WEBPACK_IMPORTED_MODULE_0__.GRoot.inst.width, fairygui_createjs__WEBPACK_IMPORTED_MODULE_0__.GRoot.inst.height);\n        ins.addRelation(fairygui_createjs__WEBPACK_IMPORTED_MODULE_0__.GRoot.inst, 24 /* fgui.RelationType.Size */);\n        fairygui_createjs__WEBPACK_IMPORTED_MODULE_0__.GRoot.inst.addChild(ins);\n        this.animate();\n    }\n    animate() {\n        this.stats.begin();\n        this.stats.end();\n        requestAnimationFrame(this.animate.bind(this));\n    }\n}\nlet canvas = document.querySelector(\'#mainView\');\nlet manifest = [\n    { id: "uitest", src: \'public/ui/uitest.fui\', type: "binary" },\n    { id: \'uitest@atlas0\', src: \'public/ui/uitest@atlas0.jpg\', type: "image" },\n    // { id: \'test@atlas0_1\', src: \'ui/test@atlas0_1.png\', type: "image" }\n];\nnew Main(canvas, manifest);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbWFpbi50cyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUdBO0FBV0E7QUFDQTtBQVBBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYWluLy4vc3JjL21haW4udHM/Y2Q0OSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBmZ3VpIGZyb20gJ2ZhaXJ5Z3VpLWNyZWF0ZWpzJ1xuaW1wb3J0ICogYXMgU3RhdHMgZnJvbSBcInN0YXRzLmpzXCI7ICAgICAgICAgICAgICAvLyBKYXZhU2NyaXB05oCn6IO955uj6KaW5ZmoXG5pbXBvcnQgeyBMb2FkaW5nVmlldyB9IGZyb20gJy4vTG9hZGluZ1ZpZXcnOyAgICAvLyBMb2FkaW5nIOeVq+mdolxuXG5jbGFzcyBNYWluIHtcblxuICAgIC8vIOWFrOmWi+WxrOaAp+aIkOWToVxuICAgIHN0YXRzOiBTdGF0cztcbiAgICBsb2FkZXI6IGZndWkuQXNzZXRMb2FkZXI7XG4gICAgbWFuaWZlc3Q6IEFycmF5PHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0+ID0gW107XG4gICAgY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudDtcbiAgICBzdGFnZTogY3JlYXRlanMuU3RhZ2U7XG4gICAgY29udGVudGxheWVyOiBmZ3VpLkdDb21wb25lbnQ7XG4gICAgbG9hZGluZ1ZpZXc6IExvYWRpbmdWaWV3O1xuXG4gICAgLy8g5bu65qeLXG4gICAgY29uc3RydWN0b3IoY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCwgbWFuaWZlc3Q6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nOyB9W10pIHtcbiAgICAgICAgdGhpcy5jYW52YXMgPSBjYW52YXM7XG4gICAgICAgIHRoaXMubWFuaWZlc3QgPSBtYW5pZmVzdDtcbiAgICAgICAgdGhpcy5zdGFnZSA9IG5ldyBjcmVhdGVqcy5TdGFnZShjYW52YXMpO1xuICAgICAgICB0aGlzLmluaXQoKTtcbiAgICB9XG5cbiAgICAvLyDlhazplovmiJDlk6Hlh73lvI8gPT09PT09PT09PT09PT09PT09PT1cblxuICAgIGluaXQoKSB7XG4gICAgICAgIHRoaXMuaW5pdFN0YXRzKCk7XG4gICAgICAgIHRoaXMuY3JlYXRlU3RhZ2UoKTtcbiAgICAgICAgdGhpcy5jcmVhdGVMb2FkZXIoKTtcbiAgICB9XG5cbiAgICBjcmVhdGVTdGFnZSgpIHtcbiAgICAgICAgZmd1aS5HUm9vdC5pbnN0LmF0dGFjaFRvKHRoaXMuc3RhZ2UsIHtcbiAgICAgICAgICAgIGRlc2lnbldpZHRoOiA4MDAsXG4gICAgICAgICAgICBkZXNpZ25IZWlnaHQ6IDYwMCxcbiAgICAgICAgICAgIHNjYWxlTW9kZTogZmd1aS5TdGFnZVNjYWxlTW9kZS5GSVhFRF9XSURUSCxcbiAgICAgICAgICAgIG9yaWVudGF0aW9uOiBmZ3VpLlN0YWdlT3JpZW50YXRpb24uTEFORFNDQVBFLFxuICAgICAgICAgICAgYWxpZ25WOiBmZ3VpLlN0YWdlQWxpZ24uVE9QLFxuICAgICAgICAgICAgYWxpZ25IOiBmZ3VpLlN0YWdlQWxpZ24uTEVGVFxuICAgICAgICB9KTtcblxuICAgICAgICBjcmVhdGVqcy5UaWNrZXIuZnJhbWVyYXRlID0gNjA7XG4gICAgICAgIGNyZWF0ZWpzLlRpY2tlci50aW1pbmdNb2RlID0gY3JlYXRlanMuVGlja2VyLlJBRl9TWU5DSEVEO1xuICAgICAgICBjcmVhdGVqcy5UaWNrZXIub24oJ3RpY2snLCB0aGlzLnRpY2ssIHRoaXMpO1xuICAgIH1cblxuICAgIHRpY2soZTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSkge1xuICAgICAgICBpZiAoZS5wYXVzZWQgIT09IDEpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhZ2UudXBkYXRlKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygncGF1c2UhJylcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNyZWF0ZUxvYWRlcigpIHtcbiAgICAgICAgdGhpcy5sb2FkZXIgPSBuZXcgZmd1aS5Bc3NldExvYWRlcihmYWxzZSwgXCJcIiwgXCJBbm9ueW1vdXNcIik7XG4gICAgICAgIGNyZWF0ZWpzLlNvdW5kLmFsdGVybmF0ZUV4dGVuc2lvbnMgPSBbXCJtcDNcIl07XG4gICAgICAgIHRoaXMubG9hZGVyLmluc3RhbGxQbHVnaW4oY3JlYXRlanMuU291bmQpO1xuICAgICAgICB0aGlzLmxvYWRlci5sb2FkTWFuaWZlc3QodGhpcy5tYW5pZmVzdCk7XG4gICAgICAgIC8vIHRoaXMubG9hZGVyLm9uKFwicHJvZ3Jlc3NcIiwgdGhpcy5sb2FkUHJvZ3Jlc3MsIHRoaXMpO1xuICAgICAgICB0aGlzLmxvYWRlci5vbihcImNvbXBsZXRlXCIsIHRoaXMucmVzTG9hZGVkLCB0aGlzKTtcbiAgICB9XG5cbiAgICBpbml0U3RhdHMoKSB7XG4gICAgICAgIHRoaXMuc3RhdHMgPSBuZXcgU3RhdHMoKTtcbiAgICAgICAgdGhpcy5zdGF0cy5zaG93UGFuZWwoMCk7IC8vIDA6IGZwcywgMTogbXMsIDI6IG1iLCAzKzogY3VzdG9tXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5zdGF0cy5kb20pO1xuICAgIH1cblxuICAgIGxvYWRQcm9ncmVzcyhlOk9iamVjdCk6IHZvaWQge1xuICAgICAgICBsZXQgcCA9IChlIGFzIGNyZWF0ZWpzLlByb2dyZXNzRXZlbnQpLnByb2dyZXNzICogMTAwO1xuICAgICAgICB0aGlzLmxvYWRpbmdWaWV3LnNldFByb2dyZXNzKHApO1xuICAgICAgICBpZiAocCA+PSAxMDApIHtcbiAgICAgICAgICAgIHRoaXMubG9hZGVyLm9mZihcInByb2dyZXNzXCIsIHRoaXMubG9hZFByb2dyZXNzKTtcbiAgICAgICAgICAgIHRoaXMubG9hZGluZ1ZpZXcuZGlzcG9zZSgpO1xuICAgICAgICAgICAgdGhpcy5sb2FkaW5nVmlldyA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRsYXllci5kaXNwb3NlKCk7XG4gICAgICAgICAgICBmZ3VpLkdSb290Lmluc3QucmVtb3ZlQ2hpbGQodGhpcy5jb250ZW50bGF5ZXIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmVzTG9hZGVkKCkge1xuICAgICAgICB0aGlzLmxvYWRlci5kZXN0cm95KCk7XG4gICAgICAgIGZndWkuVUlQYWNrYWdlLmFkZFBhY2thZ2UoXCJ1aXRlc3RcIik7XG4gICAgICAgIGxldCBpbnMgPSBmZ3VpLlVJUGFja2FnZS5jcmVhdGVPYmplY3QoXCJ1aXRlc3RcIiwgXCJUZXN0Vmlld1wiKSBhcyBmZ3VpLkdDb21wb25lbnQ7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGZndWkuVUlQYWNrYWdlLmFkZFBhY2thZ2UoXCJ1aXRlc3RcIikpO1xuICAgICAgICBpbnMuc2V0U2l6ZShmZ3VpLkdSb290Lmluc3Qud2lkdGgsIGZndWkuR1Jvb3QuaW5zdC5oZWlnaHQpO1xuICAgICAgICBpbnMuYWRkUmVsYXRpb24oZmd1aS5HUm9vdC5pbnN0LCBmZ3VpLlJlbGF0aW9uVHlwZS5TaXplKTtcbiAgICAgICAgZmd1aS5HUm9vdC5pbnN0LmFkZENoaWxkKGlucyk7XG5cbiAgICAgICAgdGhpcy5hbmltYXRlKCk7XG4gICAgfVxuXG4gICAgYW5pbWF0ZSgpIHtcbiAgICAgICAgdGhpcy5zdGF0cy5iZWdpbigpO1xuICAgICAgICB0aGlzLnN0YXRzLmVuZCgpO1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5hbmltYXRlLmJpbmQodGhpcykpO1xuICAgIH1cblxufVxuXG5sZXQgY2FudmFzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21haW5WaWV3JykgYXMgSFRNTENhbnZhc0VsZW1lbnQ7XG5sZXQgbWFuaWZlc3QgPSBbXG4gICAgeyBpZDogXCJ1aXRlc3RcIiwgc3JjOiAncHVibGljL3VpL3VpdGVzdC5mdWknLCB0eXBlOiBcImJpbmFyeVwiIH0sXG4gICAgeyBpZDogJ3VpdGVzdEBhdGxhczAnLCBzcmM6ICdwdWJsaWMvdWkvdWl0ZXN0QGF0bGFzMC5qcGcnLCB0eXBlOiBcImltYWdlXCIgfSxcbiAgICAvLyB7IGlkOiAndGVzdEBhdGxhczBfMScsIHNyYzogJ3VpL3Rlc3RAYXRsYXMwXzEucG5nJywgdHlwZTogXCJpbWFnZVwiIH1cbl07XG5uZXcgTWFpbihjYW52YXMsIG1hbmlmZXN0KTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/main.ts\n')}},__webpack_module_cache__={};function __webpack_require__(g){var I=__webpack_module_cache__[g];if(void 0!==I)return I.exports;var C=__webpack_module_cache__[g]={exports:{}};return __webpack_modules__[g].call(C.exports,C,C.exports,__webpack_require__),C.exports}__webpack_require__.n=g=>{var I=g&&g.__esModule?()=>g.default:()=>g;return __webpack_require__.d(I,{a:I}),I},__webpack_require__.d=(g,I)=>{for(var C in I)__webpack_require__.o(I,C)&&!__webpack_require__.o(g,C)&&Object.defineProperty(g,C,{enumerable:!0,get:I[C]})},__webpack_require__.o=(g,I)=>Object.prototype.hasOwnProperty.call(g,I),__webpack_require__.r=g=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__("./src/main.ts");main=__webpack_exports__})();